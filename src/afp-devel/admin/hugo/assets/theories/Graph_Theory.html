<div id="Rtrancl_On">
<div class="head">
<h1>Theory Rtrancl_On</h1>
</div>
<pre class="source"><span class="comment1">(* Title:  Rtrancl_On.thy
   Author: Lars Noschinski, TU München
   Author: René Neumann, TU München
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Rtrancl_On
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Reflexive-Transitive Closure on a Domain›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section we introduce a variant of the reflexive-transitive closure
  of a relation which is useful to formalize the reachability relation on
  digraphs.
›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span>
  <span class="entity">rtrancl_on</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">r</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
    rtrancl_on_refl <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span><span class="main">,</span> <span class="operator">Pure.intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span></span></span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">rtrancl_on</span> <span class="free">F</span> <span class="free">r</span>"</span></span>
  <span class="main">|</span> rtrancl_on_into_rtrancl_on <span class="main">[</span><span class="operator">Pure.intro</span><span class="main">]</span><span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">rtrancl_on</span> <span class="free">F</span> <span class="free">r</span>  <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∈</span> <span class="free">F</span>
      <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">rtrancl_on</span> <span class="free">F</span> <span class="free">r</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">symcl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel <span class="main">⇒</span> <span class="tfree">'a</span> rel"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1"><span class="hidden">⇧</span><sup>s</sup></span><span class="keyword3">)</span>"</span> <span class="main">[</span>1000<span class="main">]</span> 999<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">symcl</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">∪</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span>"</span></span>

<span class="keyword1" id="Rtrancl_On-in_rtrancl_on_in_F"><span class="command">lemma</span></span> in_rtrancl_on_in_F<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">F</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="operator">auto</span>

<span class="keyword1" id="Rtrancl_On-rtrancl_on_induct"><span class="command">lemma</span></span> rtrancl_on_induct<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> base step<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">set</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">:</span></span></span></span> rtrancl_on<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">F</span> <span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">a</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">F</span> <span class="free">r</span><span class="main">;</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">;</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">F</span><span class="main">;</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">F</span><span class="main">;</span> <span class="free">P</span> <span class="bound">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_rtrancl_on_in_F<span class="main">)</span>

<span class="keyword1" id="Rtrancl_On-rtrancl_on_trans"><span class="command">lemma</span></span> rtrancl_on_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">F</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">F</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">F</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_on_into_rtrancl_on<span class="main">)</span>

<span class="keyword1" id="Rtrancl_On-converse_rtrancl_on_into_rtrancl_on"><span class="command">lemma</span></span> converse_rtrancl_on_into_rtrancl_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">c</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">F</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">c</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">F</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> in_rtrancl_on_in_F<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_on_trans<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_on_into_rtrancl_on<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_on_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rtrancl_On-rtrancl_on_converseI"><span class="command">lemma</span></span> rtrancl_on_converseI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">F</span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">F</span> <span class="main">(</span><span class="free">r</span><span class="main">¯</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">F</span> <span class="main">(</span><span class="free">r</span><span class="main">¯</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">¯</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> step
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rtrancl_on_trans rtrancl_on_into_rtrancl_on<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">theorem</span></span> rtrancl_on_converseD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">F</span> <span class="main">(</span><span class="free">r</span><span class="main">¯</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">F</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">drule</span> rtrancl_on_converseI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Rtrancl_On-converse_rtrancl_on_induct"><span class="command">lemma</span></span> converse_rtrancl_on_induct<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> base step<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">set</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">:</span></span></span></span> rtrancl_on<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> major<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">F</span> <span class="free">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">b</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main">;</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">F</span> <span class="free">r</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">F</span><span class="main">;</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">F</span><span class="main">;</span> <span class="free">P</span> <span class="bound">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rtrancl_on_converseI<span class="main">[</span><span class="operator">OF</span> major<span class="main">]</span> cases
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_on_converseD<span class="main">)</span>

<span class="keyword1" id="Rtrancl_On-converse_rtrancl_on_cases"><span class="command">lemma</span></span> converse_rtrancl_on_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">F</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>base<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
    <span class="main">|</span> <span class="main">(</span>step<span class="main">)</span> <span class="free">c</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">F</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="operator">auto</span>

<span class="keyword1" id="Rtrancl_On-rtrancl_on_sym"><span class="command">lemma</span></span> rtrancl_on_sym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span>rtrancl_on <span class="free">F</span> <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sym_conv_converse_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> symI <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rtrancl_on_converseI<span class="main">)</span>

<span class="keyword1" id="Rtrancl_On-rtrancl_on_mono"><span class="command">lemma</span></span> rtrancl_on_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">⊆</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">F</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">G</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">,</span>1<span class="main">,</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> step assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> converse_rtrancl_on_into_rtrancl_on<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ step<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Rtrancl_On-rtrancl_consistent_rtrancl_on"><span class="command">lemma</span></span> rtrancl_consistent_rtrancl_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> consistent<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">F</span><span class="main">;</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">F</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-3<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_rtrancl_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> consistent<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> step <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">F</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> step.prems <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="free">F</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> converse_rtrancl_on_into_rtrancl_on
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Rtrancl_On-rtrancl_on_rtranclI"><span class="command">lemma</span></span> rtrancl_on_rtranclI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="free">F</span> <span class="free">r</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">r</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtrancl_on_induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Rtrancl_On-rtrancl_on_sub_rtrancl"><span class="command">lemma</span></span> rtrancl_on_sub_rtrancl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"rtrancl_on <span class="free">F</span> <span class="free">r</span> <span class="main">⊆</span> <span class="free">r</span><span class="main">^*</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rtrancl_on_rtranclI
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>



<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Stuff">
<div class="head">
<h1>Theory Stuff</h1>
</div>
<pre class="source"><span class="comment1">(* Title:  Stuff.thy
   Author: Lars Noschinski, TU München
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Stuff
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Main.html">Main</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Extended_Real.html">HOL-Library.Extended_Real</a>"</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Additional theorems for base libraries›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This section contains lemmas unrelated to graph theory which might be
  interesting for the Isabelle distribution
›</span></span>

<span class="keyword1" id="Stuff-ereal_Inf_finite_Min"><span class="command">lemma</span></span> ereal_Inf_finite_Min<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"ereal set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Inf <span class="free">S</span> <span class="main">=</span> Min <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_ne_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_absorb1<span class="main">)</span>

<span class="keyword1" id="Stuff-finite_INF_in"><span class="command">lemma</span></span> finite_INF_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">s</span><span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Inf <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ereal_Inf_finite_Min <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">S</span>"</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Stuff-not_mem_less_INF"><span class="command">lemma</span></span> not_mem_less_INF<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> complete_lattice"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">s</span><span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="free">f</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> INF_lower less_le_not_le<span class="main">)</span>

<span class="keyword1" id="Stuff-sym_diff"><span class="command">lemma</span></span> sym_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"sym <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sym_def<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹List›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> list_exhaust2 <span class="main">=</span> list.exhaust<span class="main">[</span><span class="operator">case_product</span> list.exhaust<span class="main">]</span>

<span class="keyword1" id="Stuff-list_exhaust_NSC"><span class="command">lemma</span></span> list_exhaust_NSC<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>Nil<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span> <span class="main">(</span>Single<span class="main">)</span> <span class="free">x</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>"</span></span> <span class="main">|</span> <span class="main">(</span>Cons_Cons<span class="main">)</span> <span class="free">x</span> <span class="free">y</span> <span class="free">ys</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">=</span> <span class="free">x</span> <span class="main">#</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.exhaust<span class="main">)</span>

<span class="keyword1" id="Stuff-tl_rev"><span class="command">lemma</span></span> tl_rev<span class="main">:</span>
  <span class="quoted"><span class="quoted">"tl <span class="main">(</span>rev <span class="free">p</span><span class="main">)</span> <span class="main">=</span> rev <span class="main">(</span>butlast <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Stuff-butlast_rev"><span class="command">lemma</span></span> butlast_rev<span class="main">:</span>
  <span class="quoted"><span class="quoted">"butlast <span class="main">(</span>rev <span class="free">p</span><span class="main">)</span> <span class="main">=</span> rev <span class="main">(</span>tl <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Stuff-take_drop_take"><span class="command">lemma</span></span> take_drop_take<span class="main">:</span>
   <span class="quoted"><span class="quoted">"take <span class="free">n</span> <span class="free">xs</span> <span class="main">@</span> drop <span class="free">n</span> <span class="main">(</span>take <span class="free">m</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> take <span class="main">(</span>max <span class="free">n</span> <span class="free">m</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="free">n</span> <span class="free">xs</span> <span class="main">=</span> take <span class="free">n</span> <span class="main">(</span>take <span class="free">m</span> <span class="free">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> take_take <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Stuff-drop_take_drop"><span class="command">lemma</span></span> drop_take_drop<span class="main">:</span>
  <span class="quoted"><span class="quoted">"drop <span class="free">n</span> <span class="main">(</span>take <span class="free">m</span> <span class="free">xs</span><span class="main">)</span> <span class="main">@</span> drop <span class="free">m</span> <span class="free">xs</span> <span class="main">=</span> drop <span class="main">(</span>min <span class="free">n</span> <span class="free">m</span><span class="main">)</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">m</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> drop_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="quoted">"take <span class="free">m</span> <span class="free">xs</span>"</span></span> <span class="quoted"><span class="quoted">"drop <span class="free">m</span> <span class="free">xs</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="free">xs</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_less min_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>

<span class="keyword1" id="Stuff-not_distinct_decomp_min_prefix"><span class="command">lemma</span></span> not_distinct_decomp_min_prefix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> distinct <span class="free">ws</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xs</span> <span class="bound">ys</span> <span class="bound">zs</span> <span class="bound">y</span><span class="main">.</span> <span class="free">ws</span> <span class="main">=</span> <span class="bound">xs</span> <span class="main">@</span> <span class="bound">y</span> <span class="main">#</span> <span class="bound">ys</span> <span class="main">@</span> <span class="bound">y</span> <span class="main">#</span> <span class="bound">zs</span> <span class="main">∧</span> distinct <span class="bound">xs</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∉</span> set <span class="bound">xs</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∉</span> set <span class="bound">ys</span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> set <span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ws</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_distinct_conv_prefix<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs'</span></span> <span class="skolem"><span class="skolem">ys'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">xs'</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_set_conv_decomp<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Stuff-not_distinct_decomp_min_not_distinct"><span class="command">lemma</span></span> not_distinct_decomp_min_not_distinct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> distinct <span class="free">ws</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">xs</span> <span class="bound">y</span> <span class="bound">ys</span> <span class="bound">zs</span><span class="main">.</span> <span class="free">ws</span> <span class="main">=</span> <span class="bound">xs</span> <span class="main">@</span> <span class="bound">y</span> <span class="main">#</span> <span class="bound">ys</span> <span class="main">@</span> <span class="bound">y</span> <span class="main">#</span> <span class="bound">zs</span> <span class="main">∧</span> distinct <span class="main">(</span><span class="bound">ys</span> <span class="main">@</span> <span class="main">[</span><span class="bound">y</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ws</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">w</span> <span class="skolem">ws</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">ws</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∉</span> set <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> split_list_first<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">w</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">@</span> <span class="skolem">w</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="skolem">ws</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="skolem"><span class="skolem">zs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ws</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">zs</span> <span class="main">∧</span> distinct <span class="main">(</span><span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">#</span> <span class="skolem">ws</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">zs</span> <span class="main">∧</span> distinct <span class="main">(</span><span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Stuff-card_Ex_subset"><span class="command">lemma</span></span> card_Ex_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> card <span class="free">M</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="bound">N</span> <span class="main">⊆</span> <span class="free">M</span> <span class="main">∧</span> card <span class="bound">N</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> inc_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_Suc_eq<span class="main">)</span>

<span class="keyword1" id="Stuff-list_set_tl"><span class="command">lemma</span></span> list_set_tl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹NOMATCH simproc›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
 The simplification procedure can be used to avoid simplification of terms of a certain form
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">NOMATCH</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">NOMATCH</span> <span class="free"><span class="bound"><span class="entity">val</span></span></span> <span class="free"><span class="bound"><span class="entity">pat</span></span></span> <span class="main">≡</span> True"</span></span>
<span class="keyword1" id="Stuff-NOMATCH_cong"><span class="command">lemma</span></span> NOMATCH_cong<span class="main">[</span><span class="operator">cong</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"NOMATCH <span class="free">val</span> <span class="free">pat</span> <span class="main">=</span> NOMATCH <span class="free">val</span> <span class="free">pat</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>

<span class="keyword1"><span class="command">simproc_setup</span></span> NOMATCH <span class="main">(</span><span class="quoted"><span class="quoted">"NOMATCH <span class="free">val</span> <span class="free">pat</span>"</span></span><span class="main">)</span> <span class="main">=</span> <span class="quoted">‹<span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ctxt</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ct</span> <span class="main">=&gt;</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thy</span> <span class="main">=</span> Proof_Context.theory_of <span class="entity">ctxt</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">dest_binop</span> <span class="main">=</span> Term.dest_comb #&gt; apfst <span class="main">(</span>Term.dest_comb #&gt; snd<span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">m</span> <span class="main">=</span> Pattern.matches <span class="entity">thy</span> <span class="main">(</span><span class="entity">dest_binop</span> <span class="main">(</span>Thm.term_of <span class="entity">ct</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">in</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">m</span> <span class="keyword2"><span class="keyword">then</span></span> NONE <span class="keyword2"><span class="keyword">else</span></span> SOME <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> NOMATCH_def<span class="antiquote">}</span></span></span> <span class="keyword2"><span class="keyword">end</span></span>
›</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This setup ensures that a rewrite rule of the form <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"NOMATCH <span class="free"><span class="free">val</span></span> <span class="free"><span class="free">pat</span></span> <span class="main"><span class="main">⟹</span></span> <span class="free"><span class="free">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  is only applied, if the pattern <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">pat</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> does not match the value <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">val</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Digraph">
<div class="head">
<h1>Theory Digraph</h1>
</div>
<pre class="source"><span class="comment1">(* Title:  Digraph.thy
   Author: Lars Noschinski, TU München
   Author: René Neumann
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Digraph
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Main.html">Main</a>
  <a href="Rtrancl_On.html">Rtrancl_On</a>
  <a href="Stuff.html">Stuff</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Digraphs›</span></span>

<span class="keyword1"><span class="command">record</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">=</span>
  verts <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  arcs <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> set"</span></span>
  tail <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  head <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">arc_to_ends</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">arc_to_ends</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">≡</span> <span class="main">(</span>tail <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> head <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> pre_digraph <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pre_digraph"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">structure</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> wf_digraph <span class="main">=</span> pre_digraph <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tail_in_verts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> tail <span class="free">G</span> <span class="free">e</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> head_in_verts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> head <span class="free">G</span> <span class="free">e</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Digraph-wf_digraph"><span class="command">lemma</span></span> wf_digraph<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_digraph <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_locales</span>

<span class="keyword1"><span class="command">lemmas</span></span> wellformed <span class="main">=</span> tail_in_verts head_in_verts

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">arcs_ends</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">arcs_ends</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> arc_to_ends <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">`</span> arcs <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">symmetric</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">symmetric</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> sym <span class="main">(</span>arcs_ends <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Matches "pseudo digraphs" from \cite{bangjensen2009digraphs}, except for
  allowing the null graph. For a discussion of that topic,
  see also \cite{harary1974nullgraph}.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> fin_digraph <span class="main">=</span> wf_digraph <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite_verts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> finite_arcs<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>arcs <span class="free">G</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> loopfree_digraph <span class="main">=</span> wf_digraph <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> no_loops<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> tail <span class="free">G</span> <span class="free">e</span> <span class="main">≠</span> head <span class="free">G</span> <span class="free">e</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> nomulti_digraph <span class="main">=</span> wf_digraph <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> no_multi_arcs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">e1</span> <span class="main">∈</span> arcs <span class="free">G</span><span class="main">;</span> <span class="bound">e2</span> <span class="main">∈</span> arcs <span class="free">G</span><span class="main">;</span>
     arc_to_ends <span class="free">G</span> <span class="bound">e1</span> <span class="main">=</span> arc_to_ends <span class="free">G</span> <span class="bound">e2</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">e1</span> <span class="main">=</span> <span class="bound">e2</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> sym_digraph <span class="main">=</span> wf_digraph <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sym_arcs<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"symmetric <span class="free">G</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> digraph <span class="main">=</span> fin_digraph <span class="main">+</span> loopfree_digraph <span class="main">+</span> nomulti_digraph

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We model graphs as symmetric digraphs. This is fine for many purposes,
  but not for all. For example, the path $a,b,a$ is considered to be a cycle
  in a digraph (and hence in a symmetric digraph), but not in an undirected
  graph.
›</span></span>
<span class="keyword1"><span class="command">locale</span></span> pseudo_graph <span class="main">=</span> fin_digraph <span class="main">+</span> sym_digraph

<span class="keyword1"><span class="command">locale</span></span> graph <span class="main">=</span> digraph <span class="main">+</span> pseudo_graph

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> fin_digraphI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>arcs <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fin_digraph <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> sym_digraphI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"symmetric <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sym_digraph <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> digraph<span class="main">)</span> graphI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"symmetric <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"graph <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>



<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> <span class="entity">arc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">arc</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">uv</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">∧</span> tail <span class="free">G</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> fst <span class="free"><span class="bound"><span class="entity">uv</span></span></span> <span class="main">∧</span> head <span class="free">G</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> snd <span class="free"><span class="bound"><span class="entity">uv</span></span></span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> fin_digraph<span class="main">:</span> <span class="quoted"><span class="quoted">"fin_digraph <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> nomulti_digraph<span class="main">)</span> nomulti_digraph<span class="main">:</span> <span class="quoted"><span class="quoted">"nomulti_digraph <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1" id="Digraph-arcs_ends_conv"><span class="command">lemma</span></span> arcs_ends_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"arcs_ends <span class="free">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="main">(</span>tail <span class="free">G</span> <span class="bound">e</span><span class="main">,</span> head <span class="free">G</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> arcs <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_to_ends_def arcs_ends_def<span class="main">)</span>

<span class="keyword1" id="Digraph-symmetric_conv"><span class="command">lemma</span></span> symmetric_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"symmetric <span class="free">G</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e1</span> <span class="main">∈</span> arcs <span class="free">G</span><span class="main">.</span> <span class="main">∃</span><span class="bound">e2</span> <span class="main">∈</span> arcs <span class="free">G</span><span class="main">.</span> tail <span class="free">G</span> <span class="bound">e1</span> <span class="main">=</span> head <span class="free">G</span> <span class="bound">e2</span> <span class="main">∧</span> head <span class="free">G</span> <span class="bound">e1</span> <span class="main">=</span> tail <span class="free">G</span> <span class="bound">e2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symmetric_def arcs_ends_conv sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Digraph-arcs_ends_symmetric"><span class="command">lemma</span></span> arcs_ends_symmetric<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"symmetric <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> arcs_ends <span class="free">G</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">u</span><span class="main">)</span> <span class="main">∈</span> arcs_ends <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> symmetric_def sym_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> nomulti_digraph<span class="main">)</span> inj_on_arc_to_ends<span class="main">:</span>
  <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>arc_to_ends <span class="free">G</span><span class="main">)</span> <span class="main">(</span>arcs <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> no_multi_arcs<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Reachability›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">dominates</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">→</span>ı _"</span> <span class="main">[</span>100<span class="main">,</span>100<span class="main">]</span> 40<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dominates</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">∈</span> arcs_ends <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">reachable1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">→<span class="hidden">⇧</span><sup>+</sup></span>ı _"</span> <span class="main">[</span>100<span class="main">,</span>100<span class="main">]</span> 40<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">reachable1</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>arcs_ends <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">^+</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">reachable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">→<span class="hidden">⇧</span><sup>*</sup></span>ı _"</span> <span class="main">[</span>100<span class="main">,</span>100<span class="main">]</span> 40<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">reachable</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="main">(</span>verts <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">(</span>arcs_ends <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Digraph-reachableE"><span class="command">lemma</span></span> reachableE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">e</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="free">e</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="free">e</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arcs_ends_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loopfree_digraph<span class="main">)</span> adj_not_same<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">→</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reachableE<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> no_loops<span class="main">)</span>

<span class="keyword1" id="Digraph-reachable_in_vertsE"><span class="command">lemma</span></span> reachable_in_vertsE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> reachable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="operator">auto</span>

<span class="keyword1" id="Digraph-symmetric_reachable"><span class="command">lemma</span></span> symmetric_reachable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"symmetric <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span>rtrancl_on <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span> <span class="main">(</span>arcs_ends <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> symmetric_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rtrancl_on_sym<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> reachable_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> symE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digraph-reachable_rtranclI"><span class="command">lemma</span></span> reachable_rtranclI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> </sub><span class="hidden">⇙</span> <span class="free">v</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>arcs_ends <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> reachable_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_on_rtranclI<span class="main">)</span>


<span class="keyword1"><span class="command">context</span></span> wf_digraph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Digraph-adj_in_verts"><span class="command">lemma</span></span> adj_in_verts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> arcs_ends_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Digraph-dominatesI"><span class="command">lemma</span></span> dominatesI<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"arc_to_ends <span class="free">G</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arcs_ends_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>

<span class="keyword1" id="Digraph-reachable_refl"><span class="command">lemma</span></span> reachable_refl <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">,</span> <span class="operator">Pure.intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> reachable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Digraph-adj_reachable_trans"><span class="command">lemma</span></span> adj_reachable_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reachable_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> converse_rtrancl_on_into_rtrancl_on adj_in_verts<span class="main">)</span>

<span class="keyword1" id="Digraph-reachable_adj_trans"><span class="command">lemma</span></span> reachable_adj_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reachable_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_on_into_rtrancl_on adj_in_verts<span class="main">)</span>

<span class="keyword1" id="Digraph-reachable_adjI"><span class="command">lemma</span></span> reachable_adjI <span class="main">[</span><span class="operator">intro</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→</span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> adj_reachable_trans adj_in_verts<span class="main">)</span>

<span class="keyword1" id="Digraph-reachable_trans"><span class="command">lemma</span></span> reachable_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> reachable_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_on_trans<span class="main">)</span>

<span class="keyword1" id="Digraph-reachable_induct"><span class="command">lemma</span></span> reachable_induct<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> base step<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> major<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">u</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">x</span><span class="main">;</span> <span class="bound">x</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">y</span><span class="main">;</span> <span class="free">P</span> <span class="bound">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> reachable_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_on_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Digraph-converse_reachable_induct"><span class="command">lemma</span></span> converse_reachable_induct<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> base step<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword">pred</span></span><span class="main"><span class="main"><span class="main">:</span></span></span> reachable<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> major<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">v</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">y</span><span class="main">;</span> <span class="bound">y</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span><span class="main">;</span> <span class="free">P</span> <span class="bound">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> reachable_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> converse_rtrancl_on_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> converse_reachable_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>base<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
    <span class="main">|</span> <span class="main">(</span>step<span class="main">)</span> <span class="free">w</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> reachable_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_rtrancl_on_cases<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Digraph-reachable_in_verts"><span class="command">lemma</span></span> reachable_in_verts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adj_in_verts<span class="main">)</span>

<span class="keyword1" id="Digraph-reachable1_in_verts"><span class="command">lemma</span></span> reachable1_in_verts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> adj_in_verts<span class="main">)</span>

<span class="keyword1" id="Digraph-reachable1_reachable"><span class="command">lemma</span></span> reachable1_reachable<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">→<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">w</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> reachable_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_consistent_rtrancl_on<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reachable1_in_verts adj_in_verts<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> reachable1_reachableE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span> <span class="main">=</span> reachable1_reachable<span class="main">[</span><span class="operator">elim_format</span><span class="main">]</span>

<span class="keyword1" id="Digraph-reachable_neq_reachable1"><span class="command">lemma</span></span> reachable_neq_reachable1<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> reach<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">→<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> reach <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>arcs_ends <span class="free">G</span><span class="main">)</span><span class="main">^*</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reachable_rtranclI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> neq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rtranclD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> reachable_neq_reachable1E<span class="main">[</span><span class="operator">elim</span><span class="main">]</span> <span class="main">=</span> reachable_neq_reachable1<span class="main">[</span><span class="operator">elim_format</span><span class="main">]</span>

<span class="keyword1" id="Digraph-reachable1_reachable_trans"><span class="command">lemma</span></span> reachable1_reachable_trans <span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">w</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> trancl_trans reachable_neq_reachable1<span class="main">)</span>

<span class="keyword1" id="Digraph-reachable_reachable1_trans"><span class="command">lemma</span></span> reachable_reachable1_trans <span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">→<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">w</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> trancl_trans reachable_neq_reachable1<span class="main">)</span>

<span class="keyword1" id="Digraph-reachable_conv"><span class="command">lemma</span></span> reachable_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>arcs_ends <span class="free">G</span><span class="main">)</span><span class="main">^*</span> <span class="main">∩</span> <span class="main">(</span>verts <span class="free">G</span> <span class="main">×</span> verts <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reachable_in_verts<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtrancl_induct<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Digraph-reachable_conv'"><span class="command">lemma</span></span> reachable_conv'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>arcs_ends <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reachable_conv<span class="main">)</span>


<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> sym_digraph<span class="main">)</span> symmetric_reachable'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sym_arcs assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> symmetric_reachable<span class="main">)</span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Degrees of vertices›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">in_arcs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">in_arcs</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> arcs <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> head <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">e</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">out_arcs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">out_arcs</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> arcs <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> tail <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">e</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">in_degree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">in_degree</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> card <span class="main">(</span>in_arcs <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">out_degree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">out_degree</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> card <span class="main">(</span>out_arcs <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> finite_in_arcs<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>in_arcs <span class="free">G</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> in_arcs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> finite_out_arcs<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>out_arcs <span class="free">G</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> out_arcs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Digraph-in_in_arcs_conv"><span class="command">lemma</span></span> in_in_arcs_conv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> in_arcs <span class="free">G</span> <span class="free">v</span> <span class="main">⟷</span> <span class="free">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">∧</span> head <span class="free">G</span> <span class="free">e</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> in_arcs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Digraph-in_out_arcs_conv"><span class="command">lemma</span></span> in_out_arcs_conv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> out_arcs <span class="free">G</span> <span class="free">v</span> <span class="main">⟷</span> <span class="free">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">∧</span> tail <span class="free">G</span> <span class="free">e</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> out_arcs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Digraph-inout_arcs_arc_simps"><span class="command">lemma</span></span> inout_arcs_arc_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="free">e</span> <span class="main">=</span> <span class="free">u</span> <span class="main">⟹</span> out_arcs <span class="free">G</span> <span class="free">u</span> <span class="main">∩</span> insert <span class="free">e</span> <span class="free">E</span> <span class="main">=</span> insert <span class="free">e</span> <span class="main">(</span>out_arcs <span class="free">G</span> <span class="free">u</span> <span class="main">∩</span> <span class="free">E</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="free">e</span> <span class="main">≠</span> <span class="free">u</span> <span class="main">⟹</span> out_arcs <span class="free">G</span> <span class="free">u</span> <span class="main">∩</span> insert <span class="free">e</span> <span class="free">E</span> <span class="main">=</span> out_arcs <span class="free">G</span> <span class="free">u</span> <span class="main">∩</span> <span class="free">E</span>"</span></span>
        <span class="quoted"><span class="quoted">"out_arcs <span class="free">G</span> <span class="free">u</span> <span class="main">∩</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="comment1">(* XXX: should be unnecessary *)</span>
        <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="free">e</span> <span class="main">=</span> <span class="free">u</span> <span class="main">⟹</span> in_arcs <span class="free">G</span> <span class="free">u</span> <span class="main">∩</span> insert <span class="free">e</span> <span class="free">E</span> <span class="main">=</span> insert <span class="free">e</span> <span class="main">(</span>in_arcs <span class="free">G</span> <span class="free">u</span> <span class="main">∩</span> <span class="free">E</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="free">e</span> <span class="main">≠</span> <span class="free">u</span> <span class="main">⟹</span> in_arcs <span class="free">G</span> <span class="free">u</span> <span class="main">∩</span> insert <span class="free">e</span> <span class="free">E</span> <span class="main">=</span> in_arcs <span class="free">G</span> <span class="free">u</span> <span class="main">∩</span> <span class="free">E</span>"</span></span>
        <span class="quoted"><span class="quoted">"in_arcs <span class="free">G</span> <span class="free">u</span> <span class="main">∩</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="comment1">(* XXX: should be unnecessary *)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Digraph-in_arcs_int_arcs"><span class="command">lemma</span></span> in_arcs_int_arcs<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"in_arcs <span class="free">G</span> <span class="free">u</span> <span class="main">∩</span> arcs <span class="free">G</span> <span class="main">=</span> in_arcs <span class="free">G</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      out_arcs_int_arcs<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"out_arcs <span class="free">G</span> <span class="free">u</span> <span class="main">∩</span> arcs <span class="free">G</span> <span class="main">=</span> out_arcs <span class="free">G</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Digraph-in_arcs_in_arcs"><span class="command">lemma</span></span> in_arcs_in_arcs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> in_arcs <span class="free">G</span> <span class="free">u</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> out_arcs_in_arcs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> out_arcs <span class="free">G</span> <span class="free">u</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_arcs_def out_arcs_def<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Graph operations›</span></span>

<span class="keyword1"><span class="command">context</span></span> pre_digraph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">add_arc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span>  <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">add_arc</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">⦇</span> verts <span class="main">=</span> verts <span class="free">G</span> <span class="main">∪</span> <span class="main">{</span>tail <span class="free">G</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> head <span class="free">G</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">}</span><span class="main">,</span> arcs <span class="main">=</span> insert <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>arcs <span class="free">G</span><span class="main">)</span><span class="main">,</span> tail <span class="main">=</span> tail <span class="free">G</span><span class="main">,</span> head <span class="main">=</span> head <span class="free">G</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>  <span class="entity">del_arc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">del_arc</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">⦇</span> verts <span class="main">=</span> verts <span class="free">G</span><span class="main">,</span> arcs <span class="main">=</span> arcs <span class="free">G</span> <span class="main">-</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">}</span><span class="main">,</span> tail <span class="main">=</span> tail <span class="free">G</span><span class="main">,</span> head <span class="main">=</span> head <span class="free">G</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">add_vert</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span>  <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">add_vert</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">⦇</span> verts <span class="main">=</span> insert <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span><span class="main">,</span> arcs <span class="main">=</span> arcs <span class="free">G</span><span class="main">,</span> tail <span class="main">=</span> tail <span class="free">G</span><span class="main">,</span> head <span class="main">=</span> head <span class="free">G</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">del_vert</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span>  <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">del_vert</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">⦇</span> verts <span class="main">=</span> verts <span class="free">G</span> <span class="main">-</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span><span class="main">,</span> arcs <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> arcs <span class="free">G</span><span class="main">.</span> tail <span class="free">G</span> <span class="bound">a</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∧</span> head <span class="free">G</span> <span class="bound">a</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span><span class="main">,</span> tail <span class="main">=</span> tail <span class="free">G</span><span class="main">,</span> head <span class="main">=</span> head <span class="free">G</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1" id="Digraph-verts_add_arc"><span class="command">lemma</span></span>
  verts_add_arc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> tail <span class="free">G</span> <span class="free">a</span> <span class="main">∈</span> verts <span class="free">G</span><span class="main">;</span> head <span class="free">G</span> <span class="free">a</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> verts <span class="main">(</span>add_arc <span class="free">a</span><span class="main">)</span> <span class="main">=</span> verts <span class="free">G</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
  verts_add_arc_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"verts <span class="main">(</span>add_arc <span class="free">a</span><span class="main">)</span> <span class="main">=</span> verts <span class="free">G</span> <span class="main">∪</span> <span class="main">{</span>tail <span class="free">G</span> <span class="free">a</span><span class="main">,</span> head <span class="free">G</span> <span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  arcs_add_arc<span class="main">:</span> <span class="quoted"><span class="quoted">"arcs <span class="main">(</span>add_arc <span class="free">a</span><span class="main">)</span> <span class="main">=</span> insert <span class="free">a</span> <span class="main">(</span>arcs <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  tail_add_arc<span class="main">:</span> <span class="quoted"><span class="quoted">"tail <span class="main">(</span>add_arc <span class="free">a</span><span class="main">)</span> <span class="main">=</span> tail <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  head_add_arc<span class="main">:</span> <span class="quoted"><span class="quoted">"head <span class="main">(</span>add_arc <span class="free">a</span><span class="main">)</span> <span class="main">=</span> head <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_arc_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> add_arc_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> verts_add_arc arcs_add_arc tail_add_arc head_add_arc

<span class="keyword1" id="Digraph-verts_del_arc"><span class="command">lemma</span></span>
  verts_del_arc<span class="main">:</span> <span class="quoted"><span class="quoted">"verts <span class="main">(</span>del_arc <span class="free">a</span><span class="main">)</span> <span class="main">=</span> verts <span class="free">G</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
  arcs_del_arc<span class="main">:</span> <span class="quoted"><span class="quoted">"arcs <span class="main">(</span>del_arc <span class="free">a</span><span class="main">)</span> <span class="main">=</span> arcs <span class="free">G</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  tail_del_arc<span class="main">:</span> <span class="quoted"><span class="quoted">"tail <span class="main">(</span>del_arc <span class="free">a</span><span class="main">)</span> <span class="main">=</span> tail <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  head_del_arc<span class="main">:</span> <span class="quoted"><span class="quoted">"head <span class="main">(</span>del_arc <span class="free">a</span><span class="main">)</span> <span class="main">=</span> head <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> del_arc_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> del_arc_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> verts_del_arc arcs_del_arc tail_del_arc head_del_arc

<span class="keyword1" id="Digraph-verts_add_vert"><span class="command">lemma</span></span>
    verts_add_vert<span class="main">:</span> <span class="quoted"><span class="quoted">"verts <span class="main">(</span>pre_digraph.add_vert <span class="free">G</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> insert <span class="free">u</span> <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    arcs_add_vert<span class="main">:</span> <span class="quoted"><span class="quoted">"arcs <span class="main">(</span>pre_digraph.add_vert <span class="free">G</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> arcs <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    tail_add_vert<span class="main">:</span> <span class="quoted"><span class="quoted">"tail <span class="main">(</span>pre_digraph.add_vert <span class="free">G</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> tail <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    head_add_vert<span class="main">:</span> <span class="quoted"><span class="quoted">"head <span class="main">(</span>pre_digraph.add_vert <span class="free">G</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> head <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.add_vert_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> add_vert_simps <span class="main">=</span> verts_add_vert arcs_add_vert tail_add_vert head_add_vert

<span class="keyword1" id="Digraph-verts_del_vert"><span class="command">lemma</span></span>
    verts_del_vert<span class="main">:</span> <span class="quoted"><span class="quoted">"verts <span class="main">(</span>pre_digraph.del_vert <span class="free">G</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> verts <span class="free">G</span> <span class="main">-</span> <span class="main">{</span><span class="free">u</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    arcs_del_vert<span class="main">:</span> <span class="quoted"><span class="quoted">"arcs <span class="main">(</span>pre_digraph.del_vert <span class="free">G</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">a</span></span> <span class="main">∈</span> arcs <span class="free">G</span><span class="main">.</span> tail <span class="free">G</span> <span class="bound">a</span> <span class="main">≠</span> <span class="free">u</span> <span class="main">∧</span> head <span class="free">G</span> <span class="bound">a</span> <span class="main">≠</span> <span class="free">u</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    tail_del_vert<span class="main">:</span> <span class="quoted"><span class="quoted">"tail <span class="main">(</span>pre_digraph.del_vert <span class="free">G</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> tail <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    head_del_vert<span class="main">:</span> <span class="quoted"><span class="quoted">"head <span class="main">(</span>pre_digraph.del_vert <span class="free">G</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> head <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    ends_del_vert<span class="main">:</span> <span class="quoted"><span class="quoted">"arc_to_ends <span class="main">(</span>pre_digraph.del_vert <span class="free">G</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> arc_to_ends <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.del_vert_def arc_to_ends_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> del_vert_simps <span class="main">=</span> verts_del_vert arcs_del_vert tail_del_vert head_del_vert

<span class="keyword1" id="Digraph-add_add_arc_collapse"><span class="command">lemma</span></span> add_add_arc_collapse<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pre_digraph.add_arc <span class="main">(</span>add_arc <span class="free">a</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> add_arc <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.add_arc_def<span class="main">)</span>

<span class="keyword1" id="Digraph-add_del_arc_collapse"><span class="command">lemma</span></span> add_del_arc_collapse<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pre_digraph.add_arc <span class="main">(</span>del_arc <span class="free">a</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> add_arc <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.verts_add_arc_conv pre_digraph.add_arc_simps<span class="main">)</span>

<span class="keyword1" id="Digraph-del_add_arc_collapse"><span class="command">lemma</span></span> del_add_arc_collapse<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> tail <span class="free">G</span> <span class="free">a</span> <span class="main">∈</span> verts <span class="free">G</span><span class="main">;</span> head <span class="free">G</span> <span class="free">a</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> pre_digraph.del_arc <span class="main">(</span>add_arc <span class="free">a</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> del_arc <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.add_arc_simps pre_digraph.del_arc_simps<span class="main">)</span>

<span class="keyword1" id="Digraph-del_del_arc_collapse"><span class="command">lemma</span></span> del_del_arc_collapse<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pre_digraph.del_arc <span class="main">(</span>del_arc <span class="free">a</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> del_arc <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.add_arc_simps pre_digraph.del_arc_simps<span class="main">)</span>

<span class="keyword1" id="Digraph-add_arc_commute"><span class="command">lemma</span></span> add_arc_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"pre_digraph.add_arc <span class="main">(</span>add_arc <span class="free">b</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> pre_digraph.add_arc <span class="main">(</span>add_arc <span class="free">a</span><span class="main">)</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.add_arc_def<span class="main">)</span>

<span class="keyword1" id="Digraph-del_arc_commute"><span class="command">lemma</span></span> del_arc_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"pre_digraph.del_arc <span class="main">(</span>del_arc <span class="free">b</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> pre_digraph.del_arc <span class="main">(</span>del_arc <span class="free">a</span><span class="main">)</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.del_arc_def<span class="main">)</span>

<span class="keyword1" id="Digraph-del_arc_in"><span class="command">lemma</span></span> del_arc_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> arcs <span class="free">G</span> <span class="main">⟹</span> del_arc <span class="free">a</span> <span class="main">=</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pre_digraph.equality<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_arc_def<span class="main">)</span>

<span class="keyword1" id="Digraph-in_arcs_add_arc_iff"><span class="command">lemma</span></span> in_arcs_add_arc_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"in_arcs <span class="main">(</span>add_arc <span class="free">a</span><span class="main">)</span> <span class="free">u</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> head <span class="free">G</span> <span class="free">a</span> <span class="main">=</span> <span class="free">u</span> <span class="keyword1">then</span> insert <span class="free">a</span> <span class="main">(</span>in_arcs <span class="free">G</span> <span class="free">u</span><span class="main">)</span> <span class="keyword1">else</span> in_arcs <span class="free">G</span> <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Digraph-out_arcs_add_arc_iff"><span class="command">lemma</span></span> out_arcs_add_arc_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"out_arcs <span class="main">(</span>add_arc <span class="free">a</span><span class="main">)</span> <span class="free">u</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> tail <span class="free">G</span> <span class="free">a</span> <span class="main">=</span> <span class="free">u</span> <span class="keyword1">then</span> insert <span class="free">a</span> <span class="main">(</span>out_arcs <span class="free">G</span> <span class="free">u</span><span class="main">)</span> <span class="keyword1">else</span> out_arcs <span class="free">G</span> <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Digraph-in_arcs_del_arc_iff"><span class="command">lemma</span></span> in_arcs_del_arc_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"in_arcs <span class="main">(</span>del_arc <span class="free">a</span><span class="main">)</span> <span class="free">u</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> head <span class="free">G</span> <span class="free">a</span> <span class="main">=</span> <span class="free">u</span> <span class="keyword1">then</span> in_arcs <span class="free">G</span> <span class="free">u</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="keyword1">else</span> in_arcs <span class="free">G</span> <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Digraph-out_arcs_del_arc_iff"><span class="command">lemma</span></span> out_arcs_del_arc_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"out_arcs <span class="main">(</span>del_arc <span class="free">a</span><span class="main">)</span> <span class="free">u</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> tail <span class="free">G</span> <span class="free">a</span> <span class="main">=</span> <span class="free">u</span> <span class="keyword1">then</span> out_arcs <span class="free">G</span> <span class="free">u</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="keyword1">else</span> out_arcs <span class="free">G</span> <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> add_arc_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> add_arc <span class="free">a</span> <span class="main">=</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pre_digraph.equality<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_arc_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">context</span></span> wf_digraph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Digraph-wf_digraph_add_arc"><span class="command">lemma</span></span> wf_digraph_add_arc<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"wf_digraph <span class="main">(</span>add_arc <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> verts_add_arc_conv<span class="main">)</span>

<span class="keyword1" id="Digraph-wf_digraph_del_arc"><span class="command">lemma</span></span> wf_digraph_del_arc<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"wf_digraph <span class="main">(</span>del_arc <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> verts_add_arc_conv<span class="main">)</span>

<span class="keyword1" id="Digraph-wf_digraph_del_vert"><span class="command">lemma</span></span> wf_digraph_del_vert<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_digraph <span class="main">(</span>del_vert <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> del_vert_simps<span class="main">)</span>

<span class="keyword1" id="Digraph-wf_digraph_add_vert"><span class="command">lemma</span></span> wf_digraph_add_vert<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_digraph <span class="main">(</span>add_vert <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_vert_simps<span class="main">)</span>

<span class="keyword1" id="Digraph-del_vert_add_vert"><span class="command">lemma</span></span> del_vert_add_vert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∉</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pre_digraph.del_vert <span class="main">(</span>add_vert <span class="free">u</span><span class="main">)</span> <span class="free">u</span> <span class="main">=</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> pre_digraph.equality<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.del_vert_def add_vert_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">context</span></span> fin_digraph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Digraph-in_degree_add_arc_iff"><span class="command">lemma</span></span> in_degree_add_arc_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"in_degree <span class="main">(</span>add_arc <span class="free">a</span><span class="main">)</span> <span class="free">u</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> head <span class="free">G</span> <span class="free">a</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∉</span> arcs <span class="free">G</span> <span class="keyword1">then</span> in_degree <span class="free">G</span> <span class="free">u</span> <span class="main">+</span> <span class="main">1</span> <span class="keyword1">else</span> in_degree <span class="free">G</span> <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> arcs <span class="free">G</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∉</span> in_arcs <span class="free">G</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_arcs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> finite_in_arcs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> in_degree_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_arcs_add_arc_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">card</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digraph-out_degree_add_arc_iff"><span class="command">lemma</span></span> out_degree_add_arc_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"out_degree <span class="main">(</span>add_arc <span class="free">a</span><span class="main">)</span> <span class="free">u</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> tail <span class="free">G</span> <span class="free">a</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∉</span> arcs <span class="free">G</span> <span class="keyword1">then</span> out_degree <span class="free">G</span> <span class="free">u</span> <span class="main">+</span> <span class="main">1</span> <span class="keyword1">else</span> out_degree <span class="free">G</span> <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> arcs <span class="free">G</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∉</span> out_arcs <span class="free">G</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> out_arcs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> finite_out_arcs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> out_degree_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> out_arcs_add_arc_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">card</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digraph-in_degree_del_arc_iff"><span class="command">lemma</span></span> in_degree_del_arc_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"in_degree <span class="main">(</span>del_arc <span class="free">a</span><span class="main">)</span> <span class="free">u</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> head <span class="free">G</span> <span class="free">a</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="keyword1">then</span> in_degree <span class="free">G</span> <span class="free">u</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">else</span> in_degree <span class="free">G</span> <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> arcs <span class="free">G</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∉</span> in_arcs <span class="free">G</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_arcs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> finite_in_arcs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> in_degree_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_arcs_del_arc_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">card</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digraph-out_degree_del_arc_iff"><span class="command">lemma</span></span> out_degree_del_arc_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"out_degree <span class="main">(</span>del_arc <span class="free">a</span><span class="main">)</span> <span class="free">u</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> tail <span class="free">G</span> <span class="free">a</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="keyword1">then</span> out_degree <span class="free">G</span> <span class="free">u</span> <span class="main">-</span> <span class="main">1</span> <span class="keyword1">else</span> out_degree <span class="free">G</span> <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> arcs <span class="free">G</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∉</span> out_arcs <span class="free">G</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> out_arcs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> finite_out_arcs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> out_degree_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> out_arcs_del_arc_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">card</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digraph-fin_digraph_del_vert"><span class="command">lemma</span></span> fin_digraph_del_vert<span class="main">:</span> <span class="quoted"><span class="quoted">"fin_digraph <span class="main">(</span>del_vert <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> del_vert_simps<span class="main">)</span>

<span class="keyword1" id="Digraph-fin_digraph_del_arc"><span class="command">lemma</span></span> fin_digraph_del_arc<span class="main">:</span> <span class="quoted"><span class="quoted">"fin_digraph <span class="main">(</span>del_arc <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> del_vert_simps<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Bidirected_Digraph">
<div class="head">
<h1>Theory Bidirected_Digraph</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Bidirected_Digraph
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Digraph.html">Digraph</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Permutations.html">HOL-Library.Permutations</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Bidirected Graphs›</span></span>

<span class="keyword1"><span class="command">locale</span></span> bidirected_digraph <span class="main">=</span> wf_digraph <span class="quoted"><span class="free">G</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">G</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">arev</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> arev_dom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟷</span> <span class="free">arev</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> arev_arev_raw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> <span class="free">arev</span> <span class="main">(</span><span class="free">arev</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tail_arev<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> tail <span class="free">G</span> <span class="main">(</span><span class="free">arev</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> head <span class="free">G</span> <span class="bound">a</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> bidirected_digraphI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> arev_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∉</span> arcs <span class="free">G</span> <span class="main">⟹</span> <span class="free">arev</span> <span class="bound">a</span> <span class="main">=</span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> arev_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> <span class="free">arev</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> arev_arev_raw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> <span class="free">arev</span> <span class="main">(</span><span class="free">arev</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tail_arev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> tail <span class="free">G</span> <span class="main">(</span><span class="free">arev</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> head <span class="free">G</span> <span class="bound">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bidirected_digraph <span class="free">G</span> <span class="free">arev</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_def<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> bidirected_digraph <span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1" id="Bidirected_Digraph-bidirected_digraph"><span class="command">lemma</span></span> bidirected_digraph<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"bidirected_digraph <span class="free">G</span> <span class="free">arev</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

  <span class="keyword1" id="Bidirected_Digraph-arev_arev"><span class="command">lemma</span></span> arev_arev<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">arev</span> <span class="main">(</span><span class="free">arev</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> arev_dom <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arev_arev_raw<span class="main">)</span>

  <span class="keyword1" id="Bidirected_Digraph-arev_o_arev"><span class="command">lemma</span></span> arev_o_arev<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">arev</span> <span class="keyword1">o</span> <span class="free">arev</span> <span class="main">=</span> id"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>

  <span class="keyword1" id="Bidirected_Digraph-arev_eq"><span class="command">lemma</span></span> arev_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> arcs <span class="free">G</span> <span class="main">⟹</span> <span class="free">arev</span> <span class="free">a</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arev_dom<span class="main">)</span>

  <span class="keyword1" id="Bidirected_Digraph-arev_neq"><span class="command">lemma</span></span> arev_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> <span class="free">arev</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arev_dom<span class="main">)</span>

  <span class="keyword1" id="Bidirected_Digraph-arev_in_arcs"><span class="command">lemma</span></span> arev_in_arcs<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> <span class="free">arev</span> <span class="free">a</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> arev_arev arev_dom<span class="main">)</span>

  <span class="keyword1" id="Bidirected_Digraph-head_arev"><span class="command">lemma</span></span> head_arev<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="main">(</span><span class="free">arev</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> tail <span class="free">G</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="main">(</span><span class="free">arev</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> tail <span class="free">G</span> <span class="main">(</span><span class="free">arev</span> <span class="main">(</span><span class="free">arev</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> tail_arev arev_in_arcs<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Bidirected_Digraph-ate_arev"><span class="command">lemma</span></span> ate_arev<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"arc_to_ends <span class="free">G</span> <span class="main">(</span><span class="free">arev</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> prod.swap <span class="main">(</span>arc_to_ends <span class="free">G</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_to_ends_def<span class="main">)</span>

  <span class="keyword1" id="Bidirected_Digraph-bij_arev"><span class="command">lemma</span></span> bij_arev<span class="main">:</span> <span class="quoted"><span class="quoted">"bij <span class="free">arev</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> arev_arev <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_imageI inj_on_inverseI surjI<span class="main">)</span>

  <span class="keyword1" id="Bidirected_Digraph-arev_permutes_arcs"><span class="command">lemma</span></span> arev_permutes_arcs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">arev</span> <span class="keyword1">permutes</span> arcs <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> arev_dom bij_arev <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_def bij_iff<span class="main">)</span>

  <span class="keyword1" id="Bidirected_Digraph-arev_eq_iff"><span class="command">lemma</span></span> arev_eq_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">arev</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">arev</span> <span class="bound">y</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> arev_arev<span class="main">)</span>

  <span class="keyword1" id="Bidirected_Digraph-in_arcs_eq"><span class="command">lemma</span></span> in_arcs_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"in_arcs <span class="free">G</span> <span class="free">w</span> <span class="main">=</span> <span class="free">arev</span> <span class="main">`</span> out_arcs <span class="free">G</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> arev_arev arev_in_arcs image_eqI in_out_arcs_conv tail_arev<span class="main">)</span>

  <span class="keyword1" id="Bidirected_Digraph-inj_on_arev"><span class="command">lemma</span></span> inj_on_arev<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="free">arev</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> arev_arev inj_on_inverseI<span class="main">)</span>

  <span class="keyword1" id="Bidirected_Digraph-even_card_loops"><span class="command">lemma</span></span> even_card_loops<span class="main">:</span>
    <span class="quoted"><span class="quoted">"even <span class="main">(</span>card <span class="main">(</span>in_arcs <span class="free">G</span> <span class="free">w</span> <span class="main">∩</span> out_arcs <span class="free">G</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"even <span class="main">(</span>card <span class="var">?S</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="var">?S</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="var">?S</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?S</span> <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span><span class="main">{</span><span class="main">{</span><span class="bound">a</span><span class="main">,</span><span class="free">arev</span> <span class="bound">a</span><span class="main">}</span> <span class="main">|</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="var">?S</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> card <span class="main">(</span><span class="main">⋃</span> <span class="var">?T</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">card</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="free">arev</span> <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem">x</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span><span class="main">=</span> sum card <span class="var">?T</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> card_Union_disjoint<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span><span class="main">∈</span><span class="main">{</span><span class="main">{</span><span class="bound">a</span><span class="main">,</span> <span class="free">arev</span> <span class="bound">a</span><span class="main">}</span> <span class="main">|</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="var">?S</span><span class="main">}</span> <span class="main">⟹</span> finite <span class="bound">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pairwise disjnt <span class="main">{</span><span class="main">{</span><span class="bound">a</span><span class="main">,</span> <span class="free">arev</span> <span class="bound">a</span><span class="main">}</span> <span class="main">|</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> in_arcs <span class="free">G</span> <span class="free">w</span> <span class="main">∩</span> out_arcs <span class="free">G</span> <span class="free">w</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> pairwise_def disjnt_def
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">safe</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arev_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="numeral">2</span><span class="main">)</span> <span class="var">?T</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sum.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_insert_if <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> arev_neq<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> card <span class="var">?T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(*XXX*)</span>
<span class="keyword1"><span class="command">sublocale</span></span> bidirected_digraph <span class="main">⊆</span> sym_digraph
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> symmetric_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> symI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"arc_to_ends <span class="free">G</span> <span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arcs_ends_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">arev</span> <span class="skolem">a</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"arc_to_ends <span class="free">G</span> <span class="main">(</span><span class="free">arev</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_to_ends_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arcs_ends_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Arc_Walk">
<div class="head">
<h1>Theory Arc_Walk</h1>
</div>
<pre class="source"><span class="comment1">(* Title:  Arc_Walk.thy
   Author: Lars Noschinski, TU München
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Arc_Walk
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Digraph.html">Digraph</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Arc Walks›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We represent a walk in a graph by the list of its arcs.
›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'b</span> awalk <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> list"</span></span>

<span class="keyword1"><span class="command">context</span></span> pre_digraph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The list of vertices of a walk. The additional vertex
  argument is there to deal with the case of empty walks.
›</span></span>
<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">awalk_verts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> awalk <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">awalk_verts</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">]</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">awalk_verts</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span> <span class="main">=</span> tail <span class="free">G</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">#</span> <span class="free">awalk_verts</span> <span class="main">(</span>head <span class="free">G</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">awhd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> awalk <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">awhd</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> hd <span class="main">(</span>awalk_verts <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">awlast</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> awalk <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">awlast</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> last <span class="main">(</span>awalk_verts <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Tests whether a list of arcs is a consistent arc sequence,
  i.e. a list of arcs, where the head G node of each arc is
  the tail G node of the following arc.
›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">cas</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> awalk <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cas</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">cas</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span>tail <span class="free">G</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∧</span> <span class="free">cas</span> <span class="main">(</span>head <span class="free">G</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Arc_Walk-cas_simp"><span class="command">lemma</span></span> cas_simp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">es</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="free">es</span> <span class="free">v</span> <span class="main">⟷</span> tail <span class="free">G</span> <span class="main">(</span>hd <span class="free">es</span><span class="main">)</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∧</span> cas <span class="main">(</span>head <span class="free">G</span> <span class="main">(</span>hd <span class="free">es</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>tl <span class="free">es</span><span class="main">)</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">es</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">awalk</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> awalk <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">awalk</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">∧</span> set <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⊆</span> arcs <span class="free">G</span> <span class="main">∧</span> cas <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>

<span class="comment1">(* XXX: rename to atrail? *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> <span class="entity">trail</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> awalk <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">trail</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> awalk <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∧</span> distinct <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">apath</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span><span class="tfree">'b</span> awalk <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">apath</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> awalk <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∧</span> distinct <span class="main">(</span>awalk_verts <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Lemmas›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> awalk_verts_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"awalk_verts <span class="free">u</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">u</span><span class="main">]</span> <span class="keyword1">else</span> map <span class="main">(</span>tail <span class="free">G</span><span class="main">)</span> <span class="free">p</span> <span class="main">@</span> <span class="main">[</span>head <span class="free">G</span> <span class="main">(</span>last <span class="free">p</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> awalk_verts_conv'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"awalk_verts <span class="free">u</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">p</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="main">[</span><span class="free">u</span><span class="main">]</span> <span class="keyword1">else</span> tail <span class="free">G</span> <span class="main">(</span>hd <span class="free">p</span><span class="main">)</span> <span class="main">#</span> map <span class="main">(</span>head <span class="free">G</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> cas.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cas_simp<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> length_awalk_verts<span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> awalk_verts_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> awalk_verts_ne_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"awalk_verts <span class="free">u</span> <span class="free">p</span> <span class="main">=</span> awalk_verts <span class="free">v</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_verts_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> awalk_verts_non_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"awalk_verts <span class="free">u</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> awalk_verts_conv<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> wf_digraph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> awhd_if_cas<span class="main">:</span> <span class="quoted"><span class="quoted">"awhd <span class="free">u</span> <span class="free">p</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> awlast_if_cas<span class="main">:</span> <span class="quoted"><span class="quoted">"awlast <span class="free">u</span> <span class="free">p</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Arc_Walk-awalk_verts_in_verts"><span class="command">lemma</span></span> awalk_verts_in_verts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">⊆</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wellformed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">⊆</span> arcs <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> awhd_in_verts<span class="main">:</span> <span class="quoted"><span class="quoted">"awhd <span class="free">u</span> <span class="free">p</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> awlast_in_verts<span class="main">:</span> <span class="quoted"><span class="quoted">"awlast <span class="free">u</span> <span class="free">p</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> awalk_verts_in_verts<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-awalk_conv"><span class="command">lemma</span></span> awalk_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span>set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> verts <span class="free">G</span>
    <span class="main">∧</span> set <span class="free">p</span> <span class="main">⊆</span> arcs <span class="free">G</span>
    <span class="main">∧</span> awhd <span class="free">u</span> <span class="free">p</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∧</span> awlast <span class="free">u</span> <span class="free">p</span> <span class="main">=</span> <span class="free">v</span> <span class="main">∧</span> cas <span class="free">u</span> <span class="free">p</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> awalk_def <span class="keyword1"><span class="command">using</span></span> hd_in_set<span class="main">[</span><span class="operator">OF</span> awalk_verts_non_Nil<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> awalk_verts_in_verts awhd_if_cas awlast_if_cas <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> hd_in_set<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-awalkI"><span class="command">lemma</span></span> awalkI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">⊆</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_conv awhd_if_cas awlast_if_cas<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-awalkE"><span class="command">lemma</span></span> awalkE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">⊆</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
    <span class="quoted"><span class="quoted">"awhd <span class="free">u</span> <span class="free">p</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"awlast <span class="free">u</span> <span class="free">p</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> awalk_conv<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-awalk_Nil_iff"><span class="command">lemma</span></span> awalk_Nil_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="main">[]</span> <span class="free">v</span> <span class="main">⟷</span> <span class="free">u</span> <span class="main">=</span> <span class="free">v</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> awalk_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Arc_Walk-trail_Nil_iff"><span class="command">lemma</span></span> trail_Nil_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"trail <span class="free">u</span> <span class="main">[]</span> <span class="free">v</span> <span class="main">⟷</span> <span class="free">u</span> <span class="main">=</span> <span class="free">v</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trail_def awalk_Nil_iff<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-apath_Nil_iff"><span class="command">lemma</span></span> apath_Nil_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="main">[]</span> <span class="free">v</span> <span class="main">⟷</span> <span class="free">u</span> <span class="main">=</span> <span class="free">v</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def awalk_Nil_iff<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-awalk_hd_in_verts"><span class="command">lemma</span></span> awalk_hd_in_verts<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Arc_Walk-awalk_last_in_verts"><span class="command">lemma</span></span> awalk_last_in_verts<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> awalk_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Arc_Walk-hd_in_awalk_verts"><span class="command">lemma</span></span> hd_in_awalk_verts<span class="main">:</span>
  <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-awalk_Cons_iff"><span class="command">lemma</span></span> awalk_Cons_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="main">(</span><span class="free">e</span> <span class="main">#</span> <span class="free">es</span><span class="main">)</span> <span class="free">w</span> <span class="main">⟷</span> <span class="free">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">=</span> tail <span class="free">G</span> <span class="free">e</span> <span class="main">∧</span> awalk <span class="main">(</span>head <span class="free">G</span> <span class="free">e</span><span class="main">)</span> <span class="free">es</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_def<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-trail_Cons_iff"><span class="command">lemma</span></span> trail_Cons_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"trail <span class="free">u</span> <span class="main">(</span><span class="free">e</span> <span class="main">#</span> <span class="free">es</span> <span class="main">)</span> <span class="free">w</span> <span class="main">⟷</span> <span class="free">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">=</span> tail <span class="free">G</span> <span class="free">e</span> <span class="main">∧</span> <span class="free">e</span> <span class="main">∉</span> set <span class="free">es</span> <span class="main">∧</span> trail <span class="main">(</span>head <span class="free">G</span> <span class="free">e</span><span class="main">)</span> <span class="free">es</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trail_def awalk_Cons_iff<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-apath_Cons_iff"><span class="command">lemma</span></span> apath_Cons_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="main">(</span><span class="free">e</span> <span class="main">#</span> <span class="free">es</span><span class="main">)</span> <span class="free">w</span> <span class="main">⟷</span> <span class="free">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">∧</span> tail <span class="free">G</span> <span class="free">e</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∧</span> apath <span class="main">(</span>head <span class="free">G</span> <span class="free">e</span><span class="main">)</span> <span class="free">es</span> <span class="free">w</span>
    <span class="main">∧</span> tail <span class="free">G</span> <span class="free">e</span> <span class="main">∉</span> set <span class="main">(</span>awalk_verts <span class="main">(</span>head <span class="free">G</span> <span class="free">e</span><span class="main">)</span> <span class="free">es</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def awalk_Cons_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> awalk_simps <span class="main">=</span> awalk_Nil_iff awalk_Cons_iff
<span class="keyword1"><span class="command">lemmas</span></span> trail_simps <span class="main">=</span> trail_Nil_iff trail_Cons_iff
<span class="keyword1"><span class="command">lemmas</span></span> apath_simps <span class="main">=</span> apath_Nil_iff apath_Cons_iff

<span class="keyword1" id="Arc_Walk-arc_implies_awalk"><span class="command">lemma</span></span> arc_implies_awalk<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> awalk <span class="main">(</span>tail <span class="free">G</span> <span class="free">e</span><span class="main">)</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="main">(</span>head <span class="free">G</span> <span class="free">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> awalk_simps<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-apath_nonempty_ends"><span class="command">lemma</span></span> apath_nonempty_ends<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">e</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apath <span class="main">(</span>head <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="skolem">es</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> set <span class="main">(</span>awalk_verts <span class="main">(</span>head <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="skolem">es</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_Cons_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="main">(</span>head <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="skolem">es</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>



<span class="comment1">(* replace by awalk_Cons_iff?*)</span>
<span class="keyword1" id="Arc_Walk-awalk_ConsI"><span class="command">lemma</span></span> awalk_ConsI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">v</span> <span class="free">es</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arc_to_ends <span class="free">G</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="main">(</span><span class="free">e</span> <span class="main">#</span> <span class="free">es</span><span class="main">)</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">es</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_def arc_to_ends_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> awalkI_apath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apath_def<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-arcE"><span class="command">lemma</span></span> arcE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">e</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">e</span> <span class="main">∈</span> arcs <span class="free">G</span><span class="main">;</span> tail <span class="free">G</span> <span class="free">e</span> <span class="main">=</span> <span class="free">u</span><span class="main">;</span> head <span class="free">G</span> <span class="free">e</span> <span class="main">=</span> <span class="free">v</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_def<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-in_arcs_imp_in_arcs_ends"><span class="command">lemma</span></span> in_arcs_imp_in_arcs_ends<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tail <span class="free">G</span> <span class="free">e</span><span class="main">,</span> head <span class="free">G</span> <span class="free">e</span><span class="main">)</span> <span class="main">∈</span> arcs_ends <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arcs_ends_conv<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-set_awalk_verts_cas"><span class="command">lemma</span></span> set_awalk_verts_cas<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">u</span><span class="main">}</span> <span class="main">∪</span> set <span class="main">(</span>map <span class="main">(</span>tail <span class="free">G</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>map <span class="main">(</span>head <span class="free">G</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">e</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="main">(</span>head <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="skolem">es</span><span class="main">)</span>
      <span class="main">=</span> <span class="main">{</span>head <span class="free">G</span> <span class="skolem">e</span><span class="main">}</span> <span class="main">∪</span> set <span class="main">(</span>map <span class="main">(</span>tail <span class="free">G</span><span class="main">)</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>map <span class="main">(</span>head <span class="free">G</span><span class="main">)</span> <span class="skolem">es</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_Cons_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Cons.prems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arc_Walk-set_awalk_verts_not_Nil_cas"><span class="command">lemma</span></span> set_awalk_verts_not_Nil_cas<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>map <span class="main">(</span>tail <span class="free">G</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>map <span class="main">(</span>head <span class="free">G</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="main">(</span>tail <span class="free">G</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_awalk_verts_cas<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arc_Walk-set_awalk_verts"><span class="command">lemma</span></span> set_awalk_verts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">u</span><span class="main">}</span> <span class="main">∪</span> set <span class="main">(</span>map <span class="main">(</span>tail <span class="free">G</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>map <span class="main">(</span>head <span class="free">G</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_awalk_verts_cas<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Arc_Walk-set_awalk_verts_not_Nil"><span class="command">lemma</span></span> set_awalk_verts_not_Nil<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>map <span class="main">(</span>tail <span class="free">G</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>map <span class="main">(</span>head <span class="free">G</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> set_awalk_verts_not_Nil_cas<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Arc_Walk-awhd_of_awalk"><span class="command">lemma</span></span>
  awhd_of_awalk<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span> <span class="main">⟹</span> awhd <span class="free">u</span> <span class="free">p</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  awlast_of_awalk<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span> <span class="main">⟹</span> NOMATCH <span class="main">(</span>awlast <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="free">v</span> <span class="main">⟹</span> awlast <span class="free">u</span> <span class="free">p</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> NOMATCH_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">lemmas</span></span> awends_of_awalk<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> awhd_of_awalk awlast_of_awalk

<span class="keyword1" id="Arc_Walk-awalk_verts_arc1"><span class="command">lemma</span></span> awalk_verts_arc1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="free">e</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_verts_conv<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-awalk_verts_arc2"><span class="command">lemma</span></span> awalk_verts_arc2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="free">e</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_awalk_verts<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-awalk_induct_raw"><span class="command">lemma</span></span> awalk_induct_raw<span class="main">[</span><span class="operator">case_names</span> Base Cons<span class="comment1">(*, induct pred: awalk*)</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w1</span><span class="main">.</span> <span class="bound">w1</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">w1</span> <span class="main">[]</span> <span class="bound">w1</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w1</span> <span class="bound">w2</span> <span class="bound">e</span> <span class="bound">es</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> arc_to_ends <span class="free">G</span> <span class="bound">e</span> <span class="main">=</span> <span class="main">(</span><span class="bound">w1</span><span class="main">,</span> <span class="bound">w2</span><span class="main">)</span>
    <span class="main">⟹</span> <span class="free">P</span> <span class="bound">w2</span> <span class="bound">es</span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">w1</span> <span class="main">(</span><span class="bound">e</span> <span class="main">#</span> <span class="bound">es</span><span class="main">)</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Nil.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">e</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Cons<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Cons<span class="main"><span class="main">(</span></span>2-<span class="main"><span class="main">)</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_to_ends_def awalk_Cons_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>





<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Appending awalks›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> cas_append_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="free">v</span> <span class="main">⟷</span> cas <span class="free">u</span> <span class="free">p</span> <span class="main">(</span>awlast <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">∧</span> cas <span class="main">(</span>awlast <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="free">q</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> cas.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Arc_Walk-cas_ends"><span class="command">lemma</span></span> cas_ends<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u'</span> <span class="free">p</span> <span class="free">v'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">=</span> <span class="free">u'</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">p</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">=</span> <span class="free">v</span> <span class="main">∧</span> <span class="free">u'</span> <span class="main">=</span> <span class="free">v'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">u'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> cas.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Arc_Walk-awalk_ends"><span class="command">lemma</span></span> awalk_ends<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u'</span> <span class="free">p</span> <span class="free">v'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">=</span> <span class="free">u'</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">p</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">=</span> <span class="free">v</span> <span class="main">∧</span> <span class="free">u'</span> <span class="main">=</span> <span class="free">v'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> awalk_def cas_ends<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-awalk_ends_eqD"><span class="command">lemma</span></span> awalk_ends_eqD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">v</span> <span class="free">p</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> awalk_ends<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Arc_Walk-awalk_empty_ends"><span class="command">lemma</span></span> awalk_empty_ends<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="main">[]</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_def<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-apath_ends"><span class="command">lemma</span></span> apath_ends<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"apath <span class="free">u'</span> <span class="free">p</span> <span class="free">v'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">≠</span> <span class="free">v</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">=</span> <span class="free">u'</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">p</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">=</span> <span class="free">v</span> <span class="main">∧</span> <span class="free">u'</span> <span class="main">=</span> <span class="free">v'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> apath_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> apath_nonempty_ends  awalk_ends<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-awalk_append_iff"><span class="command">lemma</span></span> awalk_append_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="free">v</span> <span class="main">⟷</span> awalk <span class="free">u</span> <span class="free">p</span> <span class="main">(</span>awlast <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">∧</span> awalk <span class="main">(</span>awlast <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="free">q</span> <span class="free">v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> awlast_in_verts<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-awlast_append"><span class="command">lemma</span></span> awlast_append<span class="main">:</span>
  <span class="quoted"><span class="quoted">"awlast <span class="free">u</span> <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> awlast <span class="main">(</span>awlast <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> awalk_verts_conv<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-awhd_append"><span class="command">lemma</span></span> awhd_append<span class="main">:</span>
  <span class="quoted"><span class="quoted">"awhd <span class="free">u</span> <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> awhd <span class="main">(</span>awhd <span class="free">u</span> <span class="free">q</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> awalk_verts_conv<span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> awalkE<span class="main">[</span><span class="operator">rule</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1" id="Arc_Walk-awalkE'"><span class="command">lemma</span></span> awalkE'<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">⊆</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
    <span class="quoted"><span class="quoted">"awhd <span class="free">u</span> <span class="free">p</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"awlast <span class="free">u</span> <span class="free">p</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hd_in_awalk_verts <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> awalkE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> awalkE <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arc_Walk-awalk_appendI"><span class="command">lemma</span></span> awalk_appendI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">v</span> <span class="free">q</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">e</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons.prems <span class="keyword1"><span class="command">have</span></span> ee_e<span class="main">:</span> <span class="quoted"><span class="quoted">"arc_to_ends <span class="free">G</span> <span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> head <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> arc_to_ends_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="main">(</span>head <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="skolem">es</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ee_e Cons<span class="main">(</span>2<span class="main">)</span> awalk_Cons_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons ee_e <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_Cons_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arc_Walk-awalk_verts_append_cas"><span class="command">lemma</span></span> awalk_verts_append_cas<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"awalk_verts <span class="free">u</span> <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> awalk_verts <span class="free">u</span> <span class="free">p</span> <span class="main">@</span> tl <span class="main">(</span>awalk_verts <span class="main">(</span>awlast <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_Cons_iff<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-awalk_verts_append"><span class="command">lemma</span></span> awalk_verts_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"awalk_verts <span class="free">u</span> <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> awalk_verts <span class="free">u</span> <span class="free">p</span> <span class="main">@</span> tl <span class="main">(</span>awalk_verts <span class="main">(</span>awlast <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> awalk_verts_append_cas<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Arc_Walk-awalk_verts_append2"><span class="command">lemma</span></span> awalk_verts_append2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"awalk_verts <span class="free">u</span> <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> butlast <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">@</span> awalk_verts <span class="main">(</span>awlast <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="free">q</span>"</span></span>
 <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_verts_conv<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-apath_append_iff"><span class="command">lemma</span></span> apath_append_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="free">v</span> <span class="main">⟷</span> apath <span class="free">u</span> <span class="free">p</span> <span class="main">(</span>awlast <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">∧</span> apath <span class="main">(</span>awlast <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="free">q</span> <span class="free">v</span> <span class="main">∧</span>
    set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>tl <span class="main">(</span>awalk_verts <span class="main">(</span>awlast <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>awalk_verts <span class="main">(</span>awlast <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def awalk_verts_append2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def awalk_verts_append<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def awalk_verts_append <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> distinct_tl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> set_awalk_verts_append_cas<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">v</span> <span class="free">q</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>awalk_verts <span class="free">v</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> cas_pq<span class="main">:</span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> awlast_if_cas<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> awalk_verts_non_Nil awlast_if_cas last_in_set<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_awalk_verts_cas<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> set_awalk_verts_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">v</span> <span class="free">q</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>awalk_verts <span class="free">v</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_verts_append<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_awalk_verts<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arc_Walk-cas_takeI"><span class="command">lemma</span></span> cas_takeI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"awlast <span class="free">u</span> <span class="main">(</span>take <span class="free">n</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">v'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="main">(</span>take <span class="free">n</span> <span class="free">p</span><span class="main">)</span> <span class="free">v'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="main">(</span>take <span class="free">n</span> <span class="free">p</span> <span class="main">@</span> drop <span class="free">n</span> <span class="free">p</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cas_append_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arc_Walk-cas_dropI"><span class="command">lemma</span></span> cas_dropI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"awlast <span class="free">u</span> <span class="main">(</span>take <span class="free">n</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">u'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u'</span> <span class="main">(</span>drop <span class="free">n</span> <span class="free">p</span><span class="main">)</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="main">(</span>take <span class="free">n</span> <span class="free">p</span> <span class="main">@</span> drop <span class="free">n</span> <span class="free">p</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> cas_append_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arc_Walk-awalk_verts_take_conv"><span class="command">lemma</span></span> awalk_verts_take_conv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"awalk_verts <span class="free">u</span> <span class="main">(</span>take <span class="free">n</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> take <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="main">(</span>take <span class="free">n</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>awlast <span class="free">u</span> <span class="main">(</span>take <span class="free">n</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> cas_takeI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat.exhaust<span class="main"><span class="main">[</span></span><span class="operator">case_product</span> list.exhaust<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_verts_conv' take_map <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> awalk_verts.simps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arc_Walk-awalk_verts_drop_conv"><span class="command">lemma</span></span> awalk_verts_drop_conv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"awalk_verts <span class="free">u'</span> <span class="main">(</span>drop <span class="free">n</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">n</span> <span class="main">&lt;</span> length <span class="free">p</span> <span class="keyword1">then</span> drop <span class="free">n</span> <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">[</span><span class="free">u'</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_verts_conv drop_map<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-awalk_decomp_verts"><span class="command">lemma</span></span> awalk_decomp_verts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cas<span class="main">:</span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ev_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk_verts <span class="free">u</span> <span class="free">p</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">@</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q</span> <span class="free">r</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="free">q</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">y</span> <span class="free">r</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">@</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"awalk_verts <span class="free">u</span> <span class="free">q</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">y</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"awalk_verts <span class="free">y</span> <span class="free">r</span> <span class="main">=</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> take <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> drop <span class="main">(</span>length <span class="free">xs</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="skolem">q</span> <span class="main">(</span>awlast <span class="free">u</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"cas <span class="main">(</span>awlast <span class="free">u</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">r</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cas <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awlast <span class="free">u</span> <span class="skolem">q</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q_def <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_verts_take_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk_verts <span class="free">u</span> <span class="skolem">q</span> <span class="main">=</span> <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span>awlast <span class="free">u</span> <span class="skolem">q</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_verts_take_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk_verts <span class="free">y</span> <span class="skolem">r</span> <span class="main">=</span> <span class="free">y</span> <span class="main">#</span> <span class="free">ys</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> q_def r_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_verts_drop_conv not_less<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arc_Walk-awalk_decomp"><span class="command">lemma</span></span> awalk_decomp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> <span class="bound">q</span> <span class="main">@</span> <span class="bound">r</span> <span class="main">∧</span> awalk <span class="free">u</span> <span class="bound">q</span> <span class="free">w</span> <span class="main">∧</span> awalk <span class="free">w</span> <span class="bound">r</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"awalk_verts <span class="free">u</span> <span class="free">p</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">w</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_set_conv_decomp<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="skolem">q</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">w</span> <span class="skolem">r</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"awalk_verts <span class="free">u</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">w</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> awalk_decomp_verts<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Arc_Walk-awalk_not_distinct_decomp"><span class="command">lemma</span></span> awalk_not_distinct_decomp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> distinct <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span> <span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> <span class="bound">q</span> <span class="main">@</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">s</span> <span class="main">∧</span> distinct <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="bound">q</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> length <span class="bound">r</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">w</span><span class="main">.</span> awalk <span class="free">u</span> <span class="bound">q</span> <span class="bound">w</span> <span class="main">∧</span> awalk <span class="bound">w</span> <span class="bound">r</span> <span class="bound">w</span> <span class="main">∧</span> awalk <span class="bound">w</span> <span class="bound">s</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="skolem"><span class="skolem">zs</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    pv_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk_verts <span class="free">u</span> <span class="free">p</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">zs</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> xs_y_props<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> set <span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> set <span class="skolem">ys</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_distinct_decomp_min_prefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="skolem">q</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="skolem">p'</span>"</span></span> <span class="quoted"><span class="quoted">"awalk_verts <span class="free">u</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p'_props<span class="main">:</span> <span class="quoted"><span class="quoted">"cas <span class="skolem">y</span> <span class="skolem">p'</span> <span class="free">v</span>"</span></span>  <span class="quoted"><span class="quoted">"awalk_verts <span class="skolem">y</span> <span class="skolem">p'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">zs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms pv_decomp <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> awalk_decomp_verts<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"cas <span class="skolem">y</span> <span class="skolem">r</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"cas <span class="skolem">y</span> <span class="skolem">s</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p'</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">@</span> <span class="skolem">s</span>"</span></span>
    <span class="quoted"><span class="quoted">"awalk_verts <span class="skolem">y</span> <span class="skolem">r</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"awalk_verts <span class="skolem">y</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">zs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p'_props <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> awalk_decomp_verts<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="skolem">r</span> <span class="main">@</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="skolem">p'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p'</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">@</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹awalk_verts <span class="free">u</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> xs_y_props  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> length <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹awalk_verts <span class="skolem">y</span> <span class="skolem">r</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y</span><span class="main">]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> pv_decomp assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="skolem">q</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">y</span> <span class="skolem">r</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">y</span> <span class="skolem">s</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>›</span></span> <span class="quoted"><span class="quoted">‹cas <span class="free">u</span> <span class="skolem">q</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹cas <span class="skolem">y</span> <span class="skolem">r</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹cas <span class="skolem">y</span> <span class="skolem">s</span> <span class="free">v</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="skolem">r</span> <span class="main">@</span> <span class="skolem">s</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arc_Walk-apath_decomp_disjoint"><span class="command">lemma</span></span> apath_decomp_disjoint<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">@</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>tl <span class="main">(</span>awalk_verts <span class="main">(</span>awlast <span class="free">u</span> <span class="free">q</span><span class="main">)</span> <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted">False</span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def awalk_verts_append<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cycles›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">closed_w</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> awalk <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">closed_w</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">u</span><span class="main">.</span> awalk <span class="bound">u</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">u</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> length <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The definitions of cycles in textbooks vary w.r.t to the minimial length
  of a cycle.

  The definition given here matches \cite{diestel2010graph}.
  \cite{bangjensen2009digraphs} excludes loops from being cycles.
  Volkmann (Lutz Volkmann: Graphen an allen Ecken und Kanten, 2006 (?))
  places no restriction on the length in the definition, but later
  usage assumes cycles to be non-empty.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> <span class="entity">cycle</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> awalk <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cycle</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">u</span><span class="main">.</span> awalk <span class="bound">u</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">u</span> <span class="main">∧</span> distinct <span class="main">(</span>tl <span class="main">(</span>awalk_verts <span class="bound">u</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>

<span class="keyword1" id="Arc_Walk-cycle_altdef"><span class="command">lemma</span></span> cycle_altdef<span class="main">:</span>
  <span class="quoted"><span class="quoted">"cycle <span class="free">p</span> <span class="main">⟷</span> closed_w <span class="free">p</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> distinct <span class="main">(</span>tl <span class="main">(</span>awalk_verts <span class="bound">u</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> closed_w_def cycle_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> distinct_tl_verts_imp_distinct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>tl <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>distinct <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="skolem"><span class="skolem">zs</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">e</span> <span class="main">#</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="skolem">e</span> <span class="main">#</span> <span class="skolem">zs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> not_distinct_decomp_min_prefix<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> assms p_decomp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_verts_append awalk_Cons_iff set_awalk_verts<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> distinct_verts_imp_distinct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> distinct_tl_verts_imp_distinct distinct_tl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> cycle_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"cycle <span class="free">p</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> awalk <span class="bound">u</span> <span class="free">p</span> <span class="bound">u</span> <span class="main">∧</span> distinct <span class="main">(</span>tl <span class="main">(</span>awalk_verts <span class="bound">u</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> distinct <span class="free">p</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cycle_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> distinct_tl_verts_imp_distinct<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loopfree_digraph<span class="main">)</span> cycle_digraph_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"cycle <span class="free">p</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> awalk <span class="bound">u</span> <span class="free">p</span> <span class="bound">u</span> <span class="main">∧</span> distinct <span class="main">(</span>tl <span class="main">(</span>awalk_verts <span class="bound">u</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="numeral">2</span> <span class="main">≤</span> length <span class="free">p</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"cycle <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">u</span> <span class="free">p</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>tl <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> cycle_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">≤</span> length <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?thesis</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">[</span><span class="skolem">e</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_le<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_simps <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> no_loops<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cycle_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> closed_w_imp_cycle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"closed_w <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> cycle <span class="bound">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"length <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> less
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> closed_w_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>tl <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> less <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> closed_w_def cycle_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>distinct <span class="main">(</span>tl <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">es</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">e</span> <span class="main">#</span> <span class="skolem">es</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> A * <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="main">(</span>head <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="skolem">es</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>distinct <span class="main">(</span>awalk_verts <span class="main">(</span>head <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="skolem">es</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_Cons_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">es</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="skolem">r</span> <span class="main">@</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span><span class="main">.</span> awalk <span class="bound">w</span> <span class="skolem">r</span> <span class="bound">w</span>"</span></span> <span class="quoted"><span class="quoted">"closed_w <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> awalk_not_distinct_decomp<span class="main">[</span><span class="operator">OF</span> **<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> closed_w_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">r</span> <span class="main">&lt;</span> length <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹closed_w <span class="skolem">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> less<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Reachability›</span></span>

<span class="keyword1" id="Arc_Walk-reachable1_awalk"><span class="command">lemma</span></span> reachable1_awalk<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">v</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> awalk <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> awalk <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_trancl_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base <span class="skolem">y</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="skolem">e</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="skolem">e</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> arc_implies_awalk <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">y</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">→</span> <span class="skolem">y</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="skolem">e</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="skolem">e</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">x</span> <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_Cons_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> awalk <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">as</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_simps trancl_into_trancl2 <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_arcs_imp_in_arcs_ends<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arc_Walk-reachable_awalk"><span class="command">lemma</span></span> reachable_awalk<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> awalk <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="free">u</span> <span class="main">⟷</span> awalk <span class="free">u</span> <span class="main">[]</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_Nil_iff reachable_in_verts<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> awalk <span class="free">u</span> <span class="bound">p</span> <span class="free">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> awalk_Nil_iff awalk_hd_in_verts<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">=</span> <span class="free">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span> <span class="main">⟷</span> <span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> awalk <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> reachable1_awalk <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arc_Walk-reachable_awalkI"><span class="command">lemma</span></span> reachable_awalkI<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">?</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> reachable_awalk <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Arc_Walk-reachable1_awalkI"><span class="command">lemma</span></span> reachable1_awalkI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"awalk <span class="free">v</span> <span class="free">p</span> <span class="free">w</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">→<span class="hidden">⇧</span><sup>+</sup></span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reachable1_awalk<span class="main">)</span>


<span class="keyword1" id="Arc_Walk-reachable_arc_trans"><span class="command">lemma</span></span> reachable_arc_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">e</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reachable_awalk<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">v</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹arc <span class="free">e</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_def awalk_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">@</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span><span class="main">)</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> awalk_appendI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arc_Walk-awalk_verts_reachable_from"><span class="command">lemma</span></span> awalk_verts_reachable_from<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>  <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="skolem">s</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> awalk_decomp<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> reachable_awalk<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arc_Walk-awalk_verts_reachable_to"><span class="command">lemma</span></span> awalk_verts_reachable_to<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>  <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">w</span> <span class="skolem">s</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> awalk_decomp<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> reachable_awalk<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>





<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Paths›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> length_apath_less<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">p</span> <span class="main">&lt;</span> card <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="free">p</span> <span class="main">&lt;</span> length <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> awalk_verts_conv
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_verts_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def distinct_card<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> card <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> apath_def awalk_conv
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> card_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> length_apath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"length <span class="free">p</span> <span class="main">≤</span> card <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> length_apath_less<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> apaths_finite_triple<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> apath <span class="bound">u</span> <span class="bound">p</span> <span class="bound">v</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span> <span class="bound">p</span> <span class="bound">v</span><span class="main">.</span> awalk <span class="bound">u</span> <span class="bound">p</span> <span class="bound">v</span> <span class="main">⟹</span> distinct <span class="main">(</span>awalk_verts <span class="bound">u</span> <span class="bound">p</span><span class="main">)</span> <span class="main">⟹</span>length <span class="bound">p</span> <span class="main">≤</span> card <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> length_apath<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> apath <span class="bound">u</span> <span class="bound">p</span> <span class="bound">v</span><span class="main">}</span> <span class="main">⊆</span> verts <span class="free">G</span> <span class="main">×</span> <span class="main">{</span><span class="bound">es</span><span class="main">.</span> set <span class="bound">es</span> <span class="main">⊆</span> arcs <span class="free">G</span> <span class="main">∧</span> length <span class="bound">es</span> <span class="main">≤</span> card <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span><span class="main">}</span> <span class="main">×</span> verts <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">...</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_verts finite_arcs
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_cartesian_product finite_lists_length_le<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> apaths_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">p</span><span class="main">.</span> apath <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> apath <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(</span>fst <span class="keyword1">o</span> snd<span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> apath <span class="bound">u</span> <span class="bound">p</span> <span class="bound">v</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> apaths_finite_triple <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_surj<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_awalk_cyc_decomp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> awalk <span class="main">=&gt;</span>
  <span class="main">(</span><span class="tfree">'b</span> awalk <span class="main">×</span> <span class="tfree">'b</span> awalk <span class="main">×</span> <span class="tfree">'b</span> awalk<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_awalk_cyc_decomp</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">@</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> awalk <span class="bound">u</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">v</span> <span class="main">∧</span> awalk <span class="bound">v</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="bound">v</span> <span class="main">∧</span> awalk <span class="bound">v</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">w</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span>length <span class="free"><span class="bound"><span class="entity">r</span></span></span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> distinct <span class="main">(</span>awalk_verts <span class="bound">u</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">awalk_cyc_decomp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> awalk
    <span class="main">⇒</span> <span class="tfree">'b</span> awalk <span class="main">×</span> <span class="tfree">'b</span> awalk <span class="main">×</span> <span class="tfree">'b</span> awalk"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">awalk_cyc_decomp</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">qrs</span><span class="main">.</span> is_awalk_cyc_decomp <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">qrs</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">awalk_to_apath</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> awalk <span class="main">⇒</span> <span class="tfree">'b</span> awalk"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">awalk_to_apath</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> distinct <span class="main">(</span>awalk_verts <span class="bound">u</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> awalk <span class="bound">u</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">v</span><span class="main">)</span>
     <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">r</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">=</span> awalk_cyc_decomp <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="keyword1">in</span> <span class="free">awalk_to_apath</span> <span class="main">(</span><span class="bound">q</span> <span class="main">@</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>
     <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Arc_Walk-awalk_cyc_decomp_has_prop"><span class="command">lemma</span></span> awalk_cyc_decomp_has_prop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>distinct <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_awalk_cyc_decomp <span class="free">p</span> <span class="main">(</span>awalk_cyc_decomp <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="skolem">r</span> <span class="main">@</span> <span class="skolem">s</span> <span class="main">∧</span> distinct <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="skolem">q</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> length <span class="skolem">r</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">w</span><span class="main">.</span> awalk <span class="free">u</span> <span class="skolem">q</span> <span class="bound">w</span> <span class="main">∧</span> awalk <span class="bound">w</span> <span class="skolem">r</span> <span class="bound">w</span> <span class="main">∧</span> awalk <span class="bound">w</span> <span class="skolem">s</span> <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> awalk_not_distinct_decomp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> is_awalk_cyc_decomp <span class="free">p</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">q</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">r</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">s</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> awalk_cyc_decomp_def <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arc_Walk-awalk_cyc_decompE"><span class="command">lemma</span></span> awalk_cyc_decompE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dec<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk_cyc_decomp <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p_props<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>distinct <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">@</span> <span class="free">r</span> <span class="main">@</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span><span class="main">.</span> awalk <span class="free">u</span> <span class="free">q</span> <span class="bound">w</span> <span class="main">∧</span> awalk <span class="bound">w</span> <span class="free">r</span> <span class="bound">w</span> <span class="main">∧</span> awalk <span class="bound">w</span> <span class="free">s</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"closed_w <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">@</span> <span class="free">r</span> <span class="main">@</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"closed_w <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> awalk_cyc_decomp_has_prop<span class="main">[</span><span class="operator">OF</span> p_props<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> dec
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> closed_w_def awalk_verts_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> closed_w_def<span class="main">)</span>

  <span class="comment1">(* TODO: Can we find some general rules to prove the last property?*)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="skolem"><span class="skolem">w'</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> obt_awalk<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">u'</span> <span class="free">q</span> <span class="skolem">w'</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">w'</span> <span class="free">r</span> <span class="skolem">w'</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">w'</span> <span class="free">s</span> <span class="skolem">v'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> awalk_cyc_decomp_has_prop<span class="main">[</span><span class="operator">OF</span> p_props<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> dec <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">u'</span> <span class="free">p</span> <span class="skolem">v'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">@</span> <span class="free">r</span> <span class="main">@</span> <span class="free">s</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="skolem">u'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="skolem">v'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> awalk_ends<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">q</span> <span class="skolem">w'</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">w'</span> <span class="free">r</span> <span class="skolem">w'</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">w'</span> <span class="free">s</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> obt_awalk <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span><span class="main">.</span> awalk <span class="free">u</span> <span class="free">q</span> <span class="bound">w</span> <span class="main">∧</span> awalk <span class="bound">w</span> <span class="free">r</span> <span class="bound">w</span> <span class="main">∧</span> awalk <span class="bound">w</span> <span class="free">s</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arc_Walk-awalk_cyc_decompE'"><span class="command">lemma</span></span> awalk_cyc_decompE'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p_props<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>distinct <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q</span> <span class="free">r</span> <span class="free">s</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">@</span> <span class="free">r</span> <span class="main">@</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span><span class="main">.</span> awalk <span class="free">u</span> <span class="free">q</span> <span class="bound">w</span> <span class="main">∧</span> awalk <span class="bound">w</span> <span class="free">r</span> <span class="bound">w</span> <span class="main">∧</span> awalk <span class="bound">w</span> <span class="free">s</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"closed_w <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"awalk_cyc_decomp <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"awalk_cyc_decomp <span class="free">p</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="skolem">r</span> <span class="main">@</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span><span class="main">.</span> awalk <span class="free">u</span> <span class="skolem">q</span> <span class="bound">w</span> <span class="main">∧</span> awalk <span class="bound">w</span> <span class="skolem">r</span> <span class="bound">w</span> <span class="main">∧</span> awalk <span class="bound">w</span> <span class="skolem">s</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"closed_w <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> awalk_cyc_decompE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">termination</span></span> <span class="quoted">awalk_to_apath</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure length"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">G</span> <span class="skolem">p</span> <span class="skolem">qrs</span> <span class="skolem">rs</span> <span class="skolem">q</span> <span class="skolem">r</span> <span class="skolem">s</span>

  <span class="keyword1"><span class="command">have</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> closed_w <span class="skolem">r</span> <span class="main">⟹</span> awalk <span class="bound">x</span> <span class="skolem">r</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> closed_w_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> awalk_ends<span class="main">)</span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> distinct <span class="main">(</span>awalk_verts <span class="bound">u</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> awalk <span class="bound">u</span> <span class="skolem">p</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">qrs</span> <span class="main">=</span> awalk_cyc_decomp <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">q</span><span class="main">,</span> <span class="skolem">rs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">qrs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">rs</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>distinct <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk_cyc_decomp <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_awalk_cyc_decomp <span class="skolem">p</span> <span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> awalk_cyc_decompE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ *<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> X<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"awlast <span class="skolem">u</span> <span class="skolem">q</span>"</span></span>  <span class="quoted"><span class="quoted">"awlast <span class="main">(</span>awlast <span class="skolem">u</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">r</span>"</span></span><span class="main">]</span> *<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> closed_w_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">q</span> <span class="main">@</span> <span class="skolem">s</span><span class="main">,</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> measure length"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> closed_w_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">declare</span></span> awalk_to_apath.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1" id="Arc_Walk-awalk_to_apath_induct"><span class="command">lemma</span></span> awalk_to_apath_induct<span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> path decomp<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> awalk<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> awalk <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span> <span class="main">⟹</span> distinct <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="bound">p</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">q</span> <span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="main">⟦</span>awalk <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">;</span> awalk_cyc_decomp <span class="bound">p</span> <span class="main">=</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">r</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">;</span>
    <span class="main">¬</span>distinct <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="bound">p</span><span class="main">)</span><span class="main">;</span> <span class="free">P</span> <span class="main">(</span><span class="bound">q</span> <span class="main">@</span> <span class="bound">s</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> awalk
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"length <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> less
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="skolem">p</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dist less.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_cdecomp<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk_cyc_decomp <span class="skolem">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"awalk_cyc_decomp <span class="skolem">p</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_awalk_cyc_decomp <span class="skolem">p</span> <span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="skolem">r</span> <span class="main">@</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> awalk_cyc_decomp_has_prop<span class="main">[</span><span class="operator">OF</span> less.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> False<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">q</span> <span class="main">@</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">&lt;</span> length <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">@</span> <span class="skolem">s</span><span class="main">)</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> less.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> awalk_ends_eqD<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">@</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> less<span class="main">)</span>

    <span class="keyword1"><span class="command">with</span></span> p_cdecomp False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dec less.prems<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arc_Walk-step_awalk_to_apath"><span class="command">lemma</span></span> step_awalk_to_apath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> awalk<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk_cyc_decomp <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="free">q</span><span class="main">,</span> <span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> dist<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> distinct <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"awalk_to_apath <span class="free">p</span> <span class="main">=</span> awalk_to_apath <span class="main">(</span><span class="free">q</span> <span class="main">@</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> dist <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> distinct <span class="main">(</span>awalk_verts <span class="bound">u</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_verts_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> awalk <span class="keyword2"><span class="keyword">and</span></span> decomp <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"awalk_to_apath <span class="free">p</span> <span class="main">=</span> awalk_to_apath <span class="main">(</span><span class="free">q</span> <span class="main">@</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_to_apath.simps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arc_Walk-apath_awalk_to_apath"><span class="command">lemma</span></span> apath_awalk_to_apath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="main">(</span>awalk_to_apath <span class="free">p</span><span class="main">)</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> awalk_to_apath_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk_to_apath <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_to_apath.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> path <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>decomp <span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">r</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> step_awalk_to_apath<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">p</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> awalk_to_apath_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_to_apath <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> awalk_to_apath_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk_to_apath <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_to_apath.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>decomp <span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">r</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> distinct <span class="main">(</span>awalk_verts <span class="bound">u</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> awalk <span class="bound">u</span> <span class="skolem">p</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> decomp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_to_apath <span class="main">(</span><span class="skolem">q</span> <span class="main">@</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> decomp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> awalk_cyc_decompE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> awalk_to_apath.simps<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> * simp_thms if_True decomp Let_def prod.simps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Arc_Walk-reachable_apath"><span class="command">lemma</span></span> reachable_apath<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> apath <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> awalkI_apath apath_awalk_to_apath <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reachable_awalk<span class="main">)</span>

<span class="keyword1" id="Arc_Walk-no_loops_in_apath"><span class="command">lemma</span></span> no_loops_in_apath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="free">a</span> <span class="main">≠</span> head <span class="free">G</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> set <span class="free">p</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">p1</span> <span class="main">@</span> <span class="free">a</span> <span class="main">#</span> <span class="skolem">p2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_set_conv_decomp<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apath <span class="main">(</span>tail <span class="free">G</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="main">[</span><span class="free">a</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">(</span><span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_append_iff apath_Cons_iff apath_Nil_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apath <span class="main">(</span>tail <span class="free">G</span> <span class="free">a</span><span class="main">)</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span> <span class="main">(</span>head <span class="free">G</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">drule</span> apath_append_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  apath_Cons_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Pair_Digraph">
<div class="head">
<h1>Theory Pair_Digraph</h1>
</div>
<pre class="source"><span class="comment1">(* Title:  Pair_Digraph.thy
   Author: Lars Noschinski, TU München
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Pair_Digraph
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Digraph.html">Digraph</a>
  <a href="Bidirected_Digraph.html">Bidirected_Digraph</a>
  <a href="Arc_Walk.html">Arc_Walk</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Digraphs without Parallel Arcs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If no parallel arcs are desired, arcs can be accurately described as pairs of
  This is the natural representation for Digraphs without multi-arcs.
  and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"head <span class="free"><span class="free">G</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, making it easier to deal with multiple related graphs
  and to modify a graph by adding edges.

  This theory introduces such a specialisation of digraphs.
›</span></span>

<span class="keyword1"><span class="command">record</span></span> <span class="tfree">'a</span> pair_pre_digraph <span class="main">=</span> pverts <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> parcs <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">with_proj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pair_pre_digraph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> pre_digraph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">with_proj</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">⦇</span> verts <span class="main">=</span> pverts <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> arcs <span class="main">=</span> parcs <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> tail <span class="main">=</span> fst<span class="main">,</span> head <span class="main">=</span> snd <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">coercion</span> <span class="quoted">with_proj</span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">pawalk_verts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> awalk <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pawalk_verts</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pawalk_verts</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span> <span class="main">=</span> fst <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">#</span> <span class="free">pawalk_verts</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pcas</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> awalk <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pcas</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pcas</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∧</span> <span class="free">pcas</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Pair_Digraph-with_proj_simps"><span class="command">lemma</span></span> with_proj_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"verts <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span> <span class="main">=</span> pverts <span class="free">G</span>"</span></span>
  <span class="quoted"><span class="quoted">"arcs <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span> <span class="main">=</span> parcs <span class="free">G</span>"</span></span>
  <span class="quoted"><span class="quoted">"arcs_ends <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span> <span class="main">=</span> parcs <span class="free">G</span>"</span></span>
  <span class="quoted"><span class="quoted">"tail <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span> <span class="main">=</span> fst"</span></span>
  <span class="quoted"><span class="quoted">"head <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span> <span class="main">=</span> snd"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> with_proj_def arcs_ends_conv<span class="main">)</span>

<span class="keyword1" id="Pair_Digraph-cas_with_proj_eq"><span class="command">lemma</span></span> cas_with_proj_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"pre_digraph.cas <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span> <span class="main">=</span> pcas"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> fun_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">es</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pre_digraph.cas <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span> <span class="skolem">u</span> <span class="skolem">es</span> <span class="skolem">v</span> <span class="main">=</span> pcas <span class="skolem">u</span> <span class="skolem">es</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">es</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  pre_digraph.cas.simps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Pair_Digraph-awalk_verts_with_proj_eq"><span class="command">lemma</span></span> awalk_verts_with_proj_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"pre_digraph.awalk_verts <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span> <span class="main">=</span> pawalk_verts"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> fun_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">es</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pre_digraph.awalk_verts <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span> <span class="skolem">u</span> <span class="skolem">es</span> <span class="main">=</span> pawalk_verts <span class="skolem">u</span> <span class="skolem">es</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">es</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.awalk_verts.simps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">locale</span></span> pair_pre_digraph <span class="main">=</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pair_pre_digraph"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> cas_with_proj_eq awalk_verts_with_proj_eq

<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">locale</span></span> pair_wf_digraph <span class="main">=</span> pair_pre_digraph <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> arc_fst_in_verts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> parcs <span class="free">G</span> <span class="main">⟹</span> fst <span class="bound">e</span> <span class="main">∈</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> arc_snd_in_verts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> parcs <span class="free">G</span> <span class="main">⟹</span> snd <span class="bound">e</span> <span class="main">∈</span> pverts <span class="free">G</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Pair_Digraph-in_arcsD1"><span class="command">lemma</span></span> in_arcsD1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="free">G</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">∈</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> in_arcsD2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="free">G</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> arc_fst_in_verts arc_snd_in_verts<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> wellformed' <span class="main">=</span> in_arcsD1 in_arcsD2

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> pair_fin_digraph <span class="main">=</span> pair_wf_digraph <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pair_finite_verts<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>pverts <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> pair_finite_arcs<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>parcs <span class="free">G</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> pair_sym_digraph <span class="main">=</span> pair_wf_digraph <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pair_sym_arcs<span class="main">:</span> <span class="quoted"><span class="quoted">"symmetric <span class="free">G</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> pair_loopfree_digraph <span class="main">=</span> pair_wf_digraph  <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pair_no_loops<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> parcs <span class="free">G</span> <span class="main">⟹</span> fst <span class="free">e</span> <span class="main">≠</span> snd <span class="free">e</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> pair_bidirected_digraph <span class="main">=</span> pair_sym_digraph <span class="main">+</span> pair_loopfree_digraph

<span class="keyword1"><span class="command">locale</span></span> pair_pseudo_graph <span class="main">=</span> pair_fin_digraph <span class="main">+</span> pair_sym_digraph

<span class="keyword1"><span class="command">locale</span></span> pair_digraph <span class="main">=</span> pair_fin_digraph  <span class="main">+</span> pair_loopfree_digraph

<span class="keyword1"><span class="command">locale</span></span> pair_graph <span class="main">=</span> pair_digraph <span class="main">+</span> pair_pseudo_graph

<span class="keyword1"><span class="command">sublocale</span></span> pair_pre_digraph <span class="main">⊆</span> pre_digraph <span class="quoted"><span class="quoted">"with_proj <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">=</span> pverts <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arcs <span class="free">G</span> <span class="main">=</span> parcs <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="main">=</span> fst"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="main">=</span> snd"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arcs_ends <span class="free">G</span> <span class="main">=</span> parcs <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pre_digraph.awalk_verts <span class="free">G</span> <span class="main">=</span> pawalk_verts"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pre_digraph.cas <span class="free">G</span> <span class="main">=</span> pcas"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">sublocale</span></span> pair_wf_digraph <span class="main">⊆</span> wf_digraph <span class="quoted"><span class="quoted">"with_proj <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">=</span> pverts <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arcs <span class="free">G</span> <span class="main">=</span> parcs <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="main">=</span> fst"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="main">=</span> snd"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arcs_ends <span class="free">G</span> <span class="main">=</span> parcs <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pre_digraph.awalk_verts <span class="free">G</span> <span class="main">=</span> pawalk_verts"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pre_digraph.cas <span class="free">G</span> <span class="main">=</span> pcas"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_fst_in_verts arc_snd_in_verts<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> pair_fin_digraph <span class="main">⊆</span> fin_digraph <span class="quoted"><span class="quoted">"with_proj <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">=</span> pverts <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arcs <span class="free">G</span> <span class="main">=</span> parcs <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="main">=</span> fst"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="main">=</span> snd"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arcs_ends <span class="free">G</span> <span class="main">=</span> parcs <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pre_digraph.awalk_verts <span class="free">G</span> <span class="main">=</span> pawalk_verts"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pre_digraph.cas <span class="free">G</span> <span class="main">=</span> pcas"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pair_finite_verts pair_finite_arcs <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">sublocale</span></span> pair_sym_digraph <span class="main">⊆</span> sym_digraph <span class="quoted"><span class="quoted">"with_proj <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">=</span> pverts <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arcs <span class="free">G</span> <span class="main">=</span> parcs <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="main">=</span> fst"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="main">=</span> snd"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arcs_ends <span class="free">G</span> <span class="main">=</span> parcs <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pre_digraph.awalk_verts <span class="free">G</span> <span class="main">=</span> pawalk_verts"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pre_digraph.cas <span class="free">G</span> <span class="main">=</span> pcas"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pair_sym_arcs <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">sublocale</span></span> pair_pseudo_graph <span class="main">⊆</span> pseudo_graph <span class="quoted"><span class="quoted">"with_proj <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">=</span> pverts <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arcs <span class="free">G</span> <span class="main">=</span> parcs <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="main">=</span> fst"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="main">=</span> snd"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arcs_ends <span class="free">G</span> <span class="main">=</span> parcs <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pre_digraph.awalk_verts <span class="free">G</span> <span class="main">=</span> pawalk_verts"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pre_digraph.cas <span class="free">G</span> <span class="main">=</span> pcas"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">sublocale</span></span> pair_loopfree_digraph <span class="main">⊆</span> loopfree_digraph <span class="quoted"><span class="quoted">"with_proj <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">=</span> pverts <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arcs <span class="free">G</span> <span class="main">=</span> parcs <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="main">=</span> fst"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="main">=</span> snd"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arcs_ends <span class="free">G</span> <span class="main">=</span> parcs <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pre_digraph.awalk_verts <span class="free">G</span> <span class="main">=</span> pawalk_verts"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pre_digraph.cas <span class="free">G</span> <span class="main">=</span> pcas"</span></span>
  <span class="keyword1"><span class="command">using</span></span> pair_no_loops <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">sublocale</span></span> pair_digraph <span class="main">⊆</span> digraph <span class="quoted"><span class="quoted">"with_proj <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">=</span> pverts <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arcs <span class="free">G</span> <span class="main">=</span> parcs <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="main">=</span> fst"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="main">=</span> snd"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arcs_ends <span class="free">G</span> <span class="main">=</span> parcs <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pre_digraph.awalk_verts <span class="free">G</span> <span class="main">=</span> pawalk_verts"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pre_digraph.cas <span class="free">G</span> <span class="main">=</span> pcas"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_to_ends_def<span class="main">)</span>

<span class="keyword1"><span class="command">sublocale</span></span> pair_graph <span class="main">⊆</span> graph <span class="quoted"><span class="quoted">"with_proj <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">=</span> pverts <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arcs <span class="free">G</span> <span class="main">=</span> parcs <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="main">=</span> fst"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="main">=</span> snd"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arcs_ends <span class="free">G</span> <span class="main">=</span> parcs <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pre_digraph.awalk_verts <span class="free">G</span> <span class="main">=</span> pawalk_verts"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pre_digraph.cas <span class="free">G</span> <span class="main">=</span> pcas"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">sublocale</span></span> pair_graph <span class="main">⊆</span> pair_bidirected_digraph <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1" id="Pair_Digraph-wf_digraph_wp_iff"><span class="command">lemma</span></span> wf_digraph_wp_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_digraph <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span> <span class="main">=</span> pair_wf_digraph <span class="free">G</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> wf_digraph <span class="quoted"><span class="quoted">"with_proj <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">using</span></span> wellformed <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> pair_wf_digraph <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_fin_digraph<span class="main">)</span> pair_fin_digraph<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pair_fin_digraph <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">context</span></span> pair_digraph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Pair_Digraph-pair_wf_digraph"><span class="command">lemma</span></span> pair_wf_digraph<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pair_wf_digraph <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_locales</span>

<span class="keyword1" id="Pair_Digraph-pair_digraph"><span class="command">lemma</span></span> pair_digraph<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pair_digraph <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_loopfree_digraph<span class="main">)</span> no_loops'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="free">G</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> no_loops<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_wf_digraph<span class="main">)</span> apath_succ_decomp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p1</span> <span class="bound">z</span> <span class="bound">p2</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> <span class="bound">p1</span> <span class="main">@</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span><span class="bound">z</span><span class="main">)</span> <span class="main">#</span> <span class="bound">p2</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="bound">z</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> <span class="bound">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">p</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">p1</span> <span class="main">@</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">p2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> in_set_conv_decomp_first<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> p_decomp <span class="quoted"><span class="quoted">‹apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">≠</span> <span class="free">v</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">y</span> <span class="skolem">p2</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def awalk_Cons_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="skolem"><span class="skolem">p2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> p2_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">p2'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">atomize_elim</span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_Cons_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_decomp p2_decomp <span class="quoted"><span class="quoted">‹apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_append_iff apath_simps hd_in_awalk_verts<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> p_decomp p2_decomp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">p1</span> <span class="main">@</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">y</span><span class="main">,</span><span class="skolem">z</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">p2'</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≠</span> <span class="skolem">z</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_sym_digraph<span class="main">)</span> arcs_symmetric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="free">G</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sym_arcs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> symmetric_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> symE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_pseudo_graph<span class="main">)</span> pair_pseudo_graph<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pair_pseudo_graph <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_graph<span class="main">)</span> pair_graph<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pair_graph <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_graph<span class="main">)</span> pair_graphD_graph<span class="main">:</span> <span class="quoted"><span class="quoted">"graph <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1" id="Pair_Digraph-pair_graphI_graph"><span class="command">lemma</span></span> pair_graphI_graph<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"graph <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pair_graph <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> G<span class="main">:</span> graph <span class="quoted"><span class="quoted">"with_proj <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> G.wellformed G.finite_arcs G.finite_verts G.no_loops
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Pair_Digraph-pair_loopfreeI_loopfree"><span class="command">lemma</span></span> pair_loopfreeI_loopfree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"loopfree_digraph <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pair_loopfree_digraph <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> loopfree_digraph <span class="quoted"><span class="quoted">"with_proj <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> wellformed no_loops <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Path reversal for Pair Digraphs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This definition is only meaningful in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Pair_Digraph</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">rev_path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> awalk <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> awalk"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">rev_path</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">rev_path</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">rev_path</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> fst <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">]</span>"</span></span>

<span class="keyword1" id="Pair_Digraph-rev_path_append"><span class="command">lemma</span></span> rev_path_append<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rev_path <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> rev_path <span class="free">q</span> <span class="main">@</span> rev_path <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Pair_Digraph-rev_path_rev_path"><span class="command">lemma</span></span> rev_path_rev_path<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"rev_path <span class="main">(</span>rev_path <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Pair_Digraph-rev_path_empty"><span class="command">lemma</span></span> rev_path_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"rev_path <span class="free">p</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span> 

<span class="keyword1" id="Pair_Digraph-rev_path_eq"><span class="command">lemma</span></span> rev_path_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"rev_path <span class="free">p</span> <span class="main">=</span> rev_path <span class="free">q</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rev_path_rev_path<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_sym_digraph<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> awalk_verts_rev_path<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk_verts <span class="free">v</span> <span class="main">(</span>rev_path <span class="free">p</span><span class="main">)</span> <span class="main">=</span> rev <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> awalk_rev_path'<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">v</span> <span class="main">(</span>rev_path <span class="free">p</span><span class="main">)</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_Nil_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">e</span> <span class="skolem">es</span><span class="main">)</span> <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword1"><span class="command">have</span></span> walks<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">v</span> <span class="main">(</span>rev_path <span class="skolem">es</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">e</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"awalk <span class="main">(</span>snd <span class="skolem">e</span><span class="main">)</span> <span class="main">[</span><span class="main">(</span>snd <span class="skolem">e</span><span class="main">,</span> fst <span class="skolem">e</span><span class="main">)</span><span class="main">]</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> verts<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk_verts <span class="free">v</span> <span class="main">(</span>rev_path <span class="skolem">es</span><span class="main">)</span> <span class="main">=</span> rev <span class="main">(</span>awalk_verts <span class="main">(</span>snd <span class="skolem">e</span><span class="main">)</span> <span class="skolem">es</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_simps <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> arcs_symmetric<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> walks <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">v</span> <span class="main">(</span>rev_path <span class="skolem">es</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span>snd <span class="skolem">e</span><span class="main">,</span> fst <span class="skolem">e</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tl <span class="main">(</span>awalk_verts <span class="main">(</span>awlast <span class="free">v</span> <span class="main">(</span>rev_path <span class="skolem">es</span><span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">(</span>snd <span class="skolem">e</span><span class="main">,</span> fst <span class="skolem">e</span><span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>fst <span class="skolem">e</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 verts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_verts_append<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">e</span> <span class="skolem">es</span><span class="main">)</span> <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">v</span> <span class="main">(</span>rev_path <span class="skolem">es</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_Cons_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rev_path <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">=</span> rev_path <span class="skolem">es</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span>snd <span class="skolem">e</span><span class="main">,</span> fst <span class="skolem">e</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> Cons 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="main">(</span>snd <span class="skolem">e</span><span class="main">)</span> <span class="main">[</span><span class="main">(</span>snd <span class="skolem">e</span><span class="main">,</span> fst <span class="skolem">e</span><span class="main">)</span><span class="main">]</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_simps <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> arcs_symmetric<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">v</span> <span class="main">(</span>rev_path <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_sym_digraph<span class="main">)</span> awalk_rev_path<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"awalk <span class="free">v</span> <span class="main">(</span>rev_path <span class="free">p</span><span class="main">)</span> <span class="free">u</span> <span class="main">=</span> awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> awalk_rev_path' rev_path_rev_path<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_sym_digraph<span class="main">)</span> apath_rev_path<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"apath <span class="free">v</span> <span class="main">(</span>rev_path <span class="free">p</span><span class="main">)</span> <span class="free">u</span> <span class="main">=</span> apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_verts_rev_path apath_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Subdividing Edges›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹subdivide an edge (=two associated arcs) in graph›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">subdivide</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pair_pre_digraph <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> pair_pre_digraph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subdivide</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="main">⦇</span>
    pverts <span class="main">=</span> pverts <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">}</span><span class="main">,</span>
    parcs <span class="main">=</span> <span class="main">(</span>parcs <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> subdivide.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹subdivide an arc in a path›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sd_path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> awalk <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> awalk"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sd_path</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sd_path</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>
                                 <span class="keyword1">then</span> <span class="main">[</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">]</span>
                                 <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span>
                                 <span class="keyword1">then</span> <span class="main">[</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span><span class="main">]</span>
                                 <span class="keyword1">else</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="free">sd_path</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹contract an arc in a path›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">co_path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> awalk <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> awalk"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">co_path</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">co_path</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">]</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">co_path</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>
      <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free">co_path</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span>
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span>
      <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free">co_path</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span>
      <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main">#</span> <span class="free">co_path</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Pair_Digraph-co_path_simps"><span class="command">lemma</span></span> co_path_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">e1</span> <span class="main">≠</span> <span class="main">(</span>fst <span class="free">e</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span><span class="main">;</span> <span class="free">e1</span> <span class="main">≠</span> <span class="main">(</span>snd <span class="free">e</span><span class="main">,</span><span class="free">w</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> co_path <span class="free">e</span> <span class="free">w</span> <span class="main">(</span><span class="free">e1</span> <span class="main">#</span> <span class="free">es</span><span class="main">)</span> <span class="main">=</span> <span class="free">e1</span> <span class="main">#</span> co_path <span class="free">e</span> <span class="free">w</span> <span class="free">es</span>"</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">e1</span> <span class="main">=</span> <span class="main">(</span>fst <span class="free">e</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span><span class="main">;</span> <span class="free">e2</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span> snd <span class="free">e</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> co_path <span class="free">e</span> <span class="free">w</span> <span class="main">(</span><span class="free">e1</span> <span class="main">#</span> <span class="free">e2</span> <span class="main">#</span> <span class="free">es</span><span class="main">)</span> <span class="main">=</span> <span class="free">e</span> <span class="main">#</span> co_path <span class="free">e</span> <span class="free">w</span> <span class="free">es</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">e1</span> <span class="main">=</span> <span class="main">(</span>snd <span class="free">e</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span><span class="main">;</span> <span class="free">e2</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span> fst <span class="free">e</span><span class="main">)</span><span class="main">⟧</span>
    <span class="main">⟹</span> co_path <span class="free">e</span> <span class="free">w</span> <span class="main">(</span><span class="free">e1</span> <span class="main">#</span> <span class="free">e2</span> <span class="main">#</span> <span class="free">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>snd <span class="free">e</span><span class="main">,</span> fst <span class="free">e</span><span class="main">)</span> <span class="main">#</span> co_path <span class="free">e</span> <span class="free">w</span> <span class="free">es</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">e1</span> <span class="main">≠</span> <span class="main">(</span>fst <span class="free">e</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">∨</span> <span class="free">e2</span> <span class="main">≠</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span> snd <span class="free">e</span><span class="main">)</span><span class="main">;</span> <span class="free">e1</span> <span class="main">≠</span> <span class="main">(</span>snd <span class="free">e</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">∨</span> <span class="free">e2</span> <span class="main">≠</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span> fst <span class="free">e</span><span class="main">)</span><span class="main">⟧</span>
    <span class="main">⟹</span> co_path <span class="free">e</span> <span class="free">w</span> <span class="main">(</span><span class="free">e1</span> <span class="main">#</span> <span class="free">e2</span> <span class="main">#</span> <span class="free">es</span><span class="main">)</span> <span class="main">=</span> <span class="free">e1</span> <span class="main">#</span> co_path <span class="free">e</span> <span class="free">w</span> <span class="main">(</span><span class="free">e2</span> <span class="main">#</span> <span class="free">es</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">es</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"fst <span class="free">e</span> <span class="main">=</span> snd <span class="free">e</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"fst <span class="free">e</span> <span class="main">=</span> snd <span class="free">e</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Pair_Digraph-co_path_nonempty"><span class="command">lemma</span></span> co_path_nonempty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"co_path <span class="free">e</span> <span class="free">w</span> <span class="free">p</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_exhaust_NSC<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> co_path.simps<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1" id="Pair_Digraph-verts_subdivide"><span class="command">lemma</span></span> verts_subdivide<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pverts <span class="main">(</span>subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> pverts <span class="free">G</span> <span class="main">∪</span> <span class="main">{</span><span class="free">w</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subdivide.simps<span class="main">)</span>

<span class="keyword1" id="Pair_Digraph-arcs_subdivide"><span class="command">lemma</span></span> arcs_subdivide<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"parcs <span class="main">(</span>subdivide <span class="free">G</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>parcs <span class="free">G</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">w</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subdivide.simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> subdivide_simps <span class="main">=</span> verts_subdivide arcs_subdivide

<span class="keyword1" id="Pair_Digraph-sd_path_induct"><span class="command">lemma</span></span> sd_path_induct<span class="main">[</span><span class="operator">case_names</span> empty pass sd sdrev<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">e</span> <span class="main">[]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e'</span> <span class="bound">es</span><span class="main">.</span> <span class="bound">e'</span> <span class="main">≠</span> <span class="free">e</span> <span class="main">⟹</span> <span class="bound">e'</span> <span class="main">≠</span> <span class="main">(</span>snd <span class="free">e</span> <span class="main">,</span> fst <span class="free">e</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">e</span> <span class="bound">es</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">e</span> <span class="main">(</span><span class="bound">e'</span> <span class="main">#</span> <span class="bound">es</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">es</span><span class="main">.</span> <span class="free">P</span> <span class="free">e</span> <span class="bound">es</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">e</span> <span class="main">(</span><span class="free">e</span> <span class="main">#</span> <span class="bound">es</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">es</span><span class="main">.</span> fst <span class="free">e</span> <span class="main">≠</span> snd <span class="free">e</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">e</span> <span class="bound">es</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">e</span> <span class="main">(</span><span class="main">(</span>snd <span class="free">e</span><span class="main">,</span> fst <span class="free">e</span><span class="main">)</span> <span class="main">#</span> <span class="bound">es</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">e</span> <span class="free">es</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">es</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> A<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> B prod.collapse<span class="main">)</span>

<span class="keyword1" id="Pair_Digraph-co_path_induct"><span class="command">lemma</span></span> co_path_induct<span class="main">[</span><span class="operator">case_names</span> empty single co corev pass<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">e</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">w</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> awalk"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">e</span> <span class="free">w</span> <span class="main">[]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ConsNil<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e'</span><span class="main">.</span> <span class="free">P</span> <span class="free">e</span> <span class="free">w</span> <span class="main">[</span><span class="bound">e'</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ConsCons1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e1</span> <span class="bound">e2</span> <span class="bound">es</span><span class="main">.</span> <span class="bound">e1</span> <span class="main">=</span> <span class="main">(</span>fst <span class="free">e</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">e2</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span> snd <span class="free">e</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">e</span> <span class="free">w</span> <span class="bound">es</span> <span class="main">⟹</span>
            <span class="free">P</span> <span class="free">e</span> <span class="free">w</span> <span class="main">(</span><span class="bound">e1</span> <span class="main">#</span> <span class="bound">e2</span> <span class="main">#</span> <span class="bound">es</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ConsCons2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e1</span> <span class="bound">e2</span> <span class="bound">es</span><span class="main">.</span> <span class="main">¬</span><span class="main">(</span><span class="bound">e1</span> <span class="main">=</span> <span class="main">(</span>fst <span class="free">e</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">e2</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span> snd <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
            <span class="bound">e1</span> <span class="main">=</span> <span class="main">(</span>snd <span class="free">e</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">e2</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span> fst <span class="free">e</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">e</span> <span class="free">w</span> <span class="bound">es</span> <span class="main">⟹</span>
            <span class="free">P</span> <span class="free">e</span> <span class="free">w</span> <span class="main">(</span><span class="bound">e1</span> <span class="main">#</span> <span class="bound">e2</span> <span class="main">#</span> <span class="bound">es</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ConsCons3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e1</span> <span class="bound">e2</span> <span class="bound">es</span><span class="main">.</span>
            <span class="main">¬</span> <span class="main">(</span><span class="bound">e1</span> <span class="main">=</span> <span class="main">(</span>fst <span class="free">e</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">e2</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span> snd <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
             <span class="main">¬</span> <span class="main">(</span><span class="bound">e1</span> <span class="main">=</span> <span class="main">(</span>snd <span class="free">e</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">e2</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span> fst <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">e</span> <span class="free">w</span> <span class="main">(</span><span class="bound">e2</span> <span class="main">#</span> <span class="bound">es</span><span class="main">)</span> <span class="main">⟹</span>
            <span class="free">P</span> <span class="free">e</span> <span class="free">w</span> <span class="main">(</span><span class="bound">e1</span> <span class="main">#</span> <span class="bound">e2</span> <span class="main">#</span> <span class="bound">es</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">e</span> <span class="free">w</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> length_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">p</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_exhaust_NSC<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons_Cons <span class="skolem">e1</span> <span class="skolem">e2</span> <span class="skolem">es</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">e</span> <span class="free">w</span> <span class="skolem">es</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">e</span> <span class="free">w</span> <span class="main">(</span><span class="skolem">e2</span> <span class="main">#</span> <span class="skolem">es</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Cons_Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ConsCons1 ConsCons2 ConsCons3<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Nil ConsNil<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Pair_Digraph-co_sd_id"><span class="command">lemma</span></span> co_sd_id<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"co_path <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="free">w</span> <span class="main">(</span>sd_path <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="free">w</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Pair_Digraph-sd_path_id"><span class="command">lemma</span></span> sd_path_id<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sd_path <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="free">w</span> <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_wf_digraph<span class="main">)</span> pair_wf_digraph_subdivide<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∉</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pair_wf_digraph <span class="main">(</span>subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"pair_wf_digraph <span class="var">?sG</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e'</span> <span class="main">∈</span> parcs <span class="var">?sG</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">e'</span> <span class="main">∈</span> pverts <span class="var">?sG</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">e'</span> <span class="main">∈</span> pverts <span class="var">?sG</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> props <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> wellformed<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_sym_digraph<span class="main">)</span> pair_sym_digraph_subdivide<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∉</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pair_sym_digraph <span class="main">(</span>subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"pair_sym_digraph <span class="var">?sG</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> sdG<span class="main">:</span> pair_wf_digraph <span class="quoted"><span class="quoted">"subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_wf_digraph_subdivide<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="main">(</span>subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="main">(</span>subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">=</span> <span class="main">_</span>›</span></span> arcs_subdivide
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> UnE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> UnI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> UnI2<span class="main">)</span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> arcs_symmetric<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"symmetric <span class="var">?sG</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> symmetric_def with_proj_simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> symI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_loopfree_digraph<span class="main">)</span> pair_loopfree_digraph_subdivide<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∉</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pair_loopfree_digraph <span class="main">(</span>subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"pair_loopfree_digraph <span class="var">?sG</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> sdG<span class="main">:</span> pair_wf_digraph <span class="quoted"><span class="quoted">"subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_wf_digraph_subdivide<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> wellformed no_loops<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_bidirected_digraph<span class="main">)</span> pair_bidirected_digraph_subdivide<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∉</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pair_bidirected_digraph <span class="main">(</span>subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"pair_bidirected_digraph <span class="var">?sG</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> sdG<span class="main">:</span> pair_sym_digraph <span class="quoted"><span class="quoted">"subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_sym_digraph_subdivide<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> sdG<span class="main">:</span> pair_loopfree_digraph <span class="quoted"><span class="quoted">"subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_loopfree_digraph_subdivide<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_pseudo_graph<span class="main">)</span> pair_pseudo_graph_subdivide<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∉</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pair_pseudo_graph <span class="main">(</span>subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"pair_pseudo_graph <span class="var">?sG</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> sdG<span class="main">:</span> pair_sym_digraph <span class="quoted"><span class="quoted">"subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_sym_digraph_subdivide<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_graph<span class="main">)</span> pair_graph_subdivide<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∉</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pair_graph <span class="main">(</span>subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"pair_graph <span class="var">?sG</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> PPG<span class="main">:</span> pair_pseudo_graph <span class="quoted"><span class="quoted">"subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_pseudo_graph_subdivide<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> PPG<span class="main">:</span> pair_loopfree_digraph <span class="quoted"><span class="quoted">"subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_loopfree_digraph_subdivide<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Pair_Digraph-arcs_subdivideD"><span class="command">lemma</span></span> arcs_subdivideD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> parcs <span class="main">(</span>subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="free">x</span> <span class="main">≠</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">x</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">context</span></span> pair_sym_digraph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path<span class="main">:</span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> elems<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∉</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> apath_sd_path<span class="main">:</span> <span class="quoted"><span class="quoted">"pre_digraph.apath <span class="main">(</span>subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span><span class="main">)</span> <span class="free">u</span> <span class="main">(</span>sd_path <span class="free">e</span> <span class="free">w</span> <span class="free">p</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> set_awalk_verts_sd_path<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="main">(</span>sd_path <span class="free">e</span> <span class="free">w</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>
      <span class="main">⊆</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">w</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> e_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">sG</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sG</span> <span class="main">=</span> subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> S<span class="main">:</span> pair_sym_digraph <span class="quoted"><span class="skolem">sG</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sG_def <span class="keyword1"><span class="command">using</span></span> elems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_sym_digraph_subdivide<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> ev_sG<span class="main">:</span> <span class="quoted"><span class="quoted">"S.awalk_verts <span class="main">=</span> awalk_verts"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff pre_digraph.awalk_verts_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> w_sG<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="free">w</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="free">w</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> parcs <span class="skolem">sG</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sG_def e_conv<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> path <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"S.apath <span class="free">u</span> <span class="main">(</span>sd_path <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="free">w</span> <span class="free">p</span><span class="main">)</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>S.awalk_verts <span class="free">u</span> <span class="main">(</span>sd_path <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="free">w</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">w</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sd_path_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pverts <span class="skolem">sG</span> <span class="main">=</span> pverts <span class="free">G</span> <span class="main">∪</span> <span class="main">{</span><span class="free">w</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sG_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_Nil_iff S.apath_Nil_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pass <span class="skolem">e'</span> <span class="skolem">es</span><span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"S.apath <span class="main">(</span>snd <span class="skolem">e'</span><span class="main">)</span> <span class="main">(</span>sd_path <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="free">w</span> <span class="skolem">es</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">e'</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> set <span class="main">(</span>S.awalk_verts <span class="main">(</span>snd <span class="skolem">e'</span><span class="main">)</span> <span class="main">(</span>sd_path <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="free">w</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> pass elems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_Cons_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e'</span> <span class="main">∈</span> parcs <span class="skolem">sG</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 pass <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> e_conv sG_def S.apath_Cons_iff apath_Cons_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> pass <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S.apath_Cons_iff<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">note</span></span> case1 <span class="main">=</span> this
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">with</span></span> pass 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apath_Cons_iff<span class="main">)</span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">es</span> <span class="skolem">a</span> <span class="skolem">b</span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"apath <span class="skolem">u</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">es</span><span class="main">)</span> <span class="free">v</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> hyps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> apath <span class="bound">u</span> <span class="skolem">es</span> <span class="free">v</span> <span class="main">⟹</span> S.apath <span class="bound">u</span> <span class="main">(</span>sd_path <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">w</span> <span class="skolem">es</span><span class="main">)</span> <span class="free">v</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> apath <span class="bound">u</span> <span class="skolem">es</span> <span class="free">v</span> <span class="main">⟹</span> set <span class="main">(</span>awalk_verts <span class="bound">u</span> <span class="main">(</span>sd_path <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">w</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>awalk_verts <span class="bound">u</span> <span class="skolem">es</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">w</span><span class="main">}</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> ab A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">es</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">es</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_Cons_iff <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> awalkI_apath <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> awalk_verts_arc1 awalk_verts_arc2<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ev_sd<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>S.awalk_verts <span class="skolem">b</span> <span class="main">(</span>sd_path <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="free">w</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>awalk_verts <span class="skolem">b</span> <span class="skolem">es</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sd_path_id<span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> A ab <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apath_Cons_iff<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> awalkI_apath awalk_verts_non_Nil awhd_of_awalk hd_in_set<span class="main">)</span>
 
      <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"S.apath <span class="skolem">b</span> <span class="main">(</span>sd_path <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="free">w</span> <span class="skolem">es</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ab hyps elems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_Cons_iff wellformed'<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"S.awalk <span class="skolem">u</span> <span class="main">(</span>sd_path <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">w</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span> <span class="free">v</span> "</span></span>
        <span class="keyword1"><span class="command">using</span></span> ab w_sG <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S.apath_def S.awalk_simps S.wellformed'<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> set <span class="main">(</span>S.awalk_verts <span class="free">w</span> <span class="main">(</span><span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">#</span> sd_path <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="free">w</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ab <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="free">w</span>›</span></span> ev_sd A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_Cons_iff S.awalk_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∉</span> set <span class="main">(</span>awalk_verts <span class="skolem">b</span> <span class="main">(</span>sd_path <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">w</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ab ev_sd A elems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_Cons_iff apath_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword1"><span class="command">have</span></span> path<span class="main">:</span> <span class="quoted"><span class="quoted">"S.apath <span class="skolem">u</span> <span class="main">(</span>sd_path <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">w</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span> <span class="free">v</span> "</span></span>
        <span class="keyword1"><span class="command">using</span></span> ab hyps w_sG <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S.apath_Cons_iff <span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">note</span></span> path <span class="main">=</span> this
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sd <span class="skolem">es</span><span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">with</span></span> sd <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> path<span class="main">)</span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2 sd
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_Cons_iff<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>sdrev <span class="skolem">es</span><span class="main">)</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">with</span></span> sdrev <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> path<span class="main">)</span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2 sdrev
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_Cons_iff<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sG_def e_conv <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> elems<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∉</span> pverts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> pverts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path<span class="main">:</span> <span class="quoted"><span class="quoted">"pre_digraph.apath <span class="main">(</span>subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span><span class="main">)</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> apath_co_path<span class="main">:</span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="free">p</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis_path</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> set_awalk_verts_co_path<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">w</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis_set</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> e_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">interpret</span></span> S<span class="main">:</span> pair_sym_digraph <span class="quoted"><span class="quoted">"subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> elems<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_sym_digraph_subdivide<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> e_w<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="free">e</span> <span class="main">≠</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">e</span> <span class="main">≠</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> elems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"S.apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> elems path <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> co_path<span class="main">:</span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="free">p</span><span class="main">)</span> <span class="free">v</span>
    <span class="main">∧</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">w</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> co_path_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword1"><span class="command">with</span></span> elems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apath_Nil_iff S.apath_Nil_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>single <span class="skolem">e'</span><span class="main">)</span> <span class="keyword1"><span class="command">with</span></span> elems <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_Cons_iff S.apath_Cons_iff apath_Nil_iff S.apath_Nil_iff
        <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> arcs_subdivideD<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>co <span class="skolem">e1</span> <span class="skolem">e2</span> <span class="skolem">es</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apath <span class="skolem">u</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="main">(</span><span class="skolem">e1</span> <span class="main">#</span> <span class="skolem">e2</span> <span class="main">#</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> co e_w elems
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_Cons_iff S.apath_Cons_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="main">(</span><span class="skolem">e1</span> <span class="main">#</span> <span class="skolem">e2</span> <span class="main">#</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="main">(</span><span class="skolem">e1</span> <span class="main">#</span> <span class="skolem">e2</span> <span class="main">#</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">w</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> co e_w <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_Cons_iff S.apath_Cons_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>corev <span class="skolem">e1</span> <span class="skolem">e2</span> <span class="skolem">es</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apath <span class="skolem">u</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="main">(</span><span class="skolem">e1</span> <span class="main">#</span> <span class="skolem">e2</span> <span class="main">#</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> corev<span class="main">(</span>1-3<span class="main">)</span> e_w<span class="main">(</span>1<span class="main">)</span> elems<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_Cons_iff S.apath_Cons_iff  <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> arcs_symmetric<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="main">(</span><span class="skolem">e1</span> <span class="main">#</span> <span class="skolem">e2</span> <span class="main">#</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="main">(</span><span class="skolem">e1</span> <span class="main">#</span> <span class="skolem">e2</span> <span class="main">#</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">w</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> corev e_w <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_Cons_iff S.apath_Cons_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pass <span class="skolem">e1</span> <span class="skolem">e2</span> <span class="skolem">es</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">e1</span> <span class="main">≠</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> elems pass.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S.apath_Cons_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">e1</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">e1</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">∉</span> parcs <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> elems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">∈</span> parcs <span class="main">(</span>subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span><span class="main">)</span> <span class="main">-</span> parcs <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> pass <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S.apath_Cons_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">e1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="free">w</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹fst <span class="skolem">e1</span> <span class="main">≠</span> <span class="free">w</span>›</span></span> e_w <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">e2</span> <span class="main">=</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹snd <span class="skolem">e1</span> <span class="main">=</span> <span class="free">w</span>›</span></span> pass.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S.apath_Cons_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span> <span class="main">∉</span> parcs <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> elems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span> <span class="main">∈</span> parcs <span class="main">(</span>subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span><span class="main">)</span> <span class="main">-</span> parcs <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> pass <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S.apath_Cons_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">e2</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹fst <span class="skolem">e2</span> <span class="main">=</span> <span class="free">w</span>›</span></span> e_w <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e2</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e_conv<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">e2</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">e1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">e2</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> pass.hyps<span class="main">[</span><span class="operator">simplified</span> e_conv<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> pass.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">es</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S.apath_Cons_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹fst <span class="skolem">e1</span> <span class="main">≠</span> <span class="free">w</span>›</span></span> pass.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S.apath_Cons_iff <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> arcs_subdivideD<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> ih<span class="main">:</span> <span class="quoted"><span class="quoted">"apath <span class="main">(</span>snd <span class="skolem">e1</span><span class="main">)</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="main">(</span><span class="skolem">e2</span> <span class="main">#</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span> <span class="free">v</span> <span class="main">∧</span> set <span class="main">(</span>awalk_verts <span class="main">(</span>snd <span class="skolem">e1</span><span class="main">)</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="main">(</span><span class="skolem">e2</span> <span class="main">#</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>awalk_verts <span class="main">(</span>snd <span class="skolem">e1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">e2</span> <span class="main">#</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">w</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pass.prems <span class="quoted"><span class="quoted">‹snd <span class="skolem">e1</span> <span class="main">≠</span> <span class="free">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> pass.IH<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_Cons_iff S.apath_Cons_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">e1</span> <span class="main">∉</span> set <span class="main">(</span>awalk_verts <span class="main">(</span>snd <span class="skolem">e1</span><span class="main">)</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="main">(</span><span class="skolem">e2</span> <span class="main">#</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">e1</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pass.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S.apath_Cons_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apath <span class="skolem">u</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="main">(</span><span class="skolem">e1</span> <span class="main">#</span> <span class="skolem">e2</span> <span class="main">#</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ih pass <span class="quoted"><span class="quoted">‹<span class="skolem">e1</span> <span class="main">∈</span> parcs <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_Cons_iff S.apath_Cons_iff<span class="main">)</span><span class="main"><span class="keyword3">[</span></span><span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="main">(</span><span class="skolem">e1</span> <span class="main">#</span> <span class="skolem">e2</span> <span class="main">#</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="main">(</span><span class="skolem">e1</span> <span class="main">#</span> <span class="skolem">e2</span> <span class="main">#</span> <span class="skolem">es</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">w</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pass.hyps ih <span class="quoted"><span class="quoted">‹fst <span class="skolem">e1</span> <span class="main">≠</span> <span class="free">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis_set</span></span></span> <span class="var"><span class="quoted"><span class="var">?thesis_path</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Bidirected Graphs›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> -<span class="main">)</span> <span class="entity">swap_in</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">swap_in</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1">then</span> prod.swap <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Pair_Digraph-bidirected_digraph_rev_conv_pair"><span class="command">lemma</span></span> bidirected_digraph_rev_conv_pair<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bidirected_digraph <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span> <span class="free">rev_G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">rev_G</span> <span class="main">=</span> swap_in <span class="main">(</span>parcs <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> bidirected_digraph <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">rev_G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="free">G</span> <span class="main">⟹</span> <span class="free">rev_G</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tail_arev<span class="main">[</span><span class="operator">simplified</span> with_proj_simps<span class="main">]</span> head_arev<span class="main">[</span><span class="operator">simplified</span> with_proj_simps<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_conv prod.collapse snd_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> swap_in_def fun_eq_iff arev_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_bidirected_digraph<span class="main">)</span> bidirected_digraph<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bidirected_digraph <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span> <span class="main">(</span>swap_in <span class="main">(</span>parcs <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> no_loops' arcs_symmetric
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> swap_in_def<span class="main">)</span>

<span class="keyword1" id="Pair_Digraph-pair_bidirected_digraphI_bidirected_digraph"><span class="command">lemma</span></span> pair_bidirected_digraphI_bidirected_digraph<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bidirected_digraph <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span> <span class="main">(</span>swap_in <span class="main">(</span>parcs <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pair_bidirected_digraph <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> bidirected_digraph <span class="quoted"><span class="quoted">"with_proj <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"swap_in <span class="main">(</span>parcs <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">a</span> <span class="main">≠</span> snd <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> arev_neq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> bidirected_digraph_rev_conv_pair<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> swap_in_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> tail_in_verts head_in_verts <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Digraph_Component">
<div class="head">
<h1>Theory Digraph_Component</h1>
</div>
<pre class="source"><span class="comment1">(* Title:  Digraph_Component.thy
   Author: Lars Noschinski, TU München
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Digraph_Component
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Digraph.html">Digraph</a>
  <a href="Arc_Walk.html">Arc_Walk</a>
  <a href="Pair_Digraph.html">Pair_Digraph</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Components of (Symmetric) Digraphs›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">compatible</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">compatible</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">≡</span> tail <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> tail <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">∧</span> head <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> head <span class="free"><span class="bound"><span class="entity">H</span></span></span>"</span></span>

<span class="comment1">(* Require @{term "wf_digraph G"}? *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subgraph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subgraph</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> verts <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">⊆</span> verts <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> arcs <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">⊆</span> arcs <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> wf_digraph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> wf_digraph <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">∧</span> compatible <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">induced_subgraph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">induced_subgraph</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> subgraph <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> arcs <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> arcs <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> tail <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">e</span> <span class="main">∈</span> verts <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">∧</span> head <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">e</span> <span class="main">∈</span> verts <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">spanning</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">spanning</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> subgraph <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> verts <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> verts <span class="free"><span class="bound"><span class="entity">H</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">strongly_connected</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">strongly_connected</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> verts <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> verts <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> verts <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="bound">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">G</span></span></span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following function computes underlying symmetric graph of a digraph
  and removes parallel arcs.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_symmetric</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="tfree">'a</span> pair_pre_digraph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mk_symmetric</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">⦇</span> pverts <span class="main">=</span> verts <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> parcs <span class="main">=</span> <span class="main">⋃</span><span class="bound">e</span><span class="main">∈</span>arcs <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="main">{</span><span class="main">(</span>tail <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">e</span><span class="main">,</span> head <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">e</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>head <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">e</span><span class="main">,</span> tail <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">e</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">connected</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">connected</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> strongly_connected <span class="main">(</span>mk_symmetric <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">forest</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">forest</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> pre_digraph.cycle <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">p</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">tree</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> connected <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> forest <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">spanning_tree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">spanning_tree</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> tree <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">∧</span> spanning <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span>
  <span class="entity">max_subgraph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span>  bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">max_subgraph</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">≡</span> subgraph <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free">G</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">H'</span><span class="main">.</span> <span class="bound">H'</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">∧</span> subgraph <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="bound">H'</span> <span class="main">⟶</span> <span class="main">¬</span><span class="main">(</span>subgraph <span class="bound">H'</span> <span class="free">G</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">H'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> <span class="entity">sccs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sccs</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">H</span><span class="main">.</span> induced_subgraph <span class="bound">H</span> <span class="free">G</span> <span class="main">∧</span> strongly_connected <span class="bound">H</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">H'</span><span class="main">.</span> induced_subgraph <span class="bound">H'</span> <span class="free">G</span>
      <span class="main">∧</span> strongly_connected <span class="bound">H'</span> <span class="main">∧</span> verts <span class="bound">H</span> <span class="main">⊂</span> verts <span class="bound">H'</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> <span class="entity">sccs_verts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sccs_verts</span> <span class="main">=</span> <span class="main">{</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> <span class="bound">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="bound">S</span> <span class="main">⟶</span> <span class="main">¬</span><span class="bound">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">v</span> <span class="main">∨</span> <span class="main">¬</span><span class="bound">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">u</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="comment1">(*XXX:  "sccs_verts = verts ` sccs" *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> <span class="entity">scc_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">scc_of</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="bound">v</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">union</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">union</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">≡</span> <span class="main">⦇</span> verts <span class="main">=</span> verts <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∪</span> verts <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">,</span> arcs <span class="main">=</span> arcs <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∪</span> arcs <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">,</span> tail <span class="main">=</span> tail <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> head <span class="main">=</span> head <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> <span class="entity">Union</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Union</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span> <span class="main">=</span> <span class="main">⦇</span> verts <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">G</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">.</span> verts <span class="bound">G</span><span class="main">)</span><span class="main">,</span> arcs <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">G</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">.</span> arcs <span class="bound">G</span><span class="main">)</span><span class="main">,</span>
    tail <span class="main">=</span> tail <span class="free">G</span> <span class="main">,</span> head <span class="main">=</span> head <span class="free">G</span>  <span class="main">⦈</span>"</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Compatible Graphs›</span></span>

<span class="keyword1" id="Digraph_Component-compatible_tail"><span class="command">lemma</span></span> compatible_tail<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">G</span> <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="main">=</span> tail <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff compatible_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-compatible_head"><span class="command">lemma</span></span> compatible_head<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">G</span> <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="main">=</span> head <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff compatible_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-compatible_cas"><span class="command">lemma</span></span> compatible_cas<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">G</span> <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pre_digraph.cas <span class="free">G</span> <span class="main">=</span> pre_digraph.cas <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> fun_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">es</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pre_digraph.cas <span class="free">G</span> <span class="skolem">u</span> <span class="skolem">es</span> <span class="skolem">v</span> <span class="main">=</span> pre_digraph.cas <span class="free">H</span> <span class="skolem">u</span> <span class="skolem">es</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">es</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pre_digraph.cas.simps compatible_head compatible_tail<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digraph_Component-compatible_awalk_verts"><span class="command">lemma</span></span> compatible_awalk_verts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">G</span> <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pre_digraph.awalk_verts <span class="free">G</span> <span class="main">=</span> pre_digraph.awalk_verts <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> fun_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">es</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pre_digraph.awalk_verts <span class="free">G</span> <span class="skolem">u</span> <span class="skolem">es</span> <span class="main">=</span> pre_digraph.awalk_verts <span class="free">H</span> <span class="skolem">u</span> <span class="skolem">es</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">es</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pre_digraph.awalk_verts.simps compatible_head compatible_tail<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digraph_Component-compatibleI_with_proj"><span class="command">lemma</span></span> compatibleI_with_proj<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"compatible <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span> <span class="main">(</span>with_proj <span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compatible_def<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic lemmas›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> sym_digraph<span class="main">)</span> graph_symmetric<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> arcs_ends <span class="free">G</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">u</span><span class="main">)</span> <span class="main">∈</span> arcs_ends <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sym_arcs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> symmetric_def sym_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-strongly_connectedI"><span class="command">lemma</span></span> strongly_connectedI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟹</span> <span class="bound">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strongly_connected <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strongly_connected_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-strongly_connectedE"><span class="command">lemma</span></span> strongly_connectedE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strongly_connected <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟹</span> <span class="bound">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strongly_connected_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-subgraph_imp_subverts"><span class="command">lemma</span></span> subgraph_imp_subverts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">H</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subgraph_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-induced_imp_subgraph"><span class="command">lemma</span></span> induced_imp_subgraph<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> induced_subgraph_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> in_sccs_imp_induced<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> sccs"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="free">c</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sccs_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-spanning_tree_imp_tree"><span class="command">lemma</span></span> spanning_tree_imp_tree<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"spanning_tree <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tree <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spanning_tree_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-tree_imp_connected"><span class="command">lemma</span></span> tree_imp_connected<span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tree <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tree_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-spanning_treeI"><span class="command">lemma</span></span> spanning_treeI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"spanning <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tree <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"spanning_tree <span class="free">H</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spanning_tree_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-spanning_treeE"><span class="command">lemma</span></span> spanning_treeE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"spanning_tree <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tree <span class="free">H</span> <span class="main">∧</span> spanning <span class="free">H</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spanning_tree_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-spanningE"><span class="command">lemma</span></span> spanningE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"spanning <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span> <span class="main">∧</span> verts <span class="free">G</span> <span class="main">=</span> verts <span class="free">H</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spanning_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> in_sccsI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="free">c</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strongly_connected <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">c'</span><span class="main">.</span> induced_subgraph <span class="bound">c'</span> <span class="free">G</span> <span class="main">∧</span> strongly_connected <span class="bound">c'</span> <span class="main">∧</span>
    verts <span class="free">c</span> <span class="main">⊂</span> verts <span class="bound">c'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> sccs"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sccs_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> in_sccsE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> sccs"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="free">c</span> <span class="free">G</span> <span class="main">⟹</span> strongly_connected <span class="free">c</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">d</span><span class="main">.</span>
    induced_subgraph <span class="bound">d</span> <span class="free">G</span> <span class="main">∧</span> strongly_connected <span class="bound">d</span> <span class="main">∧</span> verts <span class="free">c</span> <span class="main">⊂</span> verts <span class="bound">d</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sccs_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-subgraphI"><span class="command">lemma</span></span> subgraphI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">H</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"arcs <span class="free">H</span> <span class="main">⊆</span> arcs <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">G</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subgraph_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-subgraphE"><span class="command">lemma</span></span> subgraphE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">H</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"arcs <span class="free">H</span> <span class="main">⊆</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">G</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subgraph_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-induced_subgraphI"><span class="command">lemma</span></span> induced_subgraphI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"arcs <span class="free">H</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> arcs <span class="free">G</span><span class="main">.</span> tail <span class="free">G</span> <span class="bound">e</span> <span class="main">∈</span> verts <span class="free">H</span> <span class="main">∧</span> head <span class="free">G</span> <span class="bound">e</span> <span class="main">∈</span> verts <span class="free">H</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> induced_subgraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">safe</span>

<span class="keyword1" id="Digraph_Component-induced_subgraphE"><span class="command">lemma</span></span> induced_subgraphE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>subgraph <span class="free">H</span> <span class="free">G</span><span class="main">;</span> arcs <span class="free">H</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> arcs <span class="free">G</span><span class="main">.</span> tail <span class="free">G</span> <span class="bound">e</span> <span class="main">∈</span> verts <span class="free">H</span> <span class="main">∧</span> head <span class="free">G</span> <span class="bound">e</span> <span class="main">∈</span> verts <span class="free">H</span><span class="main">}</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> induced_subgraph_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-pverts_mk_symmetric"><span class="command">lemma</span></span> pverts_mk_symmetric<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pverts <span class="main">(</span>mk_symmetric <span class="free">G</span><span class="main">)</span> <span class="main">=</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> parcs_mk_symmetric<span class="main">:</span>
    <span class="quoted"><span class="quoted">"parcs <span class="main">(</span>mk_symmetric <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">e</span><span class="main">∈</span>arcs <span class="free">G</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span>tail <span class="free">G</span> <span class="bound">e</span><span class="main">,</span> head <span class="free">G</span> <span class="bound">e</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>head <span class="free">G</span> <span class="bound">e</span><span class="main">,</span> tail <span class="free">G</span> <span class="bound">e</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_symmetric_def arcs_ends_conv image_UN<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-arcs_ends_mono"><span class="command">lemma</span></span> arcs_ends_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"arcs_ends <span class="free">H</span> <span class="main">⊆</span> arcs_ends <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subgraph_def arcs_ends_conv compatible_tail compatible_head<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> subgraph_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="free">G</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgraph_def compatible_def<span class="main">)</span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> induced_subgraph_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="free">G</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> induced_subgraphI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgraph_refl<span class="main">)</span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The underlying symmetric graph of a digraph›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> wellformed_mk_symmetric<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pair_wf_digraph <span class="main">(</span>mk_symmetric <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> parcs_mk_symmetric<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> pair_fin_digraph_mk_symmetric<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pair_fin_digraph <span class="main">(</span>mk_symmetric <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> arcs_ends <span class="free">G</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?X</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arcs_ends_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> arcs_ends <span class="free">G</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">...</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_symmetric_def arcs_ends_conv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> digraph<span class="main">)</span> digraph_mk_symmetric<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pair_digraph <span class="main">(</span>mk_symmetric <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> arcs_ends <span class="free">G</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?X</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arcs_ends_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> arcs_ends <span class="free">G</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">...</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_symmetric_def arc_to_ends_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> no_loops<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> reachable_mk_symmetricI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub>mk_symmetric <span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arcs_ends <span class="free">G</span> <span class="main">⊆</span> parcs <span class="main">(</span>mk_symmetric <span class="free">G</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="main">(</span>pverts <span class="main">(</span>mk_symmetric <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>arcs_ends <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> reachable_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> parcs_mk_symmetric<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> reachable_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_on_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> adj_mk_symmetric_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"symmetric <span class="free">G</span> <span class="main">⟹</span> parcs <span class="main">(</span>mk_symmetric <span class="free">G</span><span class="main">)</span> <span class="main">=</span> arcs_ends <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> parcs_mk_symmetric in_arcs_imp_in_arcs_ends arcs_ends_symmetric<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> reachable_mk_symmetric_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"symmetric <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub>mk_symmetric <span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span> <span class="main">⟷</span> <span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> adj_mk_symmetric_eq<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> reachable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> mk_symmetric_awalk_imp_awalk<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sym<span class="main">:</span> <span class="quoted"><span class="quoted">"symmetric <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> walk<span class="main">:</span> <span class="quoted"><span class="quoted">"pre_digraph.awalk <span class="main">(</span>mk_symmetric <span class="free">G</span><span class="main">)</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">q</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> S<span class="main">:</span> pair_wf_digraph <span class="quoted"><span class="quoted">"mk_symmetric <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> walk <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub>mk_symmetric <span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> S.reachable_awalk<span class="main">)</span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> reachable_mk_symmetric_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sym<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reachable_awalk <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digraph_Component-symmetric_mk_symmetric"><span class="command">lemma</span></span> symmetric_mk_symmetric<span class="main">:</span>
  <span class="quoted"><span class="quoted">"symmetric <span class="main">(</span>mk_symmetric <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> symmetric_def parcs_mk_symmetric <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> symI<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Subgraphs and Induced Subgraphs›</span></span>

<span class="keyword1" id="Digraph_Component-subgraph_trans"><span class="command">lemma</span></span> subgraph_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">G</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">G</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgraph_def compatible_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">digraph</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">fin_digraph</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> properties are preserved under
  the (inverse) subgraph relation
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> fin_digraph_subgraph<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fin_digraph <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro_locales</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> HG<span class="main">:</span> <span class="quoted"><span class="quoted">"arcs <span class="free">H</span> <span class="main">⊆</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">H</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>verts <span class="free">H</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>arcs <span class="free">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_verts finite_arcs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fin_digraph_axioms <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> digraph<span class="main">)</span> digraph_subgraph<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"digraph <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> arcs <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">H</span> <span class="skolem">e</span> <span class="main">∈</span> verts <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"head <span class="free">H</span> <span class="skolem">e</span> <span class="main">∈</span> verts <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgraph_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_digraph.wellformed<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> e <span class="keyword2"><span class="keyword">and</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> arcs <span class="free">H</span> <span class="main">∩</span> arcs <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">H</span> <span class="skolem">e</span> <span class="main">≠</span> head <span class="free">H</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_loops <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgraph_def compatible_def arc_to_ends_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arcs <span class="free">H</span> <span class="main">⊆</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">H</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>arcs <span class="free">H</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>verts <span class="free">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_verts finite_arcs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e1</span> <span class="skolem">e2</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">∈</span> arcs <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span> <span class="main">∈</span> arcs <span class="free">H</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"arc_to_ends <span class="free">H</span> <span class="skolem">e1</span> <span class="main">=</span> arc_to_ends <span class="free">H</span> <span class="skolem">e2</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">∈</span> arcs <span class="free">H</span> <span class="main">∩</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span> <span class="main">∈</span> arcs <span class="free">H</span> <span class="main">∩</span> arcs <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> eq <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">=</span> <span class="skolem">e2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_multi_arcs assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgraph_def compatible_def arc_to_ends_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> adj_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> arcs_ends_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> reachable_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> walk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">H</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> reachable_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> arcs_ends_mono rtrancl_on_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Arc walks and paths are preserved under the subgraph relation.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> subgraph_awalk_imp_awalk<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> walk<span class="main">:</span> <span class="quoted"><span class="quoted">"pre_digraph.awalk <span class="free">H</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.awalk_def compatible_cas<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> subgraph_apath_imp_apath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path<span class="main">:</span> <span class="quoted"><span class="quoted">"pre_digraph.apath <span class="free">H</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> pre_digraph.apath_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subgraph_awalk_imp_awalk <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compatible_awalk_verts<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-subgraph_mk_symmetric"><span class="command">lemma</span></span> subgraph_mk_symmetric<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span>mk_symmetric <span class="free">H</span><span class="main">)</span> <span class="main">(</span>mk_symmetric <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subgraphI<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?wpms</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">G</span><span class="main">.</span> mk_symmetric <span class="bound">G</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">G</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"verts <span class="main">(</span><span class="var">?wpms</span> <span class="free">H</span><span class="main">)</span>  <span class="main">⊆</span> verts <span class="main">(</span><span class="var">?wpms</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arcs <span class="main">(</span><span class="var">?wpms</span> <span class="free">H</span><span class="main">)</span> <span class="main">⊆</span> arcs <span class="main">(</span><span class="var">?wpms</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> parcs_mk_symmetric compatible_head compatible_tail<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compatible <span class="main">(</span><span class="var">?wpms</span> <span class="free">G</span><span class="main">)</span> <span class="main">(</span><span class="var">?wpms</span> <span class="free">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> pair_wf_digraph <span class="quoted"><span class="quoted">"mk_symmetric <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_digraph.wellformed_mk_symmetric<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> G<span class="main">:</span> pair_wf_digraph <span class="quoted"><span class="quoted">"mk_symmetric <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_digraph.wellformed_mk_symmetric<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="main">(</span><span class="var">?wpms</span> <span class="free">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="main">(</span><span class="var">?wpms</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> subgraph_in_degree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"in_degree <span class="free">H</span> <span class="free">v</span> <span class="main">≤</span> in_degree <span class="free">G</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>in_arcs <span class="free">G</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_arcs <span class="free">H</span> <span class="free">v</span> <span class="main">⊆</span> in_arcs <span class="free">G</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgraph_def in_arcs_def compatible_head compatible_tail<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> in_degree_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> subgraph_cycle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"pre_digraph.cycle <span class="free">H</span> <span class="free">p</span> "</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cycle <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">G</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.cycle_def compatible_awalk_verts <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subgraph_awalk_imp_awalk<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> subgraph_del_vert<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span>del_vert <span class="free">u</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgraph_def compatible_def del_vert_simps wf_digraph_del_vert<span class="main">)</span> <span class="operator">intro_locales</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> subgraph_del_arc<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span>del_arc <span class="free">a</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgraph_def compatible_def del_vert_simps wf_digraph_del_vert<span class="main">)</span> <span class="operator">intro_locales</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Induced subgraphs›</span></span>

<span class="keyword1" id="Digraph_Component-wf_digraphI_induced"><span class="command">lemma</span></span> wf_digraphI_induced<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">G</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compatible_tail compatible_head<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> digraph<span class="main">)</span> digraphI_induced<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"digraph <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> W<span class="main">:</span> wf_digraph <span class="quoted"><span class="free">H</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wf_digraphI_induced<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">G</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> arcs<span class="main">:</span> <span class="quoted"><span class="quoted">"arcs <span class="free">H</span> <span class="main">⊆</span> arcs <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">H</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>verts <span class="free">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_verts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">from</span></span> arcs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>arcs <span class="free">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_arcs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> arcs <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> arcs <span class="quoted"><span class="quoted">‹compatible <span class="free">G</span> <span class="free">H</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">H</span> <span class="skolem">e</span> <span class="main">≠</span> head <span class="free">H</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> no_loops <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compatible_tail<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> compatible_head<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e1</span> <span class="skolem">e2</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">∈</span> arcs <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span> <span class="main">∈</span> arcs <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ate<span class="main">:</span> <span class="quoted"><span class="quoted">"arc_to_ends <span class="free">H</span> <span class="skolem">e1</span> <span class="main">=</span> arc_to_ends <span class="free">H</span> <span class="skolem">e2</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> arcs <span class="quoted"><span class="quoted">‹compatible <span class="free">G</span> <span class="free">H</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">=</span> <span class="skolem">e2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ate
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> no_multi_arcs <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compatible_tail<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> compatible_head<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> arc_to_ends_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Computes the subgraph of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> induced by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">vs</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">induce_subgraph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">↾</span>"</span> 67<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main"><span class="free">↾</span></span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">=</span> <span class="main">⦇</span> verts <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">,</span> arcs <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> arcs <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> tail <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">e</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span> <span class="main">∧</span> head <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">e</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">vs</span></span></span><span class="main">}</span><span class="main">,</span>
    tail <span class="main">=</span> tail <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> head <span class="main">=</span> head <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⦈</span>"</span></span>

<span class="keyword1" id="Digraph_Component-induce_subgraph_verts"><span class="command">lemma</span></span> induce_subgraph_verts<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"verts <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="free">vs</span><span class="main">)</span> <span class="main">=</span> <span class="free">vs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> induce_subgraph_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-induce_subgraph_arcs"><span class="command">lemma</span></span> induce_subgraph_arcs<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"arcs <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="free">vs</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> arcs <span class="free">G</span><span class="main">.</span> tail <span class="free">G</span> <span class="bound">e</span> <span class="main">∈</span> <span class="free">vs</span> <span class="main">∧</span> head <span class="free">G</span> <span class="bound">e</span> <span class="main">∈</span> <span class="free">vs</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> induce_subgraph_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-induce_subgraph_tail"><span class="command">lemma</span></span> induce_subgraph_tail<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"tail <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="free">vs</span><span class="main">)</span> <span class="main">=</span> tail <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> induce_subgraph_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-induce_subgraph_head"><span class="command">lemma</span></span> induce_subgraph_head<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"head <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="free">vs</span><span class="main">)</span> <span class="main">=</span> head <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> induce_subgraph_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-compatible_induce_subgraph"><span class="command">lemma</span></span> compatible_induce_subgraph<span class="main">:</span> <span class="quoted"><span class="quoted">"compatible <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="free">S</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compatible_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> induced_induce<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="free">vs</span><span class="main">)</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subgraphI induced_subgraphI<span class="main">)</span>
   <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_to_ends_def induce_subgraph_def wf_digraph_def compatible_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> wellformed_induce_subgraph<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"wf_digraph <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1" id="Digraph_Component-induced_graph_imp_symmetric"><span class="command">lemma</span></span> induced_graph_imp_symmetric<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"symmetric <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"symmetric <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> symmetric_conv<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">G</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e1</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">∈</span> arcs <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="skolem">e1</span> <span class="main">=</span> head <span class="free">G</span> <span class="skolem">e2</span>"</span></span>  <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="skolem">e1</span> <span class="main">=</span> tail <span class="free">G</span> <span class="skolem">e2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> symmetric_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span> <span class="main">∈</span> arcs <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e1</span> <span class="main">∈</span> arcs <span class="free">H</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e2</span><span class="main">∈</span>arcs <span class="free">H</span><span class="main">.</span> tail <span class="free">H</span> <span class="skolem">e1</span> <span class="main">=</span> head <span class="free">H</span> <span class="bound">e2</span> <span class="main">∧</span> head <span class="free">H</span> <span class="skolem">e1</span> <span class="main">=</span> tail <span class="free">H</span> <span class="bound">e2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">e1</span> <span class="main">∈</span> arcs <span class="free">H</span>›</span></span> <span class="quoted"><span class="quoted">‹compatible <span class="free">G</span> <span class="free">H</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compatible_head compatible_tail<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> sym_digraph<span class="main">)</span> induced_graph_imp_graph<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sym_digraph <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wf_digraph.sym_digraphI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wf_digraphI_induced<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"symmetric <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms sym_arcs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> induced_graph_imp_symmetric<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> induce_reachable_preserves_paths<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="main">{</span><span class="bound">w</span><span class="main">.</span> <span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">w</span><span class="main">}</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
  <span class="keyword3"><span class="command">case</span></span> base <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reachable_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">u</span> <span class="skolem">w</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> iG<span class="main">:</span> wf_digraph <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">↾</span> <span class="main">{</span><span class="bound">w</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">w</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wellformed_induce_subgraph<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">→</span> <span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="main">{</span><span class="bound">wa</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">wa</span><span class="main">}</span></sub><span class="hidden">⇙</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arcs_ends_conv reachable_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wellformed rtrancl_on_into_rtrancl_on<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="main">{</span><span class="bound">wa</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">wa</span><span class="main">}</span></sub><span class="hidden">⇙</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iG.reachable_adjI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> step <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">w</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="bound">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> adj_reachable_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="main">{</span><span class="bound">wa</span><span class="main">.</span> <span class="skolem">w</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="bound">wa</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="main">{</span><span class="bound">wa</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="bound">wa</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subgraphI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arcs_ends_conv compatible_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="main">{</span><span class="bound">wa</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="bound">wa</span><span class="main">}</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iG.reachable_mono<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iG.reachable_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digraph_Component-induce_subgraph_ends"><span class="command">lemma</span></span> induce_subgraph_ends<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"arc_to_ends <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> arc_to_ends <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_to_ends_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-dominates_induce_subgraphD"><span class="command">lemma</span></span> dominates_induce_subgraphD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="free">S</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arcs_ends_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> wf_digraph <span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1" id="Digraph_Component-reachable_induce_subgraphD"><span class="command">lemma</span></span> reachable_induce_subgraphD<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="free">S</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">interpret</span></span> GS<span class="main">:</span> wf_digraph <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">↾</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> dominates_induce_subgraphD <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> adj_reachable_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Digraph_Component-dominates_induce_ss"><span class="command">lemma</span></span> dominates_induce_ss<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="free">S</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="free">T</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arcs_ends_def<span class="main">)</span>

  <span class="keyword1" id="Digraph_Component-reachable_induce_ss"><span class="command">lemma</span></span> reachable_induce_ss<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="free">S</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="free">T</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> reachable_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> dominates_induce_ss converse_rtrancl_on_into_rtrancl_on<span class="main">)</span>

  <span class="keyword1" id="Digraph_Component-awalk_verts_induce"><span class="command">lemma</span></span> awalk_verts_induce<span class="main">:</span>
    <span class="quoted"><span class="quoted">"pre_digraph.awalk_verts <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> awalk_verts"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pre_digraph.awalk_verts <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="free">S</span><span class="main">)</span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="main">=</span> awalk_verts <span class="skolem">u</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.awalk_verts.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> -<span class="main">)</span> cas_subset<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pre_digraph.cas <span class="free">G</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">G</span> <span class="free">H</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pre_digraph.cas <span class="free">H</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.cas.simps subgraph_def compatible_def<span class="main">)</span>

  <span class="keyword1" id="Digraph_Component-cas_induce"><span class="command">lemma</span></span> cas_induce<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cas <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pre_digraph.cas <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="free">S</span><span class="main">)</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">S</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.cas.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">as</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre_digraph.cas <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> set <span class="main">(</span>awalk_verts <span class="main">(</span>head <span class="free">G</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">as</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>head <span class="free">G</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">as</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre_digraph.cas <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">(</span>head <span class="free">G</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">as</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">_</span> <span class="main">⊆</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> cas_subset<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgraph_def compatible_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.cas.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Digraph_Component-awalk_induce"><span class="command">lemma</span></span> awalk_induce<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pre_digraph.awalk <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="free">S</span><span class="main">)</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">interpret</span></span> GS<span class="main">:</span> wf_digraph <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">↾</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.awalk_def cas_induce GS.cas_induce set_awalk_verts<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Digraph_Component-subgraph_induce_subgraphI"><span class="command">lemma</span></span> subgraph_induce_subgraphI<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="free">V</span><span class="main">)</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms induced_imp_subgraph induced_induce<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Digraph_Component-induced_subgraphI'"><span class="command">lemma</span></span> induced_subgraphI'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subg<span class="main">:</span><span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">H'</span><span class="main">.</span> subgraph <span class="bound">H'</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">(</span>verts <span class="bound">H'</span> <span class="main">≠</span> verts <span class="free">H</span> <span class="main">∨</span> arcs <span class="bound">H'</span> <span class="main">⊆</span> arcs <span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> wf_digraph <span class="quoted"><span class="free">H</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹subgraph <span class="free">H</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">H'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H'</span> <span class="main">=</span> <span class="free">G</span> <span class="main">↾</span> verts <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> H'_props<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="skolem">H'</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"verts <span class="skolem">H'</span> <span class="main">=</span> verts <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_digraph.subgraph_induce_subgraphI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arcs <span class="skolem">H'</span> <span class="main">=</span> arcs <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"arcs <span class="skolem">H'</span> <span class="main">⊆</span> arcs <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> max H'_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"arcs <span class="free">H</span> <span class="main">⊆</span> arcs <span class="skolem">H'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> H'_def compatible_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> induced_subgraph_def H'_def subg<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> induced_subgraph_altdef<span class="main">:</span>
  <span class="quoted"><span class="quoted">"induced_subgraph <span class="free">H</span> <span class="free">G</span> <span class="main">⟷</span> subgraph <span class="free">H</span> <span class="free">G</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">H'</span><span class="main">.</span> subgraph <span class="bound">H'</span> <span class="free">G</span> <span class="main">⟶</span> <span class="main">(</span>verts <span class="bound">H'</span> <span class="main">≠</span> verts <span class="free">H</span> <span class="main">∨</span> arcs <span class="bound">H'</span> <span class="main">⊆</span> arcs <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"verts <span class="skolem">H'</span> <span class="main">=</span> verts <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="skolem">H'</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">interpret</span></span> H'<span class="main">:</span> wf_digraph <span class="quoted"><span class="skolem">H'</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹subgraph <span class="skolem">H'</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subgraph <span class="skolem">H'</span> <span class="free">G</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="main">=</span> tail <span class="skolem">H'</span>"</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="main">=</span> head <span class="skolem">H'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compatible_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> arcs <span class="skolem">H'</span> <span class="main">⟹</span> tail <span class="free">G</span> <span class="bound">a</span> <span class="main">∈</span> verts <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> arcs <span class="skolem">H'</span> <span class="main">⟹</span> tail <span class="free">G</span> <span class="bound">a</span> <span class="main">∈</span> verts <span class="free">H</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> H'.wellformed <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arcs <span class="skolem">H'</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> arcs <span class="free">G</span><span class="main">.</span> tail <span class="free">G</span> <span class="bound">e</span> <span class="main">∈</span> verts <span class="free">H</span> <span class="main">∧</span> head <span class="free">G</span> <span class="bound">e</span> <span class="main">∈</span> verts <span class="free">H</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹subgraph <span class="skolem">H'</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgraph_def comp A<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> induced_subgraphI'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> induced_subgraph_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Unions of Graphs›</span></span>

<span class="keyword1" id="Digraph_Component-verts_union"><span class="command">lemma</span></span>
  verts_union<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"verts <span class="main">(</span>union <span class="free">G</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> verts <span class="free">G</span> <span class="main">∪</span> verts <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  arcs_union<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"arcs <span class="main">(</span>union <span class="free">G</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> arcs <span class="free">G</span> <span class="main">∪</span> arcs <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  tail_union<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"tail <span class="main">(</span>union <span class="free">G</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> tail <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  head_union<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"head <span class="main">(</span>union <span class="free">G</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> head <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> union_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-wellformed_union"><span class="command">lemma</span></span> wellformed_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">G</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="main">(</span>union <span class="free">G</span> <span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> union_def compatible_tail compatible_head <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> wf_digraph.wellformed<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-subgraph_union_iff"><span class="command">lemma</span></span> subgraph_union_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="free">H1</span>"</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="free">H2</span>"</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">H1</span> <span class="free">H2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span>union <span class="free">H1</span> <span class="free">H2</span><span class="main">)</span> <span class="free">G</span> <span class="main">⟷</span> subgraph <span class="free">H1</span> <span class="free">G</span> <span class="main">∧</span> subgraph <span class="free">H2</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compatible_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> subgraphI wellformed_union<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-subgraph_union"><span class="command">lemma</span></span> subgraph_union<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H1</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">H1</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H2</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">H2</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span>union <span class="free">H1</span> <span class="free">H2</span><span class="main">)</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="main">(</span>union <span class="free">H1</span> <span class="free">H2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wellformed_union <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compatible_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subgraph_def union_def arc_to_ends_def compatible_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digraph_Component-union_fin_digraph"><span class="command">lemma</span></span> union_fin_digraph<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fin_digraph <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"fin_digraph <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">G</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fin_digraph <span class="main">(</span>union <span class="free">G</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
  <span class="keyword1"><span class="command">interpret</span></span> G<span class="main">:</span> fin_digraph <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> fin_digraph <span class="quoted"><span class="free">H</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="main">(</span>union <span class="free">G</span> <span class="free">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> wellformed_union<span class="main">)</span> <span class="operator">intro_locales</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fin_digraph_axioms <span class="main">(</span>union <span class="free">G</span> <span class="free">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> union_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digraph_Component-subgraphs_of_union"><span class="command">lemma</span></span> subgraphs_of_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="free">G'</span>"</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">G</span> <span class="free">G'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">G</span> <span class="main">(</span>union <span class="free">G</span> <span class="free">G'</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">G'</span> <span class="main">(</span>union <span class="free">G</span> <span class="free">G'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> subgraphI wellformed_union <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compatible_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Maximal Subgraphs›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> max_subgraph_mp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"max_subgraph <span class="free">Q</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"max_subgraph <span class="free">P</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_subgraph_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> max_subgraph_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"max_subgraph <span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_subgraph_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> max_subgraph_subg_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"max_subgraph <span class="free">P</span> <span class="free">H1</span>"</span></span> <span class="quoted"><span class="quoted">"max_subgraph <span class="free">P</span> <span class="free">H2</span>"</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H1</span> <span class="free">H2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">H1</span> <span class="main">=</span> <span class="free">H2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_subgraph_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Component-subgraph_induce_subgraphI2"><span class="command">lemma</span></span> subgraph_induce_subgraphI2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> verts <span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgraph_def compatible_def wf_digraph.wellformed wf_digraph.wellformed_induce_subgraph<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">arc_mono</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">arc_mono</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">H1</span> <span class="bound">H2</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">H1</span> <span class="main">∧</span> subgraph <span class="bound">H1</span> <span class="bound">H2</span> <span class="main">∧</span> verts <span class="bound">H1</span> <span class="main">=</span> verts <span class="bound">H2</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">H2</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> induced_subgraphI_arc_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"max_subgraph <span class="free">P</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"arc_mono <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> wf_digraph <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_subgraph_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> verts <span class="free">H</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> verts <span class="free">H</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">H</span> <span class="main">=</span> verts <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> verts <span class="free">H</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_subgraph_def subgraph_induce_subgraphI2 subgraph_induce_subgraphI<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> verts  <span class="free">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"max_subgraph <span class="free">P</span> <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> verts <span class="free">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_subgraph_def<span class="main">)</span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> <span class="free">G</span> <span class="main">↾</span> verts <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹max_subgraph <span class="free">P</span> <span class="free">H</span>›</span></span> <span class="quoted"><span class="quoted">‹subgraph <span class="free">H</span> <span class="main">_</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> max_subgraph_subg_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="quoted"><span class="quoted">‹<span class="free">H</span> <span class="main">=</span> <span class="main">_</span>›</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_subgraph_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> induced_subgraph_altdef2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"induced_subgraph <span class="free">H</span> <span class="free">G</span> <span class="main">⟷</span> max_subgraph <span class="main">(</span><span class="main">λ</span><span class="bound">H'</span><span class="main">.</span> verts <span class="bound">H'</span> <span class="main">=</span> verts <span class="free">H</span><span class="main">)</span> <span class="free">H</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="skolem">H'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">≠</span> <span class="skolem">H'</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>subgraph <span class="skolem">H'</span> <span class="free">G</span> <span class="main">∧</span> verts <span class="skolem">H'</span> <span class="main">=</span> verts <span class="free">H</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> induced_subgraph_altdef compatible_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> allE<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">H'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"max_subgraph <span class="main">(</span><span class="main">λ</span><span class="bound">H'</span><span class="main">.</span> verts <span class="bound">H'</span> <span class="main">=</span> verts <span class="free">H</span><span class="main">)</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_subgraph_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arc_mono <span class="main">(</span><span class="main">λ</span><span class="bound">H'</span><span class="main">.</span> verts <span class="bound">H'</span> <span class="main">=</span> verts <span class="free">H</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> induced_subgraphI_arc_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*XXX*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> max_subgraphI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">x</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="free">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">;</span> subgraph <span class="free">x</span> <span class="bound">y</span><span class="main">;</span> subgraph <span class="bound">y</span> <span class="free">G</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¬</span><span class="free">P</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"max_subgraph <span class="free">P</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_subgraph_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> subgraphI_max_subgraph<span class="main">:</span> <span class="quoted"><span class="quoted">"max_subgraph <span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> subgraph <span class="free">x</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_subgraph_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Connected and Strongly Connected Graphs›</span></span>

<span class="keyword1"><span class="command">context</span></span> wf_digraph <span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1" id="Digraph_Component-in_sccs_verts_conv_reachable"><span class="command">lemma</span></span> in_sccs_verts_conv_reachable<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sccs_verts <span class="main">⟷</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="bound">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">S</span> <span class="main">⟶</span> <span class="main">¬</span><span class="bound">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">v</span> <span class="main">∨</span> <span class="main">¬</span><span class="bound">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sccs_verts_def<span class="main">)</span>

  <span class="keyword1" id="Digraph_Component-sccs_verts_disjoint"><span class="command">lemma</span></span> sccs_verts_disjoint<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sccs_verts"</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">∈</span> sccs_verts"</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≠</span> <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∩</span> <span class="free">T</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> in_sccs_verts_conv_reachable <span class="keyword1"><span class="command">by</span></span> <span class="operator">safe</span> <span class="operator">meson</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1" id="Digraph_Component-strongly_connected_spanning_imp_strongly_connected"><span class="command">lemma</span></span> strongly_connected_spanning_imp_strongly_connected<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"spanning <span class="free">H</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"strongly_connected <span class="free">H</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strongly_connected <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> strongly_connected_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> ballI conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> strongly_connected_def spanning_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strongly_connected_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reachable_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Digraph_Component-strongly_connected_imp_induce_subgraph_strongly_connected"><span class="command">lemma</span></span> strongly_connected_imp_induce_subgraph_strongly_connected<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> subg<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> sc<span class="main">:</span> <span class="quoted"><span class="quoted">"strongly_connected <span class="free">H</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strongly_connected <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="main">(</span>verts <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?is_H</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">↾</span> <span class="main">(</span>verts <span class="free">H</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> wf_digraph <span class="quoted"><span class="free">H</span></span>
      <span class="keyword1"><span class="command">using</span></span> subg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subgraphE<span class="main">)</span>
    <span class="keyword1"><span class="command">interpret</span></span> GrH<span class="main">:</span> wf_digraph <span class="quoted"><span class="quoted">"<span class="var">?is_H</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wellformed_induce_subgraph<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">H</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> verts <span class="free">H</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> subg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subgraphI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compatible_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> induced_induce<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹verts <span class="free">H</span> <span class="main">⊆</span> verts <span class="free">G</span>›</span></span><span class="main">]</span>
        <span class="keyword2"><span class="keyword">and</span></span> sc GrH.strongly_connected_spanning_imp_strongly_connected
      <span class="keyword1"><span class="command">unfolding</span></span> spanning_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Digraph_Component-in_sccs_vertsI_sccs"><span class="command">lemma</span></span> in_sccs_vertsI_sccs<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> verts <span class="main">`</span> sccs"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sccs_verts"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sccs_verts_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> CollectI conjI allI ballI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sccs_verts_def sccs_def strongly_connected_def<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> sc<span class="main">:</span> <span class="quoted"><span class="quoted">"strongly_connected <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sccs_verts_def sccs_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> induced_imp_subgraph subgraphE wf_digraph.strongly_connected_imp_induce_subgraph_strongly_connected<span class="main">)</span>

    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> sc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="free">S</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">⊆</span> verts <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reachable_induce_subgraphD<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="skolem">u</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> B <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p_uv</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_uv<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">u</span> <span class="skolem">p_uv</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> reachable_awalk<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> B <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p_vu</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_vu<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">v</span> <span class="skolem">p_vu</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> reachable_awalk<span class="main">)</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> <span class="free">S</span> <span class="main">∪</span> set <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="skolem">p_uv</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>awalk_verts <span class="skolem">v</span> <span class="skolem">p_vu</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_vu <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_def set_awalk_verts<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">≠</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∉</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">interpret</span></span> T<span class="main">:</span> wf_digraph <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">↾</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">from</span></span> p_uv <span class="keyword1"><span class="command">have</span></span> T_p_uv<span class="main">:</span> <span class="quoted"><span class="quoted">"T.awalk <span class="skolem">u</span> <span class="skolem">p_uv</span> <span class="skolem">v</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> awalk_induce<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> p_vu <span class="keyword1"><span class="command">have</span></span> T_p_vu<span class="main">:</span> <span class="quoted"><span class="quoted">"T.awalk <span class="skolem">v</span> <span class="skolem">p_vu</span> <span class="skolem">u</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> awalk_induce<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_def<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> uv_reach<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="skolem">T</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="skolem">T</span></sub><span class="hidden">⇙</span> <span class="skolem">u</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> T_p_uv T_p_vu A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> T.reachable_awalk<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="free">S</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="free">S</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> sc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="skolem">T</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="skolem">T</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">⊆</span> <span class="skolem">T</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reachable_induce_ss<span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> A1 <span class="main">=</span> this

        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="skolem">T</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> uv_reach A1 A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> T.reachable_trans<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="skolem">p_uv</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="skolem">T</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> T_p_uv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_verts_induce <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> T.awalk_verts_reachable_to<span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="skolem">v</span> <span class="skolem">p_vu</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="skolem">T</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> T_p_vu <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> T.reachable_trans<span class="main">)</span>
                <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uv_reach awalk_verts_induce <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> T.awalk_verts_reachable_to<span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="skolem">T</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_def<span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> xv_reach <span class="main">=</span> this

        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="skolem">T</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> uv_reach A1 A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> T.reachable_trans<span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="skolem">v</span> <span class="skolem">p_vu</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="skolem">T</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> T_p_vu <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_verts_induce <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> T.awalk_verts_reachable_from<span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="skolem">p_uv</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="skolem">T</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> T_p_uv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> T.reachable_trans<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> T.awalk_verts_reachable_from uv_reach <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_verts_induce<span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="skolem">T</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_def<span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> vx_reach <span class="main">=</span> this

        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="skolem">T</span></sub><span class="hidden">⇙</span> <span class="skolem">y</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> xv_reach vx_reach <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> T.reachable_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strongly_connected <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="skolem">T</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">⊆</span> <span class="skolem">T</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="skolem">T</span><span class="main">)</span> <span class="free">G</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">⊆</span> verts <span class="free">G</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> awalk_verts_reachable_from p_uv p_vu reachable_in_verts<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">T</span><span class="main">.</span> induced_subgraph <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="bound">T</span><span class="main">)</span> <span class="free">G</span> <span class="main">∧</span> strongly_connected <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="bound">T</span><span class="main">)</span> <span class="main">∧</span> verts <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊂</span> verts <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="bound">T</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">⊆</span> <span class="skolem">T</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">T</span> <span class="main">≠</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">↾</span> <span class="free">S</span> <span class="main">∉</span> sccs"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sccs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∉</span> verts <span class="main">`</span> sccs"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>erased<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">⊆</span> <span class="skolem">T</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">T</span> <span class="main">≠</span> <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹induced_subgraph <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="skolem">T</span><span class="main">)</span> <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹strongly_connected <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="skolem">T</span><span class="main">)</span>›</span></span>
            dual_order.order_iff_strict image_iff in_sccsE induce_subgraph_verts<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span> <span class="main">∨</span> <span class="main">¬</span><span class="skolem">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Digraph_Component-arc_mono_strongly_connected"><span class="command">lemma</span></span> arc_mono_strongly_connected<span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"arc_mono strongly_connected"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_mono_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> spanning_def subgraphE wf_digraph.strongly_connected_spanning_imp_strongly_connected<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> sccs_altdef2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sccs <span class="main">=</span> <span class="main">{</span><span class="bound">H</span><span class="main">.</span> max_subgraph strongly_connected <span class="bound">H</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H</span> <span class="skolem">H'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pre_digraph"</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"strongly_connected <span class="skolem">H'</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="skolem">H'</span> <span class="free">G</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"max_subgraph strongly_connected <span class="skolem">H</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"verts <span class="skolem">H</span> <span class="main">⊆</span> verts <span class="skolem">H'</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> sg<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="skolem">H</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ends_G<span class="main">:</span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="main">=</span> tail <span class="skolem">H</span> "</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="main">=</span> head <span class="skolem">H</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_subgraph_def compatible_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> wf_digraph <span class="quoted"><span class="skolem">H</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arcs <span class="skolem">H</span> <span class="main">⊆</span> arcs <span class="skolem">H'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a2 a4 sg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ends_G<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="skolem">H'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a1 a2 a3 a4
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> compatible_def induced_imp_subgraph max_subgraph_def subgraph_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> X <span class="main">=</span> this

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="skolem">H</span> <span class="free">G</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"strongly_connected <span class="skolem">H</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">H'</span><span class="main">.</span> strongly_connected <span class="bound">H'</span> <span class="main">⟶</span> induced_subgraph <span class="bound">H'</span> <span class="free">G</span> <span class="main">⟶</span> <span class="main">¬</span> verts <span class="skolem">H</span> <span class="main">⊂</span> verts <span class="bound">H'</span>"</span></span>
    <span class="keyword1"><span class="command">interpret</span></span> G<span class="main">:</span> wf_digraph <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> subg<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="skolem">H</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="skolem">y</span> <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"verts <span class="skolem">H</span> <span class="main">⊂</span> verts <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> induced_subgraph_altdef2 max_subgraph_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>strongly_connected <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> subg a1 a2 a3<span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">↾</span> verts <span class="skolem">y</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G.induced_induce G.strongly_connected_imp_induce_subgraph_strongly_connected<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"max_subgraph strongly_connected <span class="skolem">H</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a1 a2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> max_subgraphI<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> Y <span class="main">=</span> this

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sccs_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> max_subgraph_prop X <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> induced_subgraphI_arc_mono Y<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">locale</span></span> max_reachable_set <span class="main">=</span> wf_digraph <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="keyword2"><span class="keyword">assumes</span></span> S_in_sv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sccs_verts"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1" id="Digraph_Component-reach_in"><span class="command">lemma</span></span> reach_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">S</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> not_reach_out<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">u</span> <span class="main">∈</span> <span class="free">S</span><span class="main">;</span> <span class="bound">v</span> <span class="main">∉</span> <span class="free">S</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¬</span><span class="bound">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">v</span> <span class="main">∨</span> <span class="main">¬</span><span class="bound">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> S_in_sv <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sccs_verts_def<span class="main">)</span>

  <span class="keyword1" id="Digraph_Component-reachable_induced"><span class="command">lemma</span></span> reachable_induced<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> conn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="free">S</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">↾</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> reach_in <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> reachable_in_verts<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="var">?H</span> <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> induced_induce<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> wf_digraph <span class="var"><span class="quoted"><span class="var">?H</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wf_digraphI_induced<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> conn <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> reachable_awalk<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"set <span class="skolem">p</span> <span class="main">⊆</span> arcs <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="free">S</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> p conn <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"H.awalk <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.awalk_def compatible_cas<span class="main"><span class="main">[</span></span><span class="operator">OF</span> compatible_induce_subgraph<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H.reachable_awalk<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> arcs <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="skolem">a</span> <span class="main">∉</span> <span class="free">S</span> <span class="main">∨</span> head <span class="free">G</span> <span class="skolem">a</span> <span class="main">∉</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∉</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_awalk_verts<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> awalk_verts_reachable_from awalk_verts_reachable_to<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> conn reach_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reachable_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∉</span> <span class="free">S</span>›</span></span> conn not_reach_out <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Digraph_Component-strongly_connected"><span class="command">lemma</span></span> strongly_connected<span class="main">:</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strongly_connected <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_empty <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> strongly_connectedI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reachable_induced reach_in<span class="main">)</span>

  <span class="keyword1" id="Digraph_Component-induced_in_sccs"><span class="command">lemma</span></span> induced_in_sccs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">↾</span> <span class="free">S</span> <span class="main">∈</span> sccs"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">↾</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> reach_in <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> reachable_in_verts<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="var">?H</span> <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> induced_induce<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> wf_digraph <span class="var"><span class="quoted"><span class="var">?H</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wf_digraphI_induced<span class="main">)</span>

    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">T</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊂</span> <span class="skolem">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"strongly_connected <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="skolem">T</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">⊂</span> <span class="skolem">T</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> not_empty <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">⊂</span> <span class="skolem">T</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∉</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span> <span class="main">∨</span> <span class="main">¬</span><span class="skolem">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> not_reach_out<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹strongly_connected <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="skolem">T</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="skolem">T</span></sub><span class="hidden">⇙</span> <span class="skolem">u</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">T</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="skolem">T</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strongly_connected_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="skolem">u</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">T</span> <span class="main">⊆</span> verts <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> reachable_induce_subgraphD<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> psuper_not_sc <span class="main">=</span> this

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">c'</span><span class="main">.</span> induced_subgraph <span class="bound">c'</span> <span class="free">G</span> <span class="main">∧</span> strongly_connected <span class="bound">c'</span> <span class="main">∧</span> verts <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊂</span> verts <span class="bound">c'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> induce_subgraph_verts induced_imp_subgraph psuper_not_sc subgraphE
        strongly_connected_imp_induce_subgraph_strongly_connected<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">S</span> <span class="main">⊆</span> <span class="main">_</span>›</span></span> not_empty <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="main">∈</span> sccs"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> in_sccsI induced_induce strongly_connected<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> wf_digraph <span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1" id="Digraph_Component-in_verts_sccsD_sccs"><span class="command">lemma</span></span> in_verts_sccsD_sccs<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sccs_verts"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">↾</span> <span class="free">S</span> <span class="main">∈</span> sccs"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">interpret</span></span> max_reachable_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sccs_verts_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> induced_in_sccs<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Digraph_Component-sccs_verts_conv"><span class="command">lemma</span></span> sccs_verts_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"sccs_verts <span class="main">=</span> verts <span class="main">`</span> sccs"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> in_sccs_vertsI_sccs rev_image_eqI <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_verts_sccsD_sccs<span class="main">)</span>

  <span class="keyword1" id="Digraph_Component-induce_eq_iff_induced"><span class="command">lemma</span></span> induce_eq_iff_induced<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">↾</span> verts <span class="free">H</span> <span class="main">=</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> induced_subgraph_def induce_subgraph_def compatible_def<span class="main">)</span>

  <span class="keyword1" id="Digraph_Component-sccs_conv_sccs_verts"><span class="command">lemma</span></span> sccs_conv_sccs_verts<span class="main">:</span> <span class="quoted"><span class="quoted">"sccs <span class="main">=</span> induce_subgraph <span class="free">G</span> <span class="main">`</span> sccs_verts"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rev_image_eqI in_sccs_vertsI_sccs <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_verts_sccsD_sccs
      <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sccs_def induce_eq_iff_induced<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1" id="Digraph_Component-connected_conv"><span class="command">lemma</span></span> connected_conv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">G</span> <span class="main">⟷</span> verts <span class="free">G</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> verts <span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> verts <span class="free">G</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>arcs_ends <span class="free">G</span><span class="main">)</span><span class="keyword1"><span class="hidden">⇧</span><sup>s</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"symcl <span class="main">(</span>arcs_ends <span class="free">G</span><span class="main">)</span> <span class="main">=</span> parcs <span class="main">(</span>mk_symmetric <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> parcs_mk_symmetric symcl_def arcs_ends_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> connected_def strongly_connected_def reachable_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> symmetric_connected_imp_strongly_connected<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"symmetric <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strongly_connected <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹connected <span class="free">G</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> connected_def strongly_connected_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹connected <span class="free">G</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> sc_mks<span class="main">:</span> <span class="quoted"><span class="quoted">"strongly_connected <span class="main">(</span>mk_symmetric <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> connected_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> sc_mks <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub>mk_symmetric <span class="free">G</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> strongly_connected_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> reachable_mk_symmetric_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> connected_spanning_imp_connected<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"spanning <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> connected_def strongly_connected_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI ballI<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"verts <span class="main">(</span>mk_symmetric <span class="free">G</span> <span class="main">)</span><span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> spanning_def connected_def strongly_connected_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> verts <span class="main">(</span>mk_symmetric <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> verts <span class="main">(</span>mk_symmetric <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> pverts <span class="main">(</span>mk_symmetric <span class="free">H</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> pverts <span class="main">(</span>mk_symmetric <span class="free">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹spanning <span class="free">H</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mk_symmetric_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹connected <span class="free">H</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub>with_proj <span class="main">(</span>mk_symmetric <span class="free">H</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span>mk_symmetric <span class="free">H</span><span class="main">)</span> <span class="main">(</span>mk_symmetric <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹spanning <span class="free">H</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> connected_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> spanning_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> subgraph_mk_symmetric<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub>mk_symmetric <span class="free">G</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pre_digraph.reachable_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> spanning_tree_imp_connected<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"spanning_tree <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> connected_spanning_imp_connected<span class="main">)</span>

<span class="keyword1"><span class="command">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LEAST</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> sym_digraph<span class="main">)</span> induce_reachable_is_in_sccs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="bound">v</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> sccs"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="bound">v</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> isub_c<span class="main">:</span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="var">?c</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> reachable_in_vertsE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> c<span class="main">:</span> wf_digraph <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wf_digraphI_induced<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> sym_c<span class="main">:</span> <span class="quoted"><span class="quoted">"symmetric <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="bound">v</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sym_arcs isub_c <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> induced_graph_imp_symmetric<span class="main">)</span>

  <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹induced_subgraph <span class="var">?c</span> <span class="free">G</span>›</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strongly_connected <span class="var">?c</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> strongly_connectedI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"verts <span class="var">?c</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">w</span> <span class="keyword3"><span class="command">assume</span></span> l_assms<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> verts <span class="var">?c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> verts <span class="var">?c</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="bound">v</span><span class="main">}</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> l_assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> induce_reachable_preserves_paths<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="bound">v</span><span class="main">}</span></sub><span class="hidden">⇙</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> symmetric_reachable<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sym_c<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="bound">v</span><span class="main">}</span></sub><span class="hidden">⇙</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> l_assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> induce_reachable_preserves_paths<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span> <span class="main">↾</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="bound">v</span><span class="main">}</span></sub><span class="hidden">⇙</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">d</span><span class="main">.</span> induced_subgraph <span class="bound">d</span> <span class="free">G</span> <span class="main">∧</span> strongly_connected <span class="bound">d</span> <span class="main">∧</span>
    verts <span class="var">?c</span> <span class="main">⊂</span> verts <span class="bound">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d</span><span class="main">.</span> induced_subgraph <span class="bound">d</span> <span class="free">G</span> <span class="main">∧</span> strongly_connected <span class="bound">d</span> <span class="main">∧</span>
      verts <span class="var">?c</span> <span class="main">⊂</span> verts <span class="bound">d</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="skolem">d</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"strongly_connected <span class="skolem">d</span>"</span></span>
      <span class="quoted"><span class="quoted">"verts <span class="var">?c</span> <span class="main">⊂</span> verts <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> verts <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> verts <span class="var">?c</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="var">?c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="skolem">d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹verts <span class="var">?c</span> <span class="main">⊂</span> verts <span class="skolem">d</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="skolem">d</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹strongly_connected <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">∈</span> verts <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> verts <span class="skolem">d</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹induced_subgraph <span class="skolem">d</span> <span class="free">G</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> pre_digraph.reachable_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> verts <span class="var">?c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reachable_awalk<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∉</span> verts <span class="var">?c</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sccs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digraph_Component-induced_eq_verts_imp_eq"><span class="command">lemma</span></span> induced_eq_verts_imp_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="free">G</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"induced_subgraph <span class="free">G'</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">=</span> verts <span class="free">G'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">=</span> <span class="free">G'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> induced_subgraph_def subgraph_def compatible_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> in_sccs_subset_imp_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> sccs"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> sccs"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">c</span> <span class="main">⊆</span> verts <span class="free">d</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> induced_eq_verts_imp_eq<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span> wf_digraph <span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1" id="Digraph_Component-connectedI"><span class="command">lemma</span></span> connectedI<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟹</span> <span class="bound">v</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟹</span> <span class="bound">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub>mk_symmetric <span class="free">G</span></sub><span class="hidden">⇙</span> <span class="bound">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> connected_def<span class="main">)</span>
  
  <span class="keyword1" id="Digraph_Component-connected_awalkE"><span class="command">lemma</span></span> connected_awalkE<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"pre_digraph.awalk <span class="main">(</span>mk_symmetric <span class="free">G</span><span class="main">)</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">interpret</span></span> sG<span class="main">:</span> pair_wf_digraph <span class="quoted"><span class="quoted">"mk_symmetric <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub>mk_symmetric <span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> connected_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sG.awalk <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sG.reachable_awalk<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Digraph_Component-inj_on_verts_sccs"><span class="command">lemma</span></span> inj_on_verts_sccs<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on verts sccs"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> in_sccs_imp_induced induced_eq_verts_imp_eq<span class="main">)</span>

  <span class="keyword1" id="Digraph_Component-card_sccs_verts"><span class="command">lemma</span></span> card_sccs_verts<span class="main">:</span> <span class="quoted"><span class="quoted">"card sccs_verts <span class="main">=</span> card sccs"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sccs_verts_conv <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inj_on_verts_sccs card_image<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1" id="Digraph_Component-strongly_connected_non_disj"><span class="command">lemma</span></span> strongly_connected_non_disj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_digraph <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">G</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sc<span class="main">:</span> <span class="quoted"><span class="quoted">"strongly_connected <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"strongly_connected <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> not_disj<span class="main">:</span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">∩</span> verts <span class="free">H</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strongly_connected <span class="main">(</span>union <span class="free">G</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> sc <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"verts <span class="main">(</span>union <span class="free">G</span> <span class="free">H</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> strongly_connected_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"union <span class="free">G</span> <span class="free">H</span>"</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">w</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> verts <span class="var">?x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> verts <span class="var">?x</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> w_in_both<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> verts <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_disj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">interpret</span></span> x<span class="main">:</span> wf_digraph <span class="var"><span class="quoted"><span class="var">?x</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wellformed_union<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> subg<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="free">G</span> <span class="var">?x</span>"</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="var">?x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subgraphs_of_union<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ <span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> reach_uw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="var">?x</span></sub><span class="hidden">⇙</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> verts <span class="var">?x</span>›</span></span> subg w_in_both sc
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> pre_digraph.reachable_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> reach_wv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="var">?x</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> verts <span class="var">?x</span>›</span></span> subg w_in_both sc
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> pre_digraph.reachable_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="main">(</span>x.reachable_trans<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="var">?x</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> wf_digraph <span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1" id="Digraph_Component-scc_disj"><span class="command">lemma</span></span> scc_disj<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> scc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> sccs"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> sccs"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="free">d</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">c</span> <span class="main">∩</span> verts <span class="free">d</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> contr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?thesis</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"union <span class="free">c</span> <span class="free">d</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> comp1<span class="main">:</span> <span class="quoted"><span class="quoted">"compatible <span class="free">G</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">G</span> <span class="free">d</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> scc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sccs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> comp<span class="main">:</span> <span class="quoted"><span class="quoted">"compatible <span class="free">c</span> <span class="free">d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compatible_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_digraph <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="free">d</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> sc<span class="main">:</span> <span class="quoted"><span class="quoted">"strongly_connected <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"strongly_connected <span class="free">d</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> scc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> in_sccs_imp_induced<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">c</span> <span class="free">d</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sccs_def compatible_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> wf comp sc <span class="keyword1"><span class="command">have</span></span> union_conn<span class="main">:</span> <span class="quoted"><span class="quoted">"strongly_connected <span class="var">?x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> contr <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> strongly_connected_non_disj<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> sg<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="var">?x</span> <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> scc comp1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subgraph_union<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compatible_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> v_cd<span class="main">:</span> <span class="quoted"><span class="quoted">"verts <span class="free">c</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span>  <span class="quoted"><span class="quoted">"verts <span class="free">d</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> subgraphE<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="var">?x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> wellformed_union<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">with</span></span> v_cd sg union_conn
    <span class="keyword1"><span class="command">have</span></span> induce_subgraph_conn<span class="main">:</span> <span class="quoted"><span class="quoted">"strongly_connected <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> verts <span class="var">?x</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"induced_subgraph <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> verts <span class="var">?x</span><span class="main">)</span> <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">intro</span> strongly_connected_imp_induce_subgraph_strongly_connected<span class="main"><span class="keyword3">,</span></span>
        <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgraph_union_iff<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>verts <span class="free">c</span> <span class="main">⊆</span> verts <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> verts <span class="free">d</span> <span class="main">⊆</span> verts <span class="free">c</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_sccs_subset_imp_eq<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> psub<span class="main">:</span> <span class="quoted"><span class="quoted">"verts <span class="free">c</span> <span class="main">⊂</span> verts <span class="var">?x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> union_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> induce_subgraph_conn
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">∈</span> sccs›</span></span> in_sccsE induce_subgraph_verts<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Digraph_Component-in_sccs_verts_conv"><span class="command">lemma</span></span> in_sccs_verts_conv<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sccs_verts <span class="main">⟷</span> <span class="free">G</span> <span class="main">↾</span> <span class="free">S</span> <span class="main">∈</span> sccs"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sccs_verts_conv <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>
      <span class="main">(</span><span class="operator">metis</span> in_sccs_imp_induced induce_subgraph_verts induced_eq_verts_imp_eq induced_imp_subgraph induced_induce subgraphE<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> in_scc_of_self<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">∈</span> scc_of <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scc_of_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> scc_of_empty_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"scc_of <span class="free">u</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟷</span> <span class="free">u</span> <span class="main">∉</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> in_scc_of_self <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scc_of_def reachable_in_verts<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> scc_of_in_sccs_verts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"scc_of <span class="free">u</span> <span class="main">∈</span> sccs_verts"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_sccs_verts_conv_reachable scc_of_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reachable_trans exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">u</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> sccs_verts_subsets<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∈</span> sccs_verts <span class="main">⟹</span> <span class="free">S</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sccs_verts_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> finite_sccs_verts<span class="main">:</span> <span class="quoted"><span class="quoted">"finite sccs_verts"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>Pow <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> sccs_verts_subsets <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sccs_verts <span class="main">⊆</span> Pow <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_finite_subset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> sccs_verts_conv_scc_of<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sccs_verts <span class="main">=</span> scc_of <span class="main">`</span> verts <span class="free">G</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_eqI iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_sccs_verts_conv_reachable scc_of_empty_conv<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scc_of_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reachable_trans<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_sccs_verts_conv_reachable<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">∈</span> <span class="var">?L</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sccs_verts_subsets subsetCE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"scc_of <span class="skolem">u</span> <span class="main">∈</span> sccs_verts"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> scc_of <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> scc_of_in_sccs_verts in_scc_of_self<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"scc_of <span class="skolem">u</span> <span class="main">=</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sccs_verts_disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹scc_of <span class="skolem">u</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> verts <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> sym_digraph<span class="main">)</span> scc_ofI_reachable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> scc_of <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scc_of_def symmetric_reachable<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sym_arcs<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> sym_digraph<span class="main">)</span> scc_ofI_reachable'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> scc_of <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scc_of_def symmetric_reachable<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sym_arcs<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> sym_digraph<span class="main">)</span> scc_ofI_awalk<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> scc_of <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> reachable_awalk scc_ofI_reachable<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> sym_digraph<span class="main">)</span> scc_ofI_apath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> scc_of <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> reachable_apath scc_ofI_reachable<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> scc_of_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> scc_of <span class="free">v</span> <span class="main">⟹</span> scc_of <span class="free">u</span> <span class="main">=</span> scc_of <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> scc_of_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> reachable_trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> strongly_connected_eq_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"strongly_connected <span class="free">G</span> <span class="main">⟷</span> sccs <span class="main">=</span> <span class="main">{</span><span class="free">G</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">∈</span> sccs"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sccs_def induced_subgraph_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∈</span> sccs"</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">≠</span> <span class="skolem">H</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">G</span> <span class="main">∈</span> sccs›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">∩</span> verts <span class="skolem">H</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> scc_disj<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">H</span> <span class="main">∈</span> sccs›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"verts <span class="skolem">H</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"verts <span class="skolem">H</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">H</span> <span class="main">∈</span> sccs›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sccs_def strongly_connected_def<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sccs_def<span class="main">)</span>




<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Components›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> sym_digraph<span class="main">)</span> exists_scc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> sccs"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> induce_reachable_is_in_sccs<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> sym_digraph<span class="main">)</span> graph_is_union_sccs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Union sccs <span class="main">=</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">c</span> <span class="main">∈</span> sccs<span class="main">.</span> verts <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> verts <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> induce_reachable_is_in_sccs<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">c</span> <span class="main">∈</span> sccs<span class="main">.</span> arcs <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> arcs <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">c</span> <span class="main">∈</span> sccs<span class="main">.</span> arcs <span class="bound">c</span><span class="main">)</span> <span class="main">⊆</span> arcs <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">safe</span> <span class="main">(</span><span class="operator">metis</span> in_sccsE induced_imp_subgraph subgraphE subsetD<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"arcs <span class="free">G</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">c</span> <span class="main">∈</span> sccs<span class="main">.</span> arcs <span class="bound">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> tail <span class="free">G</span> <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> head <span class="free">G</span> <span class="skolem">e</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> sccs<span class="main">.</span> arcs <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>sccs<span class="main">.</span> <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span> <span class="main">}</span> <span class="main">⊆</span> verts <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> sccs"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span> <span class="main">⊆</span> verts <span class="skolem">c</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> arcs <span class="free">G</span><span class="main">.</span> tail <span class="free">G</span> <span class="bound">e</span> <span class="main">∈</span> verts <span class="skolem">c</span>
          <span class="main">∧</span> head <span class="free">G</span> <span class="bound">e</span> <span class="main">∈</span> verts <span class="skolem">c</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">∈</span> arcs <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> arcs <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">∈</span> sccs›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">∈</span> sccs›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> l_assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>sccs<span class="main">.</span> <span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span> <span class="main">⊆</span> verts <span class="bound">x</span><span class="main">)</span>"</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">∈</span> arcs <span class="free">G</span>›</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_def b_def reachable_adjI in_arcs_imp_in_arcs_ends<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">}</span> <span class="main">⊆</span> verts <span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="bound">v</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> reachable_in_vertsE<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">G</span> <span class="main">↾</span> <span class="main">{</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="bound">v</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> sccs"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> verts <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> induce_reachable_is_in_sccs<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> l_assm <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">c</span> <span class="main">∈</span> sccs<span class="main">.</span> arcs <span class="bound">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Union_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> sym_digraph<span class="main">)</span> scc_for_vert_ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span><span class="main">∈</span>sccs <span class="main">∧</span> <span class="free">u</span> <span class="main">∈</span> verts <span class="bound">c</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> induce_reachable_is_in_sccs<span class="main">)</span>



<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> sym_digraph<span class="main">)</span> scc_decomp_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> sccs"</span></span> <span class="quoted"><span class="quoted">"verts <span class="main">(</span>Union <span class="free">S</span><span class="main">)</span> <span class="main">=</span> verts <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> sccs"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">≠</span> sccs"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> sccs"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∉</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> verts <span class="skolem">c</span> <span class="main">∩</span> verts <span class="bound">d</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> scc_disj<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"verts <span class="skolem">c</span> <span class="main">∩</span> verts <span class="main">(</span>Union <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Union_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"verts <span class="skolem">c</span> <span class="main">∩</span> verts <span class="free">G</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">∈</span> sccs›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> verts <span class="skolem">c</span> <span class="main">∩</span> verts <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sccs_def strongly_connected_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Vertex_Walk">
<div class="head">
<h1>Theory Vertex_Walk</h1>
</div>
<pre class="source"><span class="comment1">(* Title:  Vertex_Walk.thy
   Author: Lars Noschinski, TU München
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Vertex_Walk
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Arc_Walk.html">Arc_Walk</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Walks Based on Vertices›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  These definitions are here mainly for historical purposes, as they
  do not really work with multigraphs. Consider using Arc Walks
  instead.
›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> vwalk <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Computes the list of arcs belonging to a list of nodes›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">vwalk_arcs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vwalk <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">vwalk_arcs</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">vwalk_arcs</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">vwalk_arcs</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free">vwalk_arcs</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vwalk_length</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vwalk <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">vwalk_length</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> length <span class="main">(</span>vwalk_arcs <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Vertex_Walk-vwalk_length_simp"><span class="command">lemma</span></span> vwalk_length_simp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vwalk_length <span class="free">p</span> <span class="main">=</span> length <span class="free">p</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vwalk_arcs.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vwalk_length_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vwalk</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vwalk <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">vwalk</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> set <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⊆</span> verts <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> set <span class="main">(</span>vwalk_arcs <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">⊆</span> arcs_ends <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vpath</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vwalk <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">vpath</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> vwalk <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> distinct <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For a given vwalk, compute a vpath with the same tail G and end›</span></span>
<span class="keyword1"><span class="command">function</span></span> <span class="entity">vwalk_to_vpath</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vwalk <span class="main">⇒</span> <span class="tfree">'a</span> vwalk"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">vwalk_to_vpath</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">vwalk_to_vpath</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>
      <span class="keyword1">then</span> <span class="free">vwalk_to_vpath</span> <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free">vwalk_to_vpath</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">lexicographic_order</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> length_dropWhile_le<span class="main">)</span>


<span class="keyword1" id="Vertex_Walk-vwalkI"><span class="command">lemma</span></span> vwalkI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> arcs_ends <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="free">p</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vwalk_def<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-vwalkE"><span class="command">lemma</span></span> vwalkE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="free">p</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">⊆</span> verts <span class="free">G</span> <span class="main">⟹</span>
    set <span class="main">(</span>vwalk_arcs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> arcs_ends <span class="free">G</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vwalk_def<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-vpathI"><span class="command">lemma</span></span> vpathI<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="free">p</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vpath <span class="free">p</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vpath_def<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-vpathE"><span class="command">lemma</span></span> vpathE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vpath <span class="free">p</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="free">p</span> <span class="free">G</span> <span class="main">⟹</span> distinct <span class="free">p</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vpath_def<span class="main">)</span>


<span class="keyword1" id="Vertex_Walk-vwalk_consI"><span class="command">lemma</span></span> vwalk_consI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="free">p</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> hd <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> arcs_ends <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vwalk_def<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-vwalk_consE"><span class="command">lemma</span></span> vwalk_consE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> hd <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> arcs_ends <span class="free">G</span> <span class="main">⟹</span> vwalk <span class="free">p</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vwalk_def<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-vwalk_induct"><span class="command">lemma</span></span> vwalk_induct<span class="main">[</span><span class="operator">case_names</span> Base Cons<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">pred</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">:</span></span></span></span> vwalk<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="free">p</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">[</span><span class="bound">u</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span> <span class="bound">v</span> <span class="bound">es</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> arcs_ends <span class="free">G</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">v</span> <span class="main">#</span> <span class="bound">es</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">u</span> <span class="main">#</span> <span class="bound">v</span> <span class="main">#</span> <span class="bound">es</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">u</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">es</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">es'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">es</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">es'</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> arcs_ends <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">#</span> <span class="skolem">es'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> vwalk_consE<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">es</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main">#</span> <span class="skolem">es'</span>›</span></span> Cons.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Vertex_Walk-vwalk_arcs_Cons"><span class="command">lemma</span></span> vwalk_arcs_Cons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vwalk_arcs <span class="main">(</span><span class="free">u</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span> hd <span class="free">p</span><span class="main">)</span> <span class="main">#</span> vwalk_arcs <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Vertex_Walk-vwalk_arcs_append"><span class="command">lemma</span></span> vwalk_arcs_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vwalk_arcs <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> vwalk_arcs <span class="free">p</span> <span class="main">@</span> <span class="main">(</span>last <span class="free">p</span><span class="main">,</span> hd <span class="free">q</span><span class="main">)</span> <span class="main">#</span> vwalk_arcs <span class="free">q</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">#</span> <span class="skolem">q'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neq_Nil_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vwalk_arcs <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">q'</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> vwalk_arcs <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>last <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p'</span><span class="main">)</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">#</span> vwalk_arcs <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">q'</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">p'</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a'</span> <span class="skolem">p'</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neq_Nil_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Vertex_Walk-set_vwalk_arcs_append1"><span class="command">lemma</span></span> set_vwalk_arcs_append1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>vwalk_arcs <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">p'</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> p_Cons <span class="main">=</span> Cons <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">b</span> <span class="skolem">q'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> p_Cons  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vwalk_arcs_append<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Vertex_Walk-set_vwalk_arcs_append2"><span class="command">lemma</span></span> set_vwalk_arcs_append2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="free">q</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>vwalk_arcs <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">p'</span><span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> p_Cons <span class="main">=</span> Cons <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">b</span> <span class="skolem">q'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> p_Cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vwalk_arcs_append<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Vertex_Walk-set_vwalk_arcs_cons"><span class="command">lemma</span></span> set_vwalk_arcs_cons<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>vwalk_arcs <span class="main">(</span><span class="free">u</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Vertex_Walk-set_vwalk_arcs_snoc"><span class="command">lemma</span></span> set_vwalk_arcs_snoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> insert <span class="main">(</span>last <span class="free">p</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span>set <span class="main">(</span>vwalk_arcs <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
      <span class="main">=</span> set <span class="main">(</span>vwalk_arcs <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword2"><span class="keyword">and</span></span> False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_vwalk_arcs_cons<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> vwalk_wf_digraph_consI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="free">p</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> hd <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> arcs_ends <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">#</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vwalk <span class="free">p</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> arcs_ends <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹vwalk <span class="free">p</span> <span class="free">G</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">a</span><span class="main">,</span> hd <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> arcs_ends <span class="free">G</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_vwalk_arcs_cons<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Vertex_Walk-vwalkI_append_l"><span class="command">lemma</span></span> vwalkI_append_l<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="free">p</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> vwalkE<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>vwalk_arcs <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_vwalk_arcs_append1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> arcs_ends <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Vertex_Walk-vwalkI_append_r"><span class="command">lemma</span></span> vwalkI_append_r<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="free">q</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vwalk <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="free">q</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vwalk <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> arcs_ends <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="free">q</span><span class="main">)</span> <span class="main">⊆</span> arcs_ends <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> set_vwalk_arcs_append2 subset_trans<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Vertex_Walk-vwalk_to_vpath_hd"><span class="command">lemma</span></span> vwalk_to_vpath_hd<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>vwalk_to_vpath <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> hd <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vwalk_to_vpath.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="skolem">xs</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≠</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hd_dropWhile<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword2"><span class="keyword">and</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Vertex_Walk-vwalk_to_vpath_induct3"><span class="command">lemma</span></span> vwalk_to_vpath_induct3<span class="main">[</span><span class="operator">consumes</span> 0<span class="main">,</span> <span class="operator">case_names</span> base in_set not_in_set<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="bound">xs</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≠</span> <span class="bound">x</span><span class="main">)</span> <span class="bound">xs</span><span class="main">)</span>
    <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="bound">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> set <span class="bound">xs</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">xs</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span> <span class="main">#</span> <span class="bound">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vwalk_to_vpath.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Vertex_Walk-vwalk_to_vpath_nonempty"><span class="command">lemma</span></span> vwalk_to_vpath_nonempty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vwalk_to_vpath <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vwalk_to_vpath_induct3<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Vertex_Walk-vwalk_to_vpath_last"><span class="command">lemma</span></span> vwalk_to_vpath_last<span class="main">:</span>
  <span class="quoted"><span class="quoted">"last <span class="main">(</span>vwalk_to_vpath <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> last <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vwalk_to_vpath_induct3<span class="main">)</span>
   <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dropWhile_last vwalk_to_vpath_nonempty<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-vwalk_to_vpath_subset"><span class="command">lemma</span></span> vwalk_to_vpath_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>vwalk_to_vpath <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vwalk_to_vpath.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> set <span class="skolem">xs</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> set_dropWhileD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Vertex_Walk-vwalk_to_vpath_cons"><span class="command">lemma</span></span> vwalk_to_vpath_cons<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vwalk_to_vpath <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">#</span> vwalk_to_vpath <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Vertex_Walk-vwalk_to_vpath_vpath"><span class="command">lemma</span></span> vwalk_to_vpath_vpath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="free">p</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vpath <span class="main">(</span>vwalk_to_vpath <span class="free">p</span><span class="main">)</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vwalk_to_vpath_induct3<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> base <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>in_set <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> set_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> set <span class="bound">xs</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">x'</span> <span class="main">∈</span> set <span class="bound">xs</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">≠</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> set <span class="skolem">xs</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="skolem"><span class="skolem">zs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">zs</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> set <span class="skolem">ys</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_decomp_first<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> vwalk_dW<span class="main">:</span> <span class="quoted"><span class="quoted">"vwalk <span class="main">(</span>dropWhile <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≠</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_set <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">ys</span> <span class="main">@</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">zs</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dropWhile_append3 set_neq <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> vwalkI_append_r<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> p<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> in_set
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vwalk_dW<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>not_in_set <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_notin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> set <span class="main">(</span>vwalk_to_vpath <span class="skolem">xs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> vwalk_to_vpath_subset<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> not_in_set <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> not_in_set.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x'</span> <span class="skolem">xs'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vpath <span class="main">(</span>vwalk_to_vpath <span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> not_in_set<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> vwalkI_append_r<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> p<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="skolem"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> Cons not_in_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> vwalk_to_vpath <span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> vwalk_consI <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vwalk_to_vpath_hd<span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> not_in_set
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> vwalk_consE<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> Cons
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> verts <span class="free">G</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vpath <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> vwalk_to_vpath <span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> vpathI<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹vpath <span class="main">(</span>vwalk_to_vpath <span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> x_notin
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> not_in_set
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vwalk_to_vpath_cons<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Vertex_Walk-vwalk_imp_ex_vpath"><span class="command">lemma</span></span> vwalk_imp_ex_vpath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="free">p</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">p</span> <span class="main">=</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"last <span class="free">p</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span><span class="main">.</span> vpath <span class="bound">q</span> <span class="free">G</span> <span class="main">∧</span> hd <span class="bound">q</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∧</span> last <span class="bound">q</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms vwalk_to_vpath_hd vwalk_to_vpath_last vwalk_to_vpath_vpath<span class="main">)</span>


<span class="keyword1" id="Vertex_Walk-vwalk_arcs_set_nil"><span class="command">lemma</span></span> vwalk_arcs_set_nil<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>vwalk_arcs <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Vertex_Walk-in_set_vwalk_arcs_append1"><span class="command">lemma</span></span> in_set_vwalk_arcs_append1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>vwalk_arcs <span class="free">p</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>vwalk_arcs <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>vwalk_arcs <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>vwalk_arcs <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>vwalk_arcs <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vwalk_arcs_append vwalk_arcs_set_nil<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>vwalk_arcs <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>vwalk_arcs <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vwalk_arcs_append vwalk_arcs_set_nil<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Vertex_Walk-in_set_vwalk_arcs_append2"><span class="command">lemma</span></span> in_set_vwalk_arcs_append2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>vwalk_arcs <span class="free">p</span><span class="main">)</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span>last <span class="free">p</span><span class="main">,</span> hd <span class="free">q</span><span class="main">)</span>
    <span class="main">∨</span> <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>vwalk_arcs <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>vwalk_arcs <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> disj <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span>last <span class="free">p</span><span class="main">,</span> hd <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>vwalk_arcs <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nonempty in_set_conv_decomp vwalk_arcs_append<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> in_set_vwalk_arcs_append1<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-arcs_in_vwalk_arcs"><span class="command">lemma</span></span> arcs_in_vwalk_arcs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> set <span class="main">(</span>vwalk_arcs <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">×</span> set <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vwalk_arcs.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Vertex_Walk-set_vwalk_arcs_rev"><span class="command">lemma</span></span> set_vwalk_arcs_rev<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="main">(</span>rev <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>vwalk_arcs <span class="free">p</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="main">(</span>rev <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>hd <span class="skolem">xs</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">}</span>
      <span class="main">∪</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">a</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>vwalk_arcs <span class="skolem">xs</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_vwalk_arcs_snoc last_rev Cons<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">a</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>vwalk_arcs <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_vwalk_arcs_cons<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Vertex_Walk-vpath_self"><span class="command">lemma</span></span> vpath_self<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vpath <span class="main">[</span><span class="free">u</span><span class="main">]</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> vpathI vwalkI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-vwalk_verts_in_verts"><span class="command">lemma</span></span> vwalk_verts_in_verts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="free">p</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Vertex_Walk-vwalk_arcs_tl"><span class="command">lemma</span></span> vwalk_arcs_tl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwalk_arcs <span class="main">(</span>tl <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> tl <span class="main">(</span>vwalk_arcs <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vwalk_arcs.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Vertex_Walk-vwalk_arcs_butlast"><span class="command">lemma</span></span> vwalk_arcs_butlast<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwalk_arcs <span class="main">(</span>butlast <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> butlast <span class="main">(</span>vwalk_arcs <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>snoc <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> snoc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"vwalk_arcs <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> vwalk_arcs <span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="main">(</span>last <span class="skolem">xs</span><span class="main">,</span> <span class="skolem">x</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vwalk_arcs_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">with</span></span> snoc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Vertex_Walk-vwalk_arcs_tl_empty"><span class="command">lemma</span></span> vwalk_arcs_tl_empty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwalk_arcs <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span> vwalk_arcs <span class="main">(</span>tl <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vwalk_arcs.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="Vertex_Walk-vwalk_arcs_butlast_empty"><span class="command">lemma</span></span> vwalk_arcs_butlast_empty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> vwalk_arcs <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span> vwalk_arcs <span class="main">(</span>butlast <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vwalk_arcs.induct<span class="main">)</span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">joinable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> vwalk <span class="main">⇒</span> <span class="tfree">'a</span> vwalk <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">joinable</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> last <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> hd <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">vwalk_join</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⊕</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main"><span class="free">⊕</span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">@</span> tl <span class="free"><span class="bound"><span class="entity">q</span></span></span>"</span></span>

<span class="keyword1" id="Vertex_Walk-joinable_Nil_l_iff"><span class="command">lemma</span></span> joinable_Nil_l_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"joinable <span class="main">[]</span> <span class="free">p</span> <span class="main">=</span> False"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> joinable_Nil_r_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"joinable <span class="free">q</span> <span class="main">[]</span> <span class="main">=</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> joinable_def<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-joinable_Cons_l_iff"><span class="command">lemma</span></span> joinable_Cons_l_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> joinable <span class="main">(</span><span class="free">v</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span> joinable <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> joinable_Snoc_r_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> joinable <span class="free">p</span> <span class="main">(</span><span class="free">q</span> <span class="main">@</span> <span class="main">[</span><span class="free">v</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> joinable <span class="free">p</span> <span class="free">q</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> joinable_def<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-joinableI"><span class="command">lemma</span></span> joinableI<span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"last <span class="free">p</span> <span class="main">=</span> hd <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"joinable <span class="free">p</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> joinable_def<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-vwalk_join_non_Nil"><span class="command">lemma</span></span> vwalk_join_non_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊕</span> <span class="free">q</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> vwalk_join_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Vertex_Walk-vwalk_join_Cons"><span class="command">lemma</span></span> vwalk_join_Cons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">q</span> <span class="main">=</span> <span class="free">u</span> <span class="main">#</span> <span class="free">p</span> <span class="main">⊕</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> vwalk_join_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Vertex_Walk-vwalk_join_def2"><span class="command">lemma</span></span> vwalk_join_def2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"joinable <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊕</span> <span class="free">q</span> <span class="main">=</span> butlast <span class="free">p</span> <span class="main">@</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> joinable_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vwalk_join <span class="free">p</span> <span class="free">q</span> <span class="main">=</span> butlast <span class="free">p</span> <span class="main">@</span> last <span class="free">p</span> <span class="main">#</span> tl <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vwalk_join_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> joinable_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Vertex_Walk-vwalk_join_hd'"><span class="command">lemma</span></span> vwalk_join_hd'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">p</span> <span class="main">⊕</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> hd <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vwalk_join_def<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-vwalk_join_hd"><span class="command">lemma</span></span> vwalk_join_hd<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"joinable <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="free">p</span> <span class="main">⊕</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> hd <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vwalk_join_def joinable_def<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-vwalk_join_last"><span class="command">lemma</span></span> vwalk_join_last<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"joinable <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span><span class="free">p</span> <span class="main">⊕</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> last <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vwalk_join_def2 joinable_def<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-vwalk_join_Nil"><span class="command">lemma</span></span> vwalk_join_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">⊕</span> <span class="main">[]</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vwalk_join_def<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-vwalk_joinI_vwalk'"><span class="command">lemma</span></span> vwalk_joinI_vwalk'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="free">p</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="free">q</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"last <span class="free">p</span> <span class="main">=</span> hd <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="main">(</span><span class="free">p</span> <span class="main">⊕</span> <span class="free">q</span><span class="main">)</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> vwalk_join_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> vwalkI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">q</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹vwalk <span class="free">p</span> <span class="free">G</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹vwalk <span class="free">q</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="free">p</span> <span class="main">@</span> tl <span class="free">q</span><span class="main">)</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">@</span> tl <span class="free">q</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹vwalk <span class="free">p</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> pe_p<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> arcs_ends <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹vwalk <span class="free">p</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> pe_q'<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="main">(</span>tl <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> arcs_ends <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="main">(</span>tl <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>vwalk_arcs <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_vwalk_arcs_cons<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹vwalk <span class="free">q</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="main">(</span><span class="free">p</span> <span class="main">@</span> tl <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> arcs_ends <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"tl <span class="free">q</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> pe_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"tl <span class="free">q</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹vwalk <span class="free">p</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="free">q</span><span class="main">,</span> hd <span class="main">(</span>tl <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>vwalk_arcs <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹vwalk <span class="free">q</span> <span class="free">G</span>›</span></span> Cons <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹vwalk <span class="free">q</span> <span class="free">G</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pe_p pe_q' <span class="quoted"><span class="quoted">‹last <span class="free">p</span> <span class="main">=</span> hd <span class="free">q</span>›</span></span> vwalk_arcs_append<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Vertex_Walk-vwalk_joinI_vwalk"><span class="command">lemma</span></span> vwalk_joinI_vwalk<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="free">p</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="free">q</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"joinable <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="main">(</span><span class="free">p</span> <span class="main">⊕</span> <span class="free">q</span><span class="main">)</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms vwalk_joinI_vwalk' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> joinable_def<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-vwalk_join_split"><span class="command">lemma</span></span> vwalk_join_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> <span class="bound">q</span> <span class="main">⊕</span> <span class="bound">r</span>
  <span class="main">∧</span> last <span class="bound">q</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∧</span> hd <span class="bound">r</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">∈</span> set <span class="free">p</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pre_p</span></span> <span class="skolem"><span class="skolem">post_p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">pre_p</span> <span class="main">@</span> <span class="free">u</span> <span class="main">#</span> <span class="skolem">post_p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">atomize_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> split_list<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">pre_p</span> <span class="main">@</span> <span class="main">[</span><span class="free">u</span><span class="main">]</span><span class="main">)</span> <span class="main">⊕</span> <span class="main">(</span><span class="free">u</span> <span class="main">#</span> <span class="skolem">post_p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> vwalk_join_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Vertex_Walk-vwalkI_vwalk_join_l"><span class="command">lemma</span></span> vwalkI_vwalk_join_l<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="main">(</span><span class="free">p</span> <span class="main">⊕</span> <span class="free">q</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="free">p</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> vwalk_join_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> vwalkI_append_l<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-vwalkI_vwalk_join_r"><span class="command">lemma</span></span> vwalkI_vwalk_join_r<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"joinable <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="main">(</span><span class="free">p</span> <span class="main">⊕</span> <span class="free">q</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="free">q</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vwalk_join_def2 joinable_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> vwalkI_append_r<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-vwalk_join_assoc'"><span class="command">lemma</span></span> vwalk_join_assoc'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">⊕</span> <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">r</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⊕</span> <span class="free">q</span> <span class="main">⊕</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vwalk_join_def<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-vwalk_join_assoc"><span class="command">lemma</span></span> vwalk_join_assoc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"joinable <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"joinable <span class="free">q</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">⊕</span> <span class="free">q</span><span class="main">)</span> <span class="main">⊕</span> <span class="free">r</span> <span class="main">=</span> <span class="free">p</span> <span class="main">⊕</span> <span class="free">q</span> <span class="main">⊕</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vwalk_join_def joinable_def<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-joinable_vwalk_join_r_iff"><span class="command">lemma</span></span> joinable_vwalk_join_r_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"joinable <span class="free">p</span> <span class="main">(</span><span class="free">q</span> <span class="main">⊕</span> <span class="free">r</span><span class="main">)</span> <span class="main">⟷</span> joinable <span class="free">p</span> <span class="free">q</span> <span class="main">∨</span> <span class="main">(</span><span class="free">q</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> joinable <span class="free">p</span> <span class="main">(</span>tl <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vwalk_join_def joinable_def<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-joinable_vwalk_join_l_iff"><span class="command">lemma</span></span> joinable_vwalk_join_l_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"joinable <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"joinable <span class="main">(</span><span class="free">p</span> <span class="main">⊕</span> <span class="free">q</span><span class="main">)</span> <span class="free">r</span> <span class="main">⟷</span> joinable <span class="free">q</span> <span class="free">r</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> joinable_def vwalk_join_last<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> joinable_simps <span class="main">=</span>
  joinable_vwalk_join_l_iff
  joinable_vwalk_join_r_iff

<span class="keyword1" id="Vertex_Walk-joinable_cyclic_omit"><span class="command">lemma</span></span> joinable_cyclic_omit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"joinable <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"joinable <span class="free">q</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"joinable <span class="free">q</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"joinable <span class="free">p</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> joinable_def<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-joinable_non_Nil"><span class="command">lemma</span></span> joinable_non_Nil<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"joinable <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> joinable_def<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-vwalk_join_vwalk_length"><span class="command">lemma</span></span> vwalk_join_vwalk_length<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"joinable <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vwalk_length <span class="main">(</span><span class="free">p</span> <span class="main">⊕</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> vwalk_length <span class="free">p</span> <span class="main">+</span> vwalk_length <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> vwalk_join_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_Suc_le<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> joinable_non_Nil<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-vwalk_join_arcs"><span class="command">lemma</span></span> vwalk_join_arcs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"joinable <span class="free">p</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vwalk_arcs <span class="main">(</span><span class="free">p</span> <span class="main">⊕</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> vwalk_arcs <span class="free">p</span> <span class="main">@</span> vwalk_arcs <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">v</span> <span class="skolem">vs</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vwalk_join_hd<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> joinable_def vwalk_join_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Vertex_Walk-vwalk_join_arcs1"><span class="command">lemma</span></span> vwalk_join_arcs1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">⊕</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="free">q</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms vwalk_join_def set_vwalk_arcs_append1 subset_trans<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-vwalk_join_arcs2"><span class="command">lemma</span></span> vwalk_join_arcs2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"joinable <span class="free">q</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">⊕</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="free">r</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vwalk_join_arcs<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">concat_vpath</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">concat_vpath</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> vwalk_to_vpath <span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⊕</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Vertex_Walk-concat_vpath_is_vpath"><span class="command">lemma</span></span> concat_vpath_is_vpath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p_props<span class="main">:</span> <span class="quoted"><span class="quoted">"vwalk <span class="free">p</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">p</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="free">p</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> q_props<span class="main">:</span> <span class="quoted"><span class="quoted">"vwalk <span class="free">q</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">q</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="free">q</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vpath <span class="main">(</span>concat_vpath <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">G</span> <span class="main">∧</span> hd <span class="main">(</span>concat_vpath <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">u</span>
    <span class="main">∧</span> last <span class="main">(</span>concat_vpath <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> joinable<span class="main">:</span> <span class="quoted"><span class="quoted">"joinable <span class="free">p</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vpath <span class="main">(</span>concat_vpath <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> concat_vpath_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> joinable
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> vwalk_to_vpath_vpath vwalk_joinI_vwalk<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>concat_vpath <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span>concat_vpath <span class="free">p</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> concat_vpath_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword2"><span class="keyword">and</span></span> joinable
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vwalk_to_vpath_hd vwalk_to_vpath_last
      vwalk_join_hd vwalk_join_last<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Vertex_Walk-concat_vpath_exists"><span class="command">lemma</span></span> concat_vpath_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p_props<span class="main">:</span> <span class="quoted"><span class="quoted">"vwalk <span class="free">p</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">p</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="free">p</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> q_props<span class="main">:</span> <span class="quoted"><span class="quoted">"vwalk <span class="free">q</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">q</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="free">q</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">r</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vpath <span class="free">r</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">r</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="free">r</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> concat_vpath_is_vpath<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> vpaths_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">p</span><span class="main">.</span> vpath <span class="bound">p</span> <span class="free">G</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> vpath <span class="bound">p</span> <span class="free">G</span><span class="main">}</span>
    <span class="main">⊆</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> verts <span class="free">G</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">≤</span> card <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"vpath <span class="skolem">p</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">p</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vpath <span class="skolem">p</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">p</span> <span class="main">=</span> card <span class="main">(</span>set <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distinct_card<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> card <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹vpath <span class="skolem">p</span> <span class="free">G</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> card_mono <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> vpathE<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">p</span> <span class="main">≤</span> card <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> set <span class="bound">xs</span> <span class="main">⊆</span> verts <span class="free">G</span> <span class="main">∧</span> length <span class="bound">xs</span> <span class="main">≤</span> card <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_lists_length_le<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> reachable_vwalk_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> vwalk <span class="bound">p</span> <span class="free">G</span> <span class="main">∧</span> hd <span class="bound">p</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∧</span> last <span class="bound">p</span> <span class="main">=</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> converse_reachable_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> base <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">v</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vwalk_def arcs_ends_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">u</span> <span class="skolem">w</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="skolem">p</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">p</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="main">(</span><span class="skolem">u</span><span class="main">#</span><span class="skolem">p</span><span class="main">)</span> <span class="free">G</span> <span class="main">∧</span> hd <span class="main">(</span><span class="skolem">u</span><span class="main">#</span><span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">∧</span> last <span class="main">(</span><span class="skolem">u</span><span class="main">#</span><span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> step <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> vwalk_consI <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> adj_in_verts<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="skolem">p</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">p</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">p</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹vwalk <span class="skolem">p</span> <span class="free">G</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vwalk_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Base <span class="skolem">u</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">w</span> <span class="skolem">x</span> <span class="skolem">es</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> adj_reachable_trans<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Cons<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> vwalk_consE<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> reachable_vpath_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> vpath <span class="bound">p</span> <span class="free">G</span> <span class="main">∧</span> hd <span class="bound">p</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∧</span> last <span class="bound">p</span> <span class="main">=</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="skolem">p</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">p</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">p</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reachable_vwalk_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"vwalk_to_vpath <span class="skolem">p</span>"</span></span><span class="main"><span class="main">]</span></span>
      <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vwalk_to_vpath_hd vwalk_to_vpath_last vwalk_to_vpath_vpath<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reachable_vwalk_conv<span class="main">)</span>

<span class="keyword1" id="Vertex_Walk-in_set_vwalk_arcsE"><span class="command">lemma</span></span> in_set_vwalk_arcsE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>vwalk_arcs <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vwalk_arcs.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Vertex_Walk-vwalk_rev_ex"><span class="command">lemma</span></span> vwalk_rev_ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"symmetric <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="free">p</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="main">(</span>rev <span class="free">p</span><span class="main">)</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="skolem">xs</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹vwalk <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> vwalk_consE<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="main">(</span>rev <span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="main">(</span>rev <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> vwalkI<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹vwalk <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rev <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> arcs_ends <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹vwalk <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="main">(</span>rev <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> arcs_ends <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹symmetric <span class="free">G</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> set_vwalk_arcs_rev<span class="main">)</span>
           <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> arcs_ends_symmetric<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rev <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="main">(</span>rev <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Vertex_Walk-vwalk_singleton"><span class="command">lemma</span></span> vwalk_singleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vwalk <span class="main">[</span><span class="free">u</span><span class="main">]</span> <span class="free">G</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> vwalk_Cons_Cons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vwalk <span class="main">(</span><span class="free">u</span> <span class="main">#</span> <span class="free">v</span> <span class="main">#</span> <span class="free">ws</span><span class="main">)</span> <span class="free">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> arcs_ends <span class="free">G</span> <span class="main">∧</span> vwalk <span class="main">(</span><span class="free">v</span> <span class="main">#</span> <span class="free">ws</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> vwalk_consE <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> vwalk_consI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> awalk_imp_vwalk<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> vwalk_arcs.induct<span class="main">)</span>
     <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_simps <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_arcs_imp_in_arcs_ends<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Digraph_Component_Vwalk">
<div class="head">
<h1>Theory Digraph_Component_Vwalk</h1>
</div>
<pre class="source"><span class="comment1">(* Title:  Digraph_Component_Vwalk.thy
   Author: Lars Noschinski, TU München
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Digraph_Component_Vwalk
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Digraph_Component.html">Digraph_Component</a>
  <a href="Vertex_Walk.html">Vertex_Walk</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Lemmas for Vertex Walks›</span></span>

<span class="keyword1" id="Digraph_Component_Vwalk-vwalkI_subgraph"><span class="command">lemma</span></span> vwalkI_subgraph<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="free">p</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vwalk <span class="free">p</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subgraph_def vwalk_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> arcs_ends <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vwalk_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> arcs_ends <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹subgraph <span class="free">H</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arcs_ends_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>vwalk_arcs <span class="free">p</span><span class="main">)</span> <span class="main">⊆</span> arcs_ends <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digraph_Component_Vwalk-vpathI_subgraph"><span class="command">lemma</span></span> vpathI_subgraph<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vpath <span class="free">p</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">G</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vpath <span class="free">p</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> vwalkI_subgraph<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> loopfree_digraph<span class="main">)</span> vpathI_arc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> arcs_ends <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vpath <span class="main">[</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">]</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> vpathI vwalkI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> adj_in_verts adj_not_same<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Digraph_Isomorphism">
<div class="head">
<h1>Theory Digraph_Isomorphism</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Digraph_Isomorphism <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Arc_Walk.html">Arc_Walk</a>
  <a href="Digraph.html">Digraph</a>
  <a href="Digraph_Component.html">Digraph_Component</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Isomorphisms of Digraphs›</span></span>

<span class="keyword1"><span class="command">record</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'aa</span><span class="main">,</span><span class="tfree">'bb</span><span class="main">)</span> digraph_isomorphism <span class="main">=</span>
  iso_verts <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'aa</span>"</span></span>
  iso_arcs <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'bb</span>"</span></span>
  iso_head <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'bb</span> <span class="main">⇒</span> <span class="tfree">'aa</span>"</span></span>
  iso_tail <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'bb</span> <span class="main">⇒</span> <span class="tfree">'aa</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> <span class="entity">digraph_isomorphism</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'aa</span><span class="main">,</span><span class="tfree">'bb</span><span class="main">)</span> digraph_isomorphism <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">digraph_isomorphism</span> <span class="free"><span class="bound"><span class="entity">hom</span></span></span> <span class="main">≡</span>
    wf_digraph <span class="free">G</span> <span class="main">∧</span>
    inj_on <span class="main">(</span>iso_verts <span class="free"><span class="bound"><span class="entity">hom</span></span></span><span class="main">)</span> <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span> <span class="main">∧</span>
    inj_on <span class="main">(</span>iso_arcs <span class="free"><span class="bound"><span class="entity">hom</span></span></span><span class="main">)</span> <span class="main">(</span>arcs <span class="free">G</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> arcs <span class="free">G</span><span class="main">.</span> 
    iso_verts <span class="free"><span class="bound"><span class="entity">hom</span></span></span> <span class="main">(</span>tail <span class="free">G</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> iso_tail <span class="free"><span class="bound"><span class="entity">hom</span></span></span> <span class="main">(</span>iso_arcs <span class="free"><span class="bound"><span class="entity">hom</span></span></span> <span class="bound">a</span><span class="main">)</span> <span class="main">∧</span>
    iso_verts <span class="free"><span class="bound"><span class="entity">hom</span></span></span> <span class="main">(</span>head <span class="free">G</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> iso_head <span class="free"><span class="bound"><span class="entity">hom</span></span></span> <span class="main">(</span>iso_arcs <span class="free"><span class="bound"><span class="entity">hom</span></span></span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> <span class="entity">inv_iso</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'aa</span><span class="main">,</span><span class="tfree">'bb</span><span class="main">)</span> digraph_isomorphism <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'aa</span><span class="main">,</span><span class="tfree">'bb</span><span class="main">,</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> digraph_isomorphism"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inv_iso</span> <span class="free"><span class="bound"><span class="entity">hom</span></span></span> <span class="main">≡</span> <span class="main">⦇</span>
    iso_verts <span class="main">=</span> the_inv_into <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span> <span class="main">(</span>iso_verts <span class="free"><span class="bound"><span class="entity">hom</span></span></span><span class="main">)</span><span class="main">,</span>
    iso_arcs <span class="main">=</span> the_inv_into <span class="main">(</span>arcs <span class="free">G</span><span class="main">)</span> <span class="main">(</span>iso_arcs <span class="free"><span class="bound"><span class="entity">hom</span></span></span><span class="main">)</span><span class="main">,</span>
    iso_head <span class="main">=</span> head <span class="free">G</span><span class="main">,</span>
    iso_tail <span class="main">=</span> tail <span class="free">G</span>
    <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">app_iso</span>
    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'aa</span><span class="main">,</span><span class="tfree">'bb</span><span class="main">)</span> digraph_isomorphism <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'aa</span><span class="main">,</span><span class="tfree">'bb</span><span class="main">)</span> pre_digraph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">app_iso</span> <span class="free"><span class="bound"><span class="entity">hom</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">⦇</span> verts <span class="main">=</span> iso_verts <span class="free"><span class="bound"><span class="entity">hom</span></span></span> <span class="main">`</span> verts <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> arcs <span class="main">=</span> iso_arcs <span class="free"><span class="bound"><span class="entity">hom</span></span></span> <span class="main">`</span> arcs <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span>
    tail <span class="main">=</span> iso_tail <span class="free"><span class="bound"><span class="entity">hom</span></span></span><span class="main">,</span> head <span class="main">=</span> iso_head <span class="free"><span class="bound"><span class="entity">hom</span></span></span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">digraph_iso</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'c</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> bool"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">digraph_iso</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">f</span><span class="main">.</span> pre_digraph.digraph_isomorphism <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">f</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> app_iso <span class="bound">f</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>

<span class="keyword1" id="Digraph_Isomorphism-verts_app_iso"><span class="command">lemma</span></span> verts_app_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"verts <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> iso_verts <span class="free">hom</span> <span class="main">`</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> arcs_app_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"arcs <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> iso_arcs <span class="free">hom</span> <span class="main">`</span>arcs <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> tail_app_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"tail <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> iso_tail <span class="free">hom</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> head_app_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"head <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> iso_head <span class="free">hom</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> app_iso_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> app_iso_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> verts_app_iso arcs_app_iso tail_app_iso head_app_iso

<span class="keyword1"><span class="command">context</span></span> pre_digraph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> iso_verts_inv_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟹</span> iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>iso_verts <span class="free">hom</span> <span class="bound">u</span><span class="main">)</span> <span class="main">=</span> <span class="bound">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> iso_arcs_inv_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> iso_arcs <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>iso_arcs <span class="free">hom</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> iso_verts_iso_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> verts <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> iso_verts <span class="free">hom</span> <span class="main">(</span>iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="bound">u</span><span class="main">)</span> <span class="main">=</span> <span class="bound">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> iso_arcs_iso_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> arcs <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> iso_arcs <span class="free">hom</span> <span class="main">(</span>iso_arcs <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> iso_tail_inv_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"iso_tail <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="main">=</span> tail <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> iso_head_inv_iso<span class="main">:</span> <span class="quoted"><span class="quoted">"iso_head <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="main">=</span> head <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> verts_app_inv_iso<span class="main">:</span><span class="quoted"><span class="quoted">"iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="main">`</span> iso_verts <span class="free">hom</span> <span class="main">`</span> verts <span class="free">G</span> <span class="main">=</span> verts <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> arcs_app_inv_iso<span class="main">:</span><span class="quoted"><span class="quoted">"iso_arcs <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="main">`</span> iso_arcs <span class="free">hom</span> <span class="main">`</span> arcs <span class="free">G</span> <span class="main">=</span> arcs <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inv_iso_def digraph_isomorphism_def the_inv_into_f_f<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> iso_inv_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span>
   iso_verts_inv_iso iso_verts_iso_inv
   iso_arcs_inv_iso iso_arcs_iso_inv
   verts_app_inv_iso arcs_app_inv_iso
   iso_tail_inv_iso iso_head_inv_iso

<span class="keyword1" id="Digraph_Isomorphism-app_iso_inv"><span class="command">lemma</span></span> app_iso_inv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"app_iso <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> pre_digraph.equality<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>

<span class="keyword1" id="Digraph_Isomorphism-iso_verts_eq_iff"><span class="command">lemma</span></span> iso_verts_eq_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"iso_verts <span class="free">hom</span> <span class="free">u</span> <span class="main">=</span> iso_verts <span class="free">hom</span> <span class="free">v</span> <span class="main">⟷</span> <span class="free">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> digraph_isomorphism_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> inj_onD<span class="main">)</span>

<span class="keyword1" id="Digraph_Isomorphism-iso_arcs_eq_iff"><span class="command">lemma</span></span> iso_arcs_eq_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e2</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"iso_arcs <span class="free">hom</span> <span class="free">e1</span> <span class="main">=</span> iso_arcs <span class="free">hom</span> <span class="free">e2</span> <span class="main">⟷</span> <span class="free">e1</span> <span class="main">=</span> <span class="free">e2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> digraph_isomorphism_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> inj_onD<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> iso_verts_tail<span class="main">:</span> <span class="quoted"><span class="quoted">"iso_tail <span class="free">hom</span> <span class="main">(</span>iso_arcs <span class="free">hom</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> iso_verts <span class="free">hom</span> <span class="main">(</span>tail <span class="free">G</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> iso_verts_head<span class="main">:</span> <span class="quoted"><span class="quoted">"iso_head <span class="free">hom</span> <span class="main">(</span>iso_arcs <span class="free">hom</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> iso_verts <span class="free">hom</span> <span class="main">(</span>head <span class="free">G</span> <span class="free">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> digraph_isomorphism_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Digraph_Isomorphism-digraph_isomorphism_inj_on_arcs"><span class="command">lemma</span></span> digraph_isomorphism_inj_on_arcs<span class="main">:</span>
  <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span> <span class="main">⟹</span> inj_on <span class="main">(</span>iso_arcs <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>arcs <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> digraph_isomorphism_def<span class="main">)</span>

<span class="keyword1" id="Digraph_Isomorphism-digraph_isomorphism_inj_on_verts"><span class="command">lemma</span></span> digraph_isomorphism_inj_on_verts<span class="main">:</span>
  <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span> <span class="main">⟹</span> inj_on <span class="main">(</span>iso_verts <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> digraph_isomorphism_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> wf_digraphI_app_iso<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">?</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> arcs <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> e'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e'</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"iso_arcs <span class="free">hom</span> <span class="skolem">e'</span> <span class="main">=</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"iso_verts <span class="free">hom</span> <span class="main">(</span>head <span class="free">G</span> <span class="skolem">e'</span><span class="main">)</span> <span class="main">∈</span> verts <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"iso_verts <span class="free">hom</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e'</span><span class="main">)</span> <span class="main">∈</span> verts <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tail <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">∈</span> verts <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"head <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">e</span> <span class="main">∈</span> verts <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e' assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iso_verts_tail iso_verts_head<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> fin_digraphI_app_iso<span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main">?</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fin_digraph <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> wf_digraph <span class="quoted"><span class="quoted">"app_iso <span class="free">hom</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> wf_digraph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Digraph_Isomorphism-digraph_isomorphism_invI"><span class="command">lemma</span></span> digraph_isomorphism_invI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pre_digraph.digraph_isomorphism <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> pre_digraph.digraph_isomorphism_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>verts <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>iso_arcs <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>arcs <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> pre_digraph.digraph_isomorphism_def inv_iso_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inj_on_the_inv_into<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> arcs <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> iso_arcs <span class="free">hom</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
      <span class="quoted"><span class="quoted">"iso_tail <span class="free">hom</span> <span class="main">(</span>iso_arcs <span class="free">hom</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> iso_verts <span class="free">hom</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"iso_head <span class="free">hom</span> <span class="main">(</span>iso_arcs <span class="free">hom</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> iso_verts <span class="free">hom</span> <span class="main">(</span>head <span class="free">G</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>iso_arcs <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>arcs <span class="free">G</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>iso_verts <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> digraph_isomorphism_def<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> B <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>tail <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span>
      <span class="main">=</span> iso_tail <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>iso_arcs <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inv_iso_def the_inv_into_f_f<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> B <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>head <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span>
      <span class="main">=</span> iso_head <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>iso_arcs <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inv_iso_def the_inv_into_f_f<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Digraph_Isomorphism-awalk_app_isoI"><span class="command">lemma</span></span> awalk_app_isoI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pre_digraph.awalk <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="main">(</span>iso_verts <span class="free">hom</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>iso_arcs <span class="free">hom</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>iso_verts <span class="free">hom</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> wf_digraph <span class="quoted"><span class="quoted">"app_iso <span class="free">hom</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hom <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_simps H.awalk_simps iso_verts_head iso_verts_tail<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digraph_Isomorphism-awalk_app_isoD"><span class="command">lemma</span></span> awalk_app_isoD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"pre_digraph.awalk <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"awalk <span class="main">(</span>iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>iso_arcs <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> wf_digraph <span class="quoted"><span class="quoted">"app_iso <span class="free">hom</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hom <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_simps H.awalk_simps iso_verts_head iso_verts_tail<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digraph_Isomorphism-awalk_verts_app_iso_eq"><span class="command">lemma</span></span> awalk_verts_app_iso_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pre_digraph.awalk_verts <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="main">(</span>iso_verts <span class="free">hom</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>iso_arcs <span class="free">hom</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span>
    <span class="main">=</span> map <span class="main">(</span>iso_verts <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.awalk_verts.simps iso_verts_head iso_verts_tail awalk_Cons_iff<span class="main">)</span>

<span class="comment1">(*
lemma awalk_verts_app_iso_eq':
  assumes hom: "digraph_isomorphism hom" and w: "pre_digraph.awalk (app_iso hom G) u p v"
  shows "pre_digraph.awalk_verts (app_iso hom G) u p
    = map (iso_verts hom) (awalk_verts (iso_verts (inv_iso hom) u) (map (iso_arcs (inv_iso hom)) p))"
proof -
  interpret H: wf_digraph "app_iso hom G" using hom ..
  have w': "awalk (iso_verts (inv_iso hom) u) (map (iso_arcs (inv_iso hom)) p) (iso_verts (inv_iso hom) v)"
    using w hom by (rule awalk_app_isoD)
  have "pre_digraph.awalk_verts (app_iso hom G) u p =
      pre_digraph.awalk_verts (app_iso hom G) (iso_verts hom (iso_verts (inv_iso hom) u)) (map (iso_arcs hom) (map (iso_arcs (inv_iso hom)) p))"
    using hom w by (auto simp add: o_def subsetD cong: map_cong)
  also have "… = map (iso_verts hom) (awalk_verts (iso_verts (inv_iso hom) u) (map (iso_arcs (inv_iso hom)) p))"
    using hom w' by (rule awalk_verts_app_iso_eq)
  finally show ?thesis .
qed
*)</span>

<span class="keyword1" id="Digraph_Isomorphism-arcs_ends_app_iso_eq"><span class="command">lemma</span></span> arcs_ends_app_iso_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"arcs_ends <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>iso_verts <span class="free">hom</span> <span class="bound">u</span><span class="main">,</span> iso_verts <span class="free">hom</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> arcs_ends <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arcs_ends_conv image_image iso_verts_head iso_verts_tail
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>

<span class="keyword1" id="Digraph_Isomorphism-in_arcs_app_iso_eq"><span class="command">lemma</span></span> in_arcs_app_iso_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"in_arcs <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="main">(</span>iso_verts <span class="free">hom</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> iso_arcs <span class="free">hom</span> <span class="main">`</span> in_arcs <span class="free">G</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> in_arcs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iso_verts_head<span class="main">)</span>

<span class="keyword1" id="Digraph_Isomorphism-out_arcs_app_iso_eq"><span class="command">lemma</span></span> out_arcs_app_iso_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"out_arcs <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="main">(</span>iso_verts <span class="free">hom</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> iso_arcs <span class="free">hom</span> <span class="main">`</span> out_arcs <span class="free">G</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> out_arcs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iso_verts_tail<span class="main">)</span>

<span class="keyword1" id="Digraph_Isomorphism-in_degree_app_iso_eq"><span class="command">lemma</span></span> in_degree_app_iso_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"in_degree <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="main">(</span>iso_verts <span class="free">hom</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> in_degree <span class="free">G</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> in_degree_def in_arcs_app_iso_eq<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> card_image<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>iso_arcs <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>in_arcs <span class="free">G</span> <span class="free">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> digraph_isomorphism_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> subset_inj_on<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digraph_Isomorphism-out_degree_app_iso_eq"><span class="command">lemma</span></span> out_degree_app_iso_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"out_degree <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="main">(</span>iso_verts <span class="free">hom</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> out_degree <span class="free">G</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> out_degree_def out_arcs_app_iso_eq<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> card_image<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>iso_arcs <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>out_arcs <span class="free">G</span> <span class="free">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> digraph_isomorphism_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> subset_inj_on<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digraph_Isomorphism-in_arcs_app_iso_eq'"><span class="command">lemma</span></span> in_arcs_app_iso_eq'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"in_arcs <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="free">u</span> <span class="main">=</span> iso_arcs <span class="free">hom</span> <span class="main">`</span> in_arcs <span class="free">G</span> <span class="main">(</span>iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms in_arcs_app_iso_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">hom</span></span> <span class="quoted"><span class="quoted">"iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="free">u</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Digraph_Isomorphism-out_arcs_app_iso_eq'"><span class="command">lemma</span></span> out_arcs_app_iso_eq'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"out_arcs <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="free">u</span> <span class="main">=</span> iso_arcs <span class="free">hom</span> <span class="main">`</span> out_arcs <span class="free">G</span> <span class="main">(</span>iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms out_arcs_app_iso_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">hom</span></span> <span class="quoted"><span class="quoted">"iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="free">u</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Digraph_Isomorphism-in_degree_app_iso_eq'"><span class="command">lemma</span></span> in_degree_app_iso_eq'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"in_degree <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="free">u</span> <span class="main">=</span> in_degree <span class="free">G</span> <span class="main">(</span>iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms in_degree_app_iso_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">hom</span></span> <span class="quoted"><span class="quoted">"iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="free">u</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Digraph_Isomorphism-out_degree_app_iso_eq'"><span class="command">lemma</span></span> out_degree_app_iso_eq'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"out_degree <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="free">u</span> <span class="main">=</span> out_degree <span class="free">G</span> <span class="main">(</span>iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="free">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms out_degree_app_iso_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">hom</span></span> <span class="quoted"><span class="quoted">"iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="free">u</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> app_iso_eq <span class="main">=</span>
  awalk_verts_app_iso_eq
  arcs_ends_app_iso_eq
  in_arcs_app_iso_eq'
  out_arcs_app_iso_eq'
  in_degree_app_iso_eq'
  out_degree_app_iso_eq'

<span class="keyword1" id="Digraph_Isomorphism-reachableI_app_iso"><span class="command">lemma</span></span> reachableI_app_iso<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iso_verts <span class="free">hom</span> <span class="free">u</span><span class="main">)</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub>app_iso <span class="free">hom</span> <span class="free">G</span></sub><span class="hidden">⇙</span> <span class="main">(</span>iso_verts <span class="free">hom</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> wf_digraph <span class="quoted"><span class="quoted">"app_iso <span class="free">hom</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hom <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> r <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reachable_awalk<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"H.awalk <span class="main">(</span>iso_verts <span class="free">hom</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>iso_arcs <span class="free">hom</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>iso_verts <span class="free">hom</span> <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hom <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> awalk_app_isoI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> H.reachable_awalk<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digraph_Isomorphism-awalk_app_iso_eq"><span class="command">lemma</span></span> awalk_app_iso_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> iso_verts <span class="free">hom</span> <span class="main">`</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> iso_verts <span class="free">hom</span> <span class="main">`</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">⊆</span> iso_arcs <span class="free">hom</span> <span class="main">`</span> arcs <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pre_digraph.awalk <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>
    <span class="main">⟷</span> awalk <span class="main">(</span>iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>iso_arcs <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> wf_digraph <span class="quoted"><span class="quoted">"app_iso <span class="free">hom</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hom <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_simps H.awalk_simps iso_verts_head iso_verts_tail<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digraph_Isomorphism-reachable_app_iso_eq"><span class="command">lemma</span></span> reachable_app_iso_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> iso_verts <span class="free">hom</span> <span class="main">`</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> iso_verts <span class="free">hom</span> <span class="main">`</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub>app_iso <span class="free">hom</span> <span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span> <span class="main">⟷</span> iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> wf_digraph <span class="quoted"><span class="quoted">"app_iso <span class="free">hom</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hom <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"H.awalk <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> H.reachable_awalk<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">p</span> <span class="main">⊆</span> iso_arcs <span class="free">hom</span> <span class="main">`</span> arcs <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H.awalk_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_app_iso_eq reachable_awalk<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"awalk <span class="main">(</span>iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="free">u</span><span class="main">)</span> <span class="skolem">p0</span> <span class="main">(</span>iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reachable_awalk<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">p0</span> <span class="main">⊆</span> arcs <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> awalk_def<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> map <span class="main">(</span>iso_arcs <span class="free">hom</span><span class="main">)</span> <span class="skolem">p0</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">p</span> <span class="main">⊆</span> iso_arcs <span class="free">hom</span> <span class="main">`</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p0</span> <span class="main">=</span> map <span class="main">(</span>iso_arcs <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span><span class="main">)</span> <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">p0</span> <span class="main">⊆</span> <span class="main">_</span>›</span></span> hom <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_def map_idI subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_app_iso_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> H.reachable_awalk<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Digraph_Isomorphism-connectedI_app_iso"><span class="command">lemma</span></span> connectedI_app_iso<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"connected <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"symcl <span class="main">(</span>arcs_ends <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>iso_verts <span class="free">hom</span> <span class="bound">u</span><span class="main">,</span> iso_verts <span class="free">hom</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> symcl <span class="main">(</span>arcs_ends <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hom <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> app_iso_eq symcl_def<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span> <span class="main">(</span>symcl <span class="main">(</span>arcs_ends <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iso_verts <span class="free">hom</span> <span class="skolem">u</span><span class="main">,</span> iso_verts <span class="free">hom</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> rtrancl_on <span class="main">(</span>verts <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>symcl <span class="main">(</span>arcs_ends <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>iso_verts <span class="free">hom</span> <span class="skolem">x</span><span class="main">,</span> iso_verts <span class="free">hom</span> <span class="skolem">y</span><span class="main">)</span>
          <span class="main">∈</span> rtrancl_on <span class="main">(</span>verts <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>symcl <span class="main">(</span>arcs_ends <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> step <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> rtrancl_on_into_rtrancl_on<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"iso_verts <span class="free"><span class="free"><span class="free">hom</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_on_trans<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> step<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> c <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> connected_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Digraph_Isomorphism-digraph_iso_swap"><span class="command">lemma</span></span> digraph_iso_swap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"digraph_iso <span class="free">G</span> <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"digraph_iso <span class="free">H</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"pre_digraph.digraph_isomorphism <span class="free">G</span> <span class="skolem">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> app_iso <span class="skolem">f</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> digraph_iso_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre_digraph.digraph_isomorphism <span class="free">H</span> <span class="main">(</span>pre_digraph.inv_iso <span class="free">G</span> <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"app_iso <span class="main">(</span>pre_digraph.inv_iso <span class="free">G</span> <span class="skolem">f</span><span class="main">)</span> <span class="free">H</span> <span class="main">=</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_digraph.digraph_isomorphism_invI pre_digraph.app_iso_inv<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> digraph_iso_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">o_iso</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'c</span><span class="main">,</span><span class="tfree">'d</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> digraph_isomorphism <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'c</span><span class="main">,</span><span class="tfree">'d</span><span class="main">)</span> digraph_isomorphism <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">,</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> digraph_isomorphism"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">o_iso</span> <span class="free"><span class="bound"><span class="entity">hom2</span></span></span> <span class="free"><span class="bound"><span class="entity">hom1</span></span></span> <span class="main">=</span> <span class="main">⦇</span>
    iso_verts <span class="main">=</span> iso_verts <span class="free"><span class="bound"><span class="entity">hom2</span></span></span> <span class="keyword1">o</span> iso_verts <span class="free"><span class="bound"><span class="entity">hom1</span></span></span><span class="main">,</span>
    iso_arcs <span class="main">=</span> iso_arcs <span class="free"><span class="bound"><span class="entity">hom2</span></span></span> <span class="keyword1">o</span> iso_arcs <span class="free"><span class="bound"><span class="entity">hom1</span></span></span><span class="main">,</span>
    iso_head <span class="main">=</span> iso_head <span class="free"><span class="bound"><span class="entity">hom2</span></span></span><span class="main">,</span>
    iso_tail <span class="main">=</span> iso_tail <span class="free"><span class="bound"><span class="entity">hom2</span></span></span>
    <span class="main">⦈</span>"</span></span>

<span class="keyword1" id="Digraph_Isomorphism-digraph_iso_trans"><span class="command">lemma</span></span> digraph_iso_trans<span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_iso <span class="free">G</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"digraph_iso <span class="free">H</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"digraph_iso <span class="free">G</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">hom1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"pre_digraph.digraph_isomorphism <span class="free">G</span> <span class="skolem">hom1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> app_iso <span class="skolem">hom1</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> digraph_iso_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">hom2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"pre_digraph.digraph_isomorphism <span class="free">H</span> <span class="skolem">hom2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> app_iso <span class="skolem">hom2</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> digraph_iso_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre_digraph.digraph_isomorphism <span class="free">G</span> <span class="main">(</span>o_iso <span class="skolem">hom2</span> <span class="skolem">hom1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> app_iso <span class="main">(</span>o_iso <span class="skolem">hom2</span> <span class="skolem">hom1</span><span class="main">)</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_iso_def app_iso_def pre_digraph.digraph_isomorphism_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> comp_inj_on<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> comp_inj_on<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> digraph_iso_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> digraph_isomorphism_subgraphI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pre_digraph.digraph_isomorphism <span class="free">H</span> <span class="free">hom</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.digraph_isomorphism_def subgraph_def compatible_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subset_inj_on<span class="main">)</span>

<span class="comment1">(* XXX move *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> verts_app_inv_iso_subgraph<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="main">`</span> iso_verts <span class="free">hom</span> <span class="main">`</span> <span class="free">V</span> <span class="main">=</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> iso_verts <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>iso_verts <span class="free">hom</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_image <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> image_cong<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* XXX move *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> arcs_app_inv_iso_subgraph<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> arcs <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"iso_arcs <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="main">`</span> iso_arcs <span class="free">hom</span> <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> iso_arcs <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>iso_arcs <span class="free">hom</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_image <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> image_cong<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* XXX move *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> app_iso_inv_subgraph<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"app_iso <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">interpret</span></span> wf_digraph <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> verts <span class="free">H</span> <span class="main">⟹</span> <span class="bound">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> arcs <span class="free">H</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> pre_digraph.equality<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> verts_app_inv_iso_subgraph
      arcs_app_inv_iso_subgraph compatible_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> app_iso_iso_inv_subgraph<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subg<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"app_iso <span class="free">hom</span> <span class="main">(</span>app_iso <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> verts <span class="free">H</span> <span class="main">⟹</span> <span class="bound">u</span> <span class="main">∈</span> iso_verts <span class="free">hom</span> <span class="main">`</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> arcs <span class="free">H</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∈</span> iso_arcs <span class="free">hom</span> <span class="main">`</span> arcs <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgraph_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> pre_digraph.equality<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compatible_def image_image <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> image_cong<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> subgraph_app_isoI'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subg<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">H'</span>"</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H'</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">H</span><span class="main">)</span> <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">H'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subgraph_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre_digraph.digraph_isomorphism <span class="free">H</span> <span class="free">hom</span>"</span></span> <span class="quoted"><span class="quoted">"pre_digraph.digraph_isomorphism <span class="free">H'</span> <span class="free">hom</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> digraph_isomorphism_subgraphI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgraph_def wf_digraph.wf_digraphI_app_iso compatible_def
      <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> digraph_isomorphism_subgraphI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> subgraph_app_isoI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">H</span><span class="main">)</span> <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subgraph_app_isoI' wf_digraph.subgraph_refl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> app_iso_eq_conv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H1</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H2</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"app_iso <span class="free">hom</span> <span class="free">H1</span> <span class="main">=</span> app_iso <span class="free">hom</span> <span class="free">H2</span> <span class="main">⟷</span> <span class="free">H1</span> <span class="main">=</span> <span class="free">H2</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"app_iso <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">H1</span><span class="main">)</span> <span class="main">=</span> app_iso <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">H2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Digraph_Isomorphism-in_arcs_app_iso_cases"><span class="command">lemma</span></span> in_arcs_app_iso_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> arcs <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">a0</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> iso_arcs <span class="free">hom</span> <span class="free">a0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a0</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Digraph_Isomorphism-in_verts_app_iso_cases"><span class="command">lemma</span></span> in_verts_app_iso_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">v0</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> iso_verts <span class="free">hom</span> <span class="free">v0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v0</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> max_subgraph_iso<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subg<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pre_digraph.max_subgraph <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="free">P</span> <span class="free">H</span>
    <span class="main">⟷</span> max_subgraph <span class="main">(</span><span class="free">P</span> <span class="keyword1">o</span> app_iso <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>app_iso <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> hom_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"pre_digraph.digraph_isomorphism <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hom <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> digraph_isomorphism_invI<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> aG<span class="main">:</span> wf_digraph <span class="quoted"><span class="quoted">"app_iso <span class="free">hom</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hom <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span>app_iso <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hom pre_digraph.subgraph_app_isoI'<span class="main">[</span><span class="operator">OF</span> hom_inv subg aG.subgraph_refl<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">H0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H0</span> <span class="main">=</span> app_iso <span class="main">(</span>inv_iso <span class="free">hom</span><span class="main">)</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> H0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> app_iso <span class="free">hom</span> <span class="skolem">H0</span>"</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="skolem">H0</span> <span class="free">G</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> hom subg <span class="quoted"><span class="quoted">‹subgraph <span class="main">_</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
    
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms H0
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_subgraph_def aG.max_subgraph_def pre_digraph.subgraph_app_isoI'
        subgraph_refl pre_digraph.app_iso_eq_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms hom_inv pre_digraph.subgraph_app_isoI<span class="main">[</span><span class="operator">OF</span> hom_inv<span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_subgraph_def aG.max_subgraph_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> allE<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"app_iso <span class="main"><span class="main">(</span></span>inv_iso <span class="free"><span class="free">hom</span></span><span class="main"><span class="main">)</span></span> <span class="skolem"><span class="skolem">H'</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem"><span class="skolem">H'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.subgraph_app_isoI' pre_digraph.app_iso_eq_conv<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> max_subgraph_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> <span class="free">H'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">H''</span><span class="main">.</span> subgraph <span class="free">H'</span> <span class="bound">H''</span> <span class="main">⟹</span> subgraph <span class="bound">H''</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">H''</span> <span class="main">=</span> <span class="free">P'</span> <span class="bound">H''</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"max_subgraph <span class="free">P</span> <span class="free">H</span> <span class="main">=</span> max_subgraph <span class="free">P'</span> <span class="free">H'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> max_subgraph_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> wf_digraph.subgraph_refl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> inj_on_app_iso<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">H</span><span class="main">.</span> subgraph <span class="bound">H</span> <span class="free">G</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>app_iso <span class="free">hom</span><span class="main">)</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> inj_onI<span class="main">)</span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> app_iso_eq_conv<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Graph Invariants›</span></span>

<span class="keyword1"><span class="command">context</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">G</span> <span class="free">hom</span> <span class="keyword2"><span class="keyword">assumes</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"pre_digraph.digraph_isomorphism <span class="free">G</span> <span class="free">hom</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">interpretation</span></span> wf_digraph <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">using</span></span> hom <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.digraph_isomorphism_def<span class="main">)</span>

  <span class="keyword1" id="Digraph_Isomorphism-card_verts_iso"><span class="command">lemma</span></span> card_verts_iso<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>iso_verts <span class="free">hom</span> <span class="main">`</span> verts <span class="free">G</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>verts <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hom <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_image digraph_isomorphism_inj_on_verts<span class="main">)</span>

  <span class="keyword1" id="Digraph_Isomorphism-card_arcs_iso"><span class="command">lemma</span></span> card_arcs_iso<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>iso_arcs <span class="free">hom</span> <span class="main">`</span> arcs <span class="free">G</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>arcs <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hom <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> card_image digraph_isomorphism_inj_on_arcs<span class="main">)</span>

  <span class="keyword1" id="Digraph_Isomorphism-strongly_connected_iso"><span class="command">lemma</span></span> strongly_connected_iso<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"strongly_connected <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="main">⟷</span> strongly_connected <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hom <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strongly_connected_def reachable_app_iso_eq<span class="main">)</span>

  <span class="keyword1" id="Digraph_Isomorphism-subgraph_strongly_connected_iso"><span class="command">lemma</span></span> subgraph_strongly_connected_iso<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">H</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"strongly_connected <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">H</span><span class="main">)</span> <span class="main">⟷</span> strongly_connected <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> wf_digraph <span class="quoted"><span class="free">H</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹subgraph <span class="free">H</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"H.digraph_isomorphism <span class="free">hom</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hom assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> digraph_isomorphism_subgraphI<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strongly_connected_def H.reachable_app_iso_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Digraph_Isomorphism-sccs_iso"><span class="command">lemma</span></span> sccs_iso<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pre_digraph.sccs <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> app_iso <span class="free">hom</span> <span class="main">`</span> sccs"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_eqI iffI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="skolem">x</span> <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.sccs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?L</span>›</span></span> hom <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.sccs_altdef2 max_subgraph_iso
        subgraph_strongly_connected_iso <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> max_subgraph_cong  <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x0</span> <span class="main">∈</span> sccs"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> app_iso <span class="free">hom</span> <span class="skolem">x0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hom <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.sccs_altdef2 max_subgraph_iso subgraph_app_isoI
        subgraphI_max_subgraph subgraph_strongly_connected_iso <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> max_subgraph_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Digraph_Isomorphism-card_sccs_iso"><span class="command">lemma</span></span> card_sccs_iso<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>app_iso <span class="free">hom</span> <span class="main">`</span> sccs<span class="main">)</span> <span class="main">=</span> card sccs"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> card_image<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> hom
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> inj_on_app_iso<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Funpow">
<div class="head">
<h1>Theory Funpow</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Funpow
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/FuncSet.html">HOL-Library.FuncSet</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Permutations.html">HOL-Library.Permutations</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary Lemmas about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(^^)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Funpow-funpow_simp_l"><span class="command">lemma</span></span> funpow_simp_l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> Suc <span class="free">n</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_apply funpow.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Funpow-funpow_add_app"><span class="command">lemma</span></span> funpow_add_app<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">m</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span><span class="free">n</span> <span class="main">+</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_apply funpow_add<span class="main">)</span>

<span class="keyword1" id="Funpow-funpow_mod_eq"><span class="command">lemma</span></span> funpow_mod_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span><span class="free">m</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">m</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">_</span> <span class="main">=</span> <span class="free">x</span>›</span></span><span class="main">)</span><span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">-</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">m</span> <span class="main">-</span> <span class="free">n</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span><span class="skolem">m</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span><span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">mod</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">m</span> <span class="main">-</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mod_geq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">-</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> less<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">m</span> <span class="main">-</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_add_app<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> linorder_neqE_nat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-id_funpow_id"><span class="command">lemma</span></span> id_funpow_id<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Funpow-inv_id_abs"><span class="command">lemma</span></span> inv_id_abs<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inv <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> id"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> id_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Funpow-inj_funpow"><span class="command">lemma</span></span> inj_funpow<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> id_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> funpow.simps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_compose<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-funpow_inj_finite"><span class="command">lemma</span></span> funpow_inj_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> True<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="main">{</span><span class="main">0</span><span class="main">::</span>nat<span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> True<span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">…</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">.</span> <span class="main">¬</span> finite <span class="main">{</span><span class="bound"><span class="bound">m</span></span> <span class="main">∈</span> <span class="main">{</span><span class="main">0</span><span class="main">..}</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="bound">m</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="free">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pigeonhole_infinite<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="bound">m</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="main">(</span><span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="bound">m</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">x</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="bound">m</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">x</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite.emptyI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≠</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> inv <span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹inj <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_f_f inj_funpow<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_add_app<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">…</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹inj <span class="free">p</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">_</span>›</span></span> inj_funpow<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="main">(</span><span class="skolem">n</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> general <span class="main">=</span> this

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> less
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> general m <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> equal
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> greater
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> general m <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-permutes_in_funpow_image"><span class="command">lemma</span></span> permutes_in_funpow_image<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">permutes</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_in_image<span class="main">)</span>

<span class="comment1">(* XXX move*)</span>
<span class="keyword1" id="Funpow-permutation_self"><span class="command">lemma</span></span> permutation_self<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"permutation <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> permutation_bijective bij_is_inj<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">^^</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">(</span><span class="free">p</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> <span class="free">p</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">(</span><span class="free">p</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹inj <span class="free">p</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">^^</span> Suc <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">^^</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> funpow_simp_l funpow_swap1<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≠</span> <span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc<span class="main">)</span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="free">p</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span> <span class="main">^^</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> funpow_simp_l funpow_swap1<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">|</span> <span class="bound">n</span><span class="main">.</span> True<span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="free">p</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="free">p</span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">|</span> <span class="bound">n</span><span class="main">.</span> True<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> permutation_finite_support<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹inj <span class="free">p</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> funpow_inj_finite<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* XXX move *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> -<span class="main">)</span> funpow_invs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">g</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">g</span> <span class="main">^^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>›</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> <span class="skolem">m</span> <span class="main">=</span> Suc <span class="main">(</span><span class="free">n</span> <span class="main">-</span> Suc <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>




<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Function-power distance between values›</span></span>

<span class="comment1">(* xxx move *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">funpow_dist</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">funpow_dist</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">funpow_dist1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">funpow_dist1</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> Suc <span class="main">(</span>funpow_dist <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Funpow-funpow_dist_0"><span class="command">lemma</span></span> funpow_dist_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"funpow_dist <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> funpow_dist_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Least_eq_0<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1" id="Funpow-funpow_dist_least"><span class="command">lemma</span></span> funpow_dist_least<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> funpow_dist <span class="free">f</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"funpow_dist <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> funpow_dist_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-funpow_dist1_least"><span class="command">lemma</span></span> funpow_dist1_least<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_swap1<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"funpow_dist <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> funpow_dist_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Least_le<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Cyclic Permutations›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">orbit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">f</span> <span class="entity">x</span> <span class="keyword2"><span class="keyword">where</span></span>
  base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">orbit</span> <span class="free">f</span> <span class="free">x</span>"</span></span> <span class="main">|</span>
  step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free">orbit</span> <span class="free">f</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free">orbit</span> <span class="free">f</span> <span class="free">x</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cyclic_on</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">cyclic_on</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> orbit <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Funpow-orbit_altdef"><span class="command">lemma</span></span> orbit_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"orbit <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">|</span> <span class="bound">n</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">n</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_eqI iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> orbit.induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem">n</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> orbit.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-orbit_trans"><span class="command">lemma</span></span> orbit_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> orbit.intros<span class="main">)</span>

<span class="keyword1" id="Funpow-orbit_subset"><span class="command">lemma</span></span> orbit_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> orbit.intros<span class="main">)</span>

<span class="keyword1" id="Funpow-orbit_sim_step"><span class="command">lemma</span></span> orbit_sim_step<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">s</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">t</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> orbit.intros<span class="main">)</span>

<span class="keyword1" id="Funpow-orbit_step"><span class="command">lemma</span></span> orbit_step<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">induction</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> orbit.intros<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Funpow-self_in_orbit_trans"><span class="command">lemma</span></span> self_in_orbit_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> orbit_sim_step<span class="main">)</span>

<span class="keyword1" id="Funpow-orbit_swap"><span class="command">lemma</span></span> orbit_swap<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">induction</span>
  <span class="keyword3"><span class="command">case</span></span> base <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">s</span> <span class="main">=</span> <span class="free">s</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> orbit_step<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">x</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">s</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> orbit_step<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-permutation_self_in_orbit"><span class="command">lemma</span></span> permutation_self_in_orbit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"permutation <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> orbit_altdef <span class="keyword1"><span class="command">using</span></span> permutation_self<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">metis</span>

<span class="keyword1" id="Funpow-orbit_altdef_self_in"><span class="command">lemma</span></span> orbit_altdef_self_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"orbit <span class="free">f</span> <span class="free">s</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="free">s</span> <span class="main">|</span> <span class="bound">n</span><span class="main">.</span> True<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_eqI iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="free">s</span> <span class="main">|</span> <span class="bound">n</span><span class="main">.</span> True<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> orbit_altdef<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> orbit_altdef<span class="main">)</span>

<span class="keyword1" id="Funpow-orbit_altdef_permutation"><span class="command">lemma</span></span> orbit_altdef_permutation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"permutation <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"orbit <span class="free">f</span> <span class="free">s</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="free">s</span> <span class="main">|</span> <span class="bound">n</span><span class="main">.</span> True<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> orbit_altdef_self_in permutation_self_in_orbit<span class="main">)</span>

<span class="keyword1" id="Funpow-orbit_altdef_bounded"><span class="command">lemma</span></span> orbit_altdef_bounded<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"orbit <span class="free">f</span> <span class="free">s</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="bound">m</span><span class="main">)</span> <span class="free">s</span><span class="main">|</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> orbit_altdef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orbit <span class="free">f</span> <span class="free">s</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="bound">m</span><span class="main">)</span> <span class="free">s</span><span class="main">|</span><span class="bound">m</span><span class="main">.</span> True<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> orbit_altdef_self_in<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="bound">m</span><span class="main">)</span> <span class="free">s</span><span class="main">|</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> funpow_mod_eq <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="keyword1">mod</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem">m</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-funpow_in_orbit"><span class="command">lemma</span></span> funpow_in_orbit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">s</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> orbit.intros<span class="main">)</span>

<span class="keyword1" id="Funpow-finite_orbit"><span class="command">lemma</span></span> finite_orbit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>orbit <span class="free">f</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span><span class="skolem">n</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> orbit_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> orbit_altdef_bounded<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-self_in_orbit_step"><span class="command">lemma</span></span> self_in_orbit_step<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"orbit <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> orbit <span class="free">f</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_eqI iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> orbit_step orbit_sim_step<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> orbit_subset<span class="main">)</span>

<span class="keyword1" id="Funpow-permutation_orbit_step"><span class="command">lemma</span></span> permutation_orbit_step<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"permutation <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"orbit <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> orbit <span class="free">f</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> self_in_orbit_step permutation_self_in_orbit<span class="main">)</span>

<span class="keyword1" id="Funpow-orbit_nonempty"><span class="command">lemma</span></span> orbit_nonempty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"orbit <span class="free">f</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> orbit.base <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Funpow-orbit_inv_eq"><span class="command">lemma</span></span> orbit_inv_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"permutation <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"orbit <span class="main">(</span>inv <span class="free">f</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"permutation <span class="skolem">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> orbit <span class="main">(</span>inv <span class="skolem">g</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> orbit <span class="skolem">g</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> inv_g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">y</span> <span class="main">⟹</span> inv <span class="skolem">g</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> inv <span class="skolem">g</span> <span class="main">(</span><span class="skolem">g</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="bound">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> bij_inv_eq_iff permutation_bijective<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> orbit <span class="skolem">g</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="skolem">g</span> <span class="skolem">y</span> <span class="main">∈</span> orbit <span class="skolem">g</span> <span class="free">x</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_g A<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> permutation_self_in_orbit<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> inv_g_in_orb <span class="main">=</span> this

      <span class="keyword1"><span class="command">from</span></span> A<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_g_in_orb A permutation_self_in_orbit<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> orb_inv_ss <span class="main">=</span> this

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="main">(</span>inv <span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms inv_inv_eq permutation_bijective<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> orb_inv_ss<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> orb_inv_ss<span class="main">[</span><span class="operator">OF</span> permutation_inverse<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-cyclic_on_alldef"><span class="command">lemma</span></span> cyclic_on_alldef<span class="main">:</span>
  <span class="quoted"><span class="quoted">"cyclic_on <span class="free">f</span> <span class="free">S</span> <span class="main">⟷</span> <span class="free">S</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="free">S</span> <span class="main">=</span> orbit <span class="free">f</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cyclic_on_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> orbit.step orbit_swap orbit_trans<span class="main">)</span>


<span class="keyword1" id="Funpow-cyclic_on_funpow_in"><span class="command">lemma</span></span> cyclic_on_funpow_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cyclic_on <span class="free">f</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">^^</span><span class="free">n</span><span class="main">)</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> cyclic_on_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> funpow_in_orbit<span class="main">)</span>

<span class="keyword1" id="Funpow-finite_cyclic_on"><span class="command">lemma</span></span> finite_cyclic_on<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cyclic_on <span class="free">f</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cyclic_on_def finite_orbit<span class="main">)</span>

<span class="keyword1" id="Funpow-cyclic_on_singleI"><span class="command">lemma</span></span> cyclic_on_singleI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> orbit <span class="free">f</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cyclic_on <span class="free">f</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> cyclic_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Funpow-inj_on_funpow_least"><span class="command">lemma</span></span> inj_on_funpow_least<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">m</span> <span class="main">&lt;</span> <span class="free">n</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="bound">m</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="bound">m</span><span class="main">)</span> <span class="free">s</span> <span class="main">≠</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span><span class="main">^^</span><span class="bound">k</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">l</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">k</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">l</span><span class="main">)</span> <span class="free">s</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">=</span> min <span class="skolem">k</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">=</span> max <span class="skolem">k</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">&lt;</span> <span class="skolem">l'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">k'</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">l'</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l'</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_def max_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span><span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="skolem">l'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">l'</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">l'</span> <span class="main">&lt;</span> <span class="free">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="skolem">l'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">l'</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_add<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">l'</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">k'</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A'<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="skolem">l'</span><span class="main">)</span><span class="main">)</span> <span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="skolem">l'</span> <span class="main">+</span> <span class="skolem">k'</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_add<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="skolem">l'</span> <span class="main">+</span> <span class="skolem">k'</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">-</span> <span class="skolem">l'</span> <span class="main">+</span> <span class="skolem">k'</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">-</span> <span class="skolem">l'</span> <span class="main">+</span> <span class="skolem">k'</span>"</span></span><span class="keyword1"><span class="command">using</span></span> A' <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> inj_onI<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-cyclic_on_inI"><span class="command">lemma</span></span> cyclic_on_inI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cyclic_on <span class="free">f</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">s</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cyclic_on_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> orbit.intros<span class="main">)</span>

<span class="keyword1" id="Funpow-bij_betw_funpow"><span class="command">lemma</span></span> bij_betw_funpow<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">S</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">S</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> id_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> funpow.simps <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*XXX rename move*)</span>
<span class="keyword1" id="Funpow-orbit_FOO"><span class="command">lemma</span></span> orbit_FOO<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> self<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> orbit <span class="free">g</span> <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> orbit <span class="free">g</span> <span class="free">a</span> <span class="main">⟹</span>  <span class="free">g'</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> orbit <span class="free">g</span> <span class="free">a</span> <span class="main">=</span> orbit <span class="free">g'</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_eqI iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x0</span> <span class="main">∈</span> orbit <span class="free">g</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> base <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> self orbit.base eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> step <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">cases</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> orbit.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> base <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> self orbit.base eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> step <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">cases</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq orbit.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-cyclic_on_FOO"><span class="command">lemma</span></span> cyclic_on_FOO<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cyclic_on <span class="free">f</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">h</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cyclic_on <span class="free">g</span> <span class="main">(</span><span class="free">h</span> <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cyclic_on_def<span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> orbit_FOO<span class="main">)</span>

<span class="keyword1" id="Funpow-cyclic_on_f_in"><span class="command">lemma</span></span> cyclic_on_f_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">permutes</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"cyclic_on <span class="free">f</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> fx_in_orb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cyclic_on_alldef<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> orbit <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cyclic_on_alldef<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> orbit_step orbit_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> orbit.simps permutes_inverses<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-permutes_not_in"><span class="command">lemma</span></span> permutes_not_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">permutes</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_def<span class="main">)</span>

<span class="keyword1" id="Funpow-orbit_cong0"><span class="command">lemma</span></span> orbit_cong0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">y</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"orbit <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> orbit <span class="free">g</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">g</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">∧</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nat.induct<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> orbit_altdef<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-orbit_cong"><span class="command">lemma</span></span> orbit_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> self_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">g</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"orbit <span class="free">g</span> <span class="free">t</span> <span class="main">=</span> orbit <span class="free">f</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> _ assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> orbit_cong0<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> orbit.step eq<span class="main">)</span>

<span class="keyword1" id="Funpow-cyclic_cong"><span class="command">lemma</span></span> cyclic_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cyclic_on <span class="free">f</span> <span class="free">S</span> <span class="main">=</span> cyclic_on <span class="free">g</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> orbit <span class="free">f</span> <span class="bound">s</span> <span class="main">=</span> orbit <span class="free">g</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟹</span> cyclic_on <span class="free">f</span> <span class="free">S</span> <span class="main">=</span> cyclic_on <span class="free">g</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cyclic_on_alldef cyclic_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms orbit_cong cyclic_on_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-permutes_comp_preserves_cyclic1"><span class="command">lemma</span></span> permutes_comp_preserves_cyclic1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"cyclic_on <span class="free">f</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cyclic_on <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="free">g</span><span class="main">)</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> permutes_not_in<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">g</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> cyclic_cong<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-permutes_comp_preserves_cyclic2"><span class="command">lemma</span></span> permutes_comp_preserves_cyclic2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"cyclic_on <span class="free">g</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cyclic_on <span class="main">(</span><span class="free">f</span> <span class="keyword1">o</span> <span class="free">g</span><span class="main">)</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> orbit <span class="free">g</span> <span class="skolem">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> orbit <span class="free">g</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cyclic_on <span class="free">g</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cyclic_on_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">g</span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms c <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> permutes_not_in<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> orbit.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> cyclic_cong<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(*XXX merge with previous section?*)</span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Orbits›</span></span>

<span class="keyword1" id="Funpow-permutes_orbit_subset"><span class="command">lemma</span></span> permutes_orbit_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">permutes</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"orbit <span class="free">f</span> <span class="free">x</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_in_image assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-cyclic_on_orbit'"><span class="command">lemma</span></span> cyclic_on_orbit'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"permutation <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cyclic_on <span class="free">f</span> <span class="main">(</span>orbit <span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cyclic_on_alldef <span class="keyword1"><span class="command">using</span></span> orbit_nonempty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> assms orbit_swap orbit_trans permutation_self_in_orbit<span class="main">)</span>

<span class="comment1">(* XXX remove? *)</span>
<span class="keyword1" id="Funpow-cyclic_on_orbit"><span class="command">lemma</span></span> cyclic_on_orbit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">permutes</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cyclic_on <span class="free">f</span> <span class="main">(</span>orbit <span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cyclic_on_orbit'<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutation_permutes<span class="main">)</span>

<span class="keyword1" id="Funpow-orbit_cyclic_eq3"><span class="command">lemma</span></span> orbit_cyclic_eq3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cyclic_on <span class="free">f</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"orbit <span class="free">f</span> <span class="free">y</span> <span class="main">=</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> cyclic_on_alldef <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(*XXX move*)</span>
<span class="keyword1" id="Funpow-orbit_eq_singleton_iff"><span class="command">lemma</span></span> orbit_eq_singleton_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"orbit <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">⟷</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> orbit_nonempty singletonI subsetI subset_singletonD<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">erule</span> orbit.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* XXX move *)</span>
<span class="keyword1" id="Funpow-eq_on_cyclic_on_iff1"><span class="command">lemma</span></span> eq_on_cyclic_on_iff1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"cyclic_on <span class="free">f</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟷</span> card <span class="free">S</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cyclic_on_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> orbit.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cyclic_on_alldef<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> orbit_eq_singleton_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟷</span> card <span class="free">S</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_Suc_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>







<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Decomposition of Arbitrary Permutations›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">perm_restrict</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">perm_restrict</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1" id="Funpow-perm_restrict_comp"><span class="command">lemma</span></span> perm_restrict_comp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"cyclic_on <span class="free">f</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"perm_restrict <span class="free">f</span> <span class="free">A</span> <span class="keyword1">o</span> perm_restrict <span class="free">f</span> <span class="free">B</span> <span class="main">=</span> perm_restrict <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cyclic_on <span class="free">f</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cyclic_on_inI<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> perm_restrict_def fun_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-perm_restrict_simps"><span class="command">lemma</span></span> perm_restrict_simps<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> perm_restrict <span class="free">f</span> <span class="free">S</span> <span class="free">x</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">S</span> <span class="main">⟹</span> perm_restrict <span class="free">f</span> <span class="free">S</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> perm_restrict_def<span class="main">)</span>

<span class="keyword1" id="Funpow-perm_restrict_perm_restrict"><span class="command">lemma</span></span> perm_restrict_perm_restrict<span class="main">:</span>
  <span class="quoted"><span class="quoted">"perm_restrict <span class="main">(</span>perm_restrict <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="free">B</span> <span class="main">=</span> perm_restrict <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> perm_restrict_def<span class="main">)</span>

<span class="keyword1" id="Funpow-perm_restrict_union"><span class="command">lemma</span></span> perm_restrict_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"perm_restrict <span class="free">f</span> <span class="free">A</span> <span class="keyword1">permutes</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"perm_restrict <span class="free">f</span> <span class="free">B</span> <span class="keyword1">permutes</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"perm_restrict <span class="free">f</span> <span class="free">A</span> <span class="keyword1">o</span> perm_restrict <span class="free">f</span> <span class="free">B</span> <span class="main">=</span> perm_restrict <span class="free">f</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff perm_restrict_def permutes_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> Diff_iff Diff_triv<span class="main">)</span>

<span class="keyword1" id="Funpow-perm_restrict_id"><span class="command">lemma</span></span> perm_restrict_id<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">permutes</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"perm_restrict <span class="free">f</span> <span class="free">S</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_def perm_restrict_def<span class="main">)</span>

<span class="keyword1" id="Funpow-cyclic_on_perm_restrict"><span class="command">lemma</span></span> cyclic_on_perm_restrict<span class="main">:</span>
  <span class="quoted"><span class="quoted">"cyclic_on <span class="main">(</span>perm_restrict <span class="free">f</span> <span class="free">S</span><span class="main">)</span> <span class="free">S</span> <span class="main">⟷</span> cyclic_on <span class="free">f</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perm_restrict_def <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> cyclic_cong<span class="main">)</span>

<span class="keyword1" id="Funpow-perm_restrict_diff_cyclic"><span class="command">lemma</span></span> perm_restrict_diff_cyclic<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">permutes</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"cyclic_on <span class="free">f</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"perm_restrict <span class="free">f</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">permutes</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> perm_restrict <span class="free">f</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">-</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="keyword1">permutes</span> <span class="free">S</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> permutes_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> cyclic_on_inI<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perm_restrict <span class="free">f</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perm_restrict_simps<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="free">S</span> <span class="main">-</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perm_restrict <span class="free">f</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perm_restrict_simps<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> X <span class="main">=</span> this

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"perm_restrict <span class="free">f</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> perm_restrict <span class="free">f</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="free">A</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> perm_restrict_def permutes_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> cyclic_on_f_in<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> Y <span class="main">=</span> this

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_def perm_restrict_simps X <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Y<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-orbit_eqI"><span class="command">lemma</span></span> orbit_eqI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="free">f</span> <span class="free">y</span> <span class="main">⟹</span><span class="free">y</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span> <span class="main">⟹</span><span class="free">z</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> orbit.base<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> orbit.step<span class="main">)</span>

<span class="keyword1" id="Funpow-permutes_decompose"><span class="command">lemma</span></span> permutes_decompose<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">permutes</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span> <span class="main">∈</span> <span class="bound">C</span><span class="main">.</span> cyclic_on <span class="free">f</span> <span class="bound">c</span><span class="main">)</span> <span class="main">∧</span> <span class="main">⋃</span><span class="bound">C</span> <span class="main">=</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c1</span> <span class="main">∈</span> <span class="bound">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound">c2</span> <span class="main">∈</span> <span class="bound">C</span><span class="main">.</span> <span class="bound">c1</span> <span class="main">≠</span> <span class="bound">c2</span> <span class="main">⟶</span> <span class="bound">c1</span> <span class="main">∩</span> <span class="bound">c2</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_psubset_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>psubset <span class="skolem">S</span><span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="keyword1">permutes</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"orbit <span class="skolem">f</span> <span class="skolem">s</span> <span class="main">⊆</span> <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> permutes_orbit_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> cyclic_orbit<span class="main">:</span> <span class="quoted"><span class="quoted">"cyclic_on <span class="skolem">f</span> <span class="main">(</span>orbit <span class="skolem">f</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="keyword1">permutes</span> <span class="skolem">S</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cyclic_on_orbit<span class="main">)</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"perm_restrict <span class="skolem">f</span> <span class="main">(</span><span class="skolem">S</span> <span class="main">-</span> orbit <span class="skolem">f</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">s</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="keyword1">permutes</span> <span class="skolem">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_in_image<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">-</span> orbit <span class="skolem">f</span> <span class="skolem">s</span> <span class="main">⊂</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> orbit.base<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f'</span> <span class="keyword1">permutes</span> <span class="main">(</span><span class="skolem">S</span> <span class="main">-</span> orbit <span class="skolem">f</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="keyword1">permutes</span> <span class="skolem">S</span>›</span></span> cyclic_orbit <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> perm_restrict_diff_cyclic<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="skolem">C</span> <span class="main">⟹</span> cyclic_on <span class="var">?f'</span> <span class="bound">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="skolem">C</span> <span class="main">=</span> <span class="skolem">S</span> <span class="main">-</span> orbit <span class="skolem">f</span> <span class="skolem">s</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c1</span> <span class="main">∈</span> <span class="skolem">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound">c2</span> <span class="main">∈</span> <span class="skolem">C</span><span class="main">.</span> <span class="bound">c1</span> <span class="main">≠</span> <span class="bound">c2</span> <span class="main">⟶</span> <span class="bound">c1</span> <span class="main">∩</span> <span class="bound">c2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> psubset.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="skolem">C</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">c</span> <span class="main">⟹</span> perm_restrict <span class="skolem">f</span> <span class="main">(</span><span class="skolem">S</span> <span class="main">-</span> orbit <span class="skolem">f</span> <span class="skolem">s</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> C<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="keyword1">permutes</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> perm_restrict_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cyclic_on <span class="skolem">f</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span> <span class="main">∈</span> <span class="skolem">C</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> cyclic_cong <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> in_C_cyclic <span class="main">=</span> this

    <span class="keyword1"><span class="command">have</span></span> Un_ins<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>insert <span class="main">(</span>orbit <span class="skolem">f</span> <span class="skolem">s</span><span class="main">)</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋃</span><span class="skolem">C</span> <span class="main">=</span> <span class="main">_</span>›</span></span>  <span class="quoted"><span class="quoted">‹orbit <span class="skolem">f</span> <span class="skolem">s</span> <span class="main">⊆</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> Disj_ins<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">c1</span> <span class="main">∈</span> insert <span class="main">(</span>orbit <span class="skolem">f</span> <span class="skolem">s</span><span class="main">)</span> <span class="skolem">C</span><span class="main">.</span> <span class="main">∀</span><span class="bound">c2</span> <span class="main">∈</span> insert <span class="main">(</span>orbit <span class="skolem">f</span> <span class="skolem">s</span><span class="main">)</span> <span class="skolem">C</span><span class="main">.</span> <span class="bound">c1</span> <span class="main">≠</span> <span class="bound">c2</span> <span class="main">⟶</span> <span class="bound">c1</span> <span class="main">∩</span> <span class="bound">c2</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conjI Un_ins Disj_ins exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"insert <span class="main"><span class="main"><span class="main">(</span></span></span>orbit <span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">s</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">C</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cyclic_orbit in_C_cyclic<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Funpow + Orbit›</span></span>

<span class="keyword1" id="Funpow-funpow_dist_prop"><span class="command">lemma</span></span> funpow_dist_prop<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> funpow_dist <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> funpow_dist_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> LeastI_ex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> orbit_altdef<span class="main">)</span>

<span class="keyword1" id="Funpow-funpow_dist_0_eq"><span class="command">lemma</span></span> funpow_dist_0_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"funpow_dist <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> funpow_dist_0 <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> funpow_dist_prop<span class="main">)</span>

<span class="keyword1" id="Funpow-funpow_dist_step"><span class="command">lemma</span></span> funpow_dist_step<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"funpow_dist <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> Suc <span class="main">(</span>funpow_dist <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> orbit_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Suc <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> funpow_dist_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Least_Suc2<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_swap1<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">0</span><span class="main">)</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> Suc <span class="bound">k</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_swap1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-funpow_dist1_prop"><span class="command">lemma</span></span> funpow_dist1_prop<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms funpow.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> funpow_dist_0 funpow_dist_prop funpow_simp_l funpow_swap1 id_apply orbit_step<span class="main">)</span>

<span class="comment1">(*XXX simplify? *)</span>
<span class="keyword1" id="Funpow-funpow_neq_less_funpow_dist"><span class="command">lemma</span></span> funpow_neq_less_funpow_dist<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> funpow_dist <span class="free">f</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≤</span> funpow_dist <span class="free">f</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≠</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">m</span><span class="main">)</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">m</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">x</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">=</span> min <span class="free">m</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">=</span> max <span class="free">m</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> A assms <span class="keyword1"><span class="command">have</span></span> A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">&lt;</span> <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m'</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">n'</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">≤</span> funpow_dist <span class="free">f</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_def max_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> funpow_dist <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> funpow_dist_prop<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span><span class="main">(</span>funpow_dist <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span> <span class="main">≤</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span><span class="main">(</span>funpow_dist <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">m'</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_add <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m'</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">_</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span><span class="main">(</span>funpow_dist <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">m'</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> funpow_dist_least<span class="main">)</span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* XXX reduce to funpow_neq_less_funpow_dist? *)</span>
<span class="keyword1" id="Funpow-funpow_neq_less_funpow_dist1"><span class="command">lemma</span></span> funpow_neq_less_funpow_dist1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&lt;</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≠</span> <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">m</span><span class="main">)</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">m</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">x</span>"</span></span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">=</span> min <span class="free">m</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">=</span> max <span class="free">m</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> A assms <span class="keyword1"><span class="command">have</span></span> A'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">&lt;</span> <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m'</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">n'</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&lt;</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_def max_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> funpow_dist1_prop<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span><span class="main">(</span>funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n'</span> <span class="main">&lt;</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span><span class="main">(</span>funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">m'</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_add <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">m'</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">_</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span><span class="main">(</span>funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">-</span> <span class="skolem">n'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">m'</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> funpow_dist1_least<span class="main">)</span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-inj_on_funpow_dist"><span class="command">lemma</span></span> inj_on_funpow_dist<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..</span>funpow_dist <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> funpow_neq_less_funpow_dist<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> inj_onI<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Funpow-inj_on_funpow_dist1"><span class="command">lemma</span></span> inj_on_funpow_dist1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> funpow_neq_less_funpow_dist1<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> inj_onI<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Funpow-orbit_conv_funpow_dist1"><span class="command">lemma</span></span> orbit_conv_funpow_dist1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"orbit <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">x</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> funpow_dist1_prop<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> orbit_altdef_bounded<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">x</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Funpow-funpow_dist1_prop1"><span class="command">lemma</span></span> funpow_dist1_prop1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> orbit_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> funpow_dist1_prop<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-funpow_dist1_dist"><span class="command">lemma</span></span> funpow_dist1_dist<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">&lt;</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">}</span> <span class="main">⊆</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">z</span> <span class="main">=</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">+</span> funpow_dist1 <span class="free">f</span> <span class="free">y</span> <span class="free">z</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> x_z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">z</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> funpow_dist1_prop<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> x_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> funpow_dist1_prop<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span>funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">z</span> <span class="main">-</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="free">y</span>
      <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span>funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">z</span> <span class="main">-</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x_y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms x_z <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> funpow.simps <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_add_app<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> y_z_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span>funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">z</span> <span class="main">-</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> funpow_dist1 <span class="free">f</span> <span class="free">y</span> <span class="free">z</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> funpow_dist1_prop1<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> funpow_dist1 <span class="free">f</span> <span class="free">y</span> <span class="free">z</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x_y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span>funpow_dist1 <span class="free">f</span> <span class="free">y</span> <span class="free">z</span> <span class="main">+</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> funpow.simps <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_add_app<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> y_z_diff <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> funpow_dist1 <span class="free">f</span> <span class="free">y</span> <span class="free">z</span><span class="main">)</span> <span class="free">y</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> funpow_dist1_prop1<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> funpow_dist1 <span class="free">f</span> <span class="free">y</span> <span class="free">z</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x_y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span>funpow_dist1 <span class="free">f</span> <span class="free">y</span> <span class="free">z</span> <span class="main">+</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> funpow.simps <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_add_app<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">z</span> <span class="main">≤</span> funpow_dist1 <span class="free">f</span> <span class="free">y</span> <span class="free">z</span> <span class="main">+</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> funpow_dist1_least not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">≤</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"funpow_dist1 <span class="free">f</span> <span class="free">y</span> <span class="free">z</span> <span class="main">≤</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">z</span> <span class="main">-</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> y_z_diff assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> not_less zero_less_diff funpow_dist1_least<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">≤</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-funpow_dist1_le_self"><span class="command">lemma</span></span> funpow_dist1_le_self<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">m</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> funpow_dist1_least<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span>funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="keyword1">mod</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_mod_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> False <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">≤</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="keyword1">mod</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> funpow_dist_least funpow_dist_prop funpow_dist_step funpow_simp_l not_less<span class="main">)</span> 
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Permutation Domains›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">has_dom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">has_dom</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">s</span>"</span></span>

<span class="keyword1" id="Funpow-permutes_conv_has_dom"><span class="command">lemma</span></span> permutes_conv_has_dom<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">permutes</span> <span class="free">S</span> <span class="main">⟷</span> bij <span class="free">f</span> <span class="main">∧</span> has_dom <span class="free">f</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> permutes_def has_dom_def bij_iff<span class="main">)</span>



<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Segments›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">segment</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">f</span> <span class="entity">a</span> <span class="entity">b</span> <span class="keyword2"><span class="keyword">where</span></span>
  base<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">segment</span> <span class="free">f</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="main">|</span>
  step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free">segment</span> <span class="free">f</span> <span class="free">a</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free">segment</span> <span class="free">f</span> <span class="free">a</span> <span class="free">b</span>"</span></span>

<span class="keyword1" id="Funpow-segment_step_2D"><span class="command">lemma</span></span> segment_step_2D<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">a</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> segment.intros<span class="main">)</span>

<span class="keyword1" id="Funpow-not_in_segment2D"><span class="command">lemma</span></span> not_in_segment2D<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="operator">auto</span>

<span class="keyword1" id="Funpow-segment_altdef"><span class="command">lemma</span></span> segment_altdef<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"segment <span class="free">f</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="bound">n</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">1</span><span class="main">..&lt;</span>funpow_dist1 <span class="free">f</span> <span class="free">a</span> <span class="free">b</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_eqI iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span> <span class="main">≠</span><span class="free">b</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> orbit_step<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> funpow_dist <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">using</span></span> gr0I funpow_dist_0_eq<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">_</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">a</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> orbit.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?L</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
    <span class="keyword3"><span class="command">case</span></span> base <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> image_eqI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> step <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms funpow_dist1_prop less_antisym
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> image_eqI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Suc <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">for</span></span></span></span> <span class="skolem">n</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">n</span> <span class="main">)</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> funpow_dist1 <span class="free">f</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> funpow_dist1_least<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> segment.intros<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*XXX move up*)</span>
<span class="keyword1" id="Funpow-segmentD_orbit"><span class="command">lemma</span></span> segmentD_orbit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">y</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> orbit.intros<span class="main">)</span>

<span class="keyword1" id="Funpow-segment1_empty"><span class="command">lemma</span></span> segment1_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"segment <span class="free">f</span> <span class="free">x</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> segment_altdef orbit.base funpow_dist_0<span class="main">)</span>

<span class="keyword1" id="Funpow-segment_subset"><span class="command">lemma</span></span> segment_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">x</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">x</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> segment1_empty <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> segment.intros <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> segment_step_2D <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> segment.cases<span class="main">)</span>

<span class="comment1">(* XXX move up*)</span>
<span class="keyword1" id="Funpow-not_in_segment1"><span class="command">lemma</span></span> not_in_segment1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> segment <span class="free">f</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> segment_altdef Suc_le_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> neq_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span>funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_dist1_least<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span>funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="main">(</span>funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_add_app<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">&lt;</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_add_app<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> funpow_dist1_prop<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> neq_y <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-not_in_segment2"><span class="command">lemma</span></span> not_in_segment2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∉</span> segment <span class="free">f</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> not_in_segment2D <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="comment1">(*XXX move*)</span>
<span class="keyword1" id="Funpow-in_segmentE"><span class="command">lemma</span></span> in_segmentE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">x</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">&lt;</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> segmentD_orbit funpow_dist1_prop<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="skolem">n</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">&lt;</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> segment_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> funpow_dist1_least not_less<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">&lt;</span> funpow_dist1 <span class="free">f</span> <span class="free">x</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*XXX move*)</span>
<span class="keyword1" id="Funpow-cyclic_split_segment"><span class="command">lemma</span></span> cyclic_split_segment<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"cyclic_on <span class="free">f</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">}</span> <span class="main">∪</span> segment <span class="free">f</span> <span class="free">a</span> <span class="free">b</span> <span class="main">∪</span> segment <span class="free">f</span> <span class="free">b</span> <span class="free">a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_eqI iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> S <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cyclic_on_alldef <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> segment.intros<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"segment <span class="free">f</span> <span class="free">a</span> <span class="free">b</span> <span class="main">⊆</span> orbit <span class="free">f</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"segment <span class="free">f</span> <span class="free">b</span> <span class="free">a</span> <span class="main">⊆</span> orbit <span class="free">f</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> segmentD_orbit<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cyclic_on_alldef<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*XXX move*)</span>
<span class="keyword1" id="Funpow-segment_split"><span class="command">lemma</span></span> segment_split<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> y_in_seg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">x</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"segment <span class="free">f</span> <span class="free">x</span> <span class="free">z</span> <span class="main">=</span> segment <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">∪</span> <span class="main">{</span><span class="free">y</span><span class="main">}</span> <span class="main">∪</span> segment <span class="free">f</span> <span class="free">y</span> <span class="free">z</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_eqI iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> segment.intros<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">x</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">x</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> segment_subset<span class="main">[</span><span class="operator">OF</span> y_in_seg<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">y</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">x</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> y_in_seg <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> segment.intros<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y_in_seg <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> segment.intros<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-in_segmentD_inv"><span class="command">lemma</span></span> in_segmentD_inv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">f</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inv <span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> segment.cases<span class="main">)</span>

<span class="keyword1" id="Funpow-in_orbit_invI"><span class="command">lemma</span></span> in_orbit_invI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> orbit <span class="main">(</span>inv <span class="free">f</span><span class="main">)</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">induct</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> orbit_eqI<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inv_f_f orbit.base orbit_trans<span class="main">)</span>

<span class="keyword1" id="Funpow-segment_step_2"><span class="command">lemma</span></span> segment_step_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> segment.intros <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> not_in_segment2D injD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹inj <span class="free">f</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Funpow-inv_end_in_segment"><span class="command">lemma</span></span> inv_end_in_segment<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inv <span class="free">f</span> <span class="free">b</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
  <span class="keyword3"><span class="command">case</span></span> base <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹bij <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_is_inj<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> segment.simps<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> step <span class="quoted"><span class="quoted">‹inj <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_orbit_invI inv_f_eq not_in_segment1 segment.base<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij <span class="free">f</span>›</span></span> <span class="quoted"><span class="quoted">‹inj <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> segment.step <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> surj_f_inv_f bij_is_surj<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inv <span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">a</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹inj <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> segment_step_2 injD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">a</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-segment_overlapping"><span class="command">lemma</span></span> segment_overlapping<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"segment <span class="free">f</span> <span class="free">a</span> <span class="free">x</span> <span class="main">⊆</span> segment <span class="free">f</span> <span class="free">b</span> <span class="free">x</span> <span class="main">∨</span> segment <span class="free">f</span> <span class="free">b</span> <span class="free">x</span> <span class="main">⊆</span> segment <span class="free">f</span> <span class="free">a</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">induction</span>
  <span class="keyword3"><span class="command">case</span></span> base <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> segment1_empty<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹bij <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_is_inj<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> segment <span class="bound">f</span> <span class="bound">x</span> <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> segment1_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> segment <span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> * inv_end_in_segment<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ <span class="quoted"><span class="quoted">‹bij <span class="free">f</span>›</span></span><span class="main"><span class="main">]</span></span> inv_f_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹inj <span class="free">f</span>›</span></span><span class="main"><span class="main">]</span></span> segmentD_orbit<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">a</span>›</span></span> step.IH
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"segment <span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⊆</span> segment <span class="free">f</span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∨</span> segment <span class="free">f</span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⊆</span> segment <span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> * inv_end_in_segment<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ <span class="quoted"><span class="quoted">‹bij <span class="free">f</span>›</span></span><span class="main"><span class="main">]</span></span> inv_f_eq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹inj <span class="free">f</span>›</span></span><span class="main"><span class="main">]</span></span> segment_step_2D segment_subset step.prems subsetCE<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹inj <span class="free">f</span>›</span></span> * inv_end_in_segment<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ <span class="quoted"><span class="quoted">‹bij <span class="free">f</span>›</span></span><span class="main"><span class="main">]</span></span> inv_f_eq orbit_eqI<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> segment_step_2D segment_subset subsetCE<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"segment <span class="free">f</span> <span class="free">a</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⊆</span> segment <span class="free">f</span> <span class="free">b</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> C <span class="main">=</span> this
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-segment_disj"><span class="command">lemma</span></span> segment_disj<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"bij <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"segment <span class="free">f</span> <span class="free">a</span> <span class="free">b</span> <span class="main">∩</span> segment <span class="free">f</span> <span class="free">b</span> <span class="free">a</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">a</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">b</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"segment <span class="free">f</span> <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> segment <span class="free">f</span> <span class="free">a</span> <span class="skolem">x</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> segment <span class="free">f</span> <span class="skolem">x</span> <span class="free">b</span>"</span></span>
      <span class="quoted"><span class="quoted">"segment <span class="free">f</span> <span class="free">b</span> <span class="free">a</span> <span class="main">=</span> segment <span class="free">f</span> <span class="free">b</span> <span class="skolem">x</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">∪</span> segment <span class="free">f</span> <span class="skolem">x</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> segment_split<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> segmentD_orbit<span class="main">)</span>

  <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> segment_overlapping<span class="main">[</span><span class="operator">OF</span> o <span class="quoted"><span class="quoted">‹bij <span class="free">f</span>›</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹bij <span class="free">f</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_is_inj<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"segment <span class="free">f</span> <span class="free">a</span> <span class="skolem">x</span> <span class="main">=</span> segment <span class="free">f</span> <span class="free">b</span> <span class="skolem">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_eqI iffI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">b</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">a</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="free">f</span> <span class="free">a</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">b</span> <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * x<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> segment.base segment_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">a</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹inj <span class="free">f</span>›</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> not_in_segment2 segment_step_2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">a</span> <span class="skolem">x</span> "</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">b</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="free">f</span> <span class="free">b</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * x<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> segment.base segment_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> segment <span class="free">f</span> <span class="free">b</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹inj <span class="free">f</span>›</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> not_in_segment2 segment_step_2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"segment <span class="free">f</span> <span class="free">a</span> <span class="skolem">x</span> <span class="main">≠</span> segment <span class="free">f</span> <span class="free">b</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms bij_is_inj not_in_segment2 segment.base segment_step_2 segment_subset x<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Funpow-segment_x_x_eq"><span class="command">lemma</span></span> segment_x_x_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"permutation <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"segment <span class="free">f</span> <span class="free">x</span> <span class="free">x</span> <span class="main">=</span> orbit <span class="free">f</span> <span class="free">x</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> set_eqI iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> segmentD_orbit <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_in_segment2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="var">?R</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> orbit <span class="free">f</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="var">?L</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> segment.intros<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Lists of Powers›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">iterate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">iterate</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">^^</span><span class="bound">n</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">..&lt;</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1" id="Funpow-set_iterate"><span class="command">lemma</span></span> set_iterate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>iterate <span class="free">m</span> <span class="free">n</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="bound">k</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="free">m</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span> "</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iterate_def<span class="main">)</span>

<span class="keyword1" id="Funpow-iterate_empty"><span class="command">lemma</span></span> iterate_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"iterate <span class="free">n</span> <span class="free">m</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iterate_def<span class="main">)</span>

<span class="keyword1" id="Funpow-iterate_length"><span class="command">lemma</span></span> iterate_length<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"length <span class="main">(</span>iterate <span class="free">m</span> <span class="free">n</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">-</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iterate_def<span class="main">)</span>

<span class="keyword1" id="Funpow-iterate_nth"><span class="command">lemma</span></span> iterate_nth<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">-</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"iterate <span class="free">m</span> <span class="free">n</span> <span class="free">f</span> <span class="free">x</span> <span class="main">!</span> <span class="free">k</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span><span class="main">^^</span><span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iterate_def<span class="main">)</span>

<span class="keyword1" id="Funpow-iterate_applied"><span class="command">lemma</span></span> iterate_applied<span class="main">:</span>
  <span class="quoted"><span class="quoted">"iterate <span class="free">n</span> <span class="free">m</span> <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> iterate <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">(</span>Suc <span class="free">m</span><span class="main">)</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> iterate_def funpow_swap1<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Subdivision">
<div class="head">
<h1>Theory Subdivision</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Subdivision
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Arc_Walk.html">Arc_Walk</a>
  <a href="Digraph_Component.html">Digraph_Component</a>
  <a href="Pair_Digraph.html">Pair_Digraph</a>
  <a href="Bidirected_Digraph.html">Bidirected_Digraph</a>
  <a href="Funpow.html">Funpow</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Subdivision on Digraphs›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">subdivision_step</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'b</span> <span class="main">×</span> <span class="tfree">'b</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">subdivision_step</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">rev_G</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">rev_H</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">w</span><span class="main">)</span> <span class="main">(</span><span class="bound">uv</span><span class="main">,</span> <span class="bound">uw</span><span class="main">,</span> <span class="bound">vw</span><span class="main">)</span><span class="main">.</span>
      bidirected_digraph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">rev_G</span></span></span>
    <span class="main">∧</span> bidirected_digraph <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">rev_H</span></span></span>
    <span class="main">∧</span> perm_restrict <span class="free"><span class="bound"><span class="entity">rev_H</span></span></span> <span class="main">(</span>arcs <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> perm_restrict <span class="free"><span class="bound"><span class="entity">rev_G</span></span></span> <span class="main">(</span>arcs <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span>
    <span class="main">∧</span> compatible <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span>

    <span class="main">∧</span> verts <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> verts <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="bound">w</span><span class="main">}</span>
    <span class="main">∧</span> <span class="bound">w</span> <span class="main">∉</span> verts <span class="free"><span class="bound"><span class="entity">G</span></span></span>

    <span class="main">∧</span> arcs <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">uw</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">rev_H</span></span></span> <span class="bound">uw</span><span class="main">,</span> <span class="bound">vw</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">rev_H</span></span></span> <span class="bound">vw</span><span class="main">}</span> <span class="main">∪</span> arcs <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="bound">uv</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">rev_G</span></span></span> <span class="bound">uv</span><span class="main">}</span>
    <span class="main">∧</span> <span class="bound">uv</span> <span class="main">∈</span> arcs <span class="free"><span class="bound"><span class="entity">G</span></span></span>
    <span class="main">∧</span> distinct <span class="main">[</span><span class="bound">uw</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">rev_H</span></span></span> <span class="bound">uw</span><span class="main">,</span> <span class="bound">vw</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">rev_H</span></span></span> <span class="bound">vw</span><span class="main">]</span>
    <span class="main">∧</span> arc_to_ends <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">uv</span> <span class="main">=</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span>
    <span class="main">∧</span> arc_to_ends <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="bound">uw</span> <span class="main">=</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">w</span><span class="main">)</span>
    <span class="main">∧</span> arc_to_ends <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="bound">vw</span> <span class="main">=</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="bound">w</span><span class="main">)</span>
  "</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">subdivision</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">×</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">×</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">biG</span> <span class="keyword2"><span class="keyword">where</span></span>
    base<span class="main">:</span> <span class="quoted"><span class="quoted">"bidirected_digraph <span class="main">(</span>fst <span class="free">biG</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">biG</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">subdivision</span> <span class="free">biG</span> <span class="free">biG</span>"</span></span>
  <span class="main">|</span> divide<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">subdivision</span> <span class="free">biG</span> <span class="free"><span class="bound"><span class="entity">biI</span></span></span><span class="main">;</span> subdivision_step <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">biI</span></span></span><span class="main">)</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">biI</span></span></span><span class="main">)</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">biH</span></span></span><span class="main">)</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">biH</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">uv</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">uw</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">vw</span></span></span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">subdivision</span> <span class="free">biG</span> <span class="free"><span class="bound"><span class="entity">biH</span></span></span>"</span></span>

<span class="keyword1" id="Subdivision-subdivision_induct"><span class="command">lemma</span></span> subdivision_induct<span class="main">[</span><span class="operator">case_names</span> base divide<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">pred</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">:</span></span></span></span> subdivision<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subdivision <span class="main">(</span><span class="free">G</span><span class="main">,</span> <span class="free">rev_G</span><span class="main">)</span> <span class="main">(</span><span class="free">H</span><span class="main">,</span> <span class="free">rev_H</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bidirected_digraph <span class="free">G</span> <span class="free">rev_G</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">G</span> <span class="free">rev_G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">rev_I</span> <span class="bound">H</span> <span class="bound">rev_H</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">w</span> <span class="bound">uv</span> <span class="bound">uw</span> <span class="bound">vw</span><span class="main">.</span>
            subdivision <span class="main">(</span><span class="free">G</span><span class="main">,</span> <span class="free">rev_G</span><span class="main">)</span> <span class="main">(</span><span class="bound">I</span><span class="main">,</span> <span class="bound">rev_I</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">I</span> <span class="bound">rev_I</span> <span class="main">⟹</span> subdivision_step <span class="bound">I</span> <span class="bound">rev_I</span> <span class="bound">H</span> <span class="bound">rev_H</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">,</span> <span class="bound">w</span><span class="main">)</span> <span class="main">(</span><span class="bound">uv</span><span class="main">,</span> <span class="bound">uw</span><span class="main">,</span> <span class="bound">vw</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">H</span> <span class="bound">rev_H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">H</span> <span class="free">rev_H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="skolem">biH</span><span class="main"><span class="main">≡</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">H</span><span class="main">,</span> <span class="free">rev_H</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">rev_H</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Subdivision-subdivision_base"><span class="command">lemma</span></span> subdivision_base<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bidirected_digraph <span class="free">G</span> <span class="free">rev_G</span> <span class="main">⟹</span> subdivision <span class="main">(</span><span class="free">G</span><span class="main">,</span> <span class="free">rev_G</span><span class="main">)</span> <span class="main">(</span><span class="free">G</span><span class="main">,</span> <span class="free">rev_G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subdivision.base<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1" id="Subdivision-subdivision_step_rev"><span class="command">lemma</span></span> subdivision_step_rev<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subdivision_step <span class="free">G</span> <span class="free">rev_G</span> <span class="free">H</span> <span class="free">rev_H</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">uv</span><span class="main">,</span> <span class="free">uw</span><span class="main">,</span> <span class="free">vw</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"subdivision <span class="main">(</span><span class="free">H</span><span class="main">,</span> <span class="free">rev_H</span><span class="main">)</span> <span class="main">(</span><span class="free">I</span><span class="main">,</span> <span class="free">rev_I</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subdivision <span class="main">(</span><span class="free">G</span><span class="main">,</span> <span class="free">rev_G</span><span class="main">)</span> <span class="main">(</span><span class="free">I</span><span class="main">,</span> <span class="free">rev_I</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bidirected_digraph <span class="main">(</span>fst <span class="main">(</span><span class="free">G</span><span class="main">,</span> <span class="free">rev_G</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">G</span><span class="main">,</span> <span class="free">rev_G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subdivision_step_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">,</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subdivision.intros <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> subdivision_base<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Subdivision-subdivision_trans"><span class="command">lemma</span></span> subdivision_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subdivision <span class="main">(</span><span class="free">G</span><span class="main">,</span> <span class="free">rev_G</span><span class="main">)</span> <span class="main">(</span><span class="free">H</span><span class="main">,</span> <span class="free">rev_H</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"subdivision <span class="main">(</span><span class="free">H</span><span class="main">,</span> <span class="free">rev_H</span><span class="main">)</span> <span class="main">(</span><span class="free">I</span><span class="main">,</span> <span class="free">rev_I</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subdivision <span class="main">(</span><span class="free">G</span><span class="main">,</span> <span class="free">rev_G</span><span class="main">)</span> <span class="main">(</span><span class="free">I</span><span class="main">,</span> <span class="free">rev_I</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induction</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subdivision_step_rev<span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> subdiv_step <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">G</span> <span class="free">rev_G</span> <span class="free">H</span> <span class="free">rev_H</span> <span class="free">u</span> <span class="free">v</span> <span class="free">w</span> <span class="free">uv</span> <span class="free">uw</span> <span class="free">vw</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subdiv_step<span class="main">:</span> <span class="quoted"><span class="quoted">"subdivision_step <span class="free">G</span> <span class="free">rev_G</span> <span class="free">H</span> <span class="free">rev_H</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">(</span><span class="free">uv</span><span class="main">,</span> <span class="free">uw</span><span class="main">,</span> <span class="free">vw</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> subdiv_step <span class="main">⊆</span> G<span class="main">:</span> bidirected_digraph <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">rev_G</span></span>
  <span class="keyword1"><span class="command">using</span></span> subdiv_step <span class="keyword1"><span class="command">unfolding</span></span> subdivision_step_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">sublocale</span></span> subdiv_step <span class="main">⊆</span> H<span class="main">:</span> bidirected_digraph <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">rev_H</span></span>
  <span class="keyword1"><span class="command">using</span></span> subdiv_step <span class="keyword1"><span class="command">unfolding</span></span> subdivision_step_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">context</span></span> subdiv_step <span class="keyword2"><span class="keyword">begin</span></span>

  <span class="comment1">(*XXX*)</span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">vu</span> <span class="main">≡</span> <span class="free">rev_G</span> <span class="free">uv</span>"</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">wu</span> <span class="main">≡</span> <span class="free">rev_H</span> <span class="free">uw</span>"</span></span>
  <span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">wv</span> <span class="main">≡</span> <span class="free">rev_H</span> <span class="free">vw</span>"</span></span>

  <span class="keyword1" id="Subdivision-subdiv_compat"><span class="command">lemma</span></span> subdiv_compat<span class="main">:</span> <span class="quoted"><span class="quoted">"compatible <span class="free">G</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subdiv_step <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subdivision_step_def<span class="main">)</span>

  <span class="keyword1" id="Subdivision-arc_to_ends_eq"><span class="command">lemma</span></span> arc_to_ends_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"arc_to_ends <span class="free">H</span> <span class="main">=</span> arc_to_ends <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subdiv_compat <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compatible_def arc_to_ends_def fun_eq_iff<span class="main">)</span>

  <span class="keyword1" id="Subdivision-head_eq"><span class="command">lemma</span></span> head_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"head <span class="free">H</span> <span class="main">=</span> head <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subdiv_compat <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compatible_def fun_eq_iff<span class="main">)</span>

  <span class="keyword1" id="Subdivision-tail_eq"><span class="command">lemma</span></span> tail_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"tail <span class="free">H</span> <span class="main">=</span> tail <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subdiv_compat <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compatible_def fun_eq_iff<span class="main">)</span>

  <span class="keyword1" id="Subdivision-verts_H"><span class="command">lemma</span></span> verts_H<span class="main">:</span> <span class="quoted"><span class="quoted">"verts <span class="free">H</span> <span class="main">=</span> verts <span class="free">G</span> <span class="main">∪</span> <span class="main">{</span><span class="free">w</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subdiv_step <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subdivision_step_def<span class="main">)</span>

  <span class="keyword1" id="Subdivision-verts_G"><span class="command">lemma</span></span> verts_G<span class="main">:</span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">=</span> verts <span class="free">H</span> <span class="main">-</span> <span class="main">{</span><span class="free">w</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subdiv_step <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subdivision_step_def<span class="main">)</span>

  <span class="keyword1" id="Subdivision-arcs_H"><span class="command">lemma</span></span> arcs_H<span class="main">:</span> <span class="quoted"><span class="quoted">"arcs <span class="free">H</span> <span class="main">=</span> <span class="main">{</span><span class="free">uw</span><span class="main">,</span> wu<span class="main">,</span> <span class="free">vw</span><span class="main">,</span> wv<span class="main">}</span> <span class="main">∪</span> arcs <span class="free">G</span> <span class="main">-</span> <span class="main">{</span><span class="free">uv</span><span class="main">,</span> vu<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subdiv_step <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subdivision_step_def<span class="main">)</span>

  <span class="keyword1" id="Subdivision-not_in_verts_G"><span class="command">lemma</span></span> not_in_verts_G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∉</span> verts <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subdiv_step <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subdivision_step_def<span class="main">)</span>

  <span class="keyword1" id="Subdivision-in_arcs_G"><span class="command">lemma</span></span> in_arcs_G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">uv</span><span class="main">,</span> vu<span class="main">}</span> <span class="main">⊆</span> arcs <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subdiv_step <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subdivision_step_def<span class="main">)</span>

  <span class="keyword1" id="Subdivision-not_in_arcs_H"><span class="command">lemma</span></span> not_in_arcs_H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">uv</span><span class="main">,</span>vu<span class="main">}</span> <span class="main">∩</span> arcs <span class="free">H</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> arcs_H <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Subdivision-subdiv_ate"><span class="command">lemma</span></span> subdiv_ate<span class="main">:</span>
      <span class="quoted"><span class="quoted">"arc_to_ends <span class="free">G</span> <span class="free">uv</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"arc_to_ends <span class="free">H</span> <span class="free">uv</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"arc_to_ends <span class="free">H</span> <span class="free">uw</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">w</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"arc_to_ends <span class="free">H</span> <span class="free">vw</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subdiv_step subdiv_compat <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subdivision_step_def arc_to_ends_def compatible_def<span class="main">)</span>

  <span class="keyword1" id="Subdivision-subdiv_ends"><span class="command">lemma</span></span> subdiv_ends<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="free">uv</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="free">uv</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">H</span> <span class="free">uv</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"head <span class="free">H</span> <span class="free">uv</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
    <span class="quoted"><span class="quoted">"tail <span class="free">H</span> <span class="free">uw</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"head <span class="free">H</span> <span class="free">uw</span> <span class="main">=</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">H</span> <span class="free">vw</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"head <span class="free">H</span> <span class="free">vw</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subdiv_ate <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_to_ends_def<span class="main">)</span>

  <span class="keyword1" id="Subdivision-subdiv_ends_G_rev"><span class="command">lemma</span></span> subdiv_ends_G_rev<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="main">(</span>vu<span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="main">(</span>vu<span class="main">)</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">H</span> <span class="main">(</span>vu<span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"head <span class="free">H</span> <span class="main">(</span>vu<span class="main">)</span> <span class="main">=</span> <span class="free">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_arcs_G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tail_eq head_eq<span class="main">)</span>

  <span class="keyword1" id="Subdivision-subdiv_distinct_verts0"><span class="command">lemma</span></span> subdiv_distinct_verts0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> in_arcs_G not_in_verts_G <span class="keyword1"><span class="command">using</span></span> subdiv_ate <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_to_ends_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> G.wellformed<span class="main">)</span>

  <span class="keyword1" id="Subdivision-in_arcs_H"><span class="command">lemma</span></span> in_arcs_H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">uw</span><span class="main">,</span> wu<span class="main">,</span> <span class="free">vw</span><span class="main">,</span> wv<span class="main">}</span> <span class="main">⊆</span> arcs <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">uv</span> <span class="main">=</span> <span class="free">uw</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arc_to_ends <span class="free">H</span> <span class="free">uv</span> <span class="main">=</span> arc_to_ends <span class="free">H</span> <span class="free">uw</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arc_to_ends_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">uv</span> <span class="main">=</span> <span class="free">vw</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arc_to_ends <span class="free">H</span> <span class="free">uv</span> <span class="main">=</span> arc_to_ends <span class="free">H</span> <span class="free">vw</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arc_to_ends_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"vu <span class="main">=</span> <span class="free">uw</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arc_to_ends <span class="free">H</span> <span class="main">(</span>vu<span class="main">)</span> <span class="main">=</span> arc_to_ends <span class="free">H</span> <span class="free">uw</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arc_to_ends_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"vu <span class="main">=</span> <span class="free">vw</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arc_to_ends <span class="free">H</span> <span class="main">(</span>vu<span class="main">)</span> <span class="main">=</span> arc_to_ends <span class="free">H</span> <span class="free">vw</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arc_to_ends_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">uw</span><span class="main">,</span><span class="free">vw</span><span class="main">}</span> <span class="main">⊆</span> arcs <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> arcs_H <span class="keyword1"><span class="command">using</span></span> subdiv_distinct_verts0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Subdivision-subdiv_ends_H_rev"><span class="command">lemma</span></span> subdiv_ends_H_rev<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"tail <span class="free">H</span> <span class="main">(</span>wu<span class="main">)</span> <span class="main">=</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">H</span> <span class="main">(</span>wv<span class="main">)</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
    <span class="quoted"><span class="quoted">"head <span class="free">H</span> <span class="main">(</span>wu<span class="main">)</span> <span class="main">=</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"head <span class="free">H</span> <span class="main">(</span>wv<span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_arcs_H subdiv_ate <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1" id="Subdivision-in_verts_G"><span class="command">lemma</span></span> in_verts_G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_arcs_G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> G.wellformed<span class="main">)</span>

  <span class="keyword1" id="Subdivision-not_in_arcs_G"><span class="command">lemma</span></span> not_in_arcs_G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">uw</span><span class="main">,</span> wu<span class="main">,</span> <span class="free">vw</span><span class="main">,</span> wv<span class="main">}</span> <span class="main">∩</span> arcs <span class="free">G</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">note</span></span> X <span class="main">=</span> G.wellformed<span class="main">[</span><span class="operator">simplified</span> tail_eq<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">symmetric</span></span><span class="main"><span class="main"><span class="main">]</span></span></span> head_eq<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">symmetric</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> not_in_verts_G in_arcs_H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> X <span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Subdivision-subdiv_distinct_arcs"><span class="command">lemma</span></span> subdiv_distinct_arcs<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="free">uv</span><span class="main">,</span> vu<span class="main">,</span> <span class="free">uw</span><span class="main">,</span> wu<span class="main">,</span> <span class="free">vw</span><span class="main">,</span> wv<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="free">uw</span><span class="main">,</span> wu<span class="main">,</span> <span class="free">vw</span><span class="main">,</span> wv<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> subdiv_step <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subdivision_step_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="free">uv</span><span class="main">,</span> vu<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> in_arcs_G G.arev_dom <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">uv</span><span class="main">,</span> vu<span class="main">}</span> <span class="main">∩</span> <span class="main">{</span><span class="free">uw</span><span class="main">,</span> wu<span class="main">,</span> <span class="free">vw</span><span class="main">,</span> wv<span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> arcs_H in_arcs_H <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="Subdivision-arcs_G"><span class="command">lemma</span></span> arcs_G<span class="main">:</span> <span class="quoted"><span class="quoted">"arcs <span class="free">G</span> <span class="main">=</span> arcs <span class="free">H</span> <span class="main">∪</span> <span class="main">{</span><span class="free">uv</span><span class="main">,</span> vu<span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">uw</span><span class="main">,</span> wu<span class="main">,</span> <span class="free">vw</span><span class="main">,</span> wv<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_arcs_G not_in_arcs_G <span class="keyword1"><span class="command">unfolding</span></span> arcs_H <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Subdivision-subdiv_ate_H_rev"><span class="command">lemma</span></span> subdiv_ate_H_rev<span class="main">:</span>
    <span class="quoted"><span class="quoted">"arc_to_ends <span class="free">H</span> <span class="main">(</span>wu<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="free">u</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"arc_to_ends <span class="free">H</span> <span class="main">(</span>wv<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_arcs_H subdiv_ate <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1" id="Subdivision-adj_with_w"><span class="command">lemma</span></span> adj_with_w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">→</span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_arcs_H subdiv_ate <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> H.dominatesI<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1" id="Subdivision-w_reach"><span class="command">lemma</span></span> w_reach<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">H</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> adj_with_w <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Subdivision-G_reach"><span class="command">lemma</span></span> G_reach<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub><span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subdiv_ate in_arcs_G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G.dominatesI G.symmetric_reachable'<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1" id="Subdivision-out_arcs_w"><span class="command">lemma</span></span> out_arcs_w<span class="main">:</span> <span class="quoted"><span class="quoted">"out_arcs <span class="free">H</span> <span class="free">w</span> <span class="main">=</span> <span class="main">{</span>wu<span class="main">,</span> wv<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subdiv_distinct_verts0 in_arcs_H
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arcs_H<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tail_eq verts_G <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> G.tail_in_verts<span class="main">)</span>

  <span class="keyword1" id="Subdivision-out_degree_w"><span class="command">lemma</span></span> out_degree_w<span class="main">:</span> <span class="quoted"><span class="quoted">"out_degree <span class="free">H</span> <span class="free">w</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> subdiv_distinct_arcs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> out_degree_def out_arcs_w card_insert_if<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Subdivision-subdivision_compatible"><span class="command">lemma</span></span> subdivision_compatible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subdivision <span class="main">(</span><span class="free">G</span><span class="main">,</span> <span class="free">rev_G</span><span class="main">)</span> <span class="main">(</span><span class="free">H</span><span class="main">,</span> <span class="free">rev_H</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">G</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compatible_def subdivision_step_def<span class="main">)</span>

<span class="keyword1" id="Subdivision-subdivision_bidir"><span class="command">lemma</span></span> subdivision_bidir<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subdivision <span class="main">(</span><span class="free">G</span><span class="main">,</span> <span class="free">rev_G</span><span class="main">)</span> <span class="main">(</span><span class="free">H</span><span class="main">,</span> <span class="free">rev_H</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bidirected_digraph <span class="free">H</span> <span class="free">rev_H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subdivision_step_def<span class="main">)</span>

<span class="keyword1" id="Subdivision-subdivision_choose_rev"><span class="command">lemma</span></span> subdivision_choose_rev<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subdivision <span class="main">(</span><span class="free">G</span><span class="main">,</span> <span class="free">rev_G</span><span class="main">)</span> <span class="main">(</span><span class="free">H</span><span class="main">,</span> <span class="free">rev_H</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"bidirected_digraph <span class="free">H</span> <span class="free">rev_H'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">rev_G'</span><span class="main">.</span> subdivision <span class="main">(</span><span class="free">G</span><span class="main">,</span> <span class="bound">rev_G'</span><span class="main">)</span> <span class="main">(</span><span class="free">H</span><span class="main">,</span> <span class="free">rev_H'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">rev_H'</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> base
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> subdivision_base<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>divide <span class="skolem">I</span> <span class="skolem">rev_I</span> <span class="skolem">H</span> <span class="skolem">rev_H</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">uv</span> <span class="skolem">uw</span> <span class="skolem">vw</span><span class="main">)</span>

  <span class="keyword1"><span class="command">interpret</span></span> subdiv_step <span class="quoted"><span class="skolem">I</span></span> <span class="quoted"><span class="skolem">rev_I</span></span> <span class="quoted"><span class="skolem">H</span></span> <span class="quoted"><span class="skolem">rev_H</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">uv</span></span> <span class="quoted"><span class="skolem">uw</span></span> <span class="quoted"><span class="skolem">vw</span></span> <span class="keyword1"><span class="command">using</span></span> divide <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword1"><span class="command">interpret</span></span> H'<span class="main">:</span> bidirected_digraph <span class="quoted"><span class="skolem">H</span></span> <span class="quoted"><span class="skolem">rev_H'</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">rev_I'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rev_I'</span> <span class="skolem">x</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">uv</span> <span class="keyword1">then</span> <span class="skolem">rev_I</span> <span class="skolem">uv</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">rev_I</span> <span class="skolem">uv</span> <span class="keyword1">then</span> <span class="skolem">uv</span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">∈</span> arcs <span class="skolem">I</span> <span class="keyword1">then</span> <span class="skolem">rev_H'</span> <span class="skolem">x</span> <span class="keyword1">else</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>

  <span class="keyword1"><span class="command">have</span></span> rev_H_injD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="skolem">rev_H'</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="skolem">rev_H'</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span> <span class="main">⟹</span> False"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H'.arev_eq_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> rev_H'_simps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rev_H'</span> <span class="skolem">uw</span> <span class="main">=</span> <span class="skolem">rev_H</span> <span class="skolem">uw</span> <span class="main">∧</span> <span class="skolem">rev_H'</span> <span class="skolem">vw</span> <span class="main">=</span> <span class="skolem">rev_H</span> <span class="skolem">vw</span>
    <span class="main">∨</span> <span class="skolem">rev_H'</span> <span class="skolem">uw</span> <span class="main">=</span> <span class="skolem">rev_H</span> <span class="skolem">vw</span> <span class="main">∧</span> <span class="skolem">rev_H'</span> <span class="skolem">vw</span> <span class="main">=</span> <span class="skolem">rev_H</span> <span class="skolem">uw</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arc_to_ends <span class="skolem">H</span> <span class="main">(</span><span class="skolem">rev_H'</span> <span class="skolem">uw</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"arc_to_ends <span class="skolem">H</span> <span class="main">(</span><span class="skolem">rev_H'</span> <span class="skolem">vw</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> in_arcs_H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subdiv_ate<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> arcs <span class="skolem">H</span> <span class="main">⟹</span> tail <span class="skolem">H</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">w</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">rev_H</span> <span class="skolem">uw</span><span class="main">,</span> <span class="skolem">rev_H</span> <span class="skolem">vw</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> subdiv_distinct_verts0 not_in_verts_G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arcs_H<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tail_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rev_H'</span> <span class="skolem">uw</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">rev_H</span> <span class="skolem">uw</span><span class="main">,</span> <span class="skolem">rev_H</span> <span class="skolem">vw</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rev_H'</span> <span class="skolem">vw</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">rev_H</span> <span class="skolem">uw</span><span class="main">,</span> <span class="skolem">rev_H</span> <span class="skolem">vw</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> in_arcs_H <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> in_arcs_H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rev_H_injD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> rev_H_uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rev_H'</span> <span class="skolem">uv</span> <span class="main">=</span> <span class="skolem">uv</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rev_H'</span> <span class="main">(</span><span class="skolem">rev_I</span> <span class="skolem">uv</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">rev_I</span> <span class="skolem">uv</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_in_arcs_H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> H'.arev_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> bd_I'<span class="main">:</span> <span class="quoted"><span class="quoted">"bidirected_digraph <span class="skolem">I</span> <span class="skolem">rev_I'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="skolem">uv</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">≠</span> <span class="skolem">rev_I</span> <span class="skolem">uv</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∈</span> arcs <span class="skolem">I</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∈</span> arcs <span class="skolem">H</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arcs_H<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">∈</span> arcs <span class="skolem">I</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rev_I'</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> in_arcs_G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rev_I'_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> G.arev_neq H'.arev_neq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">rev_H'</span> <span class="bound">a</span> <span class="main">=</span> <span class="skolem">rev_I</span> <span class="skolem">uv</span> <span class="main">⟷</span> <span class="bound">a</span> <span class="main">=</span> <span class="skolem">rev_I</span> <span class="skolem">uv</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> H'.arev_arev H'.arev_dom insert_disjoint<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> not_in_arcs_H<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">uv</span> <span class="main">=</span> <span class="skolem">rev_H'</span> <span class="bound">a</span> <span class="main">⟷</span> <span class="bound">a</span> <span class="main">=</span> <span class="skolem">uv</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> H'.arev_eq not_in_arcs_H <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> arcs <span class="skolem">I</span> <span class="main">⟹</span> <span class="skolem">rev_H'</span> <span class="bound">a</span> <span class="main">∈</span> arcs <span class="skolem">I</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rev_H'_simps  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">a</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">uv</span><span class="main">,</span>vu<span class="main">}</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rev_H_uv<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arcs_G <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> rev_H_injD<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rev_I'</span> <span class="main">(</span><span class="skolem">rev_I'</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rev_I'_def H'.arev_eq rev_H_uv * ** ***<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> arcs <span class="skolem">I</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tail <span class="skolem">I</span> <span class="main">(</span><span class="skolem">rev_I'</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> head <span class="skolem">I</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> in_arcs_G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rev_I'_def tail_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> head_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> arcs_H<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">rev_H'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">uv</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">uv</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">rev_H'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">rev_I</span> <span class="skolem">uv</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">rev_I</span> <span class="skolem">uv</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_in_arcs_H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> H'.arev_eq<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> H'.arev_arev H'.arev_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"perm_restrict <span class="skolem">rev_H'</span> <span class="main">(</span>arcs <span class="skolem">I</span><span class="main">)</span> <span class="main">=</span> perm_restrict <span class="skolem">rev_I'</span> <span class="main">(</span>arcs <span class="skolem">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_in_arcs_H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rev_I'_def perm_restrict_def H'.arev_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> sds_I'H'<span class="main">:</span> <span class="quoted"><span class="quoted">"subdivision_step <span class="skolem">I</span> <span class="skolem">rev_I'</span> <span class="skolem">H</span> <span class="skolem">rev_H'</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">(</span><span class="skolem">uv</span><span class="main">,</span> <span class="skolem">uw</span><span class="main">,</span> <span class="skolem">vw</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> divide<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> rev_H'_simps <span class="keyword1"><span class="command">unfolding</span></span> subdivision_step_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  rev_I'_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subdivision <span class="main">(</span><span class="skolem">I</span><span class="main">,</span> <span class="skolem">rev_I'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span><span class="main">,</span> <span class="skolem">rev_H'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">rev_G'</span><span class="main">.</span> subdivision <span class="main">(</span><span class="free">G</span><span class="main">,</span> <span class="bound">rev_G'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">I</span><span class="main">,</span> <span class="skolem">rev_I'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bd_I' divide <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subdivision.intros <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> subdivision_base<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subdivision_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Subdivision-subdivision_verts_subset"><span class="command">lemma</span></span> subdivision_verts_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subdivision <span class="main">(</span><span class="free">G</span><span class="main">,</span><span class="free">rev_G</span><span class="main">)</span> <span class="main">(</span><span class="free">H</span><span class="main">,</span><span class="free">rev_H</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> verts <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">induct</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subdiv_step.verts_H subdiv_step_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Subdivision on Pair Digraphs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section, we introduce specialized rules for pair digraphs.
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">subdivision_pair</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">≡</span> subdivision <span class="main">(</span>with_proj <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> swap_in <span class="main">(</span>parcs <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>with_proj <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">,</span> swap_in <span class="main">(</span>parcs <span class="free"><span class="bound"><span class="entity">H</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Subdivision-arc_to_ends_with_proj"><span class="command">lemma</span></span> arc_to_ends_with_proj<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"arc_to_ends <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span> <span class="main">=</span> id"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_to_ends_def<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    We use the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">inductive</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> command to define an inductive definition pair graphs.
    This is proven to be equivalent to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> subdivision<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
    This allows us to transfer the rules proven by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">verbatim</span></span> <span class="raw_text"><span class="raw_text">inductive</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> subdivision<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
    To spare the user confusion, we hide this new constant.
  ›</span></span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">inductive</span></span> <span class="entity">pair_sd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pair_pre_digraph <span class="main">⇒</span> <span class="tfree">'a</span> pair_pre_digraph <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">G</span> <span class="keyword2"><span class="keyword">where</span></span>
      base<span class="main">:</span> <span class="quoted"><span class="quoted">"pair_bidirected_digraph <span class="free">G</span> <span class="main">⟹</span> <span class="free">pair_sd</span> <span class="free">G</span> <span class="free">G</span>"</span></span>
    <span class="main">|</span> divide<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span> <span class="bound">w</span> <span class="bound">H</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">e</span> <span class="main">∈</span> parcs <span class="bound">H</span><span class="main">;</span> <span class="bound">w</span> <span class="main">∉</span> pverts <span class="bound">H</span><span class="main">;</span> <span class="free">pair_sd</span> <span class="free">G</span> <span class="bound">H</span><span class="main">⟧</span>
        <span class="main">⟹</span> <span class="free">pair_sd</span> <span class="free">G</span> <span class="main">(</span>subdivide <span class="bound">H</span> <span class="bound">e</span> <span class="bound">w</span><span class="main">)</span>"</span></span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Subdivision-bidirected_digraphI_pair_sd"><span class="command">lemma</span></span> bidirected_digraphI_pair_sd<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pair_sd <span class="free">G</span> <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pair_bidirected_digraph <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
    <span class="keyword3"><span class="command">case</span></span> base
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>divide <span class="skolem">e</span> <span class="skolem">w</span> <span class="skolem">H</span><span class="main">)</span>
    <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> pair_bidirected_digraph <span class="quoted"><span class="skolem">H</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">from</span></span> divide <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> H.pair_bidirected_digraph_subdivide<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Subdivision-subdivision_with_projI"><span class="command">lemma</span></span> subdivision_with_projI<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pair_sd <span class="free">G</span> <span class="free">H</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subdivision_pair <span class="free">G</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
    <span class="keyword3"><span class="command">case</span></span> base
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> pair_bidirected_digraph.bidirected_digraph subdivision_base<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>divide <span class="skolem">e</span> <span class="skolem">w</span> <span class="skolem">H</span><span class="main">)</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> pair_bidirected_digraph <span class="quoted"><span class="skolem">H</span></span>
      <span class="keyword1"><span class="command">using</span></span> divide<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bidirected_digraphI_pair_sd<span class="main">)</span>
    <span class="keyword1"><span class="command">interpret</span></span> I<span class="main">:</span> pair_bidirected_digraph <span class="quoted"><span class="quoted">"subdivide <span class="skolem">H</span> <span class="skolem">e</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> divide<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> H.pair_bidirected_digraph_subdivide<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> uvw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> divide <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">=</span> <span class="main">_</span>›</span></span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> H.adj_not_same H.wellformed<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subdivision <span class="main">(</span>with_proj <span class="free">G</span><span class="main">,</span> swap_in <span class="main">(</span>parcs <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span><span class="main">,</span> swap_in <span class="main">(</span>parcs <span class="skolem">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> divide <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"perm_restrict <span class="main">(</span>swap_in <span class="main">(</span>parcs <span class="main">(</span>subdivide <span class="skolem">H</span> <span class="skolem">e</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>parcs <span class="skolem">H</span><span class="main">)</span> <span class="main">=</span> perm_restrict <span class="main">(</span>swap_in <span class="main">(</span>parcs <span class="skolem">H</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>parcs <span class="main">(</span>subdivide <span class="skolem">H</span> <span class="skolem">e</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> perm_restrict_def fun_eq_iff swap_in_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subdivision_step <span class="main">(</span>with_proj <span class="skolem">H</span><span class="main">)</span> <span class="main">(</span>swap_in <span class="main">(</span>arcs <span class="skolem">H</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>with_proj <span class="main">(</span>subdivide <span class="skolem">H</span> <span class="skolem">e</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>swap_in <span class="main">(</span>arcs <span class="main">(</span>subdivide <span class="skolem">H</span> <span class="skolem">e</span> <span class="skolem">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
        <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">(</span><span class="skolem">e</span><span class="main">,</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> subdivision_step_def
      <span class="keyword1"><span class="command">unfolding</span></span> prod.simps with_proj_simps
      <span class="keyword1"><span class="command">using</span></span> divide uvw
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> conjI H.bidirected_digraph I.bidirected_digraph *<span class="main">)</span>
         <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> swap_in_def <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">=</span> <span class="main">_</span>›</span></span> compatibleI_with_proj<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subdivision.divide<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Subdivision-subdivision_with_projD"><span class="command">lemma</span></span> subdivision_with_projD<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subdivision_pair <span class="free">G</span> <span class="free">H</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pair_sd <span class="free">G</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"with_proj <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"swap_in <span class="main">(</span>parcs <span class="free">H</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">H</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> subdivision_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> base
    <span class="keyword1"><span class="command">interpret</span></span> bidirected_digraph <span class="quoted"><span class="quoted">"with_proj <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"swap_in <span class="main">(</span>parcs <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">from</span></span> base <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">=</span> <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> with_proj_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> base <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> pair_sd.base pair_bidirected_digraphI_bidirected_digraph<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>divide <span class="skolem">I</span> <span class="skolem">rev_I</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">w</span> <span class="skolem">uv</span> <span class="skolem">uw</span> <span class="skolem">vw</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">I'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I'</span> <span class="main">=</span> <span class="main">⦇</span> pverts <span class="main">=</span> verts <span class="skolem">I</span><span class="main">,</span> parcs <span class="main">=</span> arcs <span class="skolem">I</span> <span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">G</span> <span class="skolem">I</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹subdivision <span class="main">(</span>with_proj <span class="free">G</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">(</span><span class="skolem">I</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subdivision_compatible<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tail <span class="skolem">I</span> <span class="main">=</span> fst"</span></span> <span class="quoted"><span class="quoted">"head <span class="skolem">I</span> <span class="main">=</span> snd"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> compatible_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> <span class="skolem">I'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> I <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rev_I</span> <span class="main">=</span> swap_in <span class="main">(</span>parcs <span class="skolem">I'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹subdivision_step <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subdivision_step_def bidirected_digraph_rev_conv_pair<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> pd_sd<span class="main">:</span> <span class="quoted"><span class="quoted">"pair_sd <span class="free">G</span> <span class="skolem">I'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> divide.hyps<span class="main">)</span>

    <span class="keyword1"><span class="command">interpret</span></span> sd<span class="main">:</span> subdiv_step <span class="quoted"><span class="skolem">I'</span></span> <span class="quoted"><span class="quoted">"swap_in <span class="main">(</span>parcs <span class="skolem">I'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">H</span></span> <span class="quoted"><span class="quoted">"swap_in <span class="main">(</span>parcs <span class="skolem">H</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">uv</span></span> <span class="quoted"><span class="skolem">uw</span></span> <span class="quoted"><span class="skolem">vw</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹subdivision_step <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">=</span> <span class="main">_</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">rev_I</span> <span class="main">=</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

    <span class="keyword1"><span class="command">have</span></span> ends<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">uv</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">uw</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vw</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sd.subdiv_ate <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> si_ends<span class="main">:</span> <span class="quoted"><span class="quoted">"swap_in <span class="main">(</span>parcs <span class="skolem">H</span><span class="main">)</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"swap_in <span class="main">(</span>parcs <span class="skolem">H</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"swap_in <span class="main">(</span>parcs <span class="skolem">I'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sd.subdiv_ends_H_rev sd.subdiv_ends_G_rev <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> swap_in_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"parcs <span class="skolem">H</span> <span class="main">=</span> parcs <span class="skolem">I'</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sd.in_arcs_G sd.not_in_arcs_G sd.arcs_H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> si_ends ends<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> subdivide <span class="skolem">I'</span> <span class="skolem">uv</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sd.verts_H <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ends subdivide.simps<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> sd.in_arcs_G sd.not_in_verts_G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> pd_sd pair_sd.divide<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="Subdivision-subdivision_pair_conv"><span class="command">lemma</span></span> subdivision_pair_conv<span class="main">:</span>
    <span class="quoted"><span class="quoted">"pair_sd <span class="free">G</span> <span class="free">H</span> <span class="main">=</span> subdivision_pair <span class="free">G</span> <span class="free">H</span> "</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subdivision_with_projD subdivision_with_projI<span class="main">)</span>

  <span class="keyword1"><span class="command">lemmas</span></span> subdivision_pair_induct <span class="main">=</span> pair_sd.induct<span class="main">[</span>
      <span class="operator">unfolded</span> subdivision_pair_conv<span class="main">,</span> <span class="operator">case_names</span> base divide<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword">pred</span><span class="main"><span class="main">:</span></span> pair_sd<span class="main">]</span>

  <span class="keyword1"><span class="command">lemmas</span></span> subdivision_pair_base <span class="main">=</span> pair_sd.base<span class="main">[</span><span class="operator">unfolded</span> subdivision_pair_conv<span class="main">]</span>
  <span class="keyword1"><span class="command">lemmas</span></span> subdivision_pair_divide <span class="main">=</span> pair_sd.divide<span class="main">[</span><span class="operator">unfolded</span> subdivision_pair_conv<span class="main">]</span>

  <span class="keyword1"><span class="command">lemmas</span></span> subdivision_pair_intros <span class="main">=</span> pair_sd.intros<span class="main">[</span><span class="operator">unfolded</span> subdivision_pair_conv<span class="main">]</span>
  <span class="keyword1"><span class="command">lemmas</span></span> subdivision_pair_cases <span class="main">=</span> pair_sd.cases<span class="main">[</span><span class="operator">unfolded</span> subdivision_pair_conv<span class="main">]</span>

  <span class="keyword1"><span class="command">lemmas</span></span> subdivision_pair_simps <span class="main">=</span> pair_sd.simps<span class="main">[</span><span class="operator">unfolded</span> subdivision_pair_conv<span class="main">]</span>

  <span class="keyword1"><span class="command">lemmas</span></span> bidirected_digraphI_subdivision <span class="main">=</span> bidirected_digraphI_pair_sd<span class="main">[</span><span class="operator">unfolded</span> subdivision_pair_conv<span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_graph<span class="main">)</span> pair_graph_subdivision<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subdivision_pair <span class="free">G</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pair_graph <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> subdivision_pair_induct<span class="main">)</span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> pair_graph.pair_graph_subdivide divide<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Euler">
<div class="head">
<h1>Theory Euler</h1>
</div>
<pre class="source"><span class="comment1">(* Title:  Euler.thy
   Author: Lars Noschinski, TU München
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Euler <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Arc_Walk.html">Arc_Walk</a>
  <a href="Digraph_Component.html">Digraph_Component</a>
  <a href="Digraph_Isomorphism.html">Digraph_Isomorphism</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Euler Trails in Digraphs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  In this section we prove the well-known theorem characterizing the
  existence of an Euler Trail in an directed graph
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Trails and Euler Trails›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> <span class="entity">euler_trail</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> awalk <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">euler_trail</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> trail <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∧</span> set <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> arcs <span class="free">G</span> <span class="main">∧</span> set <span class="main">(</span>awalk_verts <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">=</span> verts <span class="free">G</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> wf_digraph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* XXX move; notused*)</span>
<span class="keyword1" id="Euler-finite_distinct"><span class="command">lemma</span></span> finite_distinct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">p</span><span class="main">.</span> distinct <span class="bound">p</span> <span class="main">∧</span> set <span class="bound">p</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> distinct <span class="bound">p</span> <span class="main">∧</span> set <span class="bound">p</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> set <span class="bound">p</span> <span class="main">⊆</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">p</span> <span class="main">≤</span> card <span class="free">A</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> distinct_card<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> card_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">...</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_lists_length_le<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="main">(</span>finite_subset<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* XXX move; notused*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> trails_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> trail <span class="bound">u</span> <span class="bound">p</span> <span class="bound">v</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> trail <span class="bound">u</span> <span class="bound">p</span> <span class="bound">v</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> distinct <span class="bound">p</span> <span class="main">∧</span> set <span class="bound">p</span> <span class="main">⊆</span> arcs <span class="free">G</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trail_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> finite_arcs finite_distinct <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="comment1">(* XXX: simplify apath_finite proof? *)</span>

<span class="keyword1" id="Euler-rotate_awalkE"><span class="command">lemma</span></span> rotate_awalkE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q</span> <span class="free">r</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">@</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">w</span> <span class="main">(</span><span class="free">r</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="free">w</span> <span class="main">(</span><span class="free">r</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A'<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="skolem">q</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">w</span> <span class="skolem">r</span> <span class="free">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">atomize_elim</span> <span class="main">(</span><span class="operator">rule</span> awalk_decomp<span class="main">)</span>
  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">w</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">@</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="free">w</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">@</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="free">u</span> <span class="free">p</span> <span class="free">u</span>›</span></span> A A' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_awalk_verts_append<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> A B C <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Euler-rotate_trailE"><span class="command">lemma</span></span> rotate_trailE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trail <span class="free">u</span> <span class="free">p</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q</span> <span class="free">r</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span> <span class="main">@</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"trail <span class="free">w</span> <span class="main">(</span><span class="free">r</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="free">w</span> <span class="main">(</span><span class="free">r</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> rotate_awalkE<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> u<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">u</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> p<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> w<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trail_def<span class="main">)</span>

<span class="keyword1" id="Euler-rotate_trailE'"><span class="command">lemma</span></span> rotate_trailE'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trail <span class="free">u</span> <span class="free">p</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">q</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"trail <span class="free">w</span> <span class="free">q</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">q</span> <span class="main">=</span> set <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="free">w</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"trail <span class="free">w</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">@</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="free">w</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">@</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rotate_trailE<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">r</span> <span class="main">@</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> set <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> that<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Euler-sym_reachableI_in_awalk"><span class="command">lemma</span></span> sym_reachableI_in_awalk<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> walk<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    w1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub>mk_symmetric <span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">w2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> walk w1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="skolem">q</span> <span class="free">w1</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">w1</span> <span class="skolem">r</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> awalk_decomp<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> w2_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>awalk_verts <span class="free">w1</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> w2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_awalk_verts_append<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">w2</span> <span class="skolem">s</span> <span class="free">w1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> awalk_decomp<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹awalk <span class="free">u</span> <span class="skolem">q</span> <span class="free">w1</span>›</span></span> A<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub>mk_symmetric <span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">w1</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> reachable_awalkI reachable_mk_symmetricI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> symmetric_mk_symmetric <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> symmetric_reachable<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">∉</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w2</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">w1</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> w2_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">w1</span> <span class="skolem">s</span> <span class="free">w2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> awalk_decomp<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹awalk <span class="free">w1</span> <span class="skolem">r</span> <span class="free">v</span>›</span></span> A<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">w1</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub>mk_symmetric <span class="free">G</span></sub><span class="hidden">⇙</span> <span class="free">w2</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> reachable_awalkI reachable_mk_symmetricI<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Euler-euler_imp_connected"><span class="command">lemma</span></span> euler_imp_connected<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"euler_trail <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> euler_trail_def trail_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w1</span> <span class="skolem">w2</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w2</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span> "</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w2</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> euler_trail_def trail_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub>mk_symmetric <span class="free">G</span></sub><span class="hidden">⇙</span> <span class="skolem">w2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym_reachableI_in_awalk<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> connectedI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Arc Balance of Walks›</span></span>

<span class="keyword1"><span class="command">context</span></span> pre_digraph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* XXX change order of arguments? *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">arc_set_balance</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> set <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">arc_set_balance</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> int <span class="main">(</span>card <span class="main">(</span>in_arcs <span class="free">G</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> int <span class="main">(</span>card <span class="main">(</span>out_arcs <span class="free">G</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>  <span class="entity">arc_set_balanced</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">arc_set_balanced</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span>
      <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> verts <span class="free">G</span><span class="main">.</span> arc_set_balance <span class="bound">w</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="main">(</span><span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> verts <span class="free">G</span><span class="main">.</span> <span class="main">(</span><span class="bound">w</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">⟶</span> arc_set_balance <span class="bound">w</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
        <span class="main">∧</span> arc_set_balance <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>
        <span class="main">∧</span> arc_set_balance <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">arc_balance</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> awalk <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">arc_balance</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> arc_set_balance <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">arc_balanced</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> awalk <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">arc_balanced</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> arc_set_balanced <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>

<span class="keyword1" id="Euler-arc_set_balanced_all"><span class="command">lemma</span></span> arc_set_balanced_all<span class="main">:</span>
  <span class="quoted"><span class="quoted">"arc_set_balanced <span class="free">u</span> <span class="main">(</span>arcs <span class="free">G</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">if</span> <span class="free">u</span> <span class="main">=</span> <span class="free">v</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> verts <span class="free">G</span><span class="main">.</span> in_degree <span class="free">G</span> <span class="bound">w</span> <span class="main">=</span> out_degree <span class="free">G</span> <span class="bound">w</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="main">(</span><span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> verts <span class="free">G</span><span class="main">.</span> <span class="main">(</span><span class="bound">w</span> <span class="main">≠</span> <span class="free">u</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">≠</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟶</span> in_degree <span class="free">G</span> <span class="bound">w</span> <span class="main">=</span> out_degree <span class="free">G</span> <span class="bound">w</span><span class="main">)</span>
        <span class="main">∧</span> in_degree <span class="free">G</span> <span class="free">u</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> out_degree <span class="free">G</span> <span class="free">u</span>
        <span class="main">∧</span> out_degree <span class="free">G</span> <span class="free">v</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> in_degree <span class="free">G</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> arc_set_balanced_def arc_set_balance_def in_degree_def out_degree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> wf_digraph <span class="keyword2"><span class="keyword">begin</span></span>


<span class="comment1">(* XXX tune assumption? e ∉ set es oder so? *)</span>
<span class="keyword1" id="Euler-arc_balance_Cons"><span class="command">lemma</span></span> arc_balance_Cons<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trail <span class="free">u</span> <span class="main">(</span><span class="free">e</span> <span class="main">#</span> <span class="free">es</span><span class="main">)</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"arc_set_balance <span class="free">w</span> <span class="main">(</span>insert <span class="free">e</span> <span class="main">(</span>set <span class="free">es</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> arc_set_balance <span class="free">w</span> <span class="main">{</span><span class="free">e</span><span class="main">}</span> <span class="main">+</span> arc_balance <span class="free">w</span> <span class="free">es</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∉</span> set <span class="free">es</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trail_def<span class="main">)</span>

  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">∉</span> set <span class="free">es</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> tail <span class="free">G</span> <span class="free">e</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">w</span></span> <span class="main"><span class="main">=</span></span> head <span class="free"><span class="free">G</span></span> <span class="free"><span class="free">e</span></span>"</span></span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_set_balance_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Euler-arc_balancedI_trail"><span class="command">lemma</span></span> arc_balancedI_trail<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trail <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"arc_balanced <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_set_balanced_def arc_set_balance_def trail_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">e</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arc_balanced <span class="main">(</span>head <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="skolem">es</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> tail <span class="free">G</span> <span class="skolem">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_Cons_iff trail_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> arc_balance <span class="bound">w</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">w</span> <span class="main">=</span> tail <span class="free">G</span> <span class="skolem">e</span> <span class="main">∧</span> tail <span class="free">G</span> <span class="skolem">e</span> <span class="main">≠</span> head <span class="free">G</span> <span class="skolem">e</span> <span class="keyword1">then</span> <span class="main">-</span><span class="main">1</span>
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">w</span> <span class="main">=</span> head <span class="free">G</span> <span class="skolem">e</span> <span class="main">∧</span> tail <span class="free">G</span> <span class="skolem">e</span> <span class="main">≠</span> head <span class="free">G</span> <span class="skolem">e</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">w</span> <span class="main">=</span> tail <span class="free">G</span> <span class="skolem">e</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_set_balance_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_set_balanced_def arc_balance_Cons<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹trail <span class="skolem">u</span> <span class="main">_</span> <span class="main">_</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Euler-trail_arc_balanceE"><span class="command">lemma</span></span> trail_arc_balanceE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"trail <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="main">⟦</span> <span class="free">u</span> <span class="main">=</span> <span class="free">v</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">w</span> <span class="main">≠</span> <span class="free">u</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">≠</span> <span class="free">v</span><span class="main">)</span><span class="main">;</span> <span class="bound">w</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟧</span>
      <span class="main">⟹</span> arc_balance <span class="bound">w</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">u</span> <span class="main">≠</span> <span class="free">v</span> <span class="main">⟧</span> <span class="main">⟹</span> arc_balance <span class="free">u</span> <span class="free">p</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">u</span> <span class="main">≠</span> <span class="free">v</span> <span class="main">⟧</span> <span class="main">⟹</span> arc_balance <span class="free">v</span> <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> arc_balancedI_trail<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> arc_set_balanced_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> that<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span><span class="main"><span class="keyword3">,</span></span><span class="operator">presburger</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Closed Euler Trails›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> awalk_vertex_props<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">w</span> <span class="main">∨</span> <span class="free">Q</span> <span class="bound">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span> <span class="main">∈</span> set <span class="free">p</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>tail <span class="free">G</span> <span class="bound">e</span><span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span>head <span class="free">G</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>1<span class="main">,</span>3-<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_nonempty_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>cons <span class="skolem">e</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span>head <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>head <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Q</span> <span class="main">(</span>head <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cons.prems<span class="main">(</span>1<span class="main">)</span> cons.prems<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="skolem">e</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_Cons_iff set_awalk_verts<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">(</span>head <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">using</span></span> cons.prems<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span> <span class="main">∈</span> set <span class="skolem">es</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>tail <span class="free">G</span> <span class="bound">e</span><span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span>head <span class="free">G</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> cons <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_Cons_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> awalk_simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> connected_verts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"arcs <span class="free">G</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">=</span> tail <span class="free">G</span> <span class="main">`</span> arcs <span class="free">G</span> <span class="main">∪</span> head <span class="free">G</span> <span class="main">`</span> arcs <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> tail_in_verts<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">.</span> verts <span class="free">G</span> <span class="main">=</span> <span class="main">{</span><span class="bound">v</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_Suc_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> <span class="quoted"><span class="quoted">‹arcs <span class="free">G</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="skolem">e</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="skolem">e</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> tail_in_verts head_in_verts<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="main">`</span> arcs <span class="free">G</span> <span class="main">∪</span> head <span class="free">G</span> <span class="main">`</span> arcs <span class="free">G</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≠</span> <span class="bound">v</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>

      <span class="keyword1"><span class="command">interpret</span></span> S<span class="main">:</span> pair_wf_digraph <span class="quoted"><span class="quoted">"mk_symmetric <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">rule</span>
      <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"S.awalk <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹connected <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> verts <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> connected_awalkE<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> parcs <span class="main">(</span>mk_symmetric <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">e</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> S.awalk_Cons_iff S.awalk_empty_ends list_exhaust2<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="skolem">e'</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">∨</span> head <span class="free">G</span> <span class="skolem">e'</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e'</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> parcs_mk_symmetric<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> tail <span class="free">G</span> <span class="main">`</span> arcs <span class="free">G</span> <span class="main">∪</span> head <span class="free">G</span> <span class="main">`</span>arcs <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> connected_arcs_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"arcs <span class="free">G</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">v</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"verts <span class="free">G</span> <span class="main">=</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> verts <span class="free">G</span> <span class="main">=</span> <span class="main">{</span><span class="bound">v</span><span class="main">}</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">interpret</span></span> S<span class="main">:</span> pair_wf_digraph <span class="quoted"><span class="quoted">"mk_symmetric <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">rule</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹verts <span class="free">G</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹connected <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> verts <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> verts <span class="free">G</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"S.awalk <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹connected <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> verts <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> connected_awalkE<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> parcs <span class="main">(</span>mk_symmetric <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> S.awalk_Cons_iff S.awalk_empty_ends list_exhaust2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹arcs <span class="free">G</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> parcs_mk_symmetric<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> euler_trail_conv_connected<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"euler_trail <span class="free">u</span> <span class="free">p</span> <span class="free">v</span> <span class="main">⟷</span> trail <span class="free">u</span> <span class="free">p</span> <span class="free">v</span> <span class="main">∧</span> set <span class="free">p</span> <span class="main">=</span> arcs <span class="free">G</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">with</span></span> assms <span class="quoted"><span class="quoted">‹<span class="var">?R</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> euler_trail_def trail_def awalk_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> connected_arcs_empty<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arcs <span class="free">G</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?R</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="quoted"><span class="quoted">‹<span class="var">?R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> euler_trail_def trail_def set_awalk_verts_not_Nil connected_verts<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> euler_trail_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> awalk_connected<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">≠</span> arcs <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">-</span> set <span class="free">p</span> <span class="main">∧</span> <span class="main">(</span>tail <span class="free">G</span> <span class="bound">e</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">∨</span> head <span class="free">G</span> <span class="bound">e</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?thesis</span>"</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">-</span> set <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trail_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="skolem">e</span> <span class="main">∉</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="skolem">e</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">interpret</span></span> S<span class="main">:</span> pair_wf_digraph <span class="quoted"><span class="quoted">"mk_symmetric <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_hd_in_verts<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹tail <span class="free">G</span> <span class="skolem">e</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹connected <span class="free">G</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"S.awalk <span class="free">u</span> <span class="skolem">q</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> connected_awalkE<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_awalk_verts<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">∈</span> set <span class="main">_</span>›</span></span> <span class="quoted"><span class="quoted">‹tail <span class="free">G</span> <span class="skolem">e</span> <span class="main">∉</span> <span class="main">_</span>›</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span> <span class="main">∈</span> set <span class="skolem">q</span><span class="main">.</span> fst <span class="bound">e</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">∧</span> snd <span class="bound">e</span> <span class="main">∉</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> S.awalk_vertex_props<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹S.awalk <span class="main">_</span> <span class="main">_</span> <span class="main">_</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">∈</span> set <span class="main">_</span>›</span></span> <span class="quoted"><span class="quoted">‹tail <span class="free">G</span> <span class="skolem">e</span> <span class="main">∉</span> <span class="main">_</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">se'</span></span> <span class="keyword2"><span class="keyword">where</span></span> se'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">se'</span> <span class="main">∈</span> set <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">se'</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">se'</span> <span class="main">∉</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> se' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">se'</span> <span class="main">∈</span> parcs <span class="main">(</span>mk_symmetric <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e'</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e'</span> <span class="main">=</span> fst <span class="skolem">se'</span> <span class="main">∧</span> head <span class="free">G</span> <span class="skolem">e'</span> <span class="main">=</span> snd <span class="skolem">se'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e'</span> <span class="main">=</span> snd <span class="skolem">se'</span> <span class="main">∧</span> head <span class="free">G</span> <span class="skolem">e'</span> <span class="main">=</span> fst <span class="skolem">se'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> parcs_mk_symmetric<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e'</span> <span class="main">∉</span> set <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> se' <span class="quoted"><span class="quoted">‹awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> awalk_verts_arc2 awalk_verts_arc1<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> se'
    <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> trail_connected<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"trail <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">≠</span> arcs <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">-</span> set <span class="free">p</span> <span class="main">∧</span> <span class="main">(</span>tail <span class="free">G</span> <span class="bound">e</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">∨</span> head <span class="free">G</span> <span class="bound">e</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> awalk_connected<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trail_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> closed_euler1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> con<span class="main">:</span> <span class="quoted"><span class="quoted">"connected <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟹</span> in_degree <span class="free">G</span> <span class="bound">u</span> <span class="main">=</span> out_degree <span class="free">G</span> <span class="bound">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="bound">p</span><span class="main">.</span> euler_trail <span class="bound">u</span> <span class="bound">p</span> <span class="bound">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> con <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> connected_def strongly_connected_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trail <span class="skolem">u</span> <span class="main">[]</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trail_def awalk_simps<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"trail <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u'</span> <span class="bound">p'</span> <span class="bound">v'</span><span class="main">.</span> euler_trail <span class="bound">u'</span> <span class="bound">p'</span> <span class="bound">v'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>arcs <span class="free">G</span><span class="main">)</span> <span class="main">-</span> length <span class="skolem">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trail_def<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">p</span> <span class="main">⊆</span> arcs <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹trail <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trail_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">p</span> <span class="main">=</span> arcs <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trail_def distinct_card<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> card_seteq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"euler_trail <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> euler_trail_conv_connected<span class="main"><span class="main">[</span></span><span class="operator">OF</span> con<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> neq<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">p</span> <span class="main">≠</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trail_def distinct_card<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arc_balance <span class="skolem">u</span> <span class="skolem">p</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc neq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> trail_arc_balanceE<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>in_arcs <span class="free">G</span> <span class="skolem">u</span> <span class="main">∩</span> set <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span>out_arcs <span class="free">G</span> <span class="skolem">u</span> <span class="main">∩</span> set <span class="skolem">p</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> arc_set_balance_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> card <span class="main">(</span>out_arcs <span class="free">G</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>in_arcs <span class="free">G</span> <span class="skolem">u</span> <span class="main">∩</span> set <span class="skolem">p</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="main">(</span>in_arcs <span class="free">G</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> deg<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="main">_</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> out_degree_def in_degree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_arcs <span class="free">G</span> <span class="skolem">u</span> <span class="main">-</span> set <span class="skolem">p</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> card_psubset<span class="main"><span class="main">[</span></span><span class="operator">rotated</span> 2<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> set <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_arcs_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"trail <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trail_def awalk_simps<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Suc<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> neq con Suc
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">-</span> set <span class="skolem">p</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> a_end<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tail <span class="free">G</span> <span class="skolem">a</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∨</span> head <span class="free">G</span> <span class="skolem">a</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> trail_connected<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trail <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="skolem">a</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="skolem">p</span><span class="main">)</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹trail <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">u</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">p</span> <span class="main">=</span> set <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"trail <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rotate_trailE'<span class="main">)</span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> True a_in <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"trail <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">a</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>head <span class="free">G</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trail_def awalk_simps <span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">from</span></span> q Suc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">q</span> <span class="main">=</span> length <span class="skolem">p</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trail_def distinct_card<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Suc<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">with</span></span> a_end <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="skolem">a</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹trail <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">u</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">p</span> <span class="main">=</span> set <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"trail <span class="main">(</span>head <span class="free">G</span> <span class="skolem">a</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">(</span>head <span class="free">G</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rotate_trailE'<span class="main">)</span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> False a_in <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"trail <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span>head <span class="free">G</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trail_def awalk_simps <span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">from</span></span> q Suc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">q</span> <span class="main">=</span> length <span class="skolem">p</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trail_def distinct_card<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Suc<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> et<span class="main">:</span> <span class="quoted"><span class="quoted">"euler_trail <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arc_balanced <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹euler_trail <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> euler_trail_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> arc_balancedI_trail<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹euler_trail <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>›</span></span> deg
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> euler_trail_def trail_def arc_set_balanced_all <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> closed_euler_imp_eq_degree<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"euler_trail <span class="free">u</span> <span class="free">p</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"in_degree <span class="free">G</span> <span class="free">v</span> <span class="main">=</span> out_degree <span class="free">G</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arc_balanced <span class="free">u</span> <span class="free">p</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="free">p</span> <span class="main">=</span> arcs <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> euler_trail_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> arc_balancedI_trail<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arc_balance <span class="free">v</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> arc_set_balanced_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹set <span class="free">p</span> <span class="main">=</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_arcs <span class="free">G</span> <span class="free">v</span> <span class="main">∩</span> set <span class="free">p</span> <span class="main">=</span> in_arcs <span class="free">G</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"out_arcs <span class="free">G</span> <span class="free">v</span> <span class="main">∩</span> set <span class="free">p</span> <span class="main">=</span> out_arcs <span class="free">G</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> in_arcs_in_arcs out_arcs_in_arcs<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> arc_set_balance_def in_degree_def out_degree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> closed_euler2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"euler_trail <span class="free">u</span> <span class="free">p</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟹</span> in_degree <span class="free">G</span> <span class="bound">u</span> <span class="main">=</span> out_degree <span class="free">G</span> <span class="bound">u</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="main">_</span> <span class="main">⟹</span> <span class="var">?eq_deg</span> <span class="bound">u</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> euler_imp_connected<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?eq_deg</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> closed_euler_imp_eq_degree<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> closed_euler<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">p</span><span class="main">.</span> euler_trail <span class="bound">u</span> <span class="bound">p</span> <span class="bound">u</span><span class="main">)</span> <span class="main">⟷</span> connected <span class="free">G</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> verts <span class="free">G</span><span class="main">.</span> in_degree <span class="free">G</span> <span class="bound">u</span> <span class="main">=</span> out_degree <span class="free">G</span> <span class="bound">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> closed_euler1 closed_euler2<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Open euler trails›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Intuitively, a graph has an open euler trail if and only if it is possible to add
  an arc such that the resulting graph has a closed euler trail. However, this is
  not true in our formalization, as the arc type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> might be finite:

  Consider for example the graph
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">⦇</span></span> verts <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">0</span></span><span class="main"><span class="main">,</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">}</span></span><span class="main"><span class="main">,</span></span> arcs <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">()</span></span><span class="main"><span class="main">}</span></span><span class="main"><span class="main">,</span></span> tail <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">λ</span></span><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">,</span></span> head <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">λ</span></span><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">1</span></span> <span class="main"><span class="main">⦈</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. This graph
  obviously has an open euler trail, but we cannot add another arc, as we already
  exhausted the universe.

  However, for each <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"fin_digraph <span class="free"><span class="free">G</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> there exist an isomorphic graph
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">H</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> with arc type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'a</span></span> <span class="main"><span class="main">×</span></span> nat <span class="main"><span class="main">×</span></span> <span class="tfree"><span class="tfree">'a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. Hence, we first characterize
  the existence of euler trail for the infinite arc type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'a</span></span> <span class="main"><span class="main">×</span></span> nat <span class="main"><span class="main">×</span></span> <span class="tfree"><span class="tfree">'a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  and transfer that result back to arbitrary arc types.
›</span></span>

<span class="keyword1" id="Euler-open_euler_infinite_label"><span class="command">lemma</span></span> open_euler_infinite_label<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'a</span> <span class="main">×</span> nat <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> pre_digraph"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"fin_digraph <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="main">=</span> fst"</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="main">=</span> snd <span class="keyword1">o</span> snd"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> con<span class="main">:</span> <span class="quoted"><span class="quoted">"connected <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> deg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">w</span> <span class="main">∈</span> verts <span class="free">G</span><span class="main">;</span> <span class="free">u</span> <span class="main">≠</span> <span class="bound">w</span><span class="main">;</span> <span class="free">v</span> <span class="main">≠</span> <span class="bound">w</span><span class="main">⟧</span> <span class="main">⟹</span> in_degree <span class="free">G</span> <span class="bound">w</span> <span class="main">=</span> out_degree <span class="free">G</span> <span class="bound">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> deg_in<span class="main">:</span> <span class="quoted"><span class="quoted">"in_degree <span class="free">G</span> <span class="free">u</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> out_degree <span class="free">G</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> deg_out<span class="main">:</span> <span class="quoted"><span class="quoted">"out_degree <span class="free">G</span> <span class="free">v</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> in_degree <span class="free">G</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> pre_digraph.euler_trail <span class="free">G</span> <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">label</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">×</span> nat <span class="main">×</span> <span class="tfree">'a</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">label</span> <span class="main">=</span> fst <span class="keyword1">o</span> snd"</span></span>

  <span class="keyword1"><span class="command">interpret</span></span> fin_digraph <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">label</span> <span class="main">`</span> arcs <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>finite <span class="main">(</span>UNIV <span class="main">::</span> nat set<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">∉</span> <span class="skolem">label</span> <span class="main">`</span> arcs <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">atomize_elim</span> <span class="main">(</span><span class="operator">rule</span> ex_new_if_finite<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> deg_in deg_out <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="skolem">l</span><span class="main">,</span><span class="free">u</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> e_notin<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">∉</span> arcs <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">∉</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_def<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"add_arc <span class="var">?e</span>"</span></span>
    <span class="comment1">― ‹We define a graph which has an closed euler trail›</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"verts <span class="var">?H</span> <span class="main">=</span> verts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> uv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> compatible <span class="main">(</span>add_arc <span class="bound">a</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compatible_def<span class="main">)</span>

  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> fin_digraph <span class="quoted"><span class="quoted">"add_arc <span class="skolem">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"tail <span class="main">(</span>add_arc <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> tail <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"head <span class="main">(</span>add_arc <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> head <span class="free">G</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pre_digraph.cas <span class="main">(</span>add_arc <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> cas"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pre_digraph.awalk_verts <span class="main">(</span>add_arc <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> awalk_verts"</span></span>
     <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> wellformed <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> compatible_cas compatible_awalk_verts
          <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> verts_add_arc_conv<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="bound">p</span><span class="main">.</span> H.euler_trail <span class="var">?e</span> <span class="bound">u</span> <span class="bound">p</span> <span class="bound">u</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> H.closed_euler1<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"connected <span class="var">?H</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> H.connectedI<span class="main">)</span>
      <span class="keyword1"><span class="command">interpret</span></span> sH<span class="main">:</span> pair_fin_digraph <span class="quoted"><span class="quoted">"mk_symmetric <span class="var">?H</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> verts <span class="var">?H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> verts <span class="var">?H</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> con <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub>mk_symmetric <span class="free">G</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> connected_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">G</span> <span class="var">?H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subgraph_def<span class="main">)</span> <span class="operator">unfold_locales</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span><span class="hidden">⇘</span><sub>with_proj <span class="main">(</span>mk_symmetric <span class="var">?H</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> sH.reachable_mono subgraph_mk_symmetric<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> verts_add_arc_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> verts <span class="var">?H</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"in_degree <span class="var">?H</span> <span class="skolem">w</span> <span class="main">=</span> out_degree <span class="var">?H</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> deg deg_in deg_out e_notin
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="free">u</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">w</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">v</span></span>"</span></span></span><span class="main">)</span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_degree_add_arc_iff out_degree_add_arc_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> Het<span class="main">:</span> <span class="quoted"><span class="quoted">"H.euler_trail <span class="var">?e</span> <span class="skolem">w</span> <span class="skolem">p</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.euler_trail_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="main">[</span><span class="var">?e</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_set_conv_decomp<span class="main">)</span>
    <span class="comment1">― ‹We show now that removing the additional arc of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="var">?H</span></span><span class="antiquote">}</span></span>
      from p yields an euler trail in G›</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"euler_trail <span class="free">u</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">@</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> euler_trail_conv_connected<span class="main"><span class="main">[</span></span><span class="operator">OF</span> con<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Het <span class="keyword1"><span class="command">have</span></span> Ht'<span class="main">:</span> <span class="quoted"><span class="quoted">"H.trail <span class="var">?e</span> <span class="free">v</span> <span class="main">(</span><span class="var">?e</span> <span class="main">#</span> <span class="skolem">r</span> <span class="main">@</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p_decomp H.euler_trail_def H.trail_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_decomp H.awalk_Cons_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"H.trail <span class="var">?e</span> <span class="free">u</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">@</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">r</span> <span class="main">@</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> H.trail_def H.awalk_Cons_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> t'<span class="main">:</span> <span class="quoted"><span class="quoted">"trail <span class="free">u</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">@</span> <span class="skolem">q</span><span class="main">)</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> trail_def H.trail_def awalk_def H.awalk_def<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">r</span> <span class="main">@</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">=</span> arcs <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arcs <span class="free">G</span> <span class="main">=</span> arcs <span class="var">?H</span> <span class="main">-</span> <span class="main">{</span><span class="var">?e</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e_notin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arcs <span class="var">?H</span> <span class="main">=</span> set <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Het
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.euler_trail_def pre_digraph.trail_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?e</span> <span class="main">∉</span> set <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p_decomp<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> wf_digraph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Euler-trail_app_isoI"><span class="command">lemma</span></span> trail_app_isoI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"trail <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pre_digraph.trail <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="main">(</span>iso_verts <span class="free">hom</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>iso_arcs <span class="free">hom</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>iso_verts <span class="free">hom</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> wf_digraph <span class="quoted"><span class="quoted">"app_iso <span class="free">hom</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hom <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">from</span></span> t hom <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>iso_arcs <span class="free">hom</span><span class="main">)</span> <span class="main">(</span>set <span class="free">p</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> trail_def digraph_isomorphism_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span>subset_inj_on<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> A<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"set <span class="free">p</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map <span class="main">(</span>iso_arcs <span class="free">hom</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> distinct <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> distinct_map <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> inj_onD<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> t hom <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.trail_def awalk_app_isoI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Euler-euler_trail_app_isoI"><span class="command">lemma</span></span> euler_trail_app_isoI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"euler_trail <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="free">hom</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pre_digraph.euler_trail <span class="main">(</span>app_iso <span class="free">hom</span> <span class="free">G</span><span class="main">)</span> <span class="main">(</span>iso_verts <span class="free">hom</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>iso_arcs <span class="free">hom</span><span class="main">)</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>iso_verts <span class="free">hom</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> t <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> euler_trail_def trail_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pre_digraph.euler_trail_def trail_app_isoI awalk_verts_app_iso_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> fin_digraph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* XXX: We can get rid of "u ∈ verts G" "v ∈ verts G" here and in @{thm open_euler_infinite_label} *)</span>
<span class="keyword1"><span class="command">theorem</span></span> open_euler1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">w</span> <span class="main">∈</span> verts <span class="free">G</span><span class="main">;</span> <span class="free">u</span> <span class="main">≠</span> <span class="bound">w</span><span class="main">;</span> <span class="free">v</span> <span class="main">≠</span> <span class="bound">w</span><span class="main">⟧</span> <span class="main">⟹</span> in_degree <span class="free">G</span> <span class="bound">w</span> <span class="main">=</span> out_degree <span class="free">G</span> <span class="bound">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"in_degree <span class="free">G</span> <span class="free">u</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> out_degree <span class="free">G</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"out_degree <span class="free">G</span> <span class="free">v</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> in_degree <span class="free">G</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> euler_trail <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> arcs <span class="free">G</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="skolem">n</span><span class="main">}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="main">(</span>arcs <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">atomize_elim</span> <span class="main">(</span><span class="operator">rule</span> finite_imp_inj_to_nat_seg<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">iso_f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">iso_f</span> <span class="main">=</span>
    <span class="main">⦇</span> iso_verts <span class="main">=</span> id<span class="main">,</span> iso_arcs <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span>tail <span class="free">G</span> <span class="bound">a</span><span class="main">,</span> <span class="skolem">f</span> <span class="bound">a</span><span class="main">,</span> head <span class="free">G</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
      head <span class="main">=</span> snd <span class="keyword1">o</span> snd<span class="main">,</span> tail <span class="main">=</span> fst <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"iso_verts <span class="skolem">iso_f</span> <span class="main">=</span> id"</span></span> <span class="quoted"><span class="quoted">"iso_head <span class="skolem">iso_f</span> <span class="main">=</span> snd <span class="keyword1">o</span> snd"</span></span> <span class="quoted"><span class="quoted">"iso_tail <span class="skolem">iso_f</span> <span class="main">=</span> fst"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> iso_f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> di_iso_f<span class="main">:</span> <span class="quoted"><span class="quoted">"digraph_isomorphism <span class="skolem">iso_f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> digraph_isomorphism_def iso_f_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inj_onI wf_digraph <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> inj_onD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?iso_g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"inv_iso <span class="skolem">iso_f</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟹</span> iso_verts <span class="var">?iso_g</span> <span class="bound">u</span> <span class="main">=</span> <span class="bound">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inv_iso_def fun_eq_iff the_inv_into_f_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"app_iso <span class="skolem">iso_f</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> fin_digraph <span class="var"><span class="quoted"><span class="var">?H</span></span></span> <span class="keyword1"><span class="command">using</span></span> di_iso_f <span class="keyword1"><span class="command">..</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> H.euler_trail <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> di_iso_f assms i
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> open_euler_infinite_label<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> connectedI_app_iso app_iso_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> Het<span class="main">:</span> <span class="quoted"><span class="quoted">"H.euler_trail <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre_digraph.euler_trail <span class="main">(</span>app_iso <span class="var">?iso_g</span> <span class="var">?H</span><span class="main">)</span> <span class="main">(</span>iso_verts <span class="var">?iso_g</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span>map <span class="main">(</span>iso_arcs <span class="var">?iso_g</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">(</span>iso_verts <span class="var">?iso_g</span> <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Het <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> H.euler_trail_app_isoI digraph_isomorphism_invI di_iso_f<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> di_iso_f <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">rule</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> open_euler2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> et<span class="main">:</span> <span class="quoted"><span class="quoted">"euler_trail <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"connected <span class="free">G</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> verts <span class="free">G</span><span class="main">.</span> <span class="free">u</span> <span class="main">≠</span> <span class="bound">w</span> <span class="main">⟶</span> <span class="free">v</span> <span class="main">≠</span> <span class="bound">w</span> <span class="main">⟶</span> in_degree <span class="free">G</span> <span class="bound">w</span> <span class="main">=</span> out_degree <span class="free">G</span> <span class="bound">w</span><span class="main">)</span> <span class="main">∧</span>
    in_degree <span class="free">G</span> <span class="free">u</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> out_degree <span class="free">G</span> <span class="free">u</span> <span class="main">∧</span>
    out_degree <span class="free">G</span> <span class="free">v</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> in_degree <span class="free">G</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> et <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"trail <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> euler_trail_def trail_def awalk_hd_in_verts<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> et <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> card <span class="main">(</span>in_arcs <span class="free">G</span> <span class="bound">u</span> <span class="main">∩</span> set <span class="free">p</span><span class="main">)</span> <span class="main">=</span> in_degree <span class="free">G</span> <span class="bound">u</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> card <span class="main">(</span>out_arcs <span class="free">G</span> <span class="bound">u</span> <span class="main">∩</span> set <span class="free">p</span><span class="main">)</span> <span class="main">=</span> out_degree <span class="free">G</span> <span class="bound">u</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_degree_def out_degree_def euler_trail_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted">card</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> assms * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_set_balance_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> trail_arc_balanceE
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> euler_imp_connected<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> open_euler<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">p</span> <span class="bound">v</span><span class="main">.</span> euler_trail <span class="bound">u</span> <span class="bound">p</span> <span class="bound">v</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≠</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⟷</span>
    connected <span class="free">G</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">w</span> <span class="main">∈</span> verts <span class="free">G</span><span class="main">.</span> <span class="bound">u</span> <span class="main">≠</span> <span class="bound">w</span> <span class="main">⟶</span> <span class="bound">v</span> <span class="main">≠</span> <span class="bound">w</span> <span class="main">⟶</span> in_degree <span class="free">G</span> <span class="bound">w</span> <span class="main">=</span> out_degree <span class="free">G</span> <span class="bound">w</span><span class="main">)</span> <span class="main">∧</span>
      in_degree <span class="free">G</span> <span class="bound">u</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> out_degree <span class="free">G</span> <span class="bound">u</span> <span class="main">∧</span>
      out_degree <span class="free">G</span> <span class="bound">v</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> in_degree <span class="free">G</span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"euler_trail <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> euler_trail_def trail_def awalk_hd_in_verts<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">using</span></span> open_euler2<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span>
    <span class="quoted"><span class="quoted">"connected <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">w</span> <span class="main">∈</span> verts <span class="free">G</span><span class="main">;</span> <span class="skolem">u</span> <span class="main">≠</span> <span class="bound">w</span><span class="main">;</span> <span class="skolem">v</span> <span class="main">≠</span> <span class="bound">w</span><span class="main">⟧</span> <span class="main">⟹</span> in_degree <span class="free">G</span> <span class="bound">w</span> <span class="main">=</span> out_degree <span class="free">G</span> <span class="bound">w</span>"</span></span>
    <span class="quoted"><span class="quoted">"in_degree <span class="free">G</span> <span class="skolem">u</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> out_degree <span class="free">G</span> <span class="skolem">u</span>"</span></span>
    <span class="quoted"><span class="quoted">"out_degree <span class="free">G</span> <span class="skolem">v</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> in_degree <span class="free">G</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> open_euler1 <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>›</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Kuratowski">
<div class="head">
<h1>Theory Kuratowski</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:  Kuratowski.thy
    Author: Lars Noschinski, TU München
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Kuratowski
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Arc_Walk.html">Arc_Walk</a>
  <a href="Digraph_Component.html">Digraph_Component</a>
  <a href="Subdivision.html">Subdivision</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Rewrite.html">HOL-Library.Rewrite</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Kuratowski Subgraphs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We consider the underlying undirected graphs. The underlying undirected graph is represented as a
  symmetric digraph.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Public definitions›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">complete_digraph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">K⇘</span>_<span class="keyword1">⇙</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">complete_digraph</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> graph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> card <span class="main">(</span>verts <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> arcs_ends <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> verts <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">×</span> verts <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≠</span> <span class="bound">v</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">complete_bipartite_digraph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">K⇘</span>_<span class="keyword1">,</span>_<span class="keyword1">⇙</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">complete_bipartite_digraph</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> graph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> verts <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="bound">U</span> <span class="main">∪</span> <span class="bound">V</span> <span class="main">∧</span> <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span> <span class="main">=</span> <span class="main">{}</span>
    <span class="main">∧</span> card <span class="bound">U</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">∧</span> card <span class="bound">V</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> arcs_ends <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="bound">U</span> <span class="main">×</span> <span class="bound">V</span> <span class="main">∪</span> <span class="bound">V</span> <span class="main">×</span> <span class="bound">U</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">kuratowski_planar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">kuratowski_planar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">H</span><span class="main">.</span> subgraph <span class="bound">H</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">K</span> <span class="bound">rev_K</span> <span class="bound">rev_H</span><span class="main">.</span> subdivision <span class="main">(</span><span class="bound">K</span><span class="main">,</span> <span class="bound">rev_K</span><span class="main">)</span> <span class="main">(</span><span class="bound">H</span><span class="main">,</span> <span class="bound">rev_H</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>K<span class="hidden">⇘</span><sub><span class="numeral">3</span><span class="main">,</span><span class="numeral">3</span></sub><span class="hidden">⇙</span> <span class="bound">K</span> <span class="main">∨</span> K<span class="hidden">⇘</span><sub><span class="numeral">5</span></sub><span class="hidden">⇙</span> <span class="bound">K</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Kuratowski-complete_digraph_pair_def"><span class="command">lemma</span></span> complete_digraph_pair_def<span class="main">:</span> <span class="quoted"><span class="quoted">"K<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span>
  <span class="main">⟷</span> finite <span class="main">(</span>pverts <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> card <span class="main">(</span>pverts <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> parcs <span class="free">G</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>pverts <span class="free">G</span> <span class="main">×</span> pverts <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≠</span> <span class="bound">v</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"K<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> graph <span class="quoted"><span class="quoted">"with_proj <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complete_digraph_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">using</span></span> A finite_verts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complete_digraph_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>pverts <span class="free">G</span> <span class="main">×</span> pverts <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"parcs <span class="free">G</span> <span class="main">⊆</span> pverts <span class="free">G</span> <span class="main">×</span> pverts <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>parcs <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">interpret</span></span> pair_graph <span class="quoted"><span class="free">G</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  symmetric_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> symI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"K<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A finite_verts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complete_digraph_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-complete_bipartite_digraph_pair_def"><span class="command">lemma</span></span> complete_bipartite_digraph_pair_def<span class="main">:</span> <span class="quoted"><span class="quoted">"K<span class="hidden">⇘</span><sub><span class="free">m</span><span class="main">,</span><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span> <span class="main">⟷</span> finite <span class="main">(</span>pverts <span class="free">G</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> pverts <span class="free">G</span> <span class="main">=</span> <span class="bound">U</span> <span class="main">∪</span> <span class="bound">V</span> <span class="main">∧</span> <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> card <span class="bound">U</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> card <span class="bound">V</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> parcs <span class="free">G</span> <span class="main">=</span> <span class="bound">U</span> <span class="main">×</span> <span class="bound">V</span> <span class="main">∪</span> <span class="bound">V</span> <span class="main">×</span> <span class="bound">U</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"K<span class="hidden">⇘</span><sub><span class="free">m</span><span class="main">,</span><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> graph <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complete_bipartite_digraph_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">using</span></span> A finite_verts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complete_bipartite_digraph_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> pair_graph <span class="quoted"><span class="free">G</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complete_bipartite_digraph_def symmetric_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> symI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"K<span class="hidden">⇘</span><sub><span class="free">m</span><span class="main">,</span><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complete_bipartite_digraph_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-pair_graphI_complete"><span class="command">lemma</span></span> pair_graphI_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"K<span class="hidden">⇘</span><sub><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pair_graph <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">interpret</span></span> graph <span class="quoted"><span class="quoted">"with_proj <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complete_digraph_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pair_graph <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_arcs finite_verts sym_arcs wellformed no_loops <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-pair_graphI_complete_bipartite"><span class="command">lemma</span></span> pair_graphI_complete_bipartite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"K<span class="hidden">⇘</span><sub><span class="free">m</span><span class="main">,</span><span class="free">n</span></sub><span class="hidden">⇙</span> <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pair_graph <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">interpret</span></span> graph <span class="quoted"><span class="quoted">"with_proj <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complete_bipartite_digraph_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pair_graph <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_arcs finite_verts sym_arcs wellformed no_loops <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Inner vertices of a walk›</span></span>

<span class="keyword1"><span class="command">context</span></span> pre_digraph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> <span class="entity">inner_verts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> awalk <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inner_verts</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> tl <span class="main">(</span>map <span class="main">(</span>tail <span class="free">G</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Kuratowski-inner_verts_Nil"><span class="command">lemma</span></span> inner_verts_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inner_verts <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inner_verts_def<span class="main">)</span>

<span class="keyword1" id="Kuratowski-inner_verts_singleton"><span class="command">lemma</span></span> inner_verts_singleton<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inner_verts <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inner_verts_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> inner_verts_Cons<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="main">(</span><span class="free">e</span> <span class="main">#</span> <span class="free">es</span><span class="main">)</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inner_verts <span class="main">(</span><span class="free">e</span> <span class="main">#</span> <span class="free">es</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">es</span> <span class="main">≠</span> <span class="main">[]</span> <span class="keyword1">then</span> head <span class="free">G</span> <span class="free">e</span> <span class="main">#</span> inner_verts <span class="free">es</span> <span class="keyword1">else</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">es</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inner_verts_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> - <span class="main">)</span> inner_verts_with_proj_def<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pre_digraph.inner_verts <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> tl <span class="main">(</span>map fst <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pre_digraph.inner_verts_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Kuratowski-inner_verts_conv"><span class="command">lemma</span></span> inner_verts_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"inner_verts <span class="free">p</span> <span class="main">=</span> butlast <span class="main">(</span>tl <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inner_verts_def awalk_verts_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> inner_verts_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"length <span class="free">p</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inner_verts <span class="free">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inner_verts_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> set_inner_verts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>inner_verts <span class="free">p</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="free">p</span> <span class="main">&lt;</span> <span class="numeral">2</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inner_verts_conv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">u</span></span><span class="main"><span class="main">]</span></span> apath_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk_verts <span class="free">u</span> <span class="free">p</span> <span class="main">=</span> <span class="free">u</span> <span class="main">#</span> inner_verts <span class="free">p</span> <span class="main">@</span> <span class="main">[</span><span class="free">v</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms False length_awalk_verts<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> inner_verts_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"awalk_verts <span class="free">u</span> <span class="free">p</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def awalk_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-in_set_inner_verts_appendI_l"><span class="command">lemma</span></span> in_set_inner_verts_appendI_l<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> set <span class="main">(</span>inner_verts <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> set <span class="main">(</span>inner_verts <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inner_verts_def<span class="main">)</span>

<span class="keyword1" id="Kuratowski-in_set_inner_verts_appendI_r"><span class="command">lemma</span></span> in_set_inner_verts_appendI_r<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> set <span class="main">(</span>inner_verts <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> set <span class="main">(</span>inner_verts <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inner_verts_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> list_set_tl<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Progressing Walks›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We call a walk \emph{progressing} if it does not contain the sequence
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">[</span></span><span class="main"><span class="main">(</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">,</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">,</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. This concept is relevant in particular
  for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">iapath</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>s: If all of the inner vertices have degree at
  most 2 this implies that such a walk is a trail and even a path.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">progressing</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> awalk <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">progressing</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">xs</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">ys</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> <span class="bound">xs</span> <span class="main">@</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">#</span> <span class="bound">ys</span>"</span></span>

<span class="keyword1" id="Kuratowski-progressing_Nil"><span class="command">lemma</span></span> progressing_Nil<span class="main">:</span> <span class="quoted"><span class="quoted">"progressing <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> progressing_def<span class="main">)</span>

<span class="keyword1" id="Kuratowski-progressing_single"><span class="command">lemma</span></span> progressing_single<span class="main">:</span> <span class="quoted"><span class="quoted">"progressing <span class="main">[</span><span class="free">e</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> progressing_def<span class="main">)</span>

<span class="keyword1" id="Kuratowski-progressing_ConsD"><span class="command">lemma</span></span> progressing_ConsD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"progressing <span class="main">(</span><span class="free">e</span> <span class="main">#</span> <span class="free">es</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"progressing <span class="free">es</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> progressing_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> append_eq_Cons_conv<span class="main">)</span>

<span class="keyword1" id="Kuratowski-progressing_Cons"><span class="command">lemma</span></span> progressing_Cons<span class="main">:</span>
  <span class="quoted"><span class="quoted">"progressing <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span><span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>fst <span class="free">x</span> <span class="main">=</span> snd <span class="main">(</span>hd <span class="free">xs</span><span class="main">)</span> <span class="main">∧</span> snd <span class="free">x</span> <span class="main">=</span> fst <span class="main">(</span>hd <span class="free">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> progressing <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x'</span> <span class="skolem">xs'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="skolem">x'</span> <span class="main">#</span> <span class="skolem">xs'</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">@</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">xs'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> progressing_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>fst <span class="free">x</span> <span class="main">=</span> snd <span class="skolem">x'</span> <span class="main">∧</span> snd <span class="free">x</span> <span class="main">=</span> fst <span class="skolem">x'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> progressing_ConsD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> progressing_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cons_eq_append_conv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-progressing_Cons_Cons"><span class="command">lemma</span></span> progressing_Cons_Cons<span class="main">:</span>
  <span class="quoted"><span class="quoted">"progressing <span class="main">(</span><span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">#</span> <span class="free">es</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">u</span> <span class="main">≠</span> <span class="free">w</span> <span class="main">∧</span> progressing <span class="main">(</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">#</span> <span class="free">es</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> progressing_Cons<span class="main">)</span>

<span class="keyword1" id="Kuratowski-progressing_appendD1"><span class="command">lemma</span></span> progressing_appendD1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"progressing <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"progressing <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> progressing_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Cons append_assoc<span class="main">)</span>

<span class="keyword1" id="Kuratowski-progressing_appendD2"><span class="command">lemma</span></span> progressing_appendD2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"progressing <span class="main">(</span><span class="free">p</span> <span class="main">@</span> <span class="free">q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"progressing <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> progressing_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_assoc<span class="main">)</span>

<span class="keyword1" id="Kuratowski-progressing_rev_path"><span class="command">lemma</span></span> progressing_rev_path<span class="main">:</span>
  <span class="quoted"><span class="quoted">"progressing <span class="main">(</span>rev_path <span class="free">p</span><span class="main">)</span> <span class="main">=</span> progressing <span class="free">p</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> progressing_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI notI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">ys</span> <span class="skolem">l1</span> <span class="skolem">l2</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rev_path <span class="free">p</span> <span class="main">=</span> rev_path <span class="skolem">ys</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">#</span> rev_path <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> progressing_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> progressing_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI notI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xs</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">ys</span> <span class="skolem">l1</span> <span class="skolem">l2</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"rev_path <span class="free">p</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rev_path <span class="main">(</span>rev_path <span class="free">p</span><span class="main">)</span> <span class="main">=</span> rev_path <span class="skolem">ys</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">#</span> rev_path <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?R</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> progressing_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-progressing_append_iff"><span class="command">lemma</span></span> progressing_append_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"progressing <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">⟷</span> progressing <span class="free">xs</span> <span class="main">∧</span> progressing <span class="free">ys</span>
      <span class="main">∧</span> <span class="main">(</span><span class="free">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">ys</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="main">(</span>fst <span class="main">(</span>last <span class="free">xs</span><span class="main">)</span> <span class="main">≠</span> snd <span class="main">(</span>hd <span class="free">ys</span><span class="main">)</span> <span class="main">∨</span> snd <span class="main">(</span>last <span class="free">xs</span><span class="main">)</span> <span class="main">≠</span> fst <span class="main">(</span>hd <span class="free">ys</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> progressing_Nil<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y'</span> <span class="skolem">ys'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?R</span>"</span></span> <span class="main">=</span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> hd <span class="main">(</span>rev_path <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> prod.swap <span class="main">(</span>last <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"progressing <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="skolem">y'</span> <span class="main">#</span> <span class="skolem">ys'</span><span class="main">)</span> <span class="main">⟷</span> progressing <span class="main">(</span><span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y'</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">ys'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> progressing <span class="main">(</span><span class="skolem">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">y'</span><span class="main">]</span><span class="main">)</span> <span class="main">∧</span> progressing <span class="skolem">ys'</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ys'</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="main">(</span>fst <span class="skolem">y'</span> <span class="main">≠</span> snd <span class="main">(</span>hd <span class="skolem">ys'</span><span class="main">)</span> <span class="main">∨</span> snd <span class="skolem">y'</span> <span class="main">≠</span> fst <span class="main">(</span>hd <span class="skolem">ys'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Cons<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> progressing_Cons progressing_Nil progressing_rev_path<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> p<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">@</span> <span class="main">_</span>"</span></span><span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> * progressing_rev_path prod.swap_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Walks with Restricted Vertices›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">verts3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">verts3</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> verts <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="numeral">2</span> <span class="main">&lt;</span> in_degree <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">v</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A path were only the end nodes may be in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">V</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> <span class="entity">gen_iapath</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> awalk <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">gen_iapath</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∧</span> apath <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∧</span> set <span class="main">(</span>inner_verts <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pre_digraph<span class="main">)</span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">iapath</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> awalk <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">iapath</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> gen_iapath <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gen_contr_graph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'b</span><span class="main">)</span> pre_digraph <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> pair_pre_digraph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">gen_contr_graph</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> <span class="main">⦇</span>
     pverts <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">,</span>
     parcs <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> pre_digraph.gen_iapath <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="bound">u</span> <span class="bound">p</span> <span class="bound">v</span><span class="main">}</span>
     <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="entity">contr_graph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pair_pre_digraph <span class="main">⇒</span> <span class="tfree">'a</span> pair_pre_digraph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">contr_graph</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> gen_contr_graph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>verts3 <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties of subdivisions›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_sym_digraph<span class="main">)</span> verts3_subdivide<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∉</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span><span class="quoted"><span class="quoted">"verts3 <span class="main">(</span>subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> verts3 <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sG</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span>"</span></span> 
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> e_conv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">∉</span> pverts <span class="free">G</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> w_arcs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∉</span> parcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∉</span> parcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∉</span> parcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> parcs <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> wellformed<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> G_arcs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">∈</span> parcs <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arcs_symmetric<span class="main">)</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> pverts <span class="free">G</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">&lt;</span> in_degree <span class="free">G</span> <span class="bound">v</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">v</span></span> <span class="main">∈</span> pverts <span class="free">G</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">&lt;</span> in_degree <span class="var">?sG</span> <span class="bound">v</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> pverts <span class="free">G</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">card_eq</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">card_eq</span> <span class="skolem">x</span> <span class="main">⟷</span> in_degree <span class="var">?sG</span> <span class="skolem">x</span> <span class="main">=</span> in_degree <span class="free">G</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_arcs <span class="var">?sG</span> <span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span>in_arcs <span class="free">G</span> <span class="skolem">u</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">}</span>"</span></span>
           <span class="quoted"><span class="quoted">"in_arcs <span class="var">?sG</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>in_arcs <span class="free">G</span> <span class="skolem">v</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> w_arcs G_arcs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">card_eq</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">card_eq</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> card_eq_def in_degree_def <span class="keyword1"><span class="command">using</span></span> w_arcs G_arcs
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>in_arcs <span class="free">G</span> <span class="skolem">u</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_Suc_Diff1 <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> card_Diff_insert<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>in_arcs <span class="free">G</span> <span class="skolem">v</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_Suc_Diff1 <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> card_Diff_insert<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="main">{</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">}</span> <span class="main">⟹</span> in_arcs <span class="var">?sG</span> <span class="skolem">x</span> <span class="main">=</span> in_arcs <span class="free">G</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> pverts <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">∉</span> pverts <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="main">{</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">}</span> <span class="main">⟹</span> <span class="skolem">card_eq</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_degree_def card_eq_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">card_eq</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_degree <span class="free">G</span> <span class="skolem">x</span> <span class="main">=</span> in_degree <span class="var">?sG</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> card_eq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">v</span></span><span class="main">∈</span>pverts <span class="var">?sG</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">&lt;</span> in_degree <span class="var">?sG</span> <span class="bound">v</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_degree <span class="var">?sG</span> <span class="free">w</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_arcs <span class="var">?sG</span> <span class="free">w</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="free">w</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="free">w</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">∉</span> pverts <span class="free">G</span>›</span></span> G_arcs<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wellformed'<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> in_degree_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_insert_if<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> G_arcs assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> verts3_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-sd_path_Nil_iff"><span class="command">lemma</span></span> sd_path_Nil_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sd_path <span class="free">e</span> <span class="free">w</span> <span class="free">p</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">p</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sd_path.cases<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_sym_digraph<span class="main">)</span> gen_iapath_sd_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">e</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">w</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> elems<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∉</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_iapath <span class="free">V</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pre_digraph.gen_iapath <span class="main">(</span>subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span><span class="main">)</span> <span class="free">V</span> <span class="free">u</span> <span class="main">(</span>sd_path <span class="free">e</span> <span class="free">w</span> <span class="free">p</span><span class="main">)</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> e_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">interpret</span></span> S<span class="main">:</span> pair_sym_digraph <span class="quoted"><span class="quoted">"subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> elems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> pair_sym_digraph_subdivide<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> path <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_iapath_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> apath_sd<span class="main">:</span> <span class="quoted"><span class="quoted">"S.apath <span class="free">u</span> <span class="main">(</span>sd_path <span class="free">e</span> <span class="free">w</span> <span class="free">p</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    set_ev_sd<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>S.awalk_verts <span class="free">u</span> <span class="main">(</span>sd_path <span class="free">e</span> <span class="free">w</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">w</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> elems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> apath_sd_path set_awalk_verts_sd_path<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∉</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> elems <span class="quoted"><span class="quoted">‹apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def awalk_hd_in_verts awalk_last_in_verts<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>S.inner_verts <span class="main">(</span>sd_path <span class="free">e</span> <span class="free">w</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>S.awalk_verts <span class="free">u</span> <span class="main">(</span>sd_path <span class="free">e</span> <span class="free">w</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> apath_sd <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> S.set_inner_verts<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">w</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_ev_sd <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> set <span class="main">(</span>inner_verts <span class="free">p</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">w</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_inner_verts<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">∉</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>S.inner_verts <span class="main">(</span>sd_path <span class="free">e</span> <span class="free">w</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">⊆</span> <span class="main">(</span>set <span class="main">(</span>inner_verts <span class="free">p</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">w</span><span class="main">}</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> V <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> path elems V <span class="keyword1"><span class="command">unfolding</span></span> gen_iapath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> apath_sd elems path <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_iapath_def S.gen_iapath_def sd_path_Nil_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_sym_digraph<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> elems<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∉</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path<span class="main">:</span> <span class="quoted"><span class="quoted">"pre_digraph.gen_iapath <span class="main">(</span>subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span><span class="main">)</span> <span class="free">V</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> gen_iapath_co_path<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_iapath <span class="free">V</span> <span class="free">u</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="free">p</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis_path</span></span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> set_awalk_verts_co_path'<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">w</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?thesis_set</span></span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> S<span class="main">:</span> pair_sym_digraph <span class="quoted"><span class="quoted">"subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> elems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_sym_digraph_subdivide<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> pverts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> pverts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"S.apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> V path <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S.gen_iapath_def<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> co <span class="main">=</span> apath_co_path<span class="main">[</span><span class="operator">OF</span> elems uv<span class="main">]</span> set_awalk_verts_co_path<span class="main">[</span><span class="operator">OF</span> elems uv<span class="main">]</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis_set</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> co<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis_path</span></span></span> <span class="keyword1"><span class="command">using</span></span> co path <span class="keyword1"><span class="command">unfolding</span></span> gen_iapath_def S.gen_iapath_def <span class="keyword1"><span class="command">using</span></span> elems
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_inner_verts<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span><span class="main"><span class="main">]</span></span> S.set_inner_verts<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Pair Graphs›</span></span>

<span class="keyword1"><span class="command">context</span></span> pair_sym_digraph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Kuratowski-gen_iapath_rev_path"><span class="command">lemma</span></span> gen_iapath_rev_path<span class="main">:</span>
  <span class="quoted"><span class="quoted">"gen_iapath <span class="free">V</span> <span class="free">v</span> <span class="main">(</span>rev_path <span class="free">p</span><span class="main">)</span> <span class="free">u</span> <span class="main">=</span> gen_iapath <span class="free">V</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"gen_iapath <span class="free">V</span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"butlast <span class="main">(</span>tl <span class="main">(</span>awalk_verts <span class="skolem">v</span> <span class="main">(</span>rev_path <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rev <span class="main">(</span>butlast <span class="main">(</span>tl <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tl_rev butlast_rev butlast_tl awalk_verts_rev_path gen_iapath_def apath_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹gen_iapath <span class="free">V</span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gen_iapath <span class="free">V</span> <span class="skolem">v</span> <span class="main">(</span>rev_path <span class="skolem">p</span><span class="main">)</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_iapath_def apath_def inner_verts_conv<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> awalk_verts_rev_path<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> RL <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> RL <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> RL<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-inner_verts_rev_path"><span class="command">lemma</span></span> inner_verts_rev_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inner_verts <span class="main">(</span>rev_path <span class="free">p</span><span class="main">)</span> <span class="main">=</span> rev <span class="main">(</span>inner_verts <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms butlast_rev butlast_tl awalk_verts_rev_path inner_verts_conv tl_rev<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> pair_pseudo_graph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Kuratowski-apath_imp_progressing"><span class="command">lemma</span></span> apath_imp_progressing<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"progressing <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> progressing_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>apath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apath_append_iff apath_simps hd_in_awalk_verts<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-awalk_Cons_deg2_unique"><span class="command">lemma</span></span> awalk_Cons_deg2_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"in_degree <span class="free">G</span> <span class="free">u</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u1</span> <span class="main">(</span><span class="free">e1</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u2</span> <span class="main">(</span><span class="free">e2</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"progressing <span class="main">(</span><span class="free">e1</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"progressing <span class="main">(</span><span class="free">e2</span> <span class="main">#</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">=</span> <span class="free">e2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">e</span> <span class="skolem">es</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">≠</span> <span class="free">e2</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> snd <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> e_unf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>›</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_simps<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ei_unf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e1</span> <span class="main">=</span> <span class="main">(</span><span class="free">u1</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e2</span> <span class="main">=</span> <span class="main">(</span><span class="free">u2</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Cons assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_simps prod_eqI<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons assms <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e1</span> <span class="main">≠</span> <span class="free">e2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u1</span> <span class="main">≠</span> <span class="free">u2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="free">u1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="free">u2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> progressing_Cons_Cons<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="free">u1</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">u2</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> parcs <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> e_unf ei_unf Cons assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_simps <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> arcs_symmetric<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>in_arcs <span class="free">G</span> <span class="free">u</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="free">u1</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">u2</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> in_arcs <span class="free">G</span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="free">u1</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">u2</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">≤</span> in_degree <span class="free">G</span> <span class="free">u</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> in_degree_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main">)</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹in_degree <span class="free">G</span> <span class="free">u</span> <span class="main">≤</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span><span class="main">)</span>

<span class="keyword1" id="Kuratowski-same_awalk_by_same_end"><span class="command">lemma</span></span> same_awalk_by_same_end<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"verts3 <span class="free">G</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> pverts <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> walk<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">q</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">p</span> <span class="main">=</span> hd <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> progress<span class="main">:</span> <span class="quoted"><span class="quoted">"progressing <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"progressing <span class="free">q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> tail<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> inner_verts<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>inner_verts <span class="free">p</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="quoted"><span class="quoted">"set <span class="main">(</span>inner_verts <span class="free">q</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> walk progress inner_verts
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main"><span class="main">[</span></span><span class="operator">case_names</span> Nil_Nil Cons_Nil Nil_Cons Cons_Cons<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons_Cons <span class="skolem">a</span> <span class="skolem">as</span> <span class="skolem">b</span> <span class="skolem">bs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹hd <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="main">_</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">_</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">as</span> <span class="skolem">v</span> <span class="skolem">b</span> <span class="skolem">bs</span> <span class="skolem">w</span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">u</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">u</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span> <span class="skolem">w</span>"</span></span>
        <span class="quoted"><span class="quoted">"set <span class="main">(</span>inner_verts <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inner_verts_Cons awalk_simps<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> Nil_imp_Nil <span class="main">=</span> this

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons_Cons.prems <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>›</span></span> tail <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_imp_Nil<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons_Cons.prems <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>›</span></span> tail <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_imp_Nil<span class="main">)</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">as'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">as</span> <span class="main">=</span> <span class="skolem">a'</span> <span class="main">#</span> <span class="skolem">as'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">as</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">as</span></span><span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="skolem"><span class="skolem">bs'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">bs</span> <span class="main">=</span> <span class="skolem">b'</span> <span class="main">#</span> <span class="skolem">bs'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">bs</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">bs</span></span><span class="main">)</span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?arcs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>fst <span class="skolem">a</span><span class="main">,</span> snd <span class="skolem">a</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>snd <span class="skolem">a'</span><span class="main">,</span> snd <span class="skolem">a</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>snd <span class="skolem">b'</span><span class="main">,</span> snd <span class="skolem">a</span><span class="main">)</span><span class="main">}</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span>fst <span class="skolem">a</span><span class="main">,</span> snd <span class="skolem">a'</span><span class="main">,</span> snd <span class="skolem">b'</span><span class="main">}</span> <span class="main">=</span> card <span class="main">(</span>fst <span class="main">`</span> <span class="var">?arcs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="var">?arcs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_image<span class="main">)</span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> in_degree <span class="free">G</span> <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?arcs</span> <span class="main">⊆</span> in_arcs <span class="free">G</span> <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹progressing <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹progressing <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="main">_</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">_</span>›</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="main">_</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span> <span class="main">_</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">as</span> <span class="main">=</span> <span class="main">_</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">bs</span> <span class="main">=</span> <span class="main">_</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a'</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> progressing_Cons_Cons awalk_simps <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> arcs_symmetric<span class="main">)</span> 
      <span class="keyword1"><span class="command">with</span></span> _<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> in_degree_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">a</span> <span class="main">∉</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">a</span> <span class="main">∈</span> pverts <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Cons_Cons.prems <span class="quoted"><span class="quoted">‹<span class="skolem">as</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inner_verts_Cons<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> V <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> verts3_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">a</span> <span class="main">=</span> snd <span class="skolem">a'</span> <span class="main">∨</span> fst <span class="skolem">a</span> <span class="main">=</span> snd <span class="skolem">b'</span> <span class="main">∨</span> snd <span class="skolem">a'</span> <span class="main">=</span> snd <span class="skolem">b'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_insert_if <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">as</span> <span class="main">=</span> hd <span class="skolem">bs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹progressing <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹progressing <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="main">_</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">as</span><span class="main">)</span> <span class="main">_</span>›</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="main">_</span> <span class="main">(</span><span class="skolem">b</span> <span class="main">#</span> <span class="skolem">bs</span><span class="main">)</span> <span class="main">_</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">as</span> <span class="main">=</span> <span class="main">_</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">bs</span> <span class="main">=</span> <span class="main">_</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">b'</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> progressing_Cons_Cons awalk_simps<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">as</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">bs</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> Cons_Cons.prems
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> progressing_ConsD <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_simps inner_verts_Cons <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Cons_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Kuratowski-same_awalk_by_common_arc"><span class="command">lemma</span></span> same_awalk_by_common_arc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"verts3 <span class="free">G</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> walk<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">w</span> <span class="free">q</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> progress<span class="main">:</span> <span class="quoted"><span class="quoted">"progressing <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"progressing <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> iv_not_in_V<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>inner_verts <span class="free">p</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>inner_verts <span class="free">q</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ends_in_V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> arcs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> set <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> arcs <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">p1</span> <span class="main">@</span> <span class="free">e</span> <span class="main">#</span> <span class="skolem">p2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_decomp_first<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> arcs <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q1</span></span> <span class="skolem"><span class="skolem">q2</span></span> <span class="keyword2"><span class="keyword">where</span></span> q_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="skolem">q1</span> <span class="main">@</span> <span class="free">e</span> <span class="main">#</span> <span class="skolem">q2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_set_conv_decomp_first<span class="main">)</span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p1'</span></span> <span class="skolem"><span class="skolem">q1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1'</span> <span class="main">=</span> rev_path <span class="main">(</span><span class="skolem">p1</span> <span class="main">@</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1'</span> <span class="main">=</span> rev_path <span class="main">(</span><span class="skolem">q1</span> <span class="main">@</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> rev_path <span class="skolem">p1'</span> <span class="main">@</span> <span class="skolem">p2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> rev_path <span class="skolem">q1'</span> <span class="main">@</span> <span class="skolem">q2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"awlast <span class="free">u</span> <span class="main">(</span>rev_path <span class="skolem">p1'</span><span class="main">)</span> <span class="main">=</span> snd <span class="free">e</span>"</span></span> <span class="quoted"><span class="quoted">"awlast <span class="free">w</span> <span class="main">(</span>rev_path <span class="skolem">q1'</span><span class="main">)</span> <span class="main">=</span> snd <span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p_decomp q_decomp walk <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awlast_append awalk_verts_rev_path<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> walk'<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="main">(</span>snd <span class="free">e</span><span class="main">)</span> <span class="skolem">p1'</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="main">(</span>snd <span class="free">e</span><span class="main">)</span> <span class="skolem">q1'</span> <span class="free">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> walk <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">p1'</span> <span class="main">=</span> hd <span class="skolem">q1'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q1'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p1'_def q1'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"progressing <span class="skolem">p1'</span>"</span></span> <span class="quoted"><span class="quoted">"progressing <span class="skolem">q1'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> progress <span class="keyword1"><span class="command">unfolding</span></span> decomp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> progressing_appendD1 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> progressing_rev_path<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>inner_verts <span class="main">(</span>rev_path <span class="skolem">p1'</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>inner_verts <span class="main">(</span>rev_path <span class="skolem">q1'</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> iv_not_in_V <span class="keyword1"><span class="command">unfolding</span></span> decomp
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> in_set_inner_verts_appendI_l in_set_inner_verts_appendI_r<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>inner_verts <span class="skolem">p1'</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>inner_verts <span class="skolem">q1'</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ends_in_V iv_not_in_V walk <span class="keyword1"><span class="command">unfolding</span></span> decomp
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inner_verts_rev_path<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1'</span> <span class="main">=</span> <span class="skolem">q1'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> same_awalk_by_same_end<span class="main"><span class="main">[</span></span><span class="operator">OF</span> V<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">p2'</span></span> <span class="skolem"><span class="skolem">q2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p2'</span> <span class="main">=</span> <span class="free">e</span> <span class="main">#</span> <span class="skolem">p2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2'</span> <span class="main">=</span> <span class="free">e</span> <span class="main">#</span> <span class="skolem">q2</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">p1</span> <span class="main">@</span> <span class="skolem">p2'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="skolem">q1</span> <span class="main">@</span> <span class="skolem">q2'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p_decomp q_decomp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awlast_append<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awlast <span class="free">u</span> <span class="skolem">p1</span> <span class="main">=</span> fst <span class="free">e</span>"</span></span> <span class="quoted"><span class="quoted">"awlast <span class="free">w</span> <span class="skolem">q1</span> <span class="main">=</span> fst <span class="free">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p_decomp q_decomp walk <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="main">(</span>fst <span class="free">e</span><span class="main">)</span> <span class="skolem">p2'</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="main">(</span>fst <span class="free">e</span><span class="main">)</span> <span class="skolem">q2'</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> walk <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">p2'</span> <span class="main">=</span> hd <span class="skolem">q2'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p2'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2'</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> p2'_def q2'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"progressing <span class="skolem">p2'</span>"</span></span> <span class="quoted"><span class="quoted">"progressing <span class="skolem">q2'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> progress <span class="keyword1"><span class="command">unfolding</span></span> decomp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> progressing_appendD2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>inner_verts <span class="skolem">p2'</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>inner_verts <span class="skolem">q2'</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ends_in_V iv_not_in_V <span class="keyword1"><span class="command">unfolding</span></span> decomp
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> in_set_inner_verts_appendI_l in_set_inner_verts_appendI_r<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p2'</span> <span class="main">=</span> <span class="skolem">q2'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> same_awalk_by_same_end<span class="main"><span class="main">[</span></span><span class="operator">OF</span> V<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_decomp q_decomp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rev_path_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-same_gen_iapath_by_common_arc"><span class="command">lemma</span></span> same_gen_iapath_by_common_arc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"verts3 <span class="free">G</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> path<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_iapath <span class="free">V</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"gen_iapath <span class="free">V</span> <span class="free">w</span> <span class="free">q</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> arcs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> set <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> path <span class="keyword1"><span class="command">have</span></span> awalk<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">w</span> <span class="free">q</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"progressing <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"progressing <span class="free">q</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> in_V<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>inner_verts <span class="free">p</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>inner_verts <span class="free">q</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">,</span><span class="free">w</span><span class="main">,</span><span class="free">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_iapath_def apath_imp_progressing apath_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> V awalk in_V arcs <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> same_awalk_by_common_arc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Slim graphs›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We define the notion of a slim graph. The idea is that for a slim graph <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  is a subdivision of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"contr_graph <span class="free"><span class="free">G</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">context</span></span> pair_pre_digraph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_pre_digraph<span class="main">)</span> <span class="entity">is_slim</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_slim</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> pverts <span class="free">G</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∨</span>
      in_degree <span class="free">G</span> <span class="bound">v</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">p</span> <span class="bound">y</span><span class="main">.</span> gen_iapath <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="bound">x</span> <span class="bound">p</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="bound">x</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> parcs <span class="free">G</span><span class="main">.</span> fst <span class="bound">e</span> <span class="main">≠</span> snd <span class="bound">e</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">p</span> <span class="bound">y</span><span class="main">.</span> gen_iapath <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="bound">x</span> <span class="bound">p</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">e</span> <span class="main">∈</span> set <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="bound">v</span> <span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span>gen_iapath <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="bound">u</span> <span class="bound">p</span> <span class="bound">v</span> <span class="main">∧</span> gen_iapath <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="bound">u</span> <span class="bound">q</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">p</span> <span class="main">=</span> <span class="bound">q</span><span class="main">)</span> <span class="main">∧</span>
    <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">⊆</span> pverts <span class="free">G</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">direct_arc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">direct_arc</span> <span class="free"><span class="bound"><span class="entity">uv</span></span></span> <span class="main">≡</span> <span class="keyword1">SOME</span> <span class="bound">e</span><span class="main">.</span> <span class="main">{</span>fst <span class="free"><span class="bound"><span class="entity">uv</span></span></span> <span class="main">,</span> snd <span class="free"><span class="bound"><span class="entity">uv</span></span></span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span>fst <span class="bound">e</span><span class="main">,</span> snd <span class="bound">e</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">choose_iapath</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> awalk"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">choose_iapath</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">let</span>
      <span class="bound">chosen_path</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="keyword1">SOME</span> <span class="bound">p</span><span class="main">.</span> iapath <span class="bound">u</span> <span class="bound">p</span> <span class="bound">v</span><span class="main">)</span>
    <span class="keyword1">in</span> <span class="keyword1">if</span> direct_arc <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="bound">chosen_path</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="keyword1">else</span> rev_path <span class="main">(</span><span class="bound">chosen_path</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(* XXX: Replace "parcs (contr_graph G)" by its definition *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">slim_paths</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> awalk <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">slim_paths</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="main">(</span>fst <span class="bound">e</span><span class="main">,</span> choose_iapath <span class="main">(</span>fst <span class="bound">e</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">e</span><span class="main">)</span><span class="main">,</span> snd <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> parcs <span class="main">(</span>contr_graph <span class="free">G</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">slim_verts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">slim_verts</span> <span class="main">≡</span> verts3 <span class="free">G</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">,</span><span class="main"><span class="bound">_</span></span><span class="main">)</span> <span class="main">∈</span> slim_paths<span class="main">.</span> set <span class="main">(</span>awalk_verts <span class="bound">u</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">slim_arcs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rel"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">slim_arcs</span> <span class="main">≡</span> <span class="main">⋃</span><span class="main">(</span><span class="main"><span class="bound">_</span></span><span class="main">,</span><span class="bound">p</span><span class="main">,</span><span class="main"><span class="bound">_</span></span><span class="main">)</span> <span class="main">∈</span> slim_paths<span class="main">.</span> set <span class="bound">p</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Computes a slim subgraph for an arbitrary <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">pair_digraph</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">slim</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pair_pre_digraph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">slim</span> <span class="main">≡</span> <span class="main">⦇</span> pverts <span class="main">=</span> slim_verts<span class="main">,</span> parcs <span class="main">=</span> slim_arcs <span class="main">⦈</span>"</span></span> 

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_digraph<span class="main">)</span> iapath_dist_ends<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span> <span class="bound">p</span> <span class="bound">v</span><span class="main">.</span> iapath <span class="bound">u</span> <span class="bound">p</span> <span class="bound">v</span> <span class="main">⟹</span> <span class="bound">u</span> <span class="main">≠</span> <span class="bound">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> pre_digraph.gen_iapath_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> apath_ends<span class="main">)</span>


<span class="keyword1"><span class="command">context</span></span> pair_sym_digraph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Kuratowski-choose_iapath"><span class="command">lemma</span></span> choose_iapath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> iapath <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"iapath <span class="free">u</span> <span class="main">(</span>choose_iapath <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"direct_arc <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">chosen</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">chosen</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">p</span><span class="main">.</span> iapath <span class="skolem">u</span> <span class="bound">p</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span> <span class="skolem">v</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"iapath <span class="free">u</span> <span class="main">(</span><span class="skolem">chosen</span> <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> chosen_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> choose_iapath_def chosen_def<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"iapath <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"iapath <span class="free">v</span> <span class="main">(</span>rev_path <span class="skolem">p</span><span class="main">)</span> <span class="free">u</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_iapath_rev_path<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"iapath <span class="free">v</span> <span class="main">(</span><span class="skolem">chosen</span> <span class="free">v</span> <span class="free">u</span><span class="main">)</span> <span class="free">u</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> chosen_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> choose_iapath_def chosen_def gen_iapath_rev_path<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-slim_simps"><span class="command">lemma</span></span> slim_simps<span class="main">:</span> <span class="quoted"><span class="quoted">"pverts slim <span class="main">=</span> slim_verts"</span></span> <span class="quoted"><span class="quoted">"parcs slim <span class="main">=</span> slim_arcs"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> slim_def<span class="main">)</span>

<span class="keyword1" id="Kuratowski-slim_paths_in_G_E"><span class="command">lemma</span></span> slim_paths_in_G_E<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> slim_paths"</span></span> <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"iapath <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms choose_iapath
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_contr_graph_def slim_paths_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> iapath_dist_ends<span class="main">)</span>

<span class="keyword1" id="Kuratowski-verts_slim_in_G"><span class="command">lemma</span></span> verts_slim_in_G<span class="main">:</span> <span class="quoted"><span class="quoted">"pverts slim <span class="main">⊆</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> slim_simps slim_verts_def verts3_def gen_iapath_def apath_def
    <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> slim_paths_in_G_E <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> awalkE<span class="main">)</span>

<span class="keyword1" id="Kuratowski-verts3_in_slim_G"><span class="command">lemma</span></span> verts3_in_slim_G<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> verts3 <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> pverts slim"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> slim_simps slim_verts_def<span class="main">)</span>

<span class="keyword1" id="Kuratowski-arcs_slim_in_G"><span class="command">lemma</span></span> arcs_slim_in_G<span class="main">:</span> <span class="quoted"><span class="quoted">"parcs slim <span class="main">⊆</span> parcs <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> slim_simps slim_arcs_def gen_iapath_def apath_def
      <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> slim_paths_in_G_E <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> awalkE<span class="main">)</span>

<span class="keyword1" id="Kuratowski-slim_paths_in_slimG"><span class="command">lemma</span></span> slim_paths_in_slimG<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">p</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> slim_paths"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"pre_digraph.gen_iapath slim <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> arcs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span> <span class="bound">e</span> <span class="main">∈</span> parcs slim"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> slim_simps slim_arcs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gen_iapath <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_iapath_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> slim_paths_in_G_E<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.gen_iapath_def pre_digraph.apath_def pre_digraph.awalk_def
      inner_verts_with_proj_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-direct_arc_swapped"><span class="command">lemma</span></span> direct_arc_swapped<span class="main">:</span>
  <span class="quoted"><span class="quoted">"direct_arc <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">=</span> direct_arc <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> direct_arc_def insert_commute<span class="main">)</span>

<span class="keyword1" id="Kuratowski-direct_arc_chooses"><span class="command">lemma</span></span> direct_arc_chooses<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">u</span> <span class="free">v</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"direct_arc <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∨</span> direct_arc <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span>"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">X</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">e</span><span class="main">.</span> <span class="skolem">X</span> <span class="main">=</span> <span class="main">{</span>fst <span class="bound">e</span><span class="main">,</span>snd <span class="bound">e</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">.</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span>fst <span class="bound">p</span><span class="main">,</span> snd <span class="bound">p</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="free"><span class="free"><span class="free">u</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="free"><span class="free"><span class="free">v</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span>fst <span class="main">(</span><span class="skolem">f</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span><span class="main">)</span><span class="main">,</span> snd <span class="main">(</span><span class="skolem">f</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">f</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> doubleton_eq_iff prod_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> direct_arc_def f_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-rev_path_choose_iapath"><span class="command">lemma</span></span> rev_path_choose_iapath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rev_path <span class="main">(</span>choose_iapath <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> choose_iapath <span class="free">v</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms direct_arc_chooses<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> choose_iapath_def direct_arc_swapped<span class="main">)</span>

<span class="keyword1" id="Kuratowski-no_loops_in_iapath"><span class="command">lemma</span></span> no_loops_in_iapath<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_iapath <span class="free">V</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> set <span class="free">p</span> <span class="main">⟹</span> fst <span class="free">a</span> <span class="main">≠</span> snd <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_iapath_def no_loops_in_apath<span class="main">)</span>

<span class="keyword1" id="Kuratowski-pair_bidirected_digraph_slim"><span class="command">lemma</span></span> pair_bidirected_digraph_slim<span class="main">:</span> <span class="quoted"><span class="quoted">"pair_bidirected_digraph slim"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> parcs slim"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> slim_paths"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> slim_simps slim_arcs_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"iapath <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> slim_paths_in_G_E<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">∈</span> set <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">e</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">e</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_awalk_verts gen_iapath_def apath_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>  
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">_</span> <span class="main">∈</span> slim_paths›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">⊆</span> pverts slim"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> slim_simps slim_verts_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">e</span> <span class="main">∈</span> pverts slim"</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">e</span> <span class="main">∈</span> pverts slim"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">e</span> <span class="main">≠</span> snd <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹iapath <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">∈</span> set <span class="skolem">p</span> ›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> no_loops_in_iapath<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> parcs slim"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> slim_paths"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> slim_simps slim_arcs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"iapath <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> slim_paths_in_G_E<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"iapath <span class="skolem">v</span> <span class="main">(</span>rev_path <span class="skolem">p</span><span class="main">)</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"rev_path <span class="skolem">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_iapath_rev_path<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="main">(</span>contr_graph <span class="free">G</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_contr_graph_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹iapath <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_iapath_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> apath_nonempty_ends<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span> rev_path <span class="skolem">p</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> slim_paths"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> slim_paths_def rev_path_choose_iapath <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">∈</span> set <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">e</span><span class="main">,</span> fst <span class="skolem">e</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>rev_path <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">e</span><span class="main">,</span> fst <span class="skolem">e</span><span class="main">)</span> <span class="main">∈</span> parcs slim"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> slim_simps slim_arcs_def<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"symmetric slim"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> symmetric_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> fst_conv snd_conv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_pseudo_graph<span class="main">)</span> pair_graph_slim<span class="main">:</span> <span class="quoted"><span class="quoted">"pair_graph slim"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> slim<span class="main">:</span> pair_bidirected_digraph <span class="quoted">slim</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_bidirected_digraph_slim<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>pverts slim<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> verts_slim_in_G finite_verts <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>parcs slim<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> arcs_slim_in_G finite_arcs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-subgraph_slim"><span class="command">lemma</span></span> subgraph_slim<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph slim <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> subgraphI<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> pair_bidirected_digraph <span class="quoted"><span class="quoted">"slim"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_bidirected_digraph_slim<span class="main">)</span> <span class="operator">intro_locales</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"verts slim <span class="main">⊆</span> verts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"arcs slim <span class="main">⊆</span> arcs <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> verts_slim_in_G arcs_slim_in_G<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"compatible <span class="free">G</span> slim"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf_digraph slim"</span></span> <span class="quoted"><span class="quoted">"wf_digraph <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-giapath_if_slim_giapath"><span class="command">lemma</span></span> giapath_if_slim_giapath<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pre_digraph.gen_iapath slim <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gen_iapath <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms verts_slim_in_G arcs_slim_in_G
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.gen_iapath_def pre_digraph.apath_def pre_digraph.awalk_def
  inner_verts_with_proj_def<span class="main">)</span>

<span class="keyword1" id="Kuratowski-slim_giapath_if_giapath"><span class="command">lemma</span></span> slim_giapath_if_giapath<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"gen_iapath <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> pre_digraph.gen_iapath slim <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span> <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">p</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> choose_arcs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> set <span class="main">(</span>choose_iapath <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">e</span> <span class="main">∈</span> parcs slim"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> slim_simps slim_arcs_def slim_paths_def gen_contr_graph_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> choose<span class="main">:</span> <span class="quoted"><span class="quoted">"iapath <span class="free">u</span> <span class="main">(</span>choose_iapath <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> choose_iapath<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_iapath_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>choose_iapath <span class="free">u</span> <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_digraph.gen_iapath_def pre_digraph.apath_def pre_digraph.awalk_def
      inner_verts_with_proj_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-contr_graph_slim_eq"><span class="command">lemma</span></span> contr_graph_slim_eq<span class="main">:</span>
   <span class="quoted"><span class="quoted">"gen_contr_graph slim <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span> <span class="main">=</span> contr_graph <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> giapath_if_slim_giapath slim_giapath_if_giapath <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_contr_graph_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> pair_pseudo_graph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Kuratowski-verts3_slim_in_verts3"><span class="command">lemma</span></span> verts3_slim_in_verts3<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts3 slim"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts3 <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">&lt;</span> in_degree slim <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> verts3_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> in_degree <span class="free">G</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> subgraph_slim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subgraph_in_degree<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms subgraph_slim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> verts3_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-slim_is_slim"><span class="command">lemma</span></span> slim_is_slim<span class="main">:</span>
  <span class="quoted"><span class="quoted">"pair_pre_digraph.is_slim slim <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> pair_pre_digraph.is_slim_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> S<span class="main">:</span> pair_graph <span class="quoted">slim</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_graph_slim<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> pverts slim"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> verts3 <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_degree <span class="free">G</span> <span class="skolem">v</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> verts_slim_in_G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> verts3_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"in_degree slim <span class="skolem">v</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> subgraph_in_degree<span class="main">[</span><span class="operator">OF</span> subgraph_slim<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> pverts slim"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∉</span> verts3 <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> upv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> slim_paths"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="skolem">u</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> slim_simps slim_verts_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"S.gen_iapath <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> slim_paths_in_slimG <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="bound">q</span> <span class="bound">y</span><span class="main">.</span> S.gen_iapath <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">q</span> <span class="bound">y</span>
      <span class="main">∧</span> <span class="skolem">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="bound">x</span> <span class="bound">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> parcs slim"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">p</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> slim_paths"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> slim_simps slim_arcs_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"S.gen_iapath <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">p</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> slim_paths_in_slimG <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="bound">p</span> <span class="bound">y</span><span class="main">.</span> S.gen_iapath <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">p</span> <span class="bound">y</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="bound">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> parcs slim"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> snd <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S.no_loops'<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">p</span> <span class="skolem">q</span>
    <span class="keyword3"><span class="command">assume</span></span> paths<span class="main">:</span> <span class="quoted"><span class="quoted">"S.gen_iapath <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>"</span></span>
          <span class="quoted"><span class="quoted">"S.gen_iapath <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span> <span class="skolem">u</span> <span class="skolem">q</span> <span class="skolem">v</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"verts3 slim <span class="main">⊆</span> verts3 <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"verts3 <span class="free">G</span> <span class="main">⊆</span> pverts slim"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> verts3_slim_in_verts3<span class="main">)</span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="skolem">q</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> paths
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S.gen_iapath_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> S.apath_ends<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> path<span class="main">:</span> <span class="quoted"><span class="quoted">"S.gen_iapath <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> last_in_set<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> parcs slim"</span></span> <span class="keyword1"><span class="command">using</span></span> path <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S.gen_iapath_def S.apath_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> slim_paths"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> set <span class="skolem">r</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> slim_simps slim_arcs_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"S.gen_iapath <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">r</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> slim_paths_in_slimG<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">∈</span> set <span class="skolem">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">∈</span> set <span class="skolem">p</span>›</span></span> path <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">r</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> S.same_gen_iapath_by_common_arc<span class="main"><span class="main">[</span></span><span class="operator">OF</span> V<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> path <span class="quoted"><span class="quoted">‹S.gen_iapath <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">r</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> S.gen_iapath_def S.apath_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> S.awalk_ends<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> slim_paths"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> slim_paths›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">note</span></span> obt <span class="main">=</span> this
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">≠</span> <span class="main">[]</span>›</span></span> paths <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> slim_paths"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> slim_paths"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> obt<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> slim_paths_def<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> pair_sym_digraph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_iapath <span class="main">(</span>pverts <span class="free">G</span><span class="main">)</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> gen_iapath_triv_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">]</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> gen_iapath_triv_arc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>inner_verts <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">B</span> <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">.</span> <span class="main">⟦</span><span class="bound">A</span> <span class="main">⊆</span> <span class="bound">B</span><span class="main">;</span> <span class="bound">A</span> <span class="main">∩</span> <span class="bound">B</span> <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>inner_verts <span class="free">p</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_inner_verts gen_iapath_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> pverts <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">unfolding</span></span> gen_iapath_def apath_def awalk_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> *<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_iapath_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inner_verts <span class="free">p</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_iapath_def apath_def inner_verts_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_iapath_def apath_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-gen_contr_triv"><span class="command">lemma</span></span> gen_contr_triv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_slim <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"pverts <span class="free">G</span> <span class="main">=</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gen_contr_graph <span class="free">G</span> <span class="free">V</span> <span class="main">=</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?gcg</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"gen_contr_graph <span class="free">G</span> <span class="free">V</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pverts <span class="var">?gcg</span> <span class="main">=</span> pverts <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_contr_graph_def is_slim_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"parcs <span class="var">?gcg</span> <span class="main">=</span> parcs <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="var">?gcg</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"gen_iapath <span class="free">V</span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_contr_graph_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> gen_iapath_triv_arc <span class="quoted"><span class="quoted">‹pverts <span class="free">G</span> <span class="main">=</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> path<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_iapath <span class="free">V</span> <span class="skolem">x</span> <span class="skolem">p</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_slim_def<span class="main">)</span>                              
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹pverts <span class="free">G</span> <span class="main">=</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> gen_iapath_triv_path<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="var">?gcg</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> path <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_contr_graph_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?gcg</span> <span class="main">=</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-is_slim_no_loops"><span class="command">lemma</span></span> is_slim_no_loops<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_slim <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"fst <span class="free">a</span> <span class="main">≠</span> snd <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_slim_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Contraction Preserves Kuratowski-Subgraph-Property›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_pseudo_graph<span class="main">)</span> in_degree_contr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"verts3 <span class="free">G</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"in_degree <span class="main">(</span>gen_contr_graph <span class="free">G</span> <span class="free">V</span><span class="main">)</span> <span class="free">v</span> <span class="main">≤</span> in_degree <span class="free">G</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> gen_iapath <span class="free">V</span> <span class="bound">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> gen_iapath <span class="free">V</span> <span class="bound">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">,</span><span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> apath <span class="bound">u</span> <span class="bound">p</span> <span class="bound">v</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_iapath_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> apaths_finite_triple <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_surj<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> io_snd<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on snd <span class="main">{</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">.</span> gen_iapath <span class="free">V</span> <span class="bound">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_iapath_def apath_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> awalk_ends<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> io_last<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on last <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">.</span> gen_iapath <span class="free">V</span> <span class="bound">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> inj_onI<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u1</span> <span class="skolem">u2</span> <span class="skolem">p1</span> <span class="skolem">p2</span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"last <span class="skolem">p1</span> <span class="main">=</span> last <span class="skolem">p2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_iapath <span class="free">V</span> <span class="skolem">u1</span> <span class="skolem">p1</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"gen_iapath <span class="free">V</span> <span class="skolem">u2</span> <span class="skolem">p2</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">p1</span> <span class="main">∈</span> set <span class="skolem">p1</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">p2</span> <span class="main">∈</span> set <span class="skolem">p2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_iapath_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">p1</span> <span class="main">∈</span> set <span class="skolem">p1</span>"</span></span> <span class="quoted"><span class="quoted">"last <span class="skolem">p1</span> <span class="main">∈</span> set <span class="skolem">p2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">with</span></span> V<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> B <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">=</span> <span class="skolem">p2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> same_gen_iapath_by_common_arc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_degree <span class="main">(</span>gen_contr_graph <span class="free">G</span> <span class="free">V</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">.</span> gen_iapath <span class="free">V</span> <span class="bound">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_arcs <span class="main">(</span>gen_contr_graph <span class="free">G</span> <span class="free">V</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">.</span> gen_iapath <span class="free">V</span> <span class="bound">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_contr_graph_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> in_degree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> card <span class="main">{</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">.</span> gen_iapath <span class="free">V</span> <span class="bound">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_image_le<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="main">(</span>snd <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">.</span> gen_iapath <span class="free">V</span> <span class="bound">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> io_snd <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_image<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span><span class="main">.</span> gen_iapath <span class="free">V</span> <span class="bound">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">.</span> gen_iapath <span class="free">V</span> <span class="bound">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rev_image_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">…</span> <span class="main">=</span> card <span class="main">(</span>last <span class="main">`</span> <span class="main">...</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> io_last <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_image<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> in_degree <span class="free">G</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> in_degree_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"last <span class="main">`</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">.</span> gen_iapath <span class="free">V</span> <span class="bound">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span> <span class="main">⊆</span> in_arcs <span class="free">G</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span> <span class="bound">p</span><span class="main">.</span> awalk <span class="bound">u</span> <span class="bound">p</span> <span class="free">v</span> <span class="main">⟹</span> <span class="bound">p</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> last <span class="bound">p</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> 
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">u</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>last <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_simps<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> in_arcs_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_iapath_def apath_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_graph<span class="main">)</span> contracted_no_degree2_simp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subd<span class="main">:</span> <span class="quoted"><span class="quoted">"subdivision_pair <span class="free">G</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> two_less_deg2<span class="main">:</span> <span class="quoted"><span class="quoted">"verts3 <span class="free">G</span> <span class="main">=</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"contr_graph <span class="free">H</span> <span class="main">=</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> subd
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> subdivision_pair_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> base

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gen_iapath <span class="main">(</span>pverts <span class="free">G</span><span class="main">)</span> <span class="main">(</span>fst <span class="skolem">e</span><span class="main">)</span> <span class="main">[</span><span class="main">(</span>fst <span class="skolem">e</span><span class="main">,</span> snd <span class="skolem">e</span><span class="main">)</span><span class="main">]</span> <span class="main">(</span>snd <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> set <span class="main">[</span><span class="main">(</span>fst <span class="skolem">e</span><span class="main">,</span> snd <span class="skolem">e</span><span class="main">)</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> no_loops<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="skolem">e</span><span class="main">,</span> snd <span class="skolem">e</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_iapath_def apath_simps <span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="bound">p</span> <span class="bound">v</span><span class="main">.</span> gen_iapath <span class="main">(</span>pverts <span class="free">G</span><span class="main">)</span> <span class="bound">u</span> <span class="bound">p</span> <span class="bound">v</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="main">∈</span> set <span class="bound">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"gen_iapath <span class="main">(</span>pverts <span class="free">G</span><span class="main">)</span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹gen_iapath <span class="main">_</span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> gen_iapath_def apath_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">safe</span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="improper">list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_simps inner_verts_def<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_slim <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_slim_def two_less_deg2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> no_loops_in_iapath<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_contr_triv two_less_deg2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>divide <span class="skolem">e</span> <span class="skolem">w</span> <span class="skolem">H</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sH</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subdivide <span class="skolem">H</span> <span class="skolem">e</span> <span class="skolem">w</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹subdivision_pair <span class="free">G</span> <span class="skolem">H</span>›</span></span> <span class="keyword1"><span class="command">interpret</span></span> H<span class="main">:</span> pair_bidirected_digraph <span class="quoted"><span class="skolem">H</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bidirected_digraphI_subdivision<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> divide<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">interpret</span></span> S<span class="main">:</span> pair_sym_digraph <span class="var"><span class="quoted"><span class="var">?sH</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> H.pair_sym_digraph_subdivide<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> e_conv<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"contr_graph <span class="var">?sH</span> <span class="main">=</span> contr_graph <span class="skolem">H</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> V_cond<span class="main">:</span> <span class="quoted"><span class="quoted">"verts3 <span class="skolem">H</span> <span class="main">⊆</span> pverts <span class="skolem">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> verts3_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"verts3 <span class="skolem">H</span> <span class="main">=</span> verts3 <span class="var">?sH</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> divide <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H.verts3_subdivide<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"pverts <span class="main">(</span>contr_graph <span class="var">?sH</span><span class="main">)</span> <span class="main">=</span> pverts <span class="main">(</span>contr_graph <span class="skolem">H</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_contr_graph_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command"><span class="improper">then</span></span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"parcs <span class="main">(</span>contr_graph <span class="var">?sH</span><span class="main">)</span> <span class="main">=</span> parcs <span class="main">(</span>contr_graph <span class="skolem">H</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> gen_contr_graph_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> H.gen_iapath_co_path<span class="main"><span class="main">[</span></span><span class="operator">OF</span> divide<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span> V_cond<span class="main"><span class="main">]</span></span>
          H.gen_iapath_sd_path<span class="main"><span class="main">[</span></span><span class="operator">OF</span> divide<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span> V_cond<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> divide <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* could be generalized *)</span>
<span class="keyword1" id="Kuratowski-verts3_K33"><span class="command">lemma</span></span> verts3_K33<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"K<span class="hidden">⇘</span><sub><span class="numeral">3</span><span class="main">,</span><span class="numeral">3</span></sub><span class="hidden">⇙</span> <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"verts3 <span class="free">G</span> <span class="main">=</span> verts <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> pverts <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="keyword2"><span class="keyword">where</span></span> cards<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">U</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">V</span><span class="main">=</span><span class="numeral">3</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> UV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"pverts <span class="free">G</span> <span class="main">=</span> <span class="skolem">U</span> <span class="main">∪</span> <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"parcs <span class="free">G</span> <span class="main">=</span> <span class="skolem">U</span> <span class="main">×</span> <span class="skolem">V</span> <span class="main">∪</span> <span class="skolem">V</span> <span class="main">×</span> <span class="skolem">U</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> complete_bipartite_digraph_pair_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">&lt;</span> in_degree <span class="free">G</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_arcs <span class="free">G</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">V</span> <span class="main">×</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> UV <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cards <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_cartesian_product in_degree_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_arcs <span class="free">G</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">U</span> <span class="main">×</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="main">_</span>›</span></span> UV <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> cards <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_cartesian_product in_degree_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> verts3_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* could be generalized *)</span>
<span class="keyword1" id="Kuratowski-verts3_K5"><span class="command">lemma</span></span> verts3_K5<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"K<span class="hidden">⇘</span><sub><span class="numeral">5</span></sub><span class="hidden">⇙</span> <span class="main">(</span>with_proj <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"verts3 <span class="free">G</span> <span class="main">=</span> verts <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> pgG<span class="main">:</span> pair_graph <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_graphI_complete<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> pverts <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">::</span> nat<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="main">=</span> card <span class="main">(</span>pverts <span class="free">G</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> pverts <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> complete_digraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pverts <span class="free">G</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">u</span></span> <span class="main">∈</span> pverts <span class="free">G</span><span class="main">.</span> <span class="bound">u</span> <span class="main">≠</span> <span class="skolem">v</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">…</span> <span class="main">=</span> card <span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">u</span></span> <span class="main">∈</span> pverts <span class="free">G</span><span class="main">.</span> <span class="bound">u</span> <span class="main">≠</span> <span class="skolem">v</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="skolem">v</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> card <span class="var">?A</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> in_arcs <span class="free">G</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> pverts <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> complete_digraph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">safe</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">…</span> <span class="main">=</span> in_degree <span class="free">G</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> in_degree_def <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">&lt;</span> in_degree <span class="free">G</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">.</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> verts3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-K33_contractedI"><span class="command">lemma</span></span> K33_contractedI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subd<span class="main">:</span> <span class="quoted"><span class="quoted">"subdivision_pair <span class="free">G</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k33<span class="main">:</span> <span class="quoted"><span class="quoted">"K<span class="hidden">⇘</span><sub><span class="numeral">3</span><span class="main">,</span><span class="numeral">3</span></sub><span class="hidden">⇙</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"K<span class="hidden">⇘</span><sub><span class="numeral">3</span><span class="main">,</span><span class="numeral">3</span></sub><span class="hidden">⇙</span> <span class="main">(</span>contr_graph <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> pgG<span class="main">:</span> pair_graph <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">using</span></span> k33 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_graphI_complete_bipartite<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pgG.contracted_no_degree2_simp verts3_K33<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-K5_contractedI"><span class="command">lemma</span></span> K5_contractedI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subd<span class="main">:</span> <span class="quoted"><span class="quoted">"subdivision_pair <span class="free">G</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k5<span class="main">:</span> <span class="quoted"><span class="quoted">"K<span class="hidden">⇘</span><sub><span class="numeral">5</span></sub><span class="hidden">⇙</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"K<span class="hidden">⇘</span><sub><span class="numeral">5</span></sub><span class="hidden">⇙</span> <span class="main">(</span>contr_graph <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> pgG<span class="main">:</span> pair_graph <span class="quoted"><span class="free">G</span></span> <span class="keyword1"><span class="command">using</span></span> k5 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_graphI_complete<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pgG.contracted_no_degree2_simp verts3_K5<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Final proof›</span></span>

<span class="keyword1"><span class="command">context</span></span> pair_sym_digraph <span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1" id="Kuratowski-gcg_subdivide_eq"><span class="command">lemma</span></span> gcg_subdivide_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∉</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"gen_contr_graph <span class="main">(</span>subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span><span class="main">)</span> <span class="free">V</span> <span class="main">=</span> gen_contr_graph <span class="free">G</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> sdG<span class="main">:</span> pair_sym_digraph <span class="quoted"><span class="quoted">"subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mem <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_sym_digraph_subdivide<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sdG.gen_iapath <span class="free">V</span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gen_iapath <span class="free">V</span> <span class="skolem">u</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mem V <span class="quoted"><span class="quoted">‹sdG.gen_iapath <span class="free">V</span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> gen_iapath_co_path<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> gen_iapath <span class="free">V</span> <span class="skolem">u</span> <span class="bound">p</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> A <span class="main">=</span> this
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"gen_iapath <span class="free">V</span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sdG.gen_iapath <span class="free">V</span> <span class="skolem">u</span> <span class="main">(</span>sd_path <span class="free">e</span> <span class="free">w</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mem V <span class="quoted"><span class="quoted">‹gen_iapath <span class="free">V</span> <span class="skolem">u</span> <span class="skolem">p</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> gen_iapath_sd_path<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> sdG.gen_iapath <span class="free">V</span> <span class="skolem">u</span> <span class="bound">p</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> B <span class="main">=</span> this
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_contr_graph_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-co_path_append"><span class="command">lemma</span></span> co_path_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>last <span class="free">p1</span><span class="main">,</span> hd <span class="free">p2</span><span class="main">]</span> <span class="main">∉</span> <span class="main">{</span><span class="main">[</span><span class="main">(</span>fst <span class="free">e</span><span class="main">,</span><span class="free">w</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">w</span><span class="main">,</span>snd <span class="free">e</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span>snd <span class="free">e</span><span class="main">,</span><span class="free">w</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free">w</span><span class="main">,</span>fst <span class="free">e</span><span class="main">)</span><span class="main">]</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"co_path <span class="free">e</span> <span class="free">w</span> <span class="main">(</span><span class="free">p1</span> <span class="main">@</span> <span class="free">p2</span><span class="main">)</span> <span class="main">=</span> co_path <span class="free">e</span> <span class="free">w</span> <span class="free">p1</span> <span class="main">@</span> co_path <span class="free">e</span> <span class="free">w</span> <span class="free">p2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p1</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> co_path_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> single <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p2</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>co <span class="skolem">e1</span> <span class="skolem">e2</span> <span class="skolem">es</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">es</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>corev <span class="skolem">e1</span> <span class="skolem">e2</span> <span class="skolem">es</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">es</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Kuratowski-exists_co_path_decomp1"><span class="command">lemma</span></span> exists_co_path_decomp1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∉</span> pverts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"pre_digraph.apath <span class="main">(</span>subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span><span class="main">)</span> <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="free">e</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p1</span> <span class="bound">p2</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> <span class="bound">p1</span> <span class="main">@</span> <span class="main">(</span>fst <span class="free">e</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span> snd <span class="free">e</span><span class="main">)</span> <span class="main">#</span> <span class="bound">p2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sdG</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> sdG<span class="main">:</span> pair_sym_digraph <span class="var"><span class="quoted"><span class="var">?sdG</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> mem <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_sym_digraph_subdivide<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">p1</span> <span class="main">@</span> <span class="main">(</span>fst <span class="free">e</span><span class="main">,</span> <span class="free">w</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">p2</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="free">e</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">atomize_elim</span> <span class="main">(</span><span class="operator">rule</span> sdG.apath_succ_decomp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> p<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="free">e</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="var">?sdG</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">w</span><span class="main">,</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="var">?sdG</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sdG.apath_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹fst <span class="free">e</span> <span class="main">≠</span> <span class="skolem">z</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> snd <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mem <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wellformed'<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> p_decomp <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-is_slim_if_subdivide"><span class="command">lemma</span></span> is_slim_if_subdivide<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pair_pre_digraph.is_slim <span class="main">(</span>subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span><span class="main">)</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mem1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∉</span> pverts <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mem2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∉</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_slim <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?sdG</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> sdG<span class="main">:</span> pair_sym_digraph <span class="quoted"><span class="quoted">"subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mem1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_sym_digraph_subdivide<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> mem1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> pverts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> pverts <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wellformed'<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> mem1  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="free">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w_parcs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="free">w</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="free">w</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> sdg_new_parcs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?w_parcs</span> <span class="main">⊆</span> parcs <span class="var">?sdG</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> sdg_no_parcs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> parcs <span class="var">?sdG</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∉</span> parcs <span class="var">?sdG</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="free">w</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">≠</span> <span class="free">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> pverts <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_degree <span class="var">?sdG</span> <span class="skolem">z</span> <span class="main">=</span> in_degree <span class="free">G</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_arcs <span class="var">?sdG</span> <span class="skolem">z</span> <span class="main">=</span> in_arcs <span class="free">G</span> <span class="skolem">z</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>›</span></span> mem1 A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_degree <span class="var">?sdG</span> <span class="skolem">z</span> <span class="main">=</span> in_degree <span class="free">G</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_degree_def<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_arcs <span class="free">G</span> <span class="skolem">z</span> <span class="main">=</span> in_arcs <span class="var">?sdG</span> <span class="skolem">z</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>›</span></span> mem1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> arcs_symmetric wellformed'<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>in_arcs <span class="var">?sdG</span> <span class="skolem">z</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>in_arcs <span class="var">?sdG</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> sdg_new_parcs sdg_no_parcs <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">=</span> <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>in_arcs <span class="var">?sdG</span> <span class="skolem">z</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_arcs_def<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_degree <span class="var">?sdG</span> <span class="skolem">z</span><span class="main">=</span> in_degree <span class="free">G</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_degree_def<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_arcs <span class="free">G</span> <span class="skolem">z</span> <span class="main">=</span> in_arcs <span class="var">?sdG</span> <span class="skolem">z</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>›</span></span> mem1 A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wellformed'<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>in_arcs <span class="var">?sdG</span> <span class="skolem">z</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> card <span class="main">(</span>in_arcs <span class="var">?sdG</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> sdg_new_parcs sdg_no_parcs <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">=</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>in_arcs <span class="var">?sdG</span> <span class="skolem">z</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_arcs_def<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_degree <span class="var">?sdG</span> <span class="skolem">z</span><span class="main">=</span> in_degree <span class="free">G</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_degree_def<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> in_degree_same <span class="main">=</span> this

  <span class="keyword1"><span class="command">have</span></span> V_G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> pverts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"verts3 <span class="free">G</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> pverts <span class="var">?sdG</span>"</span></span> <span class="quoted"><span class="quoted">"pverts <span class="var">?sdG</span> <span class="main">=</span> pverts <span class="free">G</span> <span class="main">∪</span> <span class="main">{</span><span class="free">w</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"verts3 <span class="var">?sdG</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"verts3 <span class="free">G</span> <span class="main">⊆</span> verts3 <span class="var">?sdG</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sdG.is_slim <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>›</span></span> in_degree_same mem1
      <span class="keyword1"><span class="command">unfolding</span></span> sdG.is_slim_def verts3_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> pverts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"verts3 <span class="free">G</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">∉</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> pverts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>pverts <span class="free">G</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">∨</span> in_degree <span class="free">G</span> <span class="bound">v</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">p</span> <span class="bound">y</span><span class="main">.</span> gen_iapath <span class="free">V</span> <span class="bound">x</span> <span class="bound">p</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="bound">x</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> pverts <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> pverts <span class="var">?sdG</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>›</span></span> A mem1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_degree <span class="var">?sdG</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sdG.is_slim <span class="free">V</span>›</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sdG.is_slim_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> in_degree_same<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> pverts <span class="free">G</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> idg<span class="main">:</span> <span class="quoted"><span class="quoted">"in_degree <span class="free">G</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> pverts <span class="var">?sdG</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>›</span></span> mem1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sdG.gen_iapath <span class="free">V</span> <span class="skolem">x'</span> <span class="skolem">q</span> <span class="skolem">y'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> set <span class="main">(</span>sdG.awalk_verts <span class="skolem">x'</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sdG.is_slim <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sdG.is_slim_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gen_iapath <span class="free">V</span> <span class="skolem">x'</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">y'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="skolem">x'</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> A mem1 V_G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_awalk_verts_co_path' <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> gen_iapath_co_path<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> idg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"in_degree <span class="free">G</span> <span class="skolem">z</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">p</span> <span class="bound">y</span><span class="main">.</span> gen_iapath <span class="free">V</span> <span class="bound">x</span> <span class="bound">p</span> <span class="bound">y</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="bound">x</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> parcs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">∈</span>parcs <span class="free">G</span><span class="main">.</span> fst <span class="bound">e</span> <span class="main">≠</span> snd <span class="bound">e</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">p</span> <span class="bound">y</span><span class="main">.</span> gen_iapath <span class="free">V</span> <span class="bound">x</span> <span class="bound">p</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">e</span> <span class="main">∈</span> set <span class="bound">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ballI conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e'</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">p</span> <span class="bound">y</span><span class="main">.</span> gen_iapath <span class="free">V</span> <span class="bound">x</span> <span class="bound">p</span> <span class="bound">y</span> <span class="main">∧</span> <span class="skolem">e'</span> <span class="main">∈</span> set <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">e'</span> <span class="main">∈</span> parcs <span class="var">?sdG</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sdG.gen_iapath <span class="free">V</span> <span class="skolem">x</span> <span class="skolem">p</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e'</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sdG.is_slim <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sdG.is_slim_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">∈</span> parcs <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">∉</span> pverts <span class="free">G</span>›</span></span> V_G <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gen_iapath <span class="free">V</span> <span class="skolem">x</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> gen_iapath_co_path<span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e'</span> <span class="main">∈</span> parcs <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e'</span> <span class="main">∉</span> <span class="var">?w_parcs</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mem1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wellformed'<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e'</span> <span class="main">∈</span> set <span class="skolem">p</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e'</span> <span class="main">∈</span> set <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> co_path_induct<span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>›</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="bound">p</span> <span class="bound">y</span><span class="main">.</span> gen_iapath <span class="free">V</span> <span class="bound">x</span> <span class="bound">p</span> <span class="bound">y</span> <span class="main">∧</span> <span class="skolem">e'</span> <span class="main">∈</span> set <span class="bound">p</span> "</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹gen_iapath <span class="free">V</span> <span class="skolem">x</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">y</span>›</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e'</span> <span class="main">∉</span> parcs <span class="var">?sdG</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> fst <span class="skolem">e'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> snd <span class="skolem">e'</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e'</span> <span class="main">∈</span> parcs <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e'</span> <span class="main">∉</span> parcs <span class="var">?sdG</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>›</span></span> mem1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sdG.gen_iapath <span class="free">V</span> <span class="skolem">x</span> <span class="skolem">p</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sdG.is_slim <span class="free">V</span>›</span></span> sdg_new_parcs ab <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sdG.is_slim_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">∈</span> parcs <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">∉</span> pverts <span class="free">G</span>›</span></span> V_G <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"gen_iapath <span class="free">V</span> <span class="skolem">x</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> gen_iapath_co_path<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"subdivide <span class="free">G</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> subdivide <span class="free">G</span> <span class="free">e</span> <span class="free">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mem1 <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span>›</span></span> ab
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> arcs_symmetric <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subdivide.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre_digraph.apath <span class="main">(</span>subdivide <span class="free">G</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">p</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mem2 <span class="quoted"><span class="quoted">‹sdG.gen_iapath <span class="free">V</span> <span class="skolem">x</span> <span class="skolem">p</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sdG.gen_iapath_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p1</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">p2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> exists_co_path_decomp1 <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">∉</span> pverts <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">p</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">atomize_elim</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">from</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"co_path <span class="free">e</span> <span class="free">w</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="free">w</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">#</span> co_path <span class="free">e</span> <span class="free">w</span> <span class="skolem">p2</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> ab <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="free">w</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">≠</span> <span class="free">w</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> co_path_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> co_path_append<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹gen_iapath <span class="free">V</span> <span class="skolem">x</span> <span class="main">(</span>co_path <span class="free">e</span> <span class="free">w</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e'</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">e'</span> <span class="main">≠</span> snd <span class="skolem">e'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> no_loops_in_iapath<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> unique<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="bound">v</span> <span class="bound">p</span> <span class="bound">q</span><span class="main">.</span> <span class="main">(</span>gen_iapath <span class="free">V</span> <span class="bound">u</span> <span class="bound">p</span> <span class="bound">v</span> <span class="main">∧</span> gen_iapath <span class="free">V</span> <span class="bound">u</span> <span class="bound">q</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">p</span> <span class="main">=</span> <span class="bound">q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_iapath <span class="free">V</span> <span class="skolem">x</span> <span class="skolem">p</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"gen_iapath <span class="free">V</span> <span class="skolem">x</span> <span class="skolem">q</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">p</span> <span class="main">⊆</span> parcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">q</span> <span class="main">⊆</span> parcs <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> gen_iapath_def apath_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> w_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w_q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="free">w</span><span class="main">)</span> <span class="main">∉</span> set <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mem1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wellformed'<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sdG.gen_iapath <span class="free">V</span> <span class="skolem">x</span> <span class="main">(</span>sd_path <span class="free">e</span> <span class="free">w</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"sdG.gen_iapath <span class="free">V</span> <span class="skolem">x</span> <span class="main">(</span>sd_path <span class="free">e</span> <span class="free">w</span> <span class="skolem">q</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mem1 V_G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> gen_iapath_sd_path<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sd_path <span class="free">e</span> <span class="free">w</span> <span class="skolem">p</span> <span class="main">=</span> sd_path <span class="free">e</span> <span class="free">w</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sdG.is_slim <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sdG.is_slim_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"co_path <span class="free">e</span> <span class="free">w</span> <span class="main">(</span>sd_path <span class="free">e</span> <span class="free">w</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> co_path <span class="free">e</span> <span class="free">w</span> <span class="main">(</span>sd_path <span class="free">e</span> <span class="free">w</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> w_p w_q <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> co_sd_id<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">from</span></span> pverts parcs V_G unique <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_slim_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> pair_pseudo_graph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Kuratowski-subdivision_gen_contr"><span class="command">lemma</span></span> subdivision_gen_contr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_slim <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subdivision_pair <span class="main">(</span>gen_contr_graph <span class="free">G</span> <span class="free">V</span><span class="main">)</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">using</span></span> pair_pseudo_graph
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>pverts <span class="free">G</span> <span class="main">-</span> <span class="free">V</span><span class="main">)</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">interpret</span></span> G<span class="main">:</span> pair_pseudo_graph <span class="quoted"><span class="skolem">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pair_bidirected_digraph <span class="skolem">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> G.pair_sym_arcs 0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G.is_slim_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subdivision_pair_intros <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G.gen_contr_triv G.is_slim_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> G<span class="main">:</span> pair_pseudo_graph <span class="quoted"><span class="skolem">G</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">n</span> <span class="main">=</span> card <span class="main">(</span>pverts <span class="skolem">G</span> <span class="main">-</span> <span class="free">V</span><span class="main">)</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pverts <span class="skolem">G</span> <span class="main">-</span> <span class="free">V</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nat.diff_le_self Suc_n_not_le_n card_Diff_subset_Int diff_Suc_Suc empty_Diff finite.emptyI inf_bot_left<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> pverts <span class="skolem">G</span> <span class="main">-</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"G.gen_iapath <span class="free">V</span> <span class="skolem">x</span> <span class="skolem">q</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> set <span class="main">(</span>G.awalk_verts <span class="skolem">x</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"in_degree <span class="skolem">G</span> <span class="skolem">w</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹G.is_slim <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G.is_slim_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∉</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> pverts <span class="skolem">G</span> <span class="main">-</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G.gen_iapath_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> set <span class="skolem">q</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">e</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> pverts <span class="skolem">G</span> <span class="main">-</span> <span class="free">V</span>›</span></span> q
    <span class="keyword1"><span class="command">unfolding</span></span> G.gen_iapath_def G.apath_def G.awalk_conv
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G.awalk_verts_conv'<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> fst <span class="skolem">e</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q1</span></span> <span class="skolem"><span class="skolem">q2</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> q_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> <span class="skolem">q1</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">q2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> q <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G.gen_iapath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">atomize_elim</span> <span class="main">(</span><span class="operator">rule</span> G.apath_succ_decomp<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> q <span class="keyword1"><span class="command">have</span></span> qi_walks<span class="main">:</span> <span class="quoted"><span class="quoted">"G.awalk <span class="skolem">x</span> <span class="skolem">q1</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"G.awalk <span class="skolem">v</span> <span class="skolem">q2</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G.gen_iapath_def G.apath_def G.awalk_Cons_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> q q_decomp <span class="keyword1"><span class="command">have</span></span> uvw_arcs1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="skolem">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G.gen_iapath_def G.apath_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> uvw_arcs2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="skolem">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> G.arcs_symmetric<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="skolem">w</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q_decomp q
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G.gen_iapath_def G.apath_append_iff G.apath_simps<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> in_arcs<span class="main">:</span> <span class="quoted"><span class="quoted">"in_arcs <span class="skolem">G</span> <span class="skolem">w</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> in_arcs <span class="skolem">G</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> uvw_arcs1 uvw_arcs2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹in_degree <span class="skolem">G</span> <span class="skolem">w</span> <span class="main">≤</span> <span class="numeral">2</span>›</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">{</span><span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">-</span> <span class="main">(</span><span class="operator">rule</span> card_seteq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_degree_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> out_arcs<span class="main">:</span> <span class="quoted"><span class="quoted">"out_arcs <span class="skolem">G</span> <span class="skolem">w</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⊆</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> out_arcs <span class="skolem">G</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>snd <span class="skolem">e</span><span class="main">,</span> fst <span class="skolem">e</span><span class="main">)</span> <span class="main">∈</span> in_arcs <span class="skolem">G</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> G.arcs_symmetric<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> in_arcs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> parcs <span class="skolem">G</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="skolem">G</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"G.gen_iapath <span class="free">V</span> <span class="skolem">x</span> <span class="main">(</span><span class="skolem">q1</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">q2</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> awalk'<span class="main">:</span> <span class="quoted"><span class="quoted">"G.awalk <span class="skolem">x</span> <span class="main">(</span><span class="skolem">q1</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">q2</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> qi_walks <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="skolem">G</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G.awalk_simps<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"G.awalk <span class="skolem">x</span> <span class="skolem">q</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹G.gen_iapath <span class="free">V</span> <span class="skolem">x</span> <span class="skolem">q</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G.gen_iapath_def G.apath_def<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>G.awalk_verts <span class="skolem">x</span> <span class="main">(</span><span class="skolem">q1</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">q2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> awalk' <span class="quoted"><span class="quoted">‹G.gen_iapath <span class="free">V</span> <span class="skolem">x</span> <span class="skolem">q</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_decomp 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G.gen_iapath_def G.apath_def G.awalk_verts_append<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>G.inner_verts <span class="main">(</span><span class="skolem">q1</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">q2</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>G.inner_verts <span class="skolem">q</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> awalk' <span class="quoted"><span class="quoted">‹G.awalk <span class="skolem">x</span> <span class="skolem">q</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_decomp
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> butlast_append G.inner_verts_conv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span> G.awalk_verts_append
          <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> in_set_butlast_appendI<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>G.inner_verts <span class="main">(</span><span class="skolem">q1</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">q2</span><span class="main">)</span><span class="main">)</span> <span class="main">∩</span> <span class="free">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹G.gen_iapath <span class="free">V</span> <span class="skolem">x</span> <span class="skolem">q</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G.gen_iapath_def<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> awalk' <span class="quoted"><span class="quoted">‹G.gen_iapath <span class="free">V</span> <span class="skolem">x</span> <span class="skolem">q</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G.gen_iapath_def G.apath_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">q1</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">q2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">q</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹G.gen_iapath <span class="free">V</span> <span class="skolem">x</span> <span class="skolem">q</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹G.is_slim <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G.is_slim_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> q_decomp <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∉</span> parcs <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> G.arcs_symmetric<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G'</span> <span class="main">=</span> <span class="main">⦇</span>pverts <span class="main">=</span> pverts <span class="skolem">G</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">w</span><span class="main">}</span><span class="main">,</span>
      parcs <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span>parcs <span class="skolem">G</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> mem_G'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="skolem">G'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∉</span> pverts <span class="skolem">G'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G'_def<span class="main">)</span>

  <span class="keyword1"><span class="command">interpret</span></span> pd_G'<span class="main">:</span> pair_fin_digraph <span class="quoted"><span class="skolem">G'</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> parcs <span class="skolem">G'</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> parcs <span class="skolem">G</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">⟹</span> fst <span class="skolem">e</span> <span class="main">≠</span> <span class="skolem">w</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> parcs <span class="skolem">G</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="main">≠</span> <span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">⟹</span> snd <span class="skolem">e</span> <span class="main">≠</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> out_arcs in_arcs <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> A uvw_arcs1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">e</span> <span class="main">∈</span> pverts <span class="skolem">G'</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">e</span> <span class="main">∈</span> pverts <span class="skolem">G'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">w</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">≠</span> <span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G'_def G.wellformed'<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G'_def arc_to_ends_def<span class="main">)</span>

  <span class="keyword1"><span class="command">interpret</span></span> spd_G'<span class="main">:</span> pair_pseudo_graph <span class="quoted"><span class="skolem">G'</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> symmetric_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sym <span class="main">{</span><span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span>parcs <span class="skolem">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"sym <span class="main">{</span><span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">w</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> G.sym_arcs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> symmetric_def sym_def<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span>parcs <span class="skolem">G</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">w</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="skolem">w</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> sym_Un<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sym_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sym <span class="main">(</span>parcs <span class="skolem">G'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> card_G'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> card <span class="main">(</span>pverts <span class="skolem">G'</span> <span class="main">-</span> <span class="free">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pverts <span class="skolem">G</span> <span class="main">-</span> <span class="free">V</span> <span class="main">=</span> insert <span class="skolem">w</span> <span class="main">(</span>pverts <span class="skolem">G'</span> <span class="main">-</span> <span class="free">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> pverts <span class="skolem">G</span> <span class="main">-</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Suc <span class="skolem">n</span> <span class="main">=</span> card <span class="main">(</span>pverts <span class="skolem">G</span> <span class="main">-</span> <span class="free">V</span><span class="main">)</span>›</span></span> mem_G' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> G_is_sd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> subdivide <span class="skolem">G'</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="skolem">w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?sdG'</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> pverts <span class="skolem">G</span> <span class="main">-</span> <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∉</span> parcs <span class="skolem">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span> <span class="main">∉</span> parcs <span class="skolem">G</span>›</span></span>  uvw_arcs1 uvw_arcs2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> pair_pre_digraph.equality<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G'_def<span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> gcg_sd<span class="main">:</span> <span class="quoted"><span class="quoted">"gen_contr_graph <span class="main">(</span>subdivide <span class="skolem">G'</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span> <span class="free">V</span> <span class="main">=</span> gen_contr_graph <span class="skolem">G'</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> pverts <span class="skolem">G</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹G.is_slim <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G.is_slim_def verts3_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"verts3 <span class="skolem">G'</span> <span class="main">=</span> verts3 <span class="skolem">G</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> G_is_sd spd_G'.verts3_subdivide<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> parcs <span class="skolem">G'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∉</span> pverts <span class="skolem">G'</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> pverts <span class="skolem">G'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> pverts <span class="skolem">G</span> <span class="main">-</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> G'_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> mem_G' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> spd_G'.gcg_subdivide_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> is_slim_G'<span class="main">:</span> <span class="quoted"><span class="quoted">"pd_G'.is_slim <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹G.is_slim <span class="free">V</span>›</span></span> mem_G' <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∉</span> <span class="free">V</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> G_is_sd <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> spd_G'.is_slim_if_subdivide<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> mem_G' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subdivision_pair <span class="main">(</span>gen_contr_graph <span class="skolem">G'</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span>subdivide <span class="skolem">G'</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Suc card_G' subdivision_pair_intros<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gcg_sd G_is_sd<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Kuratowski-contr_is_subgraph_subdivision"><span class="command">lemma</span></span>  contr_is_subgraph_subdivision<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">H</span><span class="main">.</span> subgraph <span class="main">(</span>with_proj <span class="bound">H</span><span class="main">)</span> <span class="free">G</span> <span class="main">∧</span> subdivision_pair <span class="main">(</span>contr_graph <span class="free">G</span><span class="main">)</span> <span class="bound">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> sG<span class="main">:</span> pair_graph <span class="quoted">slim</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_graph_slim<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subdivision_pair <span class="main">(</span>gen_contr_graph slim <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span><span class="main">)</span> slim "</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sG.subdivision_gen_contr<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> slim_is_slim<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> contr_graph_slim_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subgraph_slim<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> kuratowski_contr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">K</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pair_pre_digraph"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subgraph_K<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="free">K</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> spd_K<span class="main">:</span> <span class="quoted"><span class="quoted">"pair_pseudo_graph <span class="free">K</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> kuratowski<span class="main">:</span> <span class="quoted"><span class="quoted">"K<span class="hidden">⇘</span><sub><span class="numeral">3</span><span class="main">,</span><span class="numeral">3</span></sub><span class="hidden">⇙</span> <span class="main">(</span>contr_graph <span class="free">K</span><span class="main">)</span> <span class="main">∨</span> K<span class="hidden">⇘</span><sub><span class="numeral">5</span></sub><span class="hidden">⇙</span> <span class="main">(</span>contr_graph <span class="free">K</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>kuratowski_planar <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> spd_K<span class="main">:</span> pair_pseudo_graph <span class="quoted"><span class="free">K</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> spd_K<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> subgraph_H<span class="main">:</span> <span class="quoted"><span class="quoted">"subgraph <span class="main">(</span>with_proj <span class="skolem">H</span><span class="main">)</span> <span class="free">K</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> subdiv_H<span class="main">:</span><span class="quoted"><span class="quoted">"subdivision_pair <span class="main">(</span>contr_graph <span class="free">K</span><span class="main">)</span> <span class="skolem">H</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">atomize_elim</span> <span class="main">(</span><span class="operator">rule</span> spd_K.contr_is_subgraph_subdivision<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> grI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">K</span><span class="main">.</span> <span class="main">(</span>K<span class="hidden">⇘</span><sub><span class="numeral">3</span><span class="main">,</span><span class="numeral">3</span></sub><span class="hidden">⇙</span> <span class="bound">K</span> <span class="main">∨</span> K<span class="hidden">⇘</span><sub><span class="numeral">5</span></sub><span class="hidden">⇙</span> <span class="bound">K</span><span class="main">)</span> <span class="main">⟹</span> graph <span class="bound">K</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> complete_digraph_def complete_bipartite_digraph_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> subdiv_H <span class="keyword2"><span class="keyword">and</span></span> kuratowski
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">K</span><span class="main">.</span> subdivision_pair <span class="bound">K</span> <span class="skolem">H</span> <span class="main">∧</span> <span class="main">(</span>K<span class="hidden">⇘</span><sub><span class="numeral">3</span><span class="main">,</span><span class="numeral">3</span></sub><span class="hidden">⇙</span> <span class="bound">K</span> <span class="main">∨</span> K<span class="hidden">⇘</span><sub><span class="numeral">5</span></sub><span class="hidden">⇙</span> <span class="bound">K</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">K</span> <span class="bound">rev_K</span> <span class="bound">rev_H</span><span class="main">.</span> subdivision <span class="main">(</span><span class="bound">K</span><span class="main">,</span> <span class="bound">rev_K</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span><span class="main">,</span> <span class="bound">rev_H</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>K<span class="hidden">⇘</span><sub><span class="numeral">3</span><span class="main">,</span><span class="numeral">3</span></sub><span class="hidden">⇙</span> <span class="bound">K</span> <span class="main">∨</span> K<span class="hidden">⇘</span><sub><span class="numeral">5</span></sub><span class="hidden">⇙</span> <span class="bound">K</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> grI pair_graphI_graph<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> subgraph_H subgraph_K
    <span class="keyword1"><span class="command">unfolding</span></span> kuratowski_planar_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> subgraph_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> certificate_characterization<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">kuratowski</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">G</span> <span class="main">::</span> <span class="tfree">'a</span> pair_pre_digraph<span class="main">.</span> K<span class="hidden">⇘</span><sub><span class="numeral">3</span><span class="main">,</span><span class="numeral">3</span></sub><span class="hidden">⇙</span> <span class="bound">G</span> <span class="main">∨</span> K<span class="hidden">⇘</span><sub><span class="numeral">5</span></sub><span class="hidden">⇙</span> <span class="bound">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">kuratowski</span> <span class="main">(</span>contr_graph <span class="free">G</span><span class="main">)</span>
    <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">H</span><span class="main">.</span> <span class="free">kuratowski</span> <span class="bound">H</span> <span class="main">∧</span> subdivision_pair <span class="bound">H</span> slim <span class="main">∧</span> verts3 <span class="free">G</span> <span class="main">=</span> verts3 slim<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span>
  <span class="keyword1"><span class="command">interpret</span></span> S<span class="main">:</span> pair_graph <span class="quoted">slim</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pair_graph_slim<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"subdivision_pair <span class="main">(</span>contr_graph <span class="free">G</span><span class="main">)</span> slim"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"S.is_slim <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> slim_is_slim<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> contr_graph_slim_eq S.subdivision_gen_contr<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"verts3 slim <span class="main">=</span> verts3 <span class="free">G</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="var">?l</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="var">?r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> verts_slim_in_G verts3_slim_in_verts3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="var">?r</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> verts3 <span class="main">(</span>contr_graph <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> verts <span class="main">(</span>contr_graph <span class="free">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="var">?r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> verts3_def gen_contr_graph_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> kuratowski_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> verts3_K33 verts3_K5<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> verts3 <span class="main">(</span>gen_contr_graph slim <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> contr_graph_slim_eq <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">&lt;</span> in_degree <span class="main">(</span>gen_contr_graph slim <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="skolem">v</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> verts3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> in_degree slim <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="var">?r</span>›</span></span> verts3_slim_in_verts3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> S.in_degree_contr<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> verts3 slim"</span></span>
      <span class="keyword1"><span class="command">using</span></span> verts3_in_slim_G <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="var">?r</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> verts3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?L</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">kuratowski</span> <span class="main">(</span>gen_contr_graph slim <span class="main">(</span>verts3 <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> kuratowski_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> K33_contractedI K5_contractedI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?L</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> contr_graph_slim_eq <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pair_pre_digraph<span class="main">)</span> <span class="entity">certify</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> pair_pre_digraph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">certify</span> <span class="free"><span class="bound"><span class="entity">cert</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span> <span class="bound">C</span> <span class="main">=</span> contr_graph <span class="free"><span class="bound"><span class="entity">cert</span></span></span> <span class="keyword1">in</span> subgraph <span class="free"><span class="bound"><span class="entity">cert</span></span></span> <span class="free">G</span> <span class="main">∧</span> <span class="main">(</span>K<span class="hidden">⇘</span><sub><span class="numeral">3</span><span class="main">,</span><span class="numeral">3</span></sub><span class="hidden">⇙</span> <span class="bound">C</span> <span class="main">∨</span> K<span class="hidden">⇘</span><sub><span class="numeral">5</span></sub><span class="hidden">⇙</span><span class="bound">C</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> certify_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pair_pseudo_graph <span class="free">cert</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subgraph <span class="free">cert</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">H</span><span class="main">.</span> subdivision_pair <span class="bound">H</span> <span class="free">cert</span> <span class="main">∧</span> <span class="main">(</span>K<span class="hidden">⇘</span><sub><span class="numeral">3</span><span class="main">,</span><span class="numeral">3</span></sub><span class="hidden">⇙</span> <span class="bound">H</span> <span class="main">∨</span> K<span class="hidden">⇘</span><sub><span class="numeral">5</span></sub><span class="hidden">⇙</span> <span class="bound">H</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"certify <span class="free">cert</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> certify_def
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> K33_contractedI K5_contractedI<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> certify_sound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pair_pseudo_graph <span class="free">cert</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"certify <span class="free">cert</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span><span class="quoted"><span class="quoted">" <span class="main">¬</span>kuratowski_planar <span class="free">G</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> kuratowski_contr<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> certify_def Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> certify_characterization<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pair_pseudo_graph <span class="free">cert</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"certify <span class="free">cert</span> <span class="main">⟷</span> subgraph <span class="free">cert</span> <span class="free">G</span> <span class="main">∧</span> verts3 <span class="free">cert</span> <span class="main">=</span> verts3 <span class="main">(</span>pair_pre_digraph.slim <span class="free">cert</span><span class="main">)</span>
      <span class="main">∧</span><span class="main">(</span><span class="main">∃</span><span class="bound">H</span><span class="main">.</span> <span class="main">(</span>K<span class="hidden">⇘</span><sub><span class="numeral">3</span><span class="main">,</span><span class="numeral">3</span></sub><span class="hidden">⇙</span> <span class="main">(</span>with_proj <span class="bound">H</span><span class="main">)</span> <span class="main">∨</span> K<span class="hidden">⇘</span><sub><span class="numeral">5</span></sub><span class="hidden">⇙</span> <span class="bound">H</span><span class="main">)</span> <span class="main">∧</span> subdivision_pair <span class="bound">H</span> <span class="main">(</span>pair_pre_digraph.slim <span class="free">cert</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">⟷</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> simp_thms certify_def Let_def pair_pseudo_graph.certificate_characterization<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Weighted_Graph">
<div class="head">
<h1>Theory Weighted_Graph</h1>
</div>
<pre class="source"><span class="comment1">(* Title:  Weighted_Graph.thy
   Author: Lars Noschinski, TU München
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Weighted_Graph
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Digraph.html">Digraph</a>
  <a href="Arc_Walk.html">Arc_Walk</a>
  <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Weighted Graphs›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'b</span> weight_fun <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> real"</span></span>

<span class="keyword1"><span class="command">context</span></span> wf_digraph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">awalk_cost</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> weight_fun <span class="main">⇒</span> <span class="tfree">'b</span> awalk <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">awalk_cost</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">=</span> sum_list <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Weighted_Graph-awalk_cost_Nil"><span class="command">lemma</span></span> awalk_cost_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"awalk_cost <span class="free">f</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> awalk_cost_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Weighted_Graph-awalk_cost_Cons"><span class="command">lemma</span></span> awalk_cost_Cons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"awalk_cost <span class="free">f</span> <span class="main">(</span><span class="free">x</span> <span class="main">#</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">+</span> awalk_cost  <span class="free">f</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> awalk_cost_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Weighted_Graph-awalk_cost_append"><span class="command">lemma</span></span> awalk_cost_append<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"awalk_cost <span class="free">f</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> awalk_cost <span class="free">f</span> <span class="free">xs</span> <span class="main">+</span> awalk_cost <span class="free">f</span> <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> awalk_cost_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Shortest_Path">
<div class="head">
<h1>Theory Shortest_Path</h1>
</div>
<pre class="source"><span class="comment1">(* Title:  Shortest_Path.thy
   Author: Lars Noschinski, TU München
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Shortest_Path <span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Arc_Walk.html">Arc_Walk</a>
  <a href="Weighted_Graph.html">Weighted_Graph</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Extended_Real.html">HOL-Library.Extended_Real</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Shortest Paths›</span></span>


<span class="keyword1"><span class="command">context</span></span> wf_digraph <span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*Rename, as we are outside of any local context?*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">μ</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">μ</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="keyword1">INF</span> <span class="bound">p</span><span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> awalk <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="bound">p</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span><span class="main">.</span> ereal <span class="main">(</span>awalk_cost <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">p</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Shortest_Path-shortest_path_inf"><span class="command">lemma</span></span> shortest_path_inf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> awalk <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reachable_awalk<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> μ_def *
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_ereal_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Shortest_Path-min_cost_le_walk_cost"><span class="command">lemma</span></span> min_cost_le_walk_cost<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">u</span> <span class="free">v</span> <span class="main">≤</span> awalk_cost <span class="free">c</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> μ_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> INF_lower2<span class="main">)</span>

<span class="keyword1" id="Shortest_Path-pos_cost_pos_awalk_cost"><span class="command">lemma</span></span> pos_cost_pos_awalk_cost<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pos_cost<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> <span class="free">c</span> <span class="bound">e</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"awalk_cost <span class="free">c</span> <span class="free">p</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_Cons_iff<span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">mk_cycles_path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat
  <span class="main">⇒</span> <span class="tfree">'b</span> awalk <span class="main">⇒</span> <span class="tfree">'b</span> awalk"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">mk_cycles_path</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">mk_cycles_path</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">@</span> <span class="main">(</span><span class="free">mk_cycles_path</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Shortest_Path-mk_cycles_path_awalk"><span class="command">lemma</span></span> mk_cycles_path_awalk<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">c</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="main">(</span>mk_cycles_path <span class="free">n</span> <span class="free">c</span><span class="main">)</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_Nil_iff<span class="main">)</span>

<span class="keyword1" id="Shortest_Path-mk_cycles_awalk_cost"><span class="command">lemma</span></span> mk_cycles_awalk_cost<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"awalk_cost <span class="free">c</span> <span class="main">(</span>mk_cycles_path <span class="free">n</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span> <span class="main">*</span> awalk_cost <span class="free">c</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> mk_cycles_path.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">n</span> <span class="skolem">p</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk_cost <span class="free">c</span> <span class="main">(</span>mk_cycles_path <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="skolem">p</span><span class="main">)</span>
      <span class="main">=</span> awalk_cost <span class="free">c</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">@</span> <span class="main">(</span>mk_cycles_path <span class="skolem">n</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> awalk_cost <span class="free">c</span> <span class="skolem">p</span> <span class="main">+</span> real <span class="skolem">n</span> <span class="main">*</span> awalk_cost <span class="free">c</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> real <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> awalk_cost <span class="free">c</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Shortest_Path-inf_over_nats"><span class="command">lemma</span></span> inf_over_nats<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">c</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="main">(</span><span class="bound">i</span> <span class="main">::</span> nat<span class="main">)</span><span class="main">.</span> ereal <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="bound">i</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">∞</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> INF_eqI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">∞</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">+</span> real <span class="skolem">i</span> <span class="main">*</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">ereal</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">i</span> <span class="main">::</span> nat<span class="main">)</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">+</span> real <span class="bound">i</span> <span class="main">*</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> l_assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">::</span>nat<span class="main">.</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">+</span> real <span class="bound">i</span> <span class="main">*</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="main">-</span> <span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> ereal_infty_less_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ereal_bot<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">real_x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="skolem">real_x</span> <span class="main">*</span> <span class="free">c</span> <span class="main">≤</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">atomize_elim</span>
         <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">-</span></span></span> abs <span class="skolem"><span class="skolem"><span class="skolem">B</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span><span class="free"><span class="free"><span class="free">a</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">/</span></span></span><span class="free"><span class="free"><span class="free">c</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">c</span> <span class="main">≤</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">atomize_elim</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"nat<span class="main"><span class="main">(</span></span>ceiling <span class="skolem"><span class="skolem">real_x</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span>nat<span class="main">(</span>ceiling <span class="skolem">real_x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span> <span class="main">≤</span> <span class="skolem">real_x</span> <span class="main">*</span> <span class="free">c</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_nat_ceiling_ge<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> nat<span class="main">(</span>ceiling <span class="skolem">real_x</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span> <span class="main">≤</span> <span class="skolem">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">+</span> <span class="skolem">real_x</span> <span class="main">*</span> <span class="free">c</span> <span class="main">≤</span> <span class="skolem">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> ereal <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ereal <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> ereal <span class="skolem">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">c</span> <span class="main">≤</span> <span class="skolem">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> l_assm <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Shortest_Path-neg_cycle_imp_inf_μ"><span class="command">lemma</span></span> neg_cycle_imp_inf_μ<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> walk_p<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> walk_c<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">w</span> <span class="free">c</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> w_in_p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk_cost <span class="free">f</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> w_in_p <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="skolem"><span class="skolem">ys</span></span> <span class="keyword2"><span class="keyword">where</span></span> pv_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk_verts <span class="free">u</span> <span class="free">p</span> <span class="main">=</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">w</span> <span class="main">#</span> <span class="skolem">ys</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> in_set_conv_decomp<span class="main">)</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> take <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> drop <span class="main">(</span>length <span class="skolem">xs</span><span class="main">)</span> <span class="free">p</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ext_p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ext_p</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> mk_cycles_path <span class="skolem">n</span> <span class="free">c</span> <span class="main">@</span> <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>

  <span class="keyword1"><span class="command">have</span></span> ext_p_cost<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> awalk_cost <span class="free">f</span> <span class="main">(</span><span class="skolem">ext_p</span> <span class="bound">n</span><span class="main">)</span>
      <span class="main">=</span> <span class="main">(</span>awalk_cost <span class="free">f</span> <span class="skolem">q</span> <span class="main">+</span> awalk_cost <span class="free">f</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">+</span> <span class="bound">n</span> <span class="main">*</span> awalk_cost <span class="free">f</span> <span class="free">c</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="free">w</span> <span class="free">c</span> <span class="free">w</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ext_p_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mk_cycles_awalk_cost<span class="main">)</span>

  <span class="keyword1"><span class="command">from</span></span> q_def r_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awlast <span class="free">u</span> <span class="skolem">q</span> <span class="main">=</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pv_decomp walk_p <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_verts_take_conv <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> awalkE<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> q_def r_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">@</span> <span class="skolem">r</span><span class="main">)</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> walk_p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="skolem">q</span> <span class="free">w</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">w</span> <span class="skolem">r</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> awalk <span class="free">w</span> <span class="main">(</span>mk_cycles_path <span class="bound">n</span> <span class="free">c</span><span class="main">)</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> walk_c
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mk_cycles_path_awalk<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> awalk <span class="free">u</span> <span class="main">(</span><span class="skolem">ext_p</span> <span class="bound">n</span><span class="main">)</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ext_p_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> awalk_appendI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">ext_p</span> <span class="bound">i</span><span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV<span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> awalk <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">p</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> awalk <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span><span class="main">.</span> ereal <span class="main">(</span>awalk_cost <span class="free">f</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>
      <span class="main">≤</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">p</span><span class="main">∈</span> <span class="main">{</span><span class="skolem">ext_p</span> <span class="bound">i</span><span class="main">|</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> UNIV<span class="main">}</span><span class="main">.</span> ereal <span class="main">(</span>awalk_cost <span class="free">f</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> INF_superset_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">i</span><span class="main">∈</span> UNIV<span class="main">.</span> ereal <span class="main">(</span>awalk_cost <span class="free">f</span> <span class="main">(</span><span class="skolem">ext_p</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">Inf</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> ext_p_cost 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inf_over_nats<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹awalk_cost <span class="free">f</span> <span class="free">c</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> μ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Shortest_Path-walk_cheaper_path_imp_neg_cyc"><span class="command">lemma</span></span> walk_cheaper_path_imp_neg_cyc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p_props<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> less_path_μ<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk_cost <span class="free">f</span> <span class="free">p</span> <span class="main">&lt;</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">p</span><span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> apath <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span><span class="main">.</span> ereal <span class="main">(</span>awalk_cost <span class="free">f</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="bound">c</span><span class="main">.</span> awalk <span class="bound">w</span> <span class="bound">c</span> <span class="bound">w</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">∧</span> awalk_cost <span class="free">f</span> <span class="bound">c</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">path_μ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">path_μ</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">p</span><span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> apath <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span><span class="main">.</span> ereal <span class="main">(</span>awalk_cost <span class="free">f</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"awalk_cost <span class="free">f</span> <span class="free">p</span> <span class="main">&lt;</span> <span class="skolem">path_μ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> p_props less_path_μ <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> awalk_to_apath_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>path <span class="skolem">p</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> path.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> path_μ_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> not_mem_less_INF<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>decomp <span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">r</span> <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="skolem">r</span> <span class="main">@</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="skolem">q</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">w</span> <span class="skolem">r</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">w</span> <span class="skolem">s</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> awalk_cyc_decompE<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">@</span> <span class="skolem">s</span><span class="main">)</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_appendI<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> verts_ss<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">@</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="skolem">r</span> <span class="main">@</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_awalk_verts<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"ereal <span class="main">(</span>awalk_cost <span class="free">f</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">@</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">path_μ</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="bound">c</span><span class="main">.</span> awalk <span class="bound">w</span> <span class="bound">c</span> <span class="bound">w</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">@</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> awalk_cost <span class="free">f</span> <span class="bound">c</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> decomp<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> verts_ss <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹awalk_cost <span class="free">f</span> <span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">path_μ</span>›</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">path_μ</span> <span class="main">≤</span> awalk_cost <span class="free">f</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">@</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk_cost <span class="free">f</span> <span class="skolem">r</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="skolem">r</span> <span class="main">@</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="free">u</span> <span class="skolem">q</span> <span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>›</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="free">u</span> <span class="skolem">q</span> <span class="skolem">w</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="skolem">r</span> <span class="main">@</span> <span class="skolem">s</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_awalk_verts<span class="main">)</span>    
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="skolem">w</span> <span class="skolem">r</span> <span class="skolem">w</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> neg_inf_imp_neg_cyc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inf_mu<span class="main">:</span> <span class="quoted"><span class="quoted">"μ <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> <span class="main">-</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> awalk <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">w</span> <span class="bound">c</span><span class="main">.</span> awalk <span class="bound">w</span> <span class="bound">c</span> <span class="bound">w</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="bound">p</span><span class="main">)</span> <span class="main">∧</span> awalk_cost <span class="free">f</span> <span class="bound">c</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">path_μ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">path_μ</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">s</span><span class="main">∈</span><span class="main">{</span><span class="bound">p</span><span class="main">.</span> apath <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span><span class="main">.</span> ereal <span class="main">(</span>awalk_cost <span class="free">f</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> awalks_ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> awalk <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_mu <span class="keyword1"><span class="command">unfolding</span></span> μ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">safe</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_ereal_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> paths_ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> apath <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span> <span class="main">~=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> apath_awalk_to_apath<span class="main">)</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"awalk_cost <span class="free">f</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">path_μ</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> apath <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"awalk_cost <span class="free">f</span> <span class="skolem">p</span> <span class="main">=</span> <span class="skolem">path_μ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_INF_in<span class="main">[</span><span class="operator">OF</span> apaths_finite paths_ne<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"awalk_cost <span class="free">f</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> path_μ_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">path_μ</span> <span class="main">≠</span> <span class="main">-</span><span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="main">&lt;</span> <span class="skolem">path_μ</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inf_mu <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pw</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_def<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="skolem">pw</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"awalk_cost <span class="free">f</span> <span class="skolem">pw</span> <span class="main">&lt;</span> <span class="skolem">path_μ</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">atomize_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> μ_def INF_less_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="bound">c</span><span class="main">.</span> awalk <span class="bound">w</span> <span class="bound">c</span> <span class="bound">w</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="skolem">pw</span><span class="main">)</span> <span class="main">∧</span> awalk_cost <span class="free">f</span> <span class="bound">c</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> walk_cheaper_path_imp_neg_cyc<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> path_μ_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="free">u</span> <span class="skolem">pw</span> <span class="free">v</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> no_neg_cyc_imp_no_neg_inf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> no_neg_cyc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> awalk <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span>
    <span class="main">⟹</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">w</span> <span class="bound">c</span><span class="main">.</span> awalk <span class="bound">w</span> <span class="bound">c</span> <span class="bound">w</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="bound">p</span><span class="main">)</span> <span class="main">∧</span> awalk_cost <span class="free">f</span> <span class="bound">c</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">∞</span> <span class="main">&lt;</span> μ <span class="free">f</span> <span class="free">u</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ereal_MInfty_lessI notI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> <span class="main">-</span> <span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_props<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ex_cyc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span> <span class="bound">c</span><span class="main">.</span> awalk <span class="bound">w</span> <span class="bound">c</span> <span class="bound">w</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∧</span> awalk_cost <span class="free">f</span> <span class="bound">c</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">atomize_elim</span> <span class="main">(</span><span class="operator">rule</span> neg_inf_imp_neg_cyc<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> no_neg_cyc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Shortest_Path-μ_reach_conv"><span class="command">lemma</span></span> μ_reach_conv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"μ <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">⟷</span> <span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> awalk <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> μ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">safe</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_ereal_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reachable_awalk<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_props<span class="main">:</span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> reachable_awalk apath_awalk_to_apath<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">p</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> apath <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">p</span><span class="main">∈</span> <span class="main">{</span><span class="skolem">p</span><span class="main">}</span><span class="main">.</span> ereal <span class="main">(</span>awalk_cost <span class="free">f</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> μ_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> INF_superset_mono<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Shortest_Path-awalk_to_path_no_neg_cyc_cost"><span class="command">lemma</span></span> awalk_to_path_no_neg_cyc_cost<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> p_props<span class="main">:</span><span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> no_neg_cyc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">w</span> <span class="bound">c</span><span class="main">.</span> awalk <span class="bound">w</span> <span class="bound">c</span> <span class="bound">w</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="free">p</span><span class="main">)</span> <span class="main">∧</span> awalk_cost <span class="free">f</span> <span class="bound">c</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"awalk_cost <span class="free">f</span> <span class="main">(</span>awalk_to_apath <span class="free">p</span><span class="main">)</span> <span class="main">≤</span> awalk_cost <span class="free">f</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> awalk_to_apath_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> path <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_to_apath.simps<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>decomp <span class="skolem">p</span> <span class="skolem">q</span> <span class="skolem">r</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> decomp<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_awalk_cyc_decomp <span class="skolem">p</span> <span class="main">(</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">r</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> awalk_cyc_decomp_has_prop<span class="main">[</span><span class="operator">OF</span> decomp<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> decomp_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="skolem">r</span> <span class="main">@</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span><span class="main">.</span> awalk <span class="bound">w</span> <span class="skolem">r</span> <span class="bound">w</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk_cost <span class="free">f</span> <span class="main">(</span>awalk_to_apath <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> awalk_cost <span class="free">f</span> <span class="main">(</span>awalk_to_apath <span class="main">(</span><span class="skolem">q</span> <span class="main">@</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> decomp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> step_awalk_to_apath<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">s</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> awalk_cost <span class="free">f</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">@</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">@</span> <span class="skolem">s</span><span class="main">)</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>›</span></span> decomp_props <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> awalk_ends_eqD<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">@</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="skolem">r</span> <span class="main">@</span> <span class="skolem">s</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_awalk_verts<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> decomp.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> decomp.hyps<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> awalk_cost <span class="free">f</span> <span class="skolem">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="skolem">q</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">w</span> <span class="skolem">r</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">w</span> <span class="skolem">s</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> decomp <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> awalk_cyc_decompE<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="skolem">r</span> <span class="main">@</span> <span class="skolem">s</span>›</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>›</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="free">u</span> <span class="skolem">q</span> <span class="skolem">w</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_awalk_verts<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> awalk_cost <span class="free">f</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="skolem">w</span> <span class="skolem">r</span> <span class="skolem">w</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> decomp.prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_less<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">@</span> <span class="skolem">r</span> <span class="main">@</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> no_neg_cyc_reach_imp_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> reach<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> no_neg_cyc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> awalk <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span>
    <span class="main">⟹</span> <span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">w</span> <span class="bound">c</span><span class="main">.</span> awalk <span class="bound">w</span> <span class="bound">c</span> <span class="bound">w</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">u</span> <span class="bound">p</span><span class="main">)</span> <span class="main">∧</span> awalk_cost <span class="free">f</span> <span class="bound">c</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> apath <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span> <span class="main">∧</span> μ <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> awalk_cost <span class="free">f</span> <span class="bound">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">set_walks</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">set_walks</span> <span class="main">=</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> awalk <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">set_paths</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">set_paths</span> <span class="main">=</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> apath <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">set_paths</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"apath <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> reach <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> apath_awalk_to_apath reachable_awalk<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_paths_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">f</span> <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">p</span><span class="main">∈</span> <span class="skolem">set_walks</span><span class="main">.</span> ereal <span class="main">(</span>awalk_cost <span class="free">f</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> μ_def set_walks_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">p</span><span class="main">∈</span> <span class="skolem">set_paths</span><span class="main">.</span> ereal <span class="main">(</span>awalk_cost <span class="free">f</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk_to_apath <span class="main">`</span> <span class="skolem">set_walks</span> <span class="main">⊆</span> <span class="skolem">set_paths</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set_walks_def set_paths_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> subsetI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> apath_awalk_to_apath<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">p</span><span class="main">∈</span> <span class="skolem">set_paths</span><span class="main">.</span> ereal <span class="main">(</span>awalk_cost <span class="free">f</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>
      <span class="main">≤</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">p</span><span class="main">∈</span> awalk_to_apath <span class="main">`</span> <span class="skolem">set_walks</span><span class="main">.</span> ereal <span class="main">(</span>awalk_cost <span class="free">f</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> INF_superset_mono<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">p</span><span class="main">∈</span> <span class="skolem">set_walks</span><span class="main">.</span> ereal <span class="main">(</span>awalk_cost <span class="free">f</span> <span class="main">(</span>awalk_to_apath <span class="bound">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_comp<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">p</span><span class="main">∈</span> <span class="skolem">set_walks</span><span class="main">.</span> ereal <span class="main">(</span>awalk_cost <span class="free">f</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="skolem">set_walks</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_walks_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk_cost <span class="free">f</span> <span class="main">(</span>awalk_to_apath <span class="skolem">p</span><span class="main">)</span> <span class="main">≤</span> awalk_cost <span class="free">f</span> <span class="skolem">p</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> no_neg_cyc
          <span class="keyword1"><span class="command">using</span></span> no_neg_cyc <span class="keyword2"><span class="keyword">and</span></span> awalk_to_path_no_neg_cyc_cost
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> INF_mono<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">p</span><span class="main">∈</span> <span class="skolem">set_paths</span><span class="main">.</span> ereal <span class="main">(</span>awalk_cost <span class="free">f</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>
      <span class="main">≤</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">p</span><span class="main">∈</span> <span class="skolem">set_walks</span><span class="main">.</span> ereal <span class="main">(</span>awalk_cost <span class="free">f</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">set_paths</span> <span class="main">⊆</span> <span class="skolem">set_walks</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> set_paths_def set_walks_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">INF</span> <span class="bound">p</span><span class="main">∈</span> <span class="skolem">set_walks</span><span class="main">.</span> ereal <span class="main">(</span>awalk_cost <span class="free">f</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>
      <span class="main">≤</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">p</span><span class="main">∈</span> <span class="skolem">set_paths</span><span class="main">.</span> ereal <span class="main">(</span>awalk_cost <span class="free">f</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> INF_superset_mono<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> ereal <span class="main">(</span>awalk_cost <span class="free">f</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="skolem">set_paths</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> apaths_finite <span class="quoted"><span class="quoted">‹<span class="skolem">set_paths</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> finite_INF_in<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_paths_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_paths_def image_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> min_cost_awalk<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> reach<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pos_cost<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> <span class="free">c</span> <span class="bound">e</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> apath <span class="free">u</span> <span class="bound">p</span> <span class="free">v</span> <span class="main">∧</span> μ <span class="free">c</span> <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> awalk_cost <span class="free">c</span> <span class="bound">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> pc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span> <span class="bound">p</span> <span class="bound">v</span><span class="main">.</span> awalk <span class="bound">u</span> <span class="bound">p</span> <span class="bound">v</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> awalk_cost <span class="free">c</span> <span class="bound">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pos_cost_pos_awalk_cost pos_cost <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

  <span class="keyword1"><span class="command">from</span></span> reach <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> no_neg_cyc_reach_imp_path<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> not_less <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> pc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> pos_cost_mu_triangle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pos_cost<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> <span class="free">c</span> <span class="bound">e</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="comment1">(* introduce predicate? *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> e_props<span class="main">:</span> <span class="quoted"><span class="quoted">"arc_to_ends <span class="free">G</span> <span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">≤</span> μ <span class="free">c</span> <span class="free">s</span> <span class="free">u</span> <span class="main">+</span> <span class="free">c</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">u</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">u</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span><span class="main">.</span> awalk <span class="free">s</span> <span class="bound">p</span> <span class="free">u</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> μ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">safe</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_ereal_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reachable_awalk<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> pos_cost
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_props<span class="main">:</span> <span class="quoted"><span class="quoted">"apath <span class="free">s</span> <span class="skolem">p</span> <span class="free">u</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> p_cost<span class="main">:</span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">u</span> <span class="main">=</span> awalk_cost <span class="free">c</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> min_cost_awalk<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">u</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> e_props <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_to_ends_def awalk_simps<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹apath <span class="free">s</span> <span class="skolem">p</span> <span class="free">u</span>›</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">s</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">@</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span><span class="main">)</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def awalk_appendI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">≤</span> awalk_cost <span class="free">c</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">@</span> <span class="main">[</span><span class="free">e</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> min_cost_le_walk_cost<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> awalk_cost <span class="free">c</span> <span class="skolem">p</span> <span class="main">+</span> <span class="free">c</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> μ <span class="free">c</span> <span class="free">s</span> <span class="free">u</span> <span class="main">+</span> <span class="free">c</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_cost <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> mu_exact_triangle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nonneg_arcs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">c</span> <span class="bound">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">u</span> <span class="free">e</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">=</span> μ <span class="free">c</span> <span class="free">s</span> <span class="free">u</span> <span class="main">+</span> <span class="free">c</span> <span class="free">e</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"arc <span class="free">e</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> p_path<span class="main">:</span> <span class="quoted"><span class="quoted">"apath <span class="free">s</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p_cost<span class="main">:</span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">=</span> awalk_cost <span class="free">c</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> min_cost_awalk<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> p'_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="free">s</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_cases<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">s</span> <span class="skolem">p'</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"awalk <span class="skolem">u</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹apath <span class="free">s</span> <span class="skolem">p</span> <span class="free">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> apath_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> mu_le<span class="main">:</span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">≤</span> μ <span class="free">c</span> <span class="free">s</span> <span class="skolem">u</span> <span class="main">+</span> <span class="free">c</span> <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> arc<span class="main">:</span> <span class="quoted"><span class="quoted">"arc <span class="skolem">e</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nonneg_arcs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> pos_cost_mu_triangle <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_to_ends_def arc_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="skolem">u</span> <span class="main">+</span> <span class="free">c</span> <span class="skolem">e</span> <span class="main">≤</span> ereal <span class="main">(</span>awalk_cost <span class="free">c</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">+</span> ereal <span class="main">(</span><span class="free">c</span> <span class="skolem">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹awalk <span class="free">s</span> <span class="skolem">p'</span> <span class="skolem">u</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> add_right_mono min_cost_le_walk_cost<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> awalk_cost <span class="free">c</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p'_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_cost <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">=</span> μ <span class="free">c</span> <span class="free">s</span> <span class="skolem">u</span> <span class="main">+</span> <span class="free">c</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mu_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> arc <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> mu_exact_triangle_Ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">c</span> <span class="bound">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span> <span class="bound">e</span><span class="main">.</span> μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">=</span> μ <span class="free">c</span> <span class="free">s</span> <span class="bound">u</span> <span class="main">+</span> <span class="free">c</span> <span class="bound">e</span> <span class="main">∧</span> arc <span class="bound">e</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mu_exact_triangle<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> mu_Inf_triangle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">c</span> <span class="bound">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">=</span> Inf <span class="main">{</span>μ <span class="free">c</span> <span class="free">s</span> <span class="bound">u</span> <span class="main">+</span> <span class="free">c</span> <span class="bound">e</span> <span class="main">|</span> <span class="bound">u</span> <span class="bound">e</span><span class="main">.</span> arc <span class="bound">e</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> Inf <span class="var">?S</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">=</span> μ <span class="free">c</span> <span class="free">s</span> <span class="skolem">u</span> <span class="main">+</span> <span class="free">c</span> <span class="skolem">e</span>"</span></span> <span class="quoted"><span class="quoted">"arc <span class="skolem">e</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mu_exact_triangle<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf <span class="var">?S</span> <span class="main">≤</span> μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Complete_Lattices.Inf_lower<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> Inf <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Complete_Lattices.Inf_greatest pos_cost_mu_triangle
      <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> arc_def arc_to_ends_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">s</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> shortest_path_inf<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="var">?S</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">=</span> Inf <span class="skolem">S</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">=</span> <span class="main">∞</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top_ereal_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"arc <span class="skolem">e</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_val<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> μ <span class="free">c</span> <span class="free">s</span> <span class="skolem">u</span> <span class="main">+</span> <span class="free">c</span> <span class="skolem">e</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> S_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="free">s</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">s</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> reachable_arc_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="skolem">u</span> <span class="main">+</span> <span class="free">c</span> <span class="skolem">e</span><span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> shortest_path_inf<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x_val <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="main">{</span><span class="main">∞</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">=</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Graph_Theory">
<div class="head">
<h1>Theory Graph_Theory</h1>
</div>
<pre class="source">  <span class="comment1">(* Title:  Graph_Theory.thy
   Author: Lars Noschinski, TU München
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Graph_Theory
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="Digraph.html">Digraph</a>
  <a href="Bidirected_Digraph.html">Bidirected_Digraph</a>
  <a href="Arc_Walk.html">Arc_Walk</a>

  <a href="Digraph_Component.html">Digraph_Component</a>
  <a href="Digraph_Component_Vwalk.html">Digraph_Component_Vwalk</a>
  <a href="Digraph_Isomorphism.html">Digraph_Isomorphism</a>
  <a href="Pair_Digraph.html">Pair_Digraph</a>
  <a href="Vertex_Walk.html">Vertex_Walk</a>
  <a href="Subdivision.html">Subdivision</a>

  <a href="Euler.html">Euler</a>
  <a href="Kuratowski.html">Kuratowski</a>
  <a href="Shortest_Path.html">Shortest_Path</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>