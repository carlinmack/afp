<div id="AutoProj">
<div class="head">
<h1>Theory AutoProj</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow
    Copyright   1998 TUM

Is there an optimal order of arguments for `next'?
Currently we can have laws like `delta A (a#w) = delta A w o delta A a'
Otherwise we could have `acceps A == fin A o delta A (start A)'
and use foldl instead of foldl2.
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Projection functions for automata"</span></span>

<span class="keyword1"><span class="command">theory</span></span> AutoProj
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">start</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">*</span> <span class="tfree">'b</span> <span class="main">*</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">start</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> fst <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity">next</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">*</span> <span class="tfree">'b</span> <span class="main">*</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">next</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> fst<span class="main">(</span>snd<span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fin</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">*</span> <span class="tfree">'b</span> <span class="main">*</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'c</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fin</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> snd<span class="main">(</span>snd<span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"start<span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>start_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"next<span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>next_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fin<span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">d</span><span class="main">,</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>fin_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="DA">
<div class="head">
<h1>Theory DA</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow
    Copyright   1998 TUM
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Deterministic automata"</span></span>

<span class="keyword1"><span class="command">theory</span></span> DA
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#AutoProj">AutoProj</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span>da <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> <span class="main">*</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="tfree">'s</span> <span class="main">⇒</span> bool<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">foldl2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">foldl2</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> foldl <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">b</span> <span class="bound">a</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">delta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span>da <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'s</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">delta</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> foldl2 <span class="main">(</span>next <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">accepts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span>da <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">accepts</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">w</span><span class="main">.</span> fin <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>delta <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">w</span> <span class="main">(</span>start <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"foldl2 <span class="free">f</span> <span class="main">[]</span> <span class="free">a</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> foldl2 <span class="free">f</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> foldl2 <span class="free">f</span> <span class="free">xs</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>foldl2_def<span class="main">)</span>

<span class="keyword1" id="DA-delta_Nil"><span class="command">lemma</span></span> delta_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"delta <span class="free">A</span> <span class="main">[]</span> <span class="free">s</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>delta_def<span class="main">)</span>

<span class="keyword1" id="DA-delta_Cons"><span class="command">lemma</span></span> delta_Cons<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"delta <span class="free">A</span> <span class="main">(</span><span class="free">a</span><span class="main">#</span><span class="free">w</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> delta <span class="free">A</span> <span class="free">w</span> <span class="main">(</span>next <span class="free">A</span> <span class="free">a</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>delta_def<span class="main">)</span>

<span class="keyword1" id="DA-delta_append"><span class="command">lemma</span></span> delta_append<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span> <span class="bound">ys</span><span class="main">.</span> delta <span class="free">A</span> <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="bound">ys</span><span class="main">)</span> <span class="bound">q</span> <span class="main">=</span> delta <span class="free">A</span> <span class="bound">ys</span> <span class="main">(</span>delta <span class="free">A</span> <span class="free">xs</span> <span class="bound">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="NA">
<div class="head">
<h1>Theory NA</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow
    Copyright   1998 TUM
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Nondeterministic automata"</span></span>

<span class="keyword1"><span class="command">theory</span></span> NA
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#AutoProj">AutoProj</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span> na <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'s</span> <span class="main">*</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'s</span> set<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="tfree">'s</span> <span class="main">⇒</span> bool<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">delta</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span>na <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'s</span> <span class="main">⇒</span> <span class="tfree">'s</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">delta</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">[]</span>    <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">}</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">delta</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> Union<span class="main">(</span><span class="free">delta</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">`</span> next <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">accepts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span>na <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">accepts</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">q</span> <span class="main">∈</span> delta <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">(</span>start <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">.</span> fin <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">q</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">step</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span>na <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'s</span> <span class="main">*</span> <span class="tfree">'s</span><span class="main">)</span>set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">step</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span> <span class="main">.</span> <span class="bound">q</span> <span class="main">:</span> next <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">p</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">steps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span>na <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'s</span> <span class="main">*</span> <span class="tfree">'s</span><span class="main">)</span>set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">steps</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">[]</span> <span class="main">=</span> Id"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">steps</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">=</span> step <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>  <span class="keyword1">O</span>  <span class="free">steps</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>

<span class="keyword1" id="NA-steps_append"><span class="command">lemma</span></span> steps_append<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"steps <span class="free">A</span> <span class="main">(</span><span class="free">v</span><span class="main">@</span><span class="free">w</span><span class="main">)</span> <span class="main">=</span> steps <span class="free">A</span> <span class="free">v</span>  <span class="keyword1">O</span>  steps <span class="free">A</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>O_assoc<span class="main">)</span>

<span class="keyword1" id="NA-in_steps_append"><span class="command">lemma</span></span> in_steps_append<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">A</span> <span class="main">(</span><span class="free">v</span><span class="main">@</span><span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>steps <span class="free">A</span> <span class="free">v</span> <span class="keyword1">O</span> steps <span class="free">A</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> steps_append<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> equalityE<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NA-delta_conv_steps"><span class="command">lemma</span></span> delta_conv_steps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> delta <span class="free">A</span> <span class="free">w</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">{</span><span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">A</span> <span class="free">w</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>step_def<span class="main">)</span>

<span class="keyword1" id="NA-accepts_conv_steps"><span class="command">lemma</span></span> accepts_conv_steps<span class="main">:</span>
 <span class="quoted"><span class="quoted">"accepts <span class="free">A</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="main">(</span>start <span class="free">A</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span> <span class="main">∈</span> steps <span class="free">A</span> <span class="free">w</span> <span class="main">∧</span> fin <span class="free">A</span> <span class="bound">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delta_conv_steps accepts_def<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">Cons_syn</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> list set <span class="main">⇒</span> <span class="tfree">'a</span> list set"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">##</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">##</span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> Cons <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="NAe">
<div class="head">
<h1>Theory NAe</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow
    Copyright   1998 TUM
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Nondeterministic automata with epsilon transitions"</span></span>

<span class="keyword1"><span class="command">theory</span></span> NAe
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#NA">NA</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span>nae <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> option<span class="main">,</span><span class="tfree">'s</span><span class="main">)</span>na"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">eps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span>nae <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'s</span> <span class="main">*</span> <span class="tfree">'s</span><span class="main">)</span>set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eps</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> step <span class="free"><span class="bound"><span class="entity">A</span></span></span> None"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">steps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span>nae <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span>   <span class="main">(</span><span class="tfree">'s</span> <span class="main">*</span> <span class="tfree">'s</span><span class="main">)</span>set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">steps</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">(</span>eps <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">steps</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>eps <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="keyword1">O</span> step <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="keyword1">O</span> <span class="free">steps</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">accepts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span>nae <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">accepts</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="main">(</span>start <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span><span class="bound">q</span><span class="main">)</span> <span class="main">∈</span> steps <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">∧</span> fin <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">q</span><span class="main">)</span>"</span></span>

<span class="comment1">(* not really used:
consts delta :: "('a,'s)nae ⇒ 'a list ⇒ 's ⇒ 's set"
primrec
"delta A [] s = (eps A)<span class="hidden">⇧</span><sup>*</sup> `` {s}"
"delta A (a#w) s = lift(delta A w) (lift(next A (Some a)) ((eps A)<span class="hidden">⇧</span><sup>*</sup> `` {s}))"
*)</span>

<span class="keyword1" id="NAe-steps_epsclosure"><span class="command">lemma</span></span> steps_epsclosure<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eps <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="keyword1">O</span> steps <span class="free">A</span> <span class="free">w</span> <span class="main">=</span> steps <span class="free">A</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> O_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="NAe-in_steps_epsclosure"><span class="command">lemma</span></span> in_steps_epsclosure<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">;</span> <span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">A</span> <span class="free">w</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">A</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> steps_epsclosure<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> equalityE<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NAe-epsclosure_steps"><span class="command">lemma</span></span> epsclosure_steps<span class="main">:</span> <span class="quoted"><span class="quoted">"steps <span class="free">A</span> <span class="free">w</span> <span class="keyword1">O</span> <span class="main">(</span>eps <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">=</span> steps <span class="free">A</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>O_assoc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NAe-in_epsclosure_steps"><span class="command">lemma</span></span> in_epsclosure_steps<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">A</span> <span class="free">w</span><span class="main">;</span> <span class="main">(</span><span class="free">q</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">A</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> epsclosure_steps<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> equalityE<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="NAe-steps_append"><span class="command">lemma</span></span> steps_append<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"steps <span class="free">A</span> <span class="main">(</span><span class="free">v</span><span class="main">@</span><span class="free">w</span><span class="main">)</span> <span class="main">=</span> steps <span class="free">A</span> <span class="free">v</span>  <span class="keyword1">O</span>  steps <span class="free">A</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>O_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="NAe-in_steps_append"><span class="command">lemma</span></span> in_steps_append<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">A</span> <span class="main">(</span><span class="free">v</span><span class="main">@</span><span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>steps <span class="free">A</span> <span class="free">v</span> <span class="keyword1">O</span> steps <span class="free">A</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> steps_append<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> equalityE<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(* Equivalence of steps and delta
* Use "(∃x ∈ f ` A. P x) = (∃a∈A. P(f x))" ?? *
Goal "∀p. (p,q) : steps A w = (q : delta A w p)";
by (induct_tac "w" 1);
 by (Simp_tac 1);
by (asm_simp_tac (simpset() addsimps [comp_def,step_def]) 1);
by (Blast_tac 1);
qed_spec_mp "steps_equiv_delta";
*)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Automata">
<div class="head">
<h1>Theory Automata</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow
    Copyright   1998 TUM
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Conversions between automata"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Automata
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#DA">DA</a> <a href="#NAe">NAe</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">na2da</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span>na <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'s</span> set<span class="main">)</span>da"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">na2da</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span>start <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">}</span><span class="main">,</span> <span class="main">λ</span><span class="bound">a</span> <span class="bound">Q</span><span class="main">.</span> Union<span class="main">(</span>next <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">a</span> <span class="main">`</span> <span class="bound">Q</span><span class="main">)</span><span class="main">,</span> <span class="main">λ</span><span class="bound">Q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">q</span><span class="main">∈</span><span class="bound">Q</span><span class="main">.</span> fin <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">q</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">nae2da</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span>nae <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'s</span> set<span class="main">)</span>da"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">nae2da</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span>start <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">}</span><span class="main">,</span>
              <span class="main">λ</span><span class="bound">a</span> <span class="bound">Q</span><span class="main">.</span> Union<span class="main">(</span>next <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>Some <span class="bound">a</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="main">(</span>eps <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">``</span> <span class="bound">Q</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
              <span class="main">λ</span><span class="bound">Q</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span> <span class="main">∈</span> <span class="main">(</span>eps <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">``</span> <span class="bound">Q</span><span class="main">.</span> fin <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">p</span><span class="main">)</span>"</span></span>

<span class="comment1">(*** Equivalence of NA and DA ***)</span>

<span class="keyword1" id="Automata-DA_delta_is_lift_NA_delta"><span class="command">lemma</span></span> DA_delta_is_lift_NA_delta<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Q</span><span class="main">.</span> DA.delta <span class="main">(</span>na2da <span class="free">A</span><span class="main">)</span> <span class="free">w</span> <span class="bound">Q</span> <span class="main">=</span> Union<span class="main">(</span>NA.delta <span class="free">A</span> <span class="free">w</span> <span class="main">`</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>na2da_def<span class="main">)</span>

<span class="keyword1" id="Automata-NA_DA_equiv"><span class="command">lemma</span></span> NA_DA_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"NA.accepts <span class="free">A</span> <span class="free">w</span> <span class="main">=</span> DA.accepts <span class="main">(</span>na2da <span class="free">A</span><span class="main">)</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DA.accepts_def NA.accepts_def DA_delta_is_lift_NA_delta<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> na2da_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(*** Direct equivalence of NAe and DA ***)</span>

<span class="keyword1" id="Automata-espclosure_DA_delta_is_steps"><span class="command">lemma</span></span> espclosure_DA_delta_is_steps<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Q</span><span class="main">.</span> <span class="main">(</span>eps <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">``</span> <span class="main">(</span>DA.delta <span class="main">(</span>nae2da <span class="free">A</span><span class="main">)</span> <span class="free">w</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">=</span> steps <span class="free">A</span> <span class="free">w</span> <span class="main">``</span> <span class="bound">Q</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> step_def nae2da_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Automata-NAe_DA_equiv"><span class="command">lemma</span></span> NAe_DA_equiv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"DA.accepts <span class="main">(</span>nae2da <span class="free">A</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> NAe.accepts <span class="free">A</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Q</span><span class="main">.</span> fin <span class="main">(</span>nae2da <span class="free">A</span><span class="main">)</span> <span class="bound">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">q</span> <span class="main">∈</span> <span class="main">(</span>eps <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">``</span> <span class="bound">Q</span><span class="main">.</span> fin <span class="free">A</span> <span class="bound">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nae2da_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>espclosure_DA_delta_is_steps NAe.accepts_def DA.accepts_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>nae2da_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="RegExp2NA">
<div class="head">
<h1>Theory RegExp2NA</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow
    Copyright   1998 TUM
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"From regular expressions directly to nondeterministic automata"</span></span>

<span class="keyword1"><span class="command">theory</span></span> RegExp2NA
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../Regular-Sets/Regular_Exp.html">Regular-Sets.Regular_Exp</a>"</span> <a href="#NA">NA</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> bitsNA <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span>bool list<span class="main">)</span>na"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted">"<span class="entity">atom</span>"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> bitsNA"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">atom</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span>True<span class="main">]</span><span class="main">,</span>
            <span class="main">λ</span><span class="bound">b</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span><span class="main">=</span><span class="main">[</span>True<span class="main">]</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="main">{</span><span class="main">[</span>False<span class="main">]</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">,</span>
            <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span><span class="main">=</span><span class="main">[</span>False<span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">or</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bitsNA <span class="main">⇒</span> <span class="tfree">'a</span> bitsNA <span class="main">⇒</span> <span class="tfree">'a</span> bitsNA"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">or</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ql</span><span class="main">,</span><span class="bound">dl</span><span class="main">,</span><span class="bound">fl</span><span class="main">)</span><span class="main">(</span><span class="bound">qr</span><span class="main">,</span><span class="bound">dr</span><span class="main">,</span><span class="bound">fr</span><span class="main">)</span><span class="main">.</span>
   <span class="main">(</span><span class="main">[]</span><span class="main">,</span>
    <span class="main">λ</span><span class="bound">a</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">s</span> <span class="keyword1">of</span>
            <span class="main">[]</span> <span class="main">⇒</span> <span class="main">(</span>True <span class="main">##</span> <span class="bound">dl</span> <span class="bound">a</span> <span class="bound">ql</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>False <span class="main">##</span> <span class="bound">dr</span> <span class="bound">a</span> <span class="bound">qr</span><span class="main">)</span>
          <span class="main">|</span> <span class="bound">left</span><span class="main">#</span><span class="bound">s</span> <span class="main">⇒</span> <span class="keyword1">if</span> <span class="bound">left</span> <span class="keyword1">then</span> True <span class="main">##</span> <span class="bound">dl</span> <span class="bound">a</span> <span class="bound">s</span>
                              <span class="keyword1">else</span> False <span class="main">##</span> <span class="bound">dr</span> <span class="bound">a</span> <span class="bound">s</span><span class="main">,</span>
    <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">s</span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">fl</span> <span class="bound">ql</span> <span class="main">|</span> <span class="bound">fr</span> <span class="bound">qr</span><span class="main">)</span>
                <span class="main">|</span> <span class="bound">left</span><span class="main">#</span><span class="bound">s</span> <span class="main">⇒</span> <span class="keyword1">if</span> <span class="bound">left</span> <span class="keyword1">then</span> <span class="bound">fl</span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="bound">fr</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">conc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bitsNA <span class="main">⇒</span> <span class="tfree">'a</span> bitsNA <span class="main">⇒</span> <span class="tfree">'a</span> bitsNA"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">conc</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ql</span><span class="main">,</span><span class="bound">dl</span><span class="main">,</span><span class="bound">fl</span><span class="main">)</span><span class="main">(</span><span class="bound">qr</span><span class="main">,</span><span class="bound">dr</span><span class="main">,</span><span class="bound">fr</span><span class="main">)</span><span class="main">.</span>
   <span class="main">(</span>True<span class="main">#</span><span class="bound">ql</span><span class="main">,</span>
    <span class="main">λ</span><span class="bound">a</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">s</span> <span class="keyword1">of</span>
            <span class="main">[]</span> <span class="main">⇒</span> <span class="main">{}</span>
          <span class="main">|</span> <span class="bound">left</span><span class="main">#</span><span class="bound">s</span> <span class="main">⇒</span> <span class="keyword1">if</span> <span class="bound">left</span> <span class="keyword1">then</span> <span class="main">(</span>True <span class="main">##</span> <span class="bound">dl</span> <span class="bound">a</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∪</span>
                                   <span class="main">(</span><span class="keyword1">if</span> <span class="bound">fl</span> <span class="bound">s</span> <span class="keyword1">then</span> False <span class="main">##</span> <span class="bound">dr</span> <span class="bound">a</span> <span class="bound">qr</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>
                              <span class="keyword1">else</span> False <span class="main">##</span> <span class="bound">dr</span> <span class="bound">a</span> <span class="bound">s</span><span class="main">,</span>
    <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">s</span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> False <span class="main">|</span> <span class="bound">left</span><span class="main">#</span><span class="bound">s</span> <span class="main">⇒</span> <span class="bound">left</span> <span class="main">∧</span> <span class="bound">fl</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">fr</span> <span class="bound">qr</span> <span class="main">|</span> <span class="main">¬</span><span class="bound">left</span> <span class="main">∧</span> <span class="bound">fr</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">epsilon</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bitsNA"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">epsilon</span> <span class="main">=</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">s</span><span class="main">.</span> <span class="main">{}</span><span class="main">,</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span><span class="main">=</span><span class="main">[]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">plus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bitsNA <span class="main">⇒</span> <span class="tfree">'a</span> bitsNA"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">plus</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">d</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">q</span><span class="main">,</span> <span class="main">λ</span><span class="bound">a</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">d</span> <span class="bound">a</span> <span class="bound">s</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">f</span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="bound">d</span> <span class="bound">a</span> <span class="bound">q</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span><span class="main">,</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">star</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bitsNA <span class="main">⇒</span> <span class="tfree">'a</span> bitsNA"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">star</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> or epsilon <span class="main">(</span>plus <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">rexp2na</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rexp <span class="main">⇒</span> <span class="tfree">'a</span> bitsNA"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">rexp2na</span> Zero       <span class="main">=</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">λ</span><span class="bound">a</span> <span class="bound">s</span><span class="main">.</span> <span class="main">{}</span><span class="main">,</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> False<span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">rexp2na</span> One        <span class="main">=</span> epsilon"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">rexp2na</span><span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>    <span class="main">=</span> atom <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">rexp2na</span><span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>  <span class="main">=</span> or <span class="main">(</span><span class="free">rexp2na</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">rexp2na</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">rexp2na</span><span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> conc <span class="main">(</span><span class="free">rexp2na</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">rexp2na</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">rexp2na</span><span class="main">(</span>Star <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>    <span class="main">=</span> star <span class="main">(</span><span class="free">rexp2na</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> split_paired_all<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="comment1">(******************************************************)</span>
<span class="comment1">(*                       atom                         *)</span>
<span class="comment1">(******************************************************)</span>

<span class="keyword1" id="RegExp2NA-fin_atom"><span class="command">lemma</span></span> fin_atom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fin <span class="main">(</span>atom <span class="free">a</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">q</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>atom_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NA-start_atom"><span class="command">lemma</span></span> start_atom<span class="main">:</span> <span class="quoted"><span class="quoted">"start <span class="main">(</span>atom <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>atom_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NA-in_step_atom_Some"><span class="command">lemma</span></span> in_step_atom_Some<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> step <span class="main">(</span>atom <span class="free">a</span><span class="main">)</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">=</span><span class="main">[</span>True<span class="main">]</span> <span class="main">∧</span> <span class="free">q</span><span class="main">=</span><span class="main">[</span>False<span class="main">]</span> <span class="main">∧</span> <span class="free">b</span><span class="main">=</span><span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> atom_def step_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NA-False_False_in_steps_atom"><span class="command">lemma</span></span> False_False_in_steps_atom<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>False<span class="main">]</span><span class="main">,</span><span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">:</span> steps <span class="main">(</span>atom <span class="free">a</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relcomp_unfold<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NA-start_fin_in_steps_atom"><span class="command">lemma</span></span> start_fin_in_steps_atom<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>start <span class="main">(</span>atom <span class="free">a</span><span class="main">)</span><span class="main">,</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">:</span> steps <span class="main">(</span>atom <span class="free">a</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">=</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> start_atom<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False_False_in_steps_atom relcomp_unfold start_atom<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NA-accepts_atom"><span class="command">lemma</span></span> accepts_atom<span class="main">:</span>
 <span class="quoted"><span class="quoted">"accepts <span class="main">(</span>atom <span class="free">a</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">=</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_conv_steps start_fin_in_steps_atom fin_atom<span class="main">)</span>

<span class="comment1">(******************************************************)</span>
<span class="comment1">(*                      or                            *)</span>
<span class="comment1">(******************************************************)</span>

<span class="comment1">(***** lift True/False over fin *****)</span>

<span class="keyword1" id="RegExp2NA-fin_or_True"><span class="command">lemma</span></span> fin_or_True<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> fin <span class="main">(</span>or <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> fin <span class="bound">L</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>or_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NA-fin_or_False"><span class="command">lemma</span></span> fin_or_False<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> fin <span class="main">(</span>or <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="main">(</span>False<span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> fin <span class="bound">R</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>or_def<span class="main">)</span>

<span class="comment1">(***** lift True/False over step *****)</span>

<span class="keyword1" id="RegExp2NA-True_in_step_or"><span class="command">lemma</span></span> True_in_step_or<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> <span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> step <span class="main">(</span>or <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">q</span> <span class="main">=</span> True<span class="main">#</span><span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> step <span class="bound">L</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>or_def step_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NA-False_in_step_or"><span class="command">lemma</span></span> False_in_step_or<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> <span class="main">(</span>False<span class="main">#</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> step <span class="main">(</span>or <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">q</span> <span class="main">=</span> False<span class="main">#</span><span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> step <span class="bound">R</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>or_def step_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="comment1">(***** lift True/False over steps *****)</span>

<span class="keyword1" id="RegExp2NA-lift_True_over_steps_or"><span class="command">lemma</span></span> lift_True_over_steps_or<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span>True<span class="main">#</span><span class="bound">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span><span class="main">∈</span>steps <span class="main">(</span>or <span class="free">L</span> <span class="free">R</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">q</span> <span class="main">=</span> True <span class="main">#</span> <span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> steps <span class="free">L</span> <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NA-lift_False_over_steps_or"><span class="command">lemma</span></span> lift_False_over_steps_or<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span>False<span class="main">#</span><span class="bound">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span><span class="main">∈</span>steps <span class="main">(</span>or <span class="free">L</span> <span class="free">R</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">q</span> <span class="main">=</span> False<span class="main">#</span><span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">∈</span>steps <span class="free">R</span> <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(** From the start  **)</span>

<span class="keyword1" id="RegExp2NA-start_step_or"><span class="command">lemma</span></span> start_step_or<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> <span class="main">(</span>start<span class="main">(</span>or <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> step<span class="main">(</span>or <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> 
         <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">q</span> <span class="main">=</span> True<span class="main">#</span><span class="bound">p</span> <span class="main">∧</span> <span class="main">(</span>start <span class="bound">L</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span> <span class="main">:</span> step <span class="bound">L</span> <span class="free">a</span><span class="main">)</span> <span class="main">|</span> 
               <span class="main">(</span><span class="free">q</span> <span class="main">=</span> False<span class="main">#</span><span class="bound">p</span> <span class="main">∧</span> <span class="main">(</span>start <span class="bound">R</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span> <span class="main">:</span> step <span class="bound">R</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>or_def step_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NA-steps_or"><span class="command">lemma</span></span> steps_or<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>start<span class="main">(</span>or <span class="free">L</span> <span class="free">R</span><span class="main">)</span><span class="main">,</span> <span class="free">q</span><span class="main">)</span> <span class="main">:</span> steps <span class="main">(</span>or <span class="free">L</span> <span class="free">R</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> 
  <span class="main">(</span> <span class="main">(</span><span class="free">w</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> start<span class="main">(</span>or <span class="free">L</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> 
    <span class="main">(</span><span class="free">w</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span>  <span class="free">q</span> <span class="main">=</span> True  <span class="main">#</span> <span class="bound">p</span> <span class="main">∧</span> <span class="main">(</span>start <span class="free">L</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">L</span> <span class="free">w</span> <span class="main">|</span> 
                      <span class="free">q</span> <span class="main">=</span> False <span class="main">#</span> <span class="bound">p</span> <span class="main">∧</span> <span class="main">(</span>start <span class="free">R</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">R</span> <span class="free">w</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NA-fin_start_or"><span class="command">lemma</span></span> fin_start_or<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> fin <span class="main">(</span>or <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="main">(</span>start<span class="main">(</span>or <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fin <span class="bound">L</span> <span class="main">(</span>start <span class="bound">L</span><span class="main">)</span> <span class="main">|</span> fin <span class="bound">R</span> <span class="main">(</span>start <span class="bound">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>or_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NA-accepts_or"><span class="command">lemma</span></span> accepts_or<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"accepts <span class="main">(</span>or <span class="free">L</span> <span class="free">R</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span>accepts <span class="free">L</span> <span class="free">w</span> <span class="main">|</span> accepts <span class="free">R</span> <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_conv_steps steps_or<span class="main">)</span>
<span class="comment1">(* get rid of case_tac: *)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(******************************************************)</span>
<span class="comment1">(*                      conc                        *)</span>
<span class="comment1">(******************************************************)</span>

<span class="comment1">(** True/False in fin **)</span>

<span class="keyword1" id="RegExp2NA-fin_conc_True"><span class="command">lemma</span></span> fin_conc_True<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> fin <span class="main">(</span>conc <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fin <span class="bound">L</span> <span class="free">p</span> <span class="main">∧</span> fin <span class="bound">R</span> <span class="main">(</span>start <span class="bound">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>conc_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NA-fin_conc_False"><span class="command">lemma</span></span> fin_conc_False<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> fin <span class="main">(</span>conc <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="main">(</span>False<span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> fin <span class="bound">R</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>conc_def<span class="main">)</span>


<span class="comment1">(** True/False in step **)</span>

<span class="keyword1" id="RegExp2NA-True_step_conc"><span class="command">lemma</span></span> True_step_conc<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> <span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> step <span class="main">(</span>conc <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> 
        <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">q</span><span class="main">=</span>True<span class="main">#</span><span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">:</span> step <span class="bound">L</span> <span class="free">a</span><span class="main">)</span> <span class="main">|</span> 
         <span class="main">(</span>fin <span class="bound">L</span> <span class="free">p</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">q</span><span class="main">=</span>False<span class="main">#</span><span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span>start <span class="bound">R</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">:</span> step <span class="bound">R</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>conc_def step_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NA-False_step_conc"><span class="command">lemma</span></span> False_step_conc<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> <span class="main">(</span>False<span class="main">#</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> step <span class="main">(</span>conc <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> 
       <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">q</span> <span class="main">=</span> False<span class="main">#</span><span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">:</span> step <span class="bound">R</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>conc_def step_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(** False in steps **)</span>

<span class="keyword1" id="RegExp2NA-False_steps_conc"><span class="command">lemma</span></span> False_steps_conc<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span>False<span class="main">#</span><span class="bound">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span><span class="main">:</span> steps <span class="main">(</span>conc <span class="free">L</span> <span class="free">R</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">q</span><span class="main">=</span>False<span class="main">#</span><span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">:</span> steps <span class="free">R</span> <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(** True in steps **)</span>

<span class="keyword1" id="RegExp2NA-True_True_steps_concI"><span class="command">lemma</span></span> True_True_steps_concI<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> steps <span class="bound">L</span> <span class="free">w</span> <span class="main">⟹</span> <span class="main">(</span>True<span class="main">#</span><span class="bound">p</span><span class="main">,</span>True<span class="main">#</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> steps <span class="main">(</span>conc <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NA-True_False_step_conc"><span class="command">lemma</span></span> True_False_step_conc<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> <span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">,</span>False<span class="main">#</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> step <span class="main">(</span>conc <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> 
         <span class="main">(</span>fin <span class="bound">L</span> <span class="free">p</span> <span class="main">∧</span> <span class="main">(</span>start <span class="bound">R</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> step <span class="bound">R</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="RegExp2NA-True_steps_concD"><span class="command">lemma</span></span> True_steps_concD<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span>True<span class="main">#</span><span class="bound">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> steps <span class="main">(</span>conc <span class="free">L</span> <span class="free">R</span><span class="main">)</span> <span class="free">w</span> <span class="main">⟶</span> 
     <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">L</span> <span class="free">w</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> True<span class="main">#</span><span class="bound">r</span><span class="main">)</span>  <span class="main">∨</span> 
  <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">a</span> <span class="bound">v</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> <span class="bound">u</span><span class="main">@</span><span class="bound">a</span><span class="main">#</span><span class="bound">v</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">L</span> <span class="bound">u</span> <span class="main">∧</span> fin <span class="free">L</span> <span class="bound">r</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span>start <span class="free">R</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">:</span> step <span class="free">R</span> <span class="bound">a</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">R</span> <span class="bound">v</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> False<span class="main">#</span><span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>disjCI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>disjCI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">a</span><span class="main">#</span><span class="improper">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NA-True_steps_conc"><span class="command">lemma</span></span> True_steps_conc<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> steps <span class="main">(</span>conc <span class="free">L</span> <span class="free">R</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> 
 <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">L</span> <span class="free">w</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> True<span class="main">#</span><span class="bound">r</span><span class="main">)</span>  <span class="main">∨</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">a</span> <span class="bound">v</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> <span class="bound">u</span><span class="main">@</span><span class="bound">a</span><span class="main">#</span><span class="bound">v</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">L</span> <span class="bound">u</span> <span class="main">∧</span> fin <span class="free">L</span> <span class="bound">r</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span>start <span class="free">R</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">:</span> step <span class="free">R</span> <span class="bound">a</span> <span class="main">∧</span> 
            <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">R</span> <span class="bound">v</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> False<span class="main">#</span><span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> True_steps_concD <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> True_True_steps_concI<span class="main">)</span>

<span class="comment1">(** starting from the start **)</span>

<span class="keyword1" id="RegExp2NA-start_conc"><span class="command">lemma</span></span> start_conc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> start<span class="main">(</span>conc <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="main">=</span> True<span class="main">#</span>start <span class="bound">L</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>conc_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NA-final_conc"><span class="command">lemma</span></span> final_conc<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> fin<span class="main">(</span>conc <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>fin <span class="bound">R</span> <span class="main">(</span>start <span class="bound">R</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> True<span class="main">#</span><span class="bound">s</span> <span class="main">∧</span> fin <span class="bound">L</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
                           <span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> False<span class="main">#</span><span class="bound">s</span> <span class="main">∧</span> fin <span class="bound">R</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>conc_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NA-accepts_conc"><span class="command">lemma</span></span> accepts_conc<span class="main">:</span>
 <span class="quoted"><span class="quoted">"accepts <span class="main">(</span>conc <span class="free">L</span> <span class="free">R</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> <span class="bound">u</span><span class="main">@</span><span class="bound">v</span> <span class="main">∧</span> accepts <span class="free">L</span> <span class="bound">u</span> <span class="main">∧</span> accepts <span class="free">R</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_conv_steps True_steps_conc final_conc start_conc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">v</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(******************************************************)</span>
<span class="comment1">(*                     epsilon                        *)</span>
<span class="comment1">(******************************************************)</span>

<span class="keyword1" id="RegExp2NA-step_epsilon"><span class="command">lemma</span></span> step_epsilon<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"step epsilon <span class="free">a</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>epsilon_def step_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NA-steps_epsilon"><span class="command">lemma</span></span> steps_epsilon<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> steps epsilon <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="main">=</span><span class="main">[]</span> <span class="main">∧</span> <span class="free">p</span><span class="main">=</span><span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="RegExp2NA-accepts_epsilon"><span class="command">lemma</span></span> accepts_epsilon<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"accepts epsilon <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> steps_epsilon accepts_conv_steps<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> epsilon_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(******************************************************)</span>
<span class="comment1">(*                       plus                         *)</span>
<span class="comment1">(******************************************************)</span>

<span class="keyword1" id="RegExp2NA-start_plus"><span class="command">lemma</span></span> start_plus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> start <span class="main">(</span>plus <span class="bound">A</span><span class="main">)</span> <span class="main">=</span> start <span class="bound">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>plus_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NA-fin_plus"><span class="command">lemma</span></span> fin_plus<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> fin <span class="main">(</span>plus <span class="bound">A</span><span class="main">)</span> <span class="main">=</span> fin <span class="bound">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>plus_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NA-step_plusI"><span class="command">lemma</span></span> step_plusI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> step <span class="bound">A</span> <span class="free">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> step <span class="main">(</span>plus <span class="bound">A</span><span class="main">)</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>plus_def step_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NA-steps_plusI"><span class="command">lemma</span></span> steps_plusI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">A</span> <span class="free">w</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">∈</span> steps <span class="main">(</span>plus <span class="free">A</span><span class="main">)</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> step_plusI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NA-step_plus_conv"><span class="command">lemma</span></span> step_plus_conv<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">r</span><span class="main">)</span><span class="main">:</span> step <span class="main">(</span>plus <span class="bound">A</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> 
       <span class="main">(</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">r</span><span class="main">)</span><span class="main">:</span> step <span class="bound">A</span> <span class="free">a</span> <span class="main">|</span> fin <span class="bound">A</span> <span class="free">p</span> <span class="main">∧</span> <span class="main">(</span>start <span class="bound">A</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">:</span> step <span class="bound">A</span> <span class="free">a</span> <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>plus_def step_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NA-fin_steps_plusI"><span class="command">lemma</span></span> fin_steps_plusI<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="main">(</span>start <span class="free">A</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">A</span> <span class="free">u</span><span class="main">;</span> <span class="free">u</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">;</span> fin <span class="free">A</span> <span class="free">p</span> <span class="main">|]</span> 
 <span class="main">==&gt;</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> steps <span class="main">(</span>plus <span class="free">A</span><span class="main">)</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">u</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> steps_plusI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(* reverse list induction! Complicates matters for conc? *)</span>
<span class="keyword1" id="RegExp2NA-start_steps_plusD"><span class="command">lemma</span></span> start_steps_plusD<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>start <span class="free">A</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> steps <span class="main">(</span>plus <span class="free">A</span><span class="main">)</span> <span class="free">w</span> <span class="main">⟶</span>
     <span class="main">(</span><span class="main">∃</span><span class="bound">us</span> <span class="bound">v</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> concat <span class="bound">us</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">∧</span> 
              <span class="main">(</span><span class="main">∀</span><span class="bound">u</span><span class="main">∈</span>set <span class="bound">us</span><span class="main">.</span> accepts <span class="free">A</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∧</span> 
              <span class="main">(</span>start <span class="free">A</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> steps <span class="free">A</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">us</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">us</span><span class="main">@</span><span class="main">[</span><span class="improper">v</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_conv_steps<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NA-steps_star_cycle"><span class="command">lemma</span></span> steps_star_cycle<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">us</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> set <span class="free">us</span><span class="main">.</span> accepts <span class="free">A</span> <span class="bound">u</span><span class="main">)</span> <span class="main">⟶</span> accepts <span class="main">(</span>plus <span class="free">A</span><span class="main">)</span> <span class="main">(</span>concat <span class="free">us</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_conv_steps<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">us</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> u us<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">us</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> steps_plusI fin_steps_plusI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">u</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> steps_plusI fin_steps_plusI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> steps_plusI fin_steps_plusI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NA-accepts_plus"><span class="command">lemma</span></span> accepts_plus<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"accepts <span class="main">(</span>plus <span class="free">A</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> 
 <span class="main">(</span><span class="main">∃</span><span class="bound">us</span><span class="main">.</span> <span class="bound">us</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">w</span> <span class="main">=</span> concat <span class="bound">us</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> set <span class="bound">us</span><span class="main">.</span> accepts <span class="free">A</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_conv_steps<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> start_steps_plusD<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">us</span><span class="main">@</span><span class="main">[</span><span class="improper">v</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_conv_steps<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> steps_star_cycle<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(******************************************************)</span>
<span class="comment1">(*                       star                         *)</span>
<span class="comment1">(******************************************************)</span>

<span class="keyword1" id="RegExp2NA-accepts_star"><span class="command">lemma</span></span> accepts_star<span class="main">:</span>
 <span class="quoted"><span class="quoted">"accepts <span class="main">(</span>star <span class="free">A</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">us</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> set <span class="bound">us</span><span class="main">.</span> accepts <span class="free">A</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∧</span> <span class="free">w</span> <span class="main">=</span> concat <span class="bound">us</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> star_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(***** Correctness of r2n *****)</span>

<span class="keyword1" id="RegExp2NA-accepts_rexp2na"><span class="command">lemma</span></span> accepts_rexp2na<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> accepts <span class="main">(</span>rexp2na <span class="free">r</span><span class="main">)</span> <span class="bound">w</span> <span class="main">=</span> <span class="main">(</span><span class="bound">w</span> <span class="main">:</span> lang <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">r</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_conv_steps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_atom<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_conc Regular_Set.conc_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_star in_star_iff_concat subset_iff Ball_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="RegExp2NAe">
<div class="head">
<h1>Theory RegExp2NAe</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow
    Copyright   1998 TUM
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"From regular expressions to nondeterministic automata with epsilon"</span></span>

<span class="keyword1"><span class="command">theory</span></span> RegExp2NAe
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../Regular-Sets/Regular_Exp.html">Regular-Sets.Regular_Exp</a>"</span> <a href="#NAe">NAe</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> bitsNAe <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span>bool list<span class="main">)</span>nae"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">epsilon</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bitsNAe"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">epsilon</span> <span class="main">=</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">s</span><span class="main">.</span> <span class="main">{}</span><span class="main">,</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span><span class="main">=</span><span class="main">[]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
<span class="quoted">"<span class="entity">atom</span>"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> bitsNAe"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">atom</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span>True<span class="main">]</span><span class="main">,</span>
            <span class="main">λ</span><span class="bound">b</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">s</span><span class="main">=</span><span class="main">[</span>True<span class="main">]</span> <span class="main">∧</span> <span class="bound">b</span><span class="main">=</span>Some <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="main">{</span><span class="main">[</span>False<span class="main">]</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">,</span>
            <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span><span class="main">=</span><span class="main">[</span>False<span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">or</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bitsNAe <span class="main">⇒</span> <span class="tfree">'a</span> bitsNAe <span class="main">⇒</span> <span class="tfree">'a</span> bitsNAe"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">or</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ql</span><span class="main">,</span><span class="bound">dl</span><span class="main">,</span><span class="bound">fl</span><span class="main">)</span><span class="main">(</span><span class="bound">qr</span><span class="main">,</span><span class="bound">dr</span><span class="main">,</span><span class="bound">fr</span><span class="main">)</span><span class="main">.</span>
   <span class="main">(</span><span class="main">[]</span><span class="main">,</span>
    <span class="main">λ</span><span class="bound">a</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">s</span> <span class="keyword1">of</span>
            <span class="main">[]</span> <span class="main">⇒</span> <span class="keyword1">if</span> <span class="bound">a</span><span class="main">=</span>None <span class="keyword1">then</span> <span class="main">{</span>True<span class="main">#</span><span class="bound">ql</span><span class="main">,</span>False<span class="main">#</span><span class="bound">qr</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span>
          <span class="main">|</span> <span class="bound">left</span><span class="main">#</span><span class="bound">s</span> <span class="main">⇒</span> <span class="keyword1">if</span> <span class="bound">left</span> <span class="keyword1">then</span> True <span class="main">##</span> <span class="bound">dl</span> <span class="bound">a</span> <span class="bound">s</span>
                              <span class="keyword1">else</span> False <span class="main">##</span> <span class="bound">dr</span> <span class="bound">a</span> <span class="bound">s</span><span class="main">,</span>
    <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">s</span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> False <span class="main">|</span> <span class="bound">left</span><span class="main">#</span><span class="bound">s</span> <span class="main">⇒</span> <span class="keyword1">if</span> <span class="bound">left</span> <span class="keyword1">then</span> <span class="bound">fl</span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="bound">fr</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">conc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bitsNAe <span class="main">⇒</span> <span class="tfree">'a</span> bitsNAe <span class="main">⇒</span> <span class="tfree">'a</span> bitsNAe"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">conc</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ql</span><span class="main">,</span><span class="bound">dl</span><span class="main">,</span><span class="bound">fl</span><span class="main">)</span><span class="main">(</span><span class="bound">qr</span><span class="main">,</span><span class="bound">dr</span><span class="main">,</span><span class="bound">fr</span><span class="main">)</span><span class="main">.</span>
   <span class="main">(</span>True<span class="main">#</span><span class="bound">ql</span><span class="main">,</span>
    <span class="main">λ</span><span class="bound">a</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">s</span> <span class="keyword1">of</span>
            <span class="main">[]</span> <span class="main">⇒</span> <span class="main">{}</span>
          <span class="main">|</span> <span class="bound">left</span><span class="main">#</span><span class="bound">s</span> <span class="main">⇒</span> <span class="keyword1">if</span> <span class="bound">left</span> <span class="keyword1">then</span> <span class="main">(</span>True <span class="main">##</span> <span class="bound">dl</span> <span class="bound">a</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∪</span>
                                   <span class="main">(</span><span class="keyword1">if</span> <span class="bound">fl</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span>None <span class="keyword1">then</span> <span class="main">{</span>False<span class="main">#</span><span class="bound">qr</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>
                              <span class="keyword1">else</span> False <span class="main">##</span> <span class="bound">dr</span> <span class="bound">a</span> <span class="bound">s</span><span class="main">,</span>
    <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">s</span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> False <span class="main">|</span> <span class="bound">left</span><span class="main">#</span><span class="bound">s</span> <span class="main">⇒</span> <span class="main">¬</span><span class="bound">left</span> <span class="main">∧</span> <span class="bound">fr</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">star</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> bitsNAe <span class="main">⇒</span> <span class="tfree">'a</span> bitsNAe"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">star</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">q</span><span class="main">,</span><span class="bound">d</span><span class="main">,</span><span class="bound">f</span><span class="main">)</span><span class="main">.</span>
   <span class="main">(</span><span class="main">[]</span><span class="main">,</span>
    <span class="main">λ</span><span class="bound">a</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">s</span> <span class="keyword1">of</span>
            <span class="main">[]</span> <span class="main">⇒</span> <span class="keyword1">if</span> <span class="bound">a</span><span class="main">=</span>None <span class="keyword1">then</span> <span class="main">{</span>True<span class="main">#</span><span class="bound">q</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span>
          <span class="main">|</span> <span class="bound">left</span><span class="main">#</span><span class="bound">s</span> <span class="main">⇒</span> <span class="keyword1">if</span> <span class="bound">left</span> <span class="keyword1">then</span> <span class="main">(</span>True <span class="main">##</span> <span class="bound">d</span> <span class="bound">a</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∪</span>
                                   <span class="main">(</span><span class="keyword1">if</span> <span class="bound">f</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">a</span><span class="main">=</span>None <span class="keyword1">then</span> <span class="main">{</span>True<span class="main">#</span><span class="bound">q</span><span class="main">}</span> <span class="keyword1">else</span> <span class="main">{}</span><span class="main">)</span>
                              <span class="keyword1">else</span> <span class="main">{}</span><span class="main">,</span>
    <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">s</span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> True <span class="main">|</span> <span class="bound">left</span><span class="main">#</span><span class="bound">s</span> <span class="main">⇒</span> <span class="bound">left</span> <span class="main">∧</span> <span class="bound">f</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">rexp2nae</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> rexp <span class="main">⇒</span> <span class="tfree">'a</span> bitsNAe"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">rexp2nae</span> Zero       <span class="main">=</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">λ</span><span class="bound">a</span> <span class="bound">s</span><span class="main">.</span> <span class="main">{}</span><span class="main">,</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> False<span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">rexp2nae</span> One        <span class="main">=</span> epsilon"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">rexp2nae</span><span class="main">(</span>Atom <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>    <span class="main">=</span> atom <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">rexp2nae</span><span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>  <span class="main">=</span> or   <span class="main">(</span><span class="free">rexp2nae</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">rexp2nae</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">rexp2nae</span><span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">=</span> conc <span class="main">(</span><span class="free">rexp2nae</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">rexp2nae</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">rexp2nae</span><span class="main">(</span>Star <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>    <span class="main">=</span> star <span class="main">(</span><span class="free">rexp2nae</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> split_paired_all<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="comment1">(******************************************************)</span>
<span class="comment1">(*                     epsilon                        *)</span>
<span class="comment1">(******************************************************)</span>

<span class="keyword1" id="RegExp2NAe-step_epsilon"><span class="command">lemma</span></span> step_epsilon<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"step epsilon <span class="free">a</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>epsilon_def step_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NAe-steps_epsilon"><span class="command">lemma</span></span> steps_epsilon<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> steps epsilon <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span><span class="main">=</span><span class="main">[]</span> <span class="main">∧</span> <span class="free">p</span><span class="main">=</span><span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="RegExp2NAe-accepts_epsilon"><span class="command">lemma</span></span> accepts_epsilon<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"accepts epsilon <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> steps_epsilon accepts_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> epsilon_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(******************************************************)</span>
<span class="comment1">(*                       atom                         *)</span>
<span class="comment1">(******************************************************)</span>

<span class="keyword1" id="RegExp2NAe-fin_atom"><span class="command">lemma</span></span> fin_atom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fin <span class="main">(</span>atom <span class="free">a</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">q</span> <span class="main">=</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>atom_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NAe-start_atom"><span class="command">lemma</span></span> start_atom<span class="main">:</span> <span class="quoted"><span class="quoted">"start <span class="main">(</span>atom <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span>True<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>atom_def<span class="main">)</span>

<span class="comment1">(* Use {x. False} = {}? *)</span>

<span class="keyword1" id="RegExp2NAe-eps_atom"><span class="command">lemma</span></span> eps_atom<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"eps<span class="main">(</span>atom <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>atom_def step_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NAe-in_step_atom_Some"><span class="command">lemma</span></span> in_step_atom_Some<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> step <span class="main">(</span>atom <span class="free">a</span><span class="main">)</span> <span class="main">(</span>Some <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">=</span><span class="main">[</span>True<span class="main">]</span> <span class="main">∧</span> <span class="free">q</span><span class="main">=</span><span class="main">[</span>False<span class="main">]</span> <span class="main">∧</span> <span class="free">b</span><span class="main">=</span><span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>atom_def step_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NAe-False_False_in_steps_atom"><span class="command">lemma</span></span> False_False_in_steps_atom<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span>False<span class="main">]</span><span class="main">,</span><span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">:</span> steps <span class="main">(</span>atom <span class="free">a</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> relcomp_unfold<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-start_fin_in_steps_atom"><span class="command">lemma</span></span> start_fin_in_steps_atom<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>start <span class="main">(</span>atom <span class="free">a</span><span class="main">)</span><span class="main">,</span> <span class="main">[</span>False<span class="main">]</span><span class="main">)</span> <span class="main">:</span> steps <span class="main">(</span>atom <span class="free">a</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">=</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> start_atom rtrancl_empty<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False_False_in_steps_atom relcomp_unfold start_atom<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-accepts_atom"><span class="command">lemma</span></span> accepts_atom<span class="main">:</span> <span class="quoted"><span class="quoted">"accepts <span class="main">(</span>atom <span class="free">a</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">=</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_def start_fin_in_steps_atom fin_atom<span class="main">)</span>


<span class="comment1">(******************************************************)</span>
<span class="comment1">(*                      or                            *)</span>
<span class="comment1">(******************************************************)</span>

<span class="comment1">(***** lift True/False over fin *****)</span>

<span class="keyword1" id="RegExp2NAe-fin_or_True"><span class="command">lemma</span></span> fin_or_True<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> fin <span class="main">(</span>or <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> fin <span class="bound">L</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>or_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NAe-fin_or_False"><span class="command">lemma</span></span> fin_or_False<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> fin <span class="main">(</span>or <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="main">(</span>False<span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> fin <span class="bound">R</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>or_def<span class="main">)</span>

<span class="comment1">(***** lift True/False over step *****)</span>

<span class="keyword1" id="RegExp2NAe-True_in_step_or"><span class="command">lemma</span></span> True_in_step_or<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> <span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> step <span class="main">(</span>or <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">q</span> <span class="main">=</span> True<span class="main">#</span><span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">:</span> step <span class="bound">L</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>or_def step_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-False_in_step_or"><span class="command">lemma</span></span> False_in_step_or<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> <span class="main">(</span>False<span class="main">#</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> step <span class="main">(</span>or <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">q</span> <span class="main">=</span> False<span class="main">#</span><span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">:</span> step <span class="bound">R</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>or_def step_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="comment1">(***** lift True/False over epsclosure *****)</span>

<span class="keyword1" id="RegExp2NAe-lemma1a"><span class="command">lemma</span></span> lemma1a<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">tp</span><span class="main">,</span><span class="free">tq</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps<span class="main">(</span>or <span class="free">L</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟹</span> 
 <span class="main">(</span><span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="free">tp</span> <span class="main">=</span> True<span class="main">#</span><span class="bound">p</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps <span class="free">L</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∧</span> <span class="free">tq</span> <span class="main">=</span> True<span class="main">#</span><span class="bound">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>rtrancl_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-lemma1b"><span class="command">lemma</span></span> lemma1b<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">tp</span><span class="main">,</span><span class="free">tq</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps<span class="main">(</span>or <span class="free">L</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟹</span> 
 <span class="main">(</span><span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="free">tp</span> <span class="main">=</span> False<span class="main">#</span><span class="bound">p</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps <span class="free">R</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∧</span> <span class="free">tq</span> <span class="main">=</span> False<span class="main">#</span><span class="bound">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>rtrancl_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-lemma2a"><span class="command">lemma</span></span> lemma2a<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps <span class="free">L</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>  <span class="main">⟹</span> <span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">,</span> True<span class="main">#</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps<span class="main">(</span>or <span class="free">L</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtrancl_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-lemma2b"><span class="command">lemma</span></span> lemma2b<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps <span class="free">R</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>  <span class="main">⟹</span> <span class="main">(</span>False<span class="main">#</span><span class="free">p</span><span class="main">,</span> False<span class="main">#</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps<span class="main">(</span>or <span class="free">L</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtrancl_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-True_epsclosure_or"><span class="command">lemma</span></span> True_epsclosure_or<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps<span class="main">(</span>or <span class="free">L</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">q</span> <span class="main">=</span> True<span class="main">#</span><span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps <span class="free">L</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> lemma1a lemma2a<span class="main">)</span>

<span class="keyword1" id="RegExp2NAe-False_epsclosure_or"><span class="command">lemma</span></span> False_epsclosure_or<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>False<span class="main">#</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps<span class="main">(</span>or <span class="free">L</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">q</span> <span class="main">=</span> False<span class="main">#</span><span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps <span class="free">R</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> lemma1b lemma2b<span class="main">)</span>

<span class="comment1">(***** lift True/False over steps *****)</span>

<span class="keyword1" id="RegExp2NAe-lift_True_over_steps_or"><span class="command">lemma</span></span> lift_True_over_steps_or<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span>True<span class="main">#</span><span class="bound">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span><span class="main">:</span>steps <span class="main">(</span>or <span class="free">L</span> <span class="free">R</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">q</span> <span class="main">=</span> True <span class="main">#</span> <span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">:</span>steps <span class="free">L</span> <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-lift_False_over_steps_or"><span class="command">lemma</span></span> lift_False_over_steps_or<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span>False<span class="main">#</span><span class="bound">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span><span class="main">:</span>steps <span class="main">(</span>or <span class="free">L</span> <span class="free">R</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">q</span> <span class="main">=</span> False<span class="main">#</span><span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">:</span>steps <span class="free">R</span> <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(***** Epsilon closure of start state *****)</span>

<span class="keyword1" id="RegExp2NAe-unfold_rtrancl2"><span class="command">lemma</span></span> unfold_rtrancl2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">=</span> Id <span class="main">∪</span> <span class="main">(</span><span class="free">R</span> <span class="keyword1">O</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rtrancl_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> converse_rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-in_unfold_rtrancl2"><span class="command">lemma</span></span> in_unfold_rtrancl2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">q</span> <span class="main">=</span> <span class="free">p</span> <span class="main">|</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">:</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> <span class="free">R</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> unfold_rtrancl2<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> equalityE<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">iff</span><span class="main">]</span> <span class="main">=</span> in_unfold_rtrancl2<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?p</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"start<span class="main">(</span>or <span class="free">L</span> <span class="free">R</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">L</span> <span class="free">R</span>

<span class="keyword1" id="RegExp2NAe-start_eps_or"><span class="command">lemma</span></span> start_eps_or<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> <span class="main">(</span>start<span class="main">(</span>or <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> eps<span class="main">(</span>or <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="main">=</span> 
       <span class="main">(</span><span class="free">q</span> <span class="main">=</span> True<span class="main">#</span>start <span class="bound">L</span> <span class="main">|</span> <span class="free">q</span> <span class="main">=</span> False<span class="main">#</span>start <span class="bound">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>or_def step_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NAe-not_start_step_or_Some"><span class="command">lemma</span></span> not_start_step_or_Some<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> <span class="main">(</span>start<span class="main">(</span>or <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">∉</span> step <span class="main">(</span>or <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="main">(</span>Some <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>or_def step_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NAe-steps_or"><span class="command">lemma</span></span> steps_or<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>start<span class="main">(</span>or <span class="free">L</span> <span class="free">R</span><span class="main">)</span><span class="main">,</span> <span class="free">q</span><span class="main">)</span> <span class="main">:</span> steps <span class="main">(</span>or <span class="free">L</span> <span class="free">R</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> 
 <span class="main">(</span> <span class="main">(</span><span class="free">w</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> start<span class="main">(</span>or <span class="free">L</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> 
   <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span>  <span class="free">q</span> <span class="main">=</span> True  <span class="main">#</span> <span class="bound">p</span> <span class="main">∧</span> <span class="main">(</span>start <span class="free">L</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">L</span> <span class="free">w</span> <span class="main">|</span> 
         <span class="free">q</span> <span class="main">=</span> False <span class="main">#</span> <span class="bound">p</span> <span class="main">∧</span> <span class="main">(</span>start <span class="free">R</span><span class="main">,</span><span class="bound">p</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">R</span> <span class="free">w</span><span class="main">)</span> <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-start_or_not_final"><span class="command">lemma</span></span> start_or_not_final<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> <span class="main">¬</span> fin <span class="main">(</span>or <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="main">(</span>start<span class="main">(</span>or <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>or_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NAe-accepts_or"><span class="command">lemma</span></span> accepts_or<span class="main">:</span>
 <span class="quoted"><span class="quoted">"accepts <span class="main">(</span>or <span class="free">L</span> <span class="free">R</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span>accepts <span class="free">L</span> <span class="free">w</span> <span class="main">|</span> accepts <span class="free">R</span> <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>accepts_def steps_or<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="comment1">(******************************************************)</span>
<span class="comment1">(*                      conc                          *)</span>
<span class="comment1">(******************************************************)</span>

<span class="comment1">(** True/False in fin **)</span>

<span class="keyword1" id="RegExp2NAe-in_conc_True"><span class="command">lemma</span></span> in_conc_True<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> fin <span class="main">(</span>conc <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> False"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>conc_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NAe-fin_conc_False"><span class="command">lemma</span></span> fin_conc_False<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> fin <span class="main">(</span>conc <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="main">(</span>False<span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> fin <span class="bound">R</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>conc_def<span class="main">)</span>

<span class="comment1">(** True/False in step **)</span>

<span class="keyword1" id="RegExp2NAe-True_step_conc"><span class="command">lemma</span></span> True_step_conc<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> <span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> step <span class="main">(</span>conc <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> 
       <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">q</span><span class="main">=</span>True<span class="main">#</span><span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">:</span> step <span class="bound">L</span> <span class="free">a</span><span class="main">)</span> <span class="main">|</span> 
        <span class="main">(</span>fin <span class="bound">L</span> <span class="free">p</span> <span class="main">∧</span> <span class="free">a</span><span class="main">=</span>None <span class="main">∧</span> <span class="free">q</span><span class="main">=</span>False<span class="main">#</span>start <span class="bound">R</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>conc_def step_def<span class="main">)</span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>

<span class="keyword1" id="RegExp2NAe-False_step_conc"><span class="command">lemma</span></span> False_step_conc<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> <span class="main">(</span>False<span class="main">#</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> step <span class="main">(</span>conc <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> 
       <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">q</span> <span class="main">=</span> False<span class="main">#</span><span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">:</span> step <span class="bound">R</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>conc_def step_def<span class="main">)</span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>

<span class="comment1">(** False in epsclosure **)</span>

<span class="keyword1" id="RegExp2NAe-lemma1b'"><span class="command">lemma</span></span> lemma1b'<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">tp</span><span class="main">,</span><span class="free">tq</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps<span class="main">(</span>conc <span class="free">L</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="free">tp</span> <span class="main">=</span> False<span class="main">#</span><span class="bound">p</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps <span class="free">R</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∧</span> <span class="free">tq</span> <span class="main">=</span> False<span class="main">#</span><span class="bound">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtrancl_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-lemma2b'"><span class="command">lemma</span></span> lemma2b'<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps <span class="free">R</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟹</span> <span class="main">(</span>False<span class="main">#</span><span class="free">p</span><span class="main">,</span> False<span class="main">#</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps<span class="main">(</span>conc <span class="free">L</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtrancl_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-False_epsclosure_conc"><span class="command">lemma</span></span> False_epsclosure_conc<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>False <span class="main">#</span> <span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps <span class="main">(</span>conc <span class="free">L</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="main">=</span> 
 <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">q</span> <span class="main">=</span> False <span class="main">#</span> <span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps <span class="free">R</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> lemma1b'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> lemma2b'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(** False in steps **)</span>

<span class="keyword1" id="RegExp2NAe-False_steps_conc"><span class="command">lemma</span></span> False_steps_conc<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span>False<span class="main">#</span><span class="bound">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span><span class="main">:</span> steps <span class="main">(</span>conc <span class="free">L</span> <span class="free">R</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">q</span><span class="main">=</span>False<span class="main">#</span><span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">:</span> steps <span class="free">R</span> <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fast</span><span class="main">)</span>  <span class="comment1">(*MUCH faster than blast*)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(** True in epsclosure **)</span>

<span class="keyword1" id="RegExp2NAe-True_True_eps_concI"><span class="command">lemma</span></span> True_True_eps_concI<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span><span class="main">:</span> <span class="main">(</span>eps <span class="free">L</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟹</span> <span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">,</span>True<span class="main">#</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps<span class="main">(</span>conc <span class="free">L</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtrancl_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-True_True_steps_concI"><span class="command">lemma</span></span> True_True_steps_concI<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">L</span> <span class="free">w</span> <span class="main">⟹</span> <span class="main">(</span>True<span class="main">#</span><span class="bound">p</span><span class="main">,</span>True<span class="main">#</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> steps <span class="main">(</span>conc <span class="free">L</span> <span class="free">R</span><span class="main">)</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> True_True_eps_concI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> True_True_eps_concI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-lemma1a'"><span class="command">lemma</span></span> lemma1a'<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">tp</span><span class="main">,</span><span class="free">tq</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps<span class="main">(</span>conc <span class="free">L</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟹</span> 
 <span class="main">(</span><span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="free">tp</span> <span class="main">=</span> True<span class="main">#</span><span class="bound">p</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="free">tq</span> <span class="main">=</span> True<span class="main">#</span><span class="bound">q</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps <span class="free">L</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="main">|</span> 
  <span class="main">(</span><span class="main">∃</span><span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> <span class="free">tq</span> <span class="main">=</span> False<span class="main">#</span><span class="bound">q</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">:</span><span class="main">(</span>eps <span class="free">L</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∧</span> fin <span class="free">L</span> <span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span>start <span class="free">R</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps <span class="free">R</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtrancl_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-lemma2a'"><span class="command">lemma</span></span> lemma2a'<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">,</span> <span class="free">q</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps <span class="free">L</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟹</span> <span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">,</span> True<span class="main">#</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps<span class="main">(</span>conc <span class="free">L</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtrancl_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-lem"><span class="command">lemma</span></span> lem<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> step <span class="bound">R</span> None <span class="main">⟹</span> <span class="main">(</span>False<span class="main">#</span><span class="free">p</span><span class="main">,</span> False<span class="main">#</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> step <span class="main">(</span>conc <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> None"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conc_def step_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NAe-lemma2b''"><span class="command">lemma</span></span> lemma2b''<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps <span class="free">R</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟹</span> <span class="main">(</span>False<span class="main">#</span><span class="free">p</span><span class="main">,</span> False<span class="main">#</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps<span class="main">(</span>conc <span class="free">L</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtrancl_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> lem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-True_False_eps_concI"><span class="command">lemma</span></span> True_False_eps_concI<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> fin <span class="bound">L</span> <span class="free">p</span> <span class="main">⟹</span> <span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">,</span> False<span class="main">#</span>start <span class="bound">R</span><span class="main">)</span> <span class="main">:</span> eps<span class="main">(</span>conc <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conc_def step_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NAe-True_epsclosure_conc"><span class="command">lemma</span></span> True_epsclosure_conc<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>eps<span class="main">(</span>conc <span class="free">L</span> <span class="free">R</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="main">=</span> 
 <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>eps <span class="free">L</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> True<span class="main">#</span><span class="bound">r</span><span class="main">)</span> <span class="main">∨</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>eps <span class="free">L</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∧</span> fin <span class="free">L</span> <span class="bound">r</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span>start <span class="free">R</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>eps <span class="free">R</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> False<span class="main">#</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> lemma1a'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> lemma2a'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> lemma2a'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> converse_rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> True_False_eps_concI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> lemma2b''<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(** True in steps **)</span>

<span class="keyword1" id="RegExp2NAe-True_steps_concD"><span class="command">lemma</span></span> True_steps_concD<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span>True<span class="main">#</span><span class="bound">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> steps <span class="main">(</span>conc <span class="free">L</span> <span class="free">R</span><span class="main">)</span> <span class="free">w</span> <span class="main">⟶</span> 
     <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">L</span> <span class="free">w</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> True<span class="main">#</span><span class="bound">r</span><span class="main">)</span>  <span class="main">∨</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> <span class="bound">u</span><span class="main">@</span><span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> steps <span class="free">L</span> <span class="bound">u</span> <span class="main">∧</span> fin <span class="free">L</span> <span class="bound">r</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span>start <span class="free">R</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> steps <span class="free">R</span> <span class="bound">v</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> False<span class="main">#</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> disjCI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> disjCI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> disjCI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">a</span><span class="main">#</span><span class="improper">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-True_steps_conc"><span class="command">lemma</span></span> True_steps_conc<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">∈</span> steps <span class="main">(</span>conc <span class="free">L</span> <span class="free">R</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> 
 <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> steps <span class="free">L</span> <span class="free">w</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> True<span class="main">#</span><span class="bound">r</span><span class="main">)</span>  <span class="main">|</span> 
  <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> <span class="bound">u</span><span class="main">@</span><span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">L</span> <span class="bound">u</span> <span class="main">∧</span> fin <span class="free">L</span> <span class="bound">r</span> <span class="main">∧</span> 
          <span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span>start <span class="free">R</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">R</span> <span class="bound">v</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> False<span class="main">#</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> True_steps_concD
    <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> True_True_steps_concI in_steps_epsclosure<span class="main">)</span>

<span class="comment1">(** starting from the start **)</span>

<span class="keyword1" id="RegExp2NAe-start_conc"><span class="command">lemma</span></span> start_conc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> start<span class="main">(</span>conc <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="main">=</span> True<span class="main">#</span>start <span class="bound">L</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conc_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NAe-final_conc"><span class="command">lemma</span></span> final_conc<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">L</span> <span class="bound">R</span><span class="main">.</span> fin<span class="main">(</span>conc <span class="bound">L</span> <span class="bound">R</span><span class="main">)</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> False<span class="main">#</span><span class="bound">s</span> <span class="main">∧</span> fin <span class="bound">R</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>conc_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.split<span class="main">)</span>

<span class="keyword1" id="RegExp2NAe-accepts_conc"><span class="command">lemma</span></span> accepts_conc<span class="main">:</span>
 <span class="quoted"><span class="quoted">"accepts <span class="main">(</span>conc <span class="free">L</span> <span class="free">R</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> <span class="bound">u</span><span class="main">@</span><span class="bound">v</span> <span class="main">∧</span> accepts <span class="free">L</span> <span class="bound">u</span> <span class="main">∧</span> accepts <span class="free">R</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_def True_steps_conc final_conc start_conc<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(******************************************************)</span>
<span class="comment1">(*                       star                         *)</span>
<span class="comment1">(******************************************************)</span>

<span class="keyword1" id="RegExp2NAe-True_in_eps_star"><span class="command">lemma</span></span> True_in_eps_star<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">∈</span> eps<span class="main">(</span>star <span class="bound">A</span><span class="main">)</span> <span class="main">=</span> 
     <span class="main">(</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">q</span> <span class="main">=</span> True<span class="main">#</span><span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> eps <span class="bound">A</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>fin <span class="bound">A</span> <span class="free">p</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> True<span class="main">#</span>start <span class="bound">A</span><span class="main">)</span> <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>star_def step_def<span class="main">)</span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>

<span class="keyword1" id="RegExp2NAe-True_True_step_starI"><span class="command">lemma</span></span> True_True_step_starI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> step <span class="bound">A</span> <span class="free">a</span> <span class="main">⟹</span> <span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">,</span> True<span class="main">#</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> step <span class="main">(</span>star <span class="bound">A</span><span class="main">)</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>star_def step_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NAe-True_True_eps_starI"><span class="command">lemma</span></span> True_True_eps_starI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟹</span> <span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">,</span> True<span class="main">#</span><span class="free">r</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps<span class="main">(</span>star <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtrancl_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> True_True_step_starI rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-True_start_eps_starI"><span class="command">lemma</span></span> True_start_eps_starI<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> fin <span class="bound">A</span> <span class="free">p</span> <span class="main">⟹</span> <span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">,</span>True<span class="main">#</span>start <span class="bound">A</span><span class="main">)</span> <span class="main">:</span> eps<span class="main">(</span>star <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>star_def step_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NAe-lem'"><span class="command">lemma</span></span> lem'<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">tp</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps<span class="main">(</span>star <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="free">tp</span> <span class="main">=</span> True<span class="main">#</span><span class="bound">p</span> <span class="main">⟶</span>
 <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>eps <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>eps <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∧</span> fin <span class="free">A</span> <span class="bound">q</span> <span class="main">∧</span> <span class="main">(</span>start <span class="free">A</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
       <span class="free">s</span> <span class="main">=</span> True<span class="main">#</span><span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rtrancl_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> rtrancl_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-True_eps_star"><span class="command">lemma</span></span> True_eps_star<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>eps<span class="main">(</span>star <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span> <span class="main">=</span> 
 <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>eps <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span> <span class="main">∧</span> fin <span class="free">A</span> <span class="bound">q</span> <span class="main">∧</span> <span class="main">(</span>start <span class="free">A</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">:</span> <span class="main">(</span>eps <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
       <span class="free">s</span> <span class="main">=</span> True<span class="main">#</span><span class="bound">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> lem'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="comment1">(* Why can't blast do the rest? *)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> True_True_eps_starI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> True_True_eps_starI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rtrancl_trans<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> r_into_rtrancl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> True_start_eps_starI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> True_True_eps_starI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(** True in step Some **)</span>

<span class="keyword1" id="RegExp2NAe-True_step_star"><span class="command">lemma</span></span> True_step_star<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">∈</span> step <span class="main">(</span>star <span class="bound">A</span><span class="main">)</span> <span class="main">(</span>Some <span class="free">a</span><span class="main">)</span> <span class="main">=</span>
     <span class="main">(</span><span class="main">∃</span><span class="bound">q</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span><span class="main">,</span><span class="bound">q</span><span class="main">)</span> <span class="main">∈</span> step <span class="bound">A</span> <span class="main">(</span>Some <span class="free">a</span><span class="main">)</span> <span class="main">∧</span> <span class="free">r</span><span class="main">=</span>True<span class="main">#</span><span class="bound">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>star_def step_def<span class="main">)</span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>


<span class="comment1">(** True in steps **)</span>

<span class="comment1">(* reverse list induction! Complicates matters for conc? *)</span>
<span class="keyword1" id="RegExp2NAe-True_start_steps_starD"><span class="command">lemma</span></span> True_start_steps_starD<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">rr</span><span class="main">.</span> <span class="main">(</span>True<span class="main">#</span>start <span class="free">A</span><span class="main">,</span><span class="bound">rr</span><span class="main">)</span> <span class="main">∈</span> steps <span class="main">(</span>star <span class="free">A</span><span class="main">)</span> <span class="free">w</span> <span class="main">⟶</span>
 <span class="main">(</span><span class="main">∃</span><span class="bound">us</span> <span class="bound">v</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> concat <span class="bound">us</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">∀</span><span class="bound">u</span><span class="main">∈</span>set <span class="bound">us</span><span class="main">.</span> accepts <span class="free">A</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>start <span class="free">A</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> steps <span class="free">A</span> <span class="bound">v</span> <span class="main">∧</span> <span class="bound">rr</span> <span class="main">=</span> True<span class="main">#</span><span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">w</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> O_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> epsclosure_steps<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">us</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">v</span><span class="main">@</span><span class="main">[</span><span class="improper">x</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> O_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> epsclosure_steps<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">us</span><span class="main">@</span><span class="main">[</span><span class="improper">v</span><span class="main">@</span><span class="main">[</span><span class="improper">x</span><span class="main">]</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-True_True_steps_starI"><span class="command">lemma</span></span> True_True_steps_starI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="bound">p</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> steps <span class="free">A</span> <span class="free">w</span> <span class="main">⟹</span> <span class="main">(</span>True<span class="main">#</span><span class="bound">p</span><span class="main">,</span>True<span class="main">#</span><span class="free">q</span><span class="main">)</span> <span class="main">:</span> steps <span class="main">(</span>star <span class="free">A</span><span class="main">)</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> True_True_eps_starI True_True_step_starI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-steps_star_cycle"><span class="command">lemma</span></span> steps_star_cycle<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> set <span class="free">us</span><span class="main">.</span> accepts <span class="free">A</span> <span class="bound">u</span><span class="main">)</span> <span class="main">⟹</span>
 <span class="main">(</span>True<span class="main">#</span>start <span class="free">A</span><span class="main">,</span>True<span class="main">#</span>start <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> steps <span class="main">(</span>star <span class="free">A</span><span class="main">)</span> <span class="main">(</span>concat <span class="free">us</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">us</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>accepts_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>accepts_def<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> True_True_steps_starI True_start_eps_starI in_epsclosure_steps<span class="main">)</span>

<span class="comment1">(* Better stated directly with start(star A)? Loop in star A back to start(star A)?*)</span>
<span class="keyword1" id="RegExp2NAe-True_start_steps_star"><span class="command">lemma</span></span> True_start_steps_star<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>True<span class="main">#</span>start <span class="free">A</span><span class="main">,</span><span class="free">rr</span><span class="main">)</span> <span class="main">:</span> steps <span class="main">(</span>star <span class="free">A</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> 
 <span class="main">(</span><span class="main">∃</span><span class="bound">us</span> <span class="bound">v</span><span class="main">.</span> <span class="free">w</span> <span class="main">=</span> concat <span class="bound">us</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">∀</span><span class="bound">u</span><span class="main">∈</span>set <span class="bound">us</span><span class="main">.</span> accepts <span class="free">A</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">(</span>start <span class="free">A</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> steps <span class="free">A</span> <span class="bound">v</span> <span class="main">∧</span> <span class="free">rr</span> <span class="main">=</span> True<span class="main">#</span><span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> True_start_steps_starD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> steps_star_cycle True_True_steps_starI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(** the start state **)</span>

<span class="keyword1" id="RegExp2NAe-start_step_star"><span class="command">lemma</span></span> start_step_star<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> <span class="main">(</span>start<span class="main">(</span>star <span class="bound">A</span><span class="main">)</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">:</span> step <span class="main">(</span>star <span class="bound">A</span><span class="main">)</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">=</span>None <span class="main">∧</span> <span class="free">r</span> <span class="main">=</span> True<span class="main">#</span>start <span class="bound">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>star_def step_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> epsclosure_start_step_star <span class="main">=</span>
  in_unfold_rtrancl2<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?p</span> <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"start <span class="main">(</span>star <span class="free">A</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">A</span>

<span class="keyword1" id="RegExp2NAe-start_steps_star"><span class="command">lemma</span></span> start_steps_star<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>start<span class="main">(</span>star <span class="free">A</span><span class="main">)</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">:</span> steps <span class="main">(</span>star <span class="free">A</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> 
 <span class="main">(</span><span class="main">(</span><span class="free">w</span><span class="main">=</span><span class="main">[]</span> <span class="main">∧</span> <span class="free">r</span><span class="main">=</span> start<span class="main">(</span>star <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">|</span> <span class="main">(</span>True<span class="main">#</span>start <span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">)</span> <span class="main">:</span> steps <span class="main">(</span>star <span class="free">A</span><span class="main">)</span> <span class="free">w</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> epsclosure_start_step_star<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> epsclosure_start_step_star<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> in_steps_epsclosure<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegExp2NAe-fin_star_True"><span class="command">lemma</span></span> fin_star_True<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> fin <span class="main">(</span>star <span class="bound">A</span><span class="main">)</span> <span class="main">(</span>True<span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> fin <span class="bound">A</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>star_def<span class="main">)</span>

<span class="keyword1" id="RegExp2NAe-fin_star_start"><span class="command">lemma</span></span> fin_star_start<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span><span class="main">.</span> fin <span class="main">(</span>star <span class="bound">A</span><span class="main">)</span> <span class="main">(</span>start<span class="main">(</span>star <span class="bound">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>star_def<span class="main">)</span>

<span class="comment1">(* too complex! Simpler if loop back to start(star A)? *)</span>
<span class="keyword1" id="RegExp2NAe-accepts_star"><span class="command">lemma</span></span> accepts_star<span class="main">:</span>
 <span class="quoted"><span class="quoted">"accepts <span class="main">(</span>star <span class="free">A</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> 
 <span class="main">(</span><span class="main">∃</span><span class="bound">us</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="main">∈</span> set<span class="main">(</span><span class="bound">us</span><span class="main">)</span><span class="main">.</span> accepts <span class="free">A</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">w</span> <span class="main">=</span> concat <span class="bound">us</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> accepts_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> start_steps_star True_start_steps_star<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">us</span><span class="main">@</span><span class="main">[</span><span class="improper">v</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> xs <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">us</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_exhaust<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="comment1">(***** Correctness of r2n *****)</span>

<span class="keyword1" id="RegExp2NAe-accepts_rexp2nae"><span class="command">lemma</span></span> accepts_rexp2nae<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">w</span><span class="main">.</span> accepts <span class="main">(</span>rexp2nae <span class="free">r</span><span class="main">)</span> <span class="bound">w</span> <span class="main">=</span> <span class="main">(</span><span class="bound">w</span> <span class="main">:</span> lang <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">r</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_atom<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_or<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_conc Regular_Set.conc_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_star in_star_iff_concat subset_iff Ball_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="AutoRegExp">
<div class="head">
<h1>Theory AutoRegExp</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow
    Copyright   1998 TUM
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Combining automata and regular expressions"</span></span>

<span class="keyword1"><span class="command">theory</span></span> AutoRegExp
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Automata">Automata</a> <a href="#RegExp2NA">RegExp2NA</a> <a href="#RegExp2NAe">RegExp2NAe</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="quoted"><span class="quoted">"DA.accepts <span class="main">(</span>na2da<span class="main">(</span>rexp2na <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">:</span> lang <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NA_DA_equiv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> sym<span class="main"><span class="main">]</span></span> accepts_rexp2na<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span>  <span class="quoted"><span class="quoted">"DA.accepts <span class="main">(</span>nae2da<span class="main">(</span>rexp2nae <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="free">w</span> <span class="main">:</span> lang <span class="free">r</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NAe_DA_equiv accepts_rexp2nae<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="MaxPrefix">
<div class="head">
<h1>Theory MaxPrefix</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow
    Copyright   1998 TUM
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Maximal prefix"</span></span>

<span class="keyword1"><span class="command">theory</span></span> MaxPrefix
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Sublist.html">HOL-Library.Sublist</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">is_maxpref</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_maxpref</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">=</span>
 <span class="main">(</span>prefix <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">zs</span><span class="main">.</span> prefix <span class="bound">zs</span> <span class="free"><span class="bound"><span class="entity">ys</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">zs</span> <span class="main">⟶</span> prefix <span class="bound">zs</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> splitter <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">*</span> <span class="tfree">'a</span> list"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">is_maxsplitter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> splitter <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_maxsplitter</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span>
 <span class="main">(</span><span class="main">∀</span><span class="bound">xs</span> <span class="bound">ps</span> <span class="bound">qs</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">xs</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">qs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">xs</span><span class="main">=</span><span class="bound">ps</span><span class="main">@</span><span class="bound">qs</span> <span class="main">∧</span> is_maxpref <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">ps</span> <span class="bound">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">maxsplit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">*</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> splitter"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">maxsplit</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">[]</span>     <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">,</span><span class="main">[]</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">res</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">maxsplit</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">qs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">maxsplit</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">qs</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">res</span></span></span><span class="main">)</span>
                                     <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">@</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">]</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">qs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> if_split<span class="main">[</span><span class="operator">split</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1" id="MaxPrefix-maxsplit_lemma"><span class="command">lemma</span></span> maxsplit_lemma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>maxsplit <span class="free">P</span> <span class="free">res</span> <span class="free">ps</span> <span class="free">qs</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span><span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">us</span><span class="main">.</span> prefix <span class="bound">us</span> <span class="free">qs</span> <span class="main">∧</span> <span class="free">P</span><span class="main">(</span><span class="free">ps</span><span class="main">@</span><span class="bound">us</span><span class="main">)</span> <span class="keyword1">then</span> <span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">=</span><span class="free">ps</span><span class="main">@</span><span class="free">qs</span> <span class="main">∧</span> is_maxpref <span class="free">P</span> <span class="free">xs</span> <span class="main">(</span><span class="free">ps</span><span class="main">@</span><span class="free">qs</span><span class="main">)</span>
   <span class="keyword1">else</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span><span class="free">ys</span><span class="main">)</span><span class="main">=</span><span class="free">res</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">res</span></span> <span class="quoted"><span class="free">ps</span></span> <span class="quoted"><span class="free">qs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> maxsplit.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_maxpref_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_splits<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">P</span> <span class="skolem">res</span> <span class="skolem">ps</span> <span class="skolem">q</span> <span class="skolem">qs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">us</span><span class="main">.</span> prefix <span class="bound">us</span> <span class="skolem">qs</span> <span class="main">∧</span> <span class="skolem">P</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ps</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">q</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="bound">us</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">note</span></span> ex1 <span class="main">=</span> this
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> us <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main">)</span> <span class="keyword1"><span class="command">note</span></span> us <span class="main">=</span> this
    <span class="keyword1"><span class="command">hence</span></span> ex2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">us</span><span class="main">.</span> prefix <span class="bound">us</span> <span class="main">(</span><span class="skolem">q</span> <span class="main">#</span> <span class="skolem">qs</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps</span> <span class="main">@</span> <span class="bound">us</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">q</span></span></span><span class="main"><span class="main"><span class="main">#</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">us</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> ex1 <span class="keyword2"><span class="keyword">and</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">note</span></span> ex1 <span class="main">=</span> this
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">us</span><span class="main">.</span> prefix <span class="bound">us</span> <span class="main">(</span><span class="skolem">q</span><span class="main">#</span><span class="skolem">qs</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps</span> <span class="main">@</span> <span class="bound">us</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ex1 False<span class="main">)</span> <span class="main">(</span><span class="operator">insert</span> ex1 False<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> prefix_Cons<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">note</span></span> ex2 <span class="main">=</span> this
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">ps</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>maxsplit <span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">q</span> <span class="main">#</span> <span class="skolem">qs</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">q</span><span class="main">]</span><span class="main">)</span> <span class="skolem">qs</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">xs</span> <span class="main">=</span> <span class="skolem">ps</span> <span class="main">∧</span> <span class="free">ys</span> <span class="main">=</span> <span class="skolem">q</span> <span class="main">#</span> <span class="skolem">qs</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ex1 ex2<span class="main">)</span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">=</span> <span class="skolem">ps</span> <span class="main">@</span> <span class="skolem">q</span> <span class="main">#</span> <span class="skolem">qs</span> <span class="main">∧</span> is_maxpref <span class="skolem">P</span> <span class="free">xs</span> <span class="main">(</span><span class="skolem">ps</span> <span class="main">@</span> <span class="skolem">q</span> <span class="main">#</span> <span class="skolem">qs</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ex1 True
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_maxpref_def prefix_append prefix_Cons append_eq_append_conv2<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ex1 ex2<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>maxsplit <span class="skolem">P</span> <span class="skolem">res</span> <span class="main">(</span><span class="skolem">ps</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">q</span><span class="main">]</span><span class="main">)</span> <span class="skolem">qs</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">ys</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="free">xs</span><span class="main">,</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">res</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ex1 ex2<span class="main">)</span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">=</span> <span class="skolem">ps</span> <span class="main">@</span> <span class="skolem">q</span> <span class="main">#</span> <span class="skolem">qs</span> <span class="main">∧</span> is_maxpref <span class="skolem">P</span> <span class="free">xs</span> <span class="main">(</span><span class="skolem">ps</span> <span class="main">@</span> <span class="skolem">q</span> <span class="main">#</span> <span class="skolem">qs</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ex1 ex2 False
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> append_eq_append_conv2 is_maxpref_def prefix_Cons<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ex1 ex2<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">declare</span></span> if_split<span class="main">[</span><span class="operator">split</span><span class="main">]</span>

<span class="keyword1" id="MaxPrefix-is_maxpref_Nil"><span class="command">lemma</span></span> is_maxpref_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">us</span><span class="main">.</span> prefix <span class="bound">us</span> <span class="free">xs</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">us</span><span class="main">)</span> <span class="main">⟹</span> is_maxpref <span class="free">P</span> <span class="free">ps</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="free">ps</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_maxpref_def<span class="main">)</span>

<span class="keyword1" id="MaxPrefix-is_maxsplitter_maxsplit"><span class="command">lemma</span></span> is_maxsplitter_maxsplit<span class="main">:</span>
 <span class="quoted"><span class="quoted">"is_maxsplitter <span class="free">P</span> <span class="main">(</span><span class="main">λ</span><span class="bound">xs</span><span class="main">.</span> maxsplit <span class="free">P</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="bound">xs</span><span class="main">)</span> <span class="main">[]</span> <span class="bound">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> maxsplit_lemma is_maxsplitter_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> maxsplit_eq <span class="main">=</span> is_maxsplitter_maxsplit<span class="main">[</span><span class="operator">simplified</span> is_maxsplitter_def<span class="main">]</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="MaxChop">
<div class="head">
<h1>Theory MaxChop</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow
    Copyright   1998 TUM
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Generic scanner"</span></span>

<span class="keyword1"><span class="command">theory</span></span> MaxChop
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#MaxPrefix">MaxPrefix</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> chopper <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list list <span class="main">*</span> <span class="tfree">'a</span> list"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">is_maxchopper</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> list <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> chopper <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_maxchopper</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">chopper</span></span></span> <span class="main">=</span>
 <span class="main">(</span><span class="main">∀</span><span class="bound">xs</span> <span class="bound">zs</span> <span class="bound">yss</span><span class="main">.</span>
    <span class="main">(</span><span class="free"><span class="bound"><span class="entity">chopper</span></span></span><span class="main">(</span><span class="bound">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">yss</span><span class="main">,</span><span class="bound">zs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="bound">xs</span> <span class="main">=</span> concat <span class="bound">yss</span> <span class="main">@</span> <span class="bound">zs</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ys</span> <span class="main">∈</span> set <span class="bound">yss</span><span class="main">.</span> <span class="bound">ys</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∧</span>
     <span class="main">(</span><span class="keyword1">case</span> <span class="bound">yss</span> <span class="keyword1">of</span>
        <span class="main">[]</span> <span class="main">⇒</span> is_maxpref <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">[]</span> <span class="bound">xs</span>
      <span class="main">|</span> <span class="bound">us</span><span class="main">#</span><span class="bound">uss</span> <span class="main">⇒</span> is_maxpref <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">us</span> <span class="bound">xs</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">chopper</span></span></span><span class="main">(</span>concat<span class="main">(</span><span class="bound">uss</span><span class="main">)</span><span class="main">@</span><span class="bound">zs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">uss</span><span class="main">,</span><span class="bound">zs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">reducing</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> splitter <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">reducing</span> <span class="free"><span class="bound"><span class="entity">splitf</span></span></span> <span class="main">=</span>
 <span class="main">(</span><span class="main">∀</span><span class="bound">xs</span> <span class="bound">ys</span> <span class="bound">zs</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">splitf</span></span></span> <span class="bound">xs</span> <span class="main">=</span> <span class="main">(</span><span class="bound">ys</span><span class="main">,</span><span class="bound">zs</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">ys</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> length <span class="bound">zs</span> <span class="main">&lt;</span> length <span class="bound">xs</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="entity">chop</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> splitter <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list list <span class="main">×</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">chop</span> <span class="free"><span class="bound"><span class="entity">splitf</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> reducing <span class="free"><span class="bound"><span class="entity">splitf</span></span></span>
                      <span class="keyword1">then</span> <span class="keyword1">let</span> <span class="bound">pp</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">splitf</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>
                           <span class="keyword1">in</span> <span class="keyword1">if</span> fst <span class="bound">pp</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>
                           <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="bound">qq</span> <span class="main">=</span> <span class="free">chop</span> <span class="free"><span class="bound"><span class="entity">splitf</span></span></span> <span class="main">(</span>snd <span class="bound">pp</span><span class="main">)</span>
                                <span class="keyword1">in</span> <span class="main">(</span>fst <span class="bound">pp</span> <span class="main">#</span> fst <span class="bound">qq</span><span class="main">,</span> snd <span class="bound">qq</span><span class="main">)</span>
                      <span class="keyword1">else</span> undefined<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="main">(</span>length <span class="main">∘</span> snd<span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reducing_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">splitf</span> <span class="improper">xs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="MaxChop-chop_rule"><span class="command">lemma</span></span> chop_rule<span class="main">:</span> <span class="quoted"><span class="quoted">"reducing <span class="free">splitf</span> <span class="main">⟹</span>
  chop <span class="free">splitf</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">pre</span><span class="main">,</span> <span class="bound">post</span><span class="main">)</span> <span class="main">=</span> <span class="free">splitf</span> <span class="free">xs</span>
                    <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">pre</span> <span class="main">=</span> <span class="main">[]</span> <span class="keyword1">then</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free">xs</span><span class="main">)</span>
                       <span class="keyword1">else</span> <span class="keyword1">let</span> <span class="main">(</span><span class="bound">xss</span><span class="main">,</span> <span class="bound">zs</span><span class="main">)</span> <span class="main">=</span> chop <span class="free">splitf</span> <span class="bound">post</span>
                            <span class="keyword1">in</span> <span class="main">(</span><span class="bound">pre</span> <span class="main">#</span> <span class="bound">xss</span><span class="main">,</span><span class="bound">zs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chop.simps<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="MaxChop-reducing_maxsplit"><span class="command">lemma</span></span> reducing_maxsplit<span class="main">:</span> <span class="quoted"><span class="quoted">"reducing<span class="main">(</span><span class="main">λ</span><span class="bound">qs</span><span class="main">.</span> maxsplit <span class="free">P</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="bound">qs</span><span class="main">)</span> <span class="main">[]</span> <span class="bound">qs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> reducing_def maxsplit_eq<span class="main">)</span>

<span class="keyword1" id="MaxChop-is_maxsplitter_reducing"><span class="command">lemma</span></span> is_maxsplitter_reducing<span class="main">:</span>
 <span class="quoted"><span class="quoted">"is_maxsplitter <span class="free">P</span> <span class="free">splitf</span> <span class="main">⟹</span> reducing <span class="free">splitf</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>is_maxsplitter_def reducing_def<span class="main">)</span>

<span class="keyword1" id="MaxChop-chop_concat"><span class="command">lemma</span></span> chop_concat<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_maxsplitter <span class="free">P</span> <span class="free">splitf</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">yss</span> <span class="bound">zs</span><span class="main">.</span> chop <span class="free">splitf</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="bound">yss</span><span class="main">,</span><span class="bound">zs</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">xs</span> <span class="main">=</span> concat <span class="bound">yss</span> <span class="main">@</span> <span class="bound">zs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>length_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">split</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> if_split
            <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chop_rule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> is_maxsplitter_reducing<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def is_maxsplitter_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="MaxChop-chop_nonempty"><span class="command">lemma</span></span> chop_nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"is_maxsplitter <span class="free">P</span> <span class="free">splitf</span> <span class="main">⟹</span>
  <span class="main">∀</span><span class="bound">yss</span> <span class="bound">zs</span><span class="main">.</span> chop <span class="free">splitf</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span><span class="bound">yss</span><span class="main">,</span><span class="bound">zs</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ys</span> <span class="main">∈</span> set <span class="bound">yss</span><span class="main">.</span> <span class="bound">ys</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>length_induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_simp</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chop_rule is_maxsplitter_reducing<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def is_maxsplitter_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="MaxChop-is_maxchopper_chop"><span class="command">lemma</span></span> is_maxchopper_chop<span class="main">:</span>
 <span class="keyword2"><span class="keyword">assumes</span></span> prem<span class="main">:</span> <span class="quoted"><span class="quoted">"is_maxsplitter <span class="free">P</span> <span class="free">splitf</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_maxchopper <span class="free">P</span> <span class="main">(</span>chop <span class="free">splitf</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> is_maxchopper_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> chop_concat<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prem<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> prem<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> chop_nonempty<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">THEN</span> spec<span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">THEN</span> spec<span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">THEN</span> mp<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rev_mp<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> prem<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> is_maxsplitter_reducing<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> chop_rule<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def prem<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> is_maxsplitter_def<span class="main"><span class="main">]</span></span>
             <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> chop_concat<span class="main"><span class="main">[</span></span><span class="operator">OF</span> prem<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> prem<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> is_maxsplitter_reducing<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> chop_rule<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def prem<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> is_maxsplitter_def<span class="main"><span class="main">]</span></span>
             <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> xs1 ys1 xss1 ys<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.split_asm<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_maxpref_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prefix_append<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_maxpref_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prefix_append<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> us uss<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">xs1</span><span class="main">=</span><span class="improper">us</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm_use</span><span class="main"><span class="main">)</span></span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_maxpref_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prefix_append<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD2<span class="main"><span class="main">]</span></span> prefix_order.antisym<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="AutoMaxChop">
<div class="head">
<h1>Theory AutoMaxChop</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow
    Copyright   1998 TUM
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Automata based scanner"</span></span>

<span class="keyword1"><span class="command">theory</span></span> AutoMaxChop
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#DA">DA</a> <a href="#MaxChop">MaxChop</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">auto_split</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span>da <span class="main">⇒</span> <span class="tfree">'s</span>  <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">*</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> splitter"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">auto_split</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">[]</span>     <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> fin <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">,</span><span class="main">[]</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">res</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">auto_split</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">res</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span>
   <span class="free">auto_split</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>next <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">if</span> fin <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">res</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">@</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">auto_chop</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span><span class="tfree">'s</span><span class="main">)</span>da <span class="main">⇒</span> <span class="tfree">'a</span> chopper"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">auto_chop</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> chop <span class="main">(</span><span class="main">λ</span><span class="bound">xs</span><span class="main">.</span> auto_split <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>start <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="bound">xs</span><span class="main">)</span> <span class="main">[]</span> <span class="bound">xs</span><span class="main">)</span>"</span></span>


<span class="keyword1" id="AutoMaxChop-delta_snoc"><span class="command">lemma</span></span> delta_snoc<span class="main">:</span> <span class="quoted"><span class="quoted">"delta <span class="free">A</span> <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="main">[</span><span class="free">y</span><span class="main">]</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span> next <span class="free">A</span> <span class="free">y</span> <span class="main">(</span>delta <span class="free">A</span> <span class="free">xs</span> <span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="AutoMaxChop-auto_split_lemma"><span class="command">lemma</span></span> auto_split_lemma<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">q</span> <span class="bound">ps</span> <span class="bound">res</span><span class="main">.</span> auto_split <span class="free">A</span> <span class="main">(</span>delta <span class="free">A</span> <span class="bound">ps</span> <span class="bound">q</span><span class="main">)</span> <span class="bound">res</span> <span class="bound">ps</span> <span class="free">xs</span> <span class="main">=</span>
              maxsplit <span class="main">(</span><span class="main">λ</span><span class="bound">ys</span><span class="main">.</span> fin <span class="free">A</span> <span class="main">(</span>delta <span class="free">A</span> <span class="bound">ys</span> <span class="bound">q</span><span class="main">)</span><span class="main">)</span> <span class="bound">res</span> <span class="bound">ps</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delta_snoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> delta_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="AutoMaxChop-auto_split_is_maxsplit"><span class="command">lemma</span></span> auto_split_is_maxsplit<span class="main">:</span>
 <span class="quoted"><span class="quoted">"auto_split <span class="free">A</span> <span class="main">(</span>start <span class="free">A</span><span class="main">)</span> <span class="free">res</span> <span class="main">[]</span> <span class="free">xs</span> <span class="main">=</span> maxsplit <span class="main">(</span>accepts <span class="free">A</span><span class="main">)</span> <span class="free">res</span> <span class="main">[]</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> accepts_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> delta_Nil<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?s</span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"start <span class="free"><span class="free">A</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> auto_split_lemma<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="AutoMaxChop-is_maxsplitter_auto_split"><span class="command">lemma</span></span> is_maxsplitter_auto_split<span class="main">:</span>
 <span class="quoted"><span class="quoted">"is_maxsplitter <span class="main">(</span>accepts <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">xs</span><span class="main">.</span> auto_split <span class="free">A</span> <span class="main">(</span>start <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="bound">xs</span><span class="main">)</span> <span class="main">[]</span> <span class="bound">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> auto_split_is_maxsplit is_maxsplitter_maxsplit<span class="main">)</span>


<span class="keyword1" id="AutoMaxChop-is_maxchopper_auto_chop"><span class="command">lemma</span></span> is_maxchopper_auto_chop<span class="main">:</span>
 <span class="quoted"><span class="quoted">"is_maxchopper <span class="main">(</span>accepts <span class="free">A</span><span class="main">)</span> <span class="main">(</span>auto_chop <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> auto_chop_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> is_maxchopper_chop<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> is_maxsplitter_auto_split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="RegSet_of_nat_DA">
<div class="head">
<h1>Theory RegSet_of_nat_DA</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:     Tobias Nipkow
    Copyright   1998 TUM

To generate a regular expression, the alphabet must be finite.
regexp needs to be supplied with an 'a list for a unique order

add_Atom d i j r a = (if d a i = j then Union r (Atom a) else r)
atoms d i j as = foldl (add_Atom d i j) Empty as

regexp as d i j 0 = (if i=j then Union (Star Empty) (atoms d i j as)
                        else atoms d i j as
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"From deterministic automata to regular sets"</span></span>

<span class="keyword1"><span class="command">theory</span></span> RegSet_of_nat_DA
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../Regular-Sets/Regular_Set.html">Regular-Sets.Regular_Set</a>"</span> <a href="#DA">DA</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'a</span> nat_next <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">deltas</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> nat_next <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">deltas</span> <span class="main">≡</span> foldl2"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">trace</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> nat_next <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> nat list"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">trace</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">trace</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">#</span> <span class="free">trace</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>

<span class="comment1">(* conversion a la Warshall *)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">regset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> nat_next <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> list set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">regset</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="keyword1">then</span> insert <span class="main">[]</span> <span class="main">{</span><span class="main">[</span><span class="bound">a</span><span class="main">]</span> <span class="main">|</span> <span class="bound">a</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="bound">a</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">}</span>
                          <span class="keyword1">else</span> <span class="main">{</span><span class="main">[</span><span class="bound">a</span><span class="main">]</span> <span class="main">|</span> <span class="bound">a</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="bound">a</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">j</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">regset</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span>
  <span class="free">regset</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∪</span>
  <span class="main">(</span><span class="free">regset</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">@@</span> <span class="main">(</span>star<span class="main">(</span><span class="free">regset</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">@@</span> <span class="main">(</span><span class="free">regset</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">regset_of_DA</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span>nat<span class="main">)</span>da <span class="main">⇒</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> list set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">regset_of_DA</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">j</span><span class="main">∈</span><span class="main">{</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">&lt;</span><span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∧</span> fin <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">j</span><span class="main">}</span><span class="main">.</span> regset <span class="main">(</span>next <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span>start <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="bound">j</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
 <span class="entity">bounded</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> nat_next <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">bounded</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="bound">x</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span>
  in_set_butlast_appendI<span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span> less_SucI<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> image_eqI<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="comment1">(* Lists *)</span>

<span class="keyword1" id="RegSet_of_nat_DA-butlast_empty"><span class="command">lemma</span></span> butlast_empty<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>butlast <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free">xs</span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> True <span class="main">|</span> <span class="bound">y</span><span class="main">#</span><span class="bound">ys</span> <span class="main">⇒</span> <span class="bound">ys</span><span class="main">=</span><span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="RegSet_of_nat_DA-in_set_butlast_concatI"><span class="command">lemma</span></span> in_set_butlast_concatI<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">:</span>set<span class="main">(</span>butlast <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">xs</span><span class="main">:</span>set <span class="free">xss</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">:</span>set<span class="main">(</span>butlast<span class="main">(</span>concat <span class="free">xss</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">xss</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> butlast_append <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> ball_simps<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span><span class="main">=</span><span class="main">[]</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_set_butlastD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(* Regular sets *)</span>

<span class="comment1">(* The main lemma:
   how to decompose a trace into a prefix, a list of loops and a suffix.
*)</span>
<span class="keyword1" id="RegSet_of_nat_DA-decompose"><span class="command">lemma</span></span> decompose<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">k</span> <span class="main">∈</span> set<span class="main">(</span>trace <span class="free">d</span> <span class="bound">i</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">pref</span> <span class="bound">mids</span> <span class="bound">suf</span><span class="main">.</span>
  <span class="free">xs</span> <span class="main">=</span> <span class="bound">pref</span> <span class="main">@</span> concat <span class="bound">mids</span> <span class="main">@</span> <span class="bound">suf</span> <span class="main">∧</span>
  deltas <span class="free">d</span> <span class="bound">pref</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>set<span class="main">(</span>butlast<span class="main">(</span>trace <span class="free">d</span> <span class="bound">i</span> <span class="bound">pref</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≠</span> <span class="free">k</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">mid</span><span class="main">∈</span>set <span class="bound">mids</span><span class="main">.</span> <span class="main">(</span>deltas <span class="free">d</span> <span class="bound">mid</span> <span class="free">k</span> <span class="main">=</span> <span class="free">k</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>set<span class="main">(</span>butlast<span class="main">(</span>trace <span class="free">d</span> <span class="free">k</span> <span class="bound">mid</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≠</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>set<span class="main">(</span>butlast<span class="main">(</span>trace <span class="free">d</span> <span class="free">k</span> <span class="bound">suf</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≠</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> a as<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> strip<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="improper">a</span> <span class="improper">i</span> <span class="main">=</span> <span class="free">k</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="improper">a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">:</span> set<span class="main">(</span>trace <span class="free">d</span> <span class="main">(</span><span class="free">d</span> <span class="improper">a</span> <span class="improper">i</span><span class="main">)</span> <span class="improper">as</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> allE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">pref</span><span class="main">#</span><span class="improper">mids</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">suf</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">as</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> in_set_butlastD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> impE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">a</span><span class="main">#</span><span class="improper">pref</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">mids</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">suf</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegSet_of_nat_DA-length_trace"><span class="command">lemma</span></span> length_trace<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> length<span class="main">(</span>trace <span class="free">d</span> <span class="bound">i</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="RegSet_of_nat_DA-deltas_append"><span class="command">lemma</span></span> deltas_append<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> deltas <span class="free">d</span> <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">)</span> <span class="bound">i</span> <span class="main">=</span> deltas <span class="free">d</span> <span class="free">ys</span> <span class="main">(</span>deltas <span class="free">d</span> <span class="free">xs</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="RegSet_of_nat_DA-trace_append"><span class="command">lemma</span></span> trace_append<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> trace <span class="free">d</span> <span class="bound">i</span> <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">)</span> <span class="main">=</span> trace <span class="free">d</span> <span class="bound">i</span> <span class="free">xs</span> <span class="main">@</span> trace <span class="free">d</span> <span class="main">(</span>deltas <span class="free">d</span> <span class="free">xs</span> <span class="bound">i</span><span class="main">)</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="RegSet_of_nat_DA-trace_concat"><span class="command">lemma</span></span> trace_concat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">xs</span> <span class="main">∈</span> set <span class="free">xss</span><span class="main">.</span> deltas <span class="free">d</span> <span class="bound">xs</span> <span class="free">i</span> <span class="main">=</span> <span class="free">i</span><span class="main">)</span> <span class="main">⟹</span>
  trace <span class="free">d</span> <span class="free">i</span> <span class="main">(</span>concat <span class="free">xss</span><span class="main">)</span> <span class="main">=</span> concat <span class="main">(</span>map <span class="main">(</span>trace <span class="free">d</span> <span class="free">i</span><span class="main">)</span> <span class="free">xss</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">xss</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="RegSet_of_nat_DA-trace_is_Nil"><span class="command">lemma</span></span> trace_is_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>trace <span class="free">d</span> <span class="bound">i</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="RegSet_of_nat_DA-trace_is_Cons_conv"><span class="command">lemma</span></span> trace_is_Cons_conv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span>trace <span class="free">d</span> <span class="free">i</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">n</span><span class="main">#</span><span class="free">ns</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">case</span> <span class="free">xs</span> <span class="keyword1">of</span> <span class="main">[]</span> <span class="main">⇒</span> False <span class="main">|</span> <span class="bound">y</span><span class="main">#</span><span class="bound">ys</span> <span class="main">⇒</span> <span class="free">n</span> <span class="main">=</span> <span class="free">d</span> <span class="bound">y</span> <span class="free">i</span> <span class="main">∧</span> <span class="free">ns</span> <span class="main">=</span> trace <span class="free">d</span> <span class="free">n</span> <span class="bound">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegSet_of_nat_DA-set_trace_conv"><span class="command">lemma</span></span> set_trace_conv<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> set<span class="main">(</span>trace <span class="free">d</span> <span class="bound">i</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="free">xs</span><span class="main">=</span><span class="main">[]</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> insert<span class="main">(</span>deltas <span class="free">d</span> <span class="free">xs</span> <span class="bound">i</span><span class="main">)</span><span class="main">(</span>set<span class="main">(</span>butlast<span class="main">(</span>trace <span class="free">d</span> <span class="bound">i</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegSet_of_nat_DA-deltas_concat"><span class="command">lemma</span></span> deltas_concat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">mid</span><span class="main">∈</span>set <span class="free">mids</span><span class="main">.</span> deltas <span class="free">d</span> <span class="bound">mid</span> <span class="free">k</span> <span class="main">=</span> <span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> deltas <span class="free">d</span> <span class="main">(</span>concat <span class="free">mids</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">mids</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1" id="RegSet_of_nat_DA-lem"><span class="command">lemma</span></span> lem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span> <span class="free">n</span> <span class="main">&lt;</span> Suc <span class="free">k</span><span class="main">;</span> <span class="free">n</span> <span class="main">≠</span> <span class="free">k</span> <span class="main">|]</span> <span class="main">==&gt;</span> <span class="free">n</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

<span class="keyword1" id="RegSet_of_nat_DA-regset_spec"><span class="command">lemma</span></span> regset_spec<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span> <span class="bound">xs</span><span class="main">.</span> <span class="bound">xs</span> <span class="main">∈</span> regset <span class="free">d</span> <span class="bound">i</span> <span class="bound">j</span> <span class="free">k</span> <span class="main">=</span>
        <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>set<span class="main">(</span>butlast<span class="main">(</span>trace <span class="free">d</span> <span class="bound">i</span> <span class="bound">xs</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">)</span> <span class="main">∧</span> deltas <span class="free">d</span> <span class="bound">xs</span> <span class="bound">i</span> <span class="main">=</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> list.split<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conc_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> exE conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">m</span><span class="main">∈</span>set<span class="main">(</span>butlast<span class="main">(</span>trace <span class="free">d</span> <span class="improper">k</span> <span class="improper">xsb</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">m</span> <span class="main">&lt;</span> Suc <span class="improper">k</span><span class="main">)</span> <span class="main">∧</span> deltas <span class="free">d</span> <span class="improper">xsb</span> <span class="improper">k</span> <span class="main">=</span> <span class="improper">k</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_trace_conv butlast_append ball_Un<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> star_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_trace_conv butlast_append ball_Un<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">k</span> <span class="main">:</span> set<span class="main">(</span>butlast<span class="main">(</span>trace <span class="free">d</span> <span class="improper">i</span> <span class="improper">xs</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>lem<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> in_set_butlastD<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> decompose<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="improper">pref</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> lem<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> bspec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"concat <span class="improper">mids</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> concat_in_star<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subset_iff<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> lem<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> bspec<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_eqI in_set_butlast_concatI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> lem<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegSet_of_nat_DA-trace_below"><span class="command">lemma</span></span> trace_below<span class="main">:</span>
 <span class="quoted"><span class="quoted">"bounded <span class="free">d</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>set<span class="main">(</span>trace <span class="free">d</span> <span class="bound">i</span> <span class="free">xs</span><span class="main">)</span><span class="main">.</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> bounded_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">xs</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">no_asm</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegSet_of_nat_DA-regset_below"><span class="command">lemma</span></span> regset_below<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">[|</span> bounded <span class="free">d</span> <span class="free">k</span><span class="main">;</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">j</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">|]</span> <span class="main">==&gt;</span>
  regset <span class="free">d</span> <span class="free">i</span> <span class="free">j</span> <span class="free">k</span> <span class="main">=</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> deltas <span class="free">d</span> <span class="bound">xs</span> <span class="free">i</span> <span class="main">=</span> <span class="free">j</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> set_eqI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> regset_spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> trace_below in_set_butlastD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegSet_of_nat_DA-deltas_below"><span class="command">lemma</span></span> deltas_below<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> bounded <span class="free">d</span> <span class="free">k</span> <span class="main">⟹</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> deltas <span class="free">d</span> <span class="free">w</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> bounded_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">w</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="RegSet_of_nat_DA-regset_DA_equiv"><span class="command">lemma</span></span> regset_DA_equiv<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">[|</span> bounded <span class="main">(</span>next <span class="free">A</span><span class="main">)</span> <span class="free">k</span><span class="main">;</span> start <span class="free">A</span> <span class="main">&lt;</span> <span class="free">k</span><span class="main">;</span> <span class="free">j</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">|]</span> <span class="main">==&gt;</span>
  <span class="free">w</span> <span class="main">:</span> regset_of_DA <span class="free">A</span> <span class="free">k</span> <span class="main">=</span> accepts <span class="free">A</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> regset_of_DA_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> conj_cong
            <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> regset_below deltas_below accepts_def delta_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Execute">
<div class="head">
<h1>Theory Execute</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:    Lukas Bulwahn, TUM 2011 *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Executing Automata and membership of Regular Expressions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Execute
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#AutoRegExp">AutoRegExp</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Example›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">example_expression</span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">example_expression</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">r0</span> <span class="main">=</span> Atom <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">;</span> <span class="bound">r1</span> <span class="main">=</span> Atom <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span>
     <span class="keyword1">in</span> Times <span class="main">(</span>Star <span class="main">(</span>Plus <span class="main">(</span>Times <span class="bound">r1</span> <span class="bound">r1</span><span class="main">)</span> <span class="bound">r0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Star <span class="main">(</span>Plus <span class="main">(</span>Times <span class="bound">r0</span> <span class="bound">r0</span><span class="main">)</span> <span class="bound">r1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"NA.accepts <span class="main">(</span>rexp2na example_expression<span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"DA.accepts <span class="main">(</span>na2da <span class="main">(</span>rexp2na example_expression<span class="main">)</span><span class="main">)</span> <span class="main">[</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">,</span><span class="main">1</span><span class="main">]</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Functional_Automata">
<div class="head">
<h1>Theory Functional_Automata</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Functional_Automata
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#AutoRegExp">AutoRegExp</a> <a href="#AutoMaxChop">AutoMaxChop</a> <a href="#RegSet_of_nat_DA">RegSet_of_nat_DA</a> <a href="#Execute">Execute</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>