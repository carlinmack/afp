<div id="Quaternions">
<div class="head">
<h1>Theory Quaternions</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Theory of Quaternions›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This theory is inspired by the HOL Light development of quaternions, but follows its own route. 
Quaternions are developed coinductively, as in the existing formalisation of the complex numbers. 
Quaternions are quickly shown to belong to the type classes of real normed division algebras 
and real inner product spaces. And therefore they inherit a great body of facts involving algebraic 
laws, limits, continuity, etc., which must be proved explicitly in the HOL Light version. 
The development concludes with the geometric interpretation of the product of imaginary quaternions.›</span></span>
<span class="keyword1"><span class="command">theory</span></span> <span class="quoted">"Quaternions"</span>
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Analysis/Multivariate_Analysis.html">HOL-Analysis.Multivariate_Analysis</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Basic definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹As with the complex numbers, coinduction is convenient›</span></span>

<span class="keyword1"><span class="command">codatatype</span></span> quat <span class="main">=</span> Quat <span class="main">(</span><span class="free"><span class="entity">Re</span></span><span class="main">:</span> <span class="quoted">real</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">Im1</span></span><span class="main">:</span> <span class="quoted">real</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">Im2</span></span><span class="main">:</span> <span class="quoted">real</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">Im3</span></span><span class="main">:</span> <span class="quoted">real</span><span class="main">)</span>

<span class="keyword1" id="Quaternions-quat_eqI"><span class="command">lemma</span></span> quat_eqI <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Re <span class="free">x</span> <span class="main">=</span> Re <span class="free">y</span><span class="main">;</span> Im1 <span class="free">x</span> <span class="main">=</span> Im1 <span class="free">y</span><span class="main">;</span> Im2 <span class="free">x</span> <span class="main">=</span> Im2 <span class="free">y</span><span class="main">;</span> Im3 <span class="free">x</span> <span class="main">=</span> Im3 <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> quat.expand<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1" id="Quaternions-quat_eq_iff"><span class="command">lemma</span></span> quat_eq_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">⟷</span> Re <span class="free">x</span> <span class="main">=</span> Re <span class="free">y</span> <span class="main">∧</span> Im1 <span class="free">x</span> <span class="main">=</span> Im1 <span class="free">y</span> <span class="main">∧</span> Im2 <span class="free">x</span> <span class="main">=</span> Im2 <span class="free">y</span> <span class="main">∧</span> Im3 <span class="free">x</span> <span class="main">=</span> Im3 <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> quat.expand<span class="main">)</span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">no_notation</span></span> Complex.imaginary_unit <span class="main">(</span><span class="quoted">"<span class="keyword1">𝗂</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">quat_ii</span> <span class="main">::</span> <span class="quoted">quat</span>  <span class="main">(</span><span class="quoted">"<span class="keyword1">𝗂</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Re <span class="keyword1"><span class="free">𝗂</span></span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"Im1 <span class="keyword1"><span class="free">𝗂</span></span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"Im2 <span class="keyword1"><span class="free">𝗂</span></span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"Im3 <span class="keyword1"><span class="free">𝗂</span></span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">quat_jj</span> <span class="main">::</span> <span class="quoted">quat</span>  <span class="main">(</span><span class="quoted">"<span class="keyword1">𝗃</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Re <span class="keyword1"><span class="free">𝗃</span></span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"Im1 <span class="keyword1"><span class="free">𝗃</span></span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"Im2 <span class="keyword1"><span class="free">𝗃</span></span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"Im3 <span class="keyword1"><span class="free">𝗃</span></span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">quat_kk</span> <span class="main">::</span> <span class="quoted">quat</span>  <span class="main">(</span><span class="quoted">"<span class="keyword1">𝗄</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Re <span class="keyword1"><span class="free">𝗄</span></span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"Im1 <span class="keyword1"><span class="free">𝗄</span></span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"Im2 <span class="keyword1"><span class="free">𝗄</span></span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"Im3 <span class="keyword1"><span class="free">𝗄</span></span> <span class="main">=</span> <span class="main">1</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">bundle</span></span> quaternion_syntax <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">notation</span></span> quat_ii <span class="main">(</span><span class="quoted">"<span class="keyword1">𝗂</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> Complex.imaginary_unit <span class="main">(</span><span class="quoted">"<span class="keyword1">𝗂</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">bundle</span></span> no_quaternion_syntax <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">no_notation</span></span> quat_ii <span class="main">(</span><span class="quoted">"<span class="keyword1">𝗂</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> Complex.imaginary_unit <span class="main">(</span><span class="quoted">"<span class="keyword1">𝗂</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">unbundle</span></span> quaternion_syntax

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Addition and Subtraction: An Abelian Group›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> quat <span class="main">::</span> <span class="quoted">ab_group_add</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity"><span class="class_parameter">zero_quat</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span><span class="quoted"><span class="quoted">"Im1 <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"Im2 <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"Im3 <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity"><span class="class_parameter">plus_quat</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Re <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> Re <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Im1 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Im1 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> Im1 <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Im2 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Im2 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> Im2 <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Im3 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Im3 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> Im3 <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity"><span class="class_parameter">uminus_quat</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">-</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> Re <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Im1 <span class="main">(</span><span class="main">-</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> Im1 <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Im2 <span class="main">(</span><span class="main">-</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> Im2 <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Im3 <span class="main">(</span><span class="main">-</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> Im3 <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity"><span class="class_parameter">minus_quat</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Re <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> Re <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Im1 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Im1 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> Im1 <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Im2 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Im2 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> Im2 <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Im3 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Im3 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> Im3 <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹A Vector Space›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> quat <span class="main">::</span> <span class="quoted">real_vector</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity"><span class="class_parameter">scaleR_quat</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"Re <span class="main">(</span>scaleR <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">*</span> Re <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Im1 <span class="main">(</span>scaleR <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">*</span> Im1 <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Im2 <span class="main">(</span>scaleR <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">*</span> Im2 <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Im3 <span class="main">(</span>scaleR <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">*</span> Im3 <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> quat_eq_iff distrib_left distrib_right  scaleR_add_right<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> quat <span class="main">::</span> <span class="quoted">real_algebra_1</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity"><span class="class_parameter">one_quat</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"Im1 <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"Im2 <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"Im3 <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity"><span class="class_parameter">times_quat</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Re <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> Re <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">-</span> Im1 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> Im1 <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">-</span> Im2 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> Im2 <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">-</span> Im3 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> Im3 <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Im1 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Re <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> Im1 <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">+</span> Im1 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span>  Re <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">+</span> Im2 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> Im3 <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">-</span> Im3 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> Im2 <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Im2 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Re <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> Im2 <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">-</span> Im1 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> Im3 <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">+</span> Im2 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span>  Re <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">+</span> Im3 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> Im1 <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Im3 <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> Re <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> Im3 <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">+</span> Im1 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> Im2 <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">-</span> Im2 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> Im1 <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">+</span> Im3 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span>  Re <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> quat_eq_iff distrib_left distrib_right Rings.right_diff_distrib Rings.left_diff_distrib<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Multiplication and Division: A Real Division Algebra›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> quat <span class="main">::</span> <span class="quoted">real_div_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity"><span class="class_parameter">inverse_quat</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"Re <span class="main">(</span>inverse <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> Re <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span>Re <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im1 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im2 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im3 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Im1 <span class="main">(</span>inverse <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span>Im1 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span>Re <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im1 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im2 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im3 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Im2 <span class="main">(</span>inverse <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span>Im2 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span>Re <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im1 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im2 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im3 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Im3 <span class="main">(</span>inverse <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span>Im3 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span>Re <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im1 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im2 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im3 <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> inverse <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">quat</span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>quat<span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> inverse <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> quat_eq_iff add_nonneg_eq_0_iff
        power2_eq_square add_divide_distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> diff_divide_distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>quat<span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">*</span> inverse <span class="bound">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> quat_eq_iff add_nonneg_eq_0_iff power2_eq_square add_divide_distrib <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">::</span>quat<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">div</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">*</span> inverse <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_quat_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inverse <span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>quat<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> quat_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Multiplication and Division: A Real Normed Division Algebra›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">quat_proj</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">quat_proj</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">0</span> <span class="main">=</span> Re <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">quat_proj</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">=</span> Im1 <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">quat_proj</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Im2 <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">quat_proj</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Im3 <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1" id="Quaternions-quat_proj_add"><span class="command">lemma</span></span> quat_proj_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="numeral">3</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"quat_proj <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="free">i</span> <span class="main">=</span> quat_proj <span class="free">x</span> <span class="free">i</span> <span class="main">+</span> quat_proj <span class="free">y</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">cases</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> numeral_2_eq_2 numeral_3_eq_3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> quat <span class="main">::</span> <span class="quoted">real_normed_div_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"norm <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> sqrt <span class="main">(</span><span class="main">(</span>Re <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im1 <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im2 <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im3 <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"sgn <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> norm <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">quat</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"dist <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> norm <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">quat</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>uniformity <span class="main">::</span> <span class="main">(</span>quat <span class="main">×</span> quat<span class="main">)</span> filter<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">e</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span> <span class="main">&lt;..}</span><span class="main">.</span> principal <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> dist <span class="bound">x</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"open <span class="main">(</span><span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">::</span> quat set<span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">.</span> eventually <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> uniformity<span class="main">)</span>"</span></span>

<span class="keyword1" id="Quaternions-norm_eq_L2"><span class="command">lemma</span></span> norm_eq_L2<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="free">z</span> <span class="main">=</span> L2_set <span class="main">(</span>quat_proj <span class="free">z</span><span class="main">)</span> <span class="main">{..</span><span class="numeral">3</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_quat_def L2_set_def numeral_3_eq_3<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">quat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"quat set"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>norm <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_quat_def quat_eq_iff add_nonneg_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"L2_set <span class="main">(</span>quat_proj <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">{..</span><span class="numeral">3</span><span class="main">}</span> <span class="main">=</span> L2_set <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> quat_proj <span class="skolem">x</span> <span class="bound">i</span> <span class="main">+</span> quat_proj <span class="skolem">y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">{..</span><span class="numeral">3</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> L2_set_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> quat_proj_add<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> norm <span class="skolem">x</span> <span class="main">+</span> norm <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_eq_L2 eq L2_set_triangle_ineq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>scaleR <span class="skolem">r</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">r</span><span class="main">¦</span> <span class="main">*</span> norm <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_quat_def quat_eq_iff power_mult_distrib distrib_left <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> real_sqrt_mult<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> norm <span class="skolem">x</span> <span class="main">*</span> norm <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_quat_def quat_eq_iff real_sqrt_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
        power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> sgn_quat_def dist_quat_def open_quat_def uniformity_quat_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">instantiation</span></span> quat <span class="main">::</span> <span class="quoted">real_inner</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> inner_quat_def<span class="main">:</span>
  <span class="quoted"><span class="quoted">"inner <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> Re <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> Re <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">+</span> Im1 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> Im1 <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">+</span> Im2 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> Im2 <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">+</span> Im3 <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> Im3 <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">quat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">r</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inner <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">=</span> inner <span class="skolem">y</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inner_quat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inner <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> inner <span class="skolem">x</span> <span class="skolem">z</span> <span class="main">+</span> inner <span class="skolem">y</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inner_quat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_right<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inner <span class="main">(</span>scaleR <span class="skolem">r</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">*</span> inner <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inner_quat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> inner <span class="skolem">x</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inner_quat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inner <span class="skolem">x</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inner_quat_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_nonneg_eq_0_iff quat_eq_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="skolem">x</span> <span class="main">=</span> sqrt <span class="main">(</span>inner <span class="skolem">x</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inner_quat_def norm_quat_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Quaternions-quat_inner_1"><span class="command">lemma</span></span> quat_inner_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inner <span class="main">1</span> <span class="free">x</span> <span class="main">=</span> Re <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inner_quat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quaternions-quat_inner_1_right"><span class="command">lemma</span></span> quat_inner_1_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inner <span class="free">x</span> <span class="main">1</span> <span class="main">=</span> Re <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inner_quat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quaternions-quat_inner_i_left"><span class="command">lemma</span></span> quat_inner_i_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inner <span class="keyword1">𝗂</span> <span class="free">x</span> <span class="main">=</span> Im1 <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inner_quat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quaternions-quat_inner_i_right"><span class="command">lemma</span></span> quat_inner_i_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inner <span class="free">x</span> <span class="keyword1">𝗂</span> <span class="main">=</span> Im1 <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inner_quat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quaternions-quat_inner_j_left"><span class="command">lemma</span></span> quat_inner_j_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inner <span class="keyword1">𝗃</span> <span class="free">x</span> <span class="main">=</span> Im2 <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inner_quat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quaternions-quat_inner_j_right"><span class="command">lemma</span></span> quat_inner_j_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inner <span class="free">x</span> <span class="keyword1">𝗃</span> <span class="main">=</span> Im2 <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inner_quat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quaternions-quat_inner_k_left"><span class="command">lemma</span></span> quat_inner_k_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inner <span class="keyword1">𝗄</span> <span class="free">x</span> <span class="main">=</span> Im3 <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inner_quat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quaternions-quat_inner_k_right"><span class="command">lemma</span></span> quat_inner_k_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inner <span class="free">x</span> <span class="keyword1">𝗄</span> <span class="main">=</span> Im3 <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inner_quat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">quat_of_real</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> quat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">quat_of_real</span> <span class="main">≡</span> of_real"</span></span>

<span class="keyword1" id="Quaternions-Re_quat_of_real"><span class="command">lemma</span></span> Re_quat_of_real <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span>quat_of_real <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_real_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-Im1_quat_of_real"><span class="command">lemma</span></span> Im1_quat_of_real <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Im1<span class="main">(</span>quat_of_real <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_real_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-Im2_quat_of_real"><span class="command">lemma</span></span> Im2_quat_of_real <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Im2<span class="main">(</span>quat_of_real <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_real_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-Im3_quat_of_real"><span class="command">lemma</span></span> Im3_quat_of_real <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Im3<span class="main">(</span>quat_of_real <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_real_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-quat_eq_0_iff"><span class="command">lemma</span></span> quat_eq_0_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span>Re <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im1 <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im2 <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im3 <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>quat.Re <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im1 <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im2 <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im3 <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">qa</span><span class="main">.</span> <span class="bound">qa</span> <span class="main">-</span> <span class="free">q</span> <span class="main">=</span> <span class="bound">qa</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_nonneg_eq_0_iff minus_quat.ctr<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Quaternions-quat_of_real_times_commute"><span class="command">lemma</span></span> quat_of_real_times_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"quat_of_real <span class="free">r</span> <span class="main">*</span> <span class="free">q</span> <span class="main">=</span> <span class="free">q</span> <span class="main">*</span> of_real <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_real_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-quat_of_real_times_left_commute"><span class="command">lemma</span></span> quat_of_real_times_left_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"quat_of_real <span class="free">r</span> <span class="main">*</span> <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span>of_real <span class="free">r</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_real_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-quat_norm_units"><span class="command">lemma</span></span> quat_norm_units <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm quat_ii <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="keyword1">𝗃</span><span class="main">::</span>quat<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="keyword1">𝗄</span><span class="main">::</span>quat<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_quat_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-ii_nz"><span class="command">lemma</span></span> ii_nz <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"quat_ii <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> quat_ii.simps<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Quaternions-jj_nz"><span class="command">lemma</span></span> jj_nz <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗃</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> quat_jj.sel<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Quaternions-kk_nz"><span class="command">lemma</span></span> kk_nz <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗄</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> quat_kk.sel<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹An "expansion" theorem into the traditional notation›</span></span>

<span class="keyword1" id="Quaternions-quat_unfold"><span class="command">lemma</span></span> quat_unfold<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> of_real<span class="main">(</span>Re <span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> of_real<span class="main">(</span>Im1 <span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗃</span> <span class="main">*</span> of_real<span class="main">(</span>Im2 <span class="free">q</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">𝗄</span> <span class="main">*</span> of_real<span class="main">(</span>Im3 <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-quat_trad"><span class="command">lemma</span></span> quat_trad<span class="main">:</span> <span class="quoted"><span class="quoted">"Quat <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="free">w</span> <span class="main">=</span> of_real <span class="free">x</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> of_real <span class="free">y</span> <span class="main">+</span> <span class="keyword1">𝗃</span> <span class="main">*</span> of_real <span class="free">z</span> <span class="main">+</span> <span class="keyword1">𝗄</span> <span class="main">*</span> of_real <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-of_real_eq_Quat"><span class="command">lemma</span></span> of_real_eq_Quat<span class="main">:</span> <span class="quoted"><span class="quoted">"of_real <span class="free">a</span> <span class="main">=</span> Quat <span class="free">a</span> <span class="main">0</span> <span class="main">0</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_trad<span class="main">)</span>

<span class="keyword1" id="Quaternions-ii_squared"><span class="command">lemma</span></span> ii_squared <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"quat_ii<span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square quat.expand<span class="main">)</span>

<span class="keyword1" id="Quaternions-jj_squared"><span class="command">lemma</span></span> jj_squared <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗃</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square quat.expand<span class="main">)</span>

<span class="keyword1" id="Quaternions-kk_squared"><span class="command">lemma</span></span> kk_squared <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗄</span><span class="main">^</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square quat.expand<span class="main">)</span>

<span class="keyword1" id="Quaternions-inverse_ii"><span class="command">lemma</span></span> inverse_ii <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inverse quat_ii <span class="main">=</span> <span class="main">-</span>quat_ii"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square quat.expand<span class="main">)</span>

<span class="keyword1" id="Quaternions-inverse_jj"><span class="command">lemma</span></span> inverse_jj <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="keyword1">𝗃</span> <span class="main">=</span> <span class="main">-</span><span class="keyword1">𝗃</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square quat.expand<span class="main">)</span>

<span class="keyword1" id="Quaternions-inverse_kk"><span class="command">lemma</span></span> inverse_kk <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="keyword1">𝗄</span> <span class="main">=</span> <span class="main">-</span><span class="keyword1">𝗄</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square quat.expand<span class="main">)</span>

<span class="keyword1" id="Quaternions-inverse_mult"><span class="command">lemma</span></span> inverse_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="main">(</span><span class="free">p</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> inverse <span class="free">q</span> <span class="main">*</span> inverse <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted">quat</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inverse_zero mult_not_zero nonzero_inverse_mult_distrib<span class="main">)</span>

<span class="keyword1" id="Quaternions-quat_of_real_inverse_collapse"><span class="command">lemma</span></span> quat_of_real_inverse_collapse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"quat_of_real <span class="free">c</span> <span class="main">*</span> quat_of_real <span class="main">(</span>inverse <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"quat_of_real <span class="main">(</span>inverse <span class="free">c</span><span class="main">)</span> <span class="main">*</span> quat_of_real <span class="free">c</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Conjugate of a quaternion›</span></span>

<span class="keyword1"><span class="command">primcorec</span></span> <span class="entity">cnj</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"quat <span class="main">⇒</span> quat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">cnj</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">=</span> Re <span class="free"><span class="bound"><span class="entity">z</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Im1 <span class="main">(</span><span class="free">cnj</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> Im1 <span class="free"><span class="bound"><span class="entity">z</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Im2 <span class="main">(</span><span class="free">cnj</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> Im2 <span class="free"><span class="bound"><span class="entity">z</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"Im3 <span class="main">(</span><span class="free">cnj</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> Im3 <span class="free"><span class="bound"><span class="entity">z</span></span></span>"</span></span>


<span class="keyword1" id="Quaternions-cnj_cancel_iff"><span class="command">lemma</span></span> cnj_cancel_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="free">x</span> <span class="main">=</span> cnj <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cnj <span class="free">x</span> <span class="main">=</span> cnj <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Quaternions-cnj_cnj"><span class="command">lemma</span></span> cnj_cnj <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
   <span class="quoted"><span class="quoted">"cnj<span class="main">(</span>cnj <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-cnj_of_real"><span class="command">lemma</span></span> cnj_of_real <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj<span class="main">(</span>quat_of_real <span class="free">x</span><span class="main">)</span> <span class="main">=</span> quat_of_real <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eqI<span class="main">)</span>

<span class="keyword1" id="Quaternions-cnj_zero"><span class="command">lemma</span></span> cnj_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-cnj_zero_iff"><span class="command">lemma</span></span> cnj_zero_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="free">z</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-cnj_one"><span class="command">lemma</span></span> cnj_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="main">1</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-cnj_one_iff"><span class="command">lemma</span></span> cnj_one_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="free">z</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">z</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-quat_norm_cnj"><span class="command">lemma</span></span> quat_norm_cnj <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm<span class="main">(</span>cnj <span class="free">q</span><span class="main">)</span> <span class="main">=</span> norm <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_quat_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-cnj_add"><span class="command">lemma</span></span> cnj_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> cnj <span class="free">x</span> <span class="main">+</span> cnj <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-cnj_sum"><span class="command">lemma</span></span> cnj_sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span>sum <span class="free">f</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> cnj <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Quaternions-cnj_diff"><span class="command">lemma</span></span> cnj_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> cnj <span class="free">x</span> <span class="main">-</span> cnj <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-cnj_minus"><span class="command">lemma</span></span> cnj_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span><span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> cnj <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-cnj_mult"><span class="command">lemma</span></span> cnj_mult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> cnj <span class="free">y</span> <span class="main">*</span> cnj <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-cnj_inverse"><span class="command">lemma</span></span> cnj_inverse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span>inverse <span class="free">x</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span>cnj <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-cnj_divide"><span class="command">lemma</span></span> cnj_divide <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span><span class="free">x</span> <span class="main">/</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span>cnj <span class="free">y</span><span class="main">)</span> <span class="main">*</span> cnj <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_quat_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-cnj_power"><span class="command">lemma</span></span> cnj_power <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span><span class="free">x</span><span class="main">^</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> cnj <span class="free">x</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power_commutes<span class="main">)</span>

<span class="keyword1" id="Quaternions-cnj_of_nat"><span class="command">lemma</span></span> cnj_of_nat <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span>of_nat <span class="free">n</span><span class="main">)</span> <span class="main">=</span> of_nat <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cnj_of_real of_real_of_nat_eq<span class="main">)</span>

<span class="keyword1" id="Quaternions-cnj_of_int"><span class="command">lemma</span></span> cnj_of_int <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span>of_int <span class="free">z</span><span class="main">)</span> <span class="main">=</span> of_int <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cnj_of_real of_real_of_int_eq<span class="main">)</span>

<span class="keyword1" id="Quaternions-cnj_numeral"><span class="command">lemma</span></span> cnj_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span>numeral <span class="free">w</span><span class="main">)</span> <span class="main">=</span> numeral <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> of_nat_numeral cnj_of_nat<span class="main">)</span>

<span class="keyword1" id="Quaternions-cnj_neg_numeral"><span class="command">lemma</span></span> cnj_neg_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span><span class="main">-</span> numeral <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> numeral <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quaternions-cnj_scaleR"><span class="command">lemma</span></span> cnj_scaleR <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span>scaleR <span class="free">r</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> scaleR <span class="free">r</span> <span class="main">(</span>cnj <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-cnj_units"><span class="command">lemma</span></span> cnj_units <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj quat_ii <span class="main">=</span> <span class="main">-</span><span class="keyword1">𝗂</span>"</span></span> <span class="quoted"><span class="quoted">"cnj <span class="keyword1">𝗃</span> <span class="main">=</span> <span class="main">-</span><span class="keyword1">𝗃</span>"</span></span> <span class="quoted"><span class="quoted">"cnj <span class="keyword1">𝗄</span> <span class="main">=</span> <span class="main">-</span><span class="keyword1">𝗄</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-cnj_eq_of_real"><span class="command">lemma</span></span> cnj_eq_of_real<span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="free">q</span> <span class="main">=</span> quat_of_real <span class="free">x</span> <span class="main">⟷</span> <span class="free">q</span> <span class="main">=</span> quat_of_real <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cnj <span class="free">q</span> <span class="main">=</span> quat_of_real <span class="free">x</span> <span class="main">⟹</span> <span class="free">q</span> <span class="main">=</span> quat_of_real <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cnj_of_real cnj_cnj<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Quaternions-quat_add_cnj"><span class="command">lemma</span></span> quat_add_cnj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">+</span> cnj <span class="free">q</span> <span class="main">=</span> quat_of_real<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Re <span class="free">q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"cnj <span class="free">q</span> <span class="main">+</span> <span class="free">q</span> <span class="main">=</span> quat_of_real<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Re <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute mult_2 plus_quat.code<span class="main">)</span>

<span class="keyword1" id="Quaternions-quat_divide_numeral"><span class="command">lemma</span></span> quat_divide_numeral<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">quat</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">/</span> numeral <span class="free">w</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> numeral <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> divide_quat_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.right_neutral mult_scaleR_right of_real_def of_real_inverse of_real_numeral<span class="main">)</span>

<span class="keyword1" id="Quaternions-Re_divide_numeral"><span class="command">lemma</span></span> Re_divide_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="free">x</span> <span class="main">/</span> numeral <span class="free">w</span><span class="main">)</span> <span class="main">=</span> Re <span class="free">x</span> <span class="main">/</span> numeral <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> divide_inverse_commute quat_divide_numeral scaleR_quat.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Quaternions-Im1_divide_numeral"><span class="command">lemma</span></span> Im1_divide_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Im1 <span class="main">(</span><span class="free">x</span> <span class="main">/</span> numeral <span class="free">w</span><span class="main">)</span> <span class="main">=</span> Im1 <span class="free">x</span> <span class="main">/</span> numeral <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> quat_divide_numeral <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quaternions-Im2_divide_numeral"><span class="command">lemma</span></span> Im2_divide_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Im2 <span class="main">(</span><span class="free">x</span> <span class="main">/</span> numeral <span class="free">w</span><span class="main">)</span> <span class="main">=</span> Im2 <span class="free">x</span> <span class="main">/</span> numeral <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> quat_divide_numeral <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quaternions-Im3_divide_numeral"><span class="command">lemma</span></span> Im3_divide_numeral <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Im3 <span class="main">(</span><span class="free">x</span> <span class="main">/</span> numeral <span class="free">w</span><span class="main">)</span> <span class="main">=</span> Im3 <span class="free">x</span> <span class="main">/</span> numeral <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> quat_divide_numeral <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1" id="Quaternions-of_real_quat_re_cnj"><span class="command">lemma</span></span> of_real_quat_re_cnj<span class="main">:</span> <span class="quoted"><span class="quoted">"quat_of_real<span class="main">(</span>Re <span class="free">q</span><span class="main">)</span> <span class="main">=</span> inverse<span class="main">(</span>quat_of_real <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">q</span> <span class="main">+</span> cnj <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-quat_mult_cnj_commute"><span class="command">lemma</span></span> quat_mult_cnj_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"cnj <span class="free">q</span> <span class="main">*</span> <span class="free">q</span> <span class="main">=</span> <span class="free">q</span> <span class="main">*</span> cnj <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-quat_norm_pow_2"><span class="command">lemma</span></span> quat_norm_pow_2<span class="main">:</span> <span class="quoted"><span class="quoted">"quat_of_real<span class="main">(</span>norm <span class="free">q</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> <span class="free">q</span> <span class="main">*</span> cnj <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff norm_quat_def <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> of_real_power<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>

<span class="keyword1" id="Quaternions-quat_norm_pow_2_alt"><span class="command">lemma</span></span> quat_norm_pow_2_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"quat_of_real<span class="main">(</span>norm <span class="free">q</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> cnj <span class="free">q</span> <span class="main">*</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_mult_cnj_commute quat_norm_pow_2<span class="main">)</span>

<span class="keyword1" id="Quaternions-quat_inverse_cnj"><span class="command">lemma</span></span> quat_inverse_cnj<span class="main">:</span> <span class="quoted"><span class="quoted">"inverse <span class="free">q</span> <span class="main">=</span> inverse <span class="main">(</span>quat_of_real<span class="main">(</span><span class="main">(</span>norm <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> cnj <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff norm_quat_def numeral_Bit0 <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> of_real_power<span class="main">)</span>

<span class="keyword1" id="Quaternions-quat_inverse_eq_cnj"><span class="command">lemma</span></span> quat_inverse_eq_cnj<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="free">q</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> inverse <span class="free">q</span> <span class="main">=</span> cnj <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inverse_1 mult_cancel_left norm_eq_zero norm_one cnj_one quat_norm_pow_2 right_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Linearity and continuity of the components›</span></span>

<span class="keyword1" id="Quaternions-bounded_linear_Re"><span class="command">lemma</span></span> bounded_linear_Re<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded_linear Re"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bounded_linear_Im1<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded_linear Im1"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bounded_linear_Im2<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded_linear Im2"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bounded_linear_Im3<span class="main">:</span> <span class="quoted"><span class="quoted">"bounded_linear Im3"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bounded_linear_intro <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> K<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span> norm_quat_def real_le_rsqrt add.assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> Cauchy_Re <span class="main">=</span> bounded_linear.Cauchy <span class="main">[</span><span class="operator">OF</span> bounded_linear_Re<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> Cauchy_Im1 <span class="main">=</span> bounded_linear.Cauchy <span class="main">[</span><span class="operator">OF</span> bounded_linear_Im1<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> Cauchy_Im2 <span class="main">=</span> bounded_linear.Cauchy <span class="main">[</span><span class="operator">OF</span> bounded_linear_Im2<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> Cauchy_Im3 <span class="main">=</span> bounded_linear.Cauchy <span class="main">[</span><span class="operator">OF</span> bounded_linear_Im3<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> tendsto_Re <span class="main">[</span><span class="operator">tendsto_intros</span><span class="main">]</span> <span class="main">=</span> bounded_linear.tendsto <span class="main">[</span><span class="operator">OF</span> bounded_linear_Re<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> tendsto_Im1 <span class="main">[</span><span class="operator">tendsto_intros</span><span class="main">]</span> <span class="main">=</span> bounded_linear.tendsto <span class="main">[</span><span class="operator">OF</span> bounded_linear_Im1<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> tendsto_Im2 <span class="main">[</span><span class="operator">tendsto_intros</span><span class="main">]</span> <span class="main">=</span> bounded_linear.tendsto <span class="main">[</span><span class="operator">OF</span> bounded_linear_Im2<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> tendsto_Im3 <span class="main">[</span><span class="operator">tendsto_intros</span><span class="main">]</span> <span class="main">=</span> bounded_linear.tendsto <span class="main">[</span><span class="operator">OF</span> bounded_linear_Im3<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> isCont_Re <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> bounded_linear.isCont <span class="main">[</span><span class="operator">OF</span> bounded_linear_Re<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> isCont_Im1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> bounded_linear.isCont <span class="main">[</span><span class="operator">OF</span> bounded_linear_Im1<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> isCont_Im2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> bounded_linear.isCont <span class="main">[</span><span class="operator">OF</span> bounded_linear_Im2<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> isCont_Im3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> bounded_linear.isCont <span class="main">[</span><span class="operator">OF</span> bounded_linear_Im3<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> continuous_Re <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> bounded_linear.continuous <span class="main">[</span><span class="operator">OF</span> bounded_linear_Re<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> continuous_Im1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> bounded_linear.continuous <span class="main">[</span><span class="operator">OF</span> bounded_linear_Im1<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> continuous_Im2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> bounded_linear.continuous <span class="main">[</span><span class="operator">OF</span> bounded_linear_Im2<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> continuous_Im3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> bounded_linear.continuous <span class="main">[</span><span class="operator">OF</span> bounded_linear_Im3<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> continuous_on_Re <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span> <span class="main">=</span> bounded_linear.continuous_on<span class="main">[</span><span class="operator">OF</span> bounded_linear_Re<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> continuous_on_Im1 <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span> <span class="main">=</span> bounded_linear.continuous_on<span class="main">[</span><span class="operator">OF</span> bounded_linear_Im1<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> continuous_on_Im2 <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span> <span class="main">=</span> bounded_linear.continuous_on<span class="main">[</span><span class="operator">OF</span> bounded_linear_Im2<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> continuous_on_Im3 <span class="main">[</span><span class="operator">continuous_intros</span><span class="main">]</span> <span class="main">=</span> bounded_linear.continuous_on<span class="main">[</span><span class="operator">OF</span> bounded_linear_Im3<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> has_derivative_Re <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span> <span class="main">=</span> bounded_linear.has_derivative<span class="main">[</span><span class="operator">OF</span> bounded_linear_Re<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> has_derivative_Im1 <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span> <span class="main">=</span> bounded_linear.has_derivative<span class="main">[</span><span class="operator">OF</span> bounded_linear_Im1<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> has_derivative_Im2 <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span> <span class="main">=</span> bounded_linear.has_derivative<span class="main">[</span><span class="operator">OF</span> bounded_linear_Im2<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> has_derivative_Im3 <span class="main">[</span><span class="operator">derivative_intros</span><span class="main">]</span> <span class="main">=</span> bounded_linear.has_derivative<span class="main">[</span><span class="operator">OF</span> bounded_linear_Im3<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> sums_Re <span class="main">=</span> bounded_linear.sums <span class="main">[</span><span class="operator">OF</span> bounded_linear_Re<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> sums_Im1 <span class="main">=</span> bounded_linear.sums <span class="main">[</span><span class="operator">OF</span> bounded_linear_Im1<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> sums_Im2 <span class="main">=</span> bounded_linear.sums <span class="main">[</span><span class="operator">OF</span> bounded_linear_Im2<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> sums_Im3 <span class="main">=</span> bounded_linear.sums <span class="main">[</span><span class="operator">OF</span> bounded_linear_Im3<span class="main">]</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Quaternionic-specific theorems about sums›</span></span>

<span class="keyword1" id="Quaternions-Re_sum"><span class="command">lemma</span></span> Re_sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span>sum <span class="free">f</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span>  Re<span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> quat"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Quaternions-Im1_sum"><span class="command">lemma</span></span> Im1_sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Im1<span class="main">(</span>sum <span class="free">f</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Im1<span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Quaternions-Im2_sum"><span class="command">lemma</span></span> Im2_sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Im2<span class="main">(</span>sum <span class="free">f</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Im2<span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Quaternions-Im3_sum"><span class="command">lemma</span></span> Im3_sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Im3<span class="main">(</span>sum <span class="free">f</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Im3<span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Quaternions-in_Reals_iff_Re"><span class="command">lemma</span></span> in_Reals_iff_Re<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> Reals <span class="main">⟷</span> quat_of_real<span class="main">(</span>Re <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Re_quat_of_real Reals_cases Reals_of_real<span class="main">)</span>

<span class="keyword1" id="Quaternions-in_Reals_iff_cnj"><span class="command">lemma</span></span> in_Reals_iff_cnj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> Reals <span class="main">⟷</span> cnj <span class="free">q</span> <span class="main">=</span> <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> in_Reals_iff_Re quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-real_norm"><span class="command">lemma</span></span> real_norm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> Reals <span class="main">⟹</span> norm <span class="free">q</span> <span class="main">=</span> abs<span class="main">(</span>Re <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> in_Reals_iff_Re norm_of_real<span class="main">)</span>


<span class="keyword1" id="Quaternions-norm_power2"><span class="command">lemma</span></span> norm_power2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>norm <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> Re<span class="main">(</span>cnj <span class="free">q</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Re_quat_of_real of_real_power quat_mult_cnj_commute quat_norm_pow_2<span class="main">)</span>

<span class="keyword1" id="Quaternions-quat_norm_imaginary"><span class="command">lemma</span></span> quat_norm_imaginary<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span>quat_of_real <span class="main">(</span>norm <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> quat_norm_pow_2
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> power2_eq_square cnj.ctr times_quat.ctr uminus_quat.ctr<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Bound results for real and imaginary components of limits›</span></span>

<span class="keyword1" id="Quaternions-Re_tendsto_upperbound"><span class="command">lemma</span></span> Re_tendsto_upperbound<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">l</span><span class="main">)</span> <span class="free">net</span><span class="main">;</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">net</span><span class="main">.</span> quat.Re <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span><span class="main">;</span> <span class="free">net</span> <span class="main">≠</span> bot<span class="main">⟧</span> <span class="main">⟹</span> Re <span class="free">l</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> tendsto_upperbound <span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_Re<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Quaternions-Im1_tendsto_upperbound"><span class="command">lemma</span></span> Im1_tendsto_upperbound<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">l</span><span class="main">)</span> <span class="free">net</span><span class="main">;</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">net</span><span class="main">.</span> Im1 <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span><span class="main">;</span> <span class="free">net</span> <span class="main">≠</span> bot<span class="main">⟧</span> <span class="main">⟹</span> Im1 <span class="free">l</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> tendsto_upperbound <span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_Im1<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Quaternions-Im2_tendsto_upperbound"><span class="command">lemma</span></span> Im2_tendsto_upperbound<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">l</span><span class="main">)</span> <span class="free">net</span><span class="main">;</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">net</span><span class="main">.</span> Im2 <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span><span class="main">;</span> <span class="free">net</span> <span class="main">≠</span> bot<span class="main">⟧</span> <span class="main">⟹</span> Im2 <span class="free">l</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> tendsto_upperbound <span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_Im2<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Quaternions-Im3_tendsto_upperbound"><span class="command">lemma</span></span> Im3_tendsto_upperbound<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">l</span><span class="main">)</span> <span class="free">net</span><span class="main">;</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">net</span><span class="main">.</span> Im3 <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">b</span><span class="main">;</span> <span class="free">net</span> <span class="main">≠</span> bot<span class="main">⟧</span> <span class="main">⟹</span> Im3 <span class="free">l</span> <span class="main">≤</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> tendsto_upperbound <span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_Im3<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Quaternions-Re_tendsto_lowerbound"><span class="command">lemma</span></span> Re_tendsto_lowerbound<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">l</span><span class="main">)</span> <span class="free">net</span><span class="main">;</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">net</span><span class="main">.</span> <span class="free">b</span> <span class="main">≤</span> quat.Re <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">;</span> <span class="free">net</span> <span class="main">≠</span> bot<span class="main">⟧</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">≤</span> Re <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> tendsto_lowerbound <span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_Re<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Quaternions-Im1_tendsto_lowerbound"><span class="command">lemma</span></span> Im1_tendsto_lowerbound<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">l</span><span class="main">)</span> <span class="free">net</span><span class="main">;</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">net</span><span class="main">.</span> <span class="free">b</span> <span class="main">≤</span> Im1 <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">;</span> <span class="free">net</span> <span class="main">≠</span> bot<span class="main">⟧</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">≤</span> Im1 <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> tendsto_lowerbound <span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_Im1<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Quaternions-Im2_tendsto_lowerbound"><span class="command">lemma</span></span> Im2_tendsto_lowerbound<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">l</span><span class="main">)</span> <span class="free">net</span><span class="main">;</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">net</span><span class="main">.</span> <span class="free">b</span> <span class="main">≤</span> Im2 <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">;</span> <span class="free">net</span> <span class="main">≠</span> bot<span class="main">⟧</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">≤</span> Im2 <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> tendsto_lowerbound <span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_Im2<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Quaternions-Im3_tendsto_lowerbound"><span class="command">lemma</span></span> Im3_tendsto_lowerbound<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">f</span> <span class="main">⤏</span> <span class="free">l</span><span class="main">)</span> <span class="free">net</span><span class="main">;</span> <span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">net</span><span class="main">.</span> <span class="free">b</span> <span class="main">≤</span> Im3 <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">;</span> <span class="free">net</span> <span class="main">≠</span> bot<span class="main">⟧</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">≤</span> Im3 <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> tendsto_lowerbound <span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_Im3<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Quaternions-of_real_continuous_iff"><span class="command">lemma</span></span> of_real_continuous_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous <span class="free">net</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> quat_of_real<span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> continuous <span class="free">net</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> continuous_def tendsto_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-of_real_continuous_on_iff"><span class="command">lemma</span></span> of_real_continuous_on_iff<span class="main">:</span>
   <span class="quoted"><span class="quoted">"continuous_on <span class="free">S</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> quat_of_real<span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> continuous_on <span class="free">S</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> continuous_on_Re continuous_on_of_real <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Quaternions for describing 3D isometries›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹The <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>HIm›</span></span></span></span> operator›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">HIm</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"quat <span class="main">⇒</span> real<span class="main">^</span><span class="numeral">3</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">HIm</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">≡</span> vector<span class="main">[</span>Im1 <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">,</span> Im2 <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">,</span> Im3 <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1" id="Quaternions-HIm_Quat"><span class="command">lemma</span></span> HIm_Quat<span class="main">:</span> <span class="quoted"><span class="quoted">"HIm <span class="main">(</span>Quat <span class="free">w</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> vector<span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HIm_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-him_eq"><span class="command">lemma</span></span> him_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"HIm <span class="free">p</span> <span class="main">=</span> HIm <span class="free">q</span> <span class="main">⟷</span> Im1 <span class="free">p</span> <span class="main">=</span> Im1 <span class="free">q</span> <span class="main">∧</span> Im2 <span class="free">p</span> <span class="main">=</span> Im2 <span class="free">q</span> <span class="main">∧</span> Im3 <span class="free">p</span> <span class="main">=</span> Im3 <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HIm_def vector_3<span class="main">)</span>

<span class="keyword1" id="Quaternions-him_of_real"><span class="command">lemma</span></span> him_of_real <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"HIm<span class="main">(</span>of_real <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_real_eq_Quat HIm_Quat vec_eq_iff vector_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-him_0"><span class="command">lemma</span></span> him_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"HIm <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> him_of_real of_real_0<span class="main">)</span>

<span class="keyword1" id="Quaternions-him_1"><span class="command">lemma</span></span> him_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"HIm <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> him_of_real of_real_1<span class="main">)</span>

<span class="keyword1" id="Quaternions-him_cnj"><span class="command">lemma</span></span> him_cnj<span class="main">:</span> <span class="quoted"><span class="quoted">"HIm<span class="main">(</span>cnj <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> HIm <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HIm_def vec_eq_iff vector_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-him_mult_left"><span class="command">lemma</span></span> him_mult_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"HIm<span class="main">(</span>of_real <span class="free">a</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> HIm <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HIm_def vec_eq_iff vector_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-him_mult_right"><span class="command">lemma</span></span> him_mult_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"HIm<span class="main">(</span><span class="free">q</span> <span class="main">*</span> of_real <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> HIm <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HIm_def vec_eq_iff vector_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-him_add"><span class="command">lemma</span></span> him_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"HIm<span class="main">(</span><span class="free">p</span> <span class="main">+</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> HIm <span class="free">p</span> <span class="main">+</span> HIm <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HIm_def vec_eq_iff vector_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-him_minus"><span class="command">lemma</span></span> him_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"HIm<span class="main">(</span><span class="main">-</span><span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> HIm <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HIm_def vec_eq_iff vector_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-him_diff"><span class="command">lemma</span></span> him_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"HIm<span class="main">(</span><span class="free">p</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> HIm <span class="free">p</span> <span class="main">-</span> HIm <span class="free">q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HIm_def vec_eq_iff vector_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-him_sum"><span class="command">lemma</span></span> him_sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"HIm <span class="main">(</span>sum <span class="free">f</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> HIm <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Quaternions-linear_him"><span class="command">lemma</span></span> linear_him<span class="main">:</span> <span class="quoted"><span class="quoted">"linear HIm"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> him_add him_mult_right linearI mult.right_neutral mult_scaleR_right of_real_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹The <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Hv›</span></span></span></span> operator›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Hv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real<span class="main">^</span><span class="numeral">3</span> <span class="main">⇒</span> quat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Hv</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> Quat <span class="main">0</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">$</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">$</span><span class="numeral">3</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Quaternions-Re_Hv"><span class="command">lemma</span></span> Re_Hv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span>Hv <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hv_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-Im1_Hv"><span class="command">lemma</span></span> Im1_Hv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Im1<span class="main">(</span>Hv <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span><span class="main">$</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hv_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-Im2_Hv"><span class="command">lemma</span></span> Im2_Hv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Im2<span class="main">(</span>Hv <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span><span class="main">$</span><span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hv_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-Im3_Hv"><span class="command">lemma</span></span> Im3_Hv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Im3<span class="main">(</span>Hv <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span><span class="main">$</span><span class="numeral">3</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hv_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-hv_vec"><span class="command">lemma</span></span> hv_vec<span class="main">:</span> <span class="quoted"><span class="quoted">"Hv<span class="main">(</span>vec <span class="free">r</span><span class="main">)</span> <span class="main">=</span> Quat <span class="main">0</span> <span class="free">r</span> <span class="free">r</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hv_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-hv_eq_zero"><span class="command">lemma</span></span> hv_eq_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Hv <span class="free">v</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff vec_eq_iff<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> exhaust_3<span class="main">)</span>

<span class="keyword1" id="Quaternions-hv_zero"><span class="command">lemma</span></span> hv_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Hv <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Quaternions-hv_vector"><span class="command">lemma</span></span> hv_vector <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Hv<span class="main">(</span>vector<span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">z</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> Quat <span class="main">0</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hv_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-hv_basis"><span class="command">lemma</span></span> hv_basis<span class="main">:</span> <span class="quoted"><span class="quoted">"Hv<span class="main">(</span>axis <span class="main">1</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗂</span>"</span></span> <span class="quoted"><span class="quoted">"Hv<span class="main">(</span>axis <span class="numeral">2</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗃</span>"</span></span> <span class="quoted"><span class="quoted">"Hv<span class="main">(</span>axis <span class="numeral">3</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗄</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Hv_def axis_def quat_ii.code quat_jj.code quat_kk.code<span class="main">)</span>

<span class="keyword1" id="Quaternions-hv_add"><span class="command">lemma</span></span> hv_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Hv<span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> Hv <span class="free">x</span> <span class="main">+</span> Hv <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hv_def quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-hv_minus"><span class="command">lemma</span></span> hv_minus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Hv<span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>Hv <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hv_def quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-hv_diff"><span class="command">lemma</span></span> hv_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Hv<span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> Hv <span class="free">x</span> <span class="main">-</span> Hv <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hv_def quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-hv_cmult"><span class="command">lemma</span></span> hv_cmult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Hv<span class="main">(</span><span class="free">a</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> of_real <span class="free">a</span> <span class="main">*</span> Hv <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hv_def quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-hv_sum"><span class="command">lemma</span></span> hv_sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Hv <span class="main">(</span>sum <span class="free">f</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> Hv <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">S</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Quaternions-hv_inj"><span class="command">lemma</span></span> hv_inj<span class="main">:</span> <span class="quoted"><span class="quoted">"Hv <span class="free">x</span> <span class="main">=</span> Hv <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hv_def quat_eq_iff vec_eq_iff<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> exhaust_3<span class="main">)</span>

<span class="keyword1" id="Quaternions-linear_hv"><span class="command">lemma</span></span> linear_hv<span class="main">:</span> <span class="quoted"><span class="quoted">"linear Hv"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_real_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-him_hv"><span class="command">lemma</span></span> him_hv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"HIm<span class="main">(</span>Hv <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> HIm_def hv_inj quat_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Quaternions-cnj_hv"><span class="command">lemma</span></span> cnj_hv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cnj<span class="main">(</span>Hv <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>Hv <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Hv_def cnj.code hv_minus <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Quaternions-hv_him"><span class="command">lemma</span></span> hv_him<span class="main">:</span> <span class="quoted"><span class="quoted">"Hv<span class="main">(</span>HIm <span class="free">q</span><span class="main">)</span> <span class="main">=</span> Quat <span class="main">0</span> <span class="main">(</span>Im1 <span class="free">q</span><span class="main">)</span> <span class="main">(</span>Im2 <span class="free">q</span><span class="main">)</span> <span class="main">(</span>Im3 <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HIm_def<span class="main">)</span>

<span class="keyword1" id="Quaternions-hv_him_eq"><span class="command">lemma</span></span> hv_him_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"Hv<span class="main">(</span>HIm <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">q</span> <span class="main">⟷</span> Re <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hv_him quat_eq_iff<span class="main">)</span>

<span class="keyword1" id="Quaternions-dot_hv"><span class="command">lemma</span></span> dot_hv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Hv <span class="free">u</span> <span class="main">∙</span> Hv <span class="free">v</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∙</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hv_def inner_quat_def inner_vec_def sum_3<span class="main">)</span>

<span class="keyword1" id="Quaternions-norm_hv"><span class="command">lemma</span></span> norm_hv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>Hv <span class="free">v</span><span class="main">)</span> <span class="main">=</span> norm <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_eq<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Geometric interpretation of the product of imaginary quaternions›</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> cross3_syntax
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Quaternions-mult_hv_eq_cross_dot"><span class="command">lemma</span></span> mult_hv_eq_cross_dot<span class="main">:</span> <span class="quoted"><span class="quoted">"Hv <span class="free">x</span> <span class="main">*</span> Hv <span class="free">y</span> <span class="main">=</span> Hv<span class="main">(</span><span class="free">x</span> <span class="main">×</span> <span class="free">y</span><span class="main">)</span> <span class="main">-</span> of_real <span class="main">(</span><span class="free">x</span> <span class="main">∙</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quat_eq_iff cross3_simps<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Representing orthogonal transformations as conjugation or congruence with a quaternion›</span></span>

<span class="keyword1" id="Quaternions-orthogonal_transformation_quat_congruence"><span class="command">lemma</span></span> orthogonal_transformation_quat_congruence<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"orthogonal_transformation <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> HIm<span class="main">(</span>cnj <span class="free">q</span> <span class="main">*</span> Hv <span class="bound">x</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> nq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>quat.Re <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im1 <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im2 <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im3 <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms norm_quat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Vector_Spaces.linear <span class="keyword1">(*<span class="hidden">⇩</span><sub>R</sub>)</span> <span class="keyword1">(*<span class="hidden">⇩</span><sub>R</sub>)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> HIm <span class="main">(</span>cnj <span class="free">q</span> <span class="main">*</span> Hv <span class="bound">x</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">b</span><span class="main">.</span> HIm <span class="main">(</span>cnj <span class="free">q</span> <span class="main">*</span> Hv <span class="main">(</span><span class="bound">r</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">b</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="bound">r</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> HIm <span class="main">(</span>cnj <span class="free">q</span> <span class="main">*</span> Hv <span class="bound">b</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> him_mult_left hv_cmult mult_scaleR_left mult_scaleR_right scaleR_conv_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left distrib_right<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"HIm <span class="main">(</span>cnj <span class="free">q</span> <span class="main">*</span> Hv <span class="skolem">v</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">∙</span> HIm <span class="main">(</span>cnj <span class="free">q</span> <span class="main">*</span> Hv <span class="skolem">w</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>quat.Re <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im1 <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im2 <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im3 <span class="free">q</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">∙</span> <span class="skolem">w</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span> <span class="skolem">w</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HIm_def inner_vec_def sum_3 power2_eq_square <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span> <span class="comment1">(*SLOW, like 15s*)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> orthogonal_transformation_def linear_def nq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Quaternions-orthogonal_transformation_quat_conjugation"><span class="command">lemma</span></span> orthogonal_transformation_quat_conjugation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"orthogonal_transformation <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> HIm<span class="main">(</span>inverse <span class="free">q</span> <span class="main">*</span> Hv <span class="bound">x</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> of_real <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="skolem">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> quat_of_real <span class="main">(</span>norm <span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>inverse <span class="main">(</span>of_real <span class="main">(</span>norm <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms mult.assoc mult.left_neutral norm_eq_zero of_real_eq_0_iff right_inverse<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>inverse <span class="main">(</span>quat_of_real <span class="main">(</span>norm <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_mult norm_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"HIm <span class="main">(</span>cnj <span class="skolem">p</span> <span class="main">*</span> Hv <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">=</span> HIm <span class="main">(</span>inverse <span class="main">(</span>quat_of_real <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">*</span> Hv <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span>quat_of_real <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inverse_mult mult.assoc <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> quat_inverse_eq_cnj <span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main">]</span></span> of_real_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> quat_of_real_times_commute quat_of_real_times_left_commute quat_of_real_inverse_collapse
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_real_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> orthogonal_transformation_quat_congruence <span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">unbundle</span></span> no_quaternion_syntax

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>