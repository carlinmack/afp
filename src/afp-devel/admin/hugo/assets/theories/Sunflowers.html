<div id="Sunflower">
<div class="head">
<h1>Theory Sunflower</h1>
</div>
<pre class="source"><span class="comment1">(* author: R. Thiemann *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Sunflowers›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sunflowers are sets of sets, such that whenever an element
  is contained in at least two of the sets, 
  then it is contained in all of the sets.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Sunflower
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
    <span class="quoted">"<a href="../../HOL/HOL-Library/FuncSet.html">HOL-Library.FuncSet</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sunflower</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sunflower</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="bound">A</span> <span class="main">≠</span> <span class="bound">B</span> <span class="main">∧</span> 
     <span class="bound">x</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">B</span><span class="main">)</span>
    <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1" id="Sunflower-sunflower_subset"><span class="command">lemma</span></span> sunflower_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">G</span> <span class="main">⟹</span> sunflower <span class="free">G</span> <span class="main">⟹</span> sunflower <span class="free">F</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> sunflower_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Sunflower-pairwise_disjnt_imp_sunflower"><span class="command">lemma</span></span> pairwise_disjnt_imp_sunflower<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"pairwise disjnt <span class="free">F</span> <span class="main">⟹</span> sunflower <span class="free">F</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> sunflower_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> disjnt_insert1 mk_disjoint_insert pairwiseD<span class="main">)</span>

<span class="keyword1" id="Sunflower-card2_sunflower"><span class="command">lemma</span></span> card2_sunflower<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sunflower <span class="free">S</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">S</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> card <span class="free">S</span> <span class="main">=</span> Suc <span class="main">0</span> <span class="main">∨</span> card <span class="free">S</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">S</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="main">∨</span> <span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">A</span><span class="main">,</span><span class="skolem">B</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> card_2_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> card_1_singleton_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sunflower_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sunflower-empty_sunflower"><span class="command">lemma</span></span> empty_sunflower<span class="main">:</span> <span class="quoted"><span class="quoted">"sunflower <span class="main">{}</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card2_sunflower<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Sunflower-singleton_sunflower"><span class="command">lemma</span></span> singleton_sunflower<span class="main">:</span> <span class="quoted"><span class="quoted">"sunflower <span class="main">{</span><span class="free">A</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card2_sunflower<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Sunflower-doubleton_sunflower"><span class="command">lemma</span></span> doubleton_sunflower<span class="main">:</span> <span class="quoted"><span class="quoted">"sunflower <span class="main">{</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card2_sunflower<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="free">B</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Sunflower-sunflower_imp_union_intersect_unique"><span class="command">lemma</span></span> sunflower_imp_union_intersect_unique<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sunflower <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span> <span class="free">S</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋂</span> <span class="free">S</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span> 
    <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> <span class="skolem">B</span>"</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="skolem">A</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">≠</span> <span class="skolem">A</span>"</span></span> 
      <span class="keyword1"><span class="command">with</span></span> A B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">A</span> <span class="main">≠</span> <span class="bound">B</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹sunflower <span class="free">S</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> sunflower_def<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> this<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">⋂</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sunflower-union_intersect_unique_imp_sunflower"><span class="command">lemma</span></span> union_intersect_unique_imp_sunflower<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span> <span class="free">S</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋂</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">A</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sunflower <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sunflower_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">C</span> <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋂</span> <span class="free">S</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> assms<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">unfolding</span></span> Uniq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sunflower-sunflower_iff_union_intersect_unique"><span class="command">lemma</span></span> sunflower_iff_union_intersect_unique<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"sunflower <span class="free">S</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">⋃</span> <span class="free">S</span> <span class="main">-</span> <span class="main">⋂</span> <span class="free">S</span><span class="main">.</span> <span class="main">∃!</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">)</span>"</span></span> 
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">from</span></span> sunflower_imp_union_intersect_unique<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">⋃</span> <span class="free">S</span> <span class="main">-</span> <span class="main">⋂</span> <span class="free">S</span><span class="main">.</span> <span class="main">∃<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">A</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> ex1_iff_ex_Uniq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> union_intersect_unique_imp_sunflower<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sunflower-sunflower_iff_intersect_Uniq"><span class="command">lemma</span></span> sunflower_iff_intersect_Uniq<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"sunflower <span class="free">S</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span>  <span class="bound">x</span> <span class="main">∈</span> <span class="main">⋂</span> <span class="free">S</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃<span class="hidden">⇩</span><sub>≤</sub><span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
  <span class="keyword1"><span class="command">from</span></span> sunflower_imp_union_intersect_unique<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ex1_iff_ex_Uniq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> DiffI UnionI Uniq_I<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> union_intersect_unique_imp_sunflower<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="var">?r</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If there exists sunflowers whenever all elements are sets of 
  the same cardinality <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, then there also exists sunflowers 
  whenever all elements are sets with cardinality at most <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Sunflower-sunflower_card_subset_lift"><span class="command">lemma</span></span> sunflower_card_subset_lift<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> sunflower<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">G</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">+</span> nat<span class="main">)</span> set set<span class="main">.</span> 
     <span class="main">(</span><span class="main">∀</span> <span class="bound">A</span> <span class="main">∈</span> <span class="bound">G</span><span class="main">.</span> finite <span class="bound">A</span> <span class="main">∧</span> card <span class="bound">A</span> <span class="main">=</span> <span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> card <span class="bound">G</span> <span class="main">&gt;</span> <span class="free">c</span> 
        <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="bound">G</span> <span class="main">∧</span> sunflower <span class="bound">S</span> <span class="main">∧</span> card <span class="bound">S</span> <span class="main">=</span> <span class="free">r</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> kF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> finite <span class="bound">A</span> <span class="main">∧</span> card <span class="bound">A</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> cardF<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">F</span> <span class="main">&gt;</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> sunflower <span class="bound">S</span> <span class="main">∧</span> card <span class="bound">S</span> <span class="main">=</span> <span class="free">r</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Suc <span class="free">c</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> cardF <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="free">F</span> <span class="main">≥</span> <span class="var">?n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">FF</span></span> <span class="keyword2"><span class="keyword">where</span></span> sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">FF</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cardF<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">FF</span> <span class="main">=</span> <span class="var">?n</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> obtain_subset_with_card_n<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?N</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="var">?n</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> cardF <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">FF</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_ge_0_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ex_bij_betw_nat_finite<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">unfolded</span> cardF<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="skolem">f</span> <span class="var">?N</span> <span class="skolem">FF</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> injf<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="var">?N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bij_betw_imp_inj_on<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> Ff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">FF</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">`</span> <span class="var">?N</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_imp_surj_on f<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span>Inl <span class="main">`</span> <span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>Inr <span class="main">`</span> <span class="main">{</span><span class="main">0</span> <span class="main">..&lt;</span> <span class="main">(</span><span class="free">k</span> <span class="main">-</span> card <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> injg<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">g</span> <span class="var">?N</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> f
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> inj_onI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> injf 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> inj_onD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> cardgN<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">g</span> <span class="main">`</span> <span class="var">?N</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">c</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_image<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="var">?N</span>"</span></span> 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">FF</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Ff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> sub <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> kF <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">g</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∧</span> finite <span class="main">(</span><span class="skolem">g</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_Un_disjoint<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> card_image<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> inj_onI<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">A</span> <span class="main">∈</span> <span class="skolem">g</span> <span class="main">`</span> <span class="var">?N</span><span class="main">.</span> finite <span class="bound">A</span> <span class="main">∧</span> card <span class="bound">A</span> <span class="main">=</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sunflower<span class="main">[</span><span class="operator">OF</span> this cardgN<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> SgN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">g</span> <span class="main">`</span> <span class="var">?N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sf<span class="main">:</span> <span class="quoted"><span class="quoted">"sunflower <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">S</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> SgN <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> NN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">⊆</span> <span class="var">?N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> SgN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">`</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subset_image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> injg NN <span class="keyword1"><span class="command">have</span></span> inj_g<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">g</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_on_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> injf NN <span class="keyword1"><span class="command">have</span></span> inj_f<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="skolem">f</span> <span class="skolem">N</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> inj_on_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> card_image<span class="main">[</span><span class="operator">OF</span> inj_g<span class="main">]</span> SgN card
  <span class="keyword1"><span class="command">have</span></span> cardN<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">N</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">`</span> <span class="skolem">N</span>"</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?S</span></span></span></span></span><span class="main"><span class="main">]</span></span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> NN <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ff sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> card_image<span class="main">[</span><span class="operator">OF</span> inj_f<span class="main">]</span> cardN <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?S</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sunflower <span class="var">?S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sunflower_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">C</span> <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">∈</span> <span class="skolem">f</span> <span class="main">`</span> <span class="skolem">N</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">f</span> <span class="main">`</span> <span class="skolem">N</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="skolem">f</span> <span class="main">`</span> <span class="skolem">N</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> gk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">k</span> <span class="main">∈</span> <span class="skolem">g</span> <span class="main">`</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">≠</span> <span class="skolem">B</span>›</span></span> A B <span class="keyword1"><span class="command">have</span></span> ij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> inj_g ij i j <span class="keyword1"><span class="command">have</span></span> gij<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">i</span> <span class="main">≠</span> <span class="skolem">g</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inj_on_contraD<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> memi<span class="main">:</span> <span class="quoted"><span class="quoted">"Inl <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">g</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">B</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> memj<span class="main">:</span> <span class="quoted"><span class="quoted">"Inl <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">g</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> B g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="skolem">g</span> <span class="main">`</span> <span class="skolem">N</span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">∈</span> <span class="skolem">g</span> <span class="main">`</span> <span class="skolem">N</span> <span class="main">∧</span> <span class="bound">A</span> <span class="main">≠</span> <span class="bound">B</span> <span class="main">∧</span> Inl <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">∧</span> Inl <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">B</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> memi memj gij i j <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> sf<span class="main">[</span><span class="operator">unfolded</span> sunflower_def SgN<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> this gk<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inl <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">g</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We provide another sunflower lifting lemma that ensures 
  non-empty cores. Here, all elements must be taken 
  from a finite set, and the bound is multiplied the cardinality.›</span></span>

<span class="keyword1" id="Sunflower-sunflower_card_core_lift"><span class="command">lemma</span></span> sunflower_card_core_lift<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> finE<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">E</span> <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> sunflower<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">G</span> <span class="main">::</span> <span class="tfree">'a</span> set set<span class="main">.</span> 
     <span class="main">(</span><span class="main">∀</span> <span class="bound">A</span> <span class="main">∈</span> <span class="bound">G</span><span class="main">.</span> finite <span class="bound">A</span> <span class="main">∧</span> card <span class="bound">A</span> <span class="main">≤</span> <span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> card <span class="bound">G</span> <span class="main">&gt;</span> <span class="free">c</span> 
        <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="bound">G</span> <span class="main">∧</span> sunflower <span class="bound">S</span> <span class="main">∧</span> card <span class="bound">S</span> <span class="main">=</span> <span class="free">r</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">≤</span> card <span class="bound">A</span> <span class="main">∧</span> card <span class="bound">A</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> cardF<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">F</span> <span class="main">&gt;</span> <span class="main">(</span>card <span class="free">E</span> <span class="keyword1">choose</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> sunflower <span class="bound">S</span> <span class="main">∧</span> card <span class="bound">S</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∧</span> card <span class="main">(</span><span class="main">⋂</span> <span class="bound">S</span><span class="main">)</span> <span class="main">≥</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="main">(</span><span class="bound">A</span> <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span> <span class="bound">x</span><span class="main">.</span> card <span class="bound">x</span> <span class="main">=</span> <span class="free">s</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">⊆</span> <span class="bound">A</span>"</span></span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?E</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">∧</span> card <span class="bound">X</span> <span class="main">=</span> <span class="free">s</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> cardF <span class="keyword1"><span class="command">have</span></span> finF<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card.infinite le_0_eq less_le<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> cardF <span class="keyword1"><span class="command">have</span></span> FnE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">from</span></span> FnE <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> F<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> B<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">A</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> obtain_subset_with_card_n order_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?E</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> EnE <span class="main">=</span> this
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">A</span><span class="main">.</span> <span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="var">?g</span> <span class="bound">A</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> finE <span class="keyword1"><span class="command">have</span></span> finiteE<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">→</span> <span class="var">?E</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> 
    <span class="keyword1"><span class="command">with</span></span> F<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> B<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="var">?g</span> <span class="skolem">B</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> obtain_subset_with_card_n<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> B F <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="var">?E</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> pigeonhole_card<span class="main">[</span><span class="operator">OF</span> this finF finiteE EnE<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="var">?E</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">F</span> <span class="main">≤</span> card <span class="main">(</span><span class="skolem">f</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">∩</span> <span class="free">F</span><span class="main">)</span> <span class="main">*</span> card <span class="var">?E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> precond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="skolem">f</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">∩</span> <span class="free">F</span><span class="main">.</span> finite <span class="bound">A</span> <span class="main">∧</span> card <span class="bound">A</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> F finite_subset<span class="main">[</span><span class="operator">OF</span> _ finE<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">*</span> <span class="main">(</span>card <span class="free">E</span> <span class="keyword1">choose</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>card <span class="free">E</span> <span class="keyword1">choose</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> card <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span>card <span class="main">(</span><span class="skolem">f</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">∩</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> card <span class="var">?E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?E</span> <span class="main">=</span> card <span class="free">E</span> <span class="keyword1">choose</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> n_subsets<span class="main"><span class="main">[</span></span><span class="operator">OF</span> finE<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&lt;</span> card <span class="main">(</span><span class="skolem">f</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">∩</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sunflower<span class="main">[</span><span class="operator">OF</span> precond this<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">f</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">∩</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"sunflower <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">S</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> _ finF<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">S</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">have</span></span> finS<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> * r <span class="keyword1"><span class="command">have</span></span> SnE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> finIS<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋂</span> <span class="skolem">S</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> finite_Inter<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> SnE <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> F s <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * precond <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A</span><span class="main">∈</span><span class="skolem">S</span><span class="main">.</span> finite <span class="bound">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">S</span></span></span></span><span class="main"><span class="main">]</span></span> conjI *<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> 
      <span class="keyword1"><span class="command">with</span></span> *<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> <span class="skolem">f</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">A</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> F<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> A<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> card <span class="bound">x</span> <span class="main">=</span> <span class="free">s</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">⊆</span> <span class="skolem">A</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> obtain_subset_with_card_n order_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="skolem">A</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> this<span class="main">]</span> **
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">⊆</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">⊆</span> <span class="main">⋂</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> card_mono<span class="main">[</span><span class="operator">OF</span> finIS this<span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">a</span> <span class="main">≤</span> card <span class="main">(</span><span class="main">⋂</span> <span class="skolem">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> card <span class="main">(</span><span class="main">⋂</span> <span class="skolem">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Sunflower-sunflower_nonempty_core_lift"><span class="command">lemma</span></span> sunflower_nonempty_core_lift<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> finE<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">E</span> <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> sunflower<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">G</span> <span class="main">::</span> <span class="tfree">'a</span> set set<span class="main">.</span> 
     <span class="main">(</span><span class="main">∀</span> <span class="bound">A</span> <span class="main">∈</span> <span class="bound">G</span><span class="main">.</span> finite <span class="bound">A</span> <span class="main">∧</span> card <span class="bound">A</span> <span class="main">≤</span> <span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> card <span class="bound">G</span> <span class="main">&gt;</span> <span class="free">c</span> 
        <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="bound">G</span> <span class="main">∧</span> sunflower <span class="bound">S</span> <span class="main">∧</span> card <span class="bound">S</span> <span class="main">=</span> <span class="free">r</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">∧</span> card <span class="bound">A</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∉</span> <span class="free">F</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> cardF<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">F</span> <span class="main">&gt;</span> card <span class="free">E</span> <span class="main">*</span> <span class="free">c</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> sunflower <span class="bound">S</span> <span class="main">∧</span> card <span class="bound">S</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∧</span> <span class="main">(</span><span class="main">⋂</span> <span class="bound">S</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> F empty <span class="keyword1"><span class="command">have</span></span> F'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">∧</span> <span class="main">1</span> <span class="main">≤</span> card <span class="bound">A</span> <span class="main">∧</span> card <span class="bound">A</span> <span class="main">≤</span> <span class="free">k</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> finE
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_leI card_gt_0_iff finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> cardF <span class="keyword1"><span class="command">have</span></span> cardF'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>card <span class="free">E</span> <span class="keyword1">choose</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">c</span> <span class="main">&lt;</span> card <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> sunflower_card_core_lift<span class="main">[</span><span class="operator">OF</span> finE sunflower<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">,</span> <span class="operator">OF</span> _ _ F' cardF' _ False<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> main<span class="main">:</span> <span class="quoted"><span class="quoted">"sunflower <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">S</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> card <span class="main">(</span><span class="main">⋂</span> <span class="skolem">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">S</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> empty_sunflower<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span> </pre>
</div><div id="Erdos_Rado_Sunflower">
<div class="head">
<h1>Theory Erdos_Rado_Sunflower</h1>
</div>
<pre class="source"><span class="comment1">(* author: R. Thiemann *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹The Sunflower Lemma›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We formalize the proof of the sunflower lemma of Erdős and Rado~\cite{erdos_rado}, 
as it is presented in the textbook~\cite[Chapter~6]{book}.  
We further integrate Exercise 6.2 from the textbook,
which provides a lower bound on the existence of sunflowers.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Erdos_Rado_Sunflower
  <span class="keyword2"><span class="keyword">imports</span></span> 
    <a href="Sunflower.html">Sunflower</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹When removing an element from all subsets, then one can afterwards
  add these elements to a sunflower and get a new sunflower.›</span></span>

<span class="keyword1" id="Erdos_Rado_Sunflower-sunflower_remove_element_lift"><span class="command">lemma</span></span> sunflower_remove_element_lift<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="main">{</span> <span class="bound">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">|</span> <span class="bound">A</span> <span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">}</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> sf<span class="main">:</span> <span class="quoted"><span class="quoted">"sunflower <span class="free">S</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">Sa</span><span class="main">.</span> sunflower <span class="bound">Sa</span> <span class="main">∧</span> <span class="bound">Sa</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> card <span class="bound">Sa</span> <span class="main">=</span> card <span class="free">S</span> <span class="main">∧</span> <span class="bound">Sa</span> <span class="main">=</span> insert <span class="free">a</span> <span class="main">`</span> <span class="free">S</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"insert <span class="free"><span class="free">a</span></span> <span class="main"><span class="main">`</span></span> <span class="free"><span class="free">S</span></span>"</span></span></span><span class="main"><span class="main">]</span></span> conjI refl<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Sa</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"insert <span class="free">a</span> <span class="main">`</span> <span class="free">S</span>"</span></span> 
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="var">?Sa</span>"</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> insert <span class="free">a</span> <span class="skolem">C</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> C S <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="skolem">T</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> <span class="skolem">T</span> <span class="main">-</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">T</span> <span class="main">∈</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> 
  <span class="keyword3"><span class="command">thus</span></span> SaF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Sa</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>insert <span class="free">a</span><span class="main">)</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> inj_on_inverseI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span> <span class="bound"><span class="bound"><span class="bound">B</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">B</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">{</span></span></span><span class="free"><span class="free"><span class="free">a</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"card <span class="var">?Sa</span> <span class="main">=</span> card <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_image<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sunflower <span class="var">?Sa</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sunflower_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span> <span class="bound">D</span><span class="main">.</span> <span class="bound">C</span> <span class="main">∈</span> <span class="var">?Sa</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">∈</span> <span class="var">?Sa</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">≠</span> <span class="bound">D</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">C</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">D</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="var">?Sa</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">∈</span> <span class="var">?Sa</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">≠</span> <span class="skolem">D</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">D</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> *<span class="main">(</span>1-2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C'</span></span> <span class="skolem"><span class="skolem">D'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D'</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> insert <span class="free">a</span> <span class="skolem">C'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> insert <span class="free">a</span> <span class="skolem">D'</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">≠</span> <span class="skolem">D</span>›</span></span> inj <span class="keyword1"><span class="command">have</span></span> CD'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main">≠</span> <span class="skolem">D'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">E</span><span class="main">.</span> <span class="bound">E</span> <span class="main">∈</span> <span class="var">?Sa</span> <span class="main">⟶</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">E</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">a</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> * ** <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">C'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">D'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> ** CD' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span> <span class="bound">D</span><span class="main">.</span> <span class="bound">C</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">D</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">C</span> <span class="main">≠</span> <span class="bound">D</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">C</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">D</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> sf<span class="main">[</span><span class="operator">unfolded</span> sunflower_def<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> this<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The sunflower-lemma of Erdős and Rado: 
  if a set has a certain size and all elements
  have the same cardinality, then a sunflower exists.›</span></span>

<span class="keyword1" id="Erdos_Rado_Sunflower-Erdos_Rado_sunflower_same_card"><span class="command">lemma</span></span> Erdos_Rado_sunflower_same_card<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> finite <span class="bound">A</span> <span class="main">∧</span> card <span class="bound">A</span> <span class="main">=</span> <span class="free">k</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">F</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> fact <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> sunflower <span class="bound">S</span> <span class="main">∧</span> card <span class="bound">S</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">∉</span> <span class="bound">S</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">F</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">∨</span> <span class="skolem">F</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">F</span> <span class="main">≥</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">pd_sub</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set <span class="main">⇒</span> nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="skolem">pd_sub</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">G</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">G</span> <span class="main">⊆</span> <span class="skolem">F</span> <span class="main">∧</span> card <span class="bound">G</span> <span class="main">=</span> <span class="bound">t</span> <span class="main">∧</span> pairwise disjnt <span class="bound">G</span> <span class="main">∧</span> <span class="main">{}</span> <span class="main">∉</span> <span class="bound">G</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">t</span> <span class="bound">G</span><span class="main">.</span> <span class="skolem">pd_sub</span> <span class="bound">G</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">≥</span> <span class="free">r</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> pd_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">pd_sub</span> <span class="skolem">G</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≥</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> pd_sub<span class="main">[</span><span class="operator">unfolded</span> pd_sub_def<span class="main">]</span> pairwise_disjnt_imp_sunflower
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">⊆</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">G</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"sunflower <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∉</span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> t <span class="quoted"><span class="quoted">‹card <span class="skolem">G</span> <span class="main">=</span> <span class="skolem">t</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">H</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> obtain_subset_with_card_n<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> sunflower_subset<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">H</span> <span class="main">⊆</span> <span class="skolem">G</span>›</span></span><span class="main">]</span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">t</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">G</span><span class="main">.</span> <span class="skolem">pd_sub</span> <span class="bound">G</span> <span class="bound">t</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">t</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pd_sub_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> large'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">t</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">unfolding</span></span> P_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> large<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">t</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">t</span> <span class="main">⟹</span> <span class="bound">t</span> <span class="main">≤</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">GREATEST</span> <span class="bound">t</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> GreatestI_ex_nat<span class="main">[</span><span class="operator">OF</span> ex large<span class="main">,</span> <span class="operator">folded</span> t_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> Pt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> Greatest_le_nat<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">P</span></span><span class="main">,</span> <span class="operator">OF</span> _ large<span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> greatest<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> t_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> large'<span class="main">[</span><span class="operator">OF</span> Pt<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> tr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≤</span> <span class="free">r</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Pt<span class="main">[</span><span class="operator">unfolded</span> P_def pd_sub_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      cardG<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">G</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      disj<span class="main">:</span> <span class="quoted"><span class="quoted">"pairwise disjnt <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      GF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">⊆</span> <span class="skolem">F</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">F</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_ge_0_finite<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> GF <span class="quoted"><span class="quoted">‹finite <span class="skolem">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> finG<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">⋃</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">≤</span> sum card <span class="skolem">G</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_Union_le_sum_card<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> Suc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> GF<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> of_nat <span class="main">(</span>card <span class="skolem">G</span><span class="main">)</span> <span class="main">*</span> Suc <span class="skolem">k</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_bounded_above<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> GF Suc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> Suc <span class="skolem">k</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> tr<span class="main">[</span><span class="operator">folded</span> cardG<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> id_apply mult_le_mono1 of_nat_eq_id<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> cardA<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">A</span> <span class="main">≤</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> Suc <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> nE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> eF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∉</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∩</span> <span class="skolem">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> dis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∩</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">"pairwise disjnt <span class="main">(</span><span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> disj <span class="keyword1"><span class="command">unfolding</span></span> A_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_SIG<span class="main"><span class="main">)</span></span> Int_commute Un_iff 
              Union_disjoint disjnt_def pairwise_def singleton_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> nE dis <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∉</span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> finG <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">{</span><span class="skolem">B</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> Suc <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cardG<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span>Suc <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> P_def pd_sub_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">B</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span> <span class="main"><span class="main"><span class="main">∪</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">G</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> eF disj c * GF<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> greatest <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> overlap <span class="main">=</span> this
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>2-<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> overlap <span class="keyword1"><span class="command">have</span></span> Ane<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">using</span></span> finG Suc<span class="main">(</span>2-<span class="main">)</span> GF <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">B</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">B</span> <span class="main">∩</span> <span class="skolem">A</span>"</span></span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">B</span><span class="main">.</span> <span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="var">?g</span> <span class="bound">B</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">→</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span> 
      <span class="keyword1"><span class="command">from</span></span> overlap<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="var">?g</span> <span class="skolem">B</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> A_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> pigeonhole_card<span class="main">[</span><span class="operator">OF</span> this <span class="quoted"><span class="quoted">‹finite <span class="skolem">F</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">A</span>›</span></span> Ane<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> le<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">F</span> <span class="main">≤</span> card <span class="main">(</span><span class="skolem">f</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">∩</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">*</span> card <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">S</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> someI_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="skolem">S</span>"</span></span><span class="main">]</span> a overlap<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> FaS <span class="main">=</span> this
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">|</span> <span class="bound">S</span> <span class="main">.</span> <span class="bound">S</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="bound">S</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> cardA <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">*</span> fact <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> card <span class="skolem">A</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">*</span> fact <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> fact <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> fact_Suc mult.assoc mult.commute of_nat_id power_Suc2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> card <span class="main">(</span><span class="skolem">f</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">∩</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">*</span> card <span class="skolem">A</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>3<span class="main">)</span> le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">∩</span> <span class="skolem">F</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">S</span></span> <span class="main">∈</span> <span class="skolem">F</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">S</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">…</span> <span class="main">=</span> card <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">S</span></span> <span class="main">∈</span> <span class="skolem">F</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">S</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_image<span class="main"><span class="keyword3">;</span></span> <span class="operator">intro</span> inj_onI refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> FaS<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">S</span></span> <span class="main">∈</span> <span class="skolem">F</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">S</span> <span class="main">∈</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">}</span> <span class="main">=</span> <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">*</span> fact <span class="skolem">k</span> <span class="main">&lt;</span> card <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">A</span> <span class="main">∈</span> <span class="var">?F</span><span class="main">.</span> finite <span class="bound">A</span> <span class="main">∧</span> card <span class="bound">A</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>2<span class="main">)</span> FaS <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this lt<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">S</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"sunflower <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">S</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="var">?F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="var">?F</span>›</span></span> FaS <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">|</span><span class="bound">A</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="bound">A</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> sunflower_remove_element_lift<span class="main">[</span><span class="operator">OF</span> this <span class="quoted"><span class="quoted">‹sunflower <span class="skolem">S</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹card <span class="skolem">S</span> <span class="main">=</span> <span class="free">r</span>›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Using <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] sunflower_card_subset_lift<span class="antiquote"><span class="antiquote">}</span></span></span></span> we can easily 
  replace the condition that the cardinality is exactly <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  by the requirement that the cardinality is at most <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
  However, then <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">{}</span></span> <span class="main"><span class="main">∉</span></span> <span class="free"><span class="free">S</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> cannot be ensured.
  Consider <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">r</span></span> <span class="main"><span class="main">::</span></span> nat<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">1</span></span> <span class="main"><span class="main">∧</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">k</span></span> <span class="main"><span class="main">::</span></span> nat<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">&gt;</span></span> <span class="main"><span class="main">0</span></span> <span class="main"><span class="main">∧</span></span> <span class="free"><span class="free">F</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">{</span></span><span class="main"><span class="main">{}</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Erdos_Rado_Sunflower-Erdos_Rado_sunflower"><span class="command">lemma</span></span> Erdos_Rado_sunflower<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> finite <span class="bound">A</span> <span class="main">∧</span> card <span class="bound">A</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">F</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> fact <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> sunflower <span class="bound">S</span> <span class="main">∧</span> card <span class="bound">S</span> <span class="main">=</span> <span class="free">r</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sunflower_card_subset_lift<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ assms<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
      <span class="operator">metis</span> Erdos_Rado_sunflower_same_card<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We further provide a lower bound on the existence of sunflowers, 
i.e., Exercise 6.2 of the textbook~\cite{book}.
To be more precise, we prove that there is a set of sets of cardinality 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="free"><span class="free">r</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span> <span class="main"><span class="main">::</span></span> nat<span class="main"><span class="main">)</span></span><span class="main"><span class="main">^</span></span><span class="free"><span class="free">k</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, where each element is a set of cardinality 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, such that there is no subset which is a sunflower with cardinality
of at least <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1" id="Erdos_Rado_Sunflower-sunflower_lower_bound"><span class="command">lemma</span></span> sunflower_lower_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inf<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> rk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">F</span><span class="main">.</span> 
    card <span class="bound">F</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">∧</span> finite <span class="bound">F</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∀</span> <span class="bound">A</span> <span class="main">∈</span> <span class="bound">F</span><span class="main">.</span> finite <span class="main">(</span><span class="bound">A</span> <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span> <span class="main">∧</span> card <span class="bound">A</span> <span class="main">=</span> <span class="free">k</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">∄</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="bound">F</span> <span class="main">∧</span> sunflower <span class="bound">S</span> <span class="main">∧</span> card <span class="bound">S</span> <span class="main">≥</span> <span class="free">r</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="main">1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">with</span></span> r <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">have</span></span> id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">S</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∨</span> <span class="skolem">S</span> <span class="main">=</span> <span class="main">{</span><span class="main">{}</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> r
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span><span class="main"><span class="main"><span class="main">{}</span></span></span><span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> id<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      cardF<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">F</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      AF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">A</span><span class="main">.</span> <span class="main">(</span><span class="bound">A</span> <span class="main">::</span> <span class="tfree">'a</span> set<span class="main">)</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">⟹</span> finite <span class="bound">A</span> <span class="main">∧</span> card <span class="bound">A</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      sf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">S</span></span><span class="main">⊆</span><span class="skolem">F</span><span class="main">.</span> sunflower <span class="bound">S</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">≤</span> card <span class="bound">S</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹main idea: get <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">k</span></span><span class="main"><span class="main">-</span></span><span class="main"><span class="main">1</span></span> <span class="main"><span class="main">::</span></span> nat"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> fresh elements 
      and add one of these to all elements of F›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">⋃</span> <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fin AF <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>UNIV <span class="main">-</span> <span class="main">⋃</span> <span class="skolem">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> infinite_arbitrarily_large<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">New</span></span> <span class="keyword2"><span class="keyword">where</span></span> New<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">New</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">New</span> <span class="main">=</span> <span class="free">r</span> <span class="main">-</span> <span class="main">1</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="skolem">New</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="skolem">F</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span><span class="main">.</span> insert <span class="bound">a</span> <span class="bound">A</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span><span class="skolem">F</span> <span class="main">×</span> <span class="skolem">New</span><span class="main">)</span>"</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">G</span></span></span></span><span class="main"><span class="main">]</span></span> conjI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> New fin <span class="keyword1"><span class="command">unfolding</span></span> G_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">G</span> <span class="main">=</span> card <span class="main">(</span><span class="skolem">F</span> <span class="main">×</span> <span class="skolem">New</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">subst</span> card_image<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">intro</span> refl<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> inj_onI<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">A</span> <span class="skolem">a</span> <span class="skolem">B</span> <span class="skolem">b</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> New <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">a</span> <span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">=</span> insert <span class="skolem">b</span> <span class="skolem">B</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">a</span> <span class="skolem">A</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> New 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">b</span> <span class="skolem">B</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> New 1 ab<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="skolem">F</span> <span class="main">*</span> card <span class="skolem">New</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> New fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">G</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> Suc <span class="skolem">k</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> cardF New <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">New</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> insert <span class="skolem">a</span> <span class="skolem">A</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> G_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> AF<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span> New <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">B</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> card_insert_if<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">∈</span><span class="skolem">G</span><span class="main">.</span> finite <span class="bound">A</span> <span class="main">∧</span> card <span class="bound">A</span> <span class="main">=</span> Suc <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">S</span></span><span class="main">⊆</span><span class="skolem">G</span><span class="main">.</span> sunflower <span class="bound">S</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">≤</span> card <span class="bound">S</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE conjE<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span>
        <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">G</span>"</span></span> <span class="quoted"><span class="quoted">"sunflower <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> card <span class="skolem">S</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">B</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="skolem">New</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∈</span> <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">B</span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> 
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="skolem">New</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∈</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">folded</span> g_def<span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">New</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> gB <span class="main">=</span> this
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">g</span> <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">≤</span> card <span class="skolem">New</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> card_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> New gB<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> New <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> card <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">g</span> <span class="main">`</span> <span class="skolem">S</span><span class="main">)</span> <span class="main">&lt;</span> card <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">from</span></span> pigeonhole<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> inj_on <span class="skolem">g</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B1</span></span> <span class="skolem"><span class="skolem">B2</span></span> <span class="keyword2"><span class="keyword">where</span></span> B12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B1</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B2</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B1</span> <span class="main">≠</span> <span class="skolem">B2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">B1</span> <span class="main">=</span> <span class="skolem">g</span> <span class="skolem">B2</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">g</span> <span class="skolem">B2</span>"</span></span> 
        <span class="keyword1"><span class="command">from</span></span> B12 gB<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">B1</span></span></span></span><span class="main">]</span> gB<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">B2</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">New</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">B1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">B2</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> a_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
        <span class="keyword1"><span class="command">with</span></span> B12 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">B1</span> <span class="bound">B2</span><span class="main">.</span> <span class="bound">B1</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∧</span> <span class="bound">B2</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∧</span> <span class="bound">B1</span> <span class="main">≠</span> <span class="bound">B2</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="bound">B1</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="bound">B2</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> a_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹sunflower <span class="skolem">S</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> sunflower_def<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> this<span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> aS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">⟹</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">B</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">B</span> <span class="main">=</span> <span class="skolem">B</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">B</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">=</span> <span class="skolem">h</span> <span class="main">`</span> <span class="skolem">S</span>"</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">S</span></span><span class="main">⊆</span><span class="skolem">F</span><span class="main">.</span> sunflower <span class="bound">S</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">≤</span> card <span class="bound">S</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">T</span></span></span></span><span class="main"><span class="main">]</span></span> conjI<span class="main">)</span>
          <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">B</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> 
            <span class="keyword1"><span class="command">have</span></span> hB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">B</span> <span class="main">=</span> <span class="skolem">B</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span>"</span></span> 
              <span class="keyword1"><span class="command">unfolding</span></span> h_def T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> aS <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> aB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">S</span> <span class="main">⊆</span> <span class="skolem">G</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> AF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span> 
              <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> insert <span class="skolem">a'</span> <span class="skolem">A</span>"</span></span> 
              <span class="keyword2"><span class="keyword">and</span></span> a'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> <span class="skolem">New</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> G_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            <span class="keyword1"><span class="command">from</span></span> aB B a' New AF a<span class="main">(</span>1<span class="main">)</span> hB AF <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">a</span> <span class="main">(</span><span class="skolem">h</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">B</span> <span class="main">=</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">a</span> <span class="main">(</span><span class="skolem">h</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">a</span> <span class="main">(</span><span class="skolem">h</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> AF <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">∈</span> <span class="skolem">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> main <span class="main">=</span> this
          <span class="keyword1"><span class="command">have</span></span> CTS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> <span class="skolem">T</span> <span class="main">⟹</span> insert <span class="skolem">a</span> <span class="skolem">C</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">C</span> <span class="keyword1"><span class="command">using</span></span> main <span class="keyword1"><span class="command">unfolding</span></span> T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">T</span> <span class="main">⊆</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> T_def <span class="keyword1"><span class="command">using</span></span> main <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> card <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> card <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> T_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> card_image<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> inj_on_inverseI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"insert <span class="skolem"><span class="skolem"><span class="skolem">a</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> main<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≤</span> card <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sunflower <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sunflower_def
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">C</span> <span class="skolem">C1</span> <span class="skolem">C2</span><span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> CTS<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">C1</span> <span class="main">∈</span> <span class="skolem">T</span>›</span></span><span class="main">]</span> CTS<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">C2</span> <span class="main">∈</span> <span class="skolem">T</span>›</span></span><span class="main">]</span> CTS<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">∈</span> <span class="skolem">T</span>›</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">a</span> <span class="skolem">C1</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">a</span> <span class="skolem">C2</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">a</span> <span class="skolem">C</span> <span class="main">∈</span> <span class="skolem">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>          
            <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert <span class="skolem">a</span> <span class="skolem">C1</span> <span class="main">≠</span> insert <span class="skolem">a</span> <span class="skolem">C2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> main
              <span class="keyword1"><span class="command">unfolding</span></span> T_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">A</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∧</span> <span class="bound">B</span> <span class="main">∈</span> <span class="skolem">S</span> <span class="main">∧</span> <span class="bound">A</span> <span class="main">≠</span> <span class="bound">B</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">B</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> * 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>          
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹sunflower <span class="skolem">S</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> sunflower_def<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> this *<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> insert <span class="skolem">a</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> T_def h_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">with</span></span> sf
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> r<span class="main">:</span> True
  <span class="keyword1"><span class="command">with</span></span> rk <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> Suc <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> r k
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{}</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The difference between the lower and the
upper bound on the existence of sunflowers as they have been formalized
is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">‹fact <span class="free"><span class="free">k</span></span>›</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. There is more recent work with tighter bounds
\cite{sunflower_new}, but we only integrate the initial 
result of Erdős and Rado in this theory.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We further provide the Erdős Rado lemma 
  lifted to obtain non-empty cores or cores of arbitrary cardinality.›</span></span>

<span class="keyword1" id="Erdos_Rado_Sunflower-Erdos_Rado_sunflower_card_core"><span class="command">lemma</span></span> Erdos_Rado_sunflower_card_core<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">E</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">≤</span> card <span class="bound">A</span> <span class="main">∧</span> card <span class="bound">A</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">F</span> <span class="main">&gt;</span> <span class="main">(</span>card <span class="free">E</span> <span class="keyword1">choose</span> <span class="free">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> fact <span class="free">k</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> sunflower <span class="bound">S</span> <span class="main">∧</span> card <span class="bound">S</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∧</span> card <span class="main">(</span><span class="main">⋂</span> <span class="bound">S</span><span class="main">)</span> <span class="main">≥</span> <span class="free">s</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sunflower_card_core_lift<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> _ assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> _ assms<span class="main"><span class="main">(</span></span>4-5<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> 
        <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="free"><span class="free"><span class="free">r</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">^</span></span></span><span class="free"><span class="free"><span class="free">k</span></span></span> <span class="main"><span class="main"><span class="main">*</span></span></span> fact <span class="free"><span class="free"><span class="free">k</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">rule</span> Erdos_Rado_sunflower<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword1" id="Erdos_Rado_Sunflower-Erdos_Rado_sunflower_nonempty_core"><span class="command">lemma</span></span> Erdos_Rado_sunflower_nonempty_core<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">E</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">A</span> <span class="main">∈</span> <span class="free">F</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">∧</span> card <span class="bound">A</span> <span class="main">≤</span> <span class="free">k</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∉</span> <span class="free">F</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"card <span class="free">F</span> <span class="main">&gt;</span> card <span class="free">E</span> <span class="main">*</span> <span class="main">(</span><span class="free">r</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">^</span><span class="free">k</span> <span class="main">*</span> fact <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">S</span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="free">F</span> <span class="main">∧</span> sunflower <span class="bound">S</span> <span class="main">∧</span> card <span class="bound">S</span> <span class="main">=</span> <span class="free">r</span> <span class="main">∧</span> <span class="main">⋂</span> <span class="bound">S</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sunflower_nonempty_core_lift<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
      _ assms<span class="main"><span class="main">(</span></span>2-3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="free"><span class="free"><span class="free">r</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">^</span></span></span><span class="free"><span class="free"><span class="free">k</span></span></span> <span class="main"><span class="main"><span class="main">*</span></span></span> fact <span class="free"><span class="free"><span class="free">k</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">rule</span> Erdos_Rado_sunflower<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> </pre>
</div>