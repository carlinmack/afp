<div id="Graph_Lemma">
<div class="head">
<h1>Theory Graph_Lemma</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:      CoW_Graph_Lemma.Graph_Lemma
    Author:     Štěpán Holub, Charles University
    Author:     Štěpán Starosta, CTU in Prague
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Graph_Lemma
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../combinatorics_words/theories/#Submonoids">Combinatorics_Words.Submonoids</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Graph Lemma›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The Graph Lemma is an important tool for gaining information about systems of word equations. 
It yields an upper bound on the rank of the solution, that is, on the number of factors into all images of unknowns can be factorized.
The most straightforward application is showing that a system of equations admits periodic solutions only, which
in particular holds for any nontrivial equation over two words.

The name refers to a graph whose vertices are the unknowns of the system, and edges connect front letters of the left- and right-
hand sides of equations. The bound mentioned above is then the number of connected components of the graph.

We formalize the algebraic proof from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> Berstel1979<span class="antiquote"><span class="antiquote">}</span></span></span></span> ›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Let <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">C</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> be a set of generators, and $b$ its distinguished element. We define the set of all 
 products that do not start with $b$.›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">no_head</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list set <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list set"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">C</span> <span class="entity">b</span> <span class="keyword2"><span class="keyword">where</span></span>
  emp_in_no_head<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="keyword1">ε</span> <span class="main">∈</span> <span class="free">no_head</span> <span class="free">C</span> <span class="free">b</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∈</span> <span class="free">C</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∈</span> <span class="free">no_head</span> <span class="free">C</span> <span class="free">b</span>"</span></span> 
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">≠</span> <span class="keyword1">ε</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∈</span> <span class="free">no_head</span> <span class="free">C</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">C</span><span class="main">⟩</span> <span class="main">⟹</span>  <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⋅</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> <span class="free">no_head</span> <span class="free">C</span> <span class="free">b</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The set is a submonoid of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">⟨</span></span><span class="free"><span class="free">C</span></span><span class="main"><span class="main">⟩</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Graph_Lemma-no_head_sub"><span class="command">lemma</span></span> no_head_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"no_head <span class="free">C</span> <span class="free">b</span> <span class="main">⊆</span> <span class="main">⟨</span><span class="free">C</span><span class="main">⟩</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> no_head <span class="free">C</span> <span class="free">b</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">C</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> no_head.induct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> no_head <span class="free">C</span> <span class="free">b</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">⋅</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">C</span><span class="main">⟩</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hull_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1" id="Graph_Lemma-no_head_closed"><span class="command">lemma</span></span> no_head_closed<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟨</span>no_head <span class="free">C</span> <span class="free">b</span><span class="main">⟩</span> <span class="main">=</span> no_head <span class="free">C</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> equalityI<span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"no_head <span class="free">C</span> <span class="free">b</span> <span class="main">⊆</span> <span class="main">⟨</span>no_head <span class="free">C</span> <span class="free">b</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> genset_sub<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>no_head <span class="free">C</span> <span class="free">b</span><span class="main">⟩</span> <span class="main">⊆</span> no_head <span class="free">C</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⟨</span>no_head <span class="free">C</span> <span class="free">b</span><span class="main">⟩</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> no_head <span class="free">C</span> <span class="free">b</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hull.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>prod_cl <span class="skolem">w1</span> <span class="skolem">w2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="main">⋅</span> <span class="skolem">w2</span> <span class="main">∈</span> no_head <span class="free">C</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> no_head.intros<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">w1</span> <span class="main">∈</span> no_head <span class="free">C</span> <span class="free">b</span>›</span></span><span class="main">]</span>
          in_mono<span class="main">[</span><span class="operator">OF</span> no_head_sub<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">w2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We are interested mainly in the situation when <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">C</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a code.›</span></span>

<span class="keyword1"><span class="command">context</span></span> code
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We characterize the set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">no_head</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in terms of the decomposition of its (nonempty) elements: the first factor is not b›</span></span>

<span class="keyword1" id="Graph_Lemma-no_head_hd"><span class="command">lemma</span></span> no_head_hd<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> no_head <span class="free">𝒞</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> no_head.induct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">∈</span> no_head <span class="free">𝒞</span> <span class="free">b</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> code_el_dec <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">𝒞</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">𝒞</span><span class="main">⟩</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> dec_nemp no_head_sub <span class="quoted">"3.hyps"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="skolem">u</span> <span class="main">⋅</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"3.hyps"</span><span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main">]</span> hd_append2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="skolem">v</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> code_dec_morph<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹ <span class="skolem">u</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">𝒞</span><span class="main">⟩</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">𝒞</span><span class="main">⟩</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="Graph_Lemma-b_not_in_no_head"><span class="command">lemma</span></span> b_not_in_no_head<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">𝒞</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∉</span> no_head <span class="free">𝒞</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> <span class="free">𝒞</span>›</span></span> code_el_dec emp_not_in_code no_head_hd <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Graph_Lemma-hd_no_head"><span class="command">lemma</span></span> hd_no_head<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">𝒞</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> no_head <span class="free">𝒞</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dec_nemp'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">𝒞</span><span class="main">⟩</span>›</span></span><span class="main">]</span><span class="keyword1"><span class="command">.</span></span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span> <span class="main">⋅</span> concat <span class="main">(</span>tl <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> concat.simps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"tl<span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> hd_Cons_tl<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main">]</span> decI<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">𝒞</span><span class="main">⟩</span>›</span></span><span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span> <span class="main">#</span> tl <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span> <span class="main">∈</span> lists <span class="free">𝒞</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">𝒞</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">𝒞</span><span class="main">⟩</span>›</span></span> dec_dom' lists_hd <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span>tl <span class="main">(</span>decompose <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">𝒞</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> concat_tl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"tl<span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">𝒞</span></span><span class="main">,</span> <span class="operator">OF</span> <span class="quoted"><span class="quoted">‹hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span> <span class="main">#</span> tl <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span> <span class="main">∈</span> lists <span class="free">𝒞</span>›</span></span><span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span> <span class="main">∈</span> no_head <span class="free">𝒞</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_head.intros<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">𝒞</span>›</span></span> <span class="quoted"><span class="quoted">‹hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span> <span class="main">≠</span> <span class="free">b</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">𝒞</span>›</span></span> emp_not_in_code <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> no_head.intros<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this <span class="quoted"><span class="quoted">‹concat <span class="main">(</span>tl <span class="main">(</span>decompose <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">𝒞</span><span class="main">⟩</span>›</span></span> <span class="main">]</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> no_head <span class="free">𝒞</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sym<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">=</span> hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span> <span class="main">⋅</span> concat <span class="main">(</span>tl <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span>›</span></span><span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">corollary</span></span> <span class="quoted"><span class="quoted">"no_head <span class="free">𝒞</span> <span class="free">b</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">u</span></span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">𝒞</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> <span class="keyword1">ε</span> <span class="main">∨</span> hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="bound">u</span><span class="main">)</span> <span class="main">≠</span> <span class="free">b</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> equalityI subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">standard</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> no_head <span class="free">𝒞</span> <span class="free">b</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">𝒞</span><span class="main">⟩</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> <span class="keyword1">ε</span> <span class="main">∨</span> hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≠</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> no_head_hd no_head_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">u</span></span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">𝒞</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> <span class="keyword1">ε</span> <span class="main">∨</span> hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="bound">u</span><span class="main">)</span> <span class="main">≠</span> <span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> no_head <span class="free">𝒞</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hd_no_head no_head.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">no_head</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is generated by the following set.›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">no_head_gen</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list set <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list set"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">C</span> <span class="entity">b</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∈</span> <span class="free">C</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∈</span> <span class="free">no_head_gen</span> <span class="free">C</span> <span class="free">b</span>"</span></span> 
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∈</span> <span class="free">no_head_gen</span> <span class="free">C</span> <span class="free">b</span> <span class="main">⟹</span>  <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">⋅</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">no_head_gen</span> <span class="free">C</span> <span class="free">b</span>"</span></span>

<span class="keyword1" id="Graph_Lemma-no_head_gen_set"><span class="command">lemma</span></span> no_head_gen_set<span class="main">:</span> <span class="quoted"><span class="quoted">"no_head_gen <span class="free">C</span> <span class="free">b</span> <span class="main">=</span> <span class="main">{</span><span class="bound">z</span> <span class="main">⋅</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="bound">k</span> <span class="main">|</span><span class="bound">z</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≠</span> <span class="free">b</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> equalityI subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> no_head_gen <span class="free">C</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">z</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">z</span> <span class="main">⋅</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="bound">k</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> no_head_gen.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="main">=</span> <span class="bound">z</span> <span class="main">⋅</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="bound">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> pow_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> no_head_gen <span class="free">C</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="main">=</span> <span class="bound">z</span> <span class="main">⋅</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="bound">k</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="main">⋅</span> <span class="free">b</span> <span class="main">=</span> <span class="bound">z</span> <span class="main">⋅</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="bound">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pow_Suc2_list append.assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>         
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">z</span> <span class="main">⋅</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="bound">k</span> <span class="main">|</span><span class="bound">z</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≠</span> <span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">z</span> <span class="main">⋅</span> <span class="free">b</span> <span class="main"><span class="hidden">⇧</span><sup>@</sup></span> <span class="bound">k</span> <span class="main">|</span><span class="bound">z</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≠</span> <span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">z</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> no_head_gen <span class="free">C</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="free">C</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> no_head_gen.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> this<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⋅</span> <span class="free">b</span> <span class="main"><span class="hidden">⇧</span><sup>@</sup></span> <span class="skolem">k</span>"</span></span><span class="main">,</span> 
        <span class="operator">THEN</span> no_head_gen.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">unfolded</span> rassoc<span class="main">,</span> 
        <span class="operator">folded</span> pow_Suc2_list<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">z</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span>Suc <span class="skolem">k</span>›</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>      
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Graph_Lemma-no_head_genE"><span class="command">lemma</span></span> no_head_genE<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> no_head_gen <span class="free">C</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">z</span> <span class="free">k</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> no_head_gen.induct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1.prems"</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted">"1.hyps"</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span> <span class="main">⋅</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="skolem">k</span><span class="main">)</span> <span class="main">⋅</span> <span class="free">b</span> <span class="main">=</span> <span class="skolem">z</span> <span class="main">⋅</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="main">(</span>Suc <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span> <span class="skolem">k</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_commutes<span class="main">)</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2.prems"</span> <span class="quoted">"2.hyps"</span><span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">context</span></span> code
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We show that this indeed is a set of generators›</span></span>

<span class="keyword1" id="Graph_Lemma-emp_not_in_Cb"><span class="command">lemma</span></span> emp_not_in_Cb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ε</span> <span class="main">∉</span> no_head_gen <span class="free">𝒞</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emp_not_in_code no_head_gen_set<span class="main">)</span>

<span class="keyword1" id="Graph_Lemma-no_head_sub'"><span class="command">lemma</span></span> no_head_sub'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">𝒞</span> <span class="main">⟹</span> no_head_gen <span class="free">𝒞</span> <span class="free">b</span> <span class="main">⊆</span> no_head <span class="free">𝒞</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">𝒞</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> no_head_gen <span class="free">𝒞</span> <span class="free">b</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> no_head <span class="free">𝒞</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> no_head_gen.induct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> no_head_gen <span class="free">𝒞</span> <span class="free">b</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> no_head.intros<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">u</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">⋅</span> <span class="free">b</span> <span class="main">∈</span> no_head <span class="free">𝒞</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> no_head.intros<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> no_head <span class="free">𝒞</span> <span class="free">b</span>›</span></span> gen_in<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> <span class="free">𝒞</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
       <span class="quoted">"2.hyps"</span> emp_not_in_Cb <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Graph_Lemma-no_head_generates0"><span class="command">lemma</span></span> no_head_generates0<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">𝒞</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="keyword1">ε</span> <span class="main">⟶</span> <span class="free">u</span> <span class="main">∈</span> <span class="main">⟨</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">⟩</span> <span class="main">⟶</span> <span class="free">u</span> <span class="main">⋅</span> <span class="free">v</span> <span class="main">∈</span>  <span class="main">⟨</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">⟩</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hull.induct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">𝒞</span><span class="main">⟩</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">w1</span> <span class="skolem">w2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="main">=</span> <span class="free">b</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2.hyps"</span><span class="main">(</span>1<span class="main">)</span> emp_not_in_code  no_head_gen.intros<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">w1</span> <span class="main">∈</span> <span class="free">𝒞</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w1</span> <span class="main">≠</span> <span class="free">b</span>›</span></span><span class="main">,</span><span class="operator">THEN</span> gen_in<span class="main">]</span>
            <span class="quoted">"2.hyps"</span><span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">w1</span></span><span class="main">]</span> hull_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="quoted">"no_head_gen <span class="free">𝒞</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span><span class="main">⋅</span> <span class="skolem">w2</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">standard</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">⟨</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">⟩</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> dec_nemp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Dec</span> <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> dec_nemp' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> concat_butlast_last<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> u_w1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">⋅</span> <span class="skolem">w1</span> <span class="main">=</span> concat <span class="main">(</span>butlast <span class="main">(</span><span class="keyword1">Dec</span> <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span>last <span class="main">(</span><span class="keyword1">Dec</span> <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">w1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> decI<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="main">⟨</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">⟩</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> dec_dom'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="main">⟨</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">⟩</span>›</span></span><span class="main">]</span> append_butlast_last_id<span class="main">[</span><span class="operator">OF</span> dec_nemp<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> con_but<span class="main">:</span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span>butlast <span class="main">(</span><span class="keyword1">Dec</span> <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">⟨</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> last_in<span class="main">:</span> <span class="quoted"><span class="quoted">"last <span class="main">(</span><span class="keyword1">Dec</span> <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> no_head_gen <span class="free">𝒞</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> append_in_lists_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"butlast <span class="main">(</span><span class="keyword1">Dec</span> <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>last <span class="main">(</span><span class="keyword1">Dec</span> <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"no_head_gen <span class="free">𝒞</span> <span class="free">b</span>"</span></span><span class="main">]</span> 
          concat_in_hull'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"butlast <span class="main">(</span><span class="keyword1">Dec</span> <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"no_head_gen <span class="free">𝒞</span> <span class="free">b</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span><span class="keyword1">Dec</span> <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">⋅</span> <span class="skolem">w1</span> <span class="main">∈</span> no_head_gen <span class="free">𝒞</span> <span class="free">b</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w1</span> <span class="main">=</span> <span class="free">b</span>›</span></span> <span class="keyword1"><span class="command">using</span></span>  no_head_gen.intros<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"last <span class="main">(</span><span class="keyword1">Dec</span> <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">𝒞</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">THEN</span>  gen_in<span class="main">,</span><span class="operator">THEN</span><span class="main"><span class="main">[</span></span>2<span class="main"><span class="main">]</span></span> hull_closed<span class="main">,</span> <span class="operator">OF</span> con_but<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">⋅</span> <span class="skolem">w1</span> <span class="main">∈</span> <span class="main">⟨</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">⟩</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> u_w1<span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted">"2.hyps"</span><span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> _ this<span class="main">,</span> <span class="operator">unfolded</span> rassoc<span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">⋅</span> <span class="skolem">w1</span> <span class="main">⋅</span> <span class="skolem">w2</span> <span class="main">∈</span> <span class="main">⟨</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">⟩</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  pref_nemp<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">≠</span><span class="keyword1">ε</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> no_head_generates<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">𝒞</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">⟩</span> <span class="main">=</span>  no_head <span class="free">𝒞</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> equalityI<span class="main">)</span>  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">⟩</span> <span class="main">⊆</span> no_head <span class="free">𝒞</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hull_mon<span class="main">[</span><span class="operator">OF</span> no_head_sub'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> <span class="free">𝒞</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> no_head_closed<span class="keyword1"><span class="command">.</span></span>  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"no_head <span class="free">𝒞</span> <span class="free">b</span> <span class="main">⊆</span> <span class="main">⟨</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> subsetI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> no_head <span class="free">𝒞</span> <span class="free">b</span>"</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⟨</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">⟩</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> no_head.induct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> no_head <span class="free">𝒞</span> <span class="free">b</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_in no_head_gen.intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> no_head_generates0<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Moreover, the generating set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">no_head_gen</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is a code›</span></span>

<span class="keyword1" id="Graph_Lemma-lists_no_head_sub"><span class="command">lemma</span></span> lists_no_head_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">𝒞</span> <span class="main">⟹</span> <span class="free">us</span> <span class="main">∈</span> lists <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">us</span> <span class="main">∈</span> lists <span class="main">⟨</span><span class="free">𝒞</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> no_head_sub' no_head_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   

<span class="keyword1" id="Graph_Lemma-ref_hd"><span class="command">lemma</span></span> ref_hd<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">𝒞</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">𝒞</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> lists <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"refine <span class="free">𝒞</span> <span class="main">(</span><span class="main">(</span><span class="free">z</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="free">k</span><span class="main">)</span> <span class="main">#</span> <span class="free">vs</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free">z</span><span class="main">]</span><span class="main">⋅</span><span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="free">k</span> <span class="main">⋅</span> refine <span class="free">𝒞</span> <span class="free">vs</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"refine <span class="free">𝒞</span> <span class="main">(</span><span class="main">(</span><span class="free">z</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="free">k</span><span class="main">)</span> <span class="main">#</span> <span class="free">vs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="main">(</span><span class="free">z</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⋅</span> refine <span class="free">𝒞</span> <span class="free">vs</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> ref_pop_hd lists_no_head_sub<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> <span class="free">𝒞</span>›</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">z</span><span class="main">]</span><span class="main">⋅</span><span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="free">k</span> <span class="main">∈</span> lists <span class="free">𝒞</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∈</span> <span class="free">𝒞</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> <span class="free">𝒞</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"concat <span class="main">(</span><span class="main">[</span><span class="free">z</span><span class="main">]</span><span class="main">⋅</span><span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span> <span class="main">⋅</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> concat_sing_pow <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="main">(</span><span class="free">z</span><span class="main">⋅</span><span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free">z</span><span class="main">]</span><span class="main">⋅</span><span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  code.code_unique_dec<span class="main">[</span><span class="operator">OF</span> code_axioms <span class="quoted"><span class="quoted">‹<span class="main">[</span><span class="free">z</span><span class="main">]</span><span class="main">⋅</span><span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="free">k</span> <span class="main">∈</span> lists <span class="free">𝒞</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Graph_Lemma-no_head_gen_code_ind_step"><span class="command">lemma</span></span> no_head_gen_code_ind_step<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">vs</span> <span class="main">∈</span> lists <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">us</span> <span class="main">∈</span> lists <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">𝒞</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="free">ku</span> <span class="main">⋅</span> <span class="main">(</span>refine <span class="free">𝒞</span> <span class="free">us</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="free">kv</span> <span class="main">⋅</span> <span class="main">(</span>refine <span class="free">𝒞</span> <span class="free">vs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="free">ku</span> <span class="main">=</span> <span class="free">kv</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span><span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ku</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">kv</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">us</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">vs</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b</span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">kv</span> <span class="main">≤</span> <span class="skolem">ku</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">b</span><span class="main">]</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="skolem">ku</span> <span class="main">⋅</span> <span class="main">(</span>refine <span class="free">𝒞</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">b</span><span class="main">]</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="skolem">kv</span> <span class="main">⋅</span> <span class="main">(</span>refine <span class="free">𝒞</span> <span class="skolem">vs</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">∈</span> lists <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">us</span> <span class="main">∈</span> lists <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">𝒞</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"concat <span class="skolem">vs</span> <span class="main">∈</span> no_head <span class="free">𝒞</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">vs</span> <span class="main">∈</span> lists <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="skolem">b</span><span class="main">)</span>›</span></span> no_head_generates<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">𝒞</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="keyword1">Ref</span> <span class="free">𝒞</span> <span class="skolem">vs</span> <span class="main">=</span> <span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="main">(</span>concat <span class="skolem">vs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs</span> <span class="main">∈</span> lists <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="skolem">b</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">𝒞</span>›</span></span> code_unique_ref lists_no_head_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vs</span> <span class="main">≠</span> <span class="keyword1">ε</span> <span class="main">⟹</span> concat <span class="skolem">vs</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span>  emp_not_in_Cb<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> concat.simps<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs</span> <span class="main">∈</span> lists <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="skolem">b</span><span class="main">)</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> lists.simps<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">vs</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
        pref_nemp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">b</span><span class="main">]</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="main">(</span><span class="skolem">ku</span> <span class="main">-</span> <span class="skolem">kv</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span>refine <span class="free">𝒞</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span> refine <span class="free">𝒞</span> <span class="skolem">vs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">kv</span> <span class="main">≤</span> <span class="skolem">ku</span>›</span></span> eq pop_pow_cancel <span class="quoted"><span class="quoted">‹<span class="main">[</span><span class="skolem">b</span><span class="main">]</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="skolem">ku</span> <span class="main">⋅</span> <span class="main">(</span>refine <span class="free">𝒞</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">b</span><span class="main">]</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="skolem">kv</span> <span class="main">⋅</span> <span class="main">(</span>refine <span class="free">𝒞</span> <span class="skolem">vs</span><span class="main">)</span> ›</span></span><span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ku</span> <span class="main">-</span> <span class="skolem">kv</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> hd <span class="main">(</span>refine <span class="free">𝒞</span> <span class="skolem">vs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∧</span> <span class="skolem">vs</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hd_append2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">b</span><span class="main">]</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="main">(</span><span class="skolem">ku</span> <span class="main">-</span> <span class="skolem">kv</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"refine <span class="free">𝒞</span> <span class="skolem">us</span>"</span></span><span class="main">]</span>  <span class="quoted"><span class="quoted">‹<span class="main">[</span><span class="skolem">b</span><span class="main">]</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="main">(</span><span class="skolem">ku</span> <span class="main">-</span> <span class="skolem">kv</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span>refine <span class="free">𝒞</span> <span class="skolem">us</span><span class="main">)</span> <span class="main">=</span> refine <span class="free">𝒞</span> <span class="skolem">vs</span>›</span></span>
        hd_sing_power<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">ku</span> <span class="main">-</span> <span class="skolem">kv</span>"</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> 
        append_is_Nil_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">b</span><span class="main">]</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="main">(</span><span class="skolem">ku</span> <span class="main">-</span> <span class="skolem">kv</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"refine <span class="free">𝒞</span> <span class="skolem">us</span>"</span></span><span class="main">]</span>  sing_pow_empty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ku</span> <span class="main">-</span> <span class="skolem">kv</span>"</span></span><span class="main">]</span>
        dec_emp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">𝒞</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ku</span> <span class="main">=</span> <span class="skolem">kv</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">kv</span> <span class="main">≤</span> <span class="skolem">ku</span>›</span></span> no_head_hd<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹concat <span class="skolem">vs</span> <span class="main">∈</span> no_head <span class="free">𝒞</span> <span class="skolem">b</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">vs</span> <span class="main">≠</span> <span class="keyword1">ε</span> <span class="main">⟹</span> concat <span class="skolem">vs</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">Ref</span> <span class="free">𝒞</span> <span class="skolem">vs</span> <span class="main">=</span> <span class="keyword1">Dec</span> <span class="free">𝒞</span> <span class="main">(</span>concat <span class="skolem">vs</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span><span class="keyword1"><span class="command">}</span></span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">using</span></span> assms nat_le_linear<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ku</span></span> <span class="quoted"><span class="free">kv</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="Graph_Lemma-no_head_gen_code'"><span class="command">lemma</span></span> no_head_gen_code'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">𝒞</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">∈</span> lists <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span> 
   <span class="main">⟹</span> <span class="free">ys</span> <span class="main">∈</span>  lists <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> concat <span class="free">xs</span> <span class="main">=</span> concat <span class="free">ys</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emp_not_in_Cb<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emp_not_in_Cb<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">hx</span> <span class="skolem">xs</span> <span class="skolem">hy</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hx</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">∈</span> lists <span class="main">⟨</span><span class="free">𝒞</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hy</span> <span class="main">#</span> <span class="skolem">ys</span> <span class="main">∈</span> lists <span class="main">⟨</span><span class="free">𝒞</span><span class="main">⟩</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> <span class="free">𝒞</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">hx</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">∈</span> lists <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">hy</span> <span class="main">#</span> <span class="skolem">ys</span> <span class="main">∈</span> lists <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span>›</span></span> lists_no_head_sub <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"refine <span class="free">𝒞</span> <span class="main">(</span><span class="skolem">hx</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> refine <span class="free">𝒞</span>  <span class="main">(</span><span class="skolem">hy</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹concat <span class="main">(</span><span class="skolem">hx</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> concat <span class="main">(</span><span class="skolem">hy</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">hx</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">∈</span> lists <span class="main">⟨</span><span class="free">𝒞</span><span class="main">⟩</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">hy</span> <span class="main">#</span> <span class="skolem">ys</span> <span class="main">∈</span> lists <span class="main">⟨</span><span class="free">𝒞</span><span class="main">⟩</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> code_unique_ref <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hx</span> <span class="main">∈</span> <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hy</span> <span class="main">∈</span> <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">hx</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">∈</span> lists <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">hy</span> <span class="main">#</span> <span class="skolem">ys</span> <span class="main">∈</span> lists <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">zx</span></span> <span class="skolem"><span class="skolem">zy</span></span> <span class="skolem"><span class="skolem">kx</span></span> <span class="skolem"><span class="skolem">ky</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hx</span> <span class="main">=</span> <span class="skolem">zx</span> <span class="main">⋅</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="skolem">kx</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hy</span> <span class="main">=</span> <span class="skolem">zy</span> <span class="main">⋅</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="skolem">ky</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zx</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zy</span> <span class="main">≠</span> <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zx</span> <span class="main">∈</span> <span class="free">𝒞</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zy</span> <span class="main">∈</span> <span class="free">𝒞</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> no_head_genE <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">have</span></span> r1<span class="main">:</span> <span class="quoted"><span class="quoted">"refine <span class="free">𝒞</span> <span class="main">(</span><span class="skolem">hx</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">zx</span><span class="main">]</span> <span class="main">⋅</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="skolem">kx</span> <span class="main">⋅</span> refine <span class="free">𝒞</span> <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">hx</span> <span class="main">=</span> <span class="skolem">zx</span> <span class="main">⋅</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="skolem">kx</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">zx</span> <span class="main">∈</span> <span class="free">𝒞</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">zx</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> ref_hd <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> <span class="free">𝒞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> r2<span class="main">:</span> <span class="quoted"><span class="quoted">"refine <span class="free">𝒞</span> <span class="main">(</span><span class="skolem">hy</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">zy</span><span class="main">]</span> <span class="main">⋅</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="skolem">ky</span> <span class="main">⋅</span> refine <span class="free">𝒞</span> <span class="skolem">ys</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">hy</span> <span class="main">=</span> <span class="skolem">zy</span> <span class="main">⋅</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="skolem">ky</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">zy</span> <span class="main">∈</span> <span class="free">𝒞</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">zy</span> <span class="main">≠</span> <span class="free">b</span>›</span></span> ref_hd <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> <span class="free">𝒞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zx</span> <span class="main">=</span> <span class="skolem">zy</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> r1 r2 eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="skolem">kx</span> <span class="main">⋅</span> refine <span class="free">𝒞</span> <span class="skolem">xs</span> <span class="main">=</span> <span class="main">[</span><span class="free">b</span><span class="main">]</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="skolem">ky</span> <span class="main">⋅</span> refine <span class="free">𝒞</span> <span class="skolem">ys</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eq r1 r2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">kx</span> <span class="main">=</span> <span class="skolem">ky</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> no_head_gen_code_ind_step <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> <span class="free">𝒞</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">hx</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">∈</span> lists <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">hy</span> <span class="main">#</span> <span class="skolem">ys</span> <span class="main">∈</span> lists <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span>›</span></span> 
        listsE  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hx</span> <span class="main">=</span> <span class="skolem">hy</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">hx</span> <span class="main">=</span> <span class="skolem">zx</span> <span class="main">⋅</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="skolem">kx</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">hy</span> <span class="main">=</span> <span class="skolem">zy</span> <span class="main">⋅</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="skolem">ky</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">zx</span> <span class="main">=</span> <span class="skolem">zy</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"4.hyps"</span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">hx</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">∈</span> lists <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">hy</span> <span class="main">#</span> <span class="skolem">ys</span> <span class="main">∈</span> lists <span class="main">(</span>no_head_gen <span class="free">𝒞</span> <span class="free">b</span><span class="main">)</span>›</span></span> 
        <span class="quoted"><span class="quoted">‹concat <span class="main">(</span><span class="skolem">hx</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> concat <span class="main">(</span><span class="skolem">hy</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> <span class="free">𝒞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">hx</span> <span class="main">=</span> <span class="skolem">hy</span>›</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">theorem</span></span> no_head_gen_code<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"code <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"code <span class="main">{</span><span class="bound">z</span> <span class="main">⋅</span> <span class="free">b</span><span class="main"><span class="hidden">⇧</span><sup>@</sup></span><span class="bound">k</span> <span class="main">|</span> <span class="bound">z</span> <span class="bound">k</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">≠</span> <span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> code.no_head_gen_code'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹code <span class="free">C</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b</span> <span class="main">∈</span> <span class="free">C</span>›</span></span><span class="main">]</span> code.intro
  <span class="keyword1"><span class="command">unfolding</span></span> no_head_gen_set  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We are now ready to prove the Graph Lemma ›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> graph_lemma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="free">X</span> <span class="main">=</span> <span class="main">{</span>hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="main">(</span><span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="free">X</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="keyword1">ε</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="comment1">― ‹the core is to show that each element of the free basis must be a head›</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="free">X</span> <span class="main">⊆</span> <span class="main">{</span>hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="main">(</span><span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="free">X</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="keyword1">ε</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="comment1">― ‹Assume the contrary.›</span>
     <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="free">X</span> <span class="main">⊆</span> <span class="main">{</span>hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="free">X</span> <span class="bound">x</span><span class="main">)</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="keyword1">ε</span><span class="main">}</span>"</span></span>  
    <span class="comment1">― ‹And let b be the not-head›</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nohd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span>   <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="keyword1">ε</span> <span class="main">⟹</span> hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="main">(</span><span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="free">X</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">interpret</span></span> code <span class="quoted"><span class="quoted">"<span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="free">X</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> free_basis_code <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="comment1">― ‹For contradiction: We have a free hull which does not contain b but contains X.›</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Cb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"no_head_gen <span class="main">(</span><span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="free">X</span><span class="main">)</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"code <span class="var">?Cb</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="free">X</span>›</span></span> code_def no_head_gen_code' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∉</span> <span class="main">⟨</span><span class="var">?Cb</span><span class="main">⟩</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="free">X</span>›</span></span> b_not_in_no_head no_head_generates <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="main">⟨</span><span class="var">?Cb</span><span class="main">⟩</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> 
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⟨</span><span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="free">X</span><span class="main">⟩</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> basis_gen_hull free_hull.free_gen_in 
          <span class="keyword1"><span class="command">unfolding</span></span> free_basis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">ε</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">⟨</span><span class="var">?Cb</span><span class="main">⟩</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> hd_no_head<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⟨</span><span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="free">X</span><span class="main">⟩</span>›</span></span> nohd<span class="main">]</span>
            <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="free">X</span>›</span></span> no_head_generates <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">⟨</span><span class="var">?Cb</span><span class="main">⟩</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">X</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">⊆</span> <span class="main">⟨</span><span class="var">?Cb</span><span class="main">⟩</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> free_hull_min<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹code <span class="var">?Cb</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">⊆</span> <span class="main">⟨</span><span class="var">?Cb</span><span class="main">⟩</span>›</span></span><span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> subset_eq<span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∉</span> <span class="main">⟨</span><span class="var">?Cb</span><span class="main">⟩</span>›</span></span> basisD simp_el_el <span class="keyword1"><span class="command">unfolding</span></span> free_basis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="comment1">― ‹The opposite inclusion is easy›</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="main">(</span><span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="free">X</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">|</span> <span class="bound">x</span><span class="main">.</span>  <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="keyword1">ε</span><span class="main">}</span> <span class="main">⊆</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> basis_gen_hull_free dec_hd genset_sub_free <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Binary code›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We illustrate the use of the Graph Lemma in an alternative proof of the fact that two non-commuting words form a code.
See also <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> no_comm_bin_code <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> <a href="../Combinatorics_Words/CoWBasic.html"></a><a href="../Combinatorics_Words/CoWBasic.html">Combinatorics_Words.CoWBasic</a><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

First, we prove a lemma which is the core of the alternative proof.
›</span></span>

<span class="keyword1" id="Graph_Lemma-non_comm_hds_neq"><span class="command">lemma</span></span> non_comm_hds_neq<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">⋅</span> <span class="free">v</span> <span class="main">≠</span> <span class="free">v</span> <span class="main">⋅</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="free">u</span><span class="main">)</span> <span class="main">≠</span> hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> basis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span>hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span>hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="free">v</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> graph_lemma<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="free">u</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> <span class="main">(</span>hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span><span class="main">*</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> basis <span class="keyword1"><span class="command">unfolding</span></span> free_basis_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> basis_gen_hull free_hull.simps free_hull_hull insertI1 insert_absorb2 sing_gen<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> <span class="main">(</span>hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span><span class="main">*</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> basis eq <span class="keyword1"><span class="command">unfolding</span></span> free_basis_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> basis_gen_hull free_hull_hull genset_sub_free insert_absorb2 insert_subset sing_gen<span class="main">)</span> 
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> comm_root assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">⋅</span> <span class="free">v</span> <span class="main">≠</span> <span class="free">v</span> <span class="main">⋅</span> <span class="free">u</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">xs</span> <span class="main">∈</span> lists <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span> <span class="main">⟹</span> <span class="free">ys</span> <span class="main">∈</span> lists <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span> <span class="main">⟹</span> concat <span class="free">xs</span> <span class="main">=</span> concat <span class="free">ys</span> <span class="main">⟹</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_induct2'<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Nil_is_append_conv append_Nil assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Nil_is_append_conv append_Nil assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">x</span> <span class="skolem">xs</span> <span class="skolem">y</span> <span class="skolem">ys</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">∈</span> lists <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span> <span class="main">∈</span> lists <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> or_x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> or_y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">∈</span> lists <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span> <span class="main">∈</span> lists <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> hd_z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="keyword1">ε</span> <span class="main">⟹</span> <span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs</span> <span class="main">∈</span> lists <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span> <span class="main">⟹</span> hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="main">(</span>concat <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span> <span class="skolem">zs</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs</span> <span class="main">∈</span> lists <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="main">⟨</span><span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>F</sub></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs</span> <span class="main">∈</span> lists <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"concat <span class="skolem">zs</span> <span class="main">∈</span> <span class="main">⟨</span><span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>F</sub></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> concat_tl<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">#</span> <span class="skolem">zs</span> <span class="main">∈</span> lists <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span>›</span></span><span class="main">]</span> hull_in_free_hull<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Dec</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="main">(</span>concat <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">Dec</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">⋅</span> <span class="main">(</span><span class="keyword1">Dec</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="main">(</span>concat <span class="skolem">zs</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> free_basis_dec_morph<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"concat <span class="skolem">zs</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Dec</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="skolem">z</span> <span class="main">≠</span> <span class="keyword1">ε</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="main">⟨</span><span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span><span class="keyword1">⟩<span class="hidden">⇩</span><sub>F</sub></span>›</span></span> basis_gen_hull_free dec_nemp'<span class="main">[</span><span class="operator">OF</span>  <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="main">(</span>concat <span class="main">(</span><span class="skolem">z</span><span class="main">#</span><span class="skolem">zs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> hd_append  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="free">u</span><span class="main">)</span> <span class="main">≠</span> hd <span class="main">(</span><span class="keyword1">Dec</span> <span class="keyword1">𝔅<span class="hidden">⇩</span><sub>F</sub></span> <span class="main">{</span><span class="free">u</span><span class="main">,</span><span class="free">v</span><span class="main">}</span> <span class="free">v</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> non_comm_hds_neq<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span>  <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hd_z<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">∈</span> lists <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span>›</span></span> <span class="main">,</span> <span class="operator">unfolded</span> <span class="quoted"><span class="quoted">‹concat <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> concat <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span><span class="main">)</span>›</span></span> hd_z<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="keyword1">ε</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">#</span> <span class="skolem">ys</span> <span class="main">∈</span> lists <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> or_x or_y 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"4.hyps"</span> <span class="quoted">"4.prems"</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>