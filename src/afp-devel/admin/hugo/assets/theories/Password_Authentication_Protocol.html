<div id="Propaedeutics">
<div class="head">
<h1>Theory Propaedeutics</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Verification of a Diffie-Hellman Password-based Authentication Protocol by Extending the Inductive Method
    Author:      Pasquale Noce
                 Security Certification Specialist at Arjo Systems, Italy
                 pasquale dot noce dot lavoro at gmail dot com
                 pasquale dot noce at arjosystems dot com
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Propaedeutic definitions and lemmas"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Propaedeutics
<span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Complex_Main.html">Complex_Main</a> <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Countable.html">HOL-Library.Countable</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">goals_limit</span> <span class="main"><span class="main">=</span></span> 20<span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

\emph{This paper is an achievement of the whole OS Development and Certification team of the Arjo
Systems site at Arzano, Italy, because it would have never been born without the contributions of my
colleagues, the discussions we had, the ideas they shared with me. Particularly, the intuition that
the use of Chip Authentication Mapping makes the secrecy of the PACE authentication key unnecessary
is not mine. I am very grateful to all the team members for these essential contributions, and even
more for these unforgettable years of work together.}
›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Introduction"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Password-based authentication in an insecure environment -- such as password-based authentication
between a user and a smart card, which is the subject of this paper -- requires that the password be
exchanged on a secure channel, so as to prevent it from falling into the hands of an eavesdropper.
A possible method to establish such a channel is Password Authenticated Connection Establishment
(PACE), which itself is a password-based Diffie-Hellman key agreement protocol, specified in the
form of a smart card protocol in \cite{R4}. Thus, in addition to the user's password, another
password is needed if PACE is used, namely the one from which the PACE authentication key is
derived.

A simple choice allowing to reduce the number of the passwords that the user has to manage would be
to employ the same password both as key derivation password, verified implicitly by means of the
PACE protocol, and as direct use password, verified explicitly by comparison. However, this approach
has the following shortcomings:

\begin{itemize}

\item
A usual countermeasure against trial-and-error attacks aimed at disclosing the user's password
consists of blocking its use after a number of consecutive verification failures exceeding a given
threshold. If the PACE authentication key is derived from the user's password, such key has to be
blocked as well. Thus, an additional PACE authentication key would be needed for any user's
operation not requiring to be preceded by the verification of the user's password, but only to be
performed on a secure channel, such as the verification of a Personal Unblocking Code (PUC) by means
of command RESET RETRY COUNTER \cite{R5} to unblock the password. On the contrary, a single PACE
authentication key is sufficient for all user's operations provided it is independent of the user's
password, which leads to a simpler system.

\item
The user is typically allowed to change her password, e.g. by means of command CHANGE REFERENCE DATA
\cite{R5}. If the PACE authentication key is derived from the user's password, such key has to be
changed as well. This gives rise to additional functional requirements which can be nontrivial to
meet, particularly in the case of a preexisting implementation having to be adapted. For instance,
if the key itself is stored on the smart card rather than being derived at run time from the user's
password, which improves performance and prevents side channel attacks, the update of the password
and the key must be performed as an atomic operation to ensure their consistency. On the contrary,
the PACE authentication key can remain unchanged provided it is independent of the user's password,
which leads to a simpler system.

\end{itemize}

Therefore, a PACE password distinct from the user's password seems to be preferable. As the user's
password is a secret known by the user only, the derivation of the PACE authentication key from the
user's password would guarantee the secrecy of the key as well. If the PACE authentication key is
rather derived from an independent password, then a new question arises: is this key required to be
secret?

In order to find the answer, it is useful to schematize the protocol applying the informal notation
used in \cite{R1}. If Generic Mapping is employed as mapping method (cf. \cite{R4}), the protocol
takes the following form, where agents $U$ and $C$ stand for a given user and her own smart card,
step C$n$ for the $n$th command APDU, and step R$n$ for the $n$th response APDU (for further
information, cf. \cite{R4} and \cite{R5}).

\null

\qquad R1. $C \rightarrow U : \{s\}_K$

\qquad C2. $U \rightarrow C : PK_{Map,PCD}$

\qquad R2. $C \rightarrow U : PK_{Map,IC}$

\qquad C3. $U \rightarrow C : PK_{DH,PCD}$

\qquad R3. $C \rightarrow U : PK_{DH,IC}$

\qquad C4. $U \rightarrow C : \{PK_{DH,IC}\}_{KS}$

\qquad R4. $C \rightarrow U : \{PK_{DH,PCD}\}_{KS}$

\qquad C5. $U \rightarrow C : \{$\emph{User's password}$\}_{KS}$

\qquad R5. $C \rightarrow U : \{$\emph{Success code}$\}_{KS}$

\null

Being irrelevant for the security analysis of the protocol, the initial MANAGE SECURITY ENVIRONMENT:
SET AT command/response pair, as well as the first GENERAL AUTHENTICATE command requesting nonce
$s$, are not included in the scheme.

In the response to the first GENERAL AUTHENTICATE command (step R1), the card returns nonce $s$
encrypted with the PACE authentication key $K$.

In the second GENERAL AUTHENTICATE command/response pair (steps C2 and R2), the user and the card
exchange the respective ephemeral public keys $PK_{Map,PCD} = [SK_{Map,PCD}]G$ and $PK_{Map,IC} =
[SK_{Map,IC}]G$, where $G$ is the static cryptographic group generator (the notation used in
\cite{R6} is applied). Then, both parties compute the ephemeral generator $G' = [s + SK_{Map,PCD}
\times SK_{Map,IC}]G$.

In the third GENERAL AUTHENTICATE command/response pair (steps C3 and R3), the user and the card
exchange another pair of ephemeral public keys $PK_{DH,PCD} = [SK_{DH,PCD}]G'$ and $PK_{DH,IC} =
[SK_{DH,IC}]G'$, and then compute the shared secret $[SK_{DH,PCD} \times SK_{DH,IC}]G'$, from which
session keys $KS_{Enc}$ and $KS_{MAC}$ are derived. In order to abstract from unnecessary details,
the above scheme considers a single session key $KS$.

In the last GENERAL AUTHENTICATE command/response pair (steps C4 and R4), the user and the card
exchange the respective authentication tokens, obtained by computing a Message Authentication Code
(MAC) of the ephemeral public keys $PK_{DH,IC}$ and $PK_{DH,PCD}$ with session key $KS_{MAC}$. In
order to abstract from unnecessary details, the above scheme represents these MACs as cryptograms
generated using the single session key $KS$.

Finally, in steps C5 and R5, the user sends her password to the card on the secure messaging channel
established by session keys $KS_{Enc}$ and $KS_{MAC}$, e.g. via command VERIFY \cite{R5}, and the
card returns the success status word 0x9000 \cite{R5} over the same channel. In order to abstract
from unnecessary details, the above scheme represents both messages as cryptograms generated using
the single session key $KS$.

So, what if the PACE authentication key $K$ were stolen by an attacker -- henceforth called
\emph{spy} as done in \cite{R1}? In this case, even if the user's terminal were protected from
attacks, the spy could get hold of the user's password by replacing the user's smart card with a
fake one capable of performing a remote data transmission, so as to pull off a \emph{grandmaster
chess attack} \cite{R2}. In this way, the following scenario would occur, where agents $F$ and $S$
stand for the fake card and the spy.

\null

\qquad R1. $F \rightarrow U : \{s\}_K$

\qquad C2. $U \rightarrow F : PK_{Map,PCD}$

\qquad R2. $F \rightarrow U : PK_{Map,IC}$

\qquad C3. $U \rightarrow F : PK_{DH,PCD}$

\qquad R3. $F \rightarrow U : PK_{DH,IC}$

\qquad C4. $U \rightarrow F : \{PK_{DH,IC}\}_{KS}$

\qquad R4. $F \rightarrow U : \{PK_{DH,PCD}\}_{KS}$

\qquad C5. $U \rightarrow F : \{$\emph{User's password}$\}_{KS}$

\qquad C5'. $F \rightarrow S : $ \emph{User's password}

\null

Since the spy has stored key $K$ in its memory, the fake card can encrypt nonce $s$ with $K$, so
that it computes the same session keys as the user in step R3. As a result, the user receives a
correct authentication token in step R4, and then agrees to send her password to the fake card in
step C5. At this point, in order to accomplish the attack, the fake card has to do nothing but
decrypt the user's password and send it to the spy on a remote communication channel, which is what
happens in the final step C5'.

This argument demonstrates that the answer to the pending question is affirmative, namely the PACE
authentication key is indeed required to be secret, if Generic Mapping is used. Moreover, the same
conclusion can be drawn on the basis of a similar argument in case the mapping method being used is
Integrated Mapping (cf. \cite{R4}). Therefore, the PACE password from which the key is derived must
be secret as well.

This requirement has a significant impact on both the security and the usability of the system. In
fact, the only way to prevent the user from having to input the PACE password in addition to the
direct use one is providing such password to the user's terminal by other means. In the case of a
stand-alone application, this implies that either the PACE password itself or data allowing its
computation must be stored somewhere in the user's terminal, which gives rise to a risk of leakage.
The alternative is to have the PACE password typed in by the user, which renders longer the overall
credentials that the user is in charge of managing securely. Furthermore, any operation having to be
performed on a secure messaging channel before the user types in her password -- such as identifying
the user in case the smart card is endowed with an identity application compliant with \cite{R3} and
\cite{R4} -- would require an additional PACE password independent of the user's one. Hence, such
preliminary operations and the subsequent user's password verification would have to be performed on
distinct secure messaging channels, which would cause a deterioration in the system performance.

In case Chip Authentication Mapping is used as mapping method instead (cf. \cite{R4}), the resulting
protocol can be schematized as follows.

\null

\qquad R1. $C \rightarrow U : \{s\}_K$

\qquad C2. $U \rightarrow C : PK_{Map,PCD}$

\qquad R2. $C \rightarrow U : PK_{Map,IC}$

\qquad C3. $U \rightarrow C : PK_{DH,PCD}$

\qquad R3. $C \rightarrow U : PK_{DH,IC}$

\qquad C4. $U \rightarrow C : \{PK_{DH,IC}\}_{KS}$

\qquad R4. $C \rightarrow U : \{PK_{DH,PCD}$, $(SK_{IC})^{-1} \times SK_{Map,IC}$ \emph{mod n},

\qquad \qquad $PK_{IC}$, $PK_{IC}$ \emph{signature}$\}_{KS}$

\qquad C5. $U \rightarrow C : \{$\emph{User's password}$\}_{KS}$

\qquad R5. $C \rightarrow U : \{$\emph{Success code}$\}_{KS}$

\null

In the response to the last GENERAL AUTHENTICATE command (step R4), in addition to the MAC of
$PK_{DH,PCD}$ computed with session key $KS_{MAC}$, the smart card returns also the \emph{Encrypted
Chip Authentication Data} ($A_{IC}$) if Chip Authentication Mapping is used. These data result from
the encryption with session key $KS_{Enc}$ of the \emph{Chip Authentication Data} ($CA_{IC}$), which
consist of the product modulo $n$, where $n$ is the group order, of the inverse modulo $n$ of the
static private key $SK_{IC}$ with the ephemeral private key $SK_{Map,IC}$.

The user can then verify the authenticity of the chip applying the following procedure.

\begin{enumerate}

\item
Read the static public key $PK_{IC} = [SK_{IC}]G$ from a dedicated file of the smart card, named
\emph{EF.CardSecurity}.
\\Because of the read access conditions to be enforced by this file, it must be read over the secure
messaging channel established by session keys $KS_{Enc}$ and $KS_{MAC}$ (cf. \cite{R3}).

\item
Verify the signature contained in file EF.CardSecurity, generated over the contents of the file by a
trusted Certification Authority (CA).
\\To perform this operation, the user's terminal is supposed to be provided by secure means with the
public key corresponding to the private key used by the CA for signature generation.

\item
Decrypt the received $A_{IC}$ to recover $CA_{IC}$ and verify that $[CA_{IC}]PK_{IC} = PK_{Map,IC}$.
\\Since this happens just in case $CA_{IC} = (SK_{IC})^{-1} \times SK_{Map,IC}$ \emph{mod n}, the
success of such verification proves that the chip knows the private key $SK_{IC}$ corresponding to
the certified public key $PK_{IC}$, and thus is authentic.

\end{enumerate}

The reading of file EF.CardSecurity is performed next to the last GENERAL AUTHENTICATE command as a
separate operation, by sending one or more READ BINARY commands on the secure messaging channel
established by session keys $KS_{Enc}$ and $KS_{MAC}$ (cf. \cite{R3}, \cite{R4}, and \cite{R5}). The
above scheme represents this operation by inserting the public key $PK_{IC}$ and its signature into
the cryptogram returned by the last GENERAL AUTHENTICATE command, so as to abstract from unnecessary
details once again.

A successful verification of Chip Authentication Data provides the user with a proof of the fact
that the party knowing private key $SK_{Map,IC}$, and then sharing the same session keys $KS_{Enc}$
and $KS_{MAC}$, is an authentic chip. Thus, the protocol ensures that the user accepts to send her
password to an authentic chip only. As a result, the grandmaster chess attack described previously
is not applicable, so that the user's password cannot be stolen by the spy any longer. What is more,
this is true independently of the secrecy of the PACE authentication key. Therefore, this key is no
longer required to be secret, which solves all the problems ensuing from such requirement.

The purpose of this paper is indeed to construct a formal model of the above protocol in the Chip
Authentication Mapping case and prove its security, applying Paulson's Inductive Method as described
in \cite{R1}. In more detail, the formal development is aimed at proving that such protocol enforces
the following security properties.

\begin{itemize}

\item
Secrecy theorem <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pr_key_secrecy›</span></span></span></span>: if a user other than the spy sends her password to some
smart card (not necessarily her own one), then the spy cannot disclose the session key used to
encrypt the password. This property ensures that the protocol is successful in establishing
trustworthy secure messaging channels between users and smart cards.

\item
Secrecy theorem <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pr_passwd_secrecy›</span></span></span></span>: the spy cannot disclose the passwords of other users.
This property ensures that the protocol is successful in preserving the secrecy of users' passwords.

\item
Authenticity theorem <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pr_user_authenticity›</span></span></span></span>: if a smart card receives the password of a user
(not necessarily the cardholder), then the message must have been originally sent by that user. This
property ensures that the protocol enables users to authenticate themselves to their smart cards,
viz. provides an \emph{external authentication} service (cf. \cite{R5}).

\item
Authenticity theorem <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pr_card_authenticity›</span></span></span></span>: if a user sends her password to a smart card and
receives a success code as response, then the card is her own one and the response must have been
originally sent by that card. This property ensures that the protocol enables smart cards to
authenticate themselves to their cardholders, viz. provides an \emph{internal authentication}
service (cf. \cite{R5}).

\end{itemize}

Remarkably, none of these theorems turns out to require the secrecy of the PACE authentication key
as an assumption, so that all of them are valid independently of whether this key is secret or not.

The main technical difficulties arising from this formal development are the following ones.

\begin{itemize}

\item
Data such as private keys for Diffie-Hellman key agreement and session keys do not necessarily occur
as components of exchanged messages, viz. they may be computed by some agent without being ever sent
to any other agent. In this case, whichever protocol trace <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>evs›</span></span></span></span> is given, any such key
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> will not be contained in either set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>analz (spies evs)›</span></span></span></span> or <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>used evs›</span></span></span></span>, so
that statements such as <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x ∈ analz (spies evs)›</span></span></span></span> or <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x ∈ used evs›</span></span></span></span> will be vacuously
false. Thus, some way must be found to formalize a state of affairs where <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> is known by the
spy or has already been used in some protocol run.

\item
As private keys for Diffie-Hellman key agreement do not necessarily occur as components of exchanged
messages, some way must be found to record the private keys that each agent has either generated or
accepted from some other agent (possibly implicitly, in the form of the corresponding public keys)
in each protocol run.

\item
The public keys for Diffie-Hellman key agreement being used are comprised of the elements of a
cryptographic cyclic group of prime order $n$, and the private keys are the elements of the finite
field comprised of the integers from 0 to $n$ - 1 (cf. \cite{R4}, \cite{R6}). Hence, the operations
defined in these algebraic structures, as well as the generation of public keys from known private
keys, correspond to additional ways in which the spy can generate fake messages starting from known
ones. A possible option to reflect this in the formal model would be to extend the inductive
definition of set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>synth H›</span></span></span></span> with rules enabling to obtain new Diffie-Hellman private and
public keys from those contained in set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>H›</span></span></span></span>, but the result would be an overly complex
definition. Thus, an alternative formalization ought to be found.

\end{itemize}

These difficulties are solved by extending the Inductive Method, with respect to the form specified
in \cite{R1}, as follows.

\begin{itemize}

\item
The protocol is no longer defined as a set of event lists, but rather as a set of 4-tuples
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">evs</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">S</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">A</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">U</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> where <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>evs›</span></span></span></span> is an event list, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>S›</span></span></span></span> is the current protocol
\emph{state} -- viz. a function that maps each agent to the private keys for Diffie-Hellman key
agreement generated or accepted in each protocol run --, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>A›</span></span></span></span> is the set of the Diffie-Hellman
private keys and session keys currently known by the spy, and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>U›</span></span></span></span> is the set of the
Diffie-Hellman private keys and session keys which have already been used in some protocol run.
\\In this way, the first two difficulties are solved. Particularly, the full set of the messages
currently known by the spy can be formalized as the set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>analz (A ∪ spies evs)›</span></span></span></span>.

\item
The inductive definition of the protocol does not contain a single \emph{fake} rule any longer, but
rather one \emph{fake} rule for each protocol step. Each \emph{fake} rule is denoted by adding
letter "F" to the identifier of the corresponding protocol step, e.g. the \emph{fake} rules
associated to steps C2 and R5 are given the names \emph{FC2} and \emph{FR5}, respectively.
\\In this way, the third difficulty is solved, too. In fact, for each protocol step, the related
\emph{fake} rule extends the spy's capabilities to generate fake messages with the operations on
known Diffie-Hellman private and public keys relevant for that step, which makes an augmentation of
set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>synth H›</span></span></span></span> with such operations unnecessary.

\end{itemize}

Throughout this paper, the salient points of definitions and proofs are commented; for additional
information, cf. Isabelle documentation, particularly \cite{R7}, \cite{R8}, \cite{R9}, and
\cite{R10}.

Paulson's Inductive Method is described in \cite{R1}, and further information is provided in
\cite{R7} as a case study. The formal developments described in \cite{R1} and \cite{R7} are included
in the Isabelle distribution.

Additional information on the involved cryptography can be found in \cite{R4} and \cite{R6}.
›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Propaedeutic definitions"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
First of all, the data types of encryption/signature keys, Diffie-Hellman private keys, and
Diffie-Hellman public keys are defined. Following \cite{R7}, encryption/signature keys are
identified with natural numbers, whereas Diffie-Hellman private keys and public keys are represented
as rational and integer numbers in order to model the algebraic structures that they form (a field
and a group, respectively; cf. above).

\null
›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> key <span class="main">=</span> <span class="quoted">nat</span>

<span class="keyword1"><span class="command">type_synonym</span></span> pri_agrk <span class="main">=</span> <span class="quoted">rat</span>

<span class="keyword1"><span class="command">type_synonym</span></span> pub_agrk <span class="main">=</span> <span class="quoted">int</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Agents are comprised of an infinite quantity of users and smart cards, plus the Certification
Authority (CA) signing public key $PK_{IC}$. For each <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>User n›</span></span></span></span> is the cardholder
of smart card <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Card n›</span></span></span></span>.

\null
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> agent <span class="main">=</span> CA <span class="main">|</span> Card <span class="quoted">nat</span> <span class="main">|</span> User <span class="quoted">nat</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

In addition to the kinds of messages considered in \cite{R1}, the data type of messages comprises
also users' passwords, Diffie-Hellman private and public keys, and Chip Authentication Data.
Particularly, for each <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Passwd n›</span></span></span></span> is the password of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"User <span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, accepted
as being the correct one by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Card <span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

\null
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> msg <span class="main">=</span>
  Agent     <span class="quoted">agent</span> <span class="main">|</span>
  Number    <span class="quoted">nat</span> <span class="main">|</span>
  Nonce     <span class="quoted">nat</span> <span class="main">|</span>
  Key       <span class="quoted">key</span> <span class="main">|</span>
  Hash      <span class="quoted">msg</span> <span class="main">|</span>
  Passwd    <span class="quoted">nat</span> <span class="main">|</span>
  Pri_AgrK  <span class="quoted">pri_agrk</span> <span class="main">|</span>
  Pub_AgrK  <span class="quoted">pub_agrk</span> <span class="main">|</span>
  Auth_Data <span class="quoted">pri_agrk</span> <span class="quoted">pri_agrk</span> <span class="main">|</span>
  Crypt     <span class="quoted">key</span> <span class="quoted">msg</span> <span class="main">|</span>
  MPair     <span class="quoted">msg</span> <span class="quoted">msg</span>

<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_MTuple"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">,</span> args<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">*</span> <span class="tfree">'b</span>"</span></span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(2</span><span class="keyword1">⦃</span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword1">⦄</span><span class="keyword3">)</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">⦃</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">⦄</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="main">⦃</span><span class="free">x</span><span class="main">,</span> <span class="main">⦃</span><span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">⦄</span><span class="main">⦄</span>"</span>
  <span class="quoted">"<span class="main">⦃</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">⦄</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> MPair <span class="free">x</span> <span class="free">y</span>"</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

As regards data type <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>event›</span></span></span></span>, constructor <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Says›</span></span></span></span> is extended with three additional
parameters of type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">nat</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, respectively identifying the communication channel, the protocol run,
and the protocol step (ranging from 1 to 5) in which the message is exchanged. Communication
channels are associated to smart cards, so that if a user receives an encrypted nonce $s$ on channel
$n$, she will answer by sending her ephemeral public key $PK_{Map,PCD}$ for generator mapping to
smart card <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Card <span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

\null
›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> event <span class="main">=</span> Says <span class="quoted">nat</span> <span class="quoted">nat</span> <span class="quoted">nat</span> <span class="quoted">agent</span> <span class="quoted">agent</span> <span class="quoted">msg</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

The record data type <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>session›</span></span></span></span> is used to store the Diffie-Hellman private keys that each
agent has generated or accepted in each protocol run. In more detail:

\begin{itemize}

\item
Field <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>NonceS›</span></span></span></span> is deputed to contain the nonce $s$, if any, having been generated internally
(in the case of a smart card) or accepted from the external world (in the case of a user).

\item
Field <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>IntMapK›</span></span></span></span> is deputed to contain the ephemeral private key for generator mapping, if any,
having been generated internally.

\item
Field <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ExtMapK›</span></span></span></span> is deputed to contain the ephemeral private key for generator mapping, if any,
having been implicitly accepted from the external world in the form of the corresponding public key.

\item
Field <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>IntAgrK›</span></span></span></span> is deputed to contain the ephemeral private key for key agreement, if any,
having been generated internally.

\item
Field <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>ExtAgrK›</span></span></span></span> is deputed to contain the ephemeral private key for key agreement, if any,
having been implicitly accepted from the external world in the form of the corresponding public key.

\end{itemize}

\null
›</span></span>

<span class="keyword1"><span class="command">record</span></span> session <span class="main">=</span>
  NonceS   <span class="main">::</span> <span class="quoted"><span class="quoted">"pri_agrk option"</span></span>
  IntMapK <span class="main">::</span> <span class="quoted"><span class="quoted">"pri_agrk option"</span></span>
  ExtMapK <span class="main">::</span> <span class="quoted"><span class="quoted">"pri_agrk option"</span></span>
  IntAgrK <span class="main">::</span> <span class="quoted"><span class="quoted">"pri_agrk option"</span></span>
  ExtAgrK <span class="main">::</span> <span class="quoted"><span class="quoted">"pri_agrk option"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Then, the data type of protocol states is defined as the type of the functions that map any 3-tuple
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">X</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">n</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">run</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, where <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>X›</span></span></span></span> is an agent, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> identifies a communication channel,
and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>run›</span></span></span></span> identifies a protocol run taking place on that communication channel, to a record of
type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">session</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

\null
›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> state <span class="main">=</span> <span class="quoted"><span class="quoted">"agent <span class="main">×</span> nat <span class="main">×</span> nat <span class="main">⇒</span> session"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bad›</span></span></span></span> collects the numerical identifiers of the PACE authentication keys known by the spy,
viz. for each <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">n</span></span> <span class="main"><span class="main">∈</span></span> <span class="free"><span class="free">bad</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> just in case the spy knows the PACE authentication key
shared by agents <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"User <span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Card <span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

\null
›</span></span>

<span class="keyword1"><span class="command">consts</span></span> bad <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>invK›</span></span></span></span> maps each encryption/signature key to the corresponding inverse key, matching
the original key just in case it is symmetric.

\null
›</span></span>

<span class="keyword1"><span class="command">consts</span></span> invK <span class="main">::</span> <span class="quoted"><span class="quoted">"key <span class="main">⇒</span> key"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>agrK›</span></span></span></span> maps each Diffie-Hellman private key $x$ to the corresponding public key
$[x]G$, where $G$ is the static cryptographic group generator being used.

\null
›</span></span>

<span class="keyword1"><span class="command">consts</span></span> agrK <span class="main">::</span> <span class="quoted"><span class="quoted">"pri_agrk <span class="main">⇒</span> pub_agrk"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sesK›</span></span></span></span> maps each Diffie-Hellman private key $x$ to the session key resulting from
shared secret $[x]G$, where $G$ is the static cryptographic group generator being used.

\null
›</span></span>

<span class="keyword1"><span class="command">consts</span></span> sesK <span class="main">::</span> <span class="quoted"><span class="quoted">"pri_agrk <span class="main">⇒</span> key"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>symK›</span></span></span></span> maps each natural number <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> to the PACE authentication key shared by
agents <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"User <span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Card <span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

\null
›</span></span>

<span class="keyword1"><span class="command">consts</span></span> symK <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> key"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>priAK›</span></span></span></span> maps each natural number <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>n›</span></span></span></span> to the static Diffie-Hellman private key
$SK_{IC}$ assigned to smart card <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"Card <span class="free"><span class="free">n</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for Chip Authentication.

\null
›</span></span>

<span class="keyword1"><span class="command">consts</span></span> priAK <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> pri_agrk"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>priSK›</span></span></span></span> maps each agent to her own private key for digital signature generation, even
if the only such key being actually significant for the model is the Certification Authority's one,
i.e. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">priSK</span></span> CA"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

\null
›</span></span>

<span class="keyword1"><span class="command">consts</span></span> priSK <span class="main">::</span> <span class="quoted"><span class="quoted">"agent <span class="main">⇒</span> key"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

The spy is modeled as a user, specifically the one identified by number 0, i.e. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"User <span class="main"><span class="main">0</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
In this way, in addition to the peculiar privilege of being able to generate fake messages, the spy
is endowed with the capability of performing any operation that a generic user can do.

\null
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Spy</span> <span class="main">::</span> <span class="quoted">agent</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">Spy</span> <span class="main">≡</span> User <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Functions <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pubAK›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pubSK›</span></span></span></span> are abbreviations useful to make the formal development
more readable. The former function maps each Diffie-Hellman private key <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>x›</span></span></span></span> to the message
comprised of the corresponding public key <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"agrK <span class="free"><span class="free">x</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, whereas the latter maps each agent to
the corresponding public key for digital signature verification.

\null
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">pubAK</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"pri_agrk <span class="main">⇒</span> msg"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">pubAK</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> Pub_AgrK <span class="main">(</span>agrK <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">pubSK</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"agent <span class="main">⇒</span> key"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">pubSK</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> invK <span class="main">(</span>priSK <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>start_S›</span></span></span></span> represents the initial protocol state, i.e. the one in which no ephemeral
Diffie-Hellman private key has been generated or accepted by any agent yet.

\null
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">start_S</span> <span class="main">::</span> <span class="quoted">state</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">start_S</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">⦇</span>NonceS <span class="main">=</span> None<span class="main">,</span> IntMapK <span class="main">=</span> None<span class="main">,</span> ExtMapK <span class="main">=</span> None<span class="main">,</span>
  IntAgrK <span class="main">=</span> None<span class="main">,</span> ExtAgrK <span class="main">=</span> None<span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>start_A›</span></span></span></span> is comprised of the messages initially known by the spy, namely:

\begin{itemize}

\item
her own password as a user,

\item
the compromised PACE authentication keys,

\item
the public keys for digital signature verification, and

\item
the static Diffie-Hellman public keys assigned to smart cards for Chip Authentication.

\end{itemize}

\null
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">start_A</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"msg set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">start_A</span> <span class="main">≡</span> insert <span class="main">(</span>Passwd <span class="main">0</span><span class="main">)</span> <span class="main">(</span>Key <span class="main">`</span> symK <span class="main">`</span> bad <span class="main">∪</span> Key <span class="main">`</span> range pubSK <span class="main">∪</span> pubAK <span class="main">`</span> range priAK<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>start_U›</span></span></span></span> is comprised of the messages which have already been used before the execution
of the protocol starts, namely:

\begin{itemize}

\item
all users' passwords,

\item
all PACE authentication keys,

\item
the private and public keys for digital signature generation/verification, and

\item
the static Diffie-Hellman private and public keys assigned to smart cards for Chip Authentication.

\end{itemize}

\null
›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">start_U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"msg set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">start_U</span> <span class="main">≡</span> range Passwd <span class="main">∪</span> Key <span class="main">`</span> range symK <span class="main">∪</span> Key <span class="main">`</span> range priSK <span class="main">∪</span> Key <span class="main">`</span> range pubSK <span class="main">∪</span>
  Pri_AgrK <span class="main">`</span> range priAK <span class="main">∪</span> pubAK <span class="main">`</span> range priAK"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

As in \cite{R1}, function <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>spies›</span></span></span></span> models the set of the messages that the spy can see in a
protocol trace. However, it is no longer necessary to identify <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>spies []›</span></span></span></span> with the initial
knowledge of the spy, since her current knowledge in correspondence with protocol state
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">evs</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">S</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">A</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">U</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is represented as set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>analz (A ∪ spies evs)›</span></span></span></span>, where
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"start_A <span class="main"><span class="main">⊆</span></span> <span class="free"><span class="free">A</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. Therefore, this formal development defines <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>spies []›</span></span></span></span> as the empty
set.

\null
›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">spies</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"event list <span class="main">⇒</span> msg set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">spies</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">spies</span> <span class="main">(</span>Says <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">j</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">evs</span></span></span><span class="main">)</span> <span class="main">=</span> insert <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">(</span><span class="free">spies</span> <span class="free"><span class="bound"><span class="entity">evs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Here below is the specification of the axioms about the constants defined previously which are used
in the formal proofs. A model of the constants satisfying the axioms is also provided in order to
ensure the consistency of the formal development. In more detail:

\begin{enumerate}

\item
Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>agrK_inj›</span></span></span></span> states that function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">agrK</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is injective, and formalizes the fact that
distinct Diffie-Hellman private keys generate distinct public keys.
\\Since the former keys are represented as rational numbers and the latter as integer numbers (cf.
above), a model of function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">agrK</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> satisfying the axiom is built by means of the injective
function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"inv nat_to_rat_surj"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> provided by the Isabelle distribution, which maps rational
numbers to natural numbers.

\item
Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sesK_inj›</span></span></span></span> states that function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">sesK</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is injective, and formalizes the fact that
the key derivation function specified in \cite{R4} for deriving session keys from shared secrets
makes use of robust hash functions, so that collisions are negligible.
\\Since Diffie-Hellman private keys are represented as rational numbers and encryption/signature
keys as natural numbers (cf. above), a model of function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">sesK</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> satisfying the axiom is built
by means of the injective function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"inv nat_to_rat_surj"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, too.

\item
Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>priSK_pubSK›</span></span></span></span> formalizes the fact that every private key for signature generation is
distinct from whichever public key for signature verification. For example, in the case of the RSA
algorithm, small fixed values are typically used as public exponents to make signature verification
more efficient, whereas the corresponding private exponents are of the same order of magnitude as
the modulus.

\item
Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>priSK_symK›</span></span></span></span> formalizes the fact that private keys for signature generation are
distinct from PACE authentication keys, which is obviously true since the former keys are asymmetric
whereas the latter are symmetric.

\item
Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pubSK_symK›</span></span></span></span> formalizes the fact that public keys for signature verification are
distinct from PACE authentication keys, which is obviously true since the former keys are asymmetric
whereas the latter are symmetric.

\item
Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>invK_sesK›</span></span></span></span> formalizes the fact that session keys are symmetric.

\item
Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>invK_symK›</span></span></span></span> formalizes the fact that PACE authentication keys are symmetric.

\item
Axiom <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>symK_bad›</span></span></span></span> states that set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">bad</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is closed with respect to the identity of PACE
authentication keys, viz. if a compromised user has the same PACE authentication key as another
user, then the latter user is compromised as well.

\end{enumerate}

It is worth remarking that there is no axiom stating that distinct PACE authentication keys are
assigned to distinct users. As a result, the formal development does not depend on the enforcement
of this condition.

\null
›</span></span>

<span class="keyword1"><span class="command">specification</span></span> <span class="main">(</span><span class="quoted">bad</span> <span class="quoted">invK</span> <span class="quoted">agrK</span> <span class="quoted">sesK</span> <span class="quoted">symK</span> <span class="quoted">priSK</span><span class="main">)</span>
agrK_inj<span class="main">:</span>     <span class="quoted"><span class="quoted">"inj agrK"</span></span>
sesK_inj<span class="main">:</span>     <span class="quoted"><span class="quoted">"inj sesK"</span></span>
priSK_pubSK<span class="main">:</span>  <span class="quoted"><span class="quoted">"priSK <span class="free">X</span> <span class="main">≠</span> pubSK <span class="free">X'</span>"</span></span>
priSK_symK<span class="main">:</span>   <span class="quoted"><span class="quoted">"priSK <span class="free">X</span> <span class="main">≠</span> symK <span class="free">n</span>"</span></span>
pubSK_symK<span class="main">:</span>   <span class="quoted"><span class="quoted">"pubSK <span class="free">X</span> <span class="main">≠</span> symK <span class="free">n</span>"</span></span>
invK_sesK<span class="main">:</span>    <span class="quoted"><span class="quoted">"invK <span class="main">(</span>sesK <span class="free">a</span><span class="main">)</span> <span class="main">=</span> sesK <span class="free">a</span>"</span></span>
invK_symK<span class="main">:</span>    <span class="quoted"><span class="quoted">"invK <span class="main">(</span>symK <span class="free">n</span><span class="main">)</span> <span class="main">=</span> symK <span class="free">n</span>"</span></span>
symK_bad<span class="main">:</span>     <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> bad <span class="main">⟹</span> symK <span class="free">n</span> <span class="main">=</span> symK <span class="free">m</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main">∈</span> bad"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">if</span> even <span class="bound">n</span> <span class="keyword1">then</span> <span class="bound">n</span> <span class="keyword1">else</span> Suc <span class="bound">n</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> int <span class="main">(</span>inv nat_to_rat_surj <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> inv nat_to_rat_surj <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">X</span><span class="main">.</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"surj nat_to_rat_surj"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> surj_nat_to_rat_surj<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inj <span class="main">(</span>inv nat_to_rat_surj<span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> surj_imp_inj_inv<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"inv nat_to_rat_surj <span class="skolem">x</span> <span class="main">=</span> inv nat_to_rat_surj <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> injD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Here below are the inductive definitions of sets <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>parts›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>analz›</span></span></span></span>, and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>synth›</span></span></span></span>.
With respect to the definitions given in the protocol library included in the Isabelle distribution,
those of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>parts›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>analz›</span></span></span></span> are extended with rules extracting Diffie-Hellman private
keys from Chip Authentication Data, whereas the definition of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>synth›</span></span></span></span> contains a further rule
that models the inverse operation, i.e. the construction of Chip Authentication Data starting from
private keys. Particularly, the additional <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>analz›</span></span></span></span> rules formalize the fact that, for any two
private keys $x$ and $y$, if $x \times y$ \emph{mod n} and $x$ are known, where $n$ is the group
order, then $y$ can be obtained by computing $x \times y \times x^{-1}$ \emph{mod n}, and similarly,
$x$ can be obtained if $y$ is known.

An additional set, named <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>items›</span></span></span></span>, is also defined inductively in what follows. This set is a
hybrid of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>parts›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>analz›</span></span></span></span>, as it shares with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>parts›</span></span></span></span> the rule applying to
cryptograms and with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>analz›</span></span></span></span> the rules applying to Chip Authentication Data. Since the former
rule is less strict than the corresponding one in the definition of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>analz›</span></span></span></span>, it turns out that
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">analz</span></span> <span class="free"><span class="free">H</span></span> <span class="main"><span class="main">⊆</span></span> <span class="free"><span class="free">items</span></span> <span class="free"><span class="free">H</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for any message set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>H›</span></span></span></span>. As a result, for any message <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>X›</span></span></span></span>,
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">X</span></span> <span class="main"><span class="main">∉</span></span> <span class="free"><span class="free">items</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">A</span></span> <span class="main"><span class="main">∪</span></span> spies <span class="free"><span class="free">evs</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> implies <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">X</span></span> <span class="main"><span class="main">∉</span></span> <span class="free"><span class="free">analz</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">A</span></span> <span class="main"><span class="main">∪</span></span> spies <span class="free"><span class="free">evs</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. Therefore, set
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>items›</span></span></span></span> is useful to prove the secrecy of the Diffie-Hellman private keys utilized to compute
Chip Authentication Data without bothering with case distinctions concerning the secrecy of
encryption keys, as would happen if set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>analz›</span></span></span></span> were directly employed instead.

\null
›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">parts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"msg set <span class="main">⇒</span> msg set"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">H</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"msg set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
Inj<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">parts</span> <span class="free">H</span>"</span></span> <span class="main">|</span>
Fst<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">⦄</span> <span class="main">∈</span> <span class="free">parts</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">parts</span> <span class="free">H</span>"</span></span> <span class="main">|</span>
Snd<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">⦄</span> <span class="main">∈</span> <span class="free">parts</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">∈</span> <span class="free">parts</span> <span class="free">H</span>"</span></span> <span class="main">|</span>
Body<span class="main">:</span>     <span class="quoted"><span class="quoted">"Crypt <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">parts</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">parts</span> <span class="free">H</span>"</span></span> <span class="main">|</span>
Auth_Fst<span class="main">:</span> <span class="quoted"><span class="quoted">"Auth_Data <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free">parts</span> <span class="free">H</span> <span class="main">⟹</span> Pri_AgrK <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free">parts</span> <span class="free">H</span>"</span></span> <span class="main">|</span>
Auth_Snd<span class="main">:</span> <span class="quoted"><span class="quoted">"Auth_Data <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free">parts</span> <span class="free">H</span> <span class="main">⟹</span> Pri_AgrK <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free">parts</span> <span class="free">H</span>"</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">items</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"msg set <span class="main">⇒</span> msg set"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">H</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"msg set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
Inj<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">items</span> <span class="free">H</span>"</span></span> <span class="main">|</span>
Fst<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">⦄</span> <span class="main">∈</span> <span class="free">items</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">items</span> <span class="free">H</span>"</span></span> <span class="main">|</span>
Snd<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">⦄</span> <span class="main">∈</span> <span class="free">items</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">∈</span> <span class="free">items</span> <span class="free">H</span>"</span></span> <span class="main">|</span>
Body<span class="main">:</span>     <span class="quoted"><span class="quoted">"Crypt <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">items</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">items</span> <span class="free">H</span>"</span></span> <span class="main">|</span>
Auth_Fst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Auth_Data <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free">items</span> <span class="free">H</span><span class="main">;</span> Pri_AgrK <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free">items</span> <span class="free">H</span><span class="main">⟧</span> <span class="main">⟹</span> Pri_AgrK <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free">items</span> <span class="free">H</span>"</span></span> <span class="main">|</span>
Auth_Snd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Auth_Data <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free">items</span> <span class="free">H</span><span class="main">;</span> Pri_AgrK <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free">items</span> <span class="free">H</span><span class="main">⟧</span> <span class="main">⟹</span> Pri_AgrK <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free">items</span> <span class="free">H</span>"</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">analz</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"msg set <span class="main">⇒</span> msg set"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">H</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"msg set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
Inj<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">analz</span> <span class="free">H</span>"</span></span> <span class="main">|</span>
Fst<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">⦄</span> <span class="main">∈</span> <span class="free">analz</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">analz</span> <span class="free">H</span>"</span></span> <span class="main">|</span>
Snd<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">⦄</span> <span class="main">∈</span> <span class="free">analz</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">∈</span> <span class="free">analz</span> <span class="free">H</span>"</span></span> <span class="main">|</span>
Decrypt<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Crypt <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">analz</span> <span class="free">H</span><span class="main">;</span> Key <span class="main">(</span>invK <span class="free"><span class="bound"><span class="entity">K</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">analz</span> <span class="free">H</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">analz</span> <span class="free">H</span>"</span></span> <span class="main">|</span>
Auth_Fst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Auth_Data <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free">analz</span> <span class="free">H</span><span class="main">;</span> Pri_AgrK <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free">analz</span> <span class="free">H</span><span class="main">⟧</span> <span class="main">⟹</span> Pri_AgrK <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free">analz</span> <span class="free">H</span>"</span></span> <span class="main">|</span>
Auth_Snd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Auth_Data <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free">analz</span> <span class="free">H</span><span class="main">;</span> Pri_AgrK <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free">analz</span> <span class="free">H</span><span class="main">⟧</span> <span class="main">⟹</span> Pri_AgrK <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free">analz</span> <span class="free">H</span>"</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">synth</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"msg set <span class="main">⇒</span> msg set"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">H</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"msg set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
Inj<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">synth</span> <span class="free">H</span>"</span></span> <span class="main">|</span>
Agent<span class="main">:</span>    <span class="quoted"><span class="quoted">"Agent <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">synth</span> <span class="free">H</span>"</span></span> <span class="main">|</span>
Number<span class="main">:</span>   <span class="quoted"><span class="quoted">"Number <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∈</span> <span class="free">synth</span> <span class="free">H</span>"</span></span> <span class="main">|</span>
Hash<span class="main">:</span>     <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">synth</span> <span class="free">H</span> <span class="main">⟹</span> Hash <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">synth</span> <span class="free">H</span>"</span></span> <span class="main">|</span>
MPair<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">synth</span> <span class="free">H</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">∈</span> <span class="free">synth</span> <span class="free">H</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⦃</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">⦄</span> <span class="main">∈</span> <span class="free">synth</span> <span class="free">H</span>"</span></span> <span class="main">|</span>
Crypt<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">synth</span> <span class="free">H</span><span class="main">;</span> Key <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">∈</span> <span class="free">H</span><span class="main">⟧</span> <span class="main">⟹</span> Crypt <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">∈</span> <span class="free">synth</span> <span class="free">H</span>"</span></span> <span class="main">|</span>
Auth<span class="main">:</span>     <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Pri_AgrK <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free">H</span><span class="main">;</span> Pri_AgrK <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free">H</span><span class="main">⟧</span> <span class="main">⟹</span> Auth_Data <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free">synth</span> <span class="free">H</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Propaedeutic lemmas"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This section contains the lemmas about sets <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">parts</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">items</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">analz</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">synth</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> required for protocol verification. Since their proofs mainly consist of initial rule
inductions followed by sequences of rule applications and simplifications, \emph{apply}-style is
used.

\null
›</span></span>

<span class="keyword1" id="Propaedeutics-set_spies"><span class="command">lemma</span></span> set_spies <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"Says <span class="free">i</span> <span class="free">j</span> <span class="free">k</span> <span class="free">A</span> <span class="free">B</span> <span class="free">X</span> <span class="main">∈</span> set <span class="free">evs</span> <span class="main">⟶</span> <span class="free">X</span> <span class="main">∈</span> spies <span class="free">evs</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">evs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> spies.induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-parts_subset"><span class="command">lemma</span></span> parts_subset<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> parts <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> parts.Inj<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-parts_idem"><span class="command">lemma</span></span> parts_idem<span class="main">:</span>
 <span class="quoted"><span class="quoted">"parts <span class="main">(</span>parts <span class="free">H</span><span class="main">)</span> <span class="main">=</span> parts <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.induct<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Fst<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Snd<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Body<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Auth_Fst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-parts_simp"><span class="command">lemma</span></span> parts_simp<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> range Agent <span class="main">∪</span>
    range Number <span class="main">∪</span>
    range Nonce <span class="main">∪</span>
    range Key <span class="main">∪</span>
    range Hash <span class="main">∪</span>
    range Passwd <span class="main">∪</span>
    range Pri_AgrK <span class="main">∪</span>
    range Pub_AgrK <span class="main">⟹</span>
  parts <span class="free">H</span> <span class="main">=</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalityI <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-parts_mono"><span class="command">lemma</span></span> parts_mono<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> <span class="free">H</span> <span class="main">⟹</span> parts <span class="free">G</span> <span class="main">⊆</span> parts <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Inj<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Body<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Auth_Fst<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-parts_insert"><span class="command">lemma</span></span> parts_insert<span class="main">:</span>
 <span class="quoted"><span class="quoted">"insert <span class="free">X</span> <span class="main">(</span>parts <span class="free">H</span><span class="main">)</span> <span class="main">⊆</span> parts <span class="main">(</span>insert <span class="free">X</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rev_subsetD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-parts_simp_insert"><span class="command">lemma</span></span> parts_simp_insert<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> range Agent <span class="main">∪</span>
    range Number <span class="main">∪</span>
    range Nonce <span class="main">∪</span>
    range Key <span class="main">∪</span>
    range Hash <span class="main">∪</span>
    range Passwd <span class="main">∪</span>
    range Pri_AgrK <span class="main">∪</span>
    range Pub_AgrK <span class="main">⟹</span>
  parts <span class="main">(</span>insert <span class="free">X</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> insert <span class="free">X</span> <span class="main">(</span>parts <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalityI <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ parts_insert<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Inj<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Body<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Auth_Fst<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-parts_auth_data_1"><span class="command">lemma</span></span> parts_auth_data_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"parts <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span> <span class="main">⊆</span>
    <span class="main">{</span>Pri_AgrK <span class="free">x</span><span class="main">,</span> Pri_AgrK <span class="free">y</span><span class="main">,</span> Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">}</span> <span class="main">∪</span> parts <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>4<span class="main"><span class="improper">]</span></span> disjI2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Inj<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Body<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Auth_Fst<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-parts_auth_data_2"><span class="command">lemma</span></span> parts_auth_data_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">{</span>Pri_AgrK <span class="free">x</span><span class="main">,</span> Pri_AgrK <span class="free">y</span><span class="main">,</span> Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">}</span> <span class="main">∪</span> parts <span class="free">H</span> <span class="main">⊆</span>
    parts <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts.Auth_Fst <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts.Auth_Snd <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rev_subsetD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-parts_auth_data"><span class="command">lemma</span></span> parts_auth_data<span class="main">:</span>
 <span class="quoted"><span class="quoted">"parts <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">{</span>Pri_AgrK <span class="free">x</span><span class="main">,</span> Pri_AgrK <span class="free">y</span><span class="main">,</span> Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">}</span> <span class="main">∪</span> parts <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> parts_auth_data_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> parts_auth_data_2<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-parts_crypt_1"><span class="command">lemma</span></span> parts_crypt_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"parts <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="free">K</span> <span class="free">X</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="main">(</span>Crypt <span class="free">K</span> <span class="free">X</span><span class="main">)</span> <span class="main">(</span>parts <span class="main">(</span>insert <span class="free">X</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>3<span class="main"><span class="improper">]</span></span> disjI2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Body<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Auth_Fst<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-parts_crypt_2"><span class="command">lemma</span></span> parts_crypt_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"insert <span class="main">(</span>Crypt <span class="free">K</span> <span class="free">X</span><span class="main">)</span> <span class="main">(</span>parts <span class="main">(</span>insert <span class="free">X</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> parts <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="free">K</span> <span class="free">X</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> parts_idem <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rev_subsetD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts.Body <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">K</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-parts_crypt"><span class="command">lemma</span></span> parts_crypt<span class="main">:</span>
 <span class="quoted"><span class="quoted">"parts <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="free">K</span> <span class="free">X</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">(</span>Crypt <span class="free">K</span> <span class="free">X</span><span class="main">)</span> <span class="main">(</span>parts <span class="main">(</span>insert <span class="free">X</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> parts_crypt_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> parts_crypt_2<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-parts_mpair_1"><span class="command">lemma</span></span> parts_mpair_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"parts <span class="main">(</span>insert <span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="free">H</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="main">(</span>parts <span class="main">(</span><span class="main">{</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">}</span> <span class="main">∪</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>4<span class="main"><span class="improper">]</span></span> disjI2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Body<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Auth_Fst<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-parts_mpair_2"><span class="command">lemma</span></span> parts_mpair_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"insert <span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="main">(</span>parts <span class="main">(</span><span class="main">{</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">}</span> <span class="main">∪</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> parts <span class="main">(</span>insert <span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> parts_idem <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rev_subsetD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts.Fst <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Y</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts.Snd <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">X</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-parts_mpair"><span class="command">lemma</span></span> parts_mpair<span class="main">:</span>
 <span class="quoted"><span class="quoted">"parts <span class="main">(</span>insert <span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="main">(</span>parts <span class="main">(</span><span class="main">{</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">}</span> <span class="main">∪</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> parts_mpair_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> parts_mpair_2<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-items_subset"><span class="command">lemma</span></span> items_subset<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> items <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> items.Inj<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-items_idem"><span class="command">lemma</span></span> items_idem<span class="main">:</span>
 <span class="quoted"><span class="quoted">"items <span class="main">(</span>items <span class="free">H</span><span class="main">)</span> <span class="main">=</span> items <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.induct<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Fst<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Snd<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Body<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Fst<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Snd<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-items_parts_subset"><span class="command">lemma</span></span> items_parts_subset<span class="main">:</span>
 <span class="quoted"><span class="quoted">"items <span class="free">H</span> <span class="main">⊆</span> parts <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Inj<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Body<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Auth_Fst<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-items_simp"><span class="command">lemma</span></span> items_simp<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> range Agent <span class="main">∪</span>
    range Number <span class="main">∪</span>
    range Nonce <span class="main">∪</span>
    range Key <span class="main">∪</span>
    range Hash <span class="main">∪</span>
    range Passwd <span class="main">∪</span>
    range Pri_AgrK <span class="main">∪</span>
    range Pub_AgrK <span class="main">⟹</span>
  items <span class="free">H</span> <span class="main">=</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> parts_simp <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items_parts_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-items_mono"><span class="command">lemma</span></span> items_mono<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> <span class="free">H</span> <span class="main">⟹</span> items <span class="free">G</span> <span class="main">⊆</span> items <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Inj<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Body<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Fst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-items_insert"><span class="command">lemma</span></span> items_insert<span class="main">:</span>
 <span class="quoted"><span class="quoted">"insert <span class="free">X</span> <span class="main">(</span>items <span class="free">H</span><span class="main">)</span> <span class="main">⊆</span> items <span class="main">(</span>insert <span class="free">X</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Inj<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rev_subsetD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-items_simp_insert_1"><span class="command">lemma</span></span> items_simp_insert_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> items <span class="free">H</span> <span class="main">⟹</span> items <span class="main">(</span>insert <span class="free">X</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> items <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"insert <span class="free"><span class="free">X</span></span> <span class="free"><span class="free">H</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Inj<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Fst<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Snd<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Body<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Fst<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Snd<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-items_simp_insert_2"><span class="command">lemma</span></span> items_simp_insert_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> range Agent <span class="main">∪</span>
    range Number <span class="main">∪</span>
    range Nonce <span class="main">∪</span>
    range Key <span class="main">∪</span>
    range Hash <span class="main">∪</span>
    range Passwd <span class="main">∪</span>
    range Pub_AgrK <span class="main">⟹</span>
  items <span class="main">(</span>insert <span class="free">X</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> insert <span class="free">X</span> <span class="main">(</span>items <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalityI <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ items_insert<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Inj<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Body<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Fst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-items_pri_agrk_out"><span class="command">lemma</span></span> items_pri_agrk_out<span class="main">:</span>
 <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∉</span> parts <span class="free">H</span> <span class="main">⟹</span>
    items <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="free">x</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">(</span>Pri_AgrK <span class="free">x</span><span class="main">)</span> <span class="main">(</span>items <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalityI <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ items_insert<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>4<span class="main"><span class="improper">]</span></span> disjI2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Inj<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Body<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> items_parts_subset <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">H</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> parts.Auth_Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Fst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> items_parts_subset <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">H</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> parts.Auth_Fst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-items_auth_data_in_1"><span class="command">lemma</span></span> items_auth_data_in_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"items <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span> <span class="main">⊆</span>
    insert <span class="main">(</span>Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>items <span class="main">(</span><span class="main">{</span>Pri_AgrK <span class="free">x</span><span class="main">,</span> Pri_AgrK <span class="free">y</span><span class="main">}</span> <span class="main">∪</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>4<span class="main"><span class="improper">]</span></span> disjI2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Inj<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Body<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Inj<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Fst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Inj<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-items_auth_data_in_2"><span class="command">lemma</span></span> items_auth_data_in_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> items <span class="free">H</span> <span class="main">∨</span> Pri_AgrK <span class="free">y</span> <span class="main">∈</span> items <span class="free">H</span> <span class="main">⟹</span>
    insert <span class="main">(</span>Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>items <span class="main">(</span><span class="main">{</span>Pri_AgrK <span class="free">x</span><span class="main">,</span> Pri_AgrK <span class="free">y</span><span class="main">}</span> <span class="main">∪</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span>
      items <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rotate_tac</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Inj<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> items_idem <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rev_subsetD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rotate_tac</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rev_subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items_mono<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Auth_Fst <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Inj<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rev_subsetD<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items_mono<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rotate_tac</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Auth_Snd <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Inj<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rev_subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items_mono<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rev_subsetD<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items_mono<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Inj<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-items_auth_data_in"><span class="command">lemma</span></span> items_auth_data_in<span class="main">:</span>
 <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> items <span class="free">H</span> <span class="main">∨</span> Pri_AgrK <span class="free">y</span> <span class="main">∈</span> items <span class="free">H</span> <span class="main">⟹</span>
    items <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>items <span class="main">(</span><span class="main">{</span>Pri_AgrK <span class="free">x</span><span class="main">,</span> Pri_AgrK <span class="free">y</span><span class="main">}</span> <span class="main">∪</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> items_auth_data_in_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> items_auth_data_in_2<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-items_auth_data_out"><span class="command">lemma</span></span> items_auth_data_out<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Pri_AgrK <span class="free">x</span> <span class="main">∉</span> items <span class="free">H</span><span class="main">;</span> Pri_AgrK <span class="free">y</span> <span class="main">∉</span> items <span class="free">H</span><span class="main">⟧</span> <span class="main">⟹</span>
    items <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">(</span>Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>items <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalityI <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ items_insert<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>4<span class="main"><span class="improper">]</span></span> disjI2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Inj<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Body<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Fst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-items_crypt_1"><span class="command">lemma</span></span> items_crypt_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"items <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="free">K</span> <span class="free">X</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="main">(</span>Crypt <span class="free">K</span> <span class="free">X</span><span class="main">)</span> <span class="main">(</span>items <span class="main">(</span>insert <span class="free">X</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>4<span class="main"><span class="improper">]</span></span> disjI2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Inj<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Inj<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Body<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Fst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-items_crypt_2"><span class="command">lemma</span></span> items_crypt_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"insert <span class="main">(</span>Crypt <span class="free">K</span> <span class="free">X</span><span class="main">)</span> <span class="main">(</span>items <span class="main">(</span>insert <span class="free">X</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> items <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="free">K</span> <span class="free">X</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Inj<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Body <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">K</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Inj<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Inj<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Body<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Fst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-items_crypt"><span class="command">lemma</span></span> items_crypt<span class="main">:</span>
 <span class="quoted"><span class="quoted">"items <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="free">K</span> <span class="free">X</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">(</span>Crypt <span class="free">K</span> <span class="free">X</span><span class="main">)</span> <span class="main">(</span>items <span class="main">(</span>insert <span class="free">X</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> items_crypt_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> items_crypt_2<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-items_mpair_1"><span class="command">lemma</span></span> items_mpair_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"items <span class="main">(</span>insert <span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="free">H</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="main">(</span>items <span class="main">(</span><span class="main">{</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">}</span> <span class="main">∪</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>4<span class="main"><span class="improper">]</span></span> disjI2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Inj<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Inj<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Inj<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Body<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Fst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-items_mpair_2"><span class="command">lemma</span></span> items_mpair_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"insert <span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="main">(</span>items <span class="main">(</span><span class="main">{</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">}</span> <span class="main">∪</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> items <span class="main">(</span>insert <span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Inj<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Fst <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Y</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Inj<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Snd <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">X</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Inj<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> items.Inj<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Body<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Fst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-items_mpair"><span class="command">lemma</span></span> items_mpair<span class="main">:</span>
 <span class="quoted"><span class="quoted">"items <span class="main">(</span>insert <span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="main">(</span>items <span class="main">(</span><span class="main">{</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">}</span> <span class="main">∪</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> items_mpair_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> items_mpair_2<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-analz_subset"><span class="command">lemma</span></span> analz_subset<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> analz <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analz.Inj<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-analz_idem"><span class="command">lemma</span></span> analz_idem<span class="main">:</span>
 <span class="quoted"><span class="quoted">"analz <span class="main">(</span>analz <span class="free">H</span><span class="main">)</span> <span class="main">=</span> analz <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.induct<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Fst<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Snd<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Decrypt<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Fst<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Snd<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-analz_parts_subset"><span class="command">lemma</span></span> analz_parts_subset<span class="main">:</span>
 <span class="quoted"><span class="quoted">"analz <span class="free">H</span> <span class="main">⊆</span> parts <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Inj<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Body<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Auth_Fst<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> parts.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-analz_items_subset"><span class="command">lemma</span></span> analz_items_subset<span class="main">:</span>
 <span class="quoted"><span class="quoted">"analz <span class="free">H</span> <span class="main">⊆</span> items <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Inj<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Body<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Fst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> items.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-analz_simp"><span class="command">lemma</span></span> analz_simp<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">⊆</span> range Agent <span class="main">∪</span>
    range Number <span class="main">∪</span>
    range Nonce <span class="main">∪</span>
    range Key <span class="main">∪</span>
    range Hash <span class="main">∪</span>
    range Passwd <span class="main">∪</span>
    range Pri_AgrK <span class="main">∪</span>
    range Pub_AgrK <span class="main">⟹</span>
  analz <span class="free">H</span> <span class="main">=</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> parts_simp <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz_parts_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz_subset<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-analz_mono"><span class="command">lemma</span></span> analz_mono<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">⊆</span> <span class="free">H</span> <span class="main">⟹</span> analz <span class="free">G</span> <span class="main">⊆</span> analz <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Inj<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Decrypt<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Fst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-analz_insert"><span class="command">lemma</span></span> analz_insert<span class="main">:</span>
 <span class="quoted"><span class="quoted">"insert <span class="free">X</span> <span class="main">(</span>analz <span class="free">H</span><span class="main">)</span> <span class="main">⊆</span> analz <span class="main">(</span>insert <span class="free">X</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Inj<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rev_subsetD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-analz_simp_insert_1"><span class="command">lemma</span></span> analz_simp_insert_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> analz <span class="free">H</span> <span class="main">⟹</span> analz <span class="main">(</span>insert <span class="free">X</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> analz <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.induct <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"insert <span class="free"><span class="free">X</span></span> <span class="free"><span class="free">H</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Inj<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Fst<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Snd<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Decrypt<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Fst<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Snd<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-analz_simp_insert_2"><span class="command">lemma</span></span> analz_simp_insert_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> range Agent <span class="main">∪</span>
    range Number <span class="main">∪</span>
    range Nonce <span class="main">∪</span>
    range Hash <span class="main">∪</span>
    range Passwd <span class="main">∪</span>
    range Pub_AgrK <span class="main">⟹</span>
  analz <span class="main">(</span>insert <span class="free">X</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> insert <span class="free">X</span> <span class="main">(</span>analz <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalityI <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ analz_insert<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rotate_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Inj<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Decrypt<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Fst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-analz_auth_data_in_1"><span class="command">lemma</span></span> analz_auth_data_in_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span> <span class="main">⊆</span>
    insert <span class="main">(</span>Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>analz <span class="main">(</span><span class="main">{</span>Pri_AgrK <span class="free">x</span><span class="main">,</span> Pri_AgrK <span class="free">y</span><span class="main">}</span> <span class="main">∪</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>4<span class="main"><span class="improper">]</span></span> disjI2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Inj<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Decrypt<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Inj<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Fst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Inj<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-analz_auth_data_in_2"><span class="command">lemma</span></span> analz_auth_data_in_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="free">H</span> <span class="main">∨</span> Pri_AgrK <span class="free">y</span> <span class="main">∈</span> analz <span class="free">H</span> <span class="main">⟹</span>
    insert <span class="main">(</span>Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>analz <span class="main">(</span><span class="main">{</span>Pri_AgrK <span class="free">x</span><span class="main">,</span> Pri_AgrK <span class="free">y</span><span class="main">}</span> <span class="main">∪</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span>
      analz <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rotate_tac</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Inj<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> analz_idem <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rev_subsetD<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz_mono<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rotate_tac</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rev_subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz_mono<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Auth_Fst <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Inj<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rev_subsetD<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz_mono<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rotate_tac</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Auth_Snd <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Inj<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rev_subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz_mono<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rev_subsetD<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz_mono<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Inj<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-analz_auth_data_in"><span class="command">lemma</span></span> analz_auth_data_in<span class="main">:</span>
 <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="free">H</span> <span class="main">∨</span> Pri_AgrK <span class="free">y</span> <span class="main">∈</span> analz <span class="free">H</span> <span class="main">⟹</span>
    analz <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>analz <span class="main">(</span><span class="main">{</span>Pri_AgrK <span class="free">x</span><span class="main">,</span> Pri_AgrK <span class="free">y</span><span class="main">}</span> <span class="main">∪</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analz_auth_data_in_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analz_auth_data_in_2<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-analz_auth_data_out"><span class="command">lemma</span></span> analz_auth_data_out<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Pri_AgrK <span class="free">x</span> <span class="main">∉</span> analz <span class="free">H</span><span class="main">;</span> Pri_AgrK <span class="free">y</span> <span class="main">∉</span> analz <span class="free">H</span><span class="main">⟧</span> <span class="main">⟹</span>
    analz <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">(</span>Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>analz <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalityI <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ analz_insert<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>4<span class="main"><span class="improper">]</span></span> disjI2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Inj<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Decrypt<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Fst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-analz_crypt_in_1"><span class="command">lemma</span></span> analz_crypt_in_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="free">K</span> <span class="free">X</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="main">(</span>Crypt <span class="free">K</span> <span class="free">X</span><span class="main">)</span> <span class="main">(</span>analz <span class="main">(</span>insert <span class="free">X</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>4<span class="main"><span class="improper">]</span></span> disjI2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Inj<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Inj<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Decrypt<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Fst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-analz_crypt_in_2"><span class="command">lemma</span></span> analz_crypt_in_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="free">K</span><span class="main">)</span> <span class="main">∈</span> analz <span class="free">H</span> <span class="main">⟹</span>
    insert <span class="main">(</span>Crypt <span class="free">K</span> <span class="free">X</span><span class="main">)</span> <span class="main">(</span>analz <span class="main">(</span>insert <span class="free">X</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="free">K</span> <span class="free">X</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Inj<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rotate_tac</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Decrypt <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">K</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Inj<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> rev_subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz_mono<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Inj<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Decrypt<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Fst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-analz_crypt_in"><span class="command">lemma</span></span> analz_crypt_in<span class="main">:</span>
 <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="free">K</span><span class="main">)</span> <span class="main">∈</span> analz <span class="free">H</span> <span class="main">⟹</span>
    analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="free">K</span> <span class="free">X</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">(</span>Crypt <span class="free">K</span> <span class="free">X</span><span class="main">)</span> <span class="main">(</span>analz <span class="main">(</span>insert <span class="free">X</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analz_crypt_in_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analz_crypt_in_2<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-analz_crypt_out"><span class="command">lemma</span></span> analz_crypt_out<span class="main">:</span>
 <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="free">K</span><span class="main">)</span> <span class="main">∉</span> analz <span class="free">H</span> <span class="main">⟹</span>
    analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="free">K</span> <span class="free">X</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">(</span>Crypt <span class="free">K</span> <span class="free">X</span><span class="main">)</span> <span class="main">(</span>analz <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> equalityI <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ analz_insert<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>4<span class="main"><span class="improper">]</span></span> disjI2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Inj<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Decrypt<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Fst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-analz_mpair_1"><span class="command">lemma</span></span> analz_mpair_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="free">H</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="main">(</span>analz <span class="main">(</span><span class="main">{</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">}</span> <span class="main">∪</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>4<span class="main"><span class="improper">]</span></span> disjI2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Inj<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Inj<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Inj<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Decrypt<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Fst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-analz_mpair_2"><span class="command">lemma</span></span> analz_mpair_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"insert <span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="main">(</span>analz <span class="main">(</span><span class="main">{</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">}</span> <span class="main">∪</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> analz <span class="main">(</span>insert <span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Inj<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Fst <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Y</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Inj<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Snd <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">X</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Inj<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> analz.Inj<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Fst<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Snd<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Decrypt<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Fst<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> analz.Auth_Snd<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Propaedeutics-analz_mpair"><span class="command">lemma</span></span> analz_mpair<span class="main">:</span>
 <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="main">(</span>analz <span class="main">(</span><span class="main">{</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">}</span> <span class="main">∪</span> <span class="free">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> equalityI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analz_mpair_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analz_mpair_2<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-synth_simp_intro"><span class="command">lemma</span></span> synth_simp_intro<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> synth <span class="free">H</span> <span class="main">⟹</span>
    <span class="free">X</span> <span class="main">∈</span> range Nonce <span class="main">∪</span>
      range Key <span class="main">∪</span>
      range Passwd <span class="main">∪</span>
      range Pri_AgrK <span class="main">∪</span>
      range Pub_AgrK <span class="main">⟹</span>
  <span class="free">X</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> synth.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="Propaedeutics-synth_auth_data"><span class="command">lemma</span></span> synth_auth_data<span class="main">:</span>
 <span class="quoted"><span class="quoted">"Auth_Data <span class="free">x</span> <span class="free">y</span> <span class="main">∈</span> synth <span class="free">H</span> <span class="main">⟹</span>
    Auth_Data <span class="free">x</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">∨</span> Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">∧</span> Pri_AgrK <span class="free">y</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> synth.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Propaedeutics-synth_crypt"><span class="command">lemma</span></span> synth_crypt<span class="main">:</span>
 <span class="quoted"><span class="quoted">"Crypt <span class="free">K</span> <span class="free">X</span> <span class="main">∈</span> synth <span class="free">H</span> <span class="main">⟹</span> Crypt <span class="free">K</span> <span class="free">X</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">∨</span> <span class="free">X</span> <span class="main">∈</span> synth <span class="free">H</span> <span class="main">∧</span> Key <span class="free">K</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> synth.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Propaedeutics-synth_mpair"><span class="command">lemma</span></span> synth_mpair<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="main">∈</span> synth <span class="free">H</span> <span class="main">⟹</span> <span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">∨</span> <span class="free">X</span> <span class="main">∈</span> synth <span class="free">H</span> <span class="main">∧</span> <span class="free">Y</span> <span class="main">∈</span> synth <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> synth.cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Propaedeutics-synth_analz_fst"><span class="command">lemma</span></span> synth_analz_fst<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="free">H</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">X</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">drule_tac</span> synth_mpair<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> disjE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">drule</span> analz.Fst<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> synth.Inj<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main">)</span>

<span class="keyword1" id="Propaedeutics-synth_analz_snd"><span class="command">lemma</span></span> synth_analz_snd<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">X</span><span class="main">,</span> <span class="free">Y</span><span class="main">⦄</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="free">H</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Y</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="free">H</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">drule_tac</span> synth_mpair<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> disjE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">drule</span> analz.Snd<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> synth.Inj<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Protocol">
<div class="head">
<h1>Theory Protocol</h1>
</div>
<pre class="source"><span class="comment1">(*  Title:       Verification of a Diffie-Hellman Password-based Authentication Protocol by Extending the Inductive Method
    Author:      Pasquale Noce
                 Security Certification Specialist at Arjo Systems, Italy
                 pasquale dot noce dot lavoro at gmail dot com
                 pasquale dot noce at arjosystems dot com
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Protocol modeling and verification"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Protocol
<span class="keyword2"><span class="keyword">imports</span></span> <a href="#Propaedeutics">Propaedeutics</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Protocol modeling"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The protocol under consideration can be formalized by means of the following inductive definition.

\null
›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">protocol</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>event list <span class="main">×</span> state <span class="main">×</span> msg set <span class="main">×</span> msg set<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>

Nil<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> start_S<span class="main">,</span> start_A<span class="main">,</span> start_U<span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span>"</span></span> <span class="main">|</span>

R1<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">evsR1</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span><span class="main">;</span> Pri_AgrK <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≠</span> <span class="main">0</span><span class="main">;</span>
         NonceS <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span>Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="main">1</span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">evsR1</span></span></span><span class="main">,</span>
       <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span><span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span> <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">⦈</span><span class="main">)</span><span class="main">,</span>
       <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∈</span> bad <span class="keyword1">then</span> insert <span class="main">(</span>Pri_AgrK <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span>
       insert <span class="main">(</span>Pri_AgrK <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span>"</span></span> <span class="main">|</span>

FR1<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">evsFR1</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span><span class="main">;</span> User <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">≠</span> Spy<span class="main">;</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≠</span> <span class="main">0</span><span class="main">;</span>
         Crypt <span class="main">(</span>symK <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∪</span> spies <span class="free"><span class="bound"><span class="entity">evsFR1</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span>Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="main">1</span> Spy <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">evsFR1</span></span></span><span class="main">,</span>
       <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span>"</span></span> <span class="main">|</span>

C2<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">evsC2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span><span class="main">;</span> Pri_AgrK <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">;</span>
         NonceS <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">;</span>
         Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="main">1</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="free"><span class="bound"><span class="entity">n'</span></span></span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">evsC2</span></span></span><span class="main">;</span>
         <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> symK <span class="free"><span class="bound"><span class="entity">n'</span></span></span> <span class="main">=</span> symK <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span>Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">2</span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>pubAK <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">evsC2</span></span></span><span class="main">,</span>
       <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span><span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span>
         <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">⦈</span><span class="main">)</span><span class="main">,</span>
       <span class="keyword1">if</span> User <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> Spy <span class="keyword1">then</span> insert <span class="main">(</span>Pri_AgrK <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span>
       insert <span class="main">(</span>Pri_AgrK <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span>"</span></span> <span class="main">|</span>

FC2<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">evsFC2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span><span class="main">;</span>
         Pri_AgrK <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> analz <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∪</span> spies <span class="free"><span class="bound"><span class="entity">evsFC2</span></span></span><span class="main">)</span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span>Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">2</span> Spy <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>pubAK <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">evsFC2</span></span></span><span class="main">,</span>
       <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span>"</span></span> <span class="main">|</span>

R2<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">evsR2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span><span class="main">;</span> Pri_AgrK <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">;</span>
         NonceS <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> None<span class="main">;</span>
         IntMapK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">;</span>
         Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">2</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>pubAK <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">evsR2</span></span></span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span>Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">2</span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">(</span>pubAK <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">evsR2</span></span></span><span class="main">,</span>
       <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span><span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span>
         <span class="main">⦇</span>IntMapK <span class="main">:=</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> ExtMapK <span class="main">:=</span> Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">⦈</span><span class="main">)</span><span class="main">,</span>
       <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> insert <span class="main">(</span>Pri_AgrK <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span>"</span></span> <span class="main">|</span>

FR2<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">evsFR2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span><span class="main">;</span> User <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">≠</span> Spy<span class="main">;</span>
         Pri_AgrK <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∈</span> analz <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∪</span> spies <span class="free"><span class="bound"><span class="entity">evsFR2</span></span></span><span class="main">)</span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span>Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">2</span> Spy <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span>pubAK <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">evsFR2</span></span></span><span class="main">,</span>
       <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span>"</span></span> <span class="main">|</span>

C3<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">evsC3</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span><span class="main">;</span> Pri_AgrK <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">;</span>
         NonceS <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span>
         IntMapK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">;</span>
         ExtMapK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">;</span>
         Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">2</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span>pubAK <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">evsC3</span></span></span><span class="main">;</span>
         <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span>Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">3</span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>pubAK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">evsC3</span></span></span><span class="main">,</span>
       <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span><span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span>
         <span class="main">⦇</span>ExtMapK <span class="main">:=</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> IntAgrK <span class="main">:=</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">⦈</span><span class="main">)</span><span class="main">,</span>
       <span class="keyword1">if</span> User <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> Spy <span class="keyword1">then</span> insert <span class="main">(</span>Pri_AgrK <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span>
       insert <span class="main">(</span>Pri_AgrK <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span>"</span></span> <span class="main">|</span>

FC3<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">evsFC3</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span><span class="main">;</span>
         NonceS <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span>
         IntMapK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">;</span>
         ExtMapK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">;</span>
         <span class="main">{</span>Pri_AgrK <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> Pri_AgrK <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> Pri_AgrK <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">}</span> <span class="main">⊆</span> analz <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∪</span> spies <span class="free"><span class="bound"><span class="entity">evsFC3</span></span></span><span class="main">)</span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span>Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">3</span> Spy <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>pubAK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">evsFC3</span></span></span><span class="main">,</span>
       <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span>"</span></span> <span class="main">|</span>

R3<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">evsR3</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span><span class="main">;</span> Pri_AgrK <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">;</span>
         NonceS <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span>
         IntMapK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">;</span>
         ExtMapK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">;</span>
         IntAgrK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">;</span>
         Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">3</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>pubAK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">evsR3</span></span></span><span class="main">;</span>
         Key <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">;</span>
         Key <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">;</span>
         <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span>Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">3</span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">(</span>pubAK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">evsR3</span></span></span><span class="main">,</span>
       <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span><span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span>
         <span class="main">⦇</span>IntAgrK <span class="main">:=</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span> ExtAgrK <span class="main">:=</span> Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span><span class="main">,</span>
       <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> Pri_AgrK <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∈</span> analz <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∪</span> spies <span class="free"><span class="bound"><span class="entity">evsR3</span></span></span><span class="main">)</span>
         <span class="keyword1">then</span> insert <span class="main">(</span>Key <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span>
       <span class="main">{</span>Pri_AgrK <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">,</span>
         Key <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Key <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
         <span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Agent <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> Number <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> Number <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">⦄</span><span class="main">}</span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span>"</span></span> <span class="main">|</span>

FR3<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">evsFR3</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span><span class="main">;</span> User <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">≠</span> Spy<span class="main">;</span>
         NonceS <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span>
         IntMapK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">;</span>
         ExtMapK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">;</span>
         IntAgrK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span>
         <span class="main">{</span>Pri_AgrK <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> Pri_AgrK <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> Pri_AgrK <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">}</span> <span class="main">⊆</span> analz <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∪</span> spies <span class="free"><span class="bound"><span class="entity">evsFR3</span></span></span><span class="main">)</span><span class="main">;</span>
         Key <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span>Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">3</span> Spy <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span>pubAK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">evsFR3</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span>
       insert <span class="main">(</span>Key <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span>
       <span class="main">{</span>Key <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
         <span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span><span class="main">,</span> Number <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> Number <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">⦄</span><span class="main">}</span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span>"</span></span> <span class="main">|</span>

C4<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">evsC4</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span><span class="main">;</span>
         IntAgrK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span>
         ExtAgrK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">;</span>
         Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">3</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span>pubAK <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">evsC4</span></span></span><span class="main">;</span>
         <span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span><span class="main">,</span> Number <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> Number <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">⦄</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span>Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">4</span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">evsC4</span></span></span><span class="main">,</span>
       <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span><span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span> <span class="main">:=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span> <span class="main">⦇</span>ExtAgrK <span class="main">:=</span> Some <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">⦈</span><span class="main">)</span><span class="main">,</span>
       <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span>"</span></span> <span class="main">|</span>

FC4<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">evsFC4</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span><span class="main">;</span>
         NonceS <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span>
         IntMapK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">;</span>
         ExtMapK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">;</span>
         IntAgrK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">;</span>
         ExtAgrK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">;</span>
         Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∪</span> spies <span class="free"><span class="bound"><span class="entity">evsFC4</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span>Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">4</span> Spy <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>
         <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">evsFC4</span></span></span><span class="main">,</span>
       <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span>"</span></span> <span class="main">|</span>

R4<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">evsR4</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span><span class="main">;</span>
         NonceS <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span>
         IntMapK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">;</span>
         ExtMapK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">;</span>
         IntAgrK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">;</span>
         ExtAgrK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">;</span>
         Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">4</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span>
           <span class="main">(</span>pubAK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">evsR4</span></span></span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span>Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">4</span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span>
         <span class="main">⦃</span>pubAK <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span> Auth_Data <span class="main">(</span>priAK <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> pubAK <span class="main">(</span>priAK <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">,</span>
          Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="main">(</span>priAK <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">evsR4</span></span></span><span class="main">,</span>
       <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span>"</span></span> <span class="main">|</span>

FR4<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">evsFR4</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span><span class="main">;</span> User <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">≠</span> Spy<span class="main">;</span>
         NonceS <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span>
         IntMapK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">;</span>
         ExtMapK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">;</span>
         IntAgrK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span>
         ExtAgrK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span>
         Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span>
           <span class="main">⦃</span>pubAK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> pubAK <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span>
            Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∪</span> spies <span class="free"><span class="bound"><span class="entity">evsFR4</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span>Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">4</span> Spy <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span>
         <span class="main">⦃</span>pubAK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> pubAK <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span>
          Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">evsFR4</span></span></span><span class="main">,</span>
       <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span>"</span></span> <span class="main">|</span>

C5<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">evsC5</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span><span class="main">;</span>
         NonceS <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span>
         IntMapK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">;</span>
         ExtMapK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">;</span>
         IntAgrK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span>
         ExtAgrK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span>
         Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">4</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span>
           <span class="main">⦃</span>pubAK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span> pubAK <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">,</span>
            Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="free"><span class="bound"><span class="entity">g</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span><span class="main">)</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">evsC5</span></span></span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span>Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">5</span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">evsC5</span></span></span><span class="main">,</span>
       <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span>"</span></span> <span class="main">|</span>

FC5<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">evsFC5</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span><span class="main">;</span>
         IntAgrK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">;</span>
         ExtAgrK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">;</span>
         Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∪</span> spies <span class="free"><span class="bound"><span class="entity">evsFC5</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span>Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">5</span> Spy <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">evsFC5</span></span></span><span class="main">,</span>
       <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span>"</span></span> <span class="main">|</span>

R5<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">evsR5</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span><span class="main">;</span>
         IntAgrK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">;</span>
         ExtAgrK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">;</span>
         Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">5</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">evsR5</span></span></span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span>Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">5</span> <span class="main">(</span>Card <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">evsR5</span></span></span><span class="main">,</span>
       <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span>"</span></span> <span class="main">|</span>

FR5<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">evsFR5</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span><span class="main">;</span> User <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">≠</span> Spy<span class="main">;</span>
         IntAgrK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">;</span>
         ExtAgrK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">run</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">;</span>
         Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∪</span> spies <span class="free"><span class="bound"><span class="entity">evsFR5</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">(</span>Says <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">run</span></span></span> <span class="numeral">5</span> Spy <span class="main">(</span>User <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">evsFR5</span></span></span><span class="main">,</span>
       <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">protocol</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
\null

Here below are some comments about the most significant points of this definition.

\begin{itemize}

\item
Rules <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] R1<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] FR1<span class="antiquote"><span class="antiquote">}</span></span></span></span> constrain the values of nonce $s$ to be different
from 0. In this way, the state of affairs where an incorrect PACE authentication key has been used
to encrypt nonce $s$, so that a wrong value results from the decryption, can be modeled in rule
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] C2<span class="antiquote"><span class="antiquote">}</span></span></span></span> by identifying such value with 0.

\item
The spy can disclose session keys as soon as they are established, namely in correspondence with
rules <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] R3<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] FR3<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
\\In the former rule, condition <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">s'</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">s</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> identifies Diffie-Hellman private key <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>c›</span></span></span></span> as
the terminal's ephemeral private key for key agreement, and then $[c \times d \times (s + a \times
b)]G$ as the terminal's value of the shared secret, which the spy can compute by multiplying the
card's ephemeral public key $[d \times (s + a \times b)]G$ by <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>c›</span></span></span></span> provided she knows
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>c›</span></span></span></span>.
\\In the latter rule, the spy is required to know private keys <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>b›</span></span></span></span>, and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>d›</span></span></span></span>
to be able to compute and send public key $[d \times (s + a \times b)]G$. This is the only way to
share with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"User <span class="free"><span class="free">m</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> the same shared secret's value $[c \times d \times (s + a \times b)]G$,
which the spy can compute by multiplying the user's ephemeral public key $[c \times (s + a \times
b)]G$ by <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>d›</span></span></span></span>.

\item
Rules <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] R3<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] FR3<span class="antiquote"><span class="antiquote">}</span></span></span></span> record the user, the communication channel, and the
protocol run associated to the session key having been established by adding this information to the
set of the messages already used. In this way, rule <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] C4<span class="antiquote"><span class="antiquote">}</span></span></span></span> can specify that the session
key computed by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"User <span class="free"><span class="free">m</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is fresh by assuming that a corresponding record be included in set
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>U›</span></span></span></span>. In fact, a simple check that the session key be not included in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>U›</span></span></span></span> would vacuously
fail, as session keys are added to the set of the messages already used in rules <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] R3<span class="antiquote"><span class="antiquote">}</span></span></span></span>
and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] FR3<span class="antiquote"><span class="antiquote">}</span></span></span></span>.

\end{itemize}
›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Secrecy theorems"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This section contains a series of lemmas culminating in the secrecy theorems <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pr_key_secrecy›</span></span></span></span>
and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pr_passwd_secrecy›</span></span></span></span>. Structured Isar proofs are used, possibly preceded by
\emph{apply}-style scripts in case a substantial amount of backward reasoning steps is required at
the beginning.

\null
›</span></span>

<span class="keyword1" id="Protocol-pr_state"><span class="command">lemma</span></span> pr_state<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    <span class="main">(</span>NonceS <span class="main">(</span><span class="free">S</span> <span class="main">(</span><span class="free">X</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None <span class="main">⟶</span> IntMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span><span class="free">X</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span>IntMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span><span class="free">X</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None <span class="main">⟶</span> ExtMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span><span class="free">X</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span>ExtMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span><span class="free">X</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None <span class="main">⟶</span> IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span><span class="free">X</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span>IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span><span class="free">X</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None <span class="main">⟶</span> ExtAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span><span class="free">X</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Protocol-pr_state_1"><span class="command">lemma</span></span> pr_state_1<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol<span class="main">;</span> NonceS <span class="main">(</span><span class="free">S</span> <span class="main">(</span><span class="free">X</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">⟧</span> <span class="main">⟹</span>
    IntMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span><span class="free">X</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_state<span class="main">)</span>

<span class="keyword1" id="Protocol-pr_state_2"><span class="command">lemma</span></span> pr_state_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol<span class="main">;</span> IntMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span><span class="free">X</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">⟧</span> <span class="main">⟹</span>
    ExtMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span><span class="free">X</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_state<span class="main">)</span>

<span class="keyword1" id="Protocol-pr_state_3"><span class="command">lemma</span></span> pr_state_3<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol<span class="main">;</span> ExtMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span><span class="free">X</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">⟧</span> <span class="main">⟹</span>
    IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span><span class="free">X</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_state<span class="main">)</span>

<span class="keyword1" id="Protocol-pr_state_4"><span class="command">lemma</span></span> pr_state_4<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol<span class="main">;</span> IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span><span class="free">X</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None<span class="main">⟧</span> <span class="main">⟹</span>
    ExtAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span><span class="free">X</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_state<span class="main">)</span>

<span class="keyword1" id="Protocol-pr_analz_used"><span class="command">lemma</span></span> pr_analz_used<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Protocol-pr_key_parts_intro"><span class="command">lemma</span></span> pr_key_parts_intro <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    Key <span class="free">K</span> <span class="main">∈</span> parts <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span> <span class="main">⟶</span>
  Key <span class="free">K</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> parts_simp<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> parts_simp_insert parts_auth_data parts_crypt parts_mpair<span class="main">)</span>

<span class="keyword1" id="Protocol-pr_key_analz"><span class="command">lemma</span></span> pr_key_analz<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span> <span class="main">(</span>Key <span class="free">K</span> <span class="main">∈</span> analz <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Key <span class="free">K</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> pr_key_parts_intro<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_subset<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Protocol-pr_symk_used"><span class="command">lemma</span></span> pr_symk_used<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span> Key <span class="main">(</span>symK <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Protocol-pr_symk_analz"><span class="command">lemma</span></span> pr_symk_analz<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span> <span class="main">(</span>Key <span class="main">(</span>symK <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">n</span> <span class="main">∈</span> bad<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_key_analz<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> iffI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main">-</span>4<span class="main"><span class="improper">]</span></span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>symK <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> Key <span class="main">`</span> symK <span class="main">`</span> bad"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="main">∈</span> bad<span class="main">.</span> symK <span class="free">n</span> <span class="main">=</span> symK <span class="bound">m</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> bad"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"symK <span class="free">n</span> <span class="main">=</span> symK <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> bad"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> symK_bad<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>symK <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> Key <span class="main">`</span> range pubSK"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> bad"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> notE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> pubSK_symK<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>symK <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> pubAK <span class="main">`</span> range priAK"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> bad"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>symK <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_symk_used<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"symK <span class="free">n</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> bad"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>symK <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_symk_used<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"symK <span class="free">n</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> bad"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_sesk_card"><span class="command">lemma</span></span> pr_sesk_card <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span> <span class="main">⟶</span>
    ExtAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">e</span> <span class="main">⟶</span>
  Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mult.commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> mult.assoc<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Protocol-pr_sesk_user_1"><span class="command">lemma</span></span> pr_sesk_user_1 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">c</span> <span class="main">⟶</span>
    ExtAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">f</span> <span class="main">⟶</span>
  <span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="free">m</span><span class="main">)</span><span class="main">,</span> Number <span class="free">n</span><span class="main">,</span> Number <span class="free">run</span><span class="main">⦄</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">run</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_3<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_4<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span><span class="main">,</span> Number <span class="skolem">n</span><span class="main">,</span> Number <span class="skolem">run</span><span class="main">⦄</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_sesk_user_2"><span class="command">lemma</span></span> pr_sesk_user_2 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    <span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="free">m</span><span class="main">)</span><span class="main">,</span> Number <span class="free">n</span><span class="main">,</span> Number <span class="free">run</span><span class="main">⦄</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">⟶</span>
  Key <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Protocol-pr_auth_key_used"><span class="command">lemma</span></span> pr_auth_key_used<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span> Pri_AgrK <span class="main">(</span>priAK <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Protocol-pr_int_mapk_used"><span class="command">lemma</span></span> pr_int_mapk_used <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    IntMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span> <span class="main">⟶</span>
  Pri_AgrK <span class="free">b</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Protocol-pr_valid_key_analz"><span class="command">lemma</span></span> pr_valid_key_analz<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span> Key <span class="main">(</span>pubSK <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_key_analz<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Protocol-pr_pri_agrk_parts"><span class="command">lemma</span></span> pr_pri_agrk_parts <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    Pri_AgrK <span class="free">x</span> <span class="main">∉</span> <span class="free">U</span> <span class="main">⟶</span>
  Pri_AgrK <span class="free">x</span> <span class="main">∉</span> parts <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> protocol.induct<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> parts_simp_insert parts_auth_data parts_crypt parts_mpair<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">subst</span> parts_simp<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR1</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m</span> <span class="skolem">s</span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> Pri_AgrK <span class="bound">x</span> <span class="main">∉</span> <span class="skolem">U</span> <span class="main">⟶</span> Pri_AgrK <span class="bound">x</span> <span class="main">∉</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">x</span> <span class="main">∉</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span> <span class="main">∨</span>
      Pri_AgrK <span class="skolem">x</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      Key <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">∨</span> <span class="var">?Q</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">x</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Body<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">x</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">x</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_simp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">x</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR4</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">b</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR4</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> priAK <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> notI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> priAK <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_auth_key_used<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_int_mapk_used<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR4</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> Pri_AgrK <span class="bound">x</span> <span class="main">∉</span> <span class="skolem">U</span> <span class="main">⟶</span> Pri_AgrK <span class="bound">x</span> <span class="main">∉</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR4</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>
      <span class="main">⦃</span>pubAK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span>
       Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">_</span> <span class="var">?M</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">g</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span>
        <span class="var">?M</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span> Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Body<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>
          <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Snd<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Fst<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Auth_Snd<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Auth_Fst<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> parts <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span>
          Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>
          <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_snd<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_fst<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span>
          Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_auth_data<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Auth_Snd<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Auth_Fst<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> parts <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> parts <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> parts <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> parts <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> contrapos_pp<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> A<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> contrapos_pp<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> A<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> notI<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
       <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
       <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_pri_agrk_items"><span class="command">lemma</span></span> pr_pri_agrk_items<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    Pri_AgrK <span class="free">x</span> <span class="main">∉</span> <span class="free">U</span> <span class="main">⟹</span>
  items <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    insert <span class="main">(</span>Pri_AgrK <span class="free">x</span><span class="main">)</span> <span class="main">(</span>items <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> items_pri_agrk_out<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> pr_pri_agrk_parts<span class="main">)</span>

<span class="keyword1" id="Protocol-pr_auth_data_items"><span class="command">lemma</span></span> pr_auth_data_items<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
  Pri_AgrK <span class="main">(</span>priAK <span class="free">n</span><span class="main">)</span> <span class="main">∉</span> items <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span>IntMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span> <span class="main">⟶</span>
    Pri_AgrK <span class="free">b</span> <span class="main">∉</span> items <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quoted"><span class="free">run</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> protocol.induct<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> items_simp_insert_2 items_crypt items_mpair pr_pri_agrk_items<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">subst</span> items_simp<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR1</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">s</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR1</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n'</span> <span class="main">∧</span> <span class="skolem">run</span> <span class="main">=</span> <span class="skolem">run'</span> <span class="main">⟶</span>
      priAK <span class="skolem">n'</span> <span class="main">≠</span> <span class="skolem">s</span> <span class="main">∧</span> <span class="main">(</span>IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span> <span class="main">⟶</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">(</span><span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n'</span> <span class="main">⟶</span> <span class="skolem">run</span> <span class="main">≠</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">⟶</span>
      priAK <span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">s</span> <span class="main">∧</span> <span class="main">(</span>IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span> <span class="main">⟶</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span>
   <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>4<span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> notI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_auth_key_used<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"priAK <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_int_mapk_used<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_auth_key_used<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"priAK <span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_int_mapk_used<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR1</span> <span class="skolem">A</span> <span class="skolem">m</span> <span class="skolem">s</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">b</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">run</span> <span class="bound">b</span><span class="main">.</span> Pri_AgrK <span class="main">(</span>priAK <span class="bound">n</span><span class="main">)</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span>IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">n</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span> <span class="main">⟶</span>
      Pri_AgrK <span class="bound">b</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span> <span class="main">∨</span>
    Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    Key <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">∨</span> <span class="var">?Q</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="main">∈</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_items_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> items.Body<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_simp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_items_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="main">∉</span> items <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span>IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span> <span class="main">⟶</span>
      Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> items <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> items_simp_insert_1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B<span class="main"><span class="main">]</span></span> A<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">a</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">b</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC2</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> priAK <span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="main">(</span>IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span> <span class="main">⟶</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> notI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_auth_key_used<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"priAK <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_int_mapk_used<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">b'</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">b</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">n</span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">run</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR2</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b'</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n'</span> <span class="main">∧</span> <span class="skolem">run</span> <span class="main">=</span> <span class="skolem">run'</span> <span class="main">⟶</span> <span class="skolem">b'</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">⟶</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> contra_subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> items_parts_subset<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> pr_pri_agrk_parts <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A B<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">b</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">c</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> priAK <span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">c</span> <span class="main">∧</span> <span class="main">(</span>IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span> <span class="main">⟶</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> notI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_auth_key_used<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"priAK <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">c</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_int_mapk_used<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">c</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">A</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">s</span> <span class="skolem">b'</span> <span class="skolem">c</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">b</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">s'</span> <span class="main">::</span> <span class="quoted">pri_agrk</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">run</span> <span class="bound">b</span><span class="main">.</span> Pri_AgrK <span class="main">(</span>priAK <span class="bound">n</span><span class="main">)</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span>IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">n</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span> <span class="main">⟶</span>
        Pri_AgrK <span class="bound">b</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b'</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">c</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span> <span class="main">⟶</span>
       <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n'</span> <span class="main">∧</span> <span class="skolem">run</span> <span class="main">=</span> <span class="skolem">run'</span> <span class="main">⟶</span> <span class="skolem">b'</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">⟶</span>
     Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">(</span><span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">⟶</span> Pri_AgrK <span class="skolem">c</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
       <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n'</span> <span class="main">∧</span> <span class="skolem">run</span> <span class="main">=</span> <span class="skolem">run'</span> <span class="main">⟶</span> <span class="skolem">b'</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">⟶</span>
     Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span>IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b'</span> <span class="main">⟶</span>
        Pri_AgrK <span class="skolem">b'</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b'</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span>IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b'</span> <span class="main">⟶</span>
        Pri_AgrK <span class="skolem">b'</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b'</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR4</span> <span class="skolem">A</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">b'</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">b</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>pubAK <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">run</span> <span class="bound">b</span><span class="main">.</span> Pri_AgrK <span class="main">(</span>priAK <span class="bound">n</span><span class="main">)</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR4</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span>IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">n</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span> <span class="main">⟶</span>
        Pri_AgrK <span class="bound">b</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR4</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b'</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="main">∉</span> items <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">b'</span><span class="main">)</span>
      <span class="main">(</span>insert <span class="var">?M</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span>IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span> <span class="main">⟶</span>
      Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> items <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">b'</span><span class="main">)</span>
        <span class="main">(</span>insert <span class="var">?M</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> items_mpair<span class="main"><span class="keyword3">,</span></span>
   <span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 3<span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> items_simp_insert_2<span class="main"><span class="keyword3">,</span></span>
   <span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> items_crypt items_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR4</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span>IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b'</span> <span class="main">⟶</span>
        Pri_AgrK <span class="skolem">b'</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR4</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR4</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b'</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR4</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span>
     <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="main">∉</span> items <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">b'</span><span class="main">)</span>
        <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR4</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span>IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span> <span class="main">⟶</span>
        Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> items <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">b'</span><span class="main">)</span>
          <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> items_auth_data_out A<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR4</span> <span class="skolem">A</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b'</span> <span class="skolem">c</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">b</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>pubAK <span class="skolem">g</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">run</span> <span class="bound">b</span><span class="main">.</span> Pri_AgrK <span class="main">(</span>priAK <span class="bound">n</span><span class="main">)</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span>IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">n</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span> <span class="main">⟶</span>
        Pri_AgrK <span class="bound">b</span> <span class="main">∉</span> items <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">⦃</span>pubAK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span><span class="main">,</span> <span class="var">?M</span><span class="main">⦄</span>
      <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">_</span> <span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b'</span> <span class="main">∈</span> items <span class="var">?A</span> <span class="main">∨</span> Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> items <span class="var">?A</span> <span class="main">⟶</span>
    Pri_AgrK <span class="skolem">b'</span> <span class="main">∈</span> items <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> items <span class="var">?A</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">⟶</span> <span class="var">?Q</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span>
      <span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span> Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span> <span class="main">∈</span> items <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_items_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> items <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> items.Body<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>
        <span class="main">∈</span> items <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> items.Snd<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span> <span class="main">∈</span> items <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> items.Fst<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b'</span> <span class="main">∈</span> items <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> items <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> items.Auth_Fst <span class="main"><span class="main">[</span></span><span class="operator">OF</span> D<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> items <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b'</span> <span class="main">∈</span> items <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> items.Auth_Snd <span class="main"><span class="main">[</span></span><span class="operator">OF</span> D<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span> Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>
        <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_snd<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_fst<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span>
        Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">b'</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_auth_data<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span> <span class="main">∈</span> items <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_items_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b'</span> <span class="main">∈</span> items <span class="var">?A</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> items <span class="var">?A</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> items.Auth_Fst <span class="main"><span class="main">[</span></span><span class="operator">OF</span> D<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> items <span class="var">?A</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b'</span> <span class="main">∈</span> items <span class="var">?A</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> items.Auth_Snd <span class="main"><span class="main">[</span></span><span class="operator">OF</span> D<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">b'</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b'</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b'</span> <span class="main">∈</span> items <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_items_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>     
         <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> items <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_items_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="main">∉</span> items <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span><span class="main">)</span>
      <span class="main">(</span>insert <span class="var">?M</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span>IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span> <span class="main">⟶</span>
      Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> items <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span><span class="main">)</span>
        <span class="main">(</span>insert <span class="var">?M</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> items_mpair<span class="main"><span class="keyword3">,</span></span>
   <span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 3<span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> items_simp_insert_2<span class="main"><span class="keyword3">,</span></span>
   <span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> items_crypt items_simp_insert_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> C <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span>
     <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="main">∉</span> items <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span><span class="main">)</span>
        <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span>IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span> <span class="main">⟶</span>
        Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> items <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span><span class="main">)</span>
          <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> items_auth_data_in items_simp_insert_1 A<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span>
     <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="main">∉</span> items <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span><span class="main">)</span>
        <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span>IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span> <span class="main">⟶</span>
        Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> items <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span><span class="main">)</span>
          <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> items_auth_data_out A<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_auth_key_analz"><span class="command">lemma</span></span> pr_auth_key_analz<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span> Pri_AgrK <span class="main">(</span>priAK <span class="free">n</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> contra_subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_items_subset<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> pr_auth_data_items<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span>

<span class="keyword1" id="Protocol-pr_int_mapk_analz"><span class="command">lemma</span></span> pr_int_mapk_analz<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    IntMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span> <span class="main">⟹</span>
  Pri_AgrK <span class="free">b</span> <span class="main">∉</span> analz <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> contra_subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_items_subset<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> pr_auth_data_items<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> mp<span class="main">)</span>

<span class="keyword1" id="Protocol-pr_key_set_unused"><span class="command">lemma</span></span> pr_key_set_unused <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    <span class="free">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="free">U</span> <span class="main">⟶</span>
  analz <span class="main">(</span><span class="free">H</span> <span class="main">∪</span> <span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span> <span class="main">=</span> <span class="free">H</span> <span class="main">∪</span> analz <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">H</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_simp_insert_2<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">subst</span> analz_simp<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR1</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">s</span> <span class="skolem">H</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">H</span><span class="main">.</span> <span class="bound">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
      analz <span class="main">(</span><span class="bound">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span><span class="main">)</span> <span class="main">=</span> <span class="bound">H</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR1</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span> <span class="main">∈</span> bad <span class="main">⟶</span>
       <span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="skolem">U</span> <span class="main">⟶</span>
     analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
     <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="skolem">n</span> <span class="main">∉</span> bad <span class="main">⟶</span>
       <span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="skolem">U</span> <span class="main">⟶</span>
     analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
     <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span> <span class="main">⟶</span> <span class="main">_</span> <span class="main">⟶</span> <span class="var">?T</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">_</span> <span class="main">⟶</span> <span class="main">_</span> <span class="main">⟶</span> <span class="var">?T'</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>Pri_AgrK <span class="skolem">s</span><span class="main">}</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span><span class="main">{</span>Pri_AgrK <span class="skolem">s</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">{</span>Pri_AgrK <span class="skolem">s</span><span class="main">}</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span> <span class="main">=</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
      <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> bad"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_symk_analz invK_symK<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ E<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analz_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ E<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analz_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="var">?B</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> bad"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="var">?C</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_symk_analz invK_symK<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invK_symK<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> pr_symk_used <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> D<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?B</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T'</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR1</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m</span> <span class="skolem">s</span> <span class="skolem">H</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">H</span><span class="main">.</span> <span class="bound">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
      analz <span class="main">(</span><span class="bound">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span> <span class="main">=</span> <span class="bound">H</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR1</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
    analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
    <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟶</span> <span class="var">?T</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"analz <span class="var">?B</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">insert</span> synth_crypt <span class="main"><span class="main">[</span></span><span class="operator">OF</span> C<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Decrypt<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_simp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> analz <span class="var">?B</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_subsetD<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> analz_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
      <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_simp_insert_1<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?B</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ True<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analz_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="var">?B</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invK_symK<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> pr_symk_used <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">m</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> D<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?B</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">a</span> <span class="skolem">H</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">H</span><span class="main">.</span> <span class="bound">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
      analz <span class="main">(</span><span class="bound">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span> <span class="main">=</span> <span class="bound">H</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span>
       <span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> insert <span class="main">(</span>Pri_AgrK <span class="skolem">a</span><span class="main">)</span> <span class="skolem">U</span> <span class="main">⟶</span>
     insert <span class="main">(</span>pubAK <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">a</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
     insert <span class="main">(</span>pubAK <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">a</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">m</span> <span class="main">⟶</span>
       <span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> insert <span class="main">(</span>Pri_AgrK <span class="skolem">a</span><span class="main">)</span> <span class="skolem">U</span> <span class="main">⟶</span>
     insert <span class="main">(</span>pubAK <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
     insert <span class="main">(</span>pubAK <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span> <span class="main">⟶</span> <span class="main">_</span> <span class="main">⟶</span> <span class="var">?T</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">_</span> <span class="main">⟶</span> <span class="main">_</span> <span class="main">⟶</span> <span class="var">?T'</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> insert <span class="main">(</span>Pri_AgrK <span class="skolem">a</span><span class="main">)</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span>Pri_AgrK <span class="skolem">a</span><span class="main">)</span> <span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">a</span><span class="main">)</span> <span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Pri_AgrK <span class="skolem">a</span><span class="main">)</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">a</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> insert <span class="main">(</span>Pri_AgrK <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>Pri_AgrK <span class="skolem">a</span><span class="main">}</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span><span class="main">{</span>Pri_AgrK <span class="skolem">a</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">{</span>Pri_AgrK <span class="skolem">a</span><span class="main">}</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span>Pri_AgrK <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span> <span class="main">=</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">a</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">a</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
      <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">a</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> insert <span class="main">(</span>Pri_AgrK <span class="skolem">a</span><span class="main">)</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"analz <span class="var">?B</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?T'</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">b</span> <span class="skolem">H</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">H</span><span class="main">.</span> <span class="bound">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
    analz <span class="main">(</span><span class="bound">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR2</span><span class="main">)</span> <span class="main">=</span> <span class="bound">H</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR2</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> insert <span class="main">(</span>Pri_AgrK <span class="skolem">b</span><span class="main">)</span> <span class="skolem">U</span> <span class="main">⟶</span>
    insert <span class="main">(</span>pubAK <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?B</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">(</span>pubAK <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟶</span> <span class="var">?T</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> insert <span class="main">(</span>Pri_AgrK <span class="skolem">b</span><span class="main">)</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"analz <span class="var">?B</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">H</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">H</span><span class="main">.</span> <span class="bound">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
      analz <span class="main">(</span><span class="bound">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC3</span><span class="main">)</span> <span class="main">=</span> <span class="bound">H</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC3</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">c</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC3</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span>
       <span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> insert <span class="main">(</span>Pri_AgrK <span class="skolem">c</span><span class="main">)</span> <span class="skolem">U</span> <span class="main">⟶</span>
     insert <span class="main">(</span>pubAK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">c</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
     insert <span class="main">(</span>pubAK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">c</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">m</span> <span class="main">⟶</span>
       <span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> insert <span class="main">(</span>Pri_AgrK <span class="skolem">c</span><span class="main">)</span> <span class="skolem">U</span> <span class="main">⟶</span>
     insert <span class="main">(</span>pubAK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
     insert <span class="main">(</span>pubAK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span> <span class="main">⟶</span> <span class="main">_</span> <span class="main">⟶</span> <span class="var">?T</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">_</span> <span class="main">⟶</span> <span class="main">_</span> <span class="main">⟶</span> <span class="var">?T'</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> insert <span class="main">(</span>Pri_AgrK <span class="skolem">c</span><span class="main">)</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span>Pri_AgrK <span class="skolem">c</span><span class="main">)</span> <span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">c</span><span class="main">)</span> <span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC3</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Pri_AgrK <span class="skolem">c</span><span class="main">)</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">c</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> insert <span class="main">(</span>Pri_AgrK <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>Pri_AgrK <span class="skolem">c</span><span class="main">}</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span><span class="main">{</span>Pri_AgrK <span class="skolem">c</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC3</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">{</span>Pri_AgrK <span class="skolem">c</span><span class="main">}</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span>Pri_AgrK <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span> <span class="main">=</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">c</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">c</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
      <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">c</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> insert <span class="main">(</span>Pri_AgrK <span class="skolem">c</span><span class="main">)</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"analz <span class="var">?B</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?T'</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">X</span> <span class="skolem">H</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">H</span><span class="main">.</span> <span class="bound">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
      analz <span class="main">(</span><span class="bound">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span> <span class="main">=</span> <span class="bound">H</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Key <span class="var">?K</span> <span class="main">∉</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?K'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">c</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span> <span class="main">⟶</span>
       <span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> insert <span class="main">(</span>Pri_AgrK <span class="skolem">d</span><span class="main">)</span>
         <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">⦃</span>Key <span class="var">?K</span><span class="main">,</span> Agent <span class="skolem">X</span><span class="main">,</span> Number <span class="skolem">n</span><span class="main">,</span> Number <span class="skolem">run</span><span class="main">⦄</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
     insert <span class="main">(</span>pubAK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>analz <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
     insert <span class="main">(</span>pubAK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">(</span><span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">⟶</span> Pri_AgrK <span class="skolem">c</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
       <span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> insert <span class="main">(</span>Pri_AgrK <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K'</span><span class="main">)</span>
         <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">⦃</span>Key <span class="var">?K</span><span class="main">,</span> Agent <span class="skolem">X</span><span class="main">,</span> Number <span class="skolem">n</span><span class="main">,</span> Number <span class="skolem">run</span><span class="main">⦄</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
     insert <span class="main">(</span>pubAK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
     insert <span class="main">(</span>pubAK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span> <span class="main">⟶</span> <span class="main">_</span> <span class="main">⟶</span> <span class="var">?T</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">_</span> <span class="main">⟶</span> <span class="main">_</span> <span class="main">⟶</span> <span class="var">?T'</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> insert <span class="main">(</span>Pri_AgrK <span class="skolem">d</span><span class="main">)</span>
      <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">⦃</span>Key <span class="var">?K</span><span class="main">,</span> Agent <span class="skolem">X</span><span class="main">,</span> Number <span class="skolem">n</span><span class="main">,</span> Number <span class="skolem">run</span><span class="main">⦄</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>Key <span class="var">?K</span><span class="main">}</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span><span class="main">{</span>Key <span class="var">?K</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">{</span>Key <span class="var">?K</span><span class="main">}</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span> <span class="main">=</span> analz <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> insert <span class="main">(</span>Pri_AgrK <span class="skolem">d</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K'</span><span class="main">)</span>
      <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">⦃</span>Key <span class="var">?K</span><span class="main">,</span> Agent <span class="skolem">X</span><span class="main">,</span> Number <span class="skolem">n</span><span class="main">,</span> Number <span class="skolem">run</span><span class="main">⦄</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"analz <span class="var">?B</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?T'</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">H</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">H</span><span class="main">.</span> <span class="bound">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
      analz <span class="main">(</span><span class="bound">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR3</span><span class="main">)</span> <span class="main">=</span> <span class="bound">H</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR3</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Key <span class="var">?K</span> <span class="main">∉</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR3</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span>
      <span class="main">(</span>insert <span class="main">⦃</span>Key <span class="var">?K</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span><span class="main">,</span> Number <span class="skolem">n</span><span class="main">,</span> Number <span class="skolem">run</span><span class="main">⦄</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">⟶</span>
    insert <span class="main">(</span>pubAK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>analz <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    insert <span class="main">(</span>pubAK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟶</span> <span class="var">?T</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span>
      <span class="main">(</span>insert <span class="main">⦃</span>Key <span class="var">?K</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span><span class="main">,</span> Number <span class="skolem">n</span><span class="main">,</span> Number <span class="skolem">run</span><span class="main">⦄</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR3</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>Key <span class="var">?K</span><span class="main">}</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span><span class="main">{</span>Key <span class="var">?K</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR3</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">{</span>Key <span class="var">?K</span><span class="main">}</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span> <span class="main">=</span> analz <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC4</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">c</span> <span class="skolem">f</span> <span class="skolem">H</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">H</span><span class="main">.</span> <span class="bound">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
      analz <span class="main">(</span><span class="bound">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC4</span><span class="main">)</span> <span class="main">=</span> <span class="bound">H</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC4</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC4</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span><span class="main">,</span> Number <span class="skolem">n</span><span class="main">,</span> Number <span class="skolem">run</span><span class="main">⦄</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC4</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC4</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
    analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
    <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟶</span> <span class="var">?T</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="var">?B</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?B</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ True<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analz_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>pubAK <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?B</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>pubAK <span class="skolem">f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="var">?B</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invK_sesK<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> pr_sesk_user_2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B C<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> D<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?B</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFC4</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">H</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">H</span><span class="main">.</span> <span class="bound">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
      analz <span class="main">(</span><span class="bound">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC4</span><span class="main">)</span> <span class="main">=</span> <span class="bound">H</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC4</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFC4</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">e</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC4</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC4</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
    analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="var">?f</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
    <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="var">?f</span><span class="main">)</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟶</span> <span class="var">?T</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="var">?B</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?B</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ True<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analz_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="var">?f</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="var">?f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>pubAK <span class="var">?f</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?B</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="var">?f</span><span class="main">)</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="var">?f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>pubAK <span class="var">?f</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="var">?B</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invK_sesK<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> pr_sesk_card <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B C D<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> E<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="var">?f</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="var">?f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?B</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="var">?f</span><span class="main">)</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="var">?f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR4</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">b</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">H</span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR4</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR4</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?H</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Hash <span class="main">(</span>pubAK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>pubAK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?M'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>pubAK <span class="skolem">e</span><span class="main">,</span> Auth_Data <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span><span class="main">,</span>
      Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">H</span><span class="main">.</span> <span class="bound">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
      analz <span class="main">(</span><span class="bound">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR4</span><span class="main">)</span> <span class="main">=</span> <span class="bound">H</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR4</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR4</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">e</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
    analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
    <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟶</span> <span class="var">?T</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="var">?B</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>pubSK CA<span class="main">)</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_valid_key_analz<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">{</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">,</span> <span class="var">?H</span><span class="main">}</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>pubSK CA<span class="main">)</span> <span class="main">∈</span> analz <span class="var">?B</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ H<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analz_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">{</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">,</span> <span class="var">?H</span><span class="main">}</span> <span class="main">∪</span> analz <span class="var">?B</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="main">∉</span> analz <span class="var">?C</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_auth_key_analz<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> analz <span class="var">?C</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_int_mapk_analz<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_auth_key_used<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">H</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> O<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> G <span class="keyword2"><span class="keyword">and</span></span> J <span class="keyword2"><span class="keyword">and</span></span> K <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_int_mapk_used<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> <span class="skolem">H</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> G <span class="keyword2"><span class="keyword">and</span></span> J <span class="keyword2"><span class="keyword">and</span></span> M <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?B</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ True<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analz_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_mpair analz_simp_insert_2 True Q<span class="main"><span class="keyword3">,</span></span>
       <span class="operator">rule</span> equalityI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> insert_mono<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>insert <span class="var">?M</span> <span class="var">?B</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span>
          <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>insert <span class="var">?M</span> <span class="var">?C</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_mpair analz_simp_insert_2
         <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_insert_right<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 3<span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span>
         <span class="operator">subst</span> analz_auth_data_out <span class="main"><span class="main">[</span></span><span class="operator">OF</span> O P<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> analz_auth_data_out <span class="main"><span class="main">[</span></span><span class="operator">OF</span> L N<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G I J<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>insert <span class="var">?M</span> <span class="var">?C</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span>
          analz <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>insert <span class="var">?M</span> <span class="var">?B</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_mpair analz_simp_insert_2
         <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_insert_right Un_subset_iff semilattice_sup_class.sup.bounded_iff<span class="main"><span class="keyword3">,</span></span>
         <span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 3<span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> analz_auth_data_out <span class="main"><span class="main">[</span></span><span class="operator">OF</span> L N<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
         <span class="operator">subst</span> analz_auth_data_out <span class="main"><span class="main">[</span></span><span class="operator">OF</span> O P<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G I J<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invK_sesK G<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> pr_sesk_card <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B D E<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> F<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
        insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?B</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span> <span class="main">=</span>
        insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
       <span class="keyword1"><span class="command">using</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR4</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">H</span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?H</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>pubAK <span class="skolem">g</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?M'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>pubAK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span>
      Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">H</span><span class="main">.</span> <span class="bound">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
      analz <span class="main">(</span><span class="bound">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span><span class="main">)</span> <span class="main">=</span> <span class="bound">H</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR4</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span>
   <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?C</span> <span class="main">⟶</span>
      Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?C</span> <span class="main">∨</span> Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?C</span> <span class="main">⟶</span>
    Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?C</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">⟶</span> <span class="var">?Q</span> <span class="main">⟶</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span> <span class="main">∈</span> analz <span class="var">?C</span> <span class="main">∨</span>
      <span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span> <span class="main">∧</span> Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Decrypt<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>
        <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Snd<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Fst<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Auth_Fst <span class="main"><span class="main">[</span></span><span class="operator">OF</span> G<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Auth_Snd <span class="main"><span class="main">[</span></span><span class="operator">OF</span> G<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span> <span class="main">∧</span> Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>
        <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_snd<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_fst<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?C</span> <span class="main">∨</span>
        Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?C</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_auth_data<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Auth_Fst <span class="main"><span class="main">[</span></span><span class="operator">OF</span> G<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Auth_Snd <span class="main"><span class="main">[</span></span><span class="operator">OF</span> G<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?C</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
    analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
    <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟶</span> <span class="var">?T</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="var">?B</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>pubSK CA<span class="main">)</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_valid_key_analz<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">{</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">,</span> <span class="var">?H</span><span class="main">}</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>pubSK CA<span class="main">)</span> <span class="main">∈</span> analz <span class="var">?B</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ I<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analz_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">{</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">,</span> <span class="var">?H</span><span class="main">}</span> <span class="main">∪</span> analz <span class="var">?B</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
     <span class="operator">cases</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?C</span> <span class="main">∨</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?B</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ L<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analz_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?C</span> <span class="main">∨</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> O<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span> <span class="main">∨</span>
        Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?B</span> <span class="main">∨</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?B</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> H <span class="keyword2"><span class="keyword">and</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">∨</span>
        Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?C</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword2"><span class="keyword">and</span></span> L <span class="keyword2"><span class="keyword">and</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">b</span><span class="main">)</span>
        <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_subsetD<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> analz_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> J <span class="keyword2"><span class="keyword">and</span></span> Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?B</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?B</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> H <span class="keyword2"><span class="keyword">and</span></span> Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">b</span><span class="main">)</span>
        <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_subsetD<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> analz_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> K <span class="keyword2"><span class="keyword">and</span></span> T <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_mpair analz_simp_insert_2 L M<span class="main"><span class="keyword3">,</span></span>
       <span class="operator">rule</span> equalityI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> insert_mono<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>insert <span class="var">?M</span> <span class="var">?B</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span>
          <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>insert <span class="var">?M</span> <span class="var">?C</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_mpair analz_simp_insert_2
         <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_insert_right<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 3<span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span>
         <span class="operator">subst</span> analz_auth_data_in <span class="main"><span class="main">[</span></span><span class="operator">OF</span> P<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> analz_auth_data_in <span class="main"><span class="main">[</span></span><span class="operator">OF</span> O<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
         <span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_insert_right<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span>
           <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">b</span><span class="main">)</span>
              <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span>
            <span class="skolem">H</span> <span class="main">∪</span> insert <span class="var">?M</span> <span class="main">(</span>insert <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">)</span>
              <span class="main">(</span>analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">b</span><span class="main">)</span>
                <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> analz_simp_insert_1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> U<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> analz_simp_insert_1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> V<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
           <span class="operator">subst</span> analz_simp_insert_1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> R<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> analz_simp_insert_1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> S<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H J K<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>insert <span class="var">?M</span> <span class="var">?C</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span>
          analz <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>insert <span class="var">?M</span> <span class="var">?B</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_mpair analz_simp_insert_2
         <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_insert_right Un_subset_iff semilattice_sup_class.sup.bounded_iff<span class="main"><span class="keyword3">,</span></span>
         <span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2 4<span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> analz_auth_data_in <span class="main"><span class="main">[</span></span><span class="operator">OF</span> O<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
         <span class="operator">subst</span> analz_auth_data_in <span class="main"><span class="main">[</span></span><span class="operator">OF</span> P<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Un_insert_left Un_empty_left<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span>
           <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> insert <span class="var">?M</span> <span class="main">(</span>insert <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">)</span>
              <span class="main">(</span>analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">b</span><span class="main">)</span>
                <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span>
            insert <span class="var">?M</span> <span class="main">(</span>insert <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">)</span>
              <span class="main">(</span>analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">b</span><span class="main">)</span>
                <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> analz_simp_insert_1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> R<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> analz_simp_insert_1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> S<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
           <span class="operator">subst</span> analz_simp_insert_1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> U<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> analz_simp_insert_1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> V<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H J K<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?B</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ L<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analz_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∉</span> analz <span class="var">?C</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> analz <span class="var">?C</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> O<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> J <span class="keyword2"><span class="keyword">and</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span> <span class="main">∈</span> analz <span class="var">?C</span> <span class="main">∨</span>
          <span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span> <span class="main">∧</span> Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span> <span class="main">∈</span> parts <span class="var">?C</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> parts <span class="var">?C</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Body<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>
            <span class="main">∈</span> parts <span class="var">?C</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Snd<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> parts <span class="var">?C</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Fst<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> parts <span class="var">?C</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Auth_Fst<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> contrapos_pp<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> pr_pri_agrk_parts <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> parts <span class="var">?C</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> R <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Auth_Snd<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> contrapos_pp<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> pr_pri_agrk_parts <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span> <span class="main">∧</span>
            Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span>
            Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_snd<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?C</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_fst<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?C</span> <span class="main">∨</span>
            Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?C</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_auth_data<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> parts <span class="var">?C</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> parts <span class="var">?C</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Auth_Fst<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> contrapos_pp<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> pr_pri_agrk_parts <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> parts <span class="var">?C</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> R <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Auth_Snd<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> contrapos_pp<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> pr_pri_agrk_parts <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
            <span class="keyword3"><span class="command">assume</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?C</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> parts <span class="var">?C</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> contrapos_pp<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> pr_pri_agrk_parts <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> R <span class="keyword1"><span class="command">..</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> parts <span class="var">?C</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> contrapos_pp<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> pr_pri_agrk_parts <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∉</span> analz <span class="var">?B</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> analz <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H N<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> G<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Q<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> K <span class="keyword2"><span class="keyword">and</span></span> R <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_mpair analz_simp_insert_2 L M<span class="main"><span class="keyword3">,</span></span>
       <span class="operator">rule</span> equalityI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> insert_mono<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>insert <span class="var">?M</span> <span class="var">?B</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span>
          <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>insert <span class="var">?M</span> <span class="var">?C</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_mpair analz_simp_insert_2
         <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_insert_right<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 3<span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span>
         <span class="operator">subst</span> analz_auth_data_out <span class="main"><span class="main">[</span></span><span class="operator">OF</span> S T<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> analz_auth_data_out <span class="main"><span class="main">[</span></span><span class="operator">OF</span> O P<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H J K<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>insert <span class="var">?M</span> <span class="var">?C</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span>
          analz <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>insert <span class="var">?M</span> <span class="var">?B</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_mpair analz_simp_insert_2
         <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_insert_right Un_subset_iff semilattice_sup_class.sup.bounded_iff<span class="main"><span class="keyword3">,</span></span>
         <span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2 4<span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> analz_auth_data_out <span class="main"><span class="main">[</span></span><span class="operator">OF</span> O P<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
         <span class="operator">subst</span> analz_auth_data_out <span class="main"><span class="main">[</span></span><span class="operator">OF</span> S T<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H J K<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="var">?C</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invK_sesK<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> pr_sesk_user_1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B C D<span class="main"><span class="main">,</span></span>
       <span class="operator">THEN</span> pr_sesk_user_2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> G<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
        insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?B</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span> <span class="main">=</span>
        insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
       <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">c</span> <span class="skolem">f</span> <span class="skolem">H</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">H</span><span class="main">.</span> <span class="bound">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
      analz <span class="main">(</span><span class="bound">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC5</span><span class="main">)</span> <span class="main">=</span> <span class="bound">H</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC5</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC5</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC5</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
    analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
    <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟶</span> <span class="var">?T</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="var">?B</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?B</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ True<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analz_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?B</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="var">?B</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invK_sesK<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> pr_sesk_user_1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B C D<span class="main"><span class="main">,</span></span>
     <span class="operator">THEN</span> pr_sesk_user_2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> E<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?B</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFC5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">H</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">H</span><span class="main">.</span> <span class="bound">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
      analz <span class="main">(</span><span class="bound">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span> <span class="main">=</span> <span class="bound">H</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFC5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">e</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
    analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
    <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟶</span> <span class="var">?T</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="var">?B</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?B</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ True<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analz_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?B</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="var">?B</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invK_sesK<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> pr_sesk_card <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B C D<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> E<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?B</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">H</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">H</span><span class="main">.</span> <span class="bound">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
      analz <span class="main">(</span><span class="bound">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR5</span><span class="main">)</span> <span class="main">=</span> <span class="bound">H</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR5</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">e</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR5</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR5</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
    analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR5</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR5</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟶</span> <span class="var">?T</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="var">?B</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?B</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ True<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analz_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?B</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="var">?B</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invK_sesK<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> pr_sesk_card <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B C D<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> E<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?B</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">c</span> <span class="skolem">f</span> <span class="skolem">H</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">H</span><span class="main">.</span> <span class="bound">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
      analz <span class="main">(</span><span class="bound">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span> <span class="main">=</span> <span class="bound">H</span> <span class="main">∪</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span> <span class="main">⟶</span>
    analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟶</span> <span class="var">?T</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?C</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="var">?B</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?B</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ True<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> analz_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?B</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">⊆</span> range Key <span class="main">∪</span> range Pri_AgrK <span class="main">-</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="var">?B</span> <span class="main">=</span> <span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="var">?B</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invK_sesK<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> pr_sesk_user_1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B C D<span class="main"><span class="main">,</span></span>
     <span class="operator">THEN</span> pr_sesk_user_2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> E<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="var">?B</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>analz <span class="var">?B</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∪</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="var">?C</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">H</span> <span class="main">∪</span> analz <span class="var">?C</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_key_unused"><span class="command">lemma</span></span> pr_key_unused<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    Key <span class="free">K</span> <span class="main">∉</span> <span class="free">U</span> <span class="main">⟹</span>
  analz <span class="main">(</span>insert <span class="main">(</span>Key <span class="free">K</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    insert <span class="main">(</span>Key <span class="free">K</span><span class="main">)</span> <span class="main">(</span>analz <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> insert_def Un_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> pr_key_set_unused<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Protocol-pr_pri_agrk_unused"><span class="command">lemma</span></span> pr_pri_agrk_unused<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    Pri_AgrK <span class="free">x</span> <span class="main">∉</span> <span class="free">U</span> <span class="main">⟹</span>
  analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    insert <span class="main">(</span>Pri_AgrK <span class="free">x</span><span class="main">)</span> <span class="main">(</span>analz <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> insert_def Un_assoc <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> pr_key_set_unused<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Protocol-pr_pri_agrk_analz_intro"><span class="command">lemma</span></span> pr_pri_agrk_analz_intro <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span> <span class="main">⟶</span>
  Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> analz_simp<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_simp_insert_2 pr_key_unused pr_pri_agrk_unused<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>2<span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR1</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span><span class="main">)</span> <span class="main">⟶</span> Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">⟶</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR1</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> bad"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_symk_analz<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invK_symK<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_pri_agrk_unused<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">∨</span> Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_pri_agrk_unused<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">∨</span> Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR1</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span><span class="main">)</span> <span class="main">⟶</span> Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">⟶</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR1</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> bad"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span> <span class="main">∉</span> analz <span class="var">?A</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_symk_analz<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="var">?A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invK_symK<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR1</span> <span class="skolem">A</span> <span class="skolem">m</span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span> <span class="main">⟶</span> Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">⟶</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span>
      Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span> Key <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Decrypt<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span> Key <span class="main">(</span>symK <span class="skolem">m</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_simp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_simp_insert_1<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC4</span> <span class="skolem">A</span> <span class="skolem">c</span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC4</span><span class="main">)</span> <span class="main">⟶</span> Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">⟶</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC4</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFC4</span> <span class="skolem">A</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">d</span> <span class="skolem">e</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC4</span><span class="main">)</span> <span class="main">⟶</span> Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">⟶</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC4</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR4</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">b</span> <span class="skolem">d</span> <span class="skolem">e</span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?H</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Hash <span class="main">(</span>pubAK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>pubAK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?M'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>pubAK <span class="skolem">e</span><span class="main">,</span> Auth_Data <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span><span class="main">,</span>
      Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR4</span><span class="main">)</span> <span class="main">⟶</span> Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">⟶</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR4</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span><span class="main">)</span>
      <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR4</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>pubSK CA<span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_valid_key_analz<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">{</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">,</span> <span class="var">?H</span><span class="main">}</span> <span class="main">∪</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="main">∉</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_auth_key_analz<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_int_mapk_analz<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="var">?M'</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>insert <span class="var">?M</span> <span class="var">?A</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_mpair analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_mpair analz_simp_insert_2
     <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_insert_right<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span>
     <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> analz_auth_data_out <span class="main"><span class="main">[</span></span><span class="operator">OF</span> F G<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> E<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR4</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">f</span> <span class="skolem">g</span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?H</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>pubAK <span class="skolem">g</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?M'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>pubAK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span>
      Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span><span class="main">)</span> <span class="main">⟶</span> Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">⟶</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR4</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span><span class="main">)</span>
      <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span>
   <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">⟶</span>
      Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span> Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">⟶</span>
    Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">⟶</span> <span class="var">?Q</span> <span class="main">⟶</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span>
      <span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span> Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Decrypt<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>
        <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Snd<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Fst<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Auth_Fst <span class="main"><span class="main">[</span></span><span class="operator">OF</span> F<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Auth_Snd <span class="main"><span class="main">[</span></span><span class="operator">OF</span> F<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span> Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>
        <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_snd<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_fst<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span>
        Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_auth_data<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Auth_Fst <span class="main"><span class="main">[</span></span><span class="operator">OF</span> F<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Auth_Snd <span class="main"><span class="main">[</span></span><span class="operator">OF</span> F<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>pubSK CA<span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_valid_key_analz<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">{</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">,</span> <span class="var">?H</span><span class="main">}</span> <span class="main">∪</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span> <span class="main">∨</span>
        Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> E <span class="keyword2"><span class="keyword">and</span></span> G <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">b</span><span class="main">)</span>
        <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_subsetD<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> analz_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword2"><span class="keyword">and</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="var">?M'</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> D <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>insert <span class="var">?M</span> <span class="var">?A</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_mpair analz_simp_insert_2<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_mpair analz_simp_insert_2
       <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_insert_right<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span>
       <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> analz_auth_data_in <span class="main"><span class="main">[</span></span><span class="operator">OF</span> H<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_insert_right<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">g</span><span class="main">)</span> <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">b</span><span class="main">)</span>
          <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> analz_simp_insert_1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> J<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
         <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> analz_simp_insert_1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> K<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∉</span> analz <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword2"><span class="keyword">and</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="var">?M'</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> D <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>insert <span class="var">?M</span> <span class="var">?A</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_mpair analz_simp_insert_2<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_mpair analz_simp_insert_2
       <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_insert_right<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> insert_commute<span class="main"><span class="keyword3">,</span></span>
       <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> analz_auth_data_out <span class="main"><span class="main">[</span></span><span class="operator">OF</span> H I<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC5</span> <span class="skolem">A</span> <span class="skolem">m</span> <span class="skolem">c</span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC5</span><span class="main">)</span> <span class="main">⟶</span> Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">⟶</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC5</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFC5</span> <span class="skolem">A</span> <span class="skolem">n</span> <span class="skolem">d</span> <span class="skolem">e</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span> <span class="main">⟶</span> Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">⟶</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR5</span> <span class="skolem">A</span> <span class="skolem">d</span> <span class="skolem">e</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR5</span><span class="main">)</span> <span class="main">⟶</span> Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">⟶</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR5</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR5</span> <span class="skolem">A</span> <span class="skolem">c</span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span> <span class="main">⟶</span> Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">⟶</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_pri_agrk_analz"><span class="command">lemma</span></span> pr_pri_agrk_analz<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    <span class="main">(</span>Pri_AgrK <span class="free">x</span> <span class="main">∈</span> analz <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Pri_AgrK <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> pr_pri_agrk_analz_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_subset<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Protocol-pr_ext_agrk_user_1"><span class="command">lemma</span></span> pr_ext_agrk_user_1 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    User <span class="free">m</span> <span class="main">≠</span> Spy <span class="main">⟶</span>
    Says <span class="free">n</span> <span class="free">run</span> <span class="numeral">4</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span> <span class="main">⟶</span>
  ExtAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> None"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Protocol-pr_ext_agrk_user_2"><span class="command">lemma</span></span> pr_ext_agrk_user_2 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    User <span class="free">m</span> <span class="main">≠</span> Spy <span class="main">⟶</span>
    Says <span class="free">n</span> <span class="free">run</span> <span class="numeral">4</span> <span class="free">X</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span>
      <span class="main">⦃</span>pubAK <span class="free">e</span><span class="main">,</span> Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">,</span> pubAK <span class="free">g</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span><span class="main">)</span>
      <span class="main">∈</span> set <span class="free">evs</span> <span class="main">⟶</span>
  ExtAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> None"</span></span>
<span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> defined_all<span class="main">]</span><span class="main">]</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span>
 <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evs</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">X</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evs</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"User <span class="free">m</span> <span class="main">≠</span> Spy"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"User <span class="free">m</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">4</span> <span class="skolem">X</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>pubAK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evs</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">4</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span>pubAK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evs</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_ext_agrk_user_1<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">.</span> ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span><span class="skolem">X</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">e</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_ext_agrk_user_3"><span class="command">lemma</span></span> pr_ext_agrk_user_3 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    User <span class="free">m</span> <span class="main">≠</span> Spy <span class="main">⟶</span>
    ExtAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">e</span> <span class="main">⟶</span>
    Says <span class="free">n</span> <span class="free">run</span> <span class="numeral">4</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="free">e'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span> <span class="main">⟶</span>
  <span class="free">e'</span> <span class="main">=</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"agrK <span class="free">e'</span> <span class="main">=</span> agrK <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> agrK_inj <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">e'</span> <span class="main">=</span> <span class="free">e</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> injD<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC4</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC4</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"User <span class="skolem">m</span> <span class="main">≠</span> Spy"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">4</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="free">e'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsC4</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_ext_agrk_user_1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">e'</span> <span class="main">=</span> <span class="free">e</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_ext_agrk_user_4"><span class="command">lemma</span></span> pr_ext_agrk_user_4 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    ExtAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">f</span> <span class="main">⟶</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">X</span><span class="main">.</span> Says <span class="free">n</span> <span class="free">run</span> <span class="numeral">3</span> <span class="bound">X</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="free">f</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>2<span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>5<span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">declare</span></span> fun_upd_apply <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1" id="Protocol-pr_ext_agrk_user_5"><span class="command">lemma</span></span> pr_ext_agrk_user_5 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    Says <span class="free">n</span> <span class="free">run</span> <span class="numeral">3</span> <span class="free">X</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="free">f</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span> <span class="main">⟶</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">s</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">d</span><span class="main">.</span> <span class="free">f</span> <span class="main">=</span> <span class="bound">d</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="main">+</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∧</span>
    NonceS <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">s</span> <span class="main">∧</span>
    IntMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span> <span class="main">∧</span>
    ExtMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">a</span> <span class="main">∧</span>
    IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">d</span> <span class="main">∧</span>
    <span class="bound">d</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">+</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> Pri_AgrK <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span>
    ExtMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="var">?H</span> <span class="free">evs</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="free">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="free">S</span> <span class="free">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_pri_agrk_analz<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>2<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>4<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>5<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>5<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>6<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>7<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>7<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>8<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>9<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>9<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>10<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>11<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>12<span class="main"><span class="improper">]</span></span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>12<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>13<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>14<span class="main"><span class="improper">]</span></span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>14<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>14<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>15<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>16<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>16<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>16<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>17<span class="main">-</span>18<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR1</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsR1</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsR1</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">∨</span> Pri_AgrK <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> ExtMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR1</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsR1</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsR1</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC2</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC2</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∨</span> Pri_AgrK <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> ExtMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">m'</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC2</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC2</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC2</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC2</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∨</span> Pri_AgrK <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> ExtMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">m'</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC2</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC2</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC2</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC2</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∨</span> Pri_AgrK <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> ExtMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">m'</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC2</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC2</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC2</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC2</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∨</span> Pri_AgrK <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> ExtMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">m'</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC2</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC2</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsR2</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsR2</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>IntMapK <span class="main">:=</span> Some <span class="skolem">b</span><span class="main">,</span> ExtMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">m'</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC3</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC3</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>ExtMapK <span class="main">:=</span> Some <span class="skolem">b</span><span class="main">,</span> IntAgrK <span class="main">:=</span> Some <span class="skolem">c</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∨</span> Pri_AgrK <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> ExtMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">m'</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC3</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC3</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>ExtMapK <span class="main">:=</span> Some <span class="skolem">b</span><span class="main">,</span> IntAgrK <span class="main">:=</span> Some <span class="skolem">c</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">X</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>IntAgrK <span class="main">:=</span> Some <span class="skolem">d</span><span class="main">,</span> ExtAgrK <span class="main">:=</span> Some <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"agrK <span class="free">f</span> <span class="main">=</span> agrK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> agrK_inj <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> injD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> Pri_AgrK <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∧</span> ExtMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span><span class="skolem">X</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsR3</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsR3</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>IntAgrK <span class="main">:=</span> Some <span class="skolem">d</span><span class="main">,</span> ExtAgrK <span class="main">:=</span> Some <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">X</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>IntAgrK <span class="main">:=</span> Some <span class="skolem">d</span><span class="main">,</span> ExtAgrK <span class="main">:=</span> Some <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"agrK <span class="free">f</span> <span class="main">=</span> agrK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> agrK_inj <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> injD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> Pri_AgrK <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∧</span> ExtMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span><span class="skolem">X</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsR3</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsR3</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>IntAgrK <span class="main">:=</span> Some <span class="skolem">d</span><span class="main">,</span> ExtAgrK <span class="main">:=</span> Some <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC4</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">f</span> <span class="skolem">m'</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC4</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="skolem">evsC4</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>ExtAgrK <span class="main">:=</span> Some <span class="skolem">f</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">declare</span></span> fun_upd_apply <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1" id="Protocol-pr_int_agrk_user_1"><span class="command">lemma</span></span> pr_int_agrk_user_1 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">c</span> <span class="main">⟶</span>
  Pri_AgrK <span class="free">c</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Protocol-pr_int_agrk_user_2"><span class="command">lemma</span></span> pr_int_agrk_user_2 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    User <span class="free">m</span> <span class="main">≠</span> Spy <span class="main">⟶</span>
    IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">c</span> <span class="main">⟶</span>
  Pri_AgrK <span class="free">c</span> <span class="main">∉</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>4<span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR1</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR1</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_int_agrk_user_1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">a</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC2</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_int_agrk_user_1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_analz_used<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">c</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">c</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">c</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">c'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">c'</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">c'</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_int_agrk_user_1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">c'</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_int_agrk_user_3"><span class="command">lemma</span></span> pr_int_agrk_user_3 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    NonceS <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">s</span> <span class="main">⟶</span>
    IntMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">a</span> <span class="main">⟶</span>
    ExtMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span> <span class="main">⟶</span>
    IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">c</span> <span class="main">⟶</span>
  <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>2<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">m</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC2</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">m</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC2</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_int_agrk_card"><span class="command">lemma</span></span> pr_int_agrk_card <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    NonceS <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">s</span> <span class="main">⟶</span>
    IntMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span> <span class="main">⟶</span>
    ExtMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">a</span> <span class="main">⟶</span>
    IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span> <span class="main">⟶</span>
  <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR1</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR1</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR2</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_3<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_ext_agrk_card"><span class="command">lemma</span></span> pr_ext_agrk_card <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    NonceS <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">s</span> <span class="main">⟶</span>
    IntMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span> <span class="main">⟶</span>
    ExtMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">a</span> <span class="main">⟶</span>
    IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span> <span class="main">⟶</span>
    ExtAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
    Pri_AgrK <span class="free">c</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟶</span>
  Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_pri_agrk_analz<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>2<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>4<span class="main"><span class="improper">]</span></span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>4<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>4<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>5<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>5<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>6<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>6<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>6<span class="main"><span class="improper">]</span></span> notI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>7<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>7<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>7<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>8<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>8<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>9<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>9<span class="main"><span class="improper">]</span></span> notI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>10<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>11<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>11<span class="main"><span class="improper">]</span></span> notI<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR1</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR1</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR1</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR1</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR2</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_3<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span> <span class="skolem">d'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_card<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s'</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span> <span class="skolem">d'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_card<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s'</span> <span class="skolem">c'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_analz_used<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> contra_subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s'</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span> <span class="skolem">d'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_card<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">declare</span></span> fun_upd_apply <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1" id="Protocol-pr_sesk_user_3"><span class="command">lemma</span></span> pr_sesk_user_3 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    <span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="free">m</span><span class="main">)</span><span class="main">,</span> Number <span class="free">n</span><span class="main">,</span> Number <span class="free">run</span><span class="main">⦄</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">⟶</span>
    Key <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟶</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">d</span> <span class="bound">e</span><span class="main">.</span> <span class="free">K</span> <span class="main">=</span> <span class="bound">d</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">∧</span>
    IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">d</span> <span class="main">∧</span>
    ExtAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">e</span><span class="main">)</span> <span class="main">∨</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> Pri_AgrK <span class="bound">b</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span>
    ExtMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="var">?H1</span> <span class="free">U</span> <span class="main">⟶</span> <span class="var">?H2</span> <span class="free">A</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="free">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="free">S</span> <span class="free">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_pri_agrk_analz<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>2<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>4<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>5<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>5<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>6<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>7<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>7<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>8<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>9<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>9<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>10<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>11<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>12<span class="main"><span class="improper">]</span></span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>12<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>13<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>14<span class="main"><span class="improper">]</span></span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>14<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>14<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>15<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>15<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>16<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>17<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>17<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>18<span class="main">-</span>20<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR1</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span> <span class="main">⟶</span> <span class="var">?H2</span> <span class="skolem">A</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H2</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">∨</span> Pri_AgrK <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> ExtMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR1</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span> <span class="main">⟶</span> <span class="var">?H2</span> <span class="skolem">A</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H2</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span> <span class="main">⟶</span> <span class="var">?H2</span> <span class="skolem">A</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H2</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∨</span> Pri_AgrK <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> ExtMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">m</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span> <span class="main">⟶</span> <span class="var">?H2</span> <span class="skolem">A</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H2</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span> <span class="main">⟶</span> <span class="var">?H2</span> <span class="skolem">A</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H2</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∨</span> Pri_AgrK <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> ExtMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">m</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span> <span class="main">⟶</span> <span class="var">?H2</span> <span class="skolem">A</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H2</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span> <span class="main">⟶</span> <span class="var">?H2</span> <span class="skolem">A</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H2</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∨</span> Pri_AgrK <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> ExtMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">m</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span> <span class="main">⟶</span> <span class="var">?H2</span> <span class="skolem">A</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H2</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span> <span class="main">⟶</span> <span class="var">?H2</span> <span class="skolem">A</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H2</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∨</span> Pri_AgrK <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> ExtMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">m</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span> <span class="main">⟶</span> <span class="var">?H2</span> <span class="skolem">A</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H2</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span> <span class="main">⟶</span> <span class="var">?H2</span> <span class="skolem">A</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H2</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>IntMapK <span class="main">:=</span> Some <span class="skolem">b</span><span class="main">,</span> ExtMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">m'</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span> <span class="main">⟶</span> <span class="var">?H2</span> <span class="skolem">A</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H2</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>ExtMapK <span class="main">:=</span> Some <span class="skolem">b</span><span class="main">,</span> IntAgrK <span class="main">:=</span> Some <span class="skolem">c</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> <span class="main">(</span><span class="bound">b</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">∨</span> Pri_AgrK <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> ExtMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">m'</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span> <span class="main">⟶</span> <span class="var">?H2</span> <span class="skolem">A</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H2</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>ExtMapK <span class="main">:=</span> Some <span class="skolem">b</span><span class="main">,</span> IntAgrK <span class="main">:=</span> Some <span class="skolem">c</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">A</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">X</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>IntAgrK <span class="main">:=</span> Some <span class="skolem">d</span><span class="main">,</span> ExtAgrK <span class="main">:=</span> Some <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sesK <span class="free">K</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> sesK_inj <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">K</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> injD<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> Pri_AgrK <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∧</span> ExtMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span><span class="skolem">X</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>IntAgrK <span class="main">:=</span> Some <span class="skolem">d</span><span class="main">,</span> ExtAgrK <span class="main">:=</span> Some <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sesK <span class="free">K</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> sesK_inj <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">K</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> injD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="free">m</span><span class="main">)</span><span class="main">,</span> Number <span class="free">n</span><span class="main">,</span> Number <span class="free">run</span><span class="main">⦄</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_user_2<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span> <span class="main">⟶</span> <span class="var">?H2</span> <span class="skolem">A</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H2</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>IntAgrK <span class="main">:=</span> Some <span class="skolem">d</span><span class="main">,</span> ExtAgrK <span class="main">:=</span> Some <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">X</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>IntAgrK <span class="main">:=</span> Some <span class="skolem">d</span><span class="main">,</span> ExtAgrK <span class="main">:=</span> Some <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_analz_used<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> Pri_AgrK <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∧</span> ExtMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span><span class="skolem">X</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span> <span class="main">⟶</span> <span class="var">?H2</span> <span class="skolem">A</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H2</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>IntAgrK <span class="main">:=</span> Some <span class="skolem">d</span><span class="main">,</span> ExtAgrK <span class="main">:=</span> Some <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR3</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sesK <span class="free">K</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> sesK_inj <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">K</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> injD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="free">m</span><span class="main">)</span><span class="main">,</span> Number <span class="free">n</span><span class="main">,</span> Number <span class="free">run</span><span class="main">⦄</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_user_2<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC4</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">f</span> <span class="skolem">m'</span> <span class="skolem">n'</span> <span class="skolem">run'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span> <span class="main">⟶</span> <span class="var">?H2</span> <span class="skolem">A</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?H2</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>ExtAgrK <span class="main">:=</span> Some <span class="skolem">f</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?S</span> <span class="free">n</span> <span class="free">run</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="var">?S</span> <span class="skolem">A</span> <span class="free">n</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">declare</span></span> fun_upd_apply <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>

<span class="keyword1" id="Protocol-pr_sesk_auth"><span class="command">lemma</span></span> pr_sesk_auth <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">⦃</span>pubAK <span class="free">e</span><span class="main">,</span> Auth_Data <span class="free">x</span> <span class="free">y</span><span class="main">,</span> pubAK <span class="free">g</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>
      <span class="main">∈</span> parts <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span> <span class="main">⟶</span>
  Key <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> parts_simp<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> parts_simp_insert parts_auth_data parts_crypt parts_mpair<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR4</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">d</span> <span class="skolem">e</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR4</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">e</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_card<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR4</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">c</span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR4</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">f</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span><span class="main">,</span> Number <span class="skolem">n</span><span class="main">,</span> Number <span class="skolem">run</span><span class="main">⦄</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_user_1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_user_2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_sesk_passwd"><span class="command">lemma</span></span> pr_sesk_passwd <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    Says <span class="free">n</span> <span class="free">run</span> <span class="numeral">5</span> <span class="free">X</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span> <span class="main">⟶</span>
  Key <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">X</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">4</span> <span class="skolem">X</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⦃</span>pubAK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span>
     Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsC5</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Says <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="var">?M</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> spies <span class="skolem">evsC5</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_spies<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC5</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC5</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_auth<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFC5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">d</span> <span class="skolem">e</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFC5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">e</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_card<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_sesk_card_user"><span class="command">lemma</span></span> pr_sesk_card_user <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    User <span class="free">m</span> <span class="main">≠</span> Spy <span class="main">⟶</span>
    NonceS <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">s</span> <span class="main">⟶</span>
    IntMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">a</span> <span class="main">⟶</span>
    ExtMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span> <span class="main">⟶</span>
    IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">c</span> <span class="main">⟶</span>
    NonceS <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">s'</span> <span class="main">⟶</span>
    IntMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b'</span> <span class="main">⟶</span>
    ExtMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">a'</span> <span class="main">⟶</span>
    IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span> <span class="main">⟶</span>
    ExtAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="free">s'</span> <span class="main">+</span> <span class="free">a'</span> <span class="main">*</span> <span class="free">b'</span> <span class="main">=</span> <span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">⟶</span>
  Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_pri_agrk_analz<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main">-</span>3<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>4<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>5<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>6<span class="main"><span class="improper">]</span></span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>6<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>6<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>6<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>8<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>8<span class="main"><span class="improper">]</span></span> notI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>9<span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>9<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>9<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>10<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>10<span class="main"><span class="improper">]</span></span> notI<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>11<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>12<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>12<span class="main"><span class="improper">]</span></span> notI<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR1</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR1</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b'</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">run</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC2</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">run</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC2</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR2</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_2<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_3<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">a'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">+</span> <span class="free">a'</span> <span class="main">*</span> <span class="free">b'</span> <span class="main">=</span> <span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s'</span> <span class="main">+</span> <span class="free">a'</span> <span class="main">*</span> <span class="free">b'</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">c</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_analz_used<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">c</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> contra_subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s'</span> <span class="main">+</span> <span class="free">a'</span> <span class="main">*</span> <span class="free">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_ext_agrk_card<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"User <span class="free">m</span> <span class="main">≠</span> Spy"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">c</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_int_agrk_user_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="free">c</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_analz_used<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> contra_subsetD<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s'</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span> <span class="skolem">d'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_card<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s'</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span> <span class="skolem">d'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_card<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s'</span> <span class="skolem">c'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_analz_used<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="free">a'</span> <span class="main">*</span> <span class="free">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="free">a'</span> <span class="main">*</span> <span class="free">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> contra_subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="free">a'</span> <span class="main">*</span> <span class="free">b'</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c'</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="free">a'</span> <span class="main">*</span> <span class="free">b'</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s'</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span> <span class="skolem">d'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_card<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_sign_key_used"><span class="command">lemma</span></span> pr_sign_key_used<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span> Key <span class="main">(</span>priSK <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Protocol-pr_sign_key_analz"><span class="command">lemma</span></span> pr_sign_key_analz<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span> Key <span class="main">(</span>priSK <span class="free">X</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_key_analz<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> priSK_pubSK priSK_symK<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>priSK <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sign_key_used<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"priSK <span class="free">X</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>priSK <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sign_key_used<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"priSK <span class="free">X</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_auth_data_parts"><span class="command">lemma</span></span> pr_auth_data_parts <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    Auth_Data <span class="main">(</span>priAK <span class="free">n</span><span class="main">)</span> <span class="free">b</span> <span class="main">∈</span> parts <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span> <span class="main">⟶</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="var">?M</span> <span class="main">∈</span> <span class="main">_</span> <span class="main">⟶</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> parts_simp<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span>
 <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> parts_simp_insert parts_auth_data parts_crypt parts_mpair <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>4<span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>4<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>5<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>6<span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>6<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>7<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>8<span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>8<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>9<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>10<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>11<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>11<span class="main">-</span>12<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>13<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>13<span class="main">-</span>14<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>15<span class="main">-</span>17<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>17<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR1</span> <span class="skolem">A</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">s</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">,</span> <span class="skolem">m</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">A</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">,</span> <span class="skolem">m</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">A</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">m'</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">,</span> <span class="skolem">m</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">A</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">,</span> <span class="skolem">m</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">A</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">m'</span> <span class="skolem">a</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="main">0</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">,</span> <span class="skolem">m</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">A</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">,</span> <span class="skolem">m</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">A</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">m'</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="skolem">s</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">,</span> <span class="skolem">m</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">A</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">a</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="main">0</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">,</span> <span class="skolem">m</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">A</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">m'</span> <span class="skolem">a</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>NonceS <span class="main">:=</span> Some <span class="main">0</span><span class="main">,</span> IntMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">,</span> <span class="skolem">m</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR2</span> <span class="skolem">A</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">a</span> <span class="skolem">b'</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>IntMapK <span class="main">:=</span> Some <span class="skolem">b'</span><span class="main">,</span> ExtMapK <span class="main">:=</span> Some <span class="skolem">a</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR2</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">,</span> <span class="skolem">m</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC3</span> <span class="skolem">A</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">b'</span> <span class="skolem">c</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Spy<span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>ExtMapK <span class="main">:=</span> Some <span class="skolem">b'</span><span class="main">,</span> IntAgrK <span class="main">:=</span> Some <span class="skolem">c</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC3</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC3</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">,</span> <span class="skolem">m</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC3</span> <span class="skolem">A</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">b'</span> <span class="skolem">c</span> <span class="skolem">m</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>ExtMapK <span class="main">:=</span> Some <span class="skolem">b'</span><span class="main">,</span> IntAgrK <span class="main">:=</span> Some <span class="skolem">c</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC3</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC3</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">,</span> <span class="skolem">m</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">A</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b'</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>IntAgrK <span class="main">:=</span> Some <span class="skolem">d</span><span class="main">,</span> ExtAgrK <span class="main">:=</span> Some <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">,</span> <span class="skolem">m</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">A</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b'</span> <span class="skolem">c</span> <span class="skolem">d</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span>
    <span class="main">⦇</span>IntAgrK <span class="main">:=</span> Some <span class="skolem">d</span><span class="main">,</span> ExtAgrK <span class="main">:=</span> Some <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">,</span> <span class="skolem">m</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC4</span> <span class="skolem">A</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">c</span> <span class="skolem">f</span> <span class="skolem">m</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span><span class="main">(</span><span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span> <span class="main">:=</span> <span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">⦇</span>ExtAgrK <span class="main">:=</span> Some <span class="skolem">f</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC4</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC4</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">,</span> <span class="skolem">m</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="var">?S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR4</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">b'</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b'</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b'</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR4</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b'</span> <span class="skolem">c</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR4</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>
      <span class="main">⦃</span>pubAK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span>
       Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">_</span> <span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"priAK <span class="free">n</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="skolem">b'</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">m</span><span class="main">,</span> <span class="bound">m</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span>
      <span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span> Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Body<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>
        <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Snd<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Fst<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span> Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>
        <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_snd<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_fst<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span>
        Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">b'</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_auth_data<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">b'</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="free">n</span><span class="main">)</span> <span class="main">∉</span> analz <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_auth_key_analz<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b'</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_sign_parts"><span class="command">lemma</span></span> pr_sign_parts <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span> <span class="main">⟶</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="main">=</span> priAK <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="var">?M</span> <span class="free">g</span> <span class="main">∈</span> <span class="main">_</span> <span class="main">⟶</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> parts_simp<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>
 parts_simp_insert parts_auth_data parts_crypt parts_mpair<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR4</span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"agrK <span class="free">g</span> <span class="main">=</span> agrK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> agrK_inj <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">=</span> priAK <span class="skolem">n</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> injD<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="main">=</span> priAK <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR4</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">f</span> <span class="skolem">g'</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="free">g</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="main">=</span> priAK <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR4</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">⦃</span>pubAK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="skolem">g'</span> <span class="skolem">b</span><span class="main">,</span>
      pubAK <span class="skolem">g'</span><span class="main">,</span> <span class="var">?M</span> <span class="skolem">g'</span><span class="main">⦄</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"agrK <span class="free">g</span> <span class="main">=</span> agrK <span class="skolem">g'</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> agrK_inj <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">=</span> <span class="skolem">g'</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> injD<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="main">=</span> priAK <span class="bound">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span>
      <span class="main">⦃</span>pubAK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="skolem">g'</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g'</span><span class="main">,</span> <span class="var">?M</span> <span class="skolem">g'</span><span class="main">⦄</span>
        <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span>
      Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>pubAK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="skolem">g'</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g'</span><span class="main">,</span> <span class="var">?M</span> <span class="skolem">g'</span><span class="main">⦄</span>
        <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Body<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">g'</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> parts.Snd<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g'</span> <span class="main">=</span> priAK <span class="bound">n</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">⦃</span>pubAK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="skolem">g'</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g'</span><span class="main">,</span> <span class="var">?M</span> <span class="skolem">g'</span><span class="main">⦄</span>
          <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span>
        Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">⦃</span>pubAK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="skolem">g'</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g'</span><span class="main">,</span> <span class="var">?M</span> <span class="skolem">g'</span><span class="main">⦄</span>
          <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Auth_Data <span class="skolem">g'</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g'</span><span class="main">,</span> <span class="var">?M</span> <span class="skolem">g'</span><span class="main">⦄</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_snd<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>pubAK <span class="skolem">g'</span><span class="main">,</span> <span class="var">?M</span> <span class="skolem">g'</span><span class="main">⦄</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_snd<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">g'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_snd<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">g'</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span>
        Hash <span class="main">(</span>pubAK <span class="skolem">g'</span><span class="main">)</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span> Key <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">g'</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">g'</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g'</span> <span class="main">=</span> priAK <span class="bound">n</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Hash <span class="main">(</span>pubAK <span class="skolem">g'</span><span class="main">)</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span>
          Key <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">∉</span> analz <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sign_key_analz<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g'</span> <span class="main">=</span> priAK <span class="bound">n</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g'</span> <span class="main">=</span> priAK <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g'</span> <span class="main">=</span> priAK <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">g</span> <span class="main">=</span> priAK <span class="bound">n</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_key_secrecy_aux"><span class="command">lemma</span></span> pr_key_secrecy_aux <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    User <span class="free">m</span> <span class="main">≠</span> Spy <span class="main">⟶</span>
    NonceS <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">s</span> <span class="main">⟶</span>
    IntMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">a</span> <span class="main">⟶</span>
    ExtMapK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span> <span class="main">⟶</span>
    IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">c</span> <span class="main">⟶</span>
    ExtAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">f</span> <span class="main">⟶</span>
    Says <span class="free">n</span> <span class="free">run</span> <span class="numeral">4</span> <span class="free">X</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>
      <span class="main">⦃</span>pubAK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="free">g</span> <span class="free">b</span><span class="main">,</span> pubAK <span class="free">g</span><span class="main">,</span>
       Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span> <span class="main">⟶</span>
  Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">supply</span></span></span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> defined_all<span class="main">]</span><span class="main">]</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>7<span class="main"><span class="improper">]</span></span> disjE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>7<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>8<span class="main"><span class="improper">]</span></span> disjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>8<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>8<span class="main"><span class="improper">]</span></span> notI<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">run</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC2</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">run</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC2</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_1<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">run</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_3<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_state_4<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">d</span> <span class="skolem">s'</span> <span class="skolem">s''</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s''</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"Says <span class="free">n</span> <span class="free">run</span> <span class="numeral">4</span> <span class="free">X</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>
      <span class="main">⦃</span>pubAK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="free">g</span> <span class="free">b</span><span class="main">,</span> pubAK <span class="free">g</span><span class="main">,</span>
       Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsR3</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Says <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="var">?M</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">=</span> <span class="skolem">s'</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">c'</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span> <span class="main">⟶</span>
    sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span> <span class="main">≠</span> sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> spies <span class="skolem">evsR3</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_spies<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_auth<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s''</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s'</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">c'</span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"Says <span class="free">n</span> <span class="free">run</span> <span class="numeral">4</span> <span class="free">X</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>
      <span class="main">⦃</span>pubAK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="free">g</span> <span class="free">b</span><span class="main">,</span> pubAK <span class="free">g</span><span class="main">,</span>
       Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFR3</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Says <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="var">?M</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span> <span class="main">≠</span> sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> spies <span class="skolem">evsFR3</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_spies<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR3</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR3</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_auth<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">c'</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC4</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC4</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"User <span class="skolem">m</span> <span class="main">≠</span> Spy"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">4</span> <span class="free">X</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⦃</span>pubAK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="free">g</span> <span class="free">b</span><span class="main">,</span> pubAK <span class="free">g</span><span class="main">,</span>
     Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="free">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsC4</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> None"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_ext_agrk_user_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> None"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR4</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">X</span> <span class="skolem">s'</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">S</span> <span class="main">::</span> <span class="quoted">state</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"User <span class="free">m</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"agrK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> agrK <span class="skolem">e</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> agrK_inj <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">e</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> injD<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> sesK_inj <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">*</span> <span class="free">f</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> injD<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">*</span> <span class="free">f</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span><span class="skolem">X</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">f</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">assume</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR4</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"User <span class="free">m</span> <span class="main">≠</span> Spy"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span><span class="skolem">X</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">s</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span><span class="skolem">X</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">a</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span><span class="skolem">X</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b'</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b'</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span><span class="skolem">X</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">c</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">s'</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b'</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">a'</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">d</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">e</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">4</span> <span class="skolem">X</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">)</span>
    <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsR4</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">4</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">)</span>
    <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsR4</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> E <span class="keyword2"><span class="keyword">and</span></span> F <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_ext_agrk_user_3<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span> <span class="main">=</span> <span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">b'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> E <span class="keyword2"><span class="keyword">and</span></span> G <span class="keyword2"><span class="keyword">and</span></span> H <span class="keyword2"><span class="keyword">and</span></span> I <span class="keyword2"><span class="keyword">and</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_int_agrk_user_3<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> E <span class="keyword2"><span class="keyword">and</span></span> K <span class="keyword2"><span class="keyword">and</span></span> L <span class="keyword2"><span class="keyword">and</span></span> M <span class="keyword2"><span class="keyword">and</span></span> N <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_int_agrk_card<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_card_user<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR4</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">b</span> <span class="skolem">g</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR4</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    F<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⦃</span>pubAK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span>
     Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">_</span> <span class="var">?M</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span>
    <span class="var">?M</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span> Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Body<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> parts.Snd<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">=</span> priAK <span class="bound">n</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sign_parts<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span> Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>
      <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_snd<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>pubAK <span class="skolem">g</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_snd<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_snd<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span>
      Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span> Key <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">=</span> priAK <span class="bound">n</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sign_parts<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span> Key <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">∉</span> analz <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sign_key_analz<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">=</span> priAK <span class="bound">n</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">=</span> priAK <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">=</span> priAK <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> priAK <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⦃</span>pubAK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="free">s</span> <span class="main">+</span> <span class="free">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span><span class="main">,</span>
     Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">_</span> <span class="var">?M</span> <span class="main">∈</span> <span class="main">_</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">using</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span>
    <span class="var">?M</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span> Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Body<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Auth_Data <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span><span class="main">,</span>
      Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Snd<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">b</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Fst<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span> Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Auth_Data <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span><span class="main">,</span>
      Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_snd<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">b</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_fst<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span>
      Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_auth_data<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">b</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="main">∉</span> analz <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_auth_key_analz<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">b</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">b</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="main">(</span>priAK <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">b</span> <span class="main">∈</span> parts <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="bound">n</span><span class="main">,</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_auth_data_parts<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> analz <span class="var">?A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_int_mapk_analz<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_pri_agrk_analz<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">X</span><span class="main">.</span> Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">3</span> <span class="bound">X</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="free">f</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFR4</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_ext_agrk_user_4<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">3</span> <span class="skolem">X</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="free">f</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFR4</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">s</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">d</span><span class="main">.</span> <span class="free">f</span> <span class="main">=</span> <span class="bound">d</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="main">+</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∧</span>
      NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">s</span> <span class="main">∧</span>
      IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span> <span class="main">∧</span>
      ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">a</span> <span class="main">∧</span>
      IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">d</span> <span class="main">∧</span>
      <span class="bound">d</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">+</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">b</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> Pri_AgrK <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∧</span>
      ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">s</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">d</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">s</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">d</span><span class="main">)</span> <span class="main">∨</span> <span class="var">?Q</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_ext_agrk_user_5<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?Q</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b'</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
     <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">d</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">s</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">d</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">s'</span> <span class="skolem">a'</span> <span class="skolem">b'</span> <span class="skolem">d</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword1"><span class="command">have</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span><span class="main">,</span> Number <span class="skolem">n</span><span class="main">,</span> Number <span class="skolem">run</span><span class="main">⦄</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_user_1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> F <span class="keyword2"><span class="keyword">and</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">d'</span> <span class="bound">e'</span><span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">d'</span> <span class="main">*</span> <span class="bound">e'</span> <span class="main">∧</span>
      IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">d'</span> <span class="main">∧</span>
      ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">e'</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> Pri_AgrK <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∧</span>
      ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="bound">b</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">d</span> <span class="bound">e</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">d</span> <span class="bound">e</span><span class="main">)</span> <span class="main">∨</span> <span class="main">_</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_user_3 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">d</span> <span class="bound">e</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">d</span> <span class="bound">e</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> L<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">d'</span> <span class="skolem">e'</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d'</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">*</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e'</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e'</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> L <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a'</span> <span class="main">*</span> <span class="skolem">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> pr_ext_agrk_card <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">run</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> J M<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> pr_int_agrk_user_2 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">m</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">run</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C E<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> pr_key_secrecy <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    User <span class="free">m</span> <span class="main">≠</span> Spy <span class="main">⟶</span>
    Says <span class="free">n</span> <span class="free">run</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span> <span class="main">⟶</span>
  Key <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_key_analz<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span>
 <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main">-</span>3<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>2<span class="main"><span class="improper">]</span></span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"Says <span class="free">n</span> <span class="free">run</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">)</span>
      <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsR3</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_passwd<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"Says <span class="free">n</span> <span class="free">run</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">)</span>
      <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFR3</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_passwd<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">X</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">m</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"User <span class="skolem">m</span> <span class="main">≠</span> Spy"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">4</span> <span class="skolem">X</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>
      <span class="main">⦃</span>pubAK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span>
       Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span><span class="main">)</span>
      <span class="main">∈</span> set <span class="skolem">evsC5</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_key_secrecy_aux<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> pr_passwd_secrecy <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    User <span class="free">m</span> <span class="main">≠</span> Spy <span class="main">⟶</span>
  Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_simp_insert_2<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule</span> contra_subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> parts_simp<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR1</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR1</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n</span> <span class="main">∈</span> bad <span class="main">⟶</span> Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="skolem">n</span> <span class="main">∉</span> bad <span class="main">⟶</span> Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">_</span> <span class="main">⟶</span> <span class="var">?T</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">_</span> <span class="main">⟶</span> <span class="var">?T'</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> bad"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_symk_analz invK_symK<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_subsetD<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> analz_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
      insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_pri_agrk_unused<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> bad"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>symK <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR1</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_symk_analz invK_symK<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?T'</span></span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_out<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR1</span> <span class="skolem">A</span> <span class="skolem">m'</span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>symK <span class="skolem">m'</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>symK <span class="skolem">m'</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>symK <span class="skolem">m'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_crypt_out<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>symK <span class="skolem">m'</span><span class="main">)</span> <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span> <span class="main">∨</span>
      Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      Key <span class="main">(</span>symK <span class="skolem">m'</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">∨</span> <span class="var">?Q</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Decrypt<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_simp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">s</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR1</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_simp_insert_1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC2</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">a</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC2</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC2</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> pr_pri_agrk_unused<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">c</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">m'</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC3</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">c</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">c</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC3</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> pr_pri_agrk_unused<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">s'</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Key <span class="var">?K</span> <span class="main">∉</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_key_unused<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">c</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span> <span class="main">⟶</span>
    Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR3</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR3</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"Key <span class="var">?K</span> <span class="main">∉</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR3</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR3</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_key_unused<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Key <span class="var">?K</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR3</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC4</span> <span class="skolem">A</span> <span class="skolem">c</span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC4</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC4</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC4</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_crypt_out analz_simp_insert_2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFC4</span> <span class="skolem">A</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">d</span> <span class="skolem">e</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC4</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>pubAK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC4</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC4</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_crypt_out analz_simp_insert_2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR4</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">b</span> <span class="skolem">d</span> <span class="skolem">e</span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR4</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?H</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Hash <span class="main">(</span>pubAK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>pubAK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="var">?A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR4</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span>
    <span class="main">⦃</span>pubAK <span class="skolem">e</span><span class="main">,</span> Auth_Data <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="skolem">b</span><span class="main">,</span> <span class="var">?M</span><span class="main">⦄</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_crypt_out analz_mpair analz_simp_insert_2 A<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>pubSK CA<span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_valid_key_analz<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">{</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">,</span> <span class="var">?H</span><span class="main">}</span> <span class="main">∪</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="main">∉</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_auth_key_analz<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_int_mapk_analz<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="main">(</span>priAK <span class="skolem">n</span><span class="main">)</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>insert <span class="var">?M</span> <span class="var">?A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">subst</span> insert_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_mpair analz_simp_insert_2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
     <span class="operator">subst</span> analz_auth_data_out <span class="main"><span class="main">[</span></span><span class="operator">OF</span> E F<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A D<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR4</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">f</span> <span class="skolem">g</span>
  <span class="keyword1"><span class="command">let</span></span>
    <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR4</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?H</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>pubAK <span class="skolem">g</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="var"><span class="quoted"><span class="var">?M'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>pubAK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span>
      Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="var">?A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR4</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span>
   <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">⟶</span>
      Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span> Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">⟶</span>
    Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">⟶</span> <span class="var">?Q</span> <span class="main">⟶</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span>
      <span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span> Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Decrypt<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span> Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>
        <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Snd<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Fst<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Auth_Fst <span class="main"><span class="main">[</span></span><span class="operator">OF</span> E<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Auth_Snd <span class="main"><span class="main">[</span></span><span class="operator">OF</span> E<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span>
        Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M'</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span>
        Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_snd<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_analz_fst<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span>
        Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_auth_data<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"Auth_Data <span class="skolem">g</span> <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?Q</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Auth_Fst <span class="main"><span class="main">[</span></span><span class="operator">OF</span> E<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Auth_Snd <span class="main"><span class="main">[</span></span><span class="operator">OF</span> E<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M'</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_crypt_out analz_mpair analz_simp_insert_2 A<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>pubSK CA<span class="main">)</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_valid_key_analz<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">{</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">,</span> <span class="var">?H</span><span class="main">}</span> <span class="main">∪</span> analz <span class="var">?A</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_simp_insert_2<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>insert <span class="var">?M</span> <span class="var">?A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∨</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span> <span class="main">∨</span>
        Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="var">?A</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> D <span class="keyword2"><span class="keyword">and</span></span> E <span class="keyword2"><span class="keyword">and</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Pri_AgrK <span class="skolem">b</span><span class="main">)</span>
        <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> rev_subsetD<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> analz_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∈</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword2"><span class="keyword">and</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">subst</span> insert_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_mpair analz_simp_insert_2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
       <span class="operator">subst</span> analz_auth_data_in <span class="main"><span class="main">[</span></span><span class="operator">OF</span> H<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> Un_insert_right<span class="main"><span class="keyword3">,</span></span>
       <span class="operator">subst</span> analz_simp_insert_1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> J<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> analz_simp_insert_1 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> K<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A F<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∉</span> analz <span class="var">?A</span> <span class="main">∧</span> Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> analz <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">g</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"Pri_AgrK <span class="skolem">b</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="var">?H</span><span class="main">)</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword2"><span class="keyword">and</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">subst</span> insert_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_mpair analz_simp_insert_2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
       <span class="operator">subst</span> analz_auth_data_out <span class="main"><span class="main">[</span></span><span class="operator">OF</span> H I<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A F<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m'</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">X</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span>pubAK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span>
    Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC5</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    F<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    G<span class="main">:</span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    H<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    I<span class="main">:</span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">4</span> <span class="skolem">X</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="var">?M</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsC5</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m'</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC5</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC5</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_crypt_out analz_simp_insert_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> notI<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="skolem">m'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"User <span class="skolem">m'</span> <span class="main">≠</span> Spy"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_key_secrecy_aux <span class="main"><span class="main">[</span></span><span class="operator">OF</span> C _ D E F G H I<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC5</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_key_analz invK_sesK<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFC5</span> <span class="skolem">A</span> <span class="skolem">n</span> <span class="skolem">d</span> <span class="skolem">e</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>
    <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_crypt_out analz_simp_insert_2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> notI<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span> <span class="main">∨</span>
      Passwd <span class="skolem">n</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">∨</span> <span class="var">?Q</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="skolem">n</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> analz.Decrypt<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="skolem">n</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="skolem">n</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_simp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="skolem">n</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="skolem">n</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR5</span> <span class="skolem">A</span> <span class="skolem">d</span> <span class="skolem">e</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR5</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR5</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR5</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_crypt_out analz_simp_insert_2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR5</span> <span class="skolem">A</span> <span class="skolem">c</span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="free">m</span> <span class="main">∉</span> analz <span class="main">(</span>insert <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>invK <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> analz_crypt_in analz_crypt_out analz_simp_insert_2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Authenticity theorems"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
This section contains a series of lemmas culminating in the authenticity theorems
<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pr_user_authenticity›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pr_card_authenticity›</span></span></span></span>. Structured Isar proofs are used.

\null
›</span></span>

<span class="keyword1" id="Protocol-pr_passwd_parts"><span class="command">lemma</span></span> pr_passwd_parts <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span> <span class="main">⟶</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> Says <span class="bound">n</span> <span class="bound">run</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Card <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span><span class="main">)</span> <span class="main">∨</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">run</span><span class="main">.</span> Says <span class="free">m</span> <span class="bound">run</span> <span class="numeral">5</span> Spy <span class="main">(</span>Card <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="var">?M</span> <span class="main">∈</span> <span class="main">_</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="free">evs</span> <span class="main">∨</span> <span class="var">?Q</span> <span class="free">evs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> parts_simp<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> parts_simp_insert parts_auth_data parts_crypt parts_mpair<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>

<span class="keyword1" id="Protocol-pr_unique_run_1"><span class="command">lemma</span></span> pr_unique_run_1 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    <span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="free">m</span><span class="main">)</span><span class="main">,</span> Number <span class="free">n'</span><span class="main">,</span> Number <span class="free">run'</span><span class="main">⦄</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">⟶</span>
    IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span> <span class="main">⟶</span>
    ExtAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">e</span> <span class="main">⟶</span>
  <span class="free">n'</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">run'</span> <span class="main">=</span> <span class="free">run</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>4<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>5<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main">-</span>3<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> ccontr<span class="main">)</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s'</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="free">m</span><span class="main">)</span><span class="main">,</span> Number <span class="free">n'</span><span class="main">,</span> Number <span class="free">run'</span><span class="main">⦄</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_user_2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> A<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> sesK_inj <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> injD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_card<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d'</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> sesK_inj <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> injD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_card<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_unique_run_2"><span class="command">lemma</span></span> pr_unique_run_2<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n'</span><span class="main">,</span> <span class="free">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">c</span> <span class="main">⟹</span>
    ExtAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n'</span><span class="main">,</span> <span class="free">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">f</span> <span class="main">⟹</span>
    IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span> <span class="main">⟹</span>
    ExtAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">e</span> <span class="main">⟹</span>
    <span class="free">d</span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> <span class="free">c</span> <span class="main">*</span> <span class="free">f</span> <span class="main">⟹</span>
  <span class="free">n'</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">run'</span> <span class="main">=</span> <span class="free">run</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">frule</span> pr_sesk_user_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> sym <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">d</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">e</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_run_1<span class="main">)</span>

<span class="keyword1" id="Protocol-pr_unique_run_3"><span class="command">lemma</span></span> pr_unique_run_3 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n'</span><span class="main">,</span> <span class="free">n'</span><span class="main">,</span> <span class="free">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d'</span> <span class="main">⟶</span>
    ExtAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n'</span><span class="main">,</span> <span class="free">n'</span><span class="main">,</span> <span class="free">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">e'</span> <span class="main">⟶</span>
    IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span> <span class="main">⟶</span>
    ExtAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">e</span> <span class="main">⟶</span>
    <span class="free">d</span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> <span class="free">d'</span> <span class="main">*</span> <span class="free">e'</span> <span class="main">⟶</span>
  <span class="free">n'</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">run'</span> <span class="main">=</span> <span class="free">run</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">s'</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">e'</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">d'</span> <span class="main">*</span> <span class="free">e'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_card<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> <span class="free">d'</span> <span class="main">*</span> <span class="free">e'</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s'</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">e'</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d'</span> <span class="main">*</span> <span class="free">e'</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="free">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_card<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> <span class="free">d'</span> <span class="main">*</span> <span class="free">e'</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="free">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="free">d'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_unique_run_4"><span class="command">lemma</span></span> pr_unique_run_4 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    Says <span class="free">n'</span> <span class="free">run'</span> <span class="numeral">5</span> <span class="free">X</span> <span class="main">(</span>Card <span class="free">n'</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span> <span class="main">⟶</span>
    IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span> <span class="main">⟶</span>
    ExtAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">e</span> <span class="main">⟶</span>
  <span class="free">n'</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">run'</span> <span class="main">=</span> <span class="free">run</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> defined_all<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>3<span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main">-</span>3<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">s'</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"Says <span class="free">n'</span> <span class="free">run'</span> <span class="numeral">5</span> <span class="free">X</span> <span class="main">(</span>Card <span class="free">n'</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsR3</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_passwd<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> A<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="free">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s'</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">n'</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="free">run'</span> <span class="main">=</span> <span class="skolem">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">c</span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> sesK_inj <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> injD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="skolem">run'</span> <span class="main">=</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_run_2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFC5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">d'</span> <span class="skolem">e'</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFC5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">d'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">e'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sesK <span class="main">(</span><span class="free">d</span> <span class="main">*</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">d'</span> <span class="main">*</span> <span class="skolem">e'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> sesK_inj <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">*</span> <span class="free">e</span> <span class="main">=</span> <span class="skolem">d'</span> <span class="main">*</span> <span class="skolem">e'</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> injD<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="skolem">run'</span> <span class="main">=</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_run_3<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> pr_user_authenticity <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    Says <span class="free">n</span> <span class="free">run</span> <span class="numeral">5</span> <span class="free">X</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span> <span class="main">⟶</span>
  Says <span class="free">n</span> <span class="free">run</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFC5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">d</span> <span class="skolem">e</span>
  <span class="keyword3"><span class="command">assume</span></span>
   A<span class="main">:</span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">5</span> Spy <span class="main">(</span>Card <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFC5</span> <span class="main">⟶</span>
     Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFC5</span>"</span></span>
     <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟶</span> <span class="var">?T</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
   B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFC5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   C<span class="main">:</span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   D<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   E<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?T</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"User <span class="skolem">n</span> <span class="main">≠</span> Spy"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"Passwd <span class="skolem">n</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_passwd_secrecy<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span> <span class="main">∨</span>
      Passwd <span class="skolem">n</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">∨</span> <span class="var">?Q</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?Q</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="skolem">n</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="skolem">n</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_simp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
       <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n'</span> <span class="bound">run'</span><span class="main">.</span> Says <span class="bound">n'</span> <span class="bound">run'</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Card <span class="bound">n'</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∈</span> set <span class="skolem">evsFC5</span><span class="main">)</span> <span class="main">∨</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">run'</span><span class="main">.</span> Says <span class="skolem">n</span> <span class="bound">run'</span> <span class="numeral">5</span> Spy <span class="main">(</span>Card <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∈</span> set <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n'</span> <span class="bound">run'</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n'</span> <span class="bound">run'</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">run'</span><span class="main">.</span> <span class="var">?Q</span> <span class="bound">run'</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_passwd_parts<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n'</span> <span class="bound">run'</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n'</span> <span class="bound">run'</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">n'</span> <span class="skolem">run'</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">run'</span> <span class="main">=</span> <span class="skolem">run</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_run_4 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B _ C D<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">run'</span><span class="main">.</span> <span class="var">?Q</span> <span class="bound">run'</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">run'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">run'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">run'</span> <span class="main">=</span> <span class="skolem">run</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_run_4 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B _ C D<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">run</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_confirm_parts"><span class="command">lemma</span></span> pr_confirm_parts <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span> <span class="main">⟶</span>
    Key <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟶</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span> <span class="bound">X</span><span class="main">.</span>
    Says <span class="bound">n</span> <span class="bound">run</span> <span class="numeral">5</span> <span class="bound">X</span> <span class="main">(</span>Card <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span> <span class="main">∧</span>
    Says <span class="bound">n</span> <span class="bound">run</span> <span class="numeral">5</span> <span class="main">(</span>Card <span class="bound">n</span><span class="main">)</span> <span class="bound">X</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span> <span class="main">_</span> <span class="main">⟶</span> <span class="main">_</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="free">K</span> <span class="free">evs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> defined_all<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> parts_simp<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> parts_simp_insert parts_auth_data parts_crypt parts_mpair<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">c</span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="var">?P</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">evsFR5</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span> <span class="skolem">evsFR5</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span> <span class="main">∨</span>
      Number <span class="main">0</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_key_analz<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_confirm_says"><span class="command">lemma</span></span> pr_confirm_says <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    Says <span class="free">n</span> <span class="free">run</span> <span class="numeral">5</span> <span class="free">X</span> Spy <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span> <span class="main">⟶</span>
  Says <span class="free">n</span> <span class="free">run</span> <span class="numeral">5</span> Spy <span class="main">(</span>Card <span class="free">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Protocol-pr_passwd_says"><span class="command">lemma</span></span> pr_passwd_says <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    Says <span class="free">n</span> <span class="free">run</span> <span class="numeral">5</span> <span class="free">X</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span> <span class="main">⟶</span>
  <span class="free">X</span> <span class="main">=</span> User <span class="free">m</span> <span class="main">∨</span> <span class="free">X</span> <span class="main">=</span> Spy"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="Protocol-pr_unique_run_5"><span class="command">lemma</span></span> pr_unique_run_5 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    <span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="free">m'</span><span class="main">)</span><span class="main">,</span> Number <span class="free">n'</span><span class="main">,</span> Number <span class="free">run'</span><span class="main">⦄</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">⟶</span>
    <span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="free">m</span><span class="main">)</span><span class="main">,</span> Number <span class="free">n</span><span class="main">,</span> Number <span class="free">run</span><span class="main">⦄</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">⟶</span>
  <span class="free">m</span> <span class="main">=</span> <span class="free">m'</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">=</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">run</span> <span class="main">=</span> <span class="free">run'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> defined_all<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>4<span class="main"><span class="improper">]</span></span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>4<span class="main">-</span>5<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="free">m</span><span class="main">)</span><span class="main">,</span> Number <span class="free">n</span><span class="main">,</span> Number <span class="free">run</span><span class="main">⦄</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_user_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="free">m'</span><span class="main">)</span><span class="main">,</span> Number <span class="free">n'</span><span class="main">,</span> Number <span class="free">run'</span><span class="main">⦄</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_user_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="free">m</span><span class="main">)</span><span class="main">,</span> Number <span class="free">n</span><span class="main">,</span> Number <span class="free">run</span><span class="main">⦄</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_user_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="free">m'</span><span class="main">)</span><span class="main">,</span> Number <span class="free">n'</span><span class="main">,</span> Number <span class="free">run'</span><span class="main">⦄</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_user_2<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_unique_run_6"><span class="command">lemma</span></span> pr_unique_run_6<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    <span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="free">m'</span><span class="main">)</span><span class="main">,</span> Number <span class="free">n'</span><span class="main">,</span> Number <span class="free">run'</span><span class="main">⦄</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">⟹</span>
    IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">c</span> <span class="main">⟹</span>
    ExtAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">f</span> <span class="main">⟹</span>
  <span class="free">m</span> <span class="main">=</span> <span class="free">m'</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">=</span> <span class="free">n'</span> <span class="main">∧</span> <span class="free">run</span> <span class="main">=</span> <span class="free">run'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">frule</span> pr_sesk_user_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_run_5<span class="main">)</span>

<span class="keyword1" id="Protocol-pr_unique_run_7"><span class="command">lemma</span></span> pr_unique_run_7 <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    Says <span class="free">n'</span> <span class="free">run'</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="free">m'</span><span class="main">)</span> <span class="main">(</span>Card <span class="free">n'</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span> <span class="main">⟶</span>
    <span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="free">m</span><span class="main">)</span><span class="main">,</span> Number <span class="free">n</span><span class="main">,</span> Number <span class="free">run</span><span class="main">⦄</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">⟶</span>
    Key <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟶</span>
  <span class="free">m'</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">n'</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">run'</span> <span class="main">=</span> <span class="free">run</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main">-</span>3<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">drule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> sym <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">m'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> sym <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR3</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">d</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR3</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"Says <span class="free">n'</span> <span class="free">run'</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="free">m'</span><span class="main">)</span> <span class="main">(</span>Card <span class="free">n'</span><span class="main">)</span>
      <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsR3</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_sesk_passwd<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">d</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">n'</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="free">run'</span> <span class="main">=</span> <span class="skolem">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m'</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">c</span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">⦃</span>Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Agent <span class="main">(</span>User <span class="free">m</span><span class="main">)</span><span class="main">,</span> Number <span class="free">n</span><span class="main">,</span> Number <span class="free">run</span><span class="main">⦄</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">f</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="skolem">n'</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="skolem">run'</span> <span class="main">=</span> <span class="free">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_run_6<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFC5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">run'</span> <span class="skolem">d</span> <span class="skolem">e</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Says <span class="main">0</span> <span class="skolem">run'</span> <span class="numeral">5</span> Spy <span class="main">(</span>Card <span class="main">0</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFC5</span> <span class="main">⟶</span>
      <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">run'</span> <span class="main">=</span> <span class="free">run</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFC5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">d</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>Card <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="skolem">run'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    F<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span> <span class="main">∨</span>
    Passwd <span class="main">0</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_key_analz<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> Says <span class="bound">n</span> <span class="bound">run</span> <span class="numeral">5</span> Spy <span class="main">(</span>Card <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="main">0</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∈</span> set <span class="skolem">evsFC5</span><span class="main">)</span> <span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">run</span><span class="main">.</span> Says <span class="main">0</span> <span class="bound">run</span> <span class="numeral">5</span> Spy <span class="main">(</span>Card <span class="main">0</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="main">0</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∈</span> set <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n</span> <span class="bound">run</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">run</span><span class="main">.</span> <span class="var">?Q</span> <span class="bound">run</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_passwd_parts<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n</span> <span class="bound">run</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n''</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">n''</span> <span class="skolem">run''</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">run''</span> <span class="main">=</span> <span class="skolem">run'</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_run_4 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B _ C D<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">0</span> <span class="skolem">run'</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">run</span><span class="main">.</span> <span class="var">?Q</span> <span class="bound">run</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">run''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">run''</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n</span> <span class="skolem">run''</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">n''</span> <span class="skolem">run''</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n''</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">run''</span> <span class="main">=</span> <span class="skolem">run'</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_run_4 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B _ C D<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">0</span> <span class="skolem">run'</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">0</span> <span class="skolem">run'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">run'</span> <span class="main">=</span> <span class="free">run</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Protocol-pr_unique_run_8"><span class="command">lemma</span></span> pr_unique_run_8<span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    Says <span class="free">n'</span> <span class="free">run'</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="free">m'</span><span class="main">)</span> <span class="main">(</span>Card <span class="free">n'</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span> <span class="main">⟹</span>
    IntAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">c</span> <span class="main">⟹</span>
    ExtAgrK <span class="main">(</span><span class="free">S</span> <span class="main">(</span>User <span class="free">m</span><span class="main">,</span> <span class="free">n</span><span class="main">,</span> <span class="free">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">f</span> <span class="main">⟹</span>
    Key <span class="main">(</span>sesK <span class="main">(</span><span class="free">c</span> <span class="main">*</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟹</span>
  <span class="free">m'</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span> <span class="free">n'</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">run'</span> <span class="main">=</span> <span class="free">run</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">frule</span> pr_sesk_user_1<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_run_7<span class="main">)</span>

<span class="keyword1" id="Protocol-pr_unique_passwd_parts"><span class="command">lemma</span></span> pr_unique_passwd_parts <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m'</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span> <span class="main">⟶</span>
    Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> spies <span class="free">evs</span><span class="main">)</span> <span class="main">⟶</span>
  <span class="free">m'</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> defined_all<span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> parts_simp<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> parts_simp_insert parts_auth_data parts_crypt parts_mpair<span class="main"><span class="keyword3">,</span></span>
 <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m''</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">X</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m''</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m''</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m''</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m''</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    F<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m''</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    G<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC5</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">=</span> <span class="skolem">m''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    I<span class="main">:</span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">4</span> <span class="skolem">X</span> <span class="main">(</span>User <span class="skolem">m''</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>
      <span class="main">⦃</span>pubAK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span>
       Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsC5</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m''</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">m''</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> classical<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m''</span> <span class="main">≠</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"User <span class="free">m</span> <span class="main">≠</span> Spy"</span></span>
     <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> Says <span class="bound">n</span> <span class="bound">run</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Card <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∈</span> set <span class="skolem">evsC5</span><span class="main">)</span> <span class="main">∨</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">run</span><span class="main">.</span> Says <span class="free">m</span> <span class="bound">run</span> <span class="numeral">5</span> Spy <span class="main">(</span>Card <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∈</span> set <span class="skolem">evsC5</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n</span> <span class="bound">run</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">run</span><span class="main">.</span> <span class="var">?Q</span> <span class="bound">run</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_passwd_parts<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n</span> <span class="bound">run</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run'</span></span> <span class="keyword2"><span class="keyword">where</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">n'</span> <span class="skolem">run'</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> A <span class="keyword2"><span class="keyword">and</span></span> J <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC5</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_key_secrecy<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_key_analz<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="skolem">m''</span> <span class="main">∧</span> <span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">run'</span> <span class="main">=</span> <span class="skolem">run</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_run_8 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A K E F<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">run</span><span class="main">.</span> <span class="var">?Q</span> <span class="bound">run</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">run'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">run'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">m</span> <span class="skolem">run'</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_user_authenticity<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> A <span class="keyword2"><span class="keyword">and</span></span> J <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC5</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_key_secrecy<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_key_analz<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="skolem">m''</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">run'</span> <span class="main">=</span> <span class="skolem">run</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_run_8 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A K E F<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"User <span class="skolem">m''</span> <span class="main">≠</span> Spy"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_key_secrecy_aux <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A _ B C D E F I<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> Says <span class="bound">n</span> <span class="bound">run</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Card <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∈</span> set <span class="skolem">evsC5</span><span class="main">)</span> <span class="main">∨</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">run</span><span class="main">.</span> Says <span class="free">m</span> <span class="bound">run</span> <span class="numeral">5</span> Spy <span class="main">(</span>Card <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∈</span> set <span class="skolem">evsC5</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n</span> <span class="bound">run</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">run</span><span class="main">.</span> <span class="var">?Q</span> <span class="bound">run</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_passwd_parts<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n</span> <span class="bound">run</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">n'</span> <span class="skolem">run'</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="skolem">m''</span> <span class="main">∧</span> <span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">run'</span> <span class="main">=</span> <span class="skolem">run</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_run_8 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A _ E F J<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">run</span><span class="main">.</span> <span class="var">?Q</span> <span class="bound">run</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">run'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">run'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">m</span> <span class="skolem">run'</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_user_authenticity<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="skolem">m''</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">run'</span> <span class="main">=</span> <span class="skolem">run</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_run_8 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A _ E F J<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m''</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">X</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m''</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m''</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m''</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m''</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    F<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m''</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    G<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m'</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC5</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="skolem">m''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    I<span class="main">:</span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">4</span> <span class="skolem">X</span> <span class="main">(</span>User <span class="skolem">m''</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>
      <span class="main">⦃</span>pubAK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span>
       Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsC5</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">=</span> <span class="skolem">m''</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">m''</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> classical<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">≠</span> <span class="skolem">m''</span>"</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"User <span class="free">m'</span> <span class="main">≠</span> Spy"</span></span>
     <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> Says <span class="bound">n</span> <span class="bound">run</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="free">m'</span><span class="main">)</span> <span class="main">(</span>Card <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m'</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∈</span> set <span class="skolem">evsC5</span><span class="main">)</span> <span class="main">∨</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">run</span><span class="main">.</span> Says <span class="free">m'</span> <span class="bound">run</span> <span class="numeral">5</span> Spy <span class="main">(</span>Card <span class="free">m'</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m'</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∈</span> set <span class="skolem">evsC5</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n</span> <span class="bound">run</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">run</span><span class="main">.</span> <span class="var">?Q</span> <span class="bound">run</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_passwd_parts<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n</span> <span class="bound">run</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run'</span></span> <span class="keyword2"><span class="keyword">where</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">n'</span> <span class="skolem">run'</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> A <span class="keyword2"><span class="keyword">and</span></span> J <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC5</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_key_secrecy<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_key_analz<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">=</span> <span class="skolem">m''</span> <span class="main">∧</span> <span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">run'</span> <span class="main">=</span> <span class="skolem">run</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_run_8 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A K E F<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">run</span><span class="main">.</span> <span class="var">?Q</span> <span class="bound">run</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">run'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">run'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">m'</span> <span class="skolem">run'</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_user_authenticity<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> A <span class="keyword2"><span class="keyword">and</span></span> J <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC5</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_key_secrecy<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_key_analz<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">=</span> <span class="skolem">m''</span> <span class="main">∧</span> <span class="free">m'</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">run'</span> <span class="main">=</span> <span class="skolem">run</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_run_8 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A K E F<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"User <span class="skolem">m''</span> <span class="main">≠</span> Spy"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_key_secrecy_aux <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A _ B C D E F I<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> Says <span class="bound">n</span> <span class="bound">run</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="free">m'</span><span class="main">)</span> <span class="main">(</span>Card <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m'</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∈</span> set <span class="skolem">evsC5</span><span class="main">)</span> <span class="main">∨</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">run</span><span class="main">.</span> Says <span class="free">m'</span> <span class="bound">run</span> <span class="numeral">5</span> Spy <span class="main">(</span>Card <span class="free">m'</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m'</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∈</span> set <span class="skolem">evsC5</span><span class="main">)</span>"</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n</span> <span class="bound">run</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">run</span><span class="main">.</span> <span class="var">?Q</span> <span class="bound">run</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_passwd_parts<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n</span> <span class="bound">run</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">n'</span> <span class="skolem">run'</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">=</span> <span class="skolem">m''</span> <span class="main">∧</span> <span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">run'</span> <span class="main">=</span> <span class="skolem">run</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_run_8 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A _ E F J<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">run</span><span class="main">.</span> <span class="var">?Q</span> <span class="bound">run</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">run'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">run'</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">m'</span> <span class="skolem">run'</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_user_authenticity<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">=</span> <span class="skolem">m''</span> <span class="main">∧</span> <span class="free">m'</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">run'</span> <span class="main">=</span> <span class="skolem">run</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_run_8 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A _ E F J<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFC5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">d</span> <span class="skolem">e</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="skolem">n</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFC5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> classical<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span> <span class="main">∨</span>
      Passwd <span class="skolem">n</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> F<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"User <span class="free">m</span> <span class="main">≠</span> Spy"</span></span>
       <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> Says <span class="bound">n</span> <span class="bound">run</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Card <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∈</span> set <span class="skolem">evsFC5</span><span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">run</span><span class="main">.</span> Says <span class="free">m</span> <span class="bound">run</span> <span class="numeral">5</span> Spy <span class="main">(</span>Card <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∈</span> set <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n</span> <span class="bound">run</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">run</span><span class="main">.</span> <span class="var">?Q</span> <span class="bound">run</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_passwd_parts<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n</span> <span class="bound">run</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">n'</span> <span class="skolem">run</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> B <span class="keyword2"><span class="keyword">and</span></span> G <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_key_secrecy<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">run</span><span class="main">.</span> <span class="var">?Q</span> <span class="bound">run</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">run</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">m</span> <span class="skolem">run</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_user_authenticity<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> B <span class="keyword2"><span class="keyword">and</span></span> G <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_key_secrecy<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"User <span class="skolem">n</span> <span class="main">≠</span> Spy"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="skolem">n</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_passwd_secrecy<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="skolem">n</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="skolem">n</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_simp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFC5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">d</span> <span class="skolem">e</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="free">m'</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFC5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m'</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> classical<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m'</span> <span class="main">≠</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span> <span class="main">∨</span>
      Passwd <span class="skolem">n</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> disjE <span class="main"><span class="main">[</span></span><span class="operator">OF</span> F<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"User <span class="free">m'</span> <span class="main">≠</span> Spy"</span></span>
       <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> Says <span class="bound">n</span> <span class="bound">run</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="free">m'</span><span class="main">)</span> <span class="main">(</span>Card <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m'</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∈</span> set <span class="skolem">evsFC5</span><span class="main">)</span> <span class="main">∨</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">run</span><span class="main">.</span> Says <span class="free">m'</span> <span class="bound">run</span> <span class="numeral">5</span> Spy <span class="main">(</span>Card <span class="free">m'</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m'</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∈</span> set <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
        <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n</span> <span class="bound">run</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">run</span><span class="main">.</span> <span class="var">?Q</span> <span class="bound">run</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword2"><span class="keyword">and</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_passwd_parts<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">n</span> <span class="bound">run</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">n'</span> <span class="skolem">run</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> B <span class="keyword2"><span class="keyword">and</span></span> G <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_key_secrecy<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">run</span><span class="main">.</span> <span class="var">?Q</span> <span class="bound">run</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">run</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">run</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
        <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">m'</span> <span class="skolem">run</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_user_authenticity<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> B <span class="keyword2"><span class="keyword">and</span></span> G <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_key_secrecy<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"User <span class="skolem">n</span> <span class="main">≠</span> Spy"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="skolem">n</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_passwd_secrecy<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="skolem">n</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Passwd <span class="skolem">n</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_simp_intro<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">contradiction</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFC5</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> pr_card_authenticity <span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">evs</span><span class="main">,</span> <span class="free">S</span><span class="main">,</span> <span class="free">A</span><span class="main">,</span> <span class="free">U</span><span class="main">)</span> <span class="main">∈</span> protocol <span class="main">⟹</span>
    Says <span class="free">n</span> <span class="free">run</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Card <span class="free">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span> <span class="main">⟶</span>
    Says <span class="free">n</span> <span class="free">run</span> <span class="numeral">5</span> <span class="free">X</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span> <span class="main">⟶</span>
  <span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span>
  <span class="main">(</span>Says <span class="free">m</span> <span class="free">run</span> <span class="numeral">5</span> <span class="main">(</span>Card <span class="free">m</span><span class="main">)</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span> <span class="main">∨</span>
   Says <span class="free">m</span> <span class="free">run</span> <span class="numeral">5</span> <span class="main">(</span>Card <span class="free">m</span><span class="main">)</span> Spy <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">evs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> protocol.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>1<span class="main">-</span>2<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule_tac</span> <span class="main"><span class="improper">[</span></span>2<span class="main"><span class="improper">]</span></span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
 <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>3<span class="main"><span class="improper">]</span></span> conjI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>4<span class="main"><span class="improper">]</span></span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>5<span class="main"><span class="improper">]</span></span> impI<span class="main"><span class="keyword3">,</span></span>
 <span class="main">(</span><span class="operator">rule_tac</span> <span class="main"><span class="improper">[</span></span>6<span class="main"><span class="improper">]</span></span> impI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsC5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">s</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">X'</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∈</span> set <span class="skolem">evsC5</span> <span class="main">⟶</span>
      <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">∧</span>
      <span class="main">(</span>Says <span class="skolem">m</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span>
         <span class="main">∈</span> set <span class="skolem">evsC5</span> <span class="main">∨</span>
       Says <span class="skolem">m</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">)</span> Spy <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span>
         <span class="main">∈</span> set <span class="skolem">evsC5</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsC5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"NonceS <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"IntMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtMapK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    F<span class="main">:</span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    G<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    H<span class="main">:</span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">4</span> <span class="skolem">X'</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>
      <span class="main">⦃</span>pubAK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> Auth_Data <span class="skolem">g</span> <span class="skolem">b</span><span class="main">,</span> pubAK <span class="skolem">g</span><span class="main">,</span>
       Crypt <span class="main">(</span>priSK CA<span class="main">)</span> <span class="main">(</span>Hash <span class="main">(</span>pubAK <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">⦄</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsC5</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    I<span class="main">:</span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="free">X</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsC5</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">∧</span>
    <span class="main">(</span>Says <span class="skolem">m</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsC5</span> <span class="main">∨</span>
     Says <span class="skolem">m</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">)</span> Spy <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsC5</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="free">X</span> Spy <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsC5</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">5</span> Spy <span class="main">(</span>Card <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∈</span> set <span class="skolem">evsC5</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_confirm_says<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∈</span> set <span class="skolem">evsC5</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_user_authenticity<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∈</span> set <span class="skolem">evsC5</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> J <span class="keyword2"><span class="keyword">and</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Suc
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"User <span class="skolem">n</span> <span class="main">≠</span> Spy"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC5</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_key_secrecy<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_key_analz<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">run</span> <span class="main">=</span> <span class="skolem">run</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_run_8 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B J F G<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>
        <span class="main">∈</span> set <span class="skolem">evsC5</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> spies <span class="skolem">evsC5</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_spies<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC5</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsC5</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"User <span class="skolem">m</span> <span class="main">≠</span> Spy"</span></span>
     <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_key_secrecy_aux <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B _ C D E F G H<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span> <span class="bound">X</span><span class="main">.</span>
      Says <span class="bound">n</span> <span class="bound">run</span> <span class="numeral">5</span> <span class="bound">X</span> <span class="main">(</span>Card <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsC5</span> <span class="main">∧</span>
      Says <span class="bound">n</span> <span class="bound">run</span> <span class="numeral">5</span> <span class="main">(</span>Card <span class="bound">n</span><span class="main">)</span> <span class="bound">X</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsC5</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_confirm_parts <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     <span class="quoted"><span class="quoted">"Says <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="numeral">5</span> <span class="skolem">X</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsC5</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span>
     <span class="quoted"><span class="quoted">"Says <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsC5</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_user_authenticity<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">run'</span> <span class="main">=</span> <span class="skolem">run</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_run_8 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> B _ F G J<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
     <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsC5</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFC5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">run</span> <span class="skolem">d</span> <span class="skolem">e</span>
  <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"Says <span class="main">0</span> <span class="skolem">run</span> <span class="numeral">5</span> Spy <span class="main">(</span>Card <span class="main">0</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFC5</span> <span class="main">⟶</span>
    Says <span class="main">0</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="main">(</span>Card <span class="main">0</span><span class="main">)</span> Spy <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFC5</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFC5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"Says <span class="main">0</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="free">X</span> Spy <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFC5</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Says <span class="main">0</span> <span class="skolem">run</span> <span class="numeral">5</span> Spy <span class="main">(</span>Card <span class="main">0</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFC5</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_confirm_says<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span>
   <span class="quoted"><span class="quoted">"Says <span class="main">0</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="main">(</span>Card <span class="main">0</span><span class="main">)</span> Spy <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFC5</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">X</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="skolem">X</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∈</span> set <span class="skolem">evsR5</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> spies <span class="skolem">evsR5</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_spies<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR5</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR5</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="skolem">X</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∈</span> set <span class="skolem">evsR5</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span> <span class="main">∈</span> spies <span class="skolem">evsR5</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_spies<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR5</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR5</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="free">m</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_passwd_parts<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">X</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsR5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="skolem">X</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∈</span> set <span class="skolem">evsR5</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span> <span class="main">∈</span> spies <span class="skolem">evsR5</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_spies<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR5</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="free">m</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR5</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="skolem">X</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>
    <span class="main">∈</span> set <span class="skolem">evsR5</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> spies <span class="skolem">evsR5</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_spies<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR5</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsR5</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_passwd_parts<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsR5</span> <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="skolem">d</span> <span class="skolem">e</span> <span class="skolem">X</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">m</span> <span class="main">∧</span>
    <span class="main">(</span>Says <span class="free">m</span> <span class="free">run</span> <span class="numeral">5</span> <span class="main">(</span>Card <span class="free">m</span><span class="main">)</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsR5</span> <span class="main">∨</span>
     Says <span class="free">m</span> <span class="free">run</span> <span class="numeral">5</span> <span class="main">(</span>Card <span class="free">m</span><span class="main">)</span> Spy <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsR5</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">=</span> <span class="skolem">n'</span> <span class="main">∧</span> <span class="free">run</span> <span class="main">=</span> <span class="skolem">run'</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">=</span> <span class="skolem">n'</span> <span class="main">∧</span> User <span class="free">m</span> <span class="main">=</span> <span class="skolem">X</span> <span class="main">∧</span> sesK <span class="free">K</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">∨</span>
    Says <span class="free">m</span> <span class="free">run</span> <span class="numeral">5</span> <span class="main">(</span>Card <span class="free">m</span><span class="main">)</span> <span class="main">(</span>User <span class="free">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsR5</span> <span class="main">∨</span>
    <span class="free">m</span> <span class="main">=</span> <span class="skolem">n'</span> <span class="main">∧</span> <span class="free">run</span> <span class="main">=</span> <span class="skolem">run'</span> <span class="main">∧</span> <span class="free">m</span> <span class="main">=</span> <span class="skolem">n'</span> <span class="main">∧</span> Spy <span class="main">=</span> <span class="skolem">X</span> <span class="main">∧</span> sesK <span class="free">K</span> <span class="main">=</span> sesK <span class="main">(</span><span class="skolem">d</span> <span class="main">*</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">∨</span>
    Says <span class="free">m</span> <span class="free">run</span> <span class="numeral">5</span> <span class="main">(</span>Card <span class="free">m</span><span class="main">)</span> Spy <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="free">K</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsR5</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">evsFR5</span> <span class="skolem">S</span> <span class="skolem">A</span> <span class="skolem">U</span> <span class="skolem">m</span> <span class="skolem">n</span> <span class="skolem">run</span> <span class="skolem">c</span> <span class="skolem">f</span>
  <span class="keyword3"><span class="command">assume</span></span>
    A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">evsFR5</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">A</span><span class="main">,</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∈</span> protocol"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    C<span class="main">:</span> <span class="quoted"><span class="quoted">"IntAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    D<span class="main">:</span> <span class="quoted"><span class="quoted">"ExtAgrK <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">,</span> <span class="skolem">n</span><span class="main">,</span> <span class="skolem">run</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Some <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    E<span class="main">:</span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    F<span class="main">:</span> <span class="quoted"><span class="quoted">"Says <span class="skolem">n</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Card <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFR5</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"User <span class="skolem">m</span> <span class="main">≠</span> Spy"</span></span>
   <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_key_secrecy<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span> <span class="main">∨</span>
    Number <span class="main">0</span> <span class="main">∈</span> synth <span class="main">(</span>analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
    Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> synth_crypt<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> analz <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> analz_parts_subset<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"Key <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> A <span class="keyword2"><span class="keyword">and</span></span> G <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_key_analz<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="bound">run</span> <span class="bound">X</span><span class="main">.</span>
    Says <span class="bound">n</span> <span class="bound">run</span> <span class="numeral">5</span> <span class="bound">X</span> <span class="main">(</span>Card <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFR5</span> <span class="main">∧</span>
    Says <span class="bound">n</span> <span class="bound">run</span> <span class="numeral">5</span> <span class="main">(</span>Card <span class="bound">n</span><span class="main">)</span> <span class="bound">X</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFR5</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_confirm_parts <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">run'</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> I<span class="main">:</span>
   <span class="quoted"><span class="quoted">"Says <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="numeral">5</span> <span class="skolem">X</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFR5</span> <span class="main">∧</span>
    Says <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="numeral">5</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFR5</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span>
   <span class="quoted"><span class="quoted">"Says <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="numeral">5</span> <span class="skolem">X</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFR5</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> J<span class="main">:</span>
   <span class="quoted"><span class="quoted">"Says <span class="skolem">n'</span> <span class="skolem">run'</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span>Card <span class="skolem">n'</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n'</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∈</span> set <span class="skolem">evsFR5</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_user_authenticity<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n'</span><span class="main">)</span> <span class="main">∈</span> spies <span class="skolem">evsFR5</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_spies<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">n'</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span> <span class="main">∈</span> spies <span class="skolem">evsFR5</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_spies<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span> <span class="main">∈</span> parts <span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> spies <span class="skolem">evsFR5</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> parts.Inj<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">m</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_passwd_parts <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span>
   <span class="quoted"><span class="quoted">"Says <span class="skolem">m</span> <span class="skolem">run'</span> <span class="numeral">5</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>
      <span class="main">∈</span> set <span class="skolem">evsFR5</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">run'</span> <span class="main">=</span> <span class="skolem">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_unique_run_8 <span class="main"><span class="main">[</span></span><span class="operator">OF</span> A _ C D H<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="skolem">run'</span> <span class="main">=</span> <span class="skolem">run</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> L<span class="main">:</span>
   <span class="quoted"><span class="quoted">"Says <span class="skolem">m</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="skolem">X</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFR5</span> <span class="main">∧</span>
    Says <span class="skolem">m</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFR5</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span>
   <span class="quoted"><span class="quoted">"Says <span class="skolem">m</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="skolem">X</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Passwd <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFR5</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> User <span class="skolem">m</span> <span class="main">∨</span> <span class="skolem">X</span> <span class="main">=</span> Spy"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> pr_passwd_says<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">m</span> <span class="main">∧</span>
   <span class="main">(</span>Says <span class="skolem">m</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>User <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFR5</span> <span class="main">∨</span>
    Says <span class="skolem">m</span> <span class="skolem">run</span> <span class="numeral">5</span> <span class="main">(</span>Card <span class="skolem">m</span><span class="main">)</span> Spy <span class="main">(</span>Crypt <span class="main">(</span>sesK <span class="main">(</span><span class="skolem">c</span> <span class="main">*</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Number <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">evsFR5</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> L<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> K<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>