<div id="Ptolemys_Theorem">
<div class="head">
<h1>Theory Ptolemys_Theorem</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Lukas Bulwahn &lt;lukas.bulwahn-at-gmail.com&gt; *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Ptolemy's Theorem›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Ptolemys_Theorem
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Analysis/Multivariate_Analysis.html">HOL-Analysis.Multivariate_Analysis</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Additions to Rat theory›</span></span>

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> normalize

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Additions to Transcendental theory›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Lemmas about <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> arcsin<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> arccos<span class="antiquote"><span class="antiquote">}</span></span></span></span> commonly involve to show that their argument is
in the domain of those partial functions, i.e., the argument <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is between <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">-</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">::</span></span>real"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">::</span></span>real"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
As the argumentation for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">-</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">::</span></span>real<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">≤</span></span> <span class="free"><span class="free">y</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">y</span></span> <span class="main"><span class="main">≤</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">::</span></span>real<span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is often very similar,
we prefer to prove <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">¦</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">¦</span></span> <span class="main"><span class="main">≤</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">::</span></span>real<span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to the two goals above.

The lemma for rewriting the term <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"cos <span class="main"><span class="main">(</span></span>arccos <span class="free"><span class="free">y</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is already provided in the Isabelle
distribution with name <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] cos_arccos_abs<span class="antiquote"><span class="antiquote">}</span></span></span></span>. Here, we further provide the analogue on
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"arcsin"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for rewriting <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"sin <span class="main"><span class="main">(</span></span>arcsin <span class="free"><span class="free">y</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1" id="Ptolemys_Theorem-sin_arcsin_abs"><span class="command">lemma</span></span> sin_arcsin_abs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">y</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span> sin <span class="main">(</span>arcsin <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_le_iff<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The further lemmas are the required variants from existing lemmas <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] arccos_lbound<span class="antiquote"><span class="antiquote">}</span></span></span></span>
and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [source] arccos_ubound<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1" id="Ptolemys_Theorem-arccos_lbound_abs"><span class="command">lemma</span></span> arccos_lbound_abs <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">y</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> arccos <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arccos_lbound<span class="main">)</span>

<span class="keyword1" id="Ptolemys_Theorem-arccos_ubound_abs"><span class="command">lemma</span></span> arccos_ubound_abs <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">y</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">⟹</span> arccos <span class="free">y</span> <span class="main">≤</span> pi"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arccos_ubound<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
As we choose angles to be between <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">0</span></span><span class="main"><span class="main">::</span></span>real"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> between <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="numeral"><span class="numeral">2</span></span> <span class="main"><span class="main">*</span></span> pi"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
we need some lemmas to reason about the sign of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"sin <span class="free"><span class="free">x</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
for angles <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1" id="Ptolemys_Theorem-sin_ge_zero_iff"><span class="command">lemma</span></span> sin_ge_zero_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> sin <span class="free">x</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> pi"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> sin <span class="free">x</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> pi"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">x</span> <span class="main">≤</span> pi"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sin_lt_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> sin <span class="free">x</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> pi"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> sin <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_ge_zero<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ptolemys_Theorem-sin_less_zero_iff"><span class="command">lemma</span></span> sin_less_zero_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sin <span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> pi <span class="main">&lt;</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms sin_ge_zero_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Addition to Finite-Cartesian-Product theory›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Here follow generally useful additions and specialised equations
for two-dimensional real-valued vectors.
›</span></span>

<span class="keyword1" id="Ptolemys_Theorem-axis_nth_eq_0"><span class="command">lemma</span></span> axis_nth_eq_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="free">j</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"axis <span class="free">i</span> <span class="free">x</span> <span class="main">$</span> <span class="free">j</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> axis_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Ptolemys_Theorem-norm_axis"><span class="command">lemma</span></span> norm_axis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span>axis <span class="free">i</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> abs <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_eq_sqrt_inner inner_axis_axis<span class="main">)</span>

<span class="keyword1" id="Ptolemys_Theorem-norm_eq_on_real_2_vec"><span class="command">lemma</span></span> norm_eq_on_real_2_vec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">^</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">x</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="free">x</span> <span class="main">$</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_eq_sqrt_inner inner_vec_def UNIV_2 power2_eq_square<span class="main">)</span>

<span class="keyword1" id="Ptolemys_Theorem-dist_eq_on_real_2_vec"><span class="command">lemma</span></span> dist_eq_on_real_2_vec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">^</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dist <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">$</span> <span class="main">1</span> <span class="main">-</span> <span class="free">b</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="free">a</span> <span class="main">$</span> <span class="numeral">2</span> <span class="main">-</span> <span class="free">b</span> <span class="main">$</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> dist_norm norm_eq_on_real_2_vec <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Polar Form of Two-Dimensional Real-Valued Vectors›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions to Transfer to Polar Form and Back›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">of_radiant</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">^</span> <span class="numeral">2</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">of_radiant</span> <span class="free"><span class="bound"><span class="entity">ω</span></span></span> <span class="main">=</span> axis <span class="main">1</span> <span class="main">(</span>cos <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">)</span> <span class="main">+</span> axis <span class="numeral">2</span> <span class="main">(</span>sin <span class="free"><span class="bound"><span class="entity">ω</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">normalize</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">^</span> <span class="numeral">2</span> <span class="main">⇒</span> real <span class="main">^</span> <span class="numeral">2</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">normalize</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> axis <span class="main">1</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> norm <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">radiant_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">^</span> <span class="numeral">2</span> <span class="main">⇒</span> real"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">radiant_of</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">ω</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">ω</span> <span class="main">∧</span> <span class="bound">ω</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">∧</span> of_radiant <span class="bound">ω</span> <span class="main">=</span> normalize <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The vector <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"of_radiant <span class="free"><span class="free">ω</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the vector with length <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">::</span></span>real"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and angle <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">ω</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
to the first axis.
We normalize vectors to length <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">::</span></span>real"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> keeping their orientation with the normalize function.
Conversely, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"radiant_of <span class="free"><span class="free">p</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the angle of vector <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to the first axis, where we
choose <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"radiant_of"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to return angles between <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">0</span></span><span class="main"><span class="main">::</span></span>real"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="numeral"><span class="numeral">2</span></span> <span class="main"><span class="main">*</span></span> pi"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
following the usual high-school convention.
With these definitions, we can express the main result
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"norm <span class="free"><span class="free">p</span></span> <span class="keyword1"><span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span></span> of_radiant <span class="main"><span class="main">(</span></span>radiant_of <span class="free"><span class="free">p</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">p</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
Note that the main result holds for any definition of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"radiant_of <span class="main"><span class="main">0</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
So, we choose to define <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"normalize <span class="main"><span class="main">0</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"radiant_of <span class="main"><span class="main">0</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, such that
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"radiant_of <span class="main"><span class="main">0</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">0</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Lemmas on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> of_radiant<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Ptolemys_Theorem-nth_of_radiant_1"><span class="command">lemma</span></span> nth_of_radiant_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"of_radiant <span class="free">ω</span> <span class="main">$</span> <span class="main">1</span> <span class="main">=</span> cos <span class="free">ω</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> of_radiant_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Ptolemys_Theorem-nth_of_radiant_2"><span class="command">lemma</span></span> nth_of_radiant_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"of_radiant <span class="free">ω</span> <span class="main">$</span> <span class="numeral">2</span> <span class="main">=</span> sin <span class="free">ω</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> of_radiant_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Ptolemys_Theorem-norm_of_radiant"><span class="command">lemma</span></span> norm_of_radiant<span class="main">:</span>
  <span class="quoted"><span class="quoted">"norm <span class="main">(</span>of_radiant <span class="free">ω</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> of_radiant_def norm_eq_on_real_2_vec <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Ptolemys_Theorem-of_radiant_plus_2pi"><span class="command">lemma</span></span> of_radiant_plus_2pi<span class="main">:</span>
  <span class="quoted"><span class="quoted">"of_radiant <span class="main">(</span><span class="free">ω</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">=</span> of_radiant <span class="free">ω</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> of_radiant_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Ptolemys_Theorem-of_radiant_minus_2pi"><span class="command">lemma</span></span> of_radiant_minus_2pi<span class="main">:</span>
  <span class="quoted"><span class="quoted">"of_radiant <span class="main">(</span><span class="free">ω</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">=</span> of_radiant <span class="free">ω</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_radiant <span class="main">(</span><span class="free">ω</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span> <span class="main">=</span> of_radiant <span class="main">(</span><span class="free">ω</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> pi<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> of_radiant_plus_2pi<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> of_radiant <span class="free">ω</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Lemmas on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> normalize<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Ptolemys_Theorem-normalize_eq"><span class="command">lemma</span></span> normalize_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"norm <span class="free">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> normalize <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> normalize_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Ptolemys_Theorem-norm_normalize"><span class="command">lemma</span></span> norm_normalize<span class="main">:</span>
  <span class="quoted"><span class="quoted">"norm <span class="main">(</span>normalize <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> normalize_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_axis<span class="main">)</span>

<span class="keyword1" id="Ptolemys_Theorem-nth_normalize"><span class="command">lemma</span></span> nth_normalize <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¦</span>normalize <span class="free">p</span> <span class="main">$</span> <span class="free">i</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> norm_normalize component_le_norm_cart <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="Ptolemys_Theorem-normalize_square"><span class="command">lemma</span></span> normalize_square<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>normalize <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> dot_square_norm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"normalize <span class="free">p</span>"</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inner_vec_def UNIV_2 power2_eq_square norm_normalize<span class="main">)</span>

<span class="keyword1" id="Ptolemys_Theorem-nth_normalize_ge_zero_iff"><span class="command">lemma</span></span> nth_normalize_ge_zero_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> normalize <span class="free">p</span> <span class="main">$</span> <span class="free">i</span> <span class="main">⟷</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> normalize <span class="free">p</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> normalize_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_le_divide_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> axis <span class="main">1</span> <span class="main">(</span><span class="main">1</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> exhaust_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">$</span> <span class="free">i</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> normalize <span class="free">p</span> <span class="main">$</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> normalize_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ptolemys_Theorem-nth_normalize_less_zero_iff"><span class="command">lemma</span></span> nth_normalize_less_zero_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"normalize <span class="free">p</span> <span class="main">$</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">$</span> <span class="free">i</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> nth_normalize_ge_zero_iff leD leI <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="Ptolemys_Theorem-normalize_boundary_iff"><span class="command">lemma</span></span> normalize_boundary_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¦</span>normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> norm <span class="free">p</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> normalize_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">(</span><span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">=</span> norm <span class="free">p</span> <span class="main">^</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> norm_eq_on_real_2_vec <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">¦</span> <span class="main">=</span> norm <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_eq_on_real_2_vec<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">¦</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> normalize_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ptolemys_Theorem-between_normalize_if_distant_from_0"><span class="command">lemma</span></span> between_normalize_if_distant_from_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"between <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>normalize <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> between_mem_segment closed_segment_def normalize_def<span class="main">)</span>

<span class="keyword1" id="Ptolemys_Theorem-between_normalize_if_near_0"><span class="command">lemma</span></span> between_normalize_if_near_0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"norm <span class="free">p</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"between <span class="main">(</span><span class="main">0</span><span class="main">,</span> normalize <span class="free">p</span><span class="main">)</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> norm <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">(</span>norm <span class="free">p</span> <span class="main">/</span> norm <span class="free">p</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">p</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> norm <span class="free">p</span> <span class="main">∧</span> norm <span class="free">p</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="bound">u</span> <span class="main">/</span> norm <span class="free">p</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">p</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">u</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> between_mem_segment closed_segment_def normalize_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Lemmas on <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> radiant_of<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Ptolemys_Theorem-radiant_of"><span class="command">lemma</span></span> radiant_of<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> radiant_of <span class="free">p</span> <span class="main">∧</span> radiant_of <span class="free">p</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">∧</span> of_radiant <span class="main">(</span>radiant_of <span class="free">p</span><span class="main">)</span> <span class="main">=</span> normalize <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">if</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span> <span class="keyword1">then</span> arccos <span class="main">(</span>normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> pi <span class="main">+</span> arccos <span class="main">(</span><span class="main">-</span> <span class="main">(</span>normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="var">?a</span> <span class="main">∧</span> <span class="var">?a</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">∧</span> of_radiant <span class="var">?a</span> <span class="main">=</span> normalize <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="var">?a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">≤</span> pi"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> pi_gt_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arccos <span class="main">(</span><span class="main">-</span> normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> pi"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">¦</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> normalize_boundary_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arccos <span class="main">(</span><span class="main">-</span> normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> pi"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> arccos_minus_1<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> arccos_eq_iff<span class="main">)</span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arccos <span class="main">(</span><span class="main">-</span> normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> pi"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"arccos <span class="main">(</span><span class="main">-</span> normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> pi"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_radiant <span class="var">?a</span> <span class="main">=</span> normalize <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_radiant <span class="var">?a</span> <span class="main">$</span> <span class="skolem">i</span> <span class="main">=</span> normalize <span class="free">p</span> <span class="main">$</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_radiant <span class="var">?a</span> <span class="main">$</span> <span class="main">1</span> <span class="main">=</span> normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> of_radiant_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cos_arccos_abs<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_radiant <span class="var">?a</span> <span class="main">$</span> <span class="numeral">2</span> <span class="main">=</span> normalize <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span>arccos <span class="main">(</span>normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_arccos_abs<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> normalize <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>normalize <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> normalize_square<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nth_normalize_ge_zero_iff<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_radiant_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> sin <span class="main">(</span>arccos <span class="main">(</span><span class="main">-</span> normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_arccos_abs<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> normalize <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>normalize <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> normalize_square<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> nth_normalize_ge_zero_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> of_radiant_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> exhaust_2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">i</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ω</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">ω</span> <span class="main">∧</span> <span class="skolem">ω</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">∧</span> of_radiant <span class="skolem">ω</span> <span class="main">=</span> normalize <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">ω</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span> <span class="quoted"><span class="quoted">"normalize <span class="free">p</span> <span class="main">=</span> of_radiant <span class="skolem">ω</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cos <span class="skolem">ω</span> <span class="main">=</span> normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"sin <span class="skolem">ω</span> <span class="main">=</span> normalize <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">=</span> <span class="var">?a</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">≤</span> pi"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="skolem">ω</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ω</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi›</span></span> <span class="quoted"><span class="quoted">‹sin <span class="skolem">ω</span> <span class="main">=</span> normalize <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_ge_zero_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> nth_normalize_ge_zero_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="skolem">ω</span>›</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">=</span> arccos <span class="main">(</span>cos <span class="skolem">ω</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arccos_cos<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹cos <span class="skolem">ω</span> <span class="main">=</span> normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span>›</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">=</span> arccos <span class="main">(</span>normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arccos_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">=</span> <span class="var">?a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">&gt;</span> pi"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="skolem">ω</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ω</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi›</span></span> <span class="quoted"><span class="quoted">‹sin <span class="skolem">ω</span> <span class="main">=</span> normalize <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_less_zero_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> nth_normalize_less_zero_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">ω</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">-</span> pi <span class="main">=</span> arccos <span class="main">(</span>cos <span class="main">(</span><span class="skolem">ω</span> <span class="main">-</span> pi<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> arccos_cos<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹cos <span class="skolem">ω</span> <span class="main">=</span> normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">-</span> pi <span class="main">=</span> arccos <span class="main">(</span><span class="main">-</span> normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">=</span> pi <span class="main">+</span> arccos <span class="main">(</span><span class="main">-</span> normalize <span class="free">p</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω</span> <span class="main">=</span> <span class="var">?a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">p</span> <span class="main">$</span> <span class="numeral">2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> radiant_of_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> theI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ptolemys_Theorem-radiant_of_bounds"><span class="command">lemma</span></span> radiant_of_bounds <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> radiant_of <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"radiant_of <span class="free">p</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span>
<span class="keyword1"><span class="command">using</span></span> radiant_of <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Ptolemys_Theorem-radiant_of_weak_ubound"><span class="command">lemma</span></span> radiant_of_weak_ubound <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"radiant_of <span class="free">p</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span>
<span class="keyword1"><span class="command">using</span></span> radiant_of_bounds<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Main Equations for Transforming to Polar Form›</span></span>

<span class="keyword1" id="Ptolemys_Theorem-polar_form_eq"><span class="command">lemma</span></span> polar_form_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"norm <span class="free">p</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> of_radiant <span class="main">(</span>radiant_of <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> radiant_of normalize_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Ptolemys_Theorem-relative_polar_form_eq"><span class="command">lemma</span></span> relative_polar_form_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">+</span> dist <span class="free">P</span> <span class="free">Q</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> of_radiant <span class="main">(</span>radiant_of <span class="main">(</span><span class="free">P</span> <span class="main">-</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="free">P</span> <span class="main">-</span> <span class="free">Q</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> of_radiant <span class="main">(</span>radiant_of <span class="main">(</span><span class="free">P</span> <span class="main">-</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">-</span> <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> polar_form_eq <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="free">P</span> <span class="free">Q</span> <span class="main">=</span> norm <span class="main">(</span><span class="free">P</span> <span class="main">-</span> <span class="free">Q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute diff_add_cancel<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Ptolemy's Theorem›</span></span>

<span class="keyword1" id="Ptolemys_Theorem-dist_circle_segment"><span class="command">lemma</span></span> dist_circle_segment<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">radius</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">α</span> <span class="main">≤</span> <span class="free">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">β</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dist <span class="main">(</span><span class="free">center</span> <span class="main">+</span> <span class="free">radius</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> of_radiant <span class="free">α</span><span class="main">)</span> <span class="main">(</span><span class="free">center</span> <span class="main">+</span> <span class="free">radius</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> of_radiant <span class="free">β</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">radius</span> <span class="main">*</span> sin <span class="main">(</span><span class="main">(</span><span class="free">β</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> trigonometry<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cos <span class="free">α</span> <span class="main">-</span> cos <span class="free">β</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>sin <span class="free">α</span> <span class="main">-</span> sin <span class="free">β</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span>  sin <span class="main">(</span><span class="main">(</span><span class="free">β</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> sin_diff_minus<span class="main">:</span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span><span class="main">(</span><span class="free">α</span> <span class="main">-</span> <span class="free">β</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> sin <span class="main">(</span><span class="main">(</span><span class="free">β</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sin_minus<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> minus_divide_left minus_diff_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cos <span class="free">α</span> <span class="main">-</span> cos <span class="free">β</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>sin <span class="free">α</span> <span class="main">-</span> sin <span class="free">β</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span>
      <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin <span class="main">(</span><span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="free">β</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="main">(</span><span class="free">β</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin <span class="main">(</span><span class="main">(</span><span class="free">α</span> <span class="main">-</span> <span class="free">β</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> cos <span class="main">(</span><span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="free">β</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> cos_diff_cos sin_diff_sin<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin <span class="main">(</span><span class="main">(</span><span class="free">β</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>sin <span class="main">(</span><span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="free">β</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cos <span class="main">(</span><span class="main">(</span><span class="free">α</span> <span class="main">+</span> <span class="free">β</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sin_diff_minus <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span>  sin <span class="main">(</span><span class="main">(</span><span class="free">β</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> sin <span class="main">(</span><span class="main">(</span><span class="free">β</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_ge_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="free">radius</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>cos <span class="free">α</span> <span class="main">-</span> cos <span class="free">β</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>sin <span class="free">α</span> <span class="main">-</span> sin <span class="free">β</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> dist_eq_on_real_2_vec <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">algebra</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sqrt <span class="main">(</span><span class="free">radius</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span>  <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin <span class="main">(</span><span class="main">(</span><span class="free">β</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trigonometry<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> <span class="free">radius</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">≤</span> sin <span class="main">(</span><span class="main">(</span><span class="free">β</span> <span class="main">-</span> <span class="free">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> ptolemy_trigonometric<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ω<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">ω<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">ω<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span><span class="free">ω<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="free">ω<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="free">ω<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="free">ω<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> sin <span class="free">ω<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> sin <span class="free">ω<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">+</span> sin <span class="free">ω<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> sin <span class="main">(</span><span class="free">ω<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="free">ω<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="free">ω<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span><span class="free">ω<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="free">ω<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="free">ω<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="free">ω<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>sin <span class="free">ω<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>cos <span class="free">ω<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> sin <span class="free">ω<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> sin <span class="free">ω<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">+</span> sin <span class="free">ω<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> sin <span class="main">(</span><span class="free">ω<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="free">ω<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="free">ω<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sin_add cos_add<span class="main">)</span> <span class="operator">algebra</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sin <span class="free">ω<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> sin <span class="free">ω<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">+</span> sin <span class="free">ω<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> sin <span class="main">(</span><span class="free">ω<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="free">ω<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="free">ω<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> ptolemy<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span> <span class="free">C</span> <span class="free">D</span> <span class="free">center</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">^</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dist <span class="free">center</span> <span class="free">A</span> <span class="main">=</span> <span class="free">radius</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dist <span class="free">center</span> <span class="free">B</span> <span class="main">=</span> <span class="free">radius</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dist <span class="free">center</span> <span class="free">C</span> <span class="main">=</span> <span class="free">radius</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"dist <span class="free">center</span> <span class="free">D</span> <span class="main">=</span> <span class="free">radius</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ordering_of_points<span class="main">:</span>
    <span class="quoted"><span class="quoted">"radiant_of <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">center</span><span class="main">)</span> <span class="main">≤</span> radiant_of <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">center</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"radiant_of <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">center</span><span class="main">)</span> <span class="main">≤</span> radiant_of <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">center</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"radiant_of <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">center</span><span class="main">)</span> <span class="main">≤</span> radiant_of <span class="main">(</span><span class="free">D</span> <span class="main">-</span> <span class="free">center</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"dist <span class="free">A</span> <span class="free">C</span> <span class="main">*</span> dist <span class="free">B</span> <span class="free">D</span> <span class="main">=</span> dist <span class="free">A</span> <span class="free">B</span> <span class="main">*</span> dist <span class="free">C</span> <span class="free">D</span> <span class="main">+</span> dist <span class="free">A</span> <span class="free">D</span> <span class="main">*</span> dist <span class="free">B</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹dist <span class="free">center</span> <span class="free">A</span> <span class="main">=</span> <span class="free">radius</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">radius</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">α</span></span> <span class="skolem"><span class="skolem">β</span></span> <span class="skolem"><span class="skolem">γ</span></span> <span class="skolem"><span class="skolem">δ</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">=</span> radiant_of <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">center</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">=</span> radiant_of <span class="main">(</span><span class="free">B</span> <span class="main">-</span> <span class="free">center</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">=</span> radiant_of <span class="main">(</span><span class="free">C</span> <span class="main">-</span> <span class="free">center</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">=</span> radiant_of <span class="main">(</span><span class="free">D</span> <span class="main">-</span> <span class="free">center</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> ordering_of_points <span class="keyword1"><span class="command">have</span></span> angle_basics<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">≤</span> <span class="skolem">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">≤</span> <span class="skolem">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">≤</span> <span class="skolem">δ</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">α</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">β</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">β</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">γ</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">δ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">δ</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> α_def β_def γ_def δ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1-4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="free">center</span> <span class="main">+</span> <span class="free">radius</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> of_radiant <span class="skolem">α</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">=</span> <span class="free">center</span> <span class="main">+</span> <span class="free">radius</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> of_radiant <span class="skolem">β</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="free">center</span> <span class="main">+</span> <span class="free">radius</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> of_radiant <span class="skolem">γ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="main">=</span> <span class="free">center</span> <span class="main">+</span> <span class="free">radius</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> of_radiant <span class="skolem">δ</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> α_def β_def γ_def δ_def
    <span class="keyword1"><span class="command">using</span></span> relative_polar_form_eq dist_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> dist_eqs<span class="main">:</span>
    <span class="quoted"><span class="quoted">"dist <span class="free">A</span> <span class="free">C</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">radius</span> <span class="main">*</span> sin <span class="main">(</span><span class="main">(</span><span class="skolem">γ</span> <span class="main">-</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"dist <span class="free">B</span> <span class="free">D</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">radius</span> <span class="main">*</span> sin <span class="main">(</span><span class="main">(</span><span class="skolem">δ</span> <span class="main">-</span> <span class="skolem">β</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"dist <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">radius</span> <span class="main">*</span> sin <span class="main">(</span><span class="main">(</span><span class="skolem">β</span> <span class="main">-</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"dist <span class="free">C</span> <span class="free">D</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">radius</span> <span class="main">*</span> sin <span class="main">(</span><span class="main">(</span><span class="skolem">δ</span> <span class="main">-</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"dist <span class="free">A</span> <span class="free">D</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">radius</span> <span class="main">*</span> sin <span class="main">(</span><span class="main">(</span><span class="skolem">δ</span> <span class="main">-</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"dist <span class="free">B</span> <span class="free">C</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">radius</span> <span class="main">*</span> sin <span class="main">(</span><span class="main">(</span><span class="skolem">γ</span> <span class="main">-</span> <span class="skolem">β</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> angle_basics <span class="quoted"><span class="quoted">‹<span class="free">radius</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> dist_circle_segment <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dist <span class="free">A</span> <span class="free">C</span> <span class="main">*</span> dist <span class="free">B</span> <span class="free">D</span> <span class="main">=</span> <span class="numeral">4</span> <span class="main">*</span> <span class="free">radius</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> sin <span class="main">(</span><span class="main">(</span><span class="skolem">γ</span> <span class="main">-</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="main">(</span><span class="skolem">δ</span> <span class="main">-</span> <span class="skolem">β</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> dist_eqs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">4</span> <span class="main">*</span> <span class="free">radius</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>sin <span class="main">(</span><span class="main">(</span><span class="skolem">β</span> <span class="main">-</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="main">(</span><span class="skolem">δ</span> <span class="main">-</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> sin <span class="main">(</span><span class="main">(</span><span class="skolem">γ</span> <span class="main">-</span> <span class="skolem">β</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="main">(</span><span class="skolem">δ</span> <span class="main">-</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ω<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="skolem"><span class="skolem">ω<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="skolem"><span class="skolem">ω<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">β</span> <span class="main">-</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">γ</span> <span class="main">-</span> <span class="skolem">β</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ω<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">δ</span> <span class="main">-</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">γ</span> <span class="main">-</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">ω<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">ω<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">δ</span> <span class="main">-</span> <span class="skolem">β</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">ω<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="skolem">ω<span class="hidden">⇩</span><sub>3</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">δ</span> <span class="main">-</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">ω<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">ω<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="skolem">ω<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> ω<span class="hidden">⇩</span><sub>1</sub>_def ω<span class="hidden">⇩</span><sub>2</sub>_def ω<span class="hidden">⇩</span><sub>3</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span><span class="main">(</span><span class="skolem">γ</span> <span class="main">-</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="main">(</span><span class="skolem">δ</span> <span class="main">-</span> <span class="skolem">β</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> sin <span class="main">(</span><span class="skolem">ω<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">ω<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="skolem">ω<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="skolem">ω<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">γ</span> <span class="main">-</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">ω<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">ω<span class="hidden">⇩</span><sub>2</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">δ</span> <span class="main">-</span> <span class="skolem">β</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">ω<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="skolem">ω<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sin <span class="skolem">ω<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">*</span> sin <span class="skolem">ω<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">+</span> sin <span class="skolem">ω<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">*</span> sin <span class="main">(</span><span class="skolem">ω<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">ω<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="skolem">ω<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ptolemy_trigonometric<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>sin <span class="main">(</span><span class="main">(</span><span class="skolem">β</span> <span class="main">-</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="main">(</span><span class="skolem">δ</span> <span class="main">-</span> <span class="skolem">γ</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> sin <span class="main">(</span><span class="main">(</span><span class="skolem">γ</span> <span class="main">-</span> <span class="skolem">β</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> sin <span class="main">(</span><span class="main">(</span><span class="skolem">δ</span> <span class="main">-</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ω<span class="hidden">⇩</span><sub>1</sub>_def ω<span class="hidden">⇩</span><sub>2</sub>_def ω<span class="hidden">⇩</span><sub>3</sub>_def <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">δ</span> <span class="main">-</span> <span class="skolem">α</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">=</span> <span class="skolem">ω<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">+</span> <span class="skolem">ω<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">+</span> <span class="skolem">ω<span class="hidden">⇩</span><sub>3</sub></span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> dist <span class="free">A</span> <span class="free">B</span> <span class="main">*</span> dist <span class="free">C</span> <span class="free">D</span> <span class="main">+</span> dist <span class="free">A</span> <span class="free">D</span> <span class="main">*</span> dist <span class="free">B</span> <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> dist_eqs <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>