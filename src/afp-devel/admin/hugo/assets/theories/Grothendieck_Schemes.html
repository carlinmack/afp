<div id="Set_Extras">
<div class="head">
<h1>Theory Set_Extras</h1>
</div>
<pre class="source">
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Authors: Anthony Bordg and Lawrence Paulson›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Set_Extras
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../jacobson_basic_algebra/theories/#Set_Theory">Jacobson_Basic_Algebra.Set_Theory</a>"</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some new notation for built-in primitives›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Sets›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">complement_in_of</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="main">(</span><span class="quoted">"_<span class="keyword1">∖</span>_"</span> <span class="main">[</span>65<span class="main">,</span>65<span class="main">]</span>65<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main"><span class="free">∖</span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">B</span></span></span>"</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Functions›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">preimage</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="hidden">⇧</span><sup>¯</sup></span> _ _"</span> <span class="main">[</span>90<span class="main">,</span>90<span class="main">,</span>1000<span class="main">]</span>90<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main"><span class="free"><span class="hidden">⇧</span><sup>¯</sup></span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> <span class="main">(</span>vimage <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1" id="Set_Extras-preimage_of_inter"><span class="command">lemma</span></span> preimage_of_inter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">V</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'b</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">V'</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'b</span> set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="free">V</span> <span class="main">∩</span> <span class="free">V'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Set_Extras-preimage_identity_self"><span class="command">lemma</span></span> preimage_identity_self<span class="main">:</span> <span class="quoted"><span class="quoted">"identity <span class="free">A</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="free">B</span> <span class="main">∩</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vimage_inter_cong<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Simplification actually replaces the RHS by the LHS›</span></span>
<span class="keyword1" id="Set_Extras-preimage_vimage_eq"><span class="command">lemma</span></span> preimage_vimage_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="main">(</span><span class="free">f</span> <span class="main">-`</span> <span class="free">U'</span><span class="main">)</span> <span class="free">U</span><span class="main">)</span> <span class="main">∩</span> <span class="free">X</span> <span class="main">=</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="free">U</span> <span class="main">∩</span> <span class="free">U'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">inverse_map</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">inverse_map</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">≡</span> restrict <span class="main">(</span>inv_into <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span>"</span></span>

<span class="keyword1" id="Set_Extras-bijective_map_preimage"><span class="command">lemma</span></span> bijective_map_preimage<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"bijective_map <span class="free">f</span> <span class="free">S</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bijective_map <span class="main">(</span>inverse_map <span class="free">f</span> <span class="free">S</span> <span class="free">T</span><span class="main">)</span> <span class="free">T</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inverse_map <span class="free">f</span> <span class="free">S</span> <span class="free">T</span> <span class="main">∈</span> <span class="free">T</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms bij_betw_imp_funcset bij_betw_inv_into bijective.bijective bijective_map.axioms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inverse_map_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="main">(</span>inverse_map <span class="free">f</span> <span class="free">S</span> <span class="free">T</span><span class="main">)</span> <span class="free">T</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_inv_into bijective_def bijective_map_def inverse_map_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Set_Extras-inverse_map_identity"><span class="command">lemma</span></span> inverse_map_identity <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"inverse_map <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span> <span class="free">S</span> <span class="free">S</span> <span class="main">=</span> identity <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Id_compose compose_id_inv_into image_ident image_restrict_eq inv_into_funcset inverse_map_def restrict_extensional<span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">composing</span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">∘</span> _ <span class="keyword1">↓</span> _"</span> <span class="main">[</span>60<span class="main">,</span>0<span class="main">,</span>60<span class="main">]</span>59<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main"><span class="free">∘</span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">↓</span></span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="main">≡</span> compose <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1" id="Set_Extras-comp_maps"><span class="command">lemma</span></span> comp_maps<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Set_Theory.map <span class="free">η</span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Set_Theory.map <span class="free">θ</span> <span class="free">B</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Set_Theory.map <span class="main">(</span><span class="free">θ</span> <span class="main">∘</span> <span class="free">η</span> <span class="main">↓</span> <span class="free">A</span><span class="main">)</span> <span class="free">A</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">θ</span> <span class="main">∘</span> <span class="free">η</span> <span class="main">↓</span> <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_iff PiE_def compose_def funcset_compose map.graph restrict_extensional<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Set_Theory.map_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Set_Extras-undefined_is_map_on_empty"><span class="command">lemma</span></span> undefined_is_map_on_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> undefined<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="main">{}</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map.intro<span class="main">)</span>

<span class="keyword1" id="Set_Extras-restrict_on_source"><span class="command">lemma</span></span> restrict_on_source<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="free">S</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"restrict <span class="free">f</span> <span class="free">S</span> <span class="main">=</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> PiE_restrict map.graph<span class="main">)</span>

<span class="keyword1" id="Set_Extras-restrict_further"><span class="command">lemma</span></span> restrict_further<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="free">S</span> <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"restrict <span class="main">(</span>restrict <span class="free">f</span> <span class="free">U</span><span class="main">)</span> <span class="free">V</span> <span class="main">=</span> restrict <span class="free">f</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf.absorb_iff2<span class="main">)</span>

<span class="keyword1" id="Set_Extras-map_eq"><span class="command">lemma</span></span> map_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="free">S</span> <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"map <span class="free">g</span> <span class="free">S</span> <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> restrict_ext restrict_on_source<span class="main">)</span>

<span class="keyword1" id="Set_Extras-image_subset_of_target"><span class="command">lemma</span></span> image_subset_of_target<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"map <span class="free">f</span> <span class="free">S</span> <span class="free">T</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">S</span> <span class="main">⊆</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> image_subsetI map.map_closed<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Group_Extras">
<div class="head">
<h1>Theory Group_Extras</h1>
</div>
<pre class="source">
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Authors: Anthony Bordg and Lawrence Paulson›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Group_Extras
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html">Main</a>
          <span class="quoted">"<a href="../../jacobson_basic_algebra/theories/#Group_Theory">Jacobson_Basic_Algebra.Group_Theory</a>"</span>
          <span class="quoted">"<a href="#Set_Extras">Set_Extras</a>"</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Fold operator with a subdomain›</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span>
  <span class="entity">foldSetD</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> set <span class="main">*</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">e</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    emptyI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="free">D</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">{}</span><span class="main">,</span> <span class="free">e</span><span class="main">)</span> <span class="main">∈</span> <span class="free">foldSetD</span> <span class="free">D</span> <span class="free">f</span> <span class="free">e</span>"</span></span>
  <span class="main">|</span> insertI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">;</span> <span class="free">f</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free">D</span><span class="main">;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">foldSetD</span> <span class="free">D</span> <span class="free">f</span> <span class="free">e</span><span class="main">⟧</span> <span class="main">⟹</span>
                      <span class="main">(</span>insert <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free">f</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free">foldSetD</span> <span class="free">D</span> <span class="free">f</span> <span class="free">e</span>"</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> empty_foldSetDE <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{}</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">foldD</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span> set<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">foldD</span> <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free"><span class="bound"><span class="entity">D</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Group_Extras-foldSetD_closed"><span class="command">lemma</span></span> foldSetD_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> foldSetD.cases<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Group_Extras-Diff1_foldSetD"><span class="command">lemma</span></span> Diff1_foldSetD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">D</span><span class="main">⟧</span> <span class="main">⟹</span>
   <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_insert_absorb foldSetD.insertI mk_disjoint_insert<span class="main">)</span>

<span class="keyword1" id="Group_Extras-foldSetD_imp_finite"><span class="command">lemma</span></span> foldSetD_imp_finite <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="main">⟹</span> finite <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> foldSetD<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Group_Extras-finite_imp_foldSetD"><span class="command">lemma</span></span> finite_imp_foldSetD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>finite <span class="free">A</span><span class="main">;</span> <span class="free">e</span> <span class="main">∈</span> <span class="free">D</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">D</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">D</span><span class="main">⟧</span>
    <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> finite<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> insert <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">D</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> foldSetD_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> y <span class="keyword2"><span class="keyword">and</span></span> insert <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">,</span> <span class="free">f</span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> foldSetD.intros<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Group_Extras-foldSetD_backwards"><span class="command">lemma</span></span> foldSetD_backwards<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span> <span class="bound">x</span> <span class="main">}</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Diff_insert_absorb insertI1<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Left-Commutative Operations›</span></span>

<span class="keyword1"><span class="command">locale</span></span> LCD <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">B</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>    <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> left_commute<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">∈</span> <span class="free">B</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">B</span><span class="main">;</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">D</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">y</span> <span class="main"><span class="free">⋅</span></span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> f_closed <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span><span class="main">;</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">D</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">D</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> LCD<span class="main">)</span> foldSetD_closed <span class="main">[</span><span class="operator">dest</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">z</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule</span> foldSetD.cases<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> LCD<span class="main">)</span> Diff1_foldSetD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span><span class="main">⟧</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">f</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Diff1_foldSetD f_closed local.foldSetD_closed subsetCE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> LCD<span class="main">)</span> finite_imp_foldSetD<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>finite <span class="free">A</span><span class="main">;</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span><span class="main">;</span> <span class="free">e</span> <span class="main">∈</span> <span class="free">D</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> finite<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">F</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> insert <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">D</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> y <span class="keyword2"><span class="keyword">and</span></span> insert <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">,</span> <span class="free">f</span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> foldSetD.intros<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> LCD<span class="main">)</span> foldSetD_determ_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="free">A</span> <span class="main">&lt;</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> A
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"card <span class="skolem">A</span> <span class="main">=</span> <span class="skolem">n</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"card <span class="skolem">A</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> foldSetD.cases <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">A</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">e</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">A</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">e</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x'</span> <span class="skolem">A'</span> <span class="skolem">y'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> A' <span class="main">=</span> this
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> foldSetD.cases <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">A</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">e</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">A</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">e</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x''</span> <span class="skolem">A''</span> <span class="skolem">y''</span><span class="main">)</span>
        <span class="keyword1"><span class="command">note</span></span> A'' <span class="main">=</span> this
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">x''</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">=</span> <span class="skolem">y''</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> A' A'' <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">x''</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> equalityE<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> A' A'' <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">x''</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹card <span class="skolem">A</span> <span class="main">=</span> <span class="skolem">n</span>›</span></span> Suc.IH Suc.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> card_insert_disjoint foldSetD_imp_finite insert_eq_iff insert_subset lessI<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x''</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">A''</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x'</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x''</span> <span class="main">∈</span> <span class="skolem">A'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> <span class="skolem">A''</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> A' A'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">=</span> insert <span class="skolem">x''</span> <span class="skolem">A''</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x'</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∉</span> <span class="skolem">A'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> card<span class="main">:</span> <span class="quoted"><span class="quoted">"card <span class="skolem">A'</span> <span class="main">≤</span> card <span class="skolem">A''</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> A' A'' * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> card_Suc_Diff1 eq_refl foldSetD_imp_finite<span class="main">)</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">A'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x''</span><span class="main">}</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">e</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> finite_imp_foldSetD <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x''</span><span class="main">}</span>"</span></span><span class="main">]</span> A' Diff_insert <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">e</span> <span class="main">∈</span> <span class="free">D</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x''</span> <span class="skolem">u</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Diff1_foldSetD <span class="main">[</span><span class="operator">OF</span> u<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x''</span> <span class="main">∈</span> <span class="skolem">A'</span>›</span></span> <span class="quoted"><span class="quoted">‹card <span class="skolem">A</span> <span class="main">=</span> <span class="skolem">n</span>›</span></span> A' Suc.IH <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">A''</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x'</span><span class="main">}</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"*"</span><span class="main">(</span>1<span class="main">)</span> u <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y''</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x'</span> <span class="skolem">u</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> A'' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> * <span class="quoted"><span class="quoted">‹card <span class="skolem">A</span> <span class="main">=</span> <span class="skolem">n</span>›</span></span> A'<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Diff1_foldSetD Suc.IH <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span>
                card card_Suc_Diff1 card_insert_disjoint foldSetD_imp_finite insert_subset le_imp_less_Suc<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> A' A''
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">⊆</span> <span class="free">B</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y'</span> <span class="main">=</span> <span class="skolem">x''</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">u</span>›</span></span> insert_subset left_commute local.foldSetD_closed u<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">with</span></span> Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> LCD<span class="main">)</span> foldSetD_determ<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span><span class="main">;</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span><span class="main">;</span> <span class="free">e</span> <span class="main">∈</span> <span class="free">D</span><span class="main">;</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span><span class="main">⟧</span>
  <span class="main">⟹</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> foldSetD_determ_aux <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> LCD<span class="main">)</span> foldD_equality<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span><span class="main">;</span> <span class="free">e</span> <span class="main">∈</span> <span class="free">D</span><span class="main">;</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span><span class="main">⟧</span> <span class="main">⟹</span> foldD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="free">A</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> foldD_def<span class="main">)</span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> foldSetD_determ<span class="main">)</span>

<span class="keyword1" id="Group_Extras-foldD_empty"><span class="command">lemma</span></span> foldD_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="free">D</span> <span class="main">⟹</span> foldD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="main">{}</span> <span class="main">=</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> foldD_def<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> LCD<span class="main">)</span> foldD_insert_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">∉</span> <span class="free">A</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">B</span><span class="main">;</span> <span class="free">e</span> <span class="main">∈</span> <span class="free">D</span><span class="main">;</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span><span class="main">⟧</span>
    <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>insert <span class="free">x</span> <span class="free">A</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_insert_absorb f_closed finite_Diff foldSetD.insertI foldSetD_determ foldSetD_imp_finite insert_subset local.finite_imp_foldSetD local.foldSetD_closed<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> LCD<span class="main">)</span> foldD_insert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="free">D</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"foldD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="main">(</span>insert <span class="free">x</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">(</span>foldD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">v</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">e</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">=</span> <span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> foldSetD <span class="free">D</span> <span class="main"><span class="free">(⋅)</span></span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span> <span class="main">(</span><span class="operator">use</span> assms foldD_def foldD_equality foldD_def finite_imp_foldSetD <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">metis</span><span class="keyword3">+</span>›</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> foldD_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> foldD_insert_aux<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> LCD<span class="main">)</span> foldD_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>finite <span class="free">A</span><span class="main">;</span> <span class="free">e</span> <span class="main">∈</span> <span class="free">D</span><span class="main">;</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span><span class="main">⟧</span> <span class="main">⟹</span> foldD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="free">A</span> <span class="main">∈</span> <span class="free">D</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> finite<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> insert <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> foldD_insert<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> LCD<span class="main">)</span> foldD_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>finite <span class="free">A</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">B</span><span class="main">;</span> <span class="free">e</span> <span class="main">∈</span> <span class="free">D</span><span class="main">;</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span><span class="main">⟧</span> <span class="main">⟹</span>
   <span class="free">f</span> <span class="free">x</span> <span class="main">(</span>foldD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> foldD <span class="free">D</span> <span class="free">f</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span> <span class="free">e</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> finite<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> left_commute foldD_insert<span class="main">)</span>

<span class="keyword1" id="Group_Extras-Int_mono2"><span class="command">lemma</span></span> Int_mono2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">A</span> <span class="main">⊆</span> <span class="free">C</span><span class="main">;</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">C</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">A</span> <span class="keyword1">Int</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> LCD<span class="main">)</span> foldD_nest_Un_Int<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>finite <span class="free">A</span><span class="main">;</span> finite <span class="free">C</span><span class="main">;</span> <span class="free">e</span> <span class="main">∈</span> <span class="free">D</span><span class="main">;</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span><span class="main">;</span> <span class="free">C</span> <span class="main">⊆</span> <span class="free">B</span><span class="main">⟧</span> <span class="main">⟹</span>
   foldD <span class="free">D</span> <span class="free">f</span> <span class="main">(</span>foldD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="free">C</span><span class="main">)</span> <span class="free">A</span> <span class="main">=</span> foldD <span class="free">D</span> <span class="free">f</span> <span class="main">(</span>foldD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">Int</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">Un</span> <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> finite<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> foldD_insert foldD_commute Int_insert_left insert_absorb Int_mono2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> LCD<span class="main">)</span> foldD_nest_Un_disjoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>finite <span class="free">A</span><span class="main">;</span> finite <span class="free">B</span><span class="main">;</span> <span class="free">A</span> <span class="keyword1">Int</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free">e</span> <span class="main">∈</span> <span class="free">D</span><span class="main">;</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span><span class="main">;</span> <span class="free">C</span> <span class="main">⊆</span> <span class="free">B</span><span class="main">⟧</span>
    <span class="main">⟹</span> foldD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">Un</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> foldD <span class="free">D</span> <span class="free">f</span> <span class="main">(</span>foldD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="free">B</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> foldD_nest_Un_Int<span class="main">)</span>

<span class="comment1">― ‹Delete rules to do with <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>foldSetD›</span></span> relation.›</span>

<span class="keyword1"><span class="command">declare</span></span> foldSetD_imp_finite <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
  empty_foldSetDE <span class="main">[</span><span class="operator">rule</span> <span class="quasi_keyword">del</span><span class="main">]</span>
  foldSetD.intros <span class="main">[</span><span class="operator">rule</span> <span class="quasi_keyword"><span class="quasi_keyword">del</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> LCD<span class="main">)</span>
  foldSetD_closed <span class="main">[</span><span class="operator">rule</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Monoids›</span></span>

<span class="keyword1" id="Group_Extras-comp_monoid_morphisms"><span class="command">lemma</span></span> comp_monoid_morphisms<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"monoid_homomorphism <span class="free">η</span> <span class="free">A</span> <span class="free">multA</span> <span class="free">oneA</span> <span class="free">B</span> <span class="free">multB</span> <span class="free">oneB</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">"monoid_homomorphism <span class="free">θ</span> <span class="free">B</span> <span class="free">multB</span> <span class="free">oneB</span> <span class="free">C</span> <span class="free">multC</span> <span class="free">oneC</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monoid_homomorphism <span class="main">(</span><span class="free">θ</span> <span class="main">∘</span> <span class="free">η</span> <span class="main">↓</span> <span class="free">A</span><span class="main">)</span> <span class="free">A</span> <span class="free">multA</span> <span class="free">oneA</span> <span class="free">C</span> <span class="free">multC</span> <span class="free">oneC</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="free">θ</span> <span class="main">∘</span> <span class="free">η</span> <span class="main">↓</span> <span class="free">A</span><span class="main">)</span> <span class="free">A</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms comp_maps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> monoid_homomorphism.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">θ</span> <span class="main">∘</span> <span class="free">η</span> <span class="main">↓</span> <span class="free">A</span><span class="main">)</span> <span class="free">oneA</span> <span class="main">=</span> <span class="free">oneC</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> compose_eq monoid.unit_closed monoid_homomorphism.axioms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> monoid_homomorphism.commutes_with_unit<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">θ</span> <span class="main">∘</span> <span class="free">η</span> <span class="main">↓</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="free">multA</span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">multC</span> <span class="main">(</span><span class="main">(</span><span class="free">θ</span> <span class="main">∘</span> <span class="free">η</span> <span class="main">↓</span> <span class="free">A</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">θ</span> <span class="main">∘</span> <span class="free">η</span> <span class="main">↓</span> <span class="free">A</span><span class="main">)</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword1"><span class="command">using</span></span> that assms monoid_homomorphism.commutes_with_composition
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> compose_eq map.map_closed monoid.composition_closed monoid_homomorphism.axioms<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> monoid_homomorphism_def assms comp_maps <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> monoid_homomorphism_axioms.intro<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Commutative Monoids›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We enter a more restrictive context, with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>f :: 'a ⇒ 'a ⇒ 'a›</span></span></span></span>
  instead of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>'b ⇒ 'a ⇒ 'a›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> ACeD <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>    <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">e</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ident <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">D</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">e</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">∈</span> <span class="free">D</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">D</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">∈</span> <span class="free">D</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">D</span><span class="main">;</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">D</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">y</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">y</span> <span class="main"><span class="free">⋅</span></span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> e_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∈</span> <span class="free">D</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f_closed <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">∈</span> <span class="free">D</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">D</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">y</span> <span class="main">∈</span> <span class="free">D</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ACeD<span class="main">)</span> left_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">∈</span> <span class="free">D</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">D</span><span class="main">;</span> <span class="free">z</span> <span class="main">∈</span> <span class="free">D</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">y</span> <span class="main"><span class="free">⋅</span></span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">D</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">D</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">y</span> <span class="main"><span class="free">⋅</span></span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">y</span> <span class="main"><span class="free">⋅</span></span> <span class="free">z</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> commute<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> D <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">y</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">z</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> D <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> commute<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ACeD<span class="main">)</span> AC <span class="main">=</span> assoc commute left_commute

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ACeD<span class="main">)</span> left_ident <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">D</span> <span class="main">⟹</span> <span class="free">e</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">e</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ident<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">D</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ACeD<span class="main">)</span> foldD_Un_Int<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>finite <span class="free">A</span><span class="main">;</span> finite <span class="free">B</span><span class="main">;</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">D</span><span class="main">;</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">D</span><span class="main">⟧</span> <span class="main">⟹</span>
    foldD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="free">A</span> <span class="main"><span class="free">⋅</span></span> foldD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="free">B</span> <span class="main">=</span>
    foldD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">Un</span> <span class="free">B</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> foldD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">Int</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">set</span><span class="main"><span class="main">:</span></span> finite<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> left_commute LCD.foldD_closed <span class="main"><span class="main">[</span></span><span class="operator">OF</span> LCD.intro <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="free">D</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AC insert_absorb Int_insert_left Int_mono2
                 LCD.foldD_insert <span class="main"><span class="main">[</span></span><span class="operator">OF</span> LCD.intro <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="free">D</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span>
                 LCD.foldD_closed <span class="main"><span class="main">[</span></span><span class="operator">OF</span> LCD.intro <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="free">D</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ACeD<span class="main">)</span> foldD_Un_disjoint<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>finite <span class="free">A</span><span class="main">;</span> finite <span class="free">B</span><span class="main">;</span> <span class="free">A</span> <span class="keyword1">Int</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">D</span><span class="main">;</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">D</span><span class="main">⟧</span> <span class="main">⟹</span>
    foldD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">Un</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> foldD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="free">A</span> <span class="main"><span class="free">⋅</span></span> foldD <span class="free">D</span> <span class="free">f</span> <span class="free">e</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> foldD_Un_Int
    left_commute LCD.foldD_closed <span class="main"><span class="main">[</span></span><span class="operator">OF</span> LCD.intro <span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="free">D</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Finite Products›</span></span>

<span class="keyword1"><span class="command">context</span></span> monoid
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">finprod</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> set <span class="main">=&gt;</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">=&gt;</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">finprod</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> finite <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="keyword1">then</span> foldD <span class="free">M</span> <span class="main">(</span><span class="free">composition</span> <span class="main">∘</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main"><span class="free">𝟭</span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="keyword1">else</span> <span class="main"><span class="free">𝟭</span></span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* monoid *)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Groups›</span></span>

<span class="keyword1" id="Group_Extras-comp_group_morphisms"><span class="command">lemma</span></span> comp_group_morphisms<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"group_homomorphism <span class="free">η</span> <span class="free">A</span> <span class="free">multA</span> <span class="free">oneA</span> <span class="free">B</span> <span class="free">multB</span> <span class="free">oneB</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
<span class="quoted"><span class="quoted">"group_homomorphism <span class="free">θ</span> <span class="free">B</span> <span class="free">multB</span> <span class="free">oneB</span> <span class="free">C</span> <span class="free">multC</span> <span class="free">oneC</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"group_homomorphism <span class="main">(</span><span class="free">θ</span> <span class="main">∘</span> <span class="free">η</span> <span class="main">↓</span> <span class="free">A</span><span class="main">)</span> <span class="free">A</span> <span class="free">multA</span> <span class="free">oneA</span> <span class="free">C</span> <span class="free">multC</span> <span class="free">oneC</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms group_homomorphism_def comp_monoid_morphisms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Subgroup Generated by a Subset›</span></span>

<span class="keyword1"><span class="command">context</span></span> group
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">inductive_set</span></span> <span class="entity">generate</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">H</span> <span class="keyword2"><span class="keyword">where</span></span>
    unit<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭</span></span> <span class="main">∈</span> <span class="free">generate</span> <span class="free">H</span>"</span></span>
  <span class="main">|</span> incl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="free">generate</span> <span class="free">H</span>"</span></span>
  <span class="main">|</span> inv<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> inverse <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="free">generate</span> <span class="free">H</span>"</span></span>
  <span class="main">|</span> mult<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="free">generate</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∈</span> <span class="free">generate</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">⋅</span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∈</span> <span class="free">generate</span> <span class="free">H</span>"</span></span>

<span class="keyword1" id="Group_Extras-generate_into_G"><span class="command">lemma</span></span> generate_into_G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> generate <span class="main">(</span><span class="free">G</span> <span class="main">∩</span> <span class="free">H</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> generate.induct<span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">subgroup_generated</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">subgroup_generated</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> generate <span class="main">(</span><span class="free">G</span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Group_Extras-inverse_in_subgroup_generated"><span class="command">lemma</span></span> inverse_in_subgroup_generated<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> subgroup_generated <span class="free">H</span> <span class="main">⟹</span> inverse <span class="free">a</span> <span class="main">∈</span> subgroup_generated <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> subgroup_generated_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> generate.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>mult <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate.mult generate_into_G inverse_composition_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate.unit generate.incl generate.inv<span class="main">)</span>

<span class="keyword1" id="Group_Extras-subgroup_generated_is_monoid"><span class="command">lemma</span></span> subgroup_generated_is_monoid<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">H</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="main">(</span>subgroup_generated <span class="free">H</span><span class="main">)</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> subgroup_generated_def
<span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> generate.unit generate.mult associative generate_into_G<span class="main">)</span>

<span class="keyword1" id="Group_Extras-subgroup_generated_is_subset"><span class="command">lemma</span></span> subgroup_generated_is_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">H</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgroup_generated <span class="free">H</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> generate_into_G subgroup_generated_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Group_Extras-subgroup_generated_is_subgroup"><span class="command">lemma</span></span> subgroup_generated_is_subgroup<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">H</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"subgroup <span class="main">(</span>subgroup_generated <span class="free">H</span><span class="main">)</span> <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"subgroup_generated <span class="free">H</span> <span class="main">⊆</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subgroup_generated_is_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span> <span class="main">∈</span> subgroup_generated <span class="free">H</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> subgroup_generated <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> subgroup_generated <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> monoid.composition_closed subgroup_generated_is_monoid<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">b</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> subgroup_generated <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> subgroup_generated <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> subgroup_generated <span class="free">H</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> monoid.associative subgroup_generated_is_monoid<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid.invertible <span class="main">(</span>subgroup_generated <span class="free">H</span><span class="main">)</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="skolem">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> subgroup_generated <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> monoid.invertibleI <span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="main">(</span>subgroup_generated <span class="free">H</span><span class="main">)</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subgroup_generated_is_monoid<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main"><span class="free">⋅</span></span> local.inverse <span class="skolem">u</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="quoted"><span class="quoted">"local.inverse <span class="skolem">u</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">u</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> subgroup_generated <span class="free">H</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹subgroup_generated <span class="free">H</span> <span class="main">⊆</span> <span class="free">G</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"local.inverse <span class="skolem">u</span> <span class="main">∈</span> subgroup_generated <span class="free">H</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inverse_in_subgroup_generated that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> generate_into_G generate.unit subgroup_generated_def<span class="main">)</span>


<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* group *)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Abelian Groups›</span></span>

<span class="keyword1"><span class="command">context</span></span> abelian_group
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">minus</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">‐</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">‐</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⋅</span></span> inverse <span class="free"><span class="bound"><span class="entity">y</span></span></span> "</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">finsum</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">finsum</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> finprod <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="comment1">(* A notation "∑i∈I. f i" should be introduced for a sum of a family of elements of an abelian group *)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* abelian_group*)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Topological_Space">
<div class="head">
<h1>Theory Topological_Space</h1>
</div>
<pre class="source">
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Authors: Anthony Bordg and Lawrence Paulson,
with some contributions from Wenda Li›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Topological_Space
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Complex_Main.html">Complex_Main</a>
          <span class="quoted">"<a href="../../jacobson_basic_algebra/theories/#Set_Theory">Jacobson_Basic_Algebra.Set_Theory</a>"</span>
          <a href="#Set_Extras">Set_Extras</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Topological Spaces›</span></span>

<span class="keyword1"><span class="command">locale</span></span> topological_space <span class="main">=</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">is_open</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> open_space <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> open_empty <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> open_imp_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">U</span> <span class="main">⟹</span> <span class="free">U</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> open_inter <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">is_open</span> <span class="free">U</span><span class="main">;</span> <span class="free">is_open</span> <span class="free">V</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">is_open</span> <span class="main">(</span><span class="free">U</span> <span class="main">∩</span> <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> open_union <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">F</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> set<span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">F</span> <span class="main">⟹</span> <span class="free">is_open</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">is_open</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="bound">F</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_closed</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_closed</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> <span class="free">is_open</span> <span class="main">(</span><span class="free">S</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">neighborhoods</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">neighborhoods</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="bound">U</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Note that by a neighborhood we mean what some authors call an open neighborhood.›</span></span>

<span class="keyword1" id="Topological_Space-open_union'"><span class="command">lemma</span></span> open_union' <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">F</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> set<span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">F</span> <span class="main">⟹</span> <span class="free">is_open</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">is_open</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> open_union <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Topological_Space-open_preimage_identity"><span class="command">lemma</span></span> open_preimage_identity <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">B</span> <span class="main">⟹</span> identity <span class="free">S</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="free">B</span> <span class="main">=</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.orderE open_imp_subset preimage_identity_self<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_connected</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_connected</span> <span class="main">≡</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">∧</span> <span class="free">is_open</span> <span class="bound">V</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">U</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">V</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">U</span> <span class="main">∪</span> <span class="bound">V</span> <span class="main">=</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_hausdorff</span><span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_hausdorff</span> <span class="main">≡</span>
<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="bound">U</span> <span class="main">∈</span> neighborhoods <span class="bound">x</span> <span class="main">∧</span> <span class="bound">V</span> <span class="main">∈</span> neighborhoods <span class="bound">y</span> <span class="main">∧</span> <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* topological_space *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹T2 spaces are also known as Hausdorff spaces.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> t2_space <span class="main">=</span> topological_space <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> hausdorff<span class="main">:</span> <span class="quoted"><span class="quoted">"is_hausdorff"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Topological Basis›</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">generated_topology</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="entity">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="entity">B</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
    UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">generated_topology</span> <span class="free">S</span> <span class="free">B</span> <span class="free">S</span>"</span></span>
  <span class="main">|</span> Int<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">generated_topology</span> <span class="free">S</span> <span class="free">B</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">generated_topology</span> <span class="free">S</span> <span class="free">B</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">generated_topology</span> <span class="free">S</span> <span class="free">B</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span>"</span></span>
  <span class="main">|</span> UN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">generated_topology</span> <span class="free">S</span> <span class="free">B</span> <span class="main">(</span><span class="main">⋃</span><span class="free"><span class="bound"><span class="entity">K</span></span></span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">K</span></span></span> <span class="main">⟹</span> <span class="free">generated_topology</span> <span class="free">S</span> <span class="free">B</span> <span class="bound">U</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> Basis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">generated_topology</span> <span class="free">S</span> <span class="free">B</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∈</span> <span class="free">B</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>

<span class="keyword1" id="Topological_Space-generated_topology_empty"><span class="command">lemma</span></span> generated_topology_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"generated_topology <span class="free">S</span> <span class="free">B</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UN Union_empty empty_iff<span class="main">)</span>

<span class="keyword1" id="Topological_Space-generated_topology_subset"><span class="command">lemma</span></span> generated_topology_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"generated_topology <span class="free">S</span> <span class="free">B</span> <span class="free">U</span> <span class="main">⟹</span> <span class="free">U</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>generated_topology.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Topological_Space-generated_topology_is_topology"><span class="command">lemma</span></span> generated_topology_is_topology<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">B</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"topological_space <span class="free">S</span> <span class="main">(</span>generated_topology <span class="free">S</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int UN UNIV generated_topology_subset topological_space_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Covers›</span></span>

<span class="keyword1"><span class="command">locale</span></span> cover_of_subset <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">U</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">index</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">cover</span><span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
<span class="comment1">(* We use real instead of index::"'b set" otherwise we get some troubles with locale sheaf_of_rings
in Comm_Ring_Theory.thy *)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> are_subsets<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">index</span> <span class="main">⟹</span> <span class="free">cover</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> covering<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">∈</span><span class="free">index</span><span class="main">.</span> <span class="free">cover</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">∈</span><span class="free">index</span><span class="main">.</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">cover</span> <span class="bound">i</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms covering <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">select_index</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">select_index</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="keyword1">SOME</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">index</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free">cover</span> <span class="bound">i</span>"</span></span>

<span class="keyword1" id="Topological_Space-cover_of_select_index"><span class="command">lemma</span></span> cover_of_select_index<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">cover</span> <span class="main">(</span>select_index <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> UN_iff covering select_index_def someI_ex subset_iff<span class="main">)</span>

<span class="keyword1" id="Topological_Space-select_index_belongs"><span class="command">lemma</span></span> select_index_belongs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"select_index <span class="free">x</span> <span class="main">∈</span> <span class="free">index</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> UN_iff covering in_mono select_index_def tfl_some<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* cover_of_subset *)</span>

<span class="keyword1"><span class="command">locale</span></span> open_cover_of_subset <span class="main">=</span> topological_space <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="main">+</span> cover_of_subset <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">U</span></span> <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">C</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">X</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">is_open</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">U</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">I</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">C</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> are_open_subspaces<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="free">I</span> <span class="main">⟹</span> <span class="free">is_open</span> <span class="main">(</span><span class="free">C</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Topological_Space-cover_of_select_index_is_open"><span class="command">lemma</span></span> cover_of_select_index_is_open<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="main">(</span><span class="free">C</span> <span class="main">(</span>select_index <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> are_open_subspaces select_index_belongs<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* open_cover_of_subset *)</span>

<span class="keyword1"><span class="command">locale</span></span> open_cover_of_open_subset <span class="main">=</span> open_cover_of_subset <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">U</span></span> <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">C</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">X</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">is_open</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">U</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">I</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">C</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_open_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">U</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Induced Topology›</span></span>

<span class="keyword1"><span class="command">locale</span></span> ind_topology <span class="main">=</span> topological_space <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">X</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">is_open</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ind_is_open</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ind_is_open</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">V</span><span class="main">.</span> <span class="bound">V</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">is_open</span> <span class="bound">V</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">=</span> <span class="free">S</span> <span class="main">∩</span> <span class="bound">V</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Topological_Space-ind_is_open_S"><span class="command">lemma</span></span> ind_is_open_S <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ind_is_open <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ind_is_open_def inf.orderE is_subset open_space order_refl<span class="main">)</span>

<span class="keyword1" id="Topological_Space-ind_is_open_empty"><span class="command">lemma</span></span> ind_is_open_empty <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ind_is_open <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ind_is_open_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Topological_Space-ind_space_is_top_space"><span class="command">lemma</span></span> ind_space_is_top_space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"topological_space <span class="free">S</span> <span class="main">(</span>ind_is_open<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="skolem">V</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ind_is_open <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">UX</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">UX</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="skolem">UX</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">=</span> <span class="free">S</span> <span class="main">∩</span> <span class="skolem">UX</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ind_is_open_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ind_is_open <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">VX</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">VX</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="skolem">VX</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> <span class="free">S</span> <span class="main">∩</span> <span class="skolem">VX</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ind_is_open_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="main">(</span><span class="skolem">UX</span> <span class="main">∩</span> <span class="skolem">VX</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">=</span> <span class="free">S</span> <span class="main">∩</span> <span class="main">(</span><span class="skolem">UX</span> <span class="main">∩</span> <span class="skolem">VX</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> open_inter <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ind_is_open <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">UX</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> ind_is_open_def le_infI1 subset_refl<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">F</span>
  <span class="keyword3"><span class="command">assume</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">⟹</span> ind_is_open <span class="bound">x</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F'</span></span> <span class="keyword2"><span class="keyword">where</span></span> F'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">∧</span> ind_is_open <span class="bound">x</span> <span class="main">⟹</span> <span class="free">is_open</span> <span class="main">(</span><span class="skolem">F'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">S</span> <span class="main">∩</span> <span class="main">(</span><span class="skolem">F'</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ind_is_open_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span><span class="skolem">F'</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> F F' imageE image_ident open_union<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">S</span> <span class="main">∩</span> <span class="main">⋃</span> <span class="main">(</span><span class="skolem">F'</span> <span class="main">`</span> <span class="skolem">F</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> F' <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">F</span> <span class="main">⟹</span> ind_is_open <span class="bound">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ind_is_open <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ind_is_open_def inf_sup_ord<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> open_imp_subset<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> ind_is_open <span class="bound">U</span> <span class="main">⟹</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ind_is_open_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Topological_Space-is_open_from_ind_is_open"><span class="command">lemma</span></span> is_open_from_ind_is_open<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ind_is_open <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms open_inter ind_is_open_def is_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Topological_Space-open_cover_from_ind_open_cover"><span class="command">lemma</span></span> open_cover_from_ind_open_cover<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"open_cover_of_open_subset <span class="free">S</span> ind_is_open <span class="free">U</span> <span class="free">I</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"open_cover_of_open_subset <span class="free">X</span> <span class="free">is_open</span> <span class="free">U</span> <span class="free">I</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms is_open_from_ind_is_open open_cover_of_open_subset.is_open_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">is_open</span> <span class="main">(</span><span class="free">C</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms is_open_from_ind_is_open open_cover_of_open_subset_def open_cover_of_subset.are_open_subspaces <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">C</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> is_subset
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> cover_of_subset_def open_cover_of_open_subset_def open_cover_of_subset_def subset_trans<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">is_open</span> <span class="free">U</span>›</span></span> open_imp_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">(</span><span class="free">C</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> cover_of_subset_def open_cover_of_open_subset_def open_cover_of_subset_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* induced topology *)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> topological_space<span class="main">)</span> ind_topology_is_open_self <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ind_topology <span class="free">S</span> <span class="free">is_open</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ind_topology_axioms_def ind_topology_def topological_space_axioms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> topological_space<span class="main">)</span> ind_topology_is_open_empty <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ind_topology <span class="free">S</span> <span class="free">is_open</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ind_topology_axioms_def ind_topology_def topological_space_axioms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> topological_space<span class="main">)</span> ind_is_open_iff_open<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ind_topology.ind_is_open <span class="free">S</span> <span class="free">is_open</span> <span class="free">S</span> <span class="free">U</span> <span class="main">⟷</span> <span class="free">is_open</span> <span class="free">U</span> <span class="main">∧</span> <span class="free">U</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ind_topology.ind_is_open_def ind_topology_is_open_self inf.absorb_iff2<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Continuous Maps›</span></span>

<span class="keyword1"><span class="command">locale</span></span> continuous_map <span class="main">=</span> source<span class="main">:</span> topological_space <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="main">+</span> target<span class="main">:</span> topological_space <span class="quoted"><span class="free">S'</span></span> <span class="quoted"><span class="free">is_open'</span></span>
<span class="main">+</span> map <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">S'</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">S</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">is_open</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">S'</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">is_open'</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_continuous<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open'</span> <span class="bound">U</span> <span class="main">⟹</span> <span class="free">is_open</span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="bound">U</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Topological_Space-open_cover_of_open_subset_from_target_to_source"><span class="command">lemma</span></span> open_cover_of_open_subset_from_target_to_source<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"open_cover_of_open_subset <span class="free">S'</span> <span class="free">is_open'</span> <span class="free">U</span> <span class="free">I</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"open_cover_of_open_subset <span class="free">S</span> <span class="free">is_open</span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="free">U</span><span class="main">)</span> <span class="free">I</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="main">(</span><span class="free">C</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="free">U</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="main">(</span><span class="free">C</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="free">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms is_continuous open_cover_of_open_subset.is_open_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">is_open</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="main">(</span><span class="free">C</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms is_continuous open_cover_of_open_subset_def open_cover_of_subset.are_open_subspaces<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="free">U</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="main">(</span><span class="free">C</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> open_cover_of_open_subset_def cover_of_subset_def open_cover_of_subset_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* continuous map *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Homeomorphisms›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The topological isomorphisms between topological spaces are called homeomorphisms.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> homeomorphism <span class="main">=</span>
  continuous_map <span class="main">+</span> bijective_map <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">S'</span></span> <span class="main">+</span>
  continuous_map <span class="quoted"><span class="free">S'</span></span> <span class="quoted"><span class="free">is_open'</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="quoted">"inverse_map <span class="free">f</span> <span class="free">S</span> <span class="free">S'</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> topological_space<span class="main">)</span> id_is_homeomorphism<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"homeomorphism <span class="free">S</span> <span class="free">is_open</span> <span class="free">S</span> <span class="free">is_open</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inverse_map <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span> <span class="free">S</span> <span class="free">S</span> <span class="main">∈</span> <span class="free">S</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inv_into_into inverse_map_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> open_inter bij_betwI'<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Topological Filters›</span></span> <span class="comment1">(* Imported from HOL.Topological_Spaces *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> topological_space<span class="main">)</span> <span class="entity">nhds</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> filter"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">nhds</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">S</span><span class="main">∈</span><span class="main">{</span><span class="bound">S</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">S</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="bound">S</span><span class="main">}</span><span class="main">.</span> principal <span class="bound">S</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> topological_space<span class="main">)</span>
  <span class="entity">tendsto</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> filter <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⤏</span>"</span> 55<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">⤏</span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> filterlim <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span>nhds <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> t2_space<span class="main">)</span> <span class="entity">Lim</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'f</span> filter <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'f</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Lim</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⤏</span> <span class="bound">l</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Comm_Ring">
<div class="head">
<h1>Theory Comm_Ring</h1>
</div>
<pre class="source">
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Authors: Anthony Bordg and Lawrence Paulson,
with some contributions from Wenda Li›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Comm_Ring
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="#Group_Extras">Group_Extras</a>"</span>
    <span class="quoted">"<a href="#Topological_Space">Topological_Space</a>"</span>
    <span class="quoted">"<a href="../../jacobson_basic_algebra/theories/#Ring_Theory">Jacobson_Basic_Algebra.Ring_Theory</a>"</span>
    <span class="quoted">"<a href="#Set_Extras">Set_Extras</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*Suppresses the built-in plus sign, but why does
 no_notation minus (infixl "-" 65)
cause errors with monoid subtraction below? --LCP
*)</span>
<span class="keyword1"><span class="command">no_notation</span></span> plus <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+</span>"</span> 65<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> monoid_homomorphism<span class="main">)</span> monoid_preimage<span class="main">:</span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="main">(</span><span class="free">η</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">M</span> <span class="free">M'</span><span class="main">)</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_absorb1 source.monoid_axioms subsetI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group_homomorphism<span class="main">)</span> group_preimage<span class="main">:</span> <span class="quoted"><span class="quoted">"Group_Theory.group <span class="main">(</span><span class="free">η</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">G</span> <span class="free">G'</span><span class="main">)</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_absorb1 source.group_axioms subsetI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring_homomorphism<span class="main">)</span> ring_preimage<span class="main">:</span> <span class="quoted"><span class="quoted">"ring <span class="main">(</span><span class="free">η</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">R</span> <span class="free">R'</span><span class="main">)</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_absorb2 Int_commute source.ring_axioms subset_iff<span class="main">)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Commutative Rings›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Commutative Rings›</span></span>

<span class="keyword1"><span class="command">locale</span></span> comm_ring <span class="main">=</span> ring <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> comm_mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main">=</span> <span class="free">b</span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The zero ring is a commutative ring.›</span></span>

<span class="keyword1" id="Comm_Ring-invertible_0"><span class="command">lemma</span></span> invertible_0<span class="main">:</span> <span class="quoted"><span class="quoted">"monoid.invertible <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Group_Theory.monoid.intro monoid.unit_invertible <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">interpretation</span></span> ring0<span class="main">:</span> ring <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">::</span>nat<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">0</span></span>
  <span class="keyword1"><span class="command">using</span></span> invertible_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">declare</span></span> ring0.additive.left_unit <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> ring0.additive.invertible <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> ring0.additive.invertible_left_inverse <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> ring0.right_zero <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">interpretation</span></span> cring0<span class="main">:</span> comm_ring <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">::</span>nat<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">0</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comm_ring_axioms_def comm_ring_def ring0.ring_axioms<span class="main">)</span>

<span class="comment1">(* def 0.13 *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring<span class="main">)</span> <span class="entity">zero_divisor</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">zero_divisor</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≠</span> <span class="main"><span class="free">𝟬</span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≠</span> <span class="main"><span class="free">𝟬</span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⋅</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Entire Rings›</span></span>

<span class="comment1">(* def 0.14 *)</span>
<span class="keyword1"><span class="command">locale</span></span> entire_ring <span class="main">=</span> comm_ring <span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> units_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭</span></span> <span class="main">≠</span> <span class="main"><span class="free">𝟬</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
no_zero_div<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">R</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¬</span><span class="main">(</span>zero_divisor <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Ideals›</span></span>

<span class="keyword1"><span class="command">context</span></span> comm_ring <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Comm_Ring-mult_left_assoc"><span class="command">lemma</span></span> mult_left_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">c</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">b</span> <span class="main"><span class="free">⋅</span></span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> comm_mult multiplicative.associative <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> ring_mult_ac <span class="main">=</span> comm_mult multiplicative.associative mult_left_assoc

<span class="comment1">(* ex. 0.16 *)</span>
<span class="keyword1" id="Comm_Ring-ideal_R_R"><span class="command">lemma</span></span> ideal_R_R<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="free">R</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Comm_Ring-ideal_0_R"><span class="command">lemma</span></span> ideal_0_R<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="main">{</span><span class="main"><span class="free">𝟬</span></span><span class="main">}</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid.invertible <span class="main">{</span><span class="main"><span class="free">𝟬</span></span><span class="main">}</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">{</span><span class="main"><span class="free">𝟬</span></span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> monoid.invertibleI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="main">{</span><span class="main"><span class="free">𝟬</span></span><span class="main">}</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">𝟬</span></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ideal_gen_by_prod</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ideal_gen_by_prod</span> <span class="free"><span class="bound"><span class="entity">𝔞</span></span></span> <span class="free"><span class="bound"><span class="entity">𝔟</span></span></span> <span class="main">≡</span> additive.subgroup_generated <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">a</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">𝔞</span></span></span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">𝔟</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Comm_Ring-ideal_zero"><span class="command">lemma</span></span> ideal_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="free">A</span> <span class="free">R</span> <span class="free">add</span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">unit</span> <span class="main">⟹</span> <span class="free">zero</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal_def subgroup_of_additive_group_of_ring_def subgroup_def submonoid_def submonoid_axioms_def<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-ideal_implies_subset"><span class="command">lemma</span></span> ideal_implies_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">A</span> <span class="free">R</span> <span class="free">add</span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">unit</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms ideal_def subgroup_def subgroup_of_additive_group_of_ring_def submonoid_axioms_def submonoid_def<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-ideal_inverse"><span class="command">lemma</span></span> ideal_inverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">A</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">unit</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"additive.inverse <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> additive.invertible assms comm_ring.ideal_implies_subset comm_ring_axioms ideal_def subgroup.subgroup_inverse_iff subgroup_of_additive_group_of_ring_def subsetD<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-ideal_add"><span class="command">lemma</span></span> ideal_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">A</span> <span class="free">R</span> <span class="free">add</span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">unit</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">add</span> <span class="free">a</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Group_Theory.group_def assms ideal_def monoid.composition_closed subgroup_def subgroup_of_additive_group_of_ring_def<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-ideal_mult_in_subgroup_generated"><span class="command">lemma</span></span> ideal_mult_in_subgroup_generated<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 𝔞<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="free">𝔞</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 𝔟<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="free">𝔟</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">𝔞</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">𝔟</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main">∈</span> ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main">=</span> <span class="bound">x</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">𝔞</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">𝔟</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ideal_implies_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> ideal_implies_subset <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> additive.subgroup_generated_def ideal_gen_by_prod_def
    <span class="keyword1"><span class="command">using</span></span> assms ideal_implies_subset <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> additive.generate.incl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Ideals generated by an Element›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">gen_ideal</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_<span class="keyword1">⟩</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⟨</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">⟩</span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">r</span><span class="main">∈</span><span class="free">R</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Comm_Ring-zero_in_gen_ideal"><span class="command">lemma</span></span> zero_in_gen_ideal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬</span></span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main"><span class="free">𝟬</span></span> <span class="main">=</span> <span class="bound">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> additive.unit_closed assms left_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> gen_ideal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-add_in_gen_ideal"><span class="command">lemma</span></span> add_in_gen_ideal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main"><span class="free">+</span></span> <span class="free">b</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="main"><span class="main">:</span></span> gen_ideal_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> additive.composition_closed distributive<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Comm_Ring-gen_ideal_subset"><span class="command">lemma</span></span> gen_ideal_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms comm_ring.gen_ideal_def local.comm_ring_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Comm_Ring-gen_ideal_monoid"><span class="command">lemma</span></span> gen_ideal_monoid<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">𝟬</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">+</span></span> <span class="skolem">b</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_in_gen_ideal assms that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms zero_in_gen_ideal gen_ideal_def <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Comm_Ring-gen_ideal_group"><span class="command">lemma</span></span> gen_ideal_group<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Group_Theory.group <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">𝟬</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">+</span></span> <span class="skolem">b</span> <span class="main"><span class="free">+</span></span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main"><span class="free">+</span></span> <span class="main">(</span><span class="skolem">b</span> <span class="main"><span class="free">+</span></span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms gen_ideal_monoid monoid.associative<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">+</span></span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a assms gen_ideal_monoid monoid.left_unit<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">+</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> a assms gen_ideal_monoid monoid.right_unit<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> M<span class="main">:</span> monoid <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms gen_ideal_monoid<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">∈</span><span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a gen_ideal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid.invertible <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> M.invertibleI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span><span class="main">∈</span><span class="free">R</span><span class="main">.</span> <span class="main">-</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms ideal_R_R ideal_inverse local.left_minus r<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">a</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_ideal_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> a r assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_in_gen_ideal add_in_gen_ideal assms<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-gen_ideal_ideal"><span class="command">lemma</span></span> gen_ideal_ideal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"submonoid_axioms <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">𝟬</span></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_in_gen_ideal assms gen_ideal_subset submonoid_axioms.intro zero_in_gen_ideal<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.group_axioms <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">𝟬</span></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Group_Theory.group_def assms gen_ideal_group<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ideal_axioms <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span> <span class="free">R</span> <span class="main"><span class="free">(⋅)</span></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">∈</span><span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gen_ideal_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> assms multiplicative.associative <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> r gen_ideal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">a</span> <span class="main">∈</span> <span class="main">⟨</span><span class="free">x</span><span class="main">⟩</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> assms comm_mult r<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms gen_ideal_monoid<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Exercises›</span></span>

<span class="keyword1" id="Comm_Ring-in_ideal_gen_by_prod"><span class="command">lemma</span></span> in_ideal_gen_by_prod<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 𝔞<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="free">𝔞</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 𝔟<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="free">𝔟</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main">∈</span> ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> b <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> <span class="free">R</span>›</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> additive.subgroup_generated_def ideal_gen_by_prod_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> unit
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> additive.generate.unit<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>incl <span class="skolem">x</span> <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 𝔞 𝔟 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">a</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">𝔞</span><span class="main">;</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">𝔟</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="skolem">u</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="bound">a</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">𝔞</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">𝔟</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> ideal.ideal<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ideal_implies_subset multiplicative.associative subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> additive.generate.incl incl.hyps incl.prems <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>inv <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">clarsimp</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">𝔞</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">𝔟</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main">-</span> <span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main">-</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">a</span> <span class="main">∈</span> <span class="free">𝔞</span> <span class="main">∧</span> <span class="main">-</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">𝔟</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 𝔞 𝔟 ideal.ideal<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ideal_implies_subset ideal_inverse in_mono local.right_minus multiplicative.associative<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main">-</span> <span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> additive.generate <span class="main">(</span><span class="free">R</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">a</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">b</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">𝔞</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">𝔟</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 𝔞 𝔟 additive.subgroup_generated_def ideal_mult_in_subgroup_generated
      <span class="keyword1"><span class="command">unfolding</span></span> ideal_gen_by_prod_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>mult <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> additive.generate.mult additive.generate_into_G distributive<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ex. 0.12 *)</span>
<span class="keyword1" id="Comm_Ring-ideal_subgroup_generated"><span class="command">lemma</span></span> ideal_subgroup_generated<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">𝔞</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">𝔟</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span>ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> additive.subgroup_generated_is_subset ideal_gen_by_prod_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">+</span></span> <span class="skolem">b</span> <span class="main">∈</span> ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command">using</span></span> that additive.subgroup_generated_is_monoid monoid.composition_closed
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ideal_gen_by_prod_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬</span></span> <span class="main">∈</span> ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> additive.generate.unit additive.subgroup_generated_def ideal_gen_by_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">+</span></span> <span class="skolem">b</span> <span class="main"><span class="free">+</span></span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main"><span class="free">+</span></span> <span class="main">(</span><span class="skolem">b</span> <span class="main"><span class="free">+</span></span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
    <span class="keyword1"><span class="command">using</span></span> that additive.subgroup_generated_is_subset
    <span class="keyword1"><span class="command">unfolding</span></span> ideal_gen_by_prod_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">+</span></span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">+</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command">using</span></span> that additive.subgroup_generated_is_subset <span class="keyword1"><span class="command">unfolding</span></span> ideal_gen_by_prod_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid.invertible <span class="main">(</span>ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span><span class="main">)</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span>
    <span class="keyword1"><span class="command">using</span></span> that additive.subgroup_generated_is_subgroup group.invertible
    <span class="keyword1"><span class="command">unfolding</span></span> ideal_gen_by_prod_def subgroup_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span> <span class="main">∈</span> ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms in_ideal_gen_by_prod<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">a</span> <span class="main">∈</span> ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span> <span class="main">⊆</span> <span class="free">R</span>›</span></span> comm_mult in_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-ideal_gen_by_prod_is_inter"><span class="command">lemma</span></span> ideal_gen_by_prod_is_inter<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">𝔞</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">𝔟</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span> <span class="main">=</span> <span class="main">⋂</span> <span class="main">{</span><span class="bound">I</span><span class="main">.</span> ideal <span class="bound">I</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">∧</span> <span class="main">{</span><span class="bound">a</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">b</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">𝔞</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">𝔟</span><span class="main">}</span> <span class="main">⊆</span> <span class="bound">I</span><span class="main">}</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?rhs</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?lhs</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">unfolding</span></span> ideal_gen_by_prod_def additive.subgroup_generated_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">induction</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ideal_zero ideal_inverse ideal_add<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⊆</span> <span class="var">?rhs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">⊆</span> <span class="var">?lhs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms ideal_subgroup_generated <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ideal_mult_in_subgroup_generated<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* comm_ring *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹def. 0.18, see remark 0.20›</span></span>
<span class="keyword1"><span class="command">locale</span></span> pr_ideal <span class="main">=</span> comm<span class="main">:</span>comm_ring <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="main">+</span> ideal <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">R</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">I</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">addition</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">multiplication</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">zero</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟬</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
<span class="free">unit</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭</span>"</span><span class="main">)</span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> carrier_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> absorbent<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">R</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">y</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Note that in the locale prime ideal the order of I and R is reversed with respect to the locale
ideal, so that we can introduce some syntactic sugar later.
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹remark 0.21›</span></span>
<span class="keyword1" id="Comm_Ring-not_1"><span class="command">lemma</span></span> not_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭</span></span> <span class="main">∉</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭</span></span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="main"><span class="free">𝟭</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">R</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ideal<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comm.multiplicative.right_unit<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">𝟭</span></span> <span class="main">∈</span> <span class="free">I</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> carrier_neq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-not_invertible"><span class="command">lemma</span></span> not_invertible<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> comm.multiplicative.invertible <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ideal<span class="main">(</span>2<span class="main">)</span> not_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ex. 0.22›</span></span>
<span class="keyword1" id="Comm_Ring-submonoid_notin"><span class="command">lemma</span></span> submonoid_notin<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">R</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">I</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"submonoid <span class="free">S</span> <span class="free">R</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">b</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">using</span></span> absorbent assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭</span></span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms carrier_neq ideal<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* pr_ideal *)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Spectrum of a ring›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The Zariski Topology›</span></span>

<span class="keyword1"><span class="command">context</span></span> comm_ring <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Notation 1›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">closed_subsets</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝒱</span> _"</span> <span class="main">[</span>900<span class="main">]</span> 900<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">𝒱</span></span> <span class="free"><span class="bound"><span class="entity">𝔞</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">I</span><span class="main">.</span> pr_ideal <span class="free">R</span> <span class="bound">I</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">𝔞</span></span></span> <span class="main">⊆</span> <span class="bound">I</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Notation 2›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">spectrum</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">Spec</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">Spec</span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">I</span><span class="main">.</span> pr_ideal <span class="free">R</span> <span class="bound">I</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Comm_Ring-cring0_spectrum_eq"><span class="command">lemma</span></span> cring0_spectrum_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cring0.spectrum <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cring0.spectrum_def pr_ideal_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Collect_empty_eq cring0.ideal_zero pr_ideal.intro pr_ideal.not_1<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹remark 0.11›</span></span>
<span class="keyword1" id="Comm_Ring-closed_subsets_R"><span class="command">lemma</span></span> closed_subsets_R <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝒱</span> <span class="free">R</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> ideal_implies_subset
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> closed_subsets_def pr_ideal_axioms_def pr_ideal_def<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-closed_subsets_zero"><span class="command">lemma</span></span> closed_subsets_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝒱</span> <span class="main">{</span><span class="main"><span class="free">𝟬</span></span><span class="main">}</span> <span class="main">=</span> <span class="keyword1">Spec</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> closed_subsets_def spectrum_def pr_ideal_def pr_ideal_axioms_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ideal_zero<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-closed_subsets_ideal_aux"><span class="command">lemma</span></span> closed_subsets_ideal_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 𝔞<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="free">𝔞</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 𝔟<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="free">𝔟</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> prime<span class="main">:</span> <span class="quoted"><span class="quoted">"pr_ideal <span class="free">R</span> <span class="free">x</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝔞</span> <span class="main">⊆</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">𝔟</span> <span class="main">⊆</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span> <span class="main">⊆</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ideal_gen_by_prod_def additive.subgroup_generated_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
  <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> additive.generate <span class="main">(</span><span class="free">R</span> <span class="main">∩</span> <span class="main">{</span><span class="bound">a</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">b</span> <span class="main">|</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">𝔞</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free">𝔟</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔞</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔟</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 𝔞 𝔟 ideal_implies_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> u
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">induction</span>
    <span class="keyword3"><span class="command">case</span></span> unit
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> comm_ring.ideal_zero prime pr_ideal_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>incl <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> incl pr_ideal.axioms <span class="main">[</span><span class="operator">OF</span> prime<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">𝔞</span> <span class="main">⊆</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝔟</span> <span class="main">⊆</span> <span class="free">R</span>›</span></span> disj ideal.ideal subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>inv <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> inv pr_ideal.axioms <span class="main">[</span><span class="operator">OF</span> prime<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">𝔞</span> <span class="main">⊆</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝔟</span> <span class="main">⊆</span> <span class="free">R</span>›</span></span> disj ideal.ideal ideal_inverse subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>mult <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> prime comm_ring.ideal_add pr_ideal_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹ex. 0.13›</span></span>
<span class="keyword1" id="Comm_Ring-closed_subsets_ideal_iff"><span class="command">lemma</span></span> closed_subsets_ideal_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">𝔞</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal <span class="free">𝔟</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝒱</span> <span class="main">(</span>ideal_gen_by_prod <span class="free">𝔞</span> <span class="free">𝔟</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">𝒱</span> <span class="free">𝔞</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span><span class="keyword1">𝒱</span> <span class="free">𝔟</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⊆</span> <span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> closed_subsets_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">clarsimp</span> <span class="main">(</span><span class="operator">meson</span> assms ideal_implies_subset ideal_mult_in_subgroup_generated in_mono pr_ideal.absorbent<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">⊆</span> <span class="var">?lhs</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> closed_subsets_def
    <span class="keyword1"><span class="command">using</span></span> closed_subsets_ideal_aux <span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">finsum</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">finsum</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> additive.finprod <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1" id="Comm_Ring-finsum_empty"><span class="command">lemma</span></span> finsum_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finsum <span class="main">{}</span> <span class="free">f</span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> additive.finprod_def<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-finsum_insert"><span class="command">lemma</span></span> finsum_insert<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∉</span> <span class="free">I</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finsum <span class="main">(</span>insert <span class="free">i</span> <span class="free">I</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="free">f</span> <span class="free">i</span> <span class="main"><span class="free">+</span></span> finsum <span class="free">I</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> additive.finprod_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> LCD.foldD_insert <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> B <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"insert <span class="free"><span class="free">i</span></span> <span class="free"><span class="free">I</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"LCD <span class="main">(</span>insert <span class="free">i</span> <span class="free">I</span><span class="main">)</span> <span class="free">R</span> <span class="main">(</span><span class="main"><span class="free">(+)</span></span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">(+)</span></span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="free">(+)</span></span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">(+)</span></span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">y</span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="free">(+)</span></span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> insert <span class="free">i</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> insert <span class="free">i</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
      <span class="keyword1"><span class="command">using</span></span> that additive.associative additive.commutative R <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">(+)</span></span> <span class="main">∘</span> <span class="free">f</span><span class="main">)</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> insert <span class="free">i</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword1"><span class="command">using</span></span> that R <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Comm_Ring-finsum_singleton"><span class="command">lemma</span></span> finsum_singleton <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">i</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"finsum <span class="main">{</span><span class="free">i</span><span class="main">}</span> <span class="free">f</span> <span class="main">=</span> <span class="free">f</span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> additive.right_unit assms finite.emptyI finsum_empty finsum_insert insert_absorb insert_not_empty<span class="main">)</span>


<span class="comment1">(* ex. 0.15 *)</span>
<span class="keyword1" id="Comm_Ring-ex_15"><span class="command">lemma</span></span> ex_15<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">J</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">𝔞</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">j</span><span class="main">.</span> <span class="bound">j</span><span class="main">∈</span><span class="free">J</span> <span class="main">⟹</span> ideal <span class="main">(</span><span class="free">𝔞</span> <span class="bound">j</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝒱</span> <span class="main">(</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">I</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> finsum <span class="bound">I</span> <span class="bound">f</span> <span class="main">∧</span> <span class="bound">I</span> <span class="main">⊆</span> <span class="free">J</span> <span class="main">∧</span> finite <span class="bound">I</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="bound">I</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">𝔞</span> <span class="bound">i</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋂</span><span class="bound">j</span><span class="main">∈</span><span class="free">J</span><span class="main">.</span> <span class="keyword1">𝒱</span> <span class="main">(</span><span class="free">𝔞</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">𝔞</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"pr_ideal <span class="free">R</span> <span class="skolem">U</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>finsum <span class="bound">I</span> <span class="bound">f</span> <span class="main">|</span><span class="bound">I</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">I</span> <span class="main">⊆</span> <span class="free">J</span> <span class="main">∧</span> finite <span class="bound">I</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="bound">I</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">𝔞</span> <span class="bound">i</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span> <span class="skolem">j</span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> J j ideal_implies_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> finsum <span class="main">{</span><span class="skolem">j</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="main">{</span>finsum <span class="bound">I</span> <span class="bound">f</span> <span class="main">|</span><span class="bound">I</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">I</span> <span class="main">⊆</span> <span class="free">J</span> <span class="main">∧</span> finite <span class="bound">I</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="bound">I</span> <span class="main">⟶</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">𝔞</span> <span class="bound">i</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetD <span class="main"><span class="main">[</span></span><span class="operator">OF</span> U<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> PI<span class="main">:</span> <span class="quoted"><span class="quoted">"pr_ideal <span class="free">R</span> <span class="skolem">x</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="free">J</span><span class="main">.</span> pr_ideal <span class="free">R</span> <span class="skolem">x</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">∧</span> <span class="free">𝔞</span> <span class="bound">j</span> <span class="main">⊆</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> that assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finsum <span class="skolem">I</span> <span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">I</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="free">J</span><span class="main">.</span> pr_ideal <span class="free">R</span> <span class="skolem">U</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">∧</span> <span class="free">𝔞</span> <span class="bound">j</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">⊆</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟶</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">𝔞</span> <span class="bound">i</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span> <span class="skolem">I</span> <span class="skolem">f</span>
    <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> empty
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> PI assms ideal_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">i</span> <span class="skolem">I</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finsum <span class="main">(</span>insert <span class="skolem">i</span> <span class="skolem">I</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">i</span> <span class="main"><span class="free">+</span></span> finsum <span class="skolem">I</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> finsum_insert ideal_implies_subset insertCI subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ideal_add insertCI pr_ideal.axioms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subset_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> closed_subsets_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ex 0.16 *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_zariski_open</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_zariski_open</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">≡</span> generated_topology <span class="keyword1">Spec</span> <span class="main">{</span><span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">𝔞</span><span class="main">.</span> ideal <span class="bound">𝔞</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">∧</span> <span class="bound">U</span> <span class="main">=</span> <span class="keyword1">Spec</span> <span class="main">-</span> <span class="keyword1">𝒱</span> <span class="bound">𝔞</span><span class="main">)</span><span class="main">}</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span>"</span></span>

<span class="keyword1" id="Comm_Ring-is_zariski_open_empty"><span class="command">lemma</span></span> is_zariski_open_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> UNIV is_zariski_open_def generated_topology_is_topology topological_space.open_empty
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Comm_Ring-is_zariski_open_Spec"><span class="command">lemma</span></span> is_zariski_open_Spec <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="keyword1">Spec</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UNIV is_zariski_open_def<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-is_zariski_open_Union"><span class="command">lemma</span></span> is_zariski_open_Union <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> is_zariski_open <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> is_zariski_open <span class="main">(</span><span class="main">⋃</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> UN is_zariski_open_def<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-is_zariski_open_Int"><span class="command">lemma</span></span> is_zariski_open_Int <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>is_zariski_open <span class="free">U</span><span class="main">;</span> is_zariski_open <span class="free">V</span><span class="main">⟧</span> <span class="main">⟹</span> is_zariski_open <span class="main">(</span><span class="free">U</span> <span class="main">∩</span> <span class="free">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Int is_zariski_open_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Comm_Ring-zariski_is_topological_space"><span class="command">lemma</span></span> zariski_is_topological_space <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"topological_space <span class="keyword1">Spec</span> is_zariski_open"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_zariski_open_def <span class="keyword1"><span class="command">using</span></span> generated_topology_is_topology
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Comm_Ring-zariski_open_is_subset"><span class="command">lemma</span></span> zariski_open_is_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms zariski_is_topological_space topological_space.open_imp_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Comm_Ring-cring0_is_zariski_open"><span class="command">lemma</span></span> cring0_is_zariski_open <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cring0.is_zariski_open <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> cring0.cring0_spectrum_eq cring0.is_zariski_open_empty cring0.zariski_open_is_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Standard Open Sets›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">standard_open</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> set set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝒟'(</span>_<span class="keyword1">')</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">𝒟(</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">)</span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">Spec</span> <span class="main">∖</span> <span class="keyword1">𝒱</span><span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⟩</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Comm_Ring-standard_open_is_zariski_open"><span class="command">lemma</span></span> standard_open_is_zariski_open<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="keyword1">𝒟(</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_zariski_open_def standard_open_def
  <span class="keyword1"><span class="command">using</span></span> assms gen_ideal_ideal generated_topology.simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Comm_Ring-standard_open_is_subset"><span class="command">lemma</span></span> standard_open_is_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝒟(</span><span class="free">x</span><span class="main">)</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms standard_open_is_zariski_open zariski_open_is_subset<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-belongs_standard_open_iff"><span class="command">lemma</span></span> belongs_standard_open_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="keyword1">Spec</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">𝔭</span> <span class="main">⟷</span> <span class="free">𝔭</span> <span class="main">∈</span> <span class="keyword1">𝒟(</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> standard_open_def closed_subsets_def spectrum_def gen_ideal_def subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> pr_ideal.absorbent<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ideal.ideal<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> pr_ideal_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* comm_ring *)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Presheaves of Rings›</span></span>

<span class="comment1">(* def 0.17 *)</span>
<span class="keyword1"><span class="command">locale</span></span> presheaf_of_rings <span class="main">=</span> Topological_Space.topological_space
  <span class="main">+</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">𝔉</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> set"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ρ</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">add_str</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1">+⇘</span></span>_<span class="keyword1"><span class="keyword1">⇙</span></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">mult_str</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1">⋅⇘</span></span>_<span class="keyword1"><span class="keyword1">⇙</span></span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="free">zero_str</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1">𝟬⇘</span></span>_<span class="keyword1"><span class="keyword1">⇙</span></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">one_str</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1">𝟭⇘</span></span>_<span class="keyword1"><span class="keyword1">⇙</span></span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">assumes</span></span> is_ring_morphism<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">⟹</span> <span class="free">is_open</span> <span class="bound">V</span> <span class="main">⟹</span> <span class="bound">V</span> <span class="main">⊆</span> <span class="bound">U</span> <span class="main">⟹</span> ring_homomorphism <span class="main">(</span><span class="free">ρ</span> <span class="bound">U</span> <span class="bound">V</span><span class="main">)</span>
                                                  <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>+<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span>⋅<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span><span class="main">)</span> 𝟬<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span> 𝟭<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span>
                                                  <span class="main">(</span><span class="free">𝔉</span> <span class="bound">V</span><span class="main">)</span> <span class="main">(</span>+<span class="hidden">⇘</span><sub><span class="bound">V</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span>⋅<span class="hidden">⇘</span><sub><span class="bound">V</span></sub><span class="hidden">⇙</span><span class="main">)</span> 𝟬<span class="hidden">⇘</span><sub><span class="bound">V</span></sub><span class="hidden">⇙</span> 𝟭<span class="hidden">⇘</span><sub><span class="bound">V</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> ring_of_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> identity_map <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="bound">U</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="bound">U</span> <span class="bound">U</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> assoc_comp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span> <span class="bound">V</span> <span class="bound">W</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">⟹</span> <span class="free">is_open</span> <span class="bound">V</span> <span class="main">⟹</span> <span class="free">is_open</span> <span class="bound">W</span> <span class="main">⟹</span> <span class="bound">V</span> <span class="main">⊆</span> <span class="bound">U</span> <span class="main">⟹</span> <span class="bound">W</span> <span class="main">⊆</span> <span class="bound">V</span> <span class="main">⟹</span>
<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="bound">U</span> <span class="bound">W</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">ρ</span> <span class="bound">V</span> <span class="bound">W</span> <span class="main">∘</span> <span class="free">ρ</span> <span class="bound">U</span> <span class="bound">V</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Comm_Ring-is_ring_from_is_homomorphism"><span class="command">lemma</span></span> is_ring_from_is_homomorphism<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">⟹</span> ring <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>+<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span>⋅<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span><span class="main">)</span> 𝟬<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span> 𝟭<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_ring_morphism ring_homomorphism.axioms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Comm_Ring-is_map_from_is_homomorphism"><span class="command">lemma</span></span> is_map_from_is_homomorphism<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Set_Theory.map <span class="main">(</span><span class="free">ρ</span> <span class="free">U</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span><span class="free">𝔉</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span><span class="free">𝔉</span> <span class="free">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> is_ring_morphism ring_homomorphism.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Comm_Ring-eq_ρ"><span class="command">lemma</span></span> eq_ρ<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> <span class="free">U</span> <span class="main">∩</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="free">V</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="free">U</span> <span class="free">W</span> <span class="free">s</span> <span class="main">=</span> <span class="free">ρ</span> <span class="free">V</span> <span class="free">W</span> <span class="free">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">W'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">W'</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="free">U</span> <span class="free">W'</span> <span class="free">s</span> <span class="main">=</span> <span class="free">ρ</span> <span class="free">V</span> <span class="free">W'</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_subset_iff assms assoc_comp comp_apply<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* presheaf_of_rings *)</span>

<span class="keyword1"><span class="command">locale</span></span> morphism_presheaves_of_rings <span class="main">=</span>
source<span class="main">:</span> presheaf_of_rings <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝔉</span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span>
  <span class="main">+</span> target<span class="main">:</span> presheaf_of_rings <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝔉'</span></span> <span class="quoted"><span class="free">ρ'</span></span> <span class="quoted"><span class="free">b'</span></span> <span class="quoted"><span class="free">add_str'</span></span> <span class="quoted"><span class="free">mult_str'</span></span> <span class="quoted"><span class="free">zero_str'</span></span> <span class="quoted"><span class="free">one_str'</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">X</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">is_open</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">𝔉</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ρ</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">add_str</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">+⇘</span>_<span class="keyword1">⇙</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">mult_str</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⋅⇘</span>_<span class="keyword1">⇙</span>"</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">zero_str</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟬⇘</span>_<span class="keyword1">⇙</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">one_str</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭⇘</span>_<span class="keyword1">⇙</span>"</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">𝔉'</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ρ'</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b'</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">add_str'</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">+''⇘</span>_<span class="keyword1">⇙</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">mult_str'</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⋅''⇘</span>_<span class="keyword1">⇙</span>"</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">zero_str'</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟬''⇘</span>_<span class="keyword1">⇙</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">one_str'</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭''⇘</span>_<span class="keyword1">⇙</span>"</span><span class="main">)</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">fam_morphisms</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_ring_morphism<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">⟹</span> ring_homomorphism <span class="main">(</span><span class="free">fam_morphisms</span> <span class="bound">U</span><span class="main">)</span>
                                                                <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>+<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span>⋅<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span><span class="main">)</span> 𝟬<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span> 𝟭<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span>
                                                                <span class="main">(</span><span class="free">𝔉'</span> <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>+'<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span>⋅'<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span><span class="main">)</span> 𝟬'<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span> 𝟭'<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> comm_diagrams<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">⟹</span> <span class="free">is_open</span> <span class="bound">V</span> <span class="main">⟹</span> <span class="bound">V</span> <span class="main">⊆</span> <span class="bound">U</span> <span class="main">⟹</span>
               <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="bound">U</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">ρ'</span> <span class="bound">U</span> <span class="bound">V</span> <span class="main">∘</span> <span class="free">fam_morphisms</span> <span class="bound">U</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">fam_morphisms</span> <span class="bound">V</span> <span class="main">∘</span> <span class="free">ρ</span> <span class="bound">U</span> <span class="bound">V</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Comm_Ring-fam_morphisms_are_maps"><span class="command">lemma</span></span> fam_morphisms_are_maps<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Set_Theory.map <span class="main">(</span><span class="free">fam_morphisms</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span><span class="free">𝔉</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span><span class="free">𝔉'</span> <span class="free">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms is_ring_morphism <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_homomorphism_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* morphism_presheaves_of_rings *)</span>

<span class="comment1">(* Identity presheaf *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> presheaf_of_rings<span class="main">)</span> id_is_mor_pr_rngs<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"morphism_presheaves_of_rings <span class="free">S</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> morphism_presheaves_of_rings.intro morphism_presheaves_of_rings_axioms.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">⟹</span> ring_homomorphism <span class="main">(</span>identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>
                                            <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span> <span class="main">(</span><span class="free">add_str</span> <span class="bound">U</span><span class="main">)</span> <span class="main">(</span><span class="free">mult_str</span> <span class="bound">U</span><span class="main">)</span> <span class="main">(</span><span class="free">zero_str</span> <span class="bound">U</span><span class="main">)</span> <span class="main">(</span><span class="free">one_str</span> <span class="bound">U</span><span class="main">)</span>
                                            <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span> <span class="main">(</span><span class="free">add_str</span> <span class="bound">U</span><span class="main">)</span> <span class="main">(</span><span class="free">mult_str</span> <span class="bound">U</span><span class="main">)</span> <span class="main">(</span><span class="free">zero_str</span> <span class="bound">U</span><span class="main">)</span> <span class="main">(</span><span class="free">one_str</span> <span class="bound">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> identity_map is_map_from_is_homomorphism is_ring_morphism restrict_ext restrict_on_source subset_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">⟦</span><span class="free">is_open</span> <span class="bound">U</span><span class="main">;</span> <span class="free">is_open</span> <span class="bound">V</span><span class="main">;</span> <span class="bound">V</span> <span class="main">⊆</span> <span class="bound">U</span><span class="main">⟧</span>
           <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">ρ</span> <span class="bound">U</span> <span class="bound">V</span> <span class="main">∘</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span>identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∘</span> <span class="free">ρ</span> <span class="bound">U</span> <span class="bound">V</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> map.map_closed <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_apply is_map_from_is_homomorphism restrict_apply'<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> presheaf_of_rings_axioms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Comm_Ring-comp_ring_morphisms"><span class="command">lemma</span></span> comp_ring_morphisms<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="free">η</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="free">θ</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span> <span class="free">C</span> <span class="free">addC</span> <span class="free">multC</span> <span class="free">zeroC</span> <span class="free">oneC</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="main">(</span>compose <span class="free">A</span> <span class="free">θ</span> <span class="free">η</span><span class="main">)</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span> <span class="free">C</span> <span class="free">addC</span> <span class="free">multC</span> <span class="free">zeroC</span> <span class="free">oneC</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> comp_monoid_morphisms comp_group_morphisms assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> monoid_homomorphism_def ring_homomorphism_def<span class="main">)</span>

<span class="comment1">(* Composition of presheaves *)</span>
 <span class="keyword1" id="Comm_Ring-comp_of_presheaves"><span class="command">lemma</span></span> comp_of_presheaves<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"morphism_presheaves_of_rings <span class="free">X</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> <span class="free">𝔉'</span> <span class="free">ρ'</span> <span class="free">b'</span> <span class="free">add_str'</span> <span class="free">mult_str'</span> <span class="free">zero_str'</span> <span class="free">one_str'</span> <span class="free">φ</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"morphism_presheaves_of_rings <span class="free">X</span> <span class="free">is_open</span> <span class="free">𝔉'</span> <span class="free">ρ'</span> <span class="free">b'</span> <span class="free">add_str'</span> <span class="free">mult_str'</span> <span class="free">zero_str'</span> <span class="free">one_str'</span> <span class="free">𝔉''</span> <span class="free">ρ''</span> <span class="free">b''</span> <span class="free">add_str''</span> <span class="free">mult_str''</span> <span class="free">zero_str''</span> <span class="free">one_str''</span> <span class="free">φ'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"morphism_presheaves_of_rings <span class="free">X</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> <span class="free">𝔉''</span> <span class="free">ρ''</span> <span class="free">b''</span> <span class="free">add_str''</span> <span class="free">mult_str''</span> <span class="free">zero_str''</span> <span class="free">one_str''</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="free">φ'</span> <span class="bound">U</span> <span class="main">∘</span> <span class="free">φ</span> <span class="bound">U</span> <span class="main">↓</span> <span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> morphism_presheaves_of_rings.intro morphism_presheaves_of_rings_axioms.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="main">(</span><span class="free">φ'</span> <span class="skolem">U</span> <span class="main">∘</span> <span class="free">φ</span> <span class="skolem">U</span> <span class="main">↓</span> <span class="free">𝔉</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">𝔉</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">add_str</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">mult_str</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">zero_str</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">one_str</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">𝔉''</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">add_str''</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">mult_str''</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">zero_str''</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">one_str''</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms comp_ring_morphisms morphism_presheaves_of_rings.is_ring_morphism<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">𝔉</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">ρ''</span> <span class="skolem">U</span> <span class="skolem">V</span> <span class="main">∘</span> <span class="main">(</span><span class="free">φ'</span> <span class="skolem">U</span> <span class="main">∘</span> <span class="free">φ</span> <span class="skolem">U</span> <span class="main">↓</span> <span class="free">𝔉</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">φ'</span> <span class="skolem">V</span> <span class="main">∘</span> <span class="free">φ</span> <span class="skolem">V</span> <span class="main">↓</span> <span class="free">𝔉</span> <span class="skolem">V</span> <span class="main">∘</span> <span class="free">ρ</span> <span class="skolem">U</span> <span class="skolem">V</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span> <span class="skolem">V</span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">using</span></span> morphism_presheaves_of_rings.comm_diagrams <span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> morphism_presheaves_of_rings.comm_diagrams <span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> presheaf_of_rings.is_map_from_is_homomorphism <span class="main">[</span><span class="operator">OF</span> morphism_presheaves_of_rings.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1"</span> comp_apply compose_eq map.map_closed morphism_presheaves_of_rings.fam_morphisms_are_maps<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main">:</span> morphism_presheaves_of_rings_def›</span><span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> iso_presheaves_of_rings <span class="main">=</span> mor<span class="main">:</span>morphism_presheaves_of_rings
<span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> is_inv<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ψ</span><span class="main">.</span> morphism_presheaves_of_rings <span class="free">X</span> <span class="free">is_open</span> <span class="free">𝔉'</span> <span class="free">ρ'</span> <span class="free">b'</span> <span class="free">add_str'</span> <span class="free">mult_str'</span> <span class="free">zero_str'</span> <span class="free">one_str'</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> <span class="bound">ψ</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">𝔉'</span> <span class="bound">U</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">fam_morphisms</span> <span class="bound">U</span> <span class="main">∘</span> <span class="bound">ψ</span> <span class="bound">U</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">ψ</span> <span class="bound">U</span> <span class="main">∘</span> <span class="free">fam_morphisms</span> <span class="bound">U</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Sheaves of Rings›</span></span>

<span class="comment1">(* def 0.19 *)</span>
<span class="keyword1"><span class="command">locale</span></span> sheaf_of_rings <span class="main">=</span> presheaf_of_rings <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> locality<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span> <span class="bound">I</span> <span class="bound">V</span> <span class="bound">s</span><span class="main">.</span> open_cover_of_open_subset <span class="free">S</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="bound">I</span> <span class="bound">V</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="bound">I</span> <span class="main">⟹</span> <span class="bound">V</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="bound">U</span><span class="main">)</span> <span class="main">⟹</span>
<span class="bound">s</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="bound">U</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="bound">I</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="bound">U</span> <span class="main">(</span><span class="bound">V</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span> 𝟬<span class="hidden">⇘</span><sub><span class="main">(</span><span class="bound">V</span> <span class="bound">i</span><span class="main">)</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">=</span> 𝟬<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
glueing<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span> <span class="bound">I</span> <span class="bound">V</span> <span class="bound">s</span><span class="main">.</span> open_cover_of_open_subset <span class="free">S</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="bound">I</span> <span class="bound">V</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="bound">I</span> <span class="main">⟶</span> <span class="bound">V</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="bound">U</span> <span class="main">∧</span> <span class="bound">s</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="main">(</span><span class="bound">V</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">(</span><span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="bound">I</span> <span class="main">⟹</span> <span class="bound">j</span><span class="main">∈</span><span class="bound">I</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="main">(</span><span class="bound">V</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="bound">V</span> <span class="bound">i</span> <span class="main">∩</span> <span class="bound">V</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span><span class="bound">V</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="bound">V</span> <span class="bound">i</span> <span class="main">∩</span> <span class="bound">V</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="bound">U</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="bound">I</span> <span class="main">⟶</span> <span class="free">ρ</span> <span class="bound">U</span> <span class="main">(</span><span class="bound">V</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> <span class="bound">s</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(* def. 0.20 *)</span>
<span class="keyword1"><span class="command">locale</span></span> morphism_sheaves_of_rings <span class="main">=</span> morphism_presheaves_of_rings

<span class="keyword1"><span class="command">locale</span></span> iso_sheaves_of_rings <span class="main">=</span> iso_presheaves_of_rings

<span class="comment1">(* ex. 0.21 *)</span>
<span class="keyword1"><span class="command">locale</span></span> ind_sheaf <span class="main">=</span> sheaf_of_rings <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">U</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_open_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">U</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> it<span class="main">:</span> ind_topology <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">U</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ind_topology.intro ind_topology_axioms.intro is_open_subset open_imp_subset topological_space_axioms<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ind_sheaf</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ind_sheaf</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> <span class="free">𝔉</span> <span class="main">(</span><span class="free">U</span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ind_ring_morphisms</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ind_ring_morphisms</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">W</span></span></span> <span class="main">≡</span> <span class="free">ρ</span> <span class="main">(</span><span class="free">U</span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">U</span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">W</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ind_add_str</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ind_add_str</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> +<span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">U</span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ind_mult_str</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ind_mult_str</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> ⋅<span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">U</span> <span class="main">∩</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ind_zero_str</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ind_zero_str</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> 𝟬<span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">U</span><span class="main">∩</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span></sub><span class="hidden">⇙</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ind_one_str</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ind_one_str</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> 𝟭<span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">U</span><span class="main">∩</span><span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span></sub><span class="hidden">⇙</span>"</span></span>

<span class="keyword1" id="Comm_Ring-ind_is_open_imp_ring"><span class="command">lemma</span></span> ind_is_open_imp_ring<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> it.ind_is_open <span class="bound">U</span>
   <span class="main">⟹</span> ring <span class="main">(</span>ind_sheaf <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>ind_add_str <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>ind_mult_str <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>ind_zero_str <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>ind_one_str <span class="bound">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ind_add_str_def it.ind_is_open_def ind_mult_str_def ind_one_str_def ind_sheaf_def ind_zero_str_def is_open_subset is_ring_from_is_homomorphism it.is_subset open_inter <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Comm_Ring-ind_sheaf_is_presheaf"><span class="command">lemma</span></span> ind_sheaf_is_presheaf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"presheaf_of_rings <span class="free">U</span> <span class="main">(</span>it.ind_is_open<span class="main">)</span> ind_sheaf ind_ring_morphisms <span class="free">b</span>
ind_add_str ind_mult_str ind_zero_str ind_one_str"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"topological_space <span class="free">U</span> it.ind_is_open"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> it.ind_space_is_top_space<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="main">(</span>ind_ring_morphisms <span class="skolem">W</span> <span class="skolem">V</span><span class="main">)</span>
                     <span class="main">(</span>ind_sheaf <span class="skolem">W</span><span class="main">)</span> <span class="main">(</span>ind_add_str <span class="skolem">W</span><span class="main">)</span> <span class="main">(</span>ind_mult_str <span class="skolem">W</span><span class="main">)</span> <span class="main">(</span>ind_zero_str <span class="skolem">W</span><span class="main">)</span> <span class="main">(</span>ind_one_str <span class="skolem">W</span><span class="main">)</span>
                     <span class="main">(</span>ind_sheaf <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>ind_add_str <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>ind_mult_str <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>ind_zero_str <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>ind_one_str <span class="skolem">V</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"it.ind_is_open <span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"it.ind_is_open <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> <span class="skolem">W</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">W</span> <span class="skolem">V</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ring_homomorphism.intro ind_is_open_imp_ring<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Set_Theory.map <span class="main">(</span>ind_ring_morphisms <span class="skolem">W</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>ind_sheaf <span class="skolem">W</span><span class="main">)</span> <span class="main">(</span>ind_sheaf <span class="skolem">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> that it.ind_is_open_def ind_ring_morphisms_def ind_sheaf_def inf.left_idem is_open_subset is_ring_morphism open_inter ring_homomorphism_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> that
    <span class="keyword3"><span class="command">obtain</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="main">(</span><span class="free">U</span> <span class="main">∩</span> <span class="skolem">V</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="main">(</span><span class="free">U</span> <span class="main">∩</span> <span class="skolem">W</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">⊆</span> <span class="free">U</span> <span class="main">∩</span> <span class="skolem">W</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> it.ind_is_open_def inf.absorb_iff2 is_open_subset open_inter<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"group_homomorphism <span class="main">(</span>ind_ring_morphisms <span class="skolem">W</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>ind_sheaf <span class="skolem">W</span><span class="main">)</span> <span class="main">(</span>ind_add_str <span class="skolem">W</span><span class="main">)</span> <span class="main">(</span>ind_zero_str <span class="skolem">W</span><span class="main">)</span> <span class="main">(</span>ind_sheaf <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>ind_add_str <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>ind_zero_str <span class="skolem">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ind_sheaf.ind_add_str_def ind_sheaf_axioms ind_ring_morphisms_def ind_sheaf_def ind_zero_str_def is_ring_morphism ring_homomorphism.axioms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid_homomorphism <span class="main">(</span>ind_ring_morphisms <span class="skolem">W</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>ind_sheaf <span class="skolem">W</span><span class="main">)</span> <span class="main">(</span>ind_mult_str <span class="skolem">W</span><span class="main">)</span> <span class="main">(</span>ind_one_str <span class="skolem">W</span><span class="main">)</span> <span class="main">(</span>ind_sheaf <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>ind_mult_str <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>ind_one_str <span class="skolem">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> o <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ind_mult_str_def ind_one_str_def ind_ring_morphisms_def ind_sheaf_def is_ring_morphism ring_homomorphism_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> that <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ind_sheaf <span class="main">{}</span> <span class="main">=</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_of_empty ind_sheaf_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> it.ind_is_open <span class="bound">U</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>ind_sheaf <span class="bound">U</span><span class="main">)</span> <span class="main">⟹</span> ind_ring_morphisms <span class="bound">U</span> <span class="bound">U</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_absorb1 it.ind_is_open_def ind_ring_morphisms_def ind_sheaf_def it.is_open_from_ind_is_open is_open_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span> <span class="bound">V</span> <span class="bound">W</span><span class="main">.</span> it.ind_is_open <span class="bound">U</span> <span class="main">⟹</span> it.ind_is_open <span class="bound">V</span> <span class="main">⟹</span> it.ind_is_open <span class="bound">W</span> <span class="main">⟹</span> <span class="bound">V</span> <span class="main">⊆</span> <span class="bound">U</span> <span class="main">⟹</span> <span class="bound">W</span> <span class="main">⊆</span> <span class="bound">V</span>
             <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>ind_sheaf <span class="bound">U</span><span class="main">)</span> <span class="main">⟹</span> ind_ring_morphisms <span class="bound">U</span> <span class="bound">W</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span>ind_ring_morphisms <span class="bound">V</span> <span class="bound">W</span> <span class="main">∘</span> ind_ring_morphisms <span class="bound">U</span> <span class="bound">V</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_absorb1 assoc_comp it.ind_is_open_def ind_ring_morphisms_def ind_sheaf_def it.is_open_from_ind_is_open is_open_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> presheaf_of_rings_def presheaf_of_rings_axioms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-ind_sheaf_is_sheaf"><span class="command">lemma</span></span> ind_sheaf_is_sheaf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sheaf_of_rings <span class="free">U</span> it.ind_is_open ind_sheaf ind_ring_morphisms <span class="free">b</span> ind_add_str ind_mult_str ind_zero_str ind_one_str"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sheaf_of_rings.intro sheaf_of_rings_axioms.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"presheaf_of_rings <span class="free">U</span> it.ind_is_open ind_sheaf ind_ring_morphisms <span class="free">b</span> ind_add_str ind_mult_str ind_zero_str ind_one_str"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ind_sheaf_is_presheaf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">I</span> <span class="skolem">W</span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span> oc<span class="main">:</span> <span class="quoted"><span class="quoted">"open_cover_of_open_subset <span class="free">U</span> it.ind_is_open <span class="skolem">V</span> <span class="skolem">I</span> <span class="skolem">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> WV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟹</span> <span class="skolem">W</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="skolem">V</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> ind_sheaf <span class="skolem">V</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟹</span> ind_ring_morphisms <span class="skolem">V</span> <span class="main">(</span><span class="skolem">W</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> ind_zero_str <span class="main">(</span><span class="skolem">W</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"it.ind_is_open <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> oc open_cover_of_open_subset.is_open_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ind_sheaf.ind_sheaf_def ind_sheaf_axioms it.ind_is_open_def inf.absorb2 s<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> 𝟬<span class="hidden">⇘</span><sub><span class="skolem">V</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_absorb1 Int_subset_iff WV ind_sheaf.ind_zero_str_def ind_sheaf_axioms eq it.ind_is_open_def ind_ring_morphisms_def is_open_subset locality oc it.open_cover_from_ind_open_cover open_cover_of_open_subset.is_open_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> ind_zero_str <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_absorb1 it.ind_is_open_def ind_zero_str_def oc open_cover_of_open_subset.is_open_subset<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">I</span> <span class="skolem">W</span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span> oc<span class="main">:</span> <span class="quoted"><span class="quoted">"open_cover_of_open_subset <span class="free">U</span> it.ind_is_open <span class="skolem">V</span> <span class="skolem">I</span> <span class="skolem">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> WV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟶</span> <span class="skolem">W</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="skolem">V</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="bound">i</span> <span class="main">∈</span> ind_sheaf <span class="main">(</span><span class="skolem">W</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span><span class="main">;</span> <span class="bound">j</span> <span class="main">∈</span> <span class="skolem">I</span><span class="main">⟧</span> <span class="main">⟹</span> ind_ring_morphisms <span class="main">(</span><span class="skolem">W</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">W</span> <span class="bound">i</span> <span class="main">∩</span> <span class="skolem">W</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> ind_ring_morphisms <span class="main">(</span><span class="skolem">W</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">W</span> <span class="bound">i</span> <span class="main">∩</span> <span class="skolem">W</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> it.is_open_from_ind_is_open is_open_subset oc open_cover_of_open_subset.is_open_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"open_cover_of_open_subset <span class="free">S</span> <span class="free">is_open</span> <span class="skolem">V</span> <span class="skolem">I</span> <span class="skolem">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> it.open_cover_from_ind_open_cover oc ind_topology.intro ind_topology_axioms_def is_open_subset it.is_subset topological_space_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="main">(</span><span class="skolem">W</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">W</span> <span class="skolem">i</span> <span class="main">∩</span> <span class="skolem">W</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span><span class="skolem">W</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">W</span> <span class="skolem">i</span> <span class="main">∩</span> <span class="skolem">W</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span><span class="main">∈</span><span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">∈</span><span class="skolem">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">∩</span> <span class="skolem">W</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">W</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">∩</span> <span class="skolem">W</span> <span class="skolem">j</span> <span class="main">=</span> <span class="skolem">W</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_absorb1 WV it.ind_is_open_def oc open_cover_of_open_subset.is_open_subset
            subset_trans that<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> eq<span class="main">[</span><span class="operator">unfolded</span> ind_ring_morphisms_def<span class="main">,</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_sup_aci<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="skolem">I</span> <span class="main">⟶</span> <span class="skolem">W</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="skolem">V</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="main">(</span><span class="skolem">W</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> WV it.ind_is_open_def ind_sheaf_def inf.orderE inf_idem inf_aci<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> oc open_cover_of_open_subset.is_open_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="main">(</span><span class="free">𝔉</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="skolem">I</span> <span class="main">⟶</span> <span class="free">ρ</span> <span class="skolem">V</span> <span class="main">(</span><span class="skolem">W</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">s</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> glueing <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> ind_sheaf <span class="skolem">V</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ind_sheaf_def <span class="keyword1"><span class="command">using</span></span> oc
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_absorb1 cover_of_subset_def open_cover_of_open_subset_def open_cover_of_subset_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="skolem">I</span> <span class="main">⟶</span> ind_ring_morphisms <span class="skolem">V</span> <span class="main">(</span><span class="skolem">W</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">s</span> <span class="bound">i</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ind_ring_morphisms_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> oc Int_absorb1 <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="skolem">V</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟶</span> <span class="free">ρ</span> <span class="skolem">V</span> <span class="main">(</span><span class="skolem">W</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">s</span> <span class="bound">i</span><span class="main">)</span>›</span></span> cover_of_subset_def open_cover_of_open_subset_def open_cover_of_subset_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="main">(</span>ind_sheaf <span class="skolem">V</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="skolem">I</span> <span class="main">⟶</span> ind_ring_morphisms <span class="skolem">V</span> <span class="main">(</span><span class="skolem">W</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> <span class="skolem">s</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* ind_sheaf *)</span>

<span class="comment1">(* construction 0.22 *)</span>
<span class="keyword1"><span class="command">locale</span></span> im_sheaf <span class="main">=</span> sheaf_of_rings <span class="main">+</span> continuous_map
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* def 0.24 *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">im_sheaf</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set <span class="main">=&gt;</span> <span class="tfree">'b</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">im_sheaf</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> <span class="free">𝔉</span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">im_sheaf_morphisms</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set <span class="main">⇒</span> <span class="tfree">'c</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">im_sheaf_morphisms</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> <span class="free">ρ</span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">add_im_sheaf</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">add_im_sheaf</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">V</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> +<span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="bound">V</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mult_im_sheaf</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mult_im_sheaf</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">V</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> ⋅<span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="bound">V</span><span class="main">)</span></sub><span class="hidden">⇙</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">zero_im_sheaf</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">zero_im_sheaf</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">V</span><span class="main">.</span> 𝟬<span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="bound">V</span><span class="main">)</span></sub><span class="hidden">⇙</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">one_im_sheaf</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_im_sheaf</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">V</span><span class="main">.</span> 𝟭<span class="hidden">⇘</span><sub><span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="bound">V</span><span class="main">)</span></sub><span class="hidden">⇙</span>"</span></span>

<span class="keyword1" id="Comm_Ring-im_sheaf_is_presheaf"><span class="command">lemma</span></span> im_sheaf_is_presheaf<span class="main">:</span>
  <span class="quoted"><span class="quoted">"presheaf_of_rings <span class="free">S'</span> <span class="main">(</span><span class="free">is_open'</span><span class="main">)</span> im_sheaf im_sheaf_morphisms <span class="free">b</span>
add_im_sheaf mult_im_sheaf zero_im_sheaf one_im_sheaf"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> presheaf_of_rings.intro presheaf_of_rings_axioms.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"topological_space <span class="free">S'</span> <span class="free">is_open'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> target.topological_space_axioms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">⟦</span><span class="free">is_open'</span> <span class="bound">U</span><span class="main">;</span> <span class="free">is_open'</span> <span class="bound">V</span><span class="main">;</span> <span class="bound">V</span> <span class="main">⊆</span> <span class="bound">U</span><span class="main">⟧</span>
           <span class="main">⟹</span> ring_homomorphism <span class="main">(</span>im_sheaf_morphisms <span class="bound">U</span> <span class="bound">V</span><span class="main">)</span>
<span class="main">(</span>im_sheaf <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>add_im_sheaf <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>mult_im_sheaf <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>zero_im_sheaf <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>one_im_sheaf <span class="bound">U</span><span class="main">)</span>
<span class="main">(</span>im_sheaf <span class="bound">V</span><span class="main">)</span> <span class="main">(</span>add_im_sheaf <span class="bound">V</span><span class="main">)</span> <span class="main">(</span>mult_im_sheaf <span class="bound">V</span><span class="main">)</span> <span class="main">(</span>zero_im_sheaf <span class="bound">V</span><span class="main">)</span> <span class="main">(</span>one_im_sheaf <span class="bound">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> add_im_sheaf_def mult_im_sheaf_def zero_im_sheaf_def one_im_sheaf_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_commute Int_mono im_sheaf_def im_sheaf_morphisms_def is_continuous is_ring_morphism subset_refl vimage_mono<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"im_sheaf <span class="main">{}</span> <span class="main">=</span> <span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> im_sheaf_def ring_of_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open'</span> <span class="bound">U</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>im_sheaf <span class="bound">U</span><span class="main">)</span> <span class="main">⟹</span> im_sheaf_morphisms <span class="bound">U</span> <span class="bound">U</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> im_sheaf_morphisms_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> im_sheaf_def is_continuous<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span> <span class="bound">V</span> <span class="bound">W</span><span class="main">.</span>
       <span class="main">⟦</span><span class="free">is_open'</span> <span class="bound">U</span><span class="main">;</span> <span class="free">is_open'</span> <span class="bound">V</span><span class="main">;</span> <span class="free">is_open'</span> <span class="bound">W</span><span class="main">;</span> <span class="bound">V</span> <span class="main">⊆</span> <span class="bound">U</span><span class="main">;</span> <span class="bound">W</span> <span class="main">⊆</span> <span class="bound">V</span><span class="main">⟧</span>
       <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>im_sheaf <span class="bound">U</span><span class="main">)</span> <span class="main">⟹</span> im_sheaf_morphisms <span class="bound">U</span> <span class="bound">W</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span>im_sheaf_morphisms <span class="bound">V</span> <span class="bound">W</span> <span class="main">∘</span> im_sheaf_morphisms <span class="bound">U</span> <span class="bound">V</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_mono assoc_comp im_sheaf_def im_sheaf_morphisms_def ind_topology.is_subset is_continuous ind_topology_is_open_self vimage_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ex 0.23 *)</span>
<span class="keyword1" id="Comm_Ring-im_sheaf_is_sheaf"><span class="command">lemma</span></span> im_sheaf_is_sheaf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sheaf_of_rings <span class="free">S'</span> <span class="main">(</span><span class="free">is_open'</span><span class="main">)</span> im_sheaf im_sheaf_morphisms <span class="free">b</span>
add_im_sheaf mult_im_sheaf zero_im_sheaf one_im_sheaf"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sheaf_of_rings.intro sheaf_of_rings_axioms.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"presheaf_of_rings <span class="free">S'</span> <span class="free">is_open'</span> im_sheaf im_sheaf_morphisms <span class="free">b</span>
add_im_sheaf mult_im_sheaf zero_im_sheaf one_im_sheaf"</span></span>
    <span class="keyword1"><span class="command">using</span></span> im_sheaf_is_presheaf <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="skolem">I</span> <span class="skolem">V</span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span> oc<span class="main">:</span> <span class="quoted"><span class="quoted">"open_cover_of_open_subset <span class="free">S'</span> <span class="free">is_open'</span> <span class="skolem">U</span> <span class="skolem">I</span> <span class="skolem">V</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> VU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟹</span> <span class="skolem">V</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> im_sheaf <span class="skolem">U</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> eq0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟹</span> im_sheaf_morphisms <span class="skolem">U</span> <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span>zero_im_sheaf <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"open_cover_of_open_subset <span class="free">S</span> <span class="free">is_open</span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="skolem">U</span><span class="main">)</span> <span class="skolem">I</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> oc open_cover_of_open_subset_from_target_to_source<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> zero_im_sheaf <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> zero_im_sheaf_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> VU im_sheaf_def im_sheaf_morphisms_def eq0 inf.absorb_iff2 inf_le2 inf_sup_aci<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inf_sup_aci<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> locality s vimage_Int<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="skolem">I</span> <span class="skolem">V</span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span> oc<span class="main">:</span> <span class="quoted"><span class="quoted">"open_cover_of_open_subset <span class="free">S'</span> <span class="free">is_open'</span> <span class="skolem">U</span> <span class="skolem">I</span> <span class="skolem">V</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> VU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟶</span> <span class="skolem">V</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="skolem">U</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="bound">i</span> <span class="main">∈</span> im_sheaf <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span><span class="main">;</span> <span class="bound">j</span> <span class="main">∈</span> <span class="skolem">I</span><span class="main">⟧</span> <span class="main">⟹</span> im_sheaf_morphisms <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> im_sheaf_morphisms <span class="main">(</span><span class="skolem">V</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="main">(</span><span class="free">f</span>  <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟶</span> <span class="free">ρ</span> <span class="main">(</span><span class="free">f</span>  <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span>  <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> <span class="skolem">s</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> glueing<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"open_cover_of_open_subset <span class="free">S</span> <span class="free">is_open</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="skolem">U</span><span class="main">)</span> <span class="skolem">I</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> oc open_cover_of_open_subset_from_target_to_source <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟶</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="skolem">U</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> VU im_sheaf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="main">(</span><span class="skolem">V</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="main">(</span><span class="skolem">V</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∩</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="main">(</span><span class="skolem">V</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="main">(</span><span class="skolem">V</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="main">(</span><span class="skolem">V</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∩</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="main">(</span><span class="skolem">V</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">j</span>
      <span class="keyword1"><span class="command">using</span></span> im_sheaf_morphisms_def eq that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Int_commute Int_left_commute inf.left_idem vimage_Int<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main">∈</span><span class="skolem">I</span> <span class="main">⟶</span> <span class="free">ρ</span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">s</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> im_sheaf <span class="skolem">U</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟶</span> im_sheaf_morphisms <span class="skolem">U</span> <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> <span class="skolem">s</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> im_sheaf_def im_sheaf_morphisms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> sheaf_of_rings <span class="quoted"><span class="free">S'</span></span> <span class="quoted"><span class="free">is_open'</span></span> <span class="quoted">im_sheaf</span> <span class="quoted">im_sheaf_morphisms</span> <span class="quoted"><span class="free">b</span></span>
    <span class="quoted">add_im_sheaf</span> <span class="quoted">mult_im_sheaf</span> <span class="quoted">zero_im_sheaf</span> <span class="quoted">one_im_sheaf</span>
  <span class="keyword1"><span class="command">using</span></span> im_sheaf_is_sheaf <span class="keyword1"><span class="command">.</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* im_sheaf *)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> sheaf_of_rings<span class="main">)</span> id_to_iso_of_sheaves<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"iso_sheaves_of_rings <span class="free">S</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span>
            <span class="main">(</span>im_sheaf.im_sheaf <span class="free">S</span> <span class="free">𝔉</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>im_sheaf.im_sheaf_morphisms <span class="free">S</span> <span class="free">ρ</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span><span class="main">)</span>
            <span class="free">b</span>
            <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> +<span class="hidden">⇘</span><sub>identity <span class="free">S</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="bound">V</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> ⋅<span class="hidden">⇘</span><sub>identity <span class="free">S</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="bound">V</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> 𝟬<span class="hidden">⇘</span><sub>identity <span class="free">S</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="bound">V</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> 𝟭<span class="hidden">⇘</span><sub>identity <span class="free">S</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="bound">V</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"iso_sheaves_of_rings <span class="free">S</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="main">_</span> <span class="free">b</span>  <span class="var">?add</span> <span class="var">?mult</span> <span class="var">?zero</span> <span class="var">?one</span> <span class="var">?F</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> preq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">V</span><span class="main">.</span> <span class="bound">V</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">⟹</span> <span class="main">(</span>identity <span class="free">S</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="bound">V</span><span class="main">)</span> <span class="main">=</span> <span class="bound">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">interpret</span></span> id<span class="main">:</span> im_sheaf <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝔉</span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="quoted">"identity <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Set_Theory.map_def continuous_map_axioms_def open_imp_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">V</span><span class="main">.</span> <span class="bound">V</span> <span class="main">⊆</span> <span class="free">S</span> <span class="main">⟹</span> im_sheaf.im_sheaf <span class="free">S</span> <span class="free">𝔉</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span> <span class="bound">V</span> <span class="main">=</span> <span class="free">𝔉</span> <span class="bound">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> id.im_sheaf_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">U</span> <span class="main">⊆</span> <span class="free">S</span><span class="main">;</span> <span class="bound">V</span> <span class="main">⊆</span> <span class="free">S</span><span class="main">⟧</span> <span class="main">⟹</span> im_sheaf.im_sheaf_morphisms <span class="free">S</span> <span class="free">ρ</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span> <span class="bound">U</span> <span class="bound">V</span> <span class="main">≡</span> <span class="free">ρ</span> <span class="bound">U</span> <span class="bound">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> id.im_sheaf_morphisms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
    <span class="keyword1"><span class="command">have</span></span> rh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">⟹</span>
         ring_homomorphism <span class="main">(</span>identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span> +<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span> ⋅<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span> 𝟬<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span> 𝟭<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span> +<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span> ⋅<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span> 𝟬<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span> 𝟭<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> id_is_mor_pr_rngs morphism_presheaves_of_rings.is_ring_morphism <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"morphism_presheaves_of_rings_axioms <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span>
           id.im_sheaf id.im_sheaf_morphisms <span class="var">?add</span> <span class="var">?mult</span> <span class="var">?zero</span> <span class="var">?one</span> <span class="var">?F</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> morphism_presheaves_of_rings_axioms_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rh open_imp_subset <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_map_from_is_homomorphism map.map_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ρ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span> <span class="bound">V</span> <span class="bound">W</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="free">is_open</span> <span class="bound">U</span><span class="main">;</span> <span class="free">is_open</span> <span class="bound">V</span><span class="main">;</span> <span class="free">is_open</span> <span class="bound">W</span><span class="main">;</span> <span class="bound">V</span> <span class="main">⊆</span> <span class="bound">U</span><span class="main">;</span> <span class="bound">W</span> <span class="main">⊆</span> <span class="bound">V</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="bound">U</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">ρ</span> <span class="bound">V</span> <span class="bound">W</span> <span class="main">(</span><span class="free">ρ</span> <span class="bound">U</span> <span class="bound">V</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">ρ</span> <span class="bound">U</span> <span class="bound">W</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assoc_comp comp_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"presheaf_of_rings_axioms <span class="free">is_open</span> id.im_sheaf id.im_sheaf_morphisms <span class="free">b</span> <span class="var">?add</span> <span class="var">?mult</span> <span class="var">?zero</span> <span class="var">?one</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ρ presheaf_of_rings_axioms_def is_ring_morphism open_imp_subset ring_of_empty<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"presheaf_of_rings <span class="free">S</span> <span class="free">is_open</span> id.im_sheaf id.im_sheaf_morphisms <span class="free">b</span> <span class="var">?add</span> <span class="var">?mult</span> <span class="var">?zero</span> <span class="var">?one</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> id.im_sheaf_is_presheaf presheaf_of_rings_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"morphism_presheaves_of_rings_axioms <span class="free">is_open</span>
          id.im_sheaf id.im_sheaf_morphisms <span class="var">?add</span> <span class="var">?mult</span> <span class="var">?zero</span> <span class="var">?one</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">add_str</span>
          <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">λ</span><span class="bound">x</span><span class="main">∈</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> morphism_presheaves_of_rings_axioms_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rh open_imp_subset <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_map_from_is_homomorphism map.map_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"iso_presheaves_of_rings_axioms <span class="free">S</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span>
            id.im_sheaf id.im_sheaf_morphisms <span class="free">b</span> <span class="var">?add</span> <span class="var">?mult</span> <span class="var">?zero</span> <span class="var">?one</span> <span class="var">?F</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> presheaf_of_rings_axioms iso_presheaves_of_rings_axioms_def morphism_presheaves_of_rings_def open_imp_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Quotient Ring›</span></span>

<span class="comment1">(*Probably for Group_Theory*)</span>
<span class="keyword1"><span class="command">context</span></span> group <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Comm_Ring-cancel_imp_equal"><span class="command">lemma</span></span> cancel_imp_equal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">u</span> <span class="main"><span class="free">⋅</span></span> inverse <span class="free">v</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span><span class="main">;</span>  <span class="free">u</span> <span class="main">∈</span> <span class="free">G</span><span class="main">;</span> <span class="free">v</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> invertible invertible_inverse_closed invertible_right_cancel invertible_right_inverse<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(*Probably for Ring_Theory*)</span>
<span class="keyword1"><span class="command">context</span></span> ring <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Comm_Ring-inverse_distributive"><span class="command">lemma</span></span> inverse_distributive<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">c</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span> <span class="main">-</span> <span class="free">a</span> <span class="main"><span class="free">⋅</span></span> <span class="free">c</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">c</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">b</span> <span class="main">-</span> <span class="free">c</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span> <span class="main">-</span> <span class="free">c</span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> additive.invertible additive.invertible_inverse_closed distributive
        local.left_minus local.right_minus <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> quotient_ring <span class="main">=</span> comm<span class="main">:</span>comm_ring <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="main">+</span> submonoid <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">S</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">R</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">addition</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">multiplication</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">zero</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟬</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
<span class="free">unit</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭</span>"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> comm_ring_simps <span class="main">=</span>
  comm.multiplicative.associative
  comm.additive.associative
  comm.comm_mult
  comm.additive.commutative
  right_minus

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">∼</span>"</span> 80<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">∼</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">s1</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main"><span class="free">⋅</span></span> fst <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> snd <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⋅</span></span> fst <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span>"</span></span>

<span class="keyword1" id="Comm_Ring-rel_refl"><span class="command">lemma</span></span> rel_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∼</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_def<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-rel_sym"><span class="command">lemma</span></span> rel_sym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∼</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∼</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rx</span></span> <span class="skolem"><span class="skolem">sx</span></span> <span class="skolem"><span class="skolem">ry</span></span> <span class="skolem"><span class="skolem">sy</span></span> <span class="skolem"><span class="skolem">s</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">rx</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sx</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ry</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sy</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">sy</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">rx</span> <span class="main">-</span> <span class="skolem">sx</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">ry</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">rx</span><span class="main">,</span><span class="skolem">sx</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ry</span><span class="main">,</span><span class="skolem">sy</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">sx</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">ry</span> <span class="main">-</span> <span class="skolem">sy</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">rx</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sub comm.additive.cancel_imp_equal comm.inverse_distributive<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comm.multiplicative.composition_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> § <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-rel_trans"><span class="command">lemma</span></span> rel_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∼</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∼</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∼</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">s</span> <span class="skolem">r2</span> <span class="skolem">s2</span> <span class="skolem">r1</span> <span class="skolem">s1</span> <span class="skolem">sx</span> <span class="skolem">sy</span>
  <span class="keyword3"><span class="command">assume</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sx</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sy</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> sx0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sx</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r2</span> <span class="main">-</span> <span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r1</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sy0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sy</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r</span> <span class="main">-</span> <span class="skolem">s</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r2</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r</span> <span class="main">-</span> <span class="skolem">s</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r1</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sx</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">sy</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s2</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> § <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> sx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sx</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r2</span> <span class="main">=</span> <span class="skolem">sx</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sy</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r</span> <span class="main">=</span> <span class="skolem">sy</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sx0 sy0 § comm.additive.cancel_imp_equal comm.inverse_distributive<span class="main">(</span>1<span class="main">)</span>
        comm.multiplicative.associative comm.multiplicative.composition_closed sub
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sx</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">sy</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r</span> <span class="main">-</span> <span class="skolem">s</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">sx</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">sy</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r</span> <span class="main">-</span> <span class="skolem">sx</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">sy</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"§"</span> <span class="quoted"><span class="quoted">‹<span class="skolem">sx</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">sy</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s2</span> <span class="main">∈</span> <span class="free">S</span>›</span></span>
        comm.inverse_distributive<span class="main">(</span>1<span class="main">)</span> comm.multiplicative.associative comm.multiplicative.composition_closed
        sub
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">sx</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">sy</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r2</span> <span class="main">-</span> <span class="skolem">sx</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">sy</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> §
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> sy comm.comm_mult comm.multiplicative.associative comm.multiplicative.composition_closed sub<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">sx</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">sy</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r2</span> <span class="main">-</span> <span class="skolem">sx</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">sy</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> § <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> sx comm.comm_mult comm.multiplicative.associative
          comm.multiplicative.composition_closed sub<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> § <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comm.ring_mult_ac<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sx</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">sy</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r</span> <span class="main">-</span> <span class="skolem">s</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r1</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> rel<span class="main">:</span> equivalence <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">x</span></span><span class="main">,</span><span class="bound"><span class="bound">y</span></span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span><span class="main">×</span><span class="free">S</span><span class="main">)</span><span class="main">×</span><span class="main">(</span><span class="free">R</span><span class="main">×</span><span class="free">S</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∼</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> equivalence.intro rel_refl rel_sym rel_trans<span class="main">)</span>


<span class="keyword1"><span class="command">notation</span></span> equivalence.Partition <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">'/</span>"</span> 75<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">frac</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">'/</span>"</span> 75<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main"><span class="free">/</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> rel.Class <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Comm_Ring-frac_Pow"><span class="command">lemma</span></span> frac_Pow<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span> <span class="main">⟹</span> frac <span class="free">r</span> <span class="free">s</span> <span class="main">∈</span> Pow <span class="main">(</span><span class="free">R</span> <span class="main">×</span> <span class="free">S</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.frac_def rel.Class_closed2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Comm_Ring-frac_eqI"><span class="command">lemma</span></span> frac_eqI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s'</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r</span> <span class="main">=</span> <span class="free">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"frac <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> frac <span class="free">r'</span> <span class="free">s'</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> frac_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rel.Class_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">s'</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r</span> <span class="main">-</span> <span class="free">s</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r'</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms comm.inverse_distributive<span class="main">(</span>1<span class="main">)</span> comm.multiplicative.associative <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s1</span><span class="main">∈</span><span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">∼</span> <span class="main">(</span><span class="free">r'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span><span class="main">,</span> <span class="free">r'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">×</span> <span class="free">S</span><span class="main">)</span> <span class="main">×</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∼</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-frac_eq_Ex"><span class="command">lemma</span></span> frac_eq_Ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"frac <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> frac <span class="free">r'</span> <span class="free">s'</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">s1</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">s'</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r</span> <span class="main">-</span> <span class="free">s</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r'</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">∼</span> <span class="main">(</span><span class="free">r'</span><span class="main">,</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹frac <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> frac <span class="free">r'</span> <span class="free">s'</span>›</span></span> rel.Class_equivalence<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> rel_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_conv snd_conv that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-frac_cancel"><span class="command">lemma</span></span> frac_cancel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"frac <span class="main">(</span><span class="free">s1</span><span class="main"><span class="free">⋅</span></span><span class="free">r</span><span class="main">)</span> <span class="main">(</span><span class="free">s1</span><span class="main"><span class="free">⋅</span></span><span class="free">s</span><span class="main">)</span> <span class="main">=</span> frac <span class="free">r</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> frac_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="free"><span class="quoted"><span class="main"><span class="free">𝟭</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms comm_ring_simps <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Comm_Ring-frac_eq_obtains"><span class="command">lemma</span></span> frac_eq_obtains<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="main">(</span>frac <span class="free">r</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">s1</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s</span> <span class="main"><span class="free">⋅</span></span> fst <span class="free">x</span> <span class="main">=</span> <span class="free">s1</span> <span class="main"><span class="free">⋅</span></span> snd <span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="main">(</span><span class="free">r</span><span class="main">/</span><span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> x_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> someI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">r</span></span><span class="main"><span class="main">,</span></span><span class="free"><span class="free">s</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> local.frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> rel.ClassD<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> frac_def<span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>›</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> x_RS<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∼</span> <span class="main">(</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">s</span> <span class="main"><span class="free">⋅</span></span> fst <span class="free">x</span> <span class="main">-</span> snd <span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s</span> <span class="main"><span class="free">⋅</span></span> fst <span class="free">x</span> <span class="main">=</span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> snd <span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comm.distributive x_RS assms<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> comm.additive.group_axioms group.cancel_imp_equal comm.inverse_distributive<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>
        mem_Sigma_iff comm.multiplicative.associative comm.multiplicative.composition_closed prod.collapse sub<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that x_RS <span class="quoted"><span class="quoted">‹<span class="skolem">s1</span><span class="main">∈</span><span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">valid_frac</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">valid_frac</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">r</span><span class="main">∈</span><span class="free">R</span><span class="main">.</span> <span class="main">∃</span><span class="bound">s</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="bound">r</span> <span class="main">/</span> <span class="bound">s</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span>"</span></span>

<span class="keyword1" id="Comm_Ring-frac_non_empty"><span class="command">lemma</span></span> frac_non_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span> <span class="main">⟹</span> valid_frac <span class="main">(</span>frac <span class="free">a</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> frac_def valid_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">add_rel_aux</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">add_rel_aux</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">r'</span></span></span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main"><span class="free">⋅</span></span><span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main"><span class="free">+</span></span> <span class="free"><span class="bound"><span class="entity">r'</span></span></span><span class="main"><span class="free">⋅</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">⋅</span></span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">add_rel</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">add_rel</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">≡</span>
  <span class="keyword1">let</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="keyword1">in</span>
  <span class="keyword1">let</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span> <span class="keyword1">in</span>
  add_rel_aux <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>fst <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Comm_Ring-add_rel_frac"><span class="command">lemma</span></span> add_rel_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span><span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="main">(</span><span class="free">r</span><span class="main">/</span><span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="free">r'</span><span class="main">/</span><span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span><span class="main"><span class="free">⋅</span></span><span class="free">s'</span> <span class="main"><span class="free">+</span></span> <span class="free">r'</span><span class="main"><span class="free">⋅</span></span><span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">s</span><span class="main"><span class="free">⋅</span></span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="free">r</span><span class="main">/</span><span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="main">(</span><span class="free">r'</span><span class="main">/</span><span class="free">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s</span> <span class="main"><span class="free">⋅</span></span> fst <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_RS<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> frac_eq_obtains<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>›</span></span> x_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s'</span> <span class="main"><span class="free">⋅</span></span> fst <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">y</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y_RS<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> frac_eq_obtains<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">r'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>›</span></span> y_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="main">(</span><span class="free">r</span><span class="main">/</span><span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="free">r'</span><span class="main">/</span><span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fst <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">y</span> <span class="main"><span class="free">+</span></span> fst <span class="skolem">y</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> add_rel_def add_rel_aux_def x_def y_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span><span class="main"><span class="free">⋅</span></span><span class="free">s'</span> <span class="main"><span class="free">+</span></span> <span class="free">r'</span><span class="main"><span class="free">⋅</span></span><span class="free">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">s</span><span class="main"><span class="free">⋅</span></span><span class="free">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> frac_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">s1</span></span> <span class="main"><span class="free"><span class="main"><span class="free">⋅</span></span></span></span> <span class="skolem"><span class="skolem">s2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">y</span> <span class="main"><span class="free">⋅</span></span>  <span class="free">s'</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span>  <span class="free">s</span> <span class="main"><span class="free">⋅</span></span> fst <span class="skolem">x</span><span class="main">)</span>  <span class="main">=</span> snd <span class="skolem">y</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s'</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span>  snd <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span>  <span class="free">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s'</span> <span class="main"><span class="free">⋅</span></span> fst <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">y</span> <span class="main">=</span>  <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">y</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comm.multiplicative.associative assms x_RS y_RS comm.comm_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s</span> <span class="main"><span class="free">⋅</span></span><span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s'</span> <span class="main"><span class="free">⋅</span></span> fst <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> snd <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s</span> <span class="main"><span class="free">⋅</span></span><span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">y</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> y_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s'</span> <span class="main"><span class="free">⋅</span></span> fst <span class="skolem">y</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">y</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r'</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comm.multiplicative.associative assms x_RS y_RS comm.comm_mult
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">s</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s'</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span>fst <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">y</span> <span class="main"><span class="free">+</span></span> fst <span class="skolem">y</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">x</span><span class="main">)</span>
        <span class="main">=</span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">y</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s'</span> <span class="main"><span class="free">+</span></span> <span class="free">r'</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comm.multiplicative.associative assms x_RS y_RS comm.distributive
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s2</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">y</span> <span class="main"><span class="free">+</span></span> fst <span class="skolem">y</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">x</span><span class="main">,</span> snd <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s'</span> <span class="main"><span class="free">+</span></span> <span class="free">r'</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s</span><span class="main">,</span> <span class="free">s</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms x_RS y_RS <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-valid_frac_add"><span class="command">lemma</span></span> valid_frac_add<span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_frac <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"valid_frac <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_frac <span class="main">(</span>add_rel <span class="free">X</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">∈</span><span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span><span class="main">∈</span><span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">∈</span><span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"add_rel <span class="free">X</span> <span class="free">Y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span><span class="main"><span class="free">⋅</span></span><span class="skolem">s'</span> <span class="main"><span class="free">+</span></span> <span class="skolem">r'</span><span class="main"><span class="free">⋅</span></span><span class="skolem">s</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">s</span><span class="main"><span class="free">⋅</span></span><span class="skolem">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="free">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">Y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> x_def y_def valid_frac_def some_in_eq local.frac_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_frac_def x_def y_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> frac_eq_obtains mem_Sigma_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="free">X</span> <span class="free">Y</span> <span class="main">=</span> <span class="main">(</span>fst <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">y</span> <span class="main"><span class="free">+</span></span> fst <span class="skolem">y</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> add_rel_def add_rel_aux_def x_def y_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1-4<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span><span class="main"><span class="free">⋅</span></span><span class="skolem">s'</span> <span class="main"><span class="free">+</span></span> <span class="skolem">r'</span><span class="main"><span class="free">⋅</span></span><span class="skolem">s</span><span class="main">,</span><span class="skolem">s</span><span class="main"><span class="free">⋅</span></span><span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">uminus_rel</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">uminus_rel</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="keyword1">in</span> <span class="main">(</span>comm.additive.inverse <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> snd <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Comm_Ring-uminus_rel_frac"><span class="command">lemma</span></span> uminus_rel_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uminus_rel <span class="main">(</span><span class="free">r</span><span class="main">/</span><span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>comm.additive.inverse <span class="free">r</span><span class="main">)</span> <span class="main">/</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="free">r</span><span class="main">/</span><span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s</span> <span class="main"><span class="free">⋅</span></span> fst <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_RS<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> frac_eq_obtains<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>›</span></span> x_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uminus_rel <span class="main">(</span><span class="free">r</span><span class="main">/</span><span class="free">s</span><span class="main">)</span><span class="main">=</span> <span class="main">(</span>comm.additive.inverse <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> uminus_rel_def x_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>comm.additive.inverse <span class="free">r</span><span class="main">)</span> <span class="main">/</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> frac_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> x_RS assms x_eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comm.right_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-valid_frac_uminus"><span class="command">lemma</span></span> valid_frac_uminus<span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_frac <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_frac <span class="main">(</span>uminus_rel <span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">∈</span><span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∈</span><span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"uminus_rel <span class="free">X</span> <span class="main">=</span> <span class="main">(</span>comm.additive.inverse <span class="skolem">r</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">s</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> x_def valid_frac_def some_in_eq local.frac_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms valid_frac_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> frac_eq_obtains mem_Sigma_iff x_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uminus_rel <span class="free">X</span> <span class="main">=</span> <span class="main">(</span>comm.additive.inverse <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="main">)</span> <span class="main">/</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> uminus_rel_def x_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1-3<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>comm.additive.inverse <span class="skolem">r</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mult_rel_aux</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mult_rel_aux</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">r'</span></span></span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main"><span class="free">⋅</span></span><span class="free"><span class="bound"><span class="entity">r'</span></span></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">⋅</span></span><span class="free"><span class="bound"><span class="entity">s'</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mult_rel</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mult_rel</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">≡</span>
  <span class="keyword1">let</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="keyword1">in</span>
  <span class="keyword1">let</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span> <span class="keyword1">in</span>
  mult_rel_aux <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>fst <span class="bound">y</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Comm_Ring-mult_rel_frac"><span class="command">lemma</span></span> mult_rel_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span><span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="main">(</span><span class="free">r</span><span class="main">/</span><span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="free">r'</span><span class="main">/</span><span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span><span class="main"><span class="free">⋅</span></span> <span class="free">r'</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">s</span><span class="main"><span class="free">⋅</span></span><span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
   <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="free">r</span><span class="main">/</span><span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="main">(</span><span class="free">r'</span><span class="main">/</span><span class="free">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s</span> <span class="main"><span class="free">⋅</span></span> fst <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_RS<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> frac_eq_obtains<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>›</span></span> x_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s'</span> <span class="main"><span class="free">⋅</span></span> fst <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">y</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y_RS<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> frac_eq_obtains<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">r'</span><span class="main">,</span><span class="free">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>›</span></span> y_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="main">(</span><span class="free">r</span><span class="main">/</span><span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="free">r'</span><span class="main">/</span><span class="free">s'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>fst <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> fst <span class="skolem">y</span> <span class="main">)</span> <span class="main">/</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mult_rel_def mult_rel_aux_def x_def y_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">r</span><span class="main"><span class="free">⋅</span></span> <span class="free">r'</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">s</span><span class="main"><span class="free">⋅</span></span><span class="free">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> frac_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">s1</span></span> <span class="main"><span class="free"><span class="main"><span class="free">⋅</span></span></span></span> <span class="skolem"><span class="skolem">s2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s</span> <span class="main"><span class="free">⋅</span></span> fst <span class="skolem">x</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s'</span> <span class="main"><span class="free">⋅</span></span> fst <span class="skolem">y</span><span class="main">)</span>  <span class="main">=</span> <span class="main">(</span><span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">y</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x_eq y_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">s</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s'</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span>fst <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> fst <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s2</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">y</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> comm.multiplicative.associative assms x_RS y_RS comm.distributive comm.comm_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s2</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> fst <span class="skolem">y</span><span class="main">,</span> snd <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r'</span><span class="main">,</span> <span class="free">s</span> <span class="main"><span class="free">⋅</span></span> <span class="free">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms x_RS y_RS <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-valid_frac_mult"><span class="command">lemma</span></span> valid_frac_mult<span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_frac <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"valid_frac <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valid_frac <span class="main">(</span>mult_rel <span class="free">X</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="skolem"><span class="skolem">r'</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">∈</span><span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">∈</span><span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r'</span><span class="main">∈</span><span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span><span class="main">∈</span><span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"mult_rel <span class="free">X</span> <span class="free">Y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">r</span><span class="main"><span class="free">⋅</span></span> <span class="skolem">r'</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">s</span><span class="main"><span class="free">⋅</span></span><span class="skolem">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="free">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">Y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> x_def y_def valid_frac_def some_in_eq local.frac_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_frac_def x_def y_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> frac_eq_obtains mem_Sigma_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="free">X</span> <span class="free">Y</span> <span class="main">=</span> <span class="main">(</span>fst <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> fst <span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>snd <span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> snd <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mult_rel_def mult_rel_aux_def x_def y_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>1-4<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">r</span><span class="main"><span class="free">⋅</span></span><span class="skolem">r'</span><span class="main">,</span><span class="skolem">s</span><span class="main"><span class="free">⋅</span></span><span class="skolem">s'</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">zero_rel</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">zero_rel</span> <span class="main">=</span> frac <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">one_rel</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">one_rel</span> <span class="main">=</span> frac <span class="main"><span class="free">𝟭</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>

<span class="keyword1" id="Comm_Ring-valid_frac_zero"><span class="command">lemma</span></span> valid_frac_zero<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"valid_frac zero_rel"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> zero_rel_def valid_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Comm_Ring-valid_frac_one"><span class="command">lemma</span></span> valid_frac_one<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"valid_frac one_rel"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> one_rel_def valid_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">carrier_quotient_ring</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">carrier_quotient_ring</span> <span class="main">≡</span> rel.Partition"</span></span>

<span class="keyword1" id="Comm_Ring-carrier_quotient_ring_iff"><span class="command">lemma</span></span> carrier_quotient_ring_iff<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> carrier_quotient_ring <span class="main">⟷</span> valid_frac <span class="free">X</span> "</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_frac_def carrier_quotient_ring_def
  <span class="keyword1"><span class="command">using</span></span> local.frac_def rel.natural.map_closed rel.representant_exists <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Comm_Ring-frac_from_carrier"><span class="command">lemma</span></span> frac_from_carrier<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> carrier_quotient_ring"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">r</span> <span class="free">s</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> rel.Class <span class="main">(</span><span class="free">r</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms carrier_quotient_ring_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> SigmaE rel.representant_exists<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-add_minus_zero_rel"><span class="command">lemma</span></span> add_minus_zero_rel<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"valid_frac <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="free">a</span> <span class="main">(</span>uminus_rel <span class="free">a</span><span class="main">)</span> <span class="main">=</span> zero_rel"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="keyword2"><span class="keyword">where</span></span> a_RS<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a1</span><span class="main">,</span> <span class="skolem">a2</span><span class="main">)</span><span class="main">∈</span><span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="skolem">a1</span> <span class="main">/</span> <span class="skolem">a2</span> "</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_frac <span class="free">a</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> valid_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="free">a</span> <span class="main">(</span>uminus_rel <span class="free">a</span><span class="main">)</span> <span class="main">=</span>  <span class="main"><span class="free">𝟬</span></span> <span class="main">/</span> <span class="main">(</span><span class="skolem">a2</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">a2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> a12 <span class="keyword1"><span class="command">using</span></span> comm_ring_simps a_RS
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>add_rel_frac uminus_rel_frac comm.right_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span> <span class="main">/</span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> frac_eqI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="free"><span class="quoted"><span class="main"><span class="free">𝟭</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> a_RS <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> zero_rel"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> zero_rel_def <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="free">a</span> <span class="main">(</span>uminus_rel <span class="free">a</span><span class="main">)</span> <span class="main">=</span> zero_rel"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(* ex. 0.26 *)</span>
<span class="keyword1"><span class="command">sublocale</span></span> comm_ring <span class="quoted">carrier_quotient_ring</span> <span class="quoted">add_rel</span> <span class="quoted">mult_rel</span> <span class="quoted">zero_rel</span> <span class="quoted">one_rel</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">unfold</span> carrier_quotient_ring_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> add_assoc<span class="main">:</span><span class="quoted"><span class="quoted">"add_rel <span class="main">(</span>add_rel <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">=</span> add_rel <span class="skolem">a</span> <span class="main">(</span>add_rel <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
       mult_assoc<span class="main">:</span><span class="quoted"><span class="quoted">"mult_rel <span class="main">(</span>mult_rel <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">=</span> mult_rel <span class="skolem">a</span> <span class="main">(</span>mult_rel <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
       distr<span class="main">:</span><span class="quoted"><span class="quoted">"mult_rel <span class="skolem">a</span> <span class="main">(</span>add_rel <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> add_rel <span class="main">(</span>mult_rel <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>mult_rel <span class="skolem">a</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"valid_frac <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_frac <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_frac <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="keyword2"><span class="keyword">where</span></span> a_RS<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a1</span><span class="main">,</span> <span class="skolem">a2</span><span class="main">)</span><span class="main">∈</span><span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a1</span> <span class="main">/</span> <span class="skolem">a2</span> "</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_frac <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> valid_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b1</span></span> <span class="skolem"><span class="skolem">b2</span></span> <span class="keyword2"><span class="keyword">where</span></span> b_RS<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b1</span><span class="main">,</span> <span class="skolem">b2</span><span class="main">)</span><span class="main">∈</span><span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b1</span> <span class="main">/</span> <span class="skolem">b2</span> "</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_frac <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> valid_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c1</span></span> <span class="skolem"><span class="skolem">c2</span></span> <span class="keyword2"><span class="keyword">where</span></span> c_RS<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">c2</span><span class="main">)</span><span class="main">∈</span><span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="skolem">c1</span> <span class="main">/</span> <span class="skolem">c2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_frac <span class="skolem">c</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> valid_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="main">(</span>add_rel <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">=</span> add_rel <span class="main">(</span>add_rel <span class="main">(</span><span class="skolem">a1</span><span class="main">/</span><span class="skolem">a2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">b1</span><span class="main">/</span><span class="skolem">b2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">/</span><span class="skolem">c2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a12 b12 c12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b2</span> <span class="main"><span class="free">+</span></span> <span class="skolem">b1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">a2</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">c2</span> <span class="main"><span class="free">+</span></span> <span class="skolem">c1</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">a2</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">a2</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b2</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">c2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a_RS b_RS c_RS <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>add_rel_frac<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> add_rel <span class="main">(</span><span class="skolem">a1</span><span class="main">/</span><span class="skolem">a2</span><span class="main">)</span> <span class="main">(</span>add_rel <span class="main">(</span><span class="skolem">b1</span><span class="main">/</span><span class="skolem">b2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">/</span><span class="skolem">c2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a_RS b_RS c_RS comm.distributive comm_ring_simps
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>add_rel_frac<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> add_rel <span class="skolem">a</span> <span class="main">(</span>add_rel <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a12 b12 c12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="main">(</span>add_rel <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">=</span> add_rel <span class="skolem">a</span> <span class="main">(</span>add_rel <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="main">(</span>mult_rel <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">=</span> mult_rel <span class="skolem">a</span> <span class="main">(</span>mult_rel <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> a12 b12 c12 <span class="keyword1"><span class="command">using</span></span> comm_ring_simps a_RS b_RS c_RS
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mult_rel_frac<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="skolem">a</span> <span class="main">(</span>add_rel <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a1</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">b1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">c2</span> <span class="main"><span class="free">+</span></span> <span class="skolem">c1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">a2</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">b2</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">c2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> a12 b12 c12 <span class="keyword1"><span class="command">using</span></span> a_RS b_RS c_RS
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mult_rel_frac add_rel_frac<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a2</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">a1</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">b1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">c2</span> <span class="main"><span class="free">+</span></span> <span class="skolem">c1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">a2</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">a2</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">b2</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">c2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a_RS b_RS c_RS <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>frac_cancel<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> add_rel <span class="main">(</span>mult_rel <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>mult_rel <span class="skolem">a</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> a12 b12 c12 <span class="keyword1"><span class="command">using</span></span> comm_ring_simps a_RS b_RS c_RS comm.distributive
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mult_rel_frac add_rel_frac<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="skolem">a</span> <span class="main">(</span>add_rel <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> add_rel <span class="main">(</span>mult_rel <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>mult_rel <span class="skolem">a</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> add_0<span class="main">:</span><span class="quoted"><span class="quoted">"add_rel zero_rel <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> mult_1<span class="main">:</span><span class="quoted"><span class="quoted">"mult_rel one_rel <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
     <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"valid_frac <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="keyword2"><span class="keyword">where</span></span> a_RS<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a1</span><span class="main">,</span> <span class="skolem">a2</span><span class="main">)</span><span class="main">∈</span><span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a1</span> <span class="main">/</span> <span class="skolem">a2</span> "</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_frac <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> valid_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_rel zero_rel <span class="skolem">a</span> <span class="main">=</span> add_rel zero_rel <span class="main">(</span><span class="skolem">a1</span><span class="main">/</span><span class="skolem">a2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a1</span><span class="main">/</span><span class="skolem">a2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a_RS comm_ring_simps comm.distributive zero_rel_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>add_rel_frac<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a12 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_rel zero_rel <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_rel one_rel <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> a12 one_rel_def <span class="keyword1"><span class="command">using</span></span> a_RS <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mult_rel_frac<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> add_commute<span class="main">:</span><span class="quoted"><span class="quoted">"add_rel <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">=</span> add_rel <span class="skolem">b</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mult_commute<span class="main">:</span><span class="quoted"><span class="quoted">"mult_rel <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">=</span> mult_rel <span class="skolem">b</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"valid_frac <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_frac <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="keyword2"><span class="keyword">where</span></span> a_RS<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a1</span><span class="main">,</span> <span class="skolem">a2</span><span class="main">)</span><span class="main">∈</span><span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a1</span> <span class="main">/</span> <span class="skolem">a2</span> "</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_frac <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> valid_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b1</span></span> <span class="skolem"><span class="skolem">b2</span></span> <span class="keyword2"><span class="keyword">where</span></span> b_RS<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b1</span><span class="main">,</span> <span class="skolem">b2</span><span class="main">)</span><span class="main">∈</span><span class="free">R</span> <span class="main">×</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b12<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">b1</span> <span class="main">/</span> <span class="skolem">b2</span> "</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹valid_frac <span class="skolem">b</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> valid_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">=</span> add_rel <span class="skolem">b</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">=</span> mult_rel <span class="skolem">b</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> a12 b12  <span class="keyword1"><span class="command">using</span></span> comm_ring_simps a_RS b_RS
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>mult_rel_frac add_rel_frac<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="skolem">a</span> zero_rel <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"valid_frac <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command">using</span></span> that add_0 add_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="skolem">a</span> one_rel <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"valid_frac <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command">using</span></span> that mult_commute mult_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid.invertible carrier_quotient_ring add_rel zero_rel <span class="skolem">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"valid_frac <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid carrier_quotient_ring add_rel zero_rel"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> add_0 add_assoc add_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="skolem">a</span> <span class="main">(</span>uminus_rel <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> zero_rel"</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="main">(</span>uminus_rel <span class="skolem">a</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span> zero_rel"</span></span>
      <span class="keyword1"><span class="command">using</span></span> add_minus_zero_rel add_commute that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid.invertible carrier_quotient_ring add_rel zero_rel <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> monoid.invertible_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> monoid.invertibleI<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> add_commute <span class="quoted"><span class="quoted">‹valid_frac <span class="skolem">a</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="main">(</span>add_rel <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span> add_rel <span class="main">(</span>mult_rel <span class="skolem">b</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>mult_rel <span class="skolem">c</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"valid_frac <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_frac <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_frac <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
    <span class="keyword1"><span class="command">using</span></span> that mult_commute add_commute distr <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_frac_add<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* quotient_ring *)</span>

<span class="keyword1"><span class="command">notation</span></span> quotient_ring.carrier_quotient_ring
           <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1"><span class="hidden">⇧</span><sup>¯</sup></span> _<span class="keyword3">/ </span><span class="keyword1">⇘</span><span class="keyword3">(2</span>_ _ _<span class="keyword3">)</span><span class="keyword3">)</span><span class="keyword1">⇙</span>"</span> <span class="main">[</span>60<span class="main">,</span>1000<span class="main">,</span>1000<span class="main">,</span>1000<span class="main">,</span>1000<span class="main">]</span>1000<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Local Rings at Prime Ideals›</span></span>

<span class="keyword1"><span class="command">context</span></span> pr_ideal
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Comm_Ring-submonoid_pr_ideal"><span class="command">lemma</span></span> submonoid_pr_ideal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"submonoid <span class="main">(</span><span class="free">R</span> <span class="main">∖</span> <span class="free">I</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">R</span><span class="main">∖</span><span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span><span class="main">∖</span><span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">R</span><span class="main">∖</span><span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff absorbent comm.multiplicative.composition_closed<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭</span></span> <span class="main">∈</span> <span class="free">R</span><span class="main">∖</span><span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ideal.ideal<span class="main">(</span>2<span class="main">)</span> ideal_axioms pr_ideal.carrier_neq pr_ideal_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">interpretation</span></span> local<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">∖</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_locales</span> <span class="main">(</span><span class="operator">meson</span> submonoid_def submonoid_pr_ideal<span class="main">)</span>

<span class="comment1">(* definition 0.28 *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">carrier_local_ring_at</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">carrier_local_ring_at</span> <span class="main">≡</span> <span class="main">(</span><span class="free">R</span> <span class="main">∖</span> <span class="free">I</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">R</span><span class="hidden">⇘</span><sub><span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">add_local_ring_at</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">add_local_ring_at</span> <span class="main">≡</span> local.add_rel "</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mult_local_ring_at</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mult_local_ring_at</span> <span class="main">≡</span> local.mult_rel "</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">uminus_local_ring_at</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">uminus_local_ring_at</span> <span class="main">≡</span> local.uminus_rel "</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">zero_local_ring_at</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">zero_local_ring_at</span> <span class="main">≡</span> local.zero_rel"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">one_local_ring_at</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_local_ring_at</span> <span class="main">≡</span> local.one_rel"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> comm_ring <span class="quoted">carrier_local_ring_at</span> <span class="quoted">add_local_ring_at</span> <span class="quoted">mult_local_ring_at</span>
            <span class="quoted">zero_local_ring_at</span> <span class="quoted">one_local_ring_at</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_local_ring_at_def carrier_local_ring_at_def local.local.comm_ring_axioms
      mult_local_ring_at_def one_local_ring_at_def zero_local_ring_at_def<span class="main">)</span>


<span class="keyword1" id="Comm_Ring-frac_from_carrier_local"><span class="command">lemma</span></span> frac_from_carrier_local<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> carrier_local_ring_at"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">r</span> <span class="free">s</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∉</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> local.frac <span class="free">r</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">∖</span> <span class="free">I</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">R</span><span class="hidden">⇘</span><sub><span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> carrier_local_ring_at_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> quotient_ring.carrier_quotient_ring <span class="main">(</span><span class="free">R</span> <span class="main">∖</span> <span class="free">I</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">∖</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> local.frac <span class="skolem">r</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.frac_from_carrier <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.frac_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-eq_from_eq_frac"><span class="command">lemma</span></span> eq_from_eq_frac<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"local.frac <span class="free">r</span> <span class="free">s</span> <span class="main">=</span> local.frac <span class="free">r'</span> <span class="free">s'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">∖</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">∖</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">r'</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">h</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">∖</span> <span class="free">I</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="free">s'</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r</span> <span class="main">-</span> <span class="free">s</span> <span class="main"><span class="free">⋅</span></span> <span class="free">r'</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.frac_eq_Ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">r'</span></span> <span class="quoted"><span class="free">s'</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* pr_ideal *)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">carrier_of_local_ring_at</span><span class="main">::</span>
<span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set set"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⇘</span>_ _ _ _<span class="keyword1">⇙</span>"</span> <span class="main">[</span>1000<span class="main">]</span>1000<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">add</span></span></span> <span class="free"><span class="bound"><span class="entity">mult</span></span></span> <span class="free"><span class="bound"><span class="entity">zero</span></span></span></sub><span class="hidden">⇙</span> <span class="main">≡</span> pr_ideal.carrier_local_ring_at <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">add</span></span></span> <span class="free"><span class="bound"><span class="entity">mult</span></span></span> <span class="free"><span class="bound"><span class="entity">zero</span></span></span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Spectrum of a Ring›</span></span>

<span class="comment1">(* construction 0.29 *)</span>
<span class="keyword1"><span class="command">context</span></span> comm_ring
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> zariski_top_space<span class="main">:</span> topological_space <span class="quoted"><span class="keyword1">Spec</span></span> <span class="quoted">is_zariski_open</span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_zariski_open_def <span class="keyword1"><span class="command">using</span></span> generated_topology_is_topology
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Comm_Ring-spectrum_imp_cxt_quotient_ring"><span class="command">lemma</span></span> spectrum_imp_cxt_quotient_ring<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="keyword1">Spec</span> <span class="main">⟹</span> quotient_ring <span class="main">(</span><span class="free">R</span> <span class="main">∖</span> <span class="free">𝔭</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro_locales</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> pr_ideal.submonoid_pr_ideal spectrum_def submonoid_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Comm_Ring-spectrum_imp_pr"><span class="command">lemma</span></span> spectrum_imp_pr<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="keyword1">Spec</span> <span class="main">⟹</span> pr_ideal <span class="free">R</span> <span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> spectrum_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Comm_Ring-frac_in_carrier_local"><span class="command">lemma</span></span> frac_in_carrier_local<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="keyword1">Spec</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∉</span> <span class="free">𝔭</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>quotient_ring.frac <span class="main">(</span><span class="free">R</span> <span class="main">∖</span> <span class="free">𝔭</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="free">r</span> <span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="free">R</span><span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> qr<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">∖</span> <span class="free">𝔭</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> spectrum_imp_cxt_quotient_ring<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">𝔭</span> <span class="main">∈</span> <span class="keyword1">Spec</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> pi<span class="main">:</span>pr_ideal <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">𝔭</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> spectrum_imp_pr<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">𝔭</span> <span class="main">∈</span> <span class="keyword1">Spec</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> pi.carrier_local_ring_at_def
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>qr.frac_non_empty<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_locally_frac</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_locally_frac</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span><span class="bound">r</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">𝔮</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">.</span> <span class="bound">f</span> <span class="main">∉</span> <span class="bound">𝔮</span> <span class="main">∧</span>
            <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">𝔮</span> <span class="main">=</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span> <span class="main">∖</span> <span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="bound">r</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Comm_Ring-is_locally_frac_subset"><span class="command">lemma</span></span> is_locally_frac_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_locally_frac <span class="free">s</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_locally_frac <span class="free">s</span> <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> is_locally_frac_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subsetD<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-is_locally_frac_cong"><span class="command">lemma</span></span> is_locally_frac_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">U</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span><span class="main">=</span><span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_locally_frac <span class="free">f</span> <span class="free">U</span> <span class="main">=</span> is_locally_frac <span class="free">g</span> <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_locally_frac_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_regular</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set set <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_regular</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">≡</span>
<span class="main">∀</span><span class="bound">𝔭</span><span class="main">.</span> <span class="bound">𝔭</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">V</span><span class="main">.</span> is_zariski_open <span class="bound">V</span> <span class="main">∧</span> <span class="bound">V</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">∧</span> <span class="bound">𝔭</span> <span class="main">∈</span> <span class="bound">V</span> <span class="main">∧</span> <span class="main">(</span>is_locally_frac <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Comm_Ring-map_on_empty_is_regular"><span class="command">lemma</span></span> map_on_empty_is_regular<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_regular <span class="free">s</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_regular_def<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-cring0_is_regular"><span class="command">lemma</span></span> cring0_is_regular <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cring0.is_regular <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cring0.is_regular_def cring0_is_zariski_open
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sheaf_spec</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span> set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝒪</span> _"</span> <span class="main">[</span>90<span class="main">]</span>90<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">𝒪</span></span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound"><span class="bound">s</span></span><span class="main">∈</span><span class="main">(</span><span class="keyword1">Π<span class="hidden">⇩</span><sub>E</sub></span> <span class="bound">𝔭</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">.</span> <span class="main">(</span><span class="free">R</span><span class="hidden">⇘</span><sub><span class="bound">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> is_regular <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Comm_Ring-cring0_sheaf_spec_empty"><span class="command">lemma</span></span> cring0_sheaf_spec_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cring0.sheaf_spec <span class="main">{}</span> <span class="main">=</span> <span class="main">{</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> undefined<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cring0.sheaf_spec_def<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-sec_has_right_codom"><span class="command">lemma</span></span> sec_has_right_codom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="free">𝔭</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span><span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms sheaf_spec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="Comm_Ring-is_regular_has_right_codom"><span class="command">lemma</span></span> is_regular_has_right_codom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"is_regular <span class="free">s</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="free">𝔭</span> <span class="main">∈</span> <span class="free">R</span><span class="main">∖</span><span class="free">𝔭</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">R</span><span class="hidden">⇘</span><sub><span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> qr<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">∖</span> <span class="free">𝔭</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> spectrum_imp_cxt_quotient_ring assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> frac_in_carrier_local is_locally_frac_def is_regular_def
          pr_ideal.carrier_local_ring_at_def spectrum_imp_pr subset_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-sec_is_extensional"><span class="command">lemma</span></span> sec_is_extensional<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> extensional <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sheaf_spec_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PiE_iff<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">𝒪b</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒪b</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">𝔭</span><span class="main">.</span> undefined<span class="main">)</span>"</span></span>

<span class="keyword1" id="Comm_Ring-𝒪_on_emptyset"><span class="command">lemma</span></span> 𝒪_on_emptyset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝒪</span> <span class="main">{}</span> <span class="main">=</span> <span class="main">{</span>𝒪b<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sheaf_spec_def 𝒪b_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Set_Theory.map_def map_on_empty_is_regular<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-sheaf_spec_of_empty_is_singleton"><span class="command">lemma</span></span> sheaf_spec_of_empty_is_singleton<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">U</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> extensional <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> extensional <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Set_Theory.map_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">add_sheaf_spec</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">add_sheaf_spec</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">𝔭</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">.</span> quotient_ring.add_rel <span class="main">(</span><span class="free">R</span> <span class="main">∖</span> <span class="bound">𝔭</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">𝔭</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="bound">𝔭</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Comm_Ring-is_regular_add_sheaf_spec"><span class="command">lemma</span></span> is_regular_add_sheaf_spec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_regular <span class="free">s</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular <span class="free">s'</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_regular <span class="main">(</span>add_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="free">s'</span><span class="main">)</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="free">s'</span> <span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">R</span> <span class="hidden">⇘</span><sub><span class="skolem">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">interpret</span></span> pi<span class="main">:</span> pr_ideal <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="skolem">𝔭</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> spectrum_def<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="skolem">𝔭</span> <span class="main">∈</span> pi.carrier_local_ring_at"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="skolem">𝔭</span> <span class="main">∈</span> pi.carrier_local_ring_at"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_regular <span class="free">s</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹is_regular <span class="free">s'</span> <span class="free">U</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> is_regular_def is_locally_frac_def <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> frac_in_carrier_local <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> add_sheaf_spec_def <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span>pi.add_local_ring_at_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">V</span></span><span class="main">⊆</span><span class="free">U</span><span class="main">.</span> is_zariski_open <span class="bound">V</span> <span class="main">∧</span> <span class="skolem">𝔭</span> <span class="main">∈</span> <span class="bound">V</span> <span class="main">∧</span> is_locally_frac <span class="main">(</span>add_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="free">s'</span><span class="main">)</span> <span class="bound">V</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V1</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">f1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V1</span> <span class="main">⊆</span><span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">V1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">V1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        q_V1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">𝔮</span><span class="main">.</span> <span class="bound">𝔮</span> <span class="main">∈</span> <span class="skolem">V1</span> <span class="main">⟶</span> <span class="skolem">f1</span> <span class="main">∉</span> <span class="bound">𝔮</span> <span class="main">∧</span> <span class="free">s</span> <span class="bound">𝔮</span> <span class="main">=</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">r1</span> <span class="skolem">f1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_regular <span class="free">s</span> <span class="free">U</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> is_regular_def<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> is_locally_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V2</span></span> <span class="skolem"><span class="skolem">r2</span></span> <span class="skolem"><span class="skolem">f2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V2</span> <span class="main">⊆</span><span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">V2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">V2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f2</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        q_V2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">𝔮</span><span class="main">.</span> <span class="bound">𝔮</span> <span class="main">∈</span> <span class="skolem">V2</span> <span class="main">⟶</span> <span class="skolem">f2</span> <span class="main">∉</span> <span class="bound">𝔮</span> <span class="main">∧</span> <span class="free">s'</span> <span class="bound">𝔮</span> <span class="main">=</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">r2</span> <span class="skolem">f2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_regular <span class="free">s'</span> <span class="free">U</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> is_regular_def<span class="main">]</span>  <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> is_locally_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">V3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V3</span> <span class="main">=</span> <span class="skolem">V1</span> <span class="main">∩</span> <span class="skolem">V2</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r3</span> <span class="main">=</span> <span class="skolem">r1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">f2</span> <span class="main"><span class="free">+</span></span> <span class="skolem">r2</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">f1</span> "</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="main">=</span> <span class="skolem">f1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">f2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V3</span> <span class="main">⊆</span><span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">V3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r3</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> V3_def r3_def f3_def
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V1</span> <span class="main">⊆</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">V1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V2</span> <span class="main">⊆</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">V2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f1</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f2</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r1</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r2</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">V3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_zariski_open <span class="skolem">V1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_zariski_open <span class="skolem">V2</span>›</span></span> topological_space.open_inter <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> V3_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="main">∉</span> <span class="skolem">𝔮</span>"</span></span>
        <span class="quoted"><span class="quoted">"add_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="free">s'</span> <span class="skolem">𝔮</span> <span class="main">=</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="skolem">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">r3</span> <span class="skolem">f3</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="skolem">V3</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔮</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">interpret</span></span> q<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">∖</span><span class="skolem">𝔮</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V3</span> <span class="main">⊆</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="skolem">V3</span>›</span></span> quotient_ring_def local.comm_ring_axioms
          pr_ideal.submonoid_pr_ideal spectrum_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="main">∉</span> <span class="skolem">𝔮</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="skolem">𝔮</span> <span class="main">=</span> q.frac <span class="skolem">r1</span> <span class="skolem">f1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> q_V1 <span class="quoted"><span class="quoted">‹<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="skolem">V3</span>›</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> V3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f2</span> <span class="main">∉</span> <span class="skolem">𝔮</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="skolem">𝔮</span> <span class="main">=</span> q.frac <span class="skolem">r2</span> <span class="skolem">f2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> q_V2 <span class="quoted"><span class="quoted">‹<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="skolem">V3</span>›</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> V3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"q.add_rel <span class="main">(</span>q.frac <span class="skolem">r1</span> <span class="skolem">f1</span><span class="main">)</span> <span class="main">(</span>q.frac <span class="skolem">r2</span> <span class="skolem">f2</span><span class="main">)</span> <span class="main">=</span> q.frac <span class="main">(</span><span class="skolem">r1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">f2</span> <span class="main"><span class="free">+</span></span> <span class="skolem">r2</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">f1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">f2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> q.add_rel_frac<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f1</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f1</span> <span class="main">∉</span> <span class="skolem">𝔮</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r1</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r2</span> <span class="main">∈</span> <span class="free">R</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f2</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f2</span> <span class="main">∉</span> <span class="skolem">𝔮</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r2</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"q.add_rel <span class="main">(</span><span class="free">s</span> <span class="skolem">𝔮</span><span class="main">)</span> <span class="main">(</span><span class="free">s'</span> <span class="skolem">𝔮</span><span class="main">)</span> <span class="main">=</span> q.frac <span class="skolem">r3</span> <span class="skolem">f3</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> r3_def f3_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="skolem">𝔮</span> <span class="main">=</span> q.frac <span class="skolem">r1</span> <span class="skolem">f1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s'</span> <span class="skolem">𝔮</span> <span class="main">=</span> q.frac <span class="skolem">r2</span> <span class="skolem">f2</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="free">s'</span> <span class="skolem">𝔮</span> <span class="main">=</span> q.frac <span class="skolem">r3</span> <span class="skolem">f3</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> add_sheaf_spec_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V3</span> <span class="main">⊆</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="skolem">V3</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="main">∉</span> <span class="skolem">𝔮</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> V3_def f3_def
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f1</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f1</span> <span class="main">∉</span> <span class="skolem">𝔮</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f2</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f2</span> <span class="main">∉</span> <span class="skolem">𝔮</span>›</span></span> q.sub_composition_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> is_locally_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_regular_def is_locally_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-add_sheaf_spec_in_sheaf_spec"><span class="command">lemma</span></span> add_sheaf_spec_in_sheaf_spec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="free">t</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="free">t</span> <span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">R</span> <span class="hidden">⇘</span><sub><span class="skolem">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">interpret</span></span> qr<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="skolem">𝔭</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> spectrum_imp_cxt_quotient_ring<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">interpret</span></span> pi<span class="main">:</span>pr_ideal <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="skolem">𝔭</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>spectrum_imp_pr<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"qr.valid_frac <span class="main">(</span><span class="free">s</span> <span class="skolem">𝔭</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"qr.valid_frac <span class="main">(</span><span class="free">t</span> <span class="skolem">𝔭</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sec_has_right_codom<span class="main">[</span><span class="operator">OF</span> _ that<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>pi.carrier_local_ring_at_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> add_sheaf_spec_def pi.carrier_local_ring_at_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_regular <span class="main">(</span>add_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="free">t</span><span class="main">)</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>›</span></span> is_regular_add_sheaf_spec
    <span class="keyword1"><span class="command">unfolding</span></span> sheaf_spec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="free">t</span> <span class="main">∈</span> extensional <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> add_sheaf_spec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sheaf_spec_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PiE_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mult_sheaf_spec</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mult_sheaf_spec</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">𝔭</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">.</span> quotient_ring.mult_rel <span class="main">(</span><span class="free">R</span> <span class="main">∖</span> <span class="bound">𝔭</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">𝔭</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s'</span></span></span> <span class="bound">𝔭</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Comm_Ring-is_regular_mult_sheaf_spec"><span class="command">lemma</span></span> is_regular_mult_sheaf_spec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_regular <span class="free">s</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_regular <span class="free">s'</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_regular <span class="main">(</span>mult_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="free">s'</span><span class="main">)</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mult_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="free">s'</span> <span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">R</span> <span class="hidden">⇘</span><sub><span class="skolem">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">interpret</span></span> pi<span class="main">:</span> pr_ideal <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="skolem">𝔭</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> spectrum_def<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="skolem">𝔭</span> <span class="main">∈</span> pi.carrier_local_ring_at"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="skolem">𝔭</span> <span class="main">∈</span> pi.carrier_local_ring_at"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_regular <span class="free">s</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹is_regular <span class="free">s'</span> <span class="free">U</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> is_regular_def <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> frac_in_carrier_local in_mono is_locally_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mult_sheaf_spec_def <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span>pi.mult_local_ring_at_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">V</span></span><span class="main">⊆</span><span class="free">U</span><span class="main">.</span> is_zariski_open <span class="bound">V</span> <span class="main">∧</span> <span class="skolem">𝔭</span> <span class="main">∈</span> <span class="bound">V</span> <span class="main">∧</span> is_locally_frac <span class="main">(</span>mult_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="free">s'</span><span class="main">)</span> <span class="bound">V</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V1</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">f1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V1</span> <span class="main">⊆</span><span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">V1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">V1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        q_V1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">𝔮</span><span class="main">.</span> <span class="bound">𝔮</span> <span class="main">∈</span> <span class="skolem">V1</span> <span class="main">⟶</span> <span class="skolem">f1</span> <span class="main">∉</span> <span class="bound">𝔮</span> <span class="main">∧</span> <span class="free">s</span> <span class="bound">𝔮</span> <span class="main">=</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">r1</span> <span class="skolem">f1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_regular <span class="free">s</span> <span class="free">U</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> is_regular_def<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_locally_frac_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V2</span></span> <span class="skolem"><span class="skolem">r2</span></span> <span class="skolem"><span class="skolem">f2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V2</span> <span class="main">⊆</span><span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">V2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">V2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f2</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        q_V2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">𝔮</span><span class="main">.</span> <span class="bound">𝔮</span> <span class="main">∈</span> <span class="skolem">V2</span> <span class="main">⟶</span> <span class="skolem">f2</span> <span class="main">∉</span> <span class="bound">𝔮</span> <span class="main">∧</span> <span class="free">s'</span> <span class="bound">𝔮</span> <span class="main">=</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">r2</span> <span class="skolem">f2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_regular <span class="free">s'</span> <span class="free">U</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> is_regular_def<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_locally_frac_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">V3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V3</span> <span class="main">=</span> <span class="skolem">V1</span> <span class="main">∩</span> <span class="skolem">V2</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r3</span> <span class="main">=</span> <span class="skolem">r1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r2</span>  "</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="main">=</span> <span class="skolem">f1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">f2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V3</span> <span class="main">⊆</span><span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">V3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r3</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> V3_def r3_def f3_def
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V1</span> <span class="main">⊆</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">V1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">V2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f1</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f2</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r1</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r2</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">V3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> topological_space.open_inter <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> V3_def <span class="quoted"><span class="quoted">‹is_zariski_open <span class="skolem">V1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_zariski_open <span class="skolem">V2</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="main">∉</span> <span class="skolem">𝔮</span>"</span></span>
        <span class="quoted"><span class="quoted">"mult_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="free">s'</span> <span class="skolem">𝔮</span> <span class="main">=</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="skolem">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">r3</span> <span class="skolem">f3</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="skolem">V3</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔮</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">interpret</span></span> q<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">∖</span><span class="skolem">𝔮</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V3</span> <span class="main">⊆</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="skolem">V3</span>›</span></span> quotient_ring_def local.comm_ring_axioms
          pr_ideal.submonoid_pr_ideal spectrum_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="main">∉</span> <span class="skolem">𝔮</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="skolem">𝔮</span> <span class="main">=</span> q.frac <span class="skolem">r1</span> <span class="skolem">f1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> q_V1 <span class="quoted"><span class="quoted">‹<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="skolem">V3</span>›</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> V3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f2</span> <span class="main">∉</span> <span class="skolem">𝔮</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="skolem">𝔮</span> <span class="main">=</span> q.frac <span class="skolem">r2</span> <span class="skolem">f2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> q_V2 <span class="quoted"><span class="quoted">‹<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="skolem">V3</span>›</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> V3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"q.mult_rel <span class="main">(</span>q.frac <span class="skolem">r1</span> <span class="skolem">f1</span><span class="main">)</span> <span class="main">(</span>q.frac <span class="skolem">r2</span> <span class="skolem">f2</span><span class="main">)</span> <span class="main">=</span> q.frac <span class="main">(</span><span class="skolem">r1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r2</span> <span class="main">)</span> <span class="main">(</span><span class="skolem">f1</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">f2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> q.mult_rel_frac<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f1</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f1</span> <span class="main">∉</span> <span class="skolem">𝔮</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r1</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r2</span> <span class="main">∈</span> <span class="free">R</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f2</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f2</span> <span class="main">∉</span> <span class="skolem">𝔮</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r2</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"q.mult_rel <span class="main">(</span><span class="free">s</span> <span class="skolem">𝔮</span><span class="main">)</span> <span class="main">(</span><span class="free">s'</span> <span class="skolem">𝔮</span><span class="main">)</span> <span class="main">=</span> q.frac <span class="skolem">r3</span> <span class="skolem">f3</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> r3_def f3_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="skolem">𝔮</span> <span class="main">=</span> q.frac <span class="skolem">r1</span> <span class="skolem">f1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s'</span> <span class="skolem">𝔮</span> <span class="main">=</span> q.frac <span class="skolem">r2</span> <span class="skolem">f2</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="free">s'</span> <span class="skolem">𝔮</span> <span class="main">=</span> q.frac <span class="skolem">r3</span> <span class="skolem">f3</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> mult_sheaf_spec_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V3</span> <span class="main">⊆</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="skolem">V3</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="main">∉</span> <span class="skolem">𝔮</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> V3_def f3_def
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f1</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f1</span> <span class="main">∉</span> <span class="skolem">𝔮</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f2</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f2</span> <span class="main">∉</span> <span class="skolem">𝔮</span>›</span></span> q.sub_composition_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> is_locally_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_regular_def is_locally_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-mult_sheaf_spec_in_sheaf_spec"><span class="command">lemma</span></span> mult_sheaf_spec_in_sheaf_spec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mult_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="free">t</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mult_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="free">t</span> <span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">R</span> <span class="hidden">⇘</span><sub><span class="skolem">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">interpret</span></span> qr<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="skolem">𝔭</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> spectrum_imp_cxt_quotient_ring<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">interpret</span></span> pi<span class="main">:</span>pr_ideal <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="skolem">𝔭</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>spectrum_imp_pr<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"qr.valid_frac <span class="main">(</span><span class="free">s</span> <span class="skolem">𝔭</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"qr.valid_frac <span class="main">(</span><span class="free">t</span> <span class="skolem">𝔭</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sec_has_right_codom<span class="main">[</span><span class="operator">OF</span> _ that<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>pi.carrier_local_ring_at_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> mult_sheaf_spec_def pi.carrier_local_ring_at_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_regular <span class="main">(</span>mult_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="free">t</span><span class="main">)</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">t</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>›</span></span> is_regular_mult_sheaf_spec
    <span class="keyword1"><span class="command">unfolding</span></span> sheaf_spec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mult_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="free">t</span> <span class="main">∈</span> extensional <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mult_sheaf_spec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sheaf_spec_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PiE_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">uminus_sheaf_spec</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">uminus_sheaf_spec</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">𝔭</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">.</span> quotient_ring.uminus_rel <span class="main">(</span><span class="free">R</span> <span class="main">∖</span> <span class="bound">𝔭</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">𝔭</span><span class="main">)</span> "</span></span>

<span class="keyword1" id="Comm_Ring-is_regular_uminus_sheaf_spec"><span class="command">lemma</span></span> is_regular_uminus_sheaf_spec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_regular <span class="free">s</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_regular <span class="main">(</span>uminus_sheaf_spec <span class="free">U</span> <span class="free">s</span><span class="main">)</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uminus_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">R</span> <span class="hidden">⇘</span><sub><span class="skolem">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">interpret</span></span> pi<span class="main">:</span> pr_ideal <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="skolem">𝔭</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> spectrum_def<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">interpret</span></span> qr<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="skolem">𝔭</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quotient_ring_def local.comm_ring_axioms pi.submonoid_pr_ideal<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="skolem">𝔭</span> <span class="main">∈</span> pi.carrier_local_ring_at"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_regular <span class="free">s</span> <span class="free">U</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> is_regular_def <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> frac_in_carrier_local in_mono is_locally_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> uminus_sheaf_spec_def pi.carrier_local_ring_at_def <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">V</span></span><span class="main">⊆</span><span class="free">U</span><span class="main">.</span> is_zariski_open <span class="bound">V</span> <span class="main">∧</span> <span class="skolem">𝔭</span> <span class="main">∈</span> <span class="bound">V</span> <span class="main">∧</span> is_locally_frac <span class="main">(</span>uminus_sheaf_spec <span class="free">U</span> <span class="free">s</span><span class="main">)</span> <span class="bound">V</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V1</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">f1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V1</span> <span class="main">⊆</span><span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">V1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">V1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        q_V1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">𝔮</span><span class="main">.</span> <span class="bound">𝔮</span> <span class="main">∈</span> <span class="skolem">V1</span> <span class="main">⟶</span> <span class="skolem">f1</span> <span class="main">∉</span> <span class="bound">𝔮</span> <span class="main">∧</span> <span class="free">s</span> <span class="bound">𝔮</span> <span class="main">=</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">r1</span> <span class="skolem">f1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_regular <span class="free">s</span> <span class="free">U</span>›</span></span><span class="main">[</span><span class="operator">unfolded</span> is_regular_def<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_locally_frac_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">V3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V3</span> <span class="main">=</span> <span class="skolem">V1</span> "</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r3</span> <span class="main">=</span> additive.inverse <span class="skolem">r1</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="main">=</span> <span class="skolem">f1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V3</span> <span class="main">⊆</span><span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">V3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r3</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> V3_def r3_def f3_def
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V1</span> <span class="main">⊆</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">V1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f1</span> <span class="main">∈</span> <span class="free">R</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">r1</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">V3</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> topological_space.open_inter <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> V3_def <span class="quoted"><span class="quoted">‹is_zariski_open <span class="skolem">V1</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="main">∉</span> <span class="skolem">𝔮</span>"</span></span>
        <span class="quoted"><span class="quoted">"uminus_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="skolem">𝔮</span> <span class="main">=</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="skolem">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">r3</span> <span class="skolem">f3</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="skolem">V3</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔮</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">interpret</span></span> q<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">∖</span><span class="skolem">𝔮</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V3</span> <span class="main">⊆</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="skolem">V3</span>›</span></span> quotient_ring_def local.comm_ring_axioms
          pr_ideal.submonoid_pr_ideal spectrum_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="main">∉</span> <span class="skolem">𝔮</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="skolem">𝔮</span> <span class="main">=</span> q.frac <span class="skolem">r1</span> <span class="skolem">f1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> q_V1 <span class="quoted"><span class="quoted">‹<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="skolem">V3</span>›</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> V3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"q.uminus_rel <span class="main">(</span>q.frac <span class="skolem">r1</span> <span class="skolem">f1</span><span class="main">)</span> <span class="main">=</span> q.frac <span class="main">(</span>additive.inverse <span class="skolem">r1</span><span class="main">)</span> <span class="skolem">f1</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> q.uminus_rel_frac<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f1</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f1</span> <span class="main">∉</span> <span class="skolem">𝔮</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r1</span> <span class="main">∈</span> <span class="free">R</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"q.uminus_rel <span class="main">(</span><span class="free">s</span> <span class="skolem">𝔮</span><span class="main">)</span> <span class="main">=</span> q.frac <span class="skolem">r3</span> <span class="skolem">f3</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> r3_def f3_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="skolem">𝔮</span> <span class="main">=</span> q.frac <span class="skolem">r1</span> <span class="skolem">f1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"uminus_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="skolem">𝔮</span> <span class="main">=</span> q.frac <span class="skolem">r3</span> <span class="skolem">f3</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> uminus_sheaf_spec_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V3</span> <span class="main">⊆</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="skolem">V3</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="main">∉</span> <span class="skolem">𝔮</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> V3_def f3_def
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f1</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f1</span> <span class="main">∉</span> <span class="skolem">𝔮</span>›</span></span> q.sub_composition_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> is_locally_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_regular_def is_locally_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-uminus_sheaf_spec_in_sheaf_spec"><span class="command">lemma</span></span> uminus_sheaf_spec_in_sheaf_spec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"uminus_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uminus_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">R</span> <span class="hidden">⇘</span><sub><span class="skolem">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">interpret</span></span> qr<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="skolem">𝔭</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> spectrum_imp_cxt_quotient_ring<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">interpret</span></span> pi<span class="main">:</span>pr_ideal <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="skolem">𝔭</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>spectrum_imp_pr<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"qr.valid_frac <span class="main">(</span><span class="free">s</span> <span class="skolem">𝔭</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sec_has_right_codom<span class="main">[</span><span class="operator">OF</span> _ that<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>pi.carrier_local_ring_at_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> uminus_sheaf_spec_def pi.carrier_local_ring_at_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_regular <span class="main">(</span>uminus_sheaf_spec <span class="free">U</span> <span class="free">s</span><span class="main">)</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>›</span></span> is_regular_uminus_sheaf_spec
    <span class="keyword1"><span class="command">unfolding</span></span> sheaf_spec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"uminus_sheaf_spec <span class="free">U</span> <span class="free">s</span> <span class="main">∈</span> extensional <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> uminus_sheaf_spec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sheaf_spec_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PiE_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">zero_sheaf_spec</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">zero_sheaf_spec</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">𝔭</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">.</span> quotient_ring.zero_rel <span class="main">(</span><span class="free">R</span> <span class="main">∖</span> <span class="bound">𝔭</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>

<span class="keyword1" id="Comm_Ring-is_regular_zero_sheaf_spec"><span class="command">lemma</span></span> is_regular_zero_sheaf_spec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_regular <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"zero_sheaf_spec <span class="free">U</span> <span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">R</span> <span class="hidden">⇘</span><sub><span class="skolem">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span>
    <span class="keyword1"><span class="command">unfolding</span></span> zero_sheaf_spec_def
    <span class="keyword1"><span class="command">using</span></span> assms comm_ring.frac_in_carrier_local local.comm_ring_axioms pr_ideal.not_1 
          quotient_ring.zero_rel_def spectrum_imp_cxt_quotient_ring spectrum_imp_pr subsetD that 
          zariski_top_space.open_imp_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">V</span></span><span class="main">⊆</span><span class="free">U</span><span class="main">.</span> is_zariski_open <span class="bound">V</span> <span class="main">∧</span> <span class="skolem">𝔭</span> <span class="main">∈</span> <span class="bound">V</span> <span class="main">∧</span> is_locally_frac <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="bound">V</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">V3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V3</span> <span class="main">=</span> <span class="free">U</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r3</span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span> "</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V3</span> <span class="main">⊆</span><span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">V3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r3</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> V3_def r3_def f3_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">V3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> V3_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="main">∉</span> <span class="skolem">𝔮</span>"</span></span>
        <span class="quoted"><span class="quoted">"zero_sheaf_spec <span class="free">U</span> <span class="skolem">𝔮</span> <span class="main">=</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="skolem">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">r3</span> <span class="skolem">f3</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="skolem">V3</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔮</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> V3_def assms f3_def pr_ideal.submonoid_pr_ideal spectrum_def
          submonoid.sub_unit_closed that zariski_open_is_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">interpret</span></span> q<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">∖</span><span class="skolem">𝔮</span>"</span></span> <span class="quoted"><span class="free">R</span></span>
          <span class="keyword1"><span class="command">using</span></span> V3_def assms quotient_ring_def local.comm_ring_axioms
            pr_ideal.submonoid_pr_ideal spectrum_def that zariski_open_is_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> zero_sheaf_spec_def
          <span class="keyword1"><span class="command">using</span></span> V3_def f3_def q.zero_rel_def r3_def that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> is_locally_frac_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_regular_def is_locally_frac_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-zero_sheaf_spec_in_sheaf_spec"><span class="command">lemma</span></span> zero_sheaf_spec_in_sheaf_spec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"zero_sheaf_spec <span class="free">U</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"zero_sheaf_spec <span class="free">U</span> <span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">R</span> <span class="hidden">⇘</span><sub><span class="skolem">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span>"</span></span><span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">interpret</span></span> qr<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="skolem">𝔭</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms comm_ring.zariski_open_is_subset local.comm_ring_axioms
          spectrum_imp_cxt_quotient_ring subsetD that<span class="main">)</span>
    <span class="keyword1"><span class="command">interpret</span></span> pi<span class="main">:</span>pr_ideal <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="skolem">𝔭</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms spectrum_imp_pr subsetD that zariski_open_is_subset<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> zero_sheaf_spec_def pi.carrier_local_ring_at_def
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_regular <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_regular_zero_sheaf_spec assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"zero_sheaf_spec <span class="free">U</span> <span class="main">∈</span> extensional <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_sheaf_spec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sheaf_spec_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PiE_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">one_sheaf_spec</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_sheaf_spec</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">𝔭</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">.</span> quotient_ring.one_rel <span class="main">(</span><span class="free">R</span> <span class="main">∖</span> <span class="bound">𝔭</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>

<span class="keyword1" id="Comm_Ring-is_regular_one_sheaf_spec"><span class="command">lemma</span></span> is_regular_one_sheaf_spec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_regular <span class="main">(</span>one_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_sheaf_spec <span class="free">U</span> <span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">R</span> <span class="hidden">⇘</span><sub><span class="skolem">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span>
    <span class="keyword1"><span class="command">unfolding</span></span> one_sheaf_spec_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms closed_subsets_zero comm_ring.closed_subsets_def
        quotient_ring.carrier_quotient_ring_iff quotient_ring.valid_frac_one
        quotient_ring_def local.comm_ring_axioms mem_Collect_eq
        pr_ideal.carrier_local_ring_at_def pr_ideal.submonoid_pr_ideal
        restrict_apply subsetD that zariski_open_is_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">V</span></span><span class="main">⊆</span><span class="free">U</span><span class="main">.</span> is_zariski_open <span class="bound">V</span> <span class="main">∧</span> <span class="skolem">𝔭</span> <span class="main">∈</span> <span class="bound">V</span> <span class="main">∧</span> is_locally_frac <span class="main">(</span>one_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="bound">V</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">V3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V3</span> <span class="main">=</span> <span class="free">U</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r3</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f3</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="main">=</span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V3</span> <span class="main">⊆</span><span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">V3</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r3</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> V3_def r3_def f3_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">V3</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> V3_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f3</span> <span class="main">∉</span> <span class="skolem">𝔮</span>"</span></span>
        <span class="quoted"><span class="quoted">"one_sheaf_spec <span class="free">U</span> <span class="skolem">𝔮</span> <span class="main">=</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="skolem">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">r3</span> <span class="skolem">f3</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="skolem">V3</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔮</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> V3_def assms f3_def pr_ideal.submonoid_pr_ideal spectrum_def
          submonoid.sub_unit_closed that zariski_open_is_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">interpret</span></span> q<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">∖</span><span class="skolem">𝔮</span>"</span></span> <span class="quoted"><span class="free">R</span></span>
          <span class="keyword1"><span class="command">using</span></span> V3_def assms quotient_ring_def local.comm_ring_axioms
            pr_ideal.submonoid_pr_ideal spectrum_def that zariski_open_is_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> one_sheaf_spec_def
          <span class="keyword1"><span class="command">using</span></span> V3_def f3_def q.one_rel_def r3_def that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> is_locally_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_regular_def is_locally_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-one_sheaf_spec_in_sheaf_spec"><span class="command">lemma</span></span> one_sheaf_spec_in_sheaf_spec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"one_sheaf_spec <span class="free">U</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_sheaf_spec <span class="free">U</span> <span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">R</span> <span class="hidden">⇘</span><sub><span class="skolem">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span>"</span></span><span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">interpret</span></span> qr<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="skolem">𝔭</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms comm_ring.zariski_open_is_subset local.comm_ring_axioms
          spectrum_imp_cxt_quotient_ring subsetD that<span class="main">)</span>
    <span class="keyword1"><span class="command">interpret</span></span> pi<span class="main">:</span>pr_ideal <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="skolem">𝔭</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms spectrum_imp_pr subsetD that zariski_open_is_subset<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> one_sheaf_spec_def pi.carrier_local_ring_at_def
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_regular <span class="main">(</span>one_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_regular_one_sheaf_spec assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_sheaf_spec <span class="free">U</span> <span class="main">∈</span> extensional <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_sheaf_spec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sheaf_spec_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PiE_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-zero_sheaf_spec_extensional"><span class="command">lemma</span></span> zero_sheaf_spec_extensional<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"zero_sheaf_spec <span class="free">U</span> <span class="main">∈</span> extensional <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> zero_sheaf_spec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Comm_Ring-one_sheaf_spec_extensional"><span class="command">lemma</span></span> one_sheaf_spec_extensional<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"one_sheaf_spec <span class="free">U</span> <span class="main">∈</span> extensional <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> one_sheaf_spec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Comm_Ring-add_sheaf_spec_extensional"><span class="command">lemma</span></span> add_sheaf_spec_extensional<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"add_sheaf_spec <span class="free">U</span> <span class="free">a</span> <span class="free">b</span> <span class="main">∈</span> extensional <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> add_sheaf_spec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Comm_Ring-mult_sheaf_spec_extensional"><span class="command">lemma</span></span> mult_sheaf_spec_extensional<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"mult_sheaf_spec <span class="free">U</span> <span class="free">a</span> <span class="free">b</span> <span class="main">∈</span> extensional <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mult_sheaf_spec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Comm_Ring-sheaf_spec_extensional"><span class="command">lemma</span></span> sheaf_spec_extensional<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">∈</span> extensional <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sheaf_spec_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PiE_iff Set_Theory.map_def<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-sheaf_spec_on_open_is_comm_ring"><span class="command">lemma</span></span> sheaf_spec_on_open_is_comm_ring<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"comm_ring <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>mult_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>one_sheaf_spec <span class="free">U</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">show</span></span> add_𝒪<span class="main">:</span><span class="quoted"><span class="quoted">"add_sheaf_spec <span class="free">U</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mult_sheaf_spec <span class="free">U</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_sheaf_spec_in_sheaf_spec assms that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> zariski_open_is_subset<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms mult_sheaf_spec_in_sheaf_spec that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> zariski_open_is_subset<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"zero_sheaf_spec <span class="free">U</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"one_sheaf_spec <span class="free">U</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms zero_sheaf_spec_in_sheaf_spec<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms one_sheaf_spec_in_sheaf_spec<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">have</span></span> imp_qr<span class="main">:</span><span class="quoted"><span class="quoted">"quotient_ring <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="skolem">𝔭</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms comm_ring.spectrum_imp_cxt_quotient_ring in_mono local.comm_ring_axioms
          zariski_open_is_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> qr_valid_frac<span class="main">:</span><span class="quoted"><span class="quoted">"quotient_ring.valid_frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="skolem">𝔭</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main">(</span><span class="skolem">s</span> <span class="skolem">𝔭</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">s</span> <span class="skolem">𝔭</span>
    <span class="keyword1"><span class="command">using</span></span> assms comm_ring.zariski_open_is_subset quotient_ring.carrier_quotient_ring_iff
      imp_qr local.comm_ring_axioms pr_ideal.carrier_local_ring_at_def sec_has_right_codom
      spectrum_imp_pr that<span class="main">(</span>1<span class="main">)</span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword3"><span class="command">show</span></span> add_zero<span class="main">:</span><span class="quoted"><span class="quoted">"add_sheaf_spec <span class="free">U</span> <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_sheaf_spec <span class="free">U</span> <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">𝔭</span> <span class="main">=</span> <span class="skolem">a</span> <span class="skolem">𝔭</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">interpret</span></span> cq<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">∖</span><span class="skolem">𝔭</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> imp_qr that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> add_sheaf_spec_def zero_sheaf_spec_def
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>›</span></span> qr_valid_frac<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_sheaf_spec <span class="free">U</span> <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> extensionalityI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> A<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">U</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> add_assoc<span class="main">:</span><span class="quoted"><span class="quoted">"add_sheaf_spec <span class="free">U</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="skolem">c</span>
      <span class="main">=</span> add_sheaf_spec <span class="free">U</span> <span class="skolem">a</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> extensionalityI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">𝔭</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">interpret</span></span> cq<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">∖</span><span class="skolem">𝔭</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span> imp_qr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_sheaf_spec <span class="free">U</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="skolem">c</span> <span class="skolem">𝔭</span> <span class="main">=</span> add_sheaf_spec <span class="free">U</span> <span class="skolem">a</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">𝔭</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> add_sheaf_spec_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cq.additive.associative qr_valid_frac that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>add_sheaf_spec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> add_comm<span class="main">:</span><span class="quoted"><span class="quoted">"add_sheaf_spec <span class="free">U</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">=</span> add_sheaf_spec <span class="free">U</span> <span class="skolem">y</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> extensionalityI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">𝔭</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">interpret</span></span> cq<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">∖</span><span class="skolem">𝔭</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span> imp_qr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" add_sheaf_spec <span class="free">U</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">𝔭</span> <span class="main">=</span> add_sheaf_spec <span class="free">U</span> <span class="skolem">y</span> <span class="skolem">x</span> <span class="skolem">𝔭</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> add_sheaf_spec_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cq.additive.commutative qr_valid_frac that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> mult_comm<span class="main">:</span><span class="quoted"><span class="quoted">"mult_sheaf_spec <span class="free">U</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">=</span> mult_sheaf_spec <span class="free">U</span> <span class="skolem">y</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> extensionalityI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">𝔭</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">interpret</span></span> cq<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">∖</span><span class="skolem">𝔭</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span> imp_qr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_sheaf_spec <span class="free">U</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">𝔭</span> <span class="main">=</span> mult_sheaf_spec <span class="free">U</span> <span class="skolem">y</span> <span class="skolem">x</span> <span class="skolem">𝔭</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mult_sheaf_spec_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cq.comm_mult qr_valid_frac that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> add_zero<span class="main">:</span><span class="quoted"><span class="quoted">"add_sheaf_spec <span class="free">U</span> <span class="skolem">a</span> <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command">using</span></span> add_zero add_comm that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹zero_sheaf_spec <span class="free">U</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>›</span></span><span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_sheaf_spec <span class="free">U</span> <span class="main">(</span>mult_sheaf_spec <span class="free">U</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">=</span> mult_sheaf_spec <span class="free">U</span> <span class="skolem">a</span> <span class="main">(</span>mult_sheaf_spec <span class="free">U</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> extensionalityI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">𝔭</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">interpret</span></span> cq<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">∖</span><span class="skolem">𝔭</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span> imp_qr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_sheaf_spec <span class="free">U</span> <span class="main">(</span>mult_sheaf_spec <span class="free">U</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="skolem">c</span> <span class="skolem">𝔭</span>
                <span class="main">=</span> mult_sheaf_spec <span class="free">U</span> <span class="skolem">a</span> <span class="main">(</span>mult_sheaf_spec <span class="free">U</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">𝔭</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mult_sheaf_spec_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cq.multiplicative.associative qr_valid_frac that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>add_sheaf_spec_def<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_sheaf_spec <span class="free">U</span> <span class="main">(</span>one_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> extensionalityI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">𝔭</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">interpret</span></span> cq<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">∖</span><span class="skolem">𝔭</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span> imp_qr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_sheaf_spec <span class="free">U</span> <span class="main">(</span>one_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="skolem">a</span> <span class="skolem">𝔭</span> <span class="main">=</span> <span class="skolem">a</span> <span class="skolem">𝔭</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mult_sheaf_spec_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_sheaf_spec_def qr_valid_frac that<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_sheaf_spec <span class="free">U</span> <span class="skolem">a</span> <span class="main">(</span>one_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹one_sheaf_spec <span class="free">U</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>›</span></span> mult_comm that<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_sheaf_spec <span class="free">U</span> <span class="skolem">a</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>
          <span class="main">=</span> add_sheaf_spec <span class="free">U</span> <span class="main">(</span>mult_sheaf_spec <span class="free">U</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>mult_sheaf_spec <span class="free">U</span> <span class="skolem">a</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> extensionalityI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">𝔭</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">interpret</span></span> cq<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">∖</span><span class="skolem">𝔭</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span> imp_qr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_sheaf_spec <span class="free">U</span> <span class="skolem">a</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">𝔭</span> <span class="main">=</span>
         add_sheaf_spec <span class="free">U</span> <span class="main">(</span>mult_sheaf_spec <span class="free">U</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span>mult_sheaf_spec <span class="free">U</span> <span class="skolem">a</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">𝔭</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> mult_sheaf_spec_def add_sheaf_spec_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cq.distributive<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> qr_valid_frac that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_sheaf_spec <span class="free">U</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">a</span>
                <span class="main">=</span> add_sheaf_spec <span class="free">U</span> <span class="main">(</span>mult_sheaf_spec <span class="free">U</span> <span class="skolem">b</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>mult_sheaf_spec <span class="free">U</span> <span class="skolem">c</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_𝒪 mult_comm that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid.invertible <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> monoid.invertibleI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
      <span class="keyword1"><span class="command">using</span></span> add_𝒪 <span class="quoted"><span class="quoted">‹zero_sheaf_spec <span class="free">U</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>›</span></span> add_assoc <span class="quoted"><span class="quoted">‹zero_sheaf_spec <span class="free">U</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>›</span></span>
        add_comm add_zero  add_zero
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_sheaf_spec <span class="free">U</span> <span class="skolem">u</span> <span class="main">(</span>uminus_sheaf_spec <span class="free">U</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> zero_sheaf_spec <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> extensionalityI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">𝔭</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
      <span class="keyword1"><span class="command">interpret</span></span> cq<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">∖</span><span class="skolem">𝔭</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span> imp_qr <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cq.add_rel <span class="main">(</span><span class="skolem">u</span> <span class="skolem">𝔭</span><span class="main">)</span> <span class="main">(</span>cq.uminus_rel <span class="main">(</span><span class="skolem">u</span> <span class="skolem">𝔭</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cq.zero_rel"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span> cq.add_minus_zero_rel qr_valid_frac that<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_sheaf_spec <span class="free">U</span> <span class="skolem">u</span> <span class="main">(</span>uminus_sheaf_spec <span class="free">U</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">𝔭</span> <span class="main">=</span> zero_sheaf_spec <span class="free">U</span> <span class="skolem">𝔭</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> add_sheaf_spec_def uminus_sheaf_spec_def zero_sheaf_spec_def
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_sheaf_spec <span class="free">U</span> <span class="main">(</span>uminus_sheaf_spec <span class="free">U</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">u</span> <span class="main">=</span> zero_sheaf_spec <span class="free">U</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_comm assms comm_ring.zariski_open_is_subset local.comm_ring_axioms
          that uminus_sheaf_spec_in_sheaf_spec<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"uminus_sheaf_spec <span class="free">U</span> <span class="skolem">u</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms comm_ring.zariski_open_is_subset local.comm_ring_axioms
            that uminus_sheaf_spec_in_sheaf_spec<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sheaf_spec_morphisms</span><span class="main">::</span>
<span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set <span class="main">⇒</span> <span class="tfree">'a</span> set set <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">sheaf_spec_morphisms</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">s</span><span class="main">∈</span><span class="main">(</span><span class="keyword1">𝒪</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span><span class="main">.</span> restrict <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span>"</span></span>

<span class="keyword1" id="Comm_Ring-sheaf_morphisms_sheaf_spec"><span class="command">lemma</span></span> sheaf_morphisms_sheaf_spec<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="free">U</span> <span class="free">U</span> <span class="free">s</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms sheaf_spec_def restrict_on_source sheaf_spec_morphisms_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Comm_Ring-sheaf_spec_morphisms_are_maps"><span class="command">lemma</span></span> sheaf_spec_morphisms_are_maps<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="comment1">(*this assumption seems redundant: "is_zariski_open U" and*)</span>
    <span class="quoted"><span class="quoted">"is_zariski_open <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Set_Theory.map <span class="main">(</span>sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">V</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span> <span class="main">∈</span> extensional <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sheaf_spec_morphisms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="main">→</span> <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sheaf_spec_morphisms_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">Π<span class="hidden">⇩</span><sub>E</sub></span> <span class="bound">𝔭</span><span class="main">∈</span><span class="free">U</span><span class="main">.</span> <span class="free">R</span> <span class="hidden">⇘</span><sub><span class="bound">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">𝔭</span><span class="main">.</span> <span class="bound">𝔭</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">V</span><span class="main">.</span> is_zariski_open <span class="bound">V</span> <span class="main">∧</span> <span class="bound">V</span> <span class="main">⊆</span> <span class="free">U</span> <span class="main">∧</span> <span class="bound">𝔭</span> <span class="main">∈</span> <span class="bound">V</span> <span class="main">∧</span> is_locally_frac <span class="skolem">s</span> <span class="bound">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sheaf_spec_def is_regular_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="skolem">s</span> <span class="free">V</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">Π<span class="hidden">⇩</span><sub>E</sub></span> <span class="bound">𝔭</span><span class="main">∈</span><span class="free">V</span><span class="main">.</span> <span class="free">R</span> <span class="hidden">⇘</span><sub><span class="bound">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">Π<span class="hidden">⇩</span><sub>E</sub></span> <span class="bound">𝔭</span><span class="main">∈</span><span class="free">U</span><span class="main">.</span> <span class="free">R</span> <span class="hidden">⇘</span><sub><span class="bound">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">V</span> <span class="main">⊆</span> <span class="free">U</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">Va</span><span class="main">.</span> is_zariski_open <span class="bound">Va</span> <span class="main">∧</span> <span class="bound">Va</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">∧</span> <span class="skolem">𝔭</span> <span class="main">∈</span> <span class="bound">Va</span> <span class="main">∧</span> is_locally_frac <span class="main">(</span>restrict <span class="skolem">s</span> <span class="free">V</span><span class="main">)</span> <span class="bound">Va</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">U1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">U1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U1</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">U1</span>"</span></span> <span class="quoted"><span class="quoted">"is_locally_frac <span class="skolem">s</span> <span class="skolem">U1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> p<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">𝔭</span></span><span class="main">]</span> that <span class="quoted"><span class="quoted">‹<span class="free">V</span> <span class="main">⊆</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="free">V</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">V1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V1</span> <span class="main">=</span> <span class="skolem">U1</span> <span class="main">∩</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">V1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_zariski_open <span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹is_zariski_open <span class="skolem">U1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> V1_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_locally_frac <span class="skolem">s</span> <span class="skolem">V1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> is_locally_frac_subset<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹is_locally_frac <span class="skolem">s</span> <span class="skolem">U1</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> V1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_locally_frac <span class="main">(</span>restrict <span class="skolem">s</span> <span class="free">V</span><span class="main">)</span> <span class="skolem">V1</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> restrict_def V1_def <span class="keyword1"><span class="command">using</span></span> is_locally_frac_cong <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> in_mono inf_le2<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V1</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">V1</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> V1_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">V</span> <span class="main">⊆</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">U1</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"restrict <span class="skolem">s</span> <span class="free">V</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sheaf_spec_def is_regular_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> extensional_funcset_def map.intro<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-sheaf_spec_morphisms_are_ring_morphisms"><span class="command">lemma</span></span> sheaf_spec_morphisms_are_ring_morphisms<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="main">(</span>sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span><span class="main">)</span>
                           <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>mult_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>one_sheaf_spec <span class="free">U</span><span class="main">)</span>
                           <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="free">V</span><span class="main">)</span> <span class="main">(</span>mult_sheaf_spec <span class="free">V</span><span class="main">)</span> <span class="main">(</span>zero_sheaf_spec <span class="free">V</span><span class="main">)</span> <span class="main">(</span>one_sheaf_spec <span class="free">V</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Set_Theory.map <span class="main">(</span>sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms sheaf_spec_morphisms_are_maps<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sheaf_spec_on_open_is_comm_ring <span class="main">[</span><span class="operator">OF</span> U<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> comm_ring_def ring_def abelian_group_def commutative_monoid_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.group_axioms <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sheaf_spec_on_open_is_comm_ring <span class="main">[</span><span class="operator">OF</span> U<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> comm_ring_def ring_def abelian_group_def commutative_monoid_def group_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"commutative_monoid_axioms <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sheaf_spec_on_open_is_comm_ring <span class="main">[</span><span class="operator">OF</span> U<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> comm_ring_def ring_def abelian_group_def commutative_monoid_def group_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span>mult_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>one_sheaf_spec <span class="free">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> U comm_ring_def ring_def sheaf_spec_on_open_is_comm_ring<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring_axioms <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>mult_sheaf_spec <span class="free">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> U comm_ring.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ring_def sheaf_spec_on_open_is_comm_ring<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="free">V</span><span class="main">)</span> <span class="main">(</span>zero_sheaf_spec <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sheaf_spec_on_open_is_comm_ring <span class="main">[</span><span class="operator">OF</span> V<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> comm_ring_def ring_def abelian_group_def commutative_monoid_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.group_axioms <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="free">V</span><span class="main">)</span> <span class="main">(</span>zero_sheaf_spec <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sheaf_spec_on_open_is_comm_ring <span class="main">[</span><span class="operator">OF</span> V<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> comm_ring_def ring_def abelian_group_def commutative_monoid_def group_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"commutative_monoid_axioms <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sheaf_spec_on_open_is_comm_ring <span class="main">[</span><span class="operator">OF</span> V<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> comm_ring_def ring_def abelian_group_def commutative_monoid_def group_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span>mult_sheaf_spec <span class="free">V</span><span class="main">)</span> <span class="main">(</span>one_sheaf_spec <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> V comm_ring.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ring_def sheaf_spec_on_open_is_comm_ring<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring_axioms <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="free">V</span><span class="main">)</span> <span class="main">(</span>mult_sheaf_spec <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> V comm_ring_def ring_def sheaf_spec_on_open_is_comm_ring<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid_homomorphism_axioms <span class="main">(</span>sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span>
              <span class="main">(</span>add_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="free">V</span><span class="main">)</span> <span class="main">(</span>zero_sheaf_spec <span class="free">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> restrict <span class="main">(</span>add_sheaf_spec <span class="free">U</span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> U add_sheaf_spec_in_sheaf_spec comm_ring.zariski_open_is_subset local.comm_ring_axioms sheaf_spec_morphisms_def xy<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> add_sheaf_spec <span class="free">V</span> <span class="main">(</span>restrict <span class="skolem">x</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span>restrict <span class="skolem">y</span> <span class="free">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> add_sheaf_spec_def <span class="quoted"><span class="quoted">‹<span class="free">V</span> <span class="main">⊆</span> <span class="free">U</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> add_sheaf_spec <span class="free">V</span> <span class="main">(</span>sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sheaf_spec_morphisms_def xy<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> add_sheaf_spec <span class="free">V</span> <span class="main">(</span>sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span> <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">=</span> restrict <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> U comm_ring.sheaf_spec_morphisms_def local.comm_ring_axioms zero_sheaf_spec_in_sheaf_spec<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> zero_sheaf_spec <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FuncSet.restrict_restrict assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> inf.absorb_iff2 zero_sheaf_spec_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span> <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">=</span> zero_sheaf_spec <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid_homomorphism_axioms <span class="main">(</span>sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span>
              <span class="main">(</span>mult_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>one_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>mult_sheaf_spec <span class="free">V</span><span class="main">)</span> <span class="main">(</span>one_sheaf_spec <span class="free">V</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span> <span class="main">(</span>mult_sheaf_spec <span class="free">U</span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> restrict <span class="main">(</span>mult_sheaf_spec <span class="free">U</span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> U mult_sheaf_spec_in_sheaf_spec comm_ring.zariski_open_is_subset local.comm_ring_axioms sheaf_spec_morphisms_def xy<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> mult_sheaf_spec <span class="free">V</span> <span class="main">(</span>restrict <span class="skolem">x</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span>restrict <span class="skolem">y</span> <span class="free">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mult_sheaf_spec_def <span class="quoted"><span class="quoted">‹<span class="free">V</span> <span class="main">⊆</span> <span class="free">U</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> mult_sheaf_spec <span class="free">V</span> <span class="main">(</span>sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sheaf_spec_morphisms_def xy<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span> <span class="main">(</span>mult_sheaf_spec <span class="free">U</span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> mult_sheaf_spec <span class="free">V</span> <span class="main">(</span>sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span> <span class="main">(</span>one_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">=</span> restrict <span class="main">(</span>one_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> U comm_ring.sheaf_spec_morphisms_def local.comm_ring_axioms one_sheaf_spec_in_sheaf_spec<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> one_sheaf_spec <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FuncSet.restrict_restrict assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> inf.absorb_iff2 one_sheaf_spec_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span> <span class="main">(</span>one_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">=</span> one_sheaf_spec <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-sheaf_spec_is_presheaf"><span class="command">lemma</span></span> sheaf_spec_is_presheaf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"presheaf_of_rings <span class="keyword1">Spec</span> is_zariski_open sheaf_spec sheaf_spec_morphisms 𝒪b
add_sheaf_spec mult_sheaf_spec zero_sheaf_spec one_sheaf_spec"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sheaf_spec <span class="main">{}</span> <span class="main">=</span> <span class="main">{</span>𝒪b<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>𝒪b<span class="main">}</span> <span class="main">⊆</span> <span class="keyword1">𝒪</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> undefined_is_map_on_empty map_on_empty_is_regular sheaf_spec_def 𝒪_on_emptyset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝒪</span> <span class="main">{}</span> <span class="main">⊆</span> <span class="main">{</span>𝒪b<span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sheaf_spec_def sheaf_spec_of_empty_is_singleton <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> is_zariski_open <span class="bound">U</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">𝒪</span> <span class="bound">U</span><span class="main">)</span> <span class="main">⟹</span> sheaf_spec_morphisms <span class="bound">U</span> <span class="bound">U</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sheaf_spec_morphisms_def sheaf_morphisms_sheaf_spec <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="skolem">U</span> <span class="skolem">W</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span>sheaf_spec_morphisms <span class="skolem">V</span> <span class="skolem">W</span> <span class="main">∘</span> sheaf_spec_morphisms <span class="skolem">U</span> <span class="skolem">V</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">⊆</span> <span class="skolem">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span> <span class="skolem">V</span> <span class="skolem">W</span> <span class="skolem">s</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict <span class="skolem">s</span> <span class="skolem">V</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">V</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> map.map_closed restrict_apply sheaf_spec_morphisms_are_maps sheaf_spec_morphisms_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sheaf_spec_morphisms_def inf_absorb2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"presheaf_of_rings_axioms is_zariski_open sheaf_spec
                    sheaf_spec_morphisms 𝒪b add_sheaf_spec mult_sheaf_spec zero_sheaf_spec one_sheaf_spec"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> presheaf_of_rings_def presheaf_of_rings_axioms_def <span class="keyword1"><span class="command">using</span></span> sheaf_spec_morphisms_are_ring_morphisms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ex. 0.30 *)</span>
<span class="keyword1" id="Comm_Ring-sheaf_spec_is_sheaf"><span class="command">lemma</span></span> sheaf_spec_is_sheaf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"sheaf_of_rings <span class="keyword1">Spec</span> is_zariski_open sheaf_spec sheaf_spec_morphisms 𝒪b
add_sheaf_spec mult_sheaf_spec zero_sheaf_spec one_sheaf_spec"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> sheaf_of_rings.intro sheaf_of_rings_axioms.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"presheaf_of_rings <span class="keyword1">Spec</span> is_zariski_open sheaf_spec sheaf_spec_morphisms 𝒪b
     add_sheaf_spec mult_sheaf_spec zero_sheaf_spec one_sheaf_spec"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sheaf_spec_is_presheaf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="skolem">I</span> <span class="skolem">V</span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"open_cover_of_open_subset <span class="keyword1">Spec</span> is_zariski_open <span class="skolem">U</span> <span class="skolem">I</span> <span class="skolem">V</span>"</span></span>
                        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟹</span> <span class="skolem">V</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
                        <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">U</span>"</span></span>
                        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟹</span> sheaf_spec_morphisms <span class="skolem">U</span> <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> zero_sheaf_spec <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="skolem">𝔭</span> <span class="main">=</span> zero_sheaf_spec <span class="skolem">U</span> <span class="skolem">𝔭</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> that <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">V</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="main">(</span><span class="skolem">V</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> H<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> open_cover_of_subset_def open_cover_of_open_subset_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cover_of_subset.cover_of_select_index cover_of_subset.select_index_belongs open_cover_of_subset_axioms_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="skolem">U</span> <span class="main">(</span><span class="skolem">V</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">s</span> <span class="skolem">𝔭</span> <span class="main">=</span> quotient_ring.zero_rel <span class="main">(</span><span class="free">R</span> <span class="main">∖</span> <span class="skolem">𝔭</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> H<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> F <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_sheaf_spec_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="skolem">𝔭</span> <span class="main">=</span> zero_sheaf_spec <span class="skolem">U</span> <span class="skolem">𝔭</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sheaf_spec_morphisms_def zero_sheaf_spec_def F<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> extensional <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">" zero_sheaf_spec <span class="skolem">U</span> <span class="main">∈</span> extensional <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> zero_sheaf_spec <span class="skolem">U</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> extensionalityI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="skolem">I</span> <span class="skolem">V</span> <span class="skolem">s</span> <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"open_cover_of_open_subset <span class="keyword1">Spec</span> is_zariski_open <span class="skolem">U</span> <span class="skolem">I</span> <span class="skolem">V</span>"</span></span>
                        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟶</span> <span class="skolem">V</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="skolem">U</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="bound">i</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
                        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟹</span>
                                  <span class="bound">j</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟹</span>
                                    sheaf_spec_morphisms <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span>
                                    sheaf_spec_morphisms <span class="main">(</span><span class="skolem">V</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">𝔭</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> <span class="skolem">s</span> <span class="main">(</span>cover_of_subset.select_index <span class="skolem">I</span> <span class="skolem">V</span> <span class="bound">𝔭</span><span class="main">)</span> <span class="bound">𝔭</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> F1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">𝔭</span> <span class="main">=</span> <span class="skolem">s</span> <span class="skolem">j</span> <span class="skolem">𝔭</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">V</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">V</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span> <span class="skolem">i</span> <span class="skolem">j</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">𝔭</span> <span class="main">=</span> sheaf_spec_morphisms <span class="main">(</span><span class="skolem">V</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">V</span> <span class="skolem">i</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">𝔭</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that sheaf_spec_morphisms_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> sheaf_spec_morphisms <span class="main">(</span><span class="skolem">V</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">V</span> <span class="skolem">i</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="skolem">j</span><span class="main">)</span> <span class="skolem">𝔭</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> H<span class="main">(</span>3<span class="main">)</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">s</span> <span class="skolem">j</span> <span class="skolem">𝔭</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sheaf_spec_morphisms_def that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">𝔭</span> <span class="main">=</span> <span class="skolem">s</span> <span class="skolem">j</span> <span class="skolem">𝔭</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">U</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="skolem">𝔭</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span><span class="hidden">⇘</span><sub><span class="skolem">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span><span class="main">∈</span><span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span>
      <span class="keyword1"><span class="command">using</span></span> D H<span class="main">(</span>1<span class="main">)</span> H<span class="main">(</span>2<span class="main">)</span> cover_of_subset.cover_of_select_index
        cover_of_subset.select_index_belongs open_cover_of_open_subset.axioms<span class="main">(</span>1<span class="main">)</span>
        open_cover_of_subset_def sec_has_right_codom that <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> extensional <span class="skolem">U</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_regular <span class="skolem">t</span> <span class="skolem">U</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> is_regular_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> strip conjI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">𝔭</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">V</span><span class="main">.</span> is_zariski_open <span class="bound">V</span> <span class="main">∧</span> <span class="bound">V</span> <span class="main">⊆</span> <span class="skolem">U</span> <span class="main">∧</span> <span class="skolem">𝔭</span> <span class="main">∈</span> <span class="bound">V</span> <span class="main">∧</span> is_locally_frac <span class="skolem">t</span> <span class="bound">V</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> cov_in_I<span class="main">:</span> <span class="quoted"><span class="quoted">"cover_of_subset.select_index <span class="skolem">I</span> <span class="skolem">V</span> <span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> H<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span>›</span></span> cover_of_subset.select_index_belongs open_cover_of_open_subset_def open_cover_of_subset_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">(</span>cover_of_subset.select_index <span class="skolem">I</span> <span class="skolem">V</span> <span class="skolem">𝔭</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> H<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> H<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span>›</span></span> cover_of_subset.select_index_belongs open_cover_of_open_subset_def open_cover_of_subset_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> V2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">V'</span><span class="main">.</span> is_zariski_open <span class="bound">V'</span> <span class="main">∧</span> <span class="bound">V'</span><span class="main">⊆</span> <span class="skolem">V</span> <span class="main">(</span>cover_of_subset.select_index <span class="skolem">I</span> <span class="skolem">V</span> <span class="skolem">𝔭</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">𝔭</span> <span class="main">∈</span> <span class="bound">V'</span> <span class="main">∧</span>
                 is_locally_frac <span class="main">(</span><span class="skolem">s</span> <span class="main">(</span>cover_of_subset.select_index <span class="skolem">I</span> <span class="skolem">V</span> <span class="skolem">𝔭</span><span class="main">)</span><span class="main">)</span> <span class="bound">V'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> H<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">unfolding</span></span> sheaf_spec_def open_cover_of_open_subset_def open_cover_of_subset_def is_regular_def
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span>›</span></span> cov_in_I cover_of_subset.cover_of_select_index <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">V'</span> <span class="bound">𝔮</span><span class="main">.</span> is_zariski_open <span class="bound">V'</span> <span class="main">∧</span> <span class="bound">V'</span> <span class="main">⊆</span> <span class="skolem">V</span> <span class="main">(</span>cover_of_subset.select_index <span class="skolem">I</span> <span class="skolem">V</span> <span class="skolem">𝔭</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">𝔮</span> <span class="main">∈</span> <span class="bound">V'</span> <span class="main">⟹</span> <span class="skolem">t</span> <span class="bound">𝔮</span> <span class="main">=</span> <span class="skolem">s</span> <span class="main">(</span>cover_of_subset.select_index <span class="skolem">I</span> <span class="skolem">V</span> <span class="skolem">𝔭</span><span class="main">)</span> <span class="bound">𝔮</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> D F1 H<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> V <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span>›</span></span> cover_of_subset.cover_of_select_index cover_of_subset.select_index_belongs open_cover_of_open_subset_def open_cover_of_subset_def restrict_apply subsetD<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> V V2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_locally_frac_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> subset_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sheaf_spec_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>PiE_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="skolem">U</span> <span class="main">(</span><span class="skolem">V</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">s</span> <span class="skolem">i</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">𝔭</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="skolem">U</span> <span class="main">(</span><span class="skolem">V</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">𝔭</span> <span class="main">=</span> <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">𝔭</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> that H<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">∧</span> <span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">V</span> <span class="skolem">j</span> <span class="main">∧</span> <span class="skolem">t</span> <span class="skolem">𝔭</span> <span class="main">=</span> <span class="skolem">s</span> <span class="skolem">j</span> <span class="skolem">𝔭</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> D open_cover_of_subset_def open_cover_of_open_subset_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> cover_of_subset.cover_of_select_index cover_of_subset.select_index_belongs restrict_apply'<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="skolem">U</span> <span class="main">(</span><span class="skolem">V</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">𝔭</span> <span class="main">=</span> <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">𝔭</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">I</span>›</span></span> H<span class="main">(</span>2<span class="main">)</span> that
        <span class="keyword1"><span class="command">unfolding</span></span> sheaf_spec_morphisms_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> F1  extensional_arb <span class="main"><span class="main">[</span></span><span class="operator">OF</span> sec_is_extensional<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="skolem">U</span> <span class="main">(</span><span class="skolem">V</span> <span class="skolem">i</span><span class="main">)</span> <span class="skolem">t</span> <span class="skolem">𝔭</span> <span class="main">=</span> <span class="skolem">s</span> <span class="skolem">i</span> <span class="skolem">𝔭</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sheaf_spec_morphisms_def D F1
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> H<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">U</span>›</span></span> comm_ring.sheaf_morphisms_sheaf_spec local.comm_ring_axioms restrict_apply subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">𝒪</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟶</span> sheaf_spec_morphisms <span class="skolem">U</span> <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> <span class="skolem">s</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">U</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-shrinking"><span class="command">lemma</span></span> shrinking<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">V</span> <span class="free">a</span> <span class="free">f</span> <span class="free">b</span> <span class="free">g</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∉</span> <span class="free">𝔭</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∉</span> <span class="free">𝔭</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">𝔮</span><span class="main">.</span> <span class="bound">𝔮</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∉</span> <span class="bound">𝔮</span> <span class="main">∧</span> <span class="free">s</span> <span class="bound">𝔮</span> <span class="main">=</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="free">a</span> <span class="free">f</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">𝔮</span><span class="main">.</span> <span class="bound">𝔮</span> <span class="main">∈</span> <span class="free">V</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">∉</span> <span class="bound">𝔮</span> <span class="main">∧</span> <span class="free">t</span> <span class="bound">𝔮</span> <span class="main">=</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="free">b</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Vs</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">Vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Vs</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="skolem">Vs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">𝔮</span><span class="main">.</span> <span class="bound">𝔮</span> <span class="main">∈</span> <span class="skolem">Vs</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="main">∉</span> <span class="bound">𝔮</span> <span class="main">∧</span> <span class="free">s</span> <span class="bound">𝔮</span> <span class="main">=</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">a</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> sheaf_spec_def is_regular_def is_locally_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Vt</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">Vt</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Vt</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="skolem">Vt</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">𝔮</span><span class="main">.</span> <span class="bound">𝔮</span> <span class="main">∈</span> <span class="skolem">Vt</span> <span class="main">⟹</span> <span class="skolem">g</span> <span class="main">∉</span> <span class="bound">𝔮</span> <span class="main">∧</span> <span class="free">t</span> <span class="bound">𝔮</span> <span class="main">=</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">b</span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> sheaf_spec_def is_regular_def is_locally_frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="main">(</span><span class="skolem">Vs</span> <span class="main">∩</span> <span class="skolem">Vt</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Vs</span> <span class="main">∩</span> <span class="skolem">Vt</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="skolem">Vs</span> <span class="main">∩</span> <span class="skolem">Vt</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">𝔮</span><span class="main">.</span> <span class="bound">𝔮</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">Vs</span> <span class="main">∩</span> <span class="skolem">Vt</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="main">∉</span> <span class="bound">𝔮</span> <span class="main">∧</span> <span class="free">s</span> <span class="bound">𝔮</span> <span class="main">=</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">a</span> <span class="skolem">f</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">𝔮</span><span class="main">.</span> <span class="bound">𝔮</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">Vs</span> <span class="main">∩</span> <span class="skolem">Vt</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">g</span> <span class="main">∉</span> <span class="bound">𝔮</span> <span class="main">∧</span> <span class="free">t</span> <span class="bound">𝔮</span> <span class="main">=</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">b</span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> topological_space.open_inter <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹is_zariski_open <span class="skolem">Vs</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Vs</span> <span class="main">⊆</span> <span class="free">U</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝔭</span> <span class="main">∈</span> <span class="skolem">Vs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝔭</span> <span class="main">∈</span> <span class="skolem">Vt</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">𝔮</span><span class="main">.</span> <span class="bound">𝔮</span> <span class="main">∈</span> <span class="skolem">Vs</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="main">∉</span> <span class="bound">𝔮</span> <span class="main">∧</span> <span class="free">s</span> <span class="bound">𝔮</span> <span class="main">=</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">a</span> <span class="skolem">f</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">𝔮</span><span class="main">.</span> <span class="bound">𝔮</span> <span class="main">∈</span> <span class="skolem">Vt</span> <span class="main">⟹</span> <span class="skolem">g</span> <span class="main">∉</span> <span class="bound">𝔮</span> <span class="main">∧</span> <span class="free">t</span> <span class="bound">𝔮</span> <span class="main">=</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">b</span> <span class="skolem">g</span>›</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* comm_ring *)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Schemes›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Ringed Spaces›</span></span>

<span class="comment1">(* definition 0.32 *)</span>
<span class="keyword1"><span class="command">locale</span></span> ringed_space <span class="main">=</span> sheaf_of_rings

<span class="keyword1"><span class="command">context</span></span> comm_ring
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Comm_Ring-spec_is_ringed_space"><span class="command">lemma</span></span> spec_is_ringed_space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ringed_space <span class="keyword1">Spec</span> is_zariski_open sheaf_spec sheaf_spec_morphisms 𝒪b
add_sheaf_spec mult_sheaf_spec zero_sheaf_spec one_sheaf_spec"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ringed_space.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sheaf_of_rings <span class="keyword1">Spec</span> is_zariski_open sheaf_spec sheaf_spec_morphisms 𝒪b
     add_sheaf_spec mult_sheaf_spec zero_sheaf_spec one_sheaf_spec"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sheaf_spec_is_sheaf <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* comm_ring *)</span>

<span class="comment1">(* definition 0.33 *)</span>
<span class="keyword1"><span class="command">locale</span></span> morphism_ringed_spaces <span class="main">=</span>
im_sheaf <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">ρ<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">mult_str<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">zero_str<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">one_str<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">Y</span></span> <span class="quoted"><span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">f</span></span> <span class="main">+</span>
 codom<span class="main">:</span> ringed_space <span class="quoted"><span class="free">Y</span></span> <span class="quoted"><span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">add_str<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">mult_str<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">zero_str<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">one_str<span class="hidden">⇩</span><sub>Y</sub></span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">X</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">is_open<span class="hidden">⇩</span><sub>X</sub></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ρ<span class="hidden">⇩</span><sub>X</sub></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">b</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">add_str<span class="hidden">⇩</span><sub>X</sub></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">mult_str<span class="hidden">⇩</span><sub>X</sub></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">zero_str<span class="hidden">⇩</span><sub>X</sub></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">one_str<span class="hidden">⇩</span><sub>X</sub></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">Y</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">d</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">add_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">mult_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">zero_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">one_str<span class="hidden">⇩</span><sub>Y</sub></span>
<span class="keyword2"><span class="keyword">and</span></span> <span class="free">f</span> <span class="main">+</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'d</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> is_morphism_of_sheaves<span class="main">:</span> <span class="quoted"><span class="quoted">"morphism_sheaves_of_rings
<span class="free">Y</span> <span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">d</span> <span class="free">add_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">mult_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">zero_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">one_str<span class="hidden">⇩</span><sub>Y</sub></span>
im_sheaf im_sheaf_morphisms <span class="free">b</span> add_im_sheaf mult_im_sheaf zero_im_sheaf one_im_sheaf
<span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Direct Limits of Rings›</span></span>

<span class="comment1">(* construction 0.34 *)</span>
<span class="keyword1"><span class="command">locale</span></span> direct_lim <span class="main">=</span> sheaf_of_rings <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">I</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> subset_of_opens<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">is_open</span> <span class="bound">U</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> has_lower_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">⟦</span> <span class="bound">U</span><span class="main">∈</span><span class="free">I</span><span class="main">;</span> <span class="bound">V</span><span class="main">∈</span><span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">W</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="bound">W</span> <span class="main">⊆</span> <span class="bound">U</span> <span class="main">∩</span> <span class="bound">V</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">get_lower_bound</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">get_lower_bound</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="bound">W</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">∧</span> <span class="bound">W</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Comm_Ring-get_lower_bound"><span class="command">lemma</span></span> get_lower_bound<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"get_lower_bound <span class="free">U</span> <span class="free">V</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"get_lower_bound <span class="free">U</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"get_lower_bound <span class="free">U</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="bound">W</span> <span class="main">⊆</span> <span class="free">U</span> <span class="main">∧</span> <span class="bound">W</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_lower_bound<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> someI_ex<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"get_lower_bound <span class="free">U</span> <span class="free">V</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"get_lower_bound <span class="free">U</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"get_lower_bound <span class="free">U</span> <span class="free">V</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> get_lower_bound_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-obtain_lower_bound_finite"><span class="command">lemma</span></span> obtain_lower_bound_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">Us</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">Us</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Us</span> <span class="main">⊆</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">W</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">U</span><span class="main">∈</span><span class="free">Us</span><span class="main">.</span> <span class="free">W</span> <span class="main">⊆</span> <span class="bound">U</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">Us</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">thesis</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">U</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">=</span><span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> insert.prems<span class="main">(</span>1<span class="main">)</span> insert.prems<span class="main">(</span>3<span class="main">)</span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword2"><span class="keyword">when</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">≠</span><span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">U</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> <span class="skolem">W</span> <span class="main">⊆</span> <span class="bound">U</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert.hyps<span class="main">(</span>3<span class="main">)</span> insert.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W1</span> <span class="main">∈</span><span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W1</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W1</span> <span class="main">⊆</span> <span class="skolem">W</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">W</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> get_lower_bound<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> get_lower_bound<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> get_lower_bound<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span>
          insert.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> insert_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span>insert <span class="skolem">U</span> <span class="skolem">F</span><span class="main">.</span> <span class="skolem">W1</span> <span class="main">⊆</span> <span class="bound">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">U</span><span class="main">∈</span><span class="skolem">F</span><span class="main">.</span> <span class="skolem">W</span> <span class="main">⊆</span> <span class="bound">U</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">W1</span> <span class="main">∈</span><span class="free">I</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> insert<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">principal_subs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> set filter"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">principal_subs</span> <span class="free"><span class="bound"><span class="entity">As</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> Abs_filter <span class="main">(</span><span class="main">λ</span><span class="bound">P</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">As</span></span></span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Comm_Ring-eventually_principal_subs"><span class="command">lemma</span></span> eventually_principal_subs<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="free">P</span> <span class="main">(</span>principal_subs <span class="free">As</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">As</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">⊆</span><span class="free">A</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> principal_subs_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_Abs_filter<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> is_filter.intro<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Comm_Ring-principal_subs_UNIV"><span class="command">lemma</span></span> principal_subs_UNIV<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"principal_subs UNIV UNIV <span class="main">=</span> top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filter_eq_iff eventually_principal_subs<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-principal_subs_empty"><span class="command">lemma</span></span> principal_subs_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"principal_subs <span class="main">{}</span> <span class="free">s</span> <span class="main">=</span> bot"</span></span>
  <span class="comment1">(*"principal_subs ss {} = bot"*)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filter_eq_iff eventually_principal_subs<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-principal_subs_le_iff"><span class="command">lemma</span></span> principal_subs_le_iff<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"principal_subs <span class="free">As</span> <span class="free">A</span> <span class="main">≤</span> principal_subs <span class="free">As'</span> <span class="free">A'</span>
            <span class="main">⟷</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">As</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">As'</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> le_filter_def eventually_principal_subs <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Comm_Ring-principal_subs_eq_iff"><span class="command">lemma</span></span> principal_subs_eq_iff<span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"principal_subs <span class="free">As</span> <span class="free">A</span> <span class="main">=</span> principal_subs <span class="free">As'</span> <span class="free">A'</span> <span class="main">⟷</span><span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">As</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">As'</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">⊆</span> <span class="free">A'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Comm_Ring-principal_subs_inj_on"><span class="command">lemma</span></span> principal_subs_inj_on<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>principal_subs <span class="free">As</span><span class="main">)</span> <span class="free">As</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lbound</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> filter"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lbound</span> <span class="free"><span class="bound"><span class="entity">Us</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">S</span><span class="main">∈</span><span class="main">{</span><span class="bound">S</span><span class="main">.</span> <span class="bound">S</span><span class="main">∈</span><span class="free">I</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">Us</span></span></span><span class="main">.</span> <span class="bound">S</span> <span class="main">⊆</span> <span class="bound">u</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> principal_subs <span class="free">I</span> <span class="bound">S</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Comm_Ring-eventually_lbound_finite"><span class="command">lemma</span></span> eventually_lbound_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span><span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> lbound <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">w</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">w0</span><span class="main">.</span> <span class="bound">w0</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">w0</span> <span class="main">⊆</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">.</span> <span class="main">(</span><span class="bound">w</span><span class="main">⊆</span><span class="bound">w0</span> <span class="main">∧</span> <span class="bound">w</span><span class="main">∈</span><span class="free">I</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">xa</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊆</span> <span class="bound">xa</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_iff assms inf.order_iff obtain_lower_bound_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> Ball <span class="free">A</span> <span class="main">(</span><span class="main">(⊆)</span> <span class="bound">x</span><span class="main">)</span>
              <span class="main">∧</span> <span class="main">{</span><span class="bound"><span class="bound">xa</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="bound">xa</span> <span class="main">⊆</span> <span class="bound">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊆</span> <span class="skolem">a</span><span class="main">}</span>
                <span class="main">∧</span> <span class="main">{</span><span class="bound"><span class="bound">xa</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="bound">xa</span> <span class="main">⊆</span> <span class="bound">x</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> <span class="bound">x</span> <span class="main">⊆</span> <span class="skolem">b</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">⊆</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="skolem">b</span> <span class="main">⊆</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"get_lower_bound <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> get_lower_bound<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> get_lower_bound<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> get_lower_bound<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">S</span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">.</span> Ball <span class="free">A</span> <span class="main">(</span><span class="main">(⊆)</span> <span class="bound">S</span><span class="main">)</span><span class="main">}</span><span class="main">.</span> eventually <span class="free">P</span> <span class="main">(</span>principal_subs <span class="free">I</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">w0</span><span class="main">.</span> <span class="bound">w0</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> Ball <span class="free">A</span> <span class="main">(</span><span class="main">(⊆)</span> <span class="bound">w0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">⊆</span> <span class="bound">w0</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">w</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eventually_principal_subs <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> lbound_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eventually_INF_base<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-lbound_eq"><span class="command">lemma</span></span> lbound_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span><span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">⊆</span><span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lbound <span class="free">A</span> <span class="main">=</span> lbound <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="skolem">P</span> <span class="main">(</span>lbound <span class="skolem">A'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"eventually <span class="skolem">P</span> <span class="main">(</span>lbound <span class="skolem">B'</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> A'<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="skolem">A'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A'</span> <span class="main">⊆</span> <span class="free">I</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> B'<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="skolem">B'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B'</span> <span class="main">⊆</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">P</span> <span class="skolem">A'</span> <span class="skolem">B'</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w0</span></span> <span class="keyword2"><span class="keyword">where</span></span> w0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">w0</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">B'</span><span class="main">.</span> <span class="skolem">w0</span> <span class="main">⊆</span> <span class="bound">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">⊆</span> <span class="skolem">w0</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟶</span> <span class="skolem">P</span> <span class="bound">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹eventually <span class="skolem">P</span> <span class="main">(</span>lbound <span class="skolem">B'</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_lbound_finite<span class="main">[</span><span class="operator">OF</span> B'<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">P</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w1</span></span> <span class="keyword2"><span class="keyword">where</span></span> w1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">U</span><span class="main">∈</span><span class="skolem">A'</span><span class="main">.</span> <span class="skolem">w1</span> <span class="main">⊆</span> <span class="bound">U</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> obtain_lower_bound_finite<span class="main">[</span><span class="operator">OF</span> A'<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">w2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w2</span><span class="main">=</span>get_lower_bound <span class="skolem">w0</span> <span class="skolem">w1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w2</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w0</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w1</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> w2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="skolem">A'</span><span class="main">.</span> <span class="skolem">w2</span> <span class="main">⊆</span> <span class="bound">a</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> w2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.trans get_lower_bound<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> w0<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> w1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> w1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">⊆</span> <span class="skolem">w2</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟶</span> <span class="skolem">P</span> <span class="bound">w</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> w2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.trans get_lower_bound<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> w0<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> w0<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> w1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_lbound_finite<span class="main">[</span><span class="operator">OF</span> A'<span class="main">,</span><span class="operator">of</span> <span class="quoted"><span class="skolem">P</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="skolem">P</span> <span class="main">(</span>lbound <span class="free">A</span><span class="main">)</span> <span class="main">=</span> eventually <span class="skolem">P</span> <span class="main">(</span>lbound <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">P</span>
    <span class="keyword1"><span class="command">using</span></span> A B <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> filter_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-lbound_leq"><span class="command">lemma</span></span> lbound_leq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lbound <span class="free">A</span> <span class="main">≤</span>lbound <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> lbound_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Inf_superset_mono<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> image_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">llbound</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> filter"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">llbound</span> <span class="main">=</span> lbound <span class="main">{</span><span class="keyword1">SOME</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span><span class="free">I</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Comm_Ring-llbound_not_bot"><span class="command">lemma</span></span> llbound_not_bot<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span><span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"llbound <span class="main">≠</span> bot"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> trivial_limit_def llbound_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> eventually_lbound_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> some_in_eq<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-llbound_lbound"><span class="command">lemma</span></span> llbound_lbound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">≠</span><span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">⊆</span><span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lbound <span class="free">A</span> <span class="main">=</span> llbound"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> llbound_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> lbound_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> some_in_eq<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rel</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">∼</span>"</span> 80<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">∼</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> fst <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∧</span> snd <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
<span class="main">(</span><span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="main">(</span><span class="bound">W</span> <span class="main">∈</span> <span class="free">I</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">W</span> <span class="main">⊆</span> fst <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∩</span> fst <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="bound">W</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> <span class="bound">W</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Comm_Ring-rel_is_equivalence"><span class="command">lemma</span></span> rel_is_equivalence<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"equivalence <span class="main">(</span>Sigma <span class="free">I</span> <span class="free">𝔉</span><span class="main">)</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∼</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> equivalence_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI strip<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∼</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∼</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∼</span> <span class="bound">y</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W1</span></span> <span class="keyword2"><span class="keyword">where</span></span> W1<span class="main">:</span><span class="quoted"><span class="quoted">"fst <span class="skolem">a</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">b</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">a</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">b</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="main">(</span>fst <span class="skolem">b</span><span class="main">)</span>"</span></span>
                    <span class="quoted"><span class="quoted">"<span class="skolem">W1</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W1</span> <span class="main">⊆</span> fst <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W1</span> <span class="main">⊆</span> fst <span class="skolem">b</span>"</span></span>
                    <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span> <span class="skolem">W1</span> <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">b</span><span class="main">)</span> <span class="skolem">W1</span> <span class="main">(</span>snd <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∼</span> <span class="bound">y</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W2</span></span> <span class="keyword2"><span class="keyword">where</span></span> W2<span class="main">:</span><span class="quoted"><span class="quoted">"fst <span class="skolem">b</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">c</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">b</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="main">(</span>fst <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="skolem">c</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="main">(</span>fst <span class="skolem">c</span><span class="main">)</span>"</span></span>
                    <span class="quoted"><span class="quoted">"<span class="skolem">W2</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W2</span> <span class="main">⊆</span> fst <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W2</span> <span class="main">⊆</span> fst <span class="skolem">c</span>"</span></span>
                    <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">b</span><span class="main">)</span> <span class="skolem">W2</span> <span class="main">(</span>snd <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">c</span><span class="main">)</span> <span class="skolem">W2</span> <span class="main">(</span>snd <span class="skolem">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">c</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∼</span> <span class="bound">y</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W3</span></span> <span class="keyword2"><span class="keyword">where</span></span> W3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">W3</span> <span class="main">∈</span><span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W3</span> <span class="main">⊆</span> <span class="skolem">W1</span> <span class="main">∩</span> <span class="skolem">W2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> has_lower_bound<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">W1</span><span class="main">∈</span><span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">W2</span><span class="main">∈</span><span class="free">I</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">W3</span> <span class="main">⊆</span> <span class="skolem">W1</span> <span class="main">∩</span> <span class="skolem">W2</span>›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W3</span> <span class="main">⊆</span> fst <span class="skolem">a</span> <span class="main">∩</span> fst <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> W1<span class="main">(</span>6<span class="main">)</span> W2<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span> <span class="skolem">W3</span> <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">c</span><span class="main">)</span> <span class="skolem">W3</span> <span class="main">(</span>snd <span class="skolem">c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> W1 W2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> W3<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> W3<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> eq_ρ le_inf_iff subset_of_opens<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">W3</span> <span class="main">∈</span><span class="free">I</span>›</span></span> W1 W2
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_def Int_commute<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> rel<span class="main">:</span>equivalence <span class="quoted"><span class="quoted">"<span class="main">(</span>Sigma <span class="free">I</span> <span class="free">𝔉</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∼</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rel_is_equivalence <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">class_of</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⌊</span><span class="keyword3">(</span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword3">)</span><span class="keyword1">⌋</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⌊</span></span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main"><span class="free">,</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">⌋</span></span> <span class="main">≡</span> rel.Class <span class="main">(</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Comm_Ring-class_of_eqD"><span class="command">lemma</span></span> class_of_eqD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">U1</span><span class="main">,</span><span class="free">s1</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">⌊</span><span class="free">U2</span><span class="main">,</span><span class="free">s2</span><span class="main">⌋</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U1</span><span class="main">,</span><span class="free">s1</span><span class="main">)</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U2</span><span class="main">,</span><span class="free">s2</span><span class="main">)</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">W</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> <span class="free">U1</span> <span class="main">∩</span> <span class="free">U2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="free">U1</span> <span class="free">W</span> <span class="free">s1</span> <span class="main">=</span> <span class="free">ρ</span> <span class="free">U2</span> <span class="free">W</span> <span class="free">s2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> rel.Class_equivalence<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> class_of_def rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Comm_Ring-class_of_eqI"><span class="command">lemma</span></span> class_of_eqI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U1</span><span class="main">,</span><span class="free">s1</span><span class="main">)</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U2</span><span class="main">,</span><span class="free">s2</span><span class="main">)</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> <span class="free">U1</span> <span class="main">∩</span> <span class="free">U2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="free">U1</span> <span class="free">W</span> <span class="free">s1</span> <span class="main">=</span> <span class="free">ρ</span> <span class="free">U2</span> <span class="free">W</span> <span class="free">s2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">U1</span><span class="main">,</span><span class="free">s1</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">⌊</span><span class="free">U2</span><span class="main">,</span><span class="free">s2</span><span class="main">⌋</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> class_of_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel.Class_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_def<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-class_of_0_in"><span class="command">lemma</span></span> class_of_0_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ring <span class="main">(</span><span class="free">𝔉</span> <span class="free">U</span><span class="main">)</span> +<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span> ⋅<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms subset_of_opens is_ring_from_is_homomorphism <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ring_def abelian_group_def Group_Theory.group_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> monoid.unit_closed<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-rel_Class_iff"><span class="command">lemma</span></span> rel_Class_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∼</span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> rel.Class <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Comm_Ring-class_of_0_eq"><span class="command">lemma</span></span> class_of_0_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">U'</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">⌊</span><span class="free">U'</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U'</span></sub><span class="hidden">⇙</span><span class="main">⌋</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">⊆</span> <span class="free">U'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_subset_iff assms has_lower_bound<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">U'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms subset_of_opens<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="free">U</span> <span class="skolem">W</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">ρ</span> <span class="free">U'</span> <span class="skolem">W</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U'</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> W is_ring_morphism <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">U</span></span> <span class="quoted"><span class="skolem">W</span></span><span class="main">]</span> is_ring_morphism <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">U'</span></span> <span class="quoted"><span class="skolem">W</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_homomorphism_def group_homomorphism_def monoid_homomorphism_def
               monoid_homomorphism_axioms_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> W <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="bound">W</span> <span class="main">⊆</span> <span class="free">U</span> <span class="main">∧</span> <span class="bound">W</span> <span class="main">⊆</span> <span class="free">U'</span> <span class="main">∧</span> <span class="free">ρ</span> <span class="free">U</span> <span class="bound">W</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">ρ</span> <span class="free">U'</span> <span class="bound">W</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="free">U'</span></sub><span class="hidden">⇙</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="free">U'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms class_of_0_in<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∼</span> <span class="main">(</span><span class="free">U'</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U'</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> class_of_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel.Class_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-class_of_1_in"><span class="command">lemma</span></span> class_of_1_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ring <span class="main">(</span><span class="free">𝔉</span> <span class="free">U</span><span class="main">)</span> +<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span> ⋅<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms subset_of_opens is_ring_from_is_homomorphism <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ring_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> monoid.unit_closed<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-class_of_1_eq"><span class="command">lemma</span></span> class_of_1_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">U'</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">⌊</span><span class="free">U'</span><span class="main">,</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">U'</span></sub><span class="hidden">⇙</span><span class="main">⌋</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">⊆</span> <span class="free">U'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_subset_iff assms has_lower_bound<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">U'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms subset_of_opens<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="free">U</span> <span class="skolem">W</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">ρ</span> <span class="free">U'</span> <span class="skolem">W</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">U'</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> W is_ring_morphism <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">U</span></span> <span class="quoted"><span class="skolem">W</span></span><span class="main">]</span> is_ring_morphism <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">U'</span></span> <span class="quoted"><span class="skolem">W</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_homomorphism_def group_homomorphism_def monoid_homomorphism_def
               monoid_homomorphism_axioms_def<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> W <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> <span class="bound">W</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="bound">W</span> <span class="main">⊆</span> <span class="free">U</span> <span class="main">∧</span> <span class="bound">W</span> <span class="main">⊆</span> <span class="free">U'</span> <span class="main">∧</span> <span class="free">ρ</span> <span class="free">U</span> <span class="bound">W</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span> <span class="main">=</span> <span class="free">ρ</span> <span class="free">U'</span> <span class="bound">W</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">U'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="free">U'</span></sub><span class="hidden">⇙</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="free">U'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms class_of_1_in<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U</span><span class="main">,</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∼</span> <span class="main">(</span><span class="free">U'</span><span class="main">,</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">U'</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> class_of_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel.Class_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">add_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">add_rel</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span>
              <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span><span class="main">;</span>
              <span class="bound">y</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span><span class="main">;</span>
              <span class="bound">w</span> <span class="main">=</span> get_lower_bound <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>fst <span class="bound">y</span><span class="main">)</span>
            <span class="keyword1">in</span>
              <span class="main">⌊</span><span class="bound">w</span><span class="main">,</span> <span class="free">add_str</span> <span class="bound">w</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="bound">y</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mult_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mult_rel</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span> <span class="main">≡</span> <span class="keyword1">let</span>
              <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span><span class="main">;</span>
              <span class="bound">y</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">Y</span></span></span><span class="main">)</span><span class="main">;</span>
              <span class="bound">w</span> <span class="main">=</span> get_lower_bound <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>fst <span class="bound">y</span><span class="main">)</span>
            <span class="keyword1">in</span>
              <span class="main">⌊</span><span class="bound">w</span><span class="main">,</span> <span class="free">mult_str</span> <span class="bound">w</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="bound">y</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">carrier_direct_lim</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">carrier_direct_lim</span> <span class="main">≡</span> rel.Partition"</span></span>

<span class="keyword1" id="Comm_Ring-zero_rel_carrier"><span class="command">lemma</span></span> zero_rel_carrier<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="main">∈</span> carrier_direct_lim"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> carrier_direct_lim_def class_of_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rel.Block_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> ring <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝔉</span> <span class="free">U</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms is_ring_from_is_homomorphism subset_of_opens<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-one_rel_carrier"><span class="command">lemma</span></span> one_rel_carrier<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="main">∈</span> carrier_direct_lim"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> carrier_direct_lim_def class_of_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel.Block_closed<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms class_of_1_in<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-rel_carrier_Eps_in"><span class="command">lemma</span></span> rel_carrier_Eps_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≡</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> carrier_direct_lim"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span>Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> <span class="main">⌊</span>fst <span class="free">a</span><span class="main">,</span> snd <span class="free">a</span><span class="main">⌋</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">∈</span>Sigma <span class="free">I</span> <span class="free">𝔉</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">X</span> <span class="main">=</span> rel.Class <span class="bound">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel.representant_exists<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">∈</span> carrier_direct_lim›</span></span><span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> carrier_direct_lim_def<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∈</span>Sigma <span class="free">I</span> <span class="free">𝔉</span> <span class="main">∧</span> <span class="free">X</span> <span class="main">=</span> <span class="main">⌊</span>fst <span class="free">a</span><span class="main">,</span> snd <span class="free">a</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> class_of_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a_def assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> carrier_direct_lim_def ex_in_conv prod.collapse rel.Block_self
        rel.Class_closed some_in_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span>Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> <span class="main">⌊</span>fst <span class="free">a</span><span class="main">,</span> snd <span class="free">a</span><span class="main">⌋</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-add_rel_carrier"><span class="command">lemma</span></span> add_rel_carrier<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> carrier_direct_lim"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">∈</span> carrier_direct_lim"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="free">X</span> <span class="free">Y</span> <span class="main">∈</span> carrier_direct_lim"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">=</span>get_lower_bound <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_carrier_Eps_in<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free"><span class="free">X</span></span></span> <span class="main"><span class="main"><span class="main">∈</span></span></span> carrier_direct_lim›</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_carrier_Eps_in<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free"><span class="free">Y</span></span></span> <span class="main"><span class="main"><span class="main">∈</span></span></span> carrier_direct_lim›</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="free">X</span> <span class="free">Y</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">z</span><span class="main">,</span> <span class="free">add_str</span> <span class="skolem">z</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> add_rel_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> x_def y_def z_def<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">∈</span> carrier_direct_lim"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> carrier_direct_lim_def class_of_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rel.Block_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∈</span><span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span>Sigma <span class="free">I</span> <span class="free">𝔉</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">∈</span>Sigma <span class="free">I</span> <span class="free">𝔉</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> z_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> ring <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝔉</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="skolem">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="skolem">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="skolem">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="skolem">z</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> is_ring_from_is_homomorphism subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span><span class="main">,</span> +<span class="hidden">⇘</span><sub><span class="skolem">z</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span><span class="main">∈</span><span class="free">I</span>›</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>›</span></span> additive.composition_closed
          direct_lim.subset_of_opens direct_lim_axioms get_lower_bound<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> get_lower_bound<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span>
          is_map_from_is_homomorphism map.map_closed mem_Sigma_iff prod.exhaust_sel z_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Comm_Ring-rel_eventually_llbound"><span class="command">lemma</span></span> rel_eventually_llbound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∼</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> llbound<span class="main">.</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> xy<span class="main">:</span><span class="quoted"><span class="quoted">"fst <span class="free">x</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="free">y</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">x</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">y</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∼</span> <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w0</span></span> <span class="keyword2"><span class="keyword">where</span></span> w0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">w0</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w0</span> <span class="main">⊆</span> fst <span class="free">x</span> <span class="main">∩</span> fst <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∼</span> <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">interpret</span></span> xw0<span class="main">:</span>ring_homomorphism <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="skolem">w0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub>fst <span class="free">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub>fst <span class="free">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub>fst <span class="free">x</span></sub><span class="hidden">⇙</span>"</span></span>
        <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub>fst <span class="free">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="skolem">w0</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> is_ring_morphism le_inf_iff subset_of_opens w0 xy<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> yw0<span class="main">:</span>ring_homomorphism <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="skolem">w0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub>fst <span class="free">y</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub>fst <span class="free">y</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub>fst <span class="free">y</span></sub><span class="hidden">⇙</span>"</span></span>
        <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub>fst <span class="free">y</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="skolem">w0</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> w0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_ring_morphism le_inf_iff subset_of_opens  xy<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊆</span> <span class="skolem">w0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">w</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">interpret</span></span> w0w<span class="main">:</span>ring_homomorphism <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="skolem">w0</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="skolem">w0</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="skolem">w</span>"</span></span>
                  <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="skolem">w</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="skolem">w</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="skolem">w</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="skolem">w</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> is_ring_morphism subset_of_opens that w0<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ρ</span> <span class="skolem">w0</span> <span class="skolem">w</span> <span class="main">∘</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="skolem">w0</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assoc_comp le_inf_iff subset_of_opens that w0 xy<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">ρ</span> <span class="skolem">w0</span> <span class="skolem">w</span> <span class="main">∘</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="skolem">w0</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> comp_def
      <span class="keyword1"><span class="command">using</span></span> w0<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> w0 xy <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_subset_iff assoc_comp subset_of_opens that<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">with</span></span> w0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w0</span><span class="main">.</span> <span class="bound">w0</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="bound">w0</span> <span class="main">⊆</span> fst <span class="free">x</span> <span class="main">∩</span> fst <span class="free">y</span>
            <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">.</span> <span class="main">(</span><span class="bound">w</span><span class="main">⊆</span><span class="bound">w0</span> <span class="main">∧</span> <span class="bound">w</span><span class="main">∈</span><span class="free">I</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> lbound <span class="main">{</span>fst <span class="free">x</span><span class="main">,</span>fst <span class="free">y</span><span class="main">}</span><span class="main">.</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> eventually_lbound_finite<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> xy<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> llbound_lbound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>fst <span class="free">x</span><span class="main">,</span>fst <span class="free">y</span><span class="main">}</span>"</span></span><span class="main">]</span> xy<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">z</span> <span class="free">z'</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> xy<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> z<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∈</span><span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊆</span> fst <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊆</span> fst <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> z'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z'</span><span class="main">∈</span><span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z'</span> <span class="main">⊆</span> fst <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z'</span> <span class="main">⊆</span> fst <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> add_rel_well_defined<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">z</span><span class="main">,</span> <span class="free">add_str</span> <span class="free">z</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="free">z</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="free">z</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span> <span class="main">=</span>
          <span class="main">⌊</span><span class="free">z'</span><span class="main">,</span> <span class="free">add_str</span> <span class="free">z'</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="free">z'</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="free">z'</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?add</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> mult_rel_well_defined<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">z</span><span class="main">,</span> <span class="free">mult_str</span> <span class="free">z</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="free">z</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="free">z</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span> <span class="main">=</span>
         <span class="main">⌊</span><span class="free">z'</span><span class="main">,</span> <span class="free">mult_str</span> <span class="free">z'</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="free">z'</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="free">z'</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?mult</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> xz<span class="main">:</span>ring_homomorphism <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="free">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝔉</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub>fst <span class="free">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub>fst <span class="free">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub>fst <span class="free">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub>fst <span class="free">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝔉</span> <span class="free">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="free">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="free">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="free">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="free">z</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_ring_morphism <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>›</span></span> z subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">interpret</span></span> yz<span class="main">:</span>ring_homomorphism <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="free">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝔉</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub>fst <span class="free">y</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub>fst <span class="free">y</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub>fst <span class="free">y</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub>fst <span class="free">y</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝔉</span> <span class="free">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="free">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="free">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="free">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="free">z</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_ring_morphism <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>›</span></span> z subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">interpret</span></span> xz'<span class="main">:</span>ring_homomorphism <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="free">z'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝔉</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub>fst <span class="free">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub>fst <span class="free">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub>fst <span class="free">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub>fst <span class="free">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝔉</span> <span class="free">z'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="free">z'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="free">z'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="free">z'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="free">z'</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_ring_morphism <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>›</span></span> z' subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">interpret</span></span> yz'<span class="main">:</span>ring_homomorphism <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="free">z'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝔉</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub>fst <span class="free">y</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub>fst <span class="free">y</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub>fst <span class="free">y</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub>fst <span class="free">y</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝔉</span> <span class="free">z'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="free">z'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="free">z'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="free">z'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="free">z'</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_ring_morphism <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>›</span></span> z' subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> w<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊆</span> <span class="free">z</span> <span class="main">∩</span> <span class="free">z'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> has_lower_bound <span class="quoted"><span class="quoted">‹<span class="free">z</span><span class="main">∈</span><span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z'</span><span class="main">∈</span><span class="free">I</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>

  <span class="keyword1"><span class="command">interpret</span></span> zw<span class="main">:</span>ring_homomorphism <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="free">z</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝔉</span> <span class="free">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="free">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="free">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="free">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="free">z</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="skolem">w</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="skolem">w</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="skolem">w</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="skolem">w</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> w <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> is_ring_morphism le_inf_iff subset_of_opens z<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> z'w<span class="main">:</span>ring_homomorphism <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="free">z'</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝔉</span> <span class="free">z'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="free">z'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="free">z'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="free">z'</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="free">z'</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="skolem">w</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="skolem">w</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="skolem">w</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="skolem">w</span></sub><span class="hidden">⇙</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">⊆</span> <span class="free">z</span> <span class="main">∩</span> <span class="free">z'</span>›</span></span> z' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> is_ring_morphism le_inf_iff subset_of_opens<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?add</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> class_of_eqI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">⊆</span> <span class="free">z</span> <span class="main">∩</span> <span class="free">z'</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xz</span></span> <span class="skolem"><span class="skolem">yz</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xz</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="free">z</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">yz</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="free">z</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xz'</span></span> <span class="skolem"><span class="skolem">yz'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xz'</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="free">z'</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">yz'</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="free">z'</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span><span class="main">,</span> +<span class="hidden">⇘</span><sub><span class="free">z</span></sub><span class="hidden">⇙</span> <span class="skolem">xz</span> <span class="skolem">yz</span><span class="main">)</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z'</span><span class="main">,</span> +<span class="hidden">⇘</span><sub><span class="free">z'</span></sub><span class="hidden">⇙</span> <span class="skolem">xz'</span> <span class="skolem">yz'</span><span class="main">)</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> xz_def yz_def z<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> xz'_def yz'_def z'<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="free">z</span> <span class="skolem">w</span> <span class="main">(</span>+<span class="hidden">⇘</span><sub><span class="free">z</span></sub><span class="hidden">⇙</span> <span class="skolem">xz</span> <span class="skolem">yz</span><span class="main">)</span> <span class="main">=</span> +<span class="hidden">⇘</span><sub><span class="skolem">w</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">z</span> <span class="skolem">w</span> <span class="skolem">xz</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">z</span> <span class="skolem">w</span> <span class="skolem">yz</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> zw.additive.commutes_with_composition<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> xz_def yz_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> +<span class="hidden">⇘</span><sub><span class="skolem">w</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> xz_def yz_def
      <span class="keyword1"><span class="command">using</span></span> assoc_comp w z subset_of_opens assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SigmaE le_inf_iff o_def prod.sel<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> +<span class="hidden">⇘</span><sub><span class="skolem">w</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">z'</span> <span class="skolem">w</span> <span class="skolem">xz'</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">z'</span> <span class="skolem">w</span> <span class="skolem">yz'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> xz'_def yz'_def
      <span class="keyword1"><span class="command">using</span></span> assoc_comp  w z' subset_of_opens assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SigmaE le_inf_iff o_def prod.sel<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">ρ</span> <span class="free">z'</span> <span class="skolem">w</span> <span class="main">(</span>+<span class="hidden">⇘</span><sub><span class="free">z'</span></sub><span class="hidden">⇙</span> <span class="skolem">xz'</span> <span class="skolem">yz'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> xy<span class="main">(</span>1<span class="main">)</span> xz'_def yz'_def z'w.additive.commutes_with_composition <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="free">z</span> <span class="skolem">w</span> <span class="main">(</span>+<span class="hidden">⇘</span><sub><span class="free">z</span></sub><span class="hidden">⇙</span> <span class="skolem">xz</span> <span class="skolem">yz</span><span class="main">)</span> <span class="main">=</span> <span class="free">ρ</span> <span class="free">z'</span> <span class="skolem">w</span> <span class="main">(</span>+<span class="hidden">⇘</span><sub><span class="free">z'</span></sub><span class="hidden">⇙</span> <span class="skolem">xz'</span> <span class="skolem">yz'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?mult</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> class_of_eqI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">⊆</span> <span class="free">z</span> <span class="main">∩</span> <span class="free">z'</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xz</span></span> <span class="skolem"><span class="skolem">yz</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xz</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="free">z</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">yz</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="free">z</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xz'</span></span> <span class="skolem"><span class="skolem">yz'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xz'</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="free">z'</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">yz'</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="free">z'</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span><span class="main">,</span> ⋅<span class="hidden">⇘</span><sub><span class="free">z</span></sub><span class="hidden">⇙</span> <span class="skolem">xz</span> <span class="skolem">yz</span><span class="main">)</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z'</span><span class="main">,</span> ⋅<span class="hidden">⇘</span><sub><span class="free">z'</span></sub><span class="hidden">⇙</span> <span class="skolem">xz'</span> <span class="skolem">yz'</span><span class="main">)</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> xz_def yz_def xz'_def yz'_def
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="free">z</span> <span class="skolem">w</span> <span class="main">(</span>⋅<span class="hidden">⇘</span><sub><span class="free">z</span></sub><span class="hidden">⇙</span> <span class="skolem">xz</span> <span class="skolem">yz</span><span class="main">)</span> <span class="main">=</span> ⋅<span class="hidden">⇘</span><sub><span class="skolem">w</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">z</span> <span class="skolem">w</span> <span class="skolem">xz</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">z</span> <span class="skolem">w</span> <span class="skolem">yz</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> zw.multiplicative.commutes_with_composition<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> xy xz_def yz_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ⋅<span class="hidden">⇘</span><sub><span class="skolem">w</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> xz_def yz_def
      <span class="keyword1"><span class="command">using</span></span> xy w z assoc_comp
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SigmaE fst_conv le_inf_iff o_def snd_conv subset_of_opens<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ⋅<span class="hidden">⇘</span><sub><span class="skolem">w</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">z'</span> <span class="skolem">w</span> <span class="skolem">xz'</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">z'</span> <span class="skolem">w</span> <span class="skolem">yz'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> xz'_def yz'_def
      <span class="keyword1"><span class="command">using</span></span> xy w z' assoc_comp
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SigmaE fst_conv le_inf_iff o_def snd_conv subset_of_opens<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">ρ</span> <span class="free">z'</span> <span class="skolem">w</span> <span class="main">(</span>⋅<span class="hidden">⇘</span><sub><span class="free">z'</span></sub><span class="hidden">⇙</span> <span class="skolem">xz'</span> <span class="skolem">yz'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> xz'_def yz'_def
      <span class="keyword1"><span class="command">using</span></span> monoid_homomorphism.commutes_with_composition xy z'w.multiplicative.monoid_homomorphism_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="free">z</span> <span class="skolem">w</span> <span class="main">(</span>⋅<span class="hidden">⇘</span><sub><span class="free">z</span></sub><span class="hidden">⇙</span> <span class="skolem">xz</span> <span class="skolem">yz</span><span class="main">)</span> <span class="main">=</span> <span class="free">ρ</span> <span class="free">z'</span> <span class="skolem">w</span> <span class="main">(</span>⋅<span class="hidden">⇘</span><sub><span class="free">z'</span></sub><span class="hidden">⇙</span> <span class="skolem">xz'</span> <span class="skolem">yz'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-add_rel_well_defined_llbound"><span class="command">lemma</span></span> add_rel_well_defined_llbound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">z</span> <span class="free">z'</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> z<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∈</span><span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊆</span> fst <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊆</span> fst <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> llbound<span class="main">.</span> <span class="main">⌊</span><span class="free">z</span><span class="main">,</span> <span class="free">add_str</span> <span class="free">z</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="free">z</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="free">z</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span> <span class="main">=</span>
          <span class="main">⌊</span><span class="bound">w</span><span class="main">,</span> <span class="free">add_str</span> <span class="bound">w</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> <span class="main">_</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">w</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">⊆</span> <span class="free">z</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟶</span><span class="var">?P</span> <span class="bound">w</span> "</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> add_rel_well_defined assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> dual_order.trans z<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> z<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> z<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> lbound <span class="main">{</span>fst <span class="free">x</span><span class="main">,</span>fst <span class="free">y</span><span class="main">}</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">w</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> eventually_lbound_finite<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> llbound_lbound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>fst <span class="free">x</span><span class="main">,</span>fst <span class="free">y</span><span class="main">}</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-mult_rel_well_defined_llbound"><span class="command">lemma</span></span> mult_rel_well_defined_llbound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">z</span> <span class="free">z'</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> z<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">∈</span><span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊆</span> fst <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">⊆</span> fst <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> llbound<span class="main">.</span> <span class="main">⌊</span><span class="free">z</span><span class="main">,</span> <span class="free">mult_str</span> <span class="free">z</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="free">z</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="free">z</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span> <span class="main">=</span>
          <span class="main">⌊</span><span class="bound">w</span><span class="main">,</span> <span class="free">mult_str</span> <span class="bound">w</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="free">y</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> <span class="main">_</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">w</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">⊆</span> <span class="free">z</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟶</span><span class="var">?P</span> <span class="bound">w</span> "</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> mult_rel_well_defined assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> dual_order.trans z<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> z<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> z<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> lbound <span class="main">{</span>fst <span class="free">x</span><span class="main">,</span>fst <span class="free">y</span><span class="main">}</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">w</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> eventually_lbound_finite<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> llbound_lbound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>fst <span class="free">x</span><span class="main">,</span>fst <span class="free">y</span><span class="main">}</span>"</span></span><span class="main">]</span> assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-add_rel_class_of"><span class="command">lemma</span></span> add_rel_class_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">U</span> <span class="free">V</span> <span class="free">W</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> uv_sigma<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> w<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">⌋</span> <span class="main">⌊</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">⌊</span><span class="free">W</span><span class="main">,</span> +<span class="hidden">⇘</span><sub><span class="free">W</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">U</span> <span class="free">W</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">V</span> <span class="free">W</span> <span class="free">y</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ux</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ux</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">ux</span><span class="main">.</span> <span class="bound">ux</span> <span class="main">∈</span> <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vy</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vy</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">ux</span><span class="main">.</span> <span class="bound">ux</span> <span class="main">∈</span> <span class="main">⌊</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ux</span> <span class="main">∈</span> <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">⌋</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vy</span> <span class="main">∈</span> <span class="main">⌊</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">⌋</span> "</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ux_def vy_def <span class="keyword1"><span class="command">using</span></span> uv_sigma class_of_def some_in_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ux</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vy</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> class_of_def uv_sigma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">ux</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">vy</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">w1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="main">=</span> get_lower_bound <span class="main">(</span>fst <span class="skolem">ux</span><span class="main">)</span> <span class="main">(</span>fst <span class="skolem">vy</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> w1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="main">⊆</span> fst <span class="skolem">ux</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="main">⊆</span> fst <span class="skolem">vy</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_lower_bound<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹fst <span class="skolem"><span class="skolem"><span class="skolem">ux</span></span></span> <span class="main"><span class="main"><span class="main">∈</span></span></span> <span class="free"><span class="free"><span class="free">I</span></span></span>›</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹fst <span class="skolem"><span class="skolem"><span class="skolem">vy</span></span></span> <span class="main"><span class="main"><span class="main">∈</span></span></span> <span class="free"><span class="free"><span class="free">I</span></span></span>›</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> w1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">⌋</span> <span class="main">⌊</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">w1</span><span class="main">,</span> +<span class="hidden">⇘</span><sub><span class="skolem">w1</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">ux</span><span class="main">)</span> <span class="skolem">w1</span> <span class="main">(</span>snd <span class="skolem">ux</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">vy</span><span class="main">)</span> <span class="skolem">w1</span> <span class="main">(</span>snd <span class="skolem">vy</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> add_rel_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> ux_def vy_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Let_def w1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> llbound<span class="main">.</span>
            <span class="main">...</span> <span class="main">=</span> <span class="main">⌊</span><span class="bound">w</span><span class="main">,</span> <span class="free">add_str</span> <span class="bound">w</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">ux</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="skolem">ux</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">vy</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="skolem">vy</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> add_rel_well_defined_llbound<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ux</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vy</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>›</span></span> w1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> llbound<span class="main">.</span> add_rel <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">⌋</span> <span class="main">⌊</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">⌋</span>
      <span class="main">=</span> <span class="main">⌊</span><span class="bound">w</span><span class="main">,</span> <span class="free">add_str</span> <span class="bound">w</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">ux</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="skolem">ux</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">vy</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="skolem">vy</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> llbound<span class="main">.</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">ux</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="skolem">ux</span><span class="main">)</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> llbound<span class="main">.</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">vy</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="skolem">vy</span><span class="main">)</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_eventually_llbound<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ux</span> <span class="main">∈</span> <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">⌋</span>›</span></span> class_of_def uv_sigma<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_eventually_llbound<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vy</span> <span class="main">∈</span> <span class="main">⌊</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">⌋</span>›</span></span> class_of_def uv_sigma<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> llbound<span class="main">.</span> add_rel <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">⌋</span> <span class="main">⌊</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">⌋</span>
      <span class="main">=</span> <span class="main">⌊</span><span class="bound">w</span><span class="main">,</span> <span class="free">add_str</span> <span class="bound">w</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">U</span> <span class="bound">w</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">V</span> <span class="bound">w</span> <span class="free">y</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">eventually_elim</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> llbound<span class="main">.</span> <span class="main">⌊</span><span class="free">W</span><span class="main">,</span> +<span class="hidden">⇘</span><sub><span class="free">W</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">U</span> <span class="free">W</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">V</span> <span class="free">W</span> <span class="free">y</span><span class="main">)</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">⌊</span><span class="bound">w</span><span class="main">,</span> +<span class="hidden">⇘</span><sub><span class="bound">w</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">U</span> <span class="bound">w</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">V</span> <span class="bound">w</span> <span class="free">y</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> add_rel_well_defined_llbound<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">U</span></span><span class="main"><span class="main">,</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">V</span></span><span class="main"><span class="main">,</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">W</span></span></span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> w uv_sigma <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> llbound<span class="main">.</span>
      add_rel <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">⌋</span> <span class="main">⌊</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">⌊</span><span class="free">W</span><span class="main">,</span> +<span class="hidden">⇘</span><sub><span class="free">W</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">U</span> <span class="free">W</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">V</span> <span class="free">W</span> <span class="free">y</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">eventually_elim</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"llbound<span class="main">≠</span>bot"</span></span> <span class="keyword1"><span class="command">using</span></span> llbound_not_bot w<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-mult_rel_class_of"><span class="command">lemma</span></span> mult_rel_class_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">U</span> <span class="free">V</span> <span class="free">W</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'b</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> uv_sigma<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> w<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">W</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">⌋</span> <span class="main">⌊</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">⌊</span><span class="free">W</span><span class="main">,</span> ⋅<span class="hidden">⇘</span><sub><span class="free">W</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">U</span> <span class="free">W</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">V</span> <span class="free">W</span> <span class="free">y</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ux</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ux</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">ux</span><span class="main">.</span> <span class="bound">ux</span> <span class="main">∈</span> <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">vy</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vy</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">ux</span><span class="main">.</span> <span class="bound">ux</span> <span class="main">∈</span> <span class="main">⌊</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ux</span> <span class="main">∈</span> <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">⌋</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vy</span> <span class="main">∈</span> <span class="main">⌊</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">⌋</span> "</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ux_def vy_def <span class="keyword1"><span class="command">using</span></span> uv_sigma class_of_def some_in_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ux</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vy</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> class_of_def uv_sigma <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">ux</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">vy</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">w1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="main">=</span> get_lower_bound <span class="main">(</span>fst <span class="skolem">ux</span><span class="main">)</span> <span class="main">(</span>fst <span class="skolem">vy</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> w1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="main">⊆</span> fst <span class="skolem">ux</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="main">⊆</span> fst <span class="skolem">vy</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> get_lower_bound<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹fst <span class="skolem"><span class="skolem"><span class="skolem">ux</span></span></span> <span class="main"><span class="main"><span class="main">∈</span></span></span> <span class="free"><span class="free"><span class="free">I</span></span></span>›</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹fst <span class="skolem"><span class="skolem"><span class="skolem">vy</span></span></span> <span class="main"><span class="main"><span class="main">∈</span></span></span> <span class="free"><span class="free"><span class="free">I</span></span></span>›</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> w1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">⌋</span> <span class="main">⌊</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">w1</span><span class="main">,</span> ⋅<span class="hidden">⇘</span><sub><span class="skolem">w1</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">ux</span><span class="main">)</span> <span class="skolem">w1</span> <span class="main">(</span>snd <span class="skolem">ux</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">vy</span><span class="main">)</span> <span class="skolem">w1</span> <span class="main">(</span>snd <span class="skolem">vy</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mult_rel_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> ux_def vy_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Let_def w1_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> llbound<span class="main">.</span>
            <span class="main">...</span> <span class="main">=</span> <span class="main">⌊</span><span class="bound">w</span><span class="main">,</span> <span class="free">mult_str</span> <span class="bound">w</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">ux</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="skolem">ux</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">vy</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="skolem">vy</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_rel_well_defined_llbound<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ux</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vy</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>›</span></span> w1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> llbound<span class="main">.</span> mult_rel <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">⌋</span> <span class="main">⌊</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">⌋</span>
      <span class="main">=</span> <span class="main">⌊</span><span class="bound">w</span><span class="main">,</span> <span class="free">mult_str</span> <span class="bound">w</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">ux</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="skolem">ux</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">vy</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="skolem">vy</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> llbound<span class="main">.</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">ux</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="skolem">ux</span><span class="main">)</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> llbound<span class="main">.</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">vy</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="skolem">vy</span><span class="main">)</span> <span class="main">=</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="main">(</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="bound">w</span> <span class="main">(</span>snd <span class="main">(</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_eventually_llbound<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ux</span> <span class="main">∈</span> <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">⌋</span>›</span></span> class_of_def uv_sigma<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> rel_eventually_llbound<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">vy</span> <span class="main">∈</span> <span class="main">⌊</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">⌋</span>›</span></span> class_of_def uv_sigma<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> llbound<span class="main">.</span> mult_rel <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">⌋</span> <span class="main">⌊</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">⌋</span>
      <span class="main">=</span> <span class="main">⌊</span><span class="bound">w</span><span class="main">,</span> <span class="free">mult_str</span> <span class="bound">w</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">U</span> <span class="bound">w</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">V</span> <span class="bound">w</span> <span class="free">y</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">eventually_elim</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> llbound<span class="main">.</span> <span class="main">⌊</span><span class="free">W</span><span class="main">,</span> ⋅<span class="hidden">⇘</span><sub><span class="free">W</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">U</span> <span class="free">W</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">V</span> <span class="free">W</span> <span class="free">y</span><span class="main">)</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">⌊</span><span class="bound">w</span><span class="main">,</span> ⋅<span class="hidden">⇘</span><sub><span class="bound">w</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">U</span> <span class="bound">w</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">V</span> <span class="bound">w</span> <span class="free">y</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_rel_well_defined_llbound<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">U</span></span><span class="main"><span class="main">,</span></span><span class="free"><span class="free">x</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">V</span></span><span class="main"><span class="main">,</span></span><span class="free"><span class="free">y</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">W</span></span></span></span><span class="main"><span class="main">,</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> w uv_sigma <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">w</span> <span class="keyword1">in</span> llbound<span class="main">.</span>
      mult_rel <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> <span class="free">x</span><span class="main">⌋</span> <span class="main">⌊</span><span class="free">V</span><span class="main">,</span> <span class="free">y</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">⌊</span><span class="free">W</span><span class="main">,</span> ⋅<span class="hidden">⇘</span><sub><span class="free">W</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">U</span> <span class="free">W</span> <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">V</span> <span class="free">W</span> <span class="free">y</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">eventually_elim</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"llbound<span class="main">≠</span>bot"</span></span> <span class="keyword1"><span class="command">using</span></span> llbound_not_bot w<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-mult_rel_carrier"><span class="command">lemma</span></span> mult_rel_carrier<span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> carrier_direct_lim"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Y</span> <span class="main">∈</span> carrier_direct_lim"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="free">X</span> <span class="free">Y</span> <span class="main">∈</span> carrier_direct_lim"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">Y</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_carrier_Eps_in<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free"><span class="free">X</span></span></span> <span class="main"><span class="main"><span class="main">∈</span></span></span> carrier_direct_lim›</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_carrier_Eps_in<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free"><span class="free">Y</span></span></span> <span class="main"><span class="main"><span class="main">∈</span></span></span> carrier_direct_lim›</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">=</span>get_lower_bound <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊆</span> fst <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊆</span> fst <span class="skolem">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">x</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">y</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊆</span> fst <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊆</span> fst <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> get_lower_bound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"fst <span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"fst <span class="skolem"><span class="skolem"><span class="skolem">y</span></span></span>"</span></span></span></span><span class="main">,</span><span class="operator">folded</span> z_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="free">X</span> <span class="free">Y</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">z</span><span class="main">,</span> <span class="free">mult_str</span> <span class="skolem">z</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> mult_rel_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> x_def y_def z_def<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">∈</span> carrier_direct_lim"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> carrier_direct_lim_def class_of_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> rel.Block_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">interpret</span></span> ring <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝔉</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="skolem">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="skolem">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="skolem">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="skolem">z</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> is_ring_from_is_homomorphism subset_of_opens<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span><span class="main">,</span> ⋅<span class="hidden">⇘</span><sub><span class="skolem">z</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SigmaE SigmaI <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">⊆</span> fst <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">⊆</span> fst <span class="skolem">y</span>›</span></span>
          direct_lim.subset_of_opens direct_lim_axioms fst_conv
          is_map_from_is_homomorphism map.map_closed multiplicative.composition_closed snd_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* exercise 0.35 *)</span>
<span class="keyword1" id="Comm_Ring-direct_lim_is_ring"><span class="command">lemma</span></span> direct_lim_is_ring<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ring carrier_direct_lim add_rel mult_rel <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
  <span class="keyword3"><span class="command">show</span></span> add_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"add_rel <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∈</span> carrier_direct_lim"</span></span> <span class="keyword2"><span class="keyword">and</span></span> mult_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"mult_rel <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∈</span> carrier_direct_lim"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> carrier_direct_lim"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> carrier_direct_lim"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> zero_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="main">∈</span> carrier_direct_lim"</span></span> <span class="keyword2"><span class="keyword">and</span></span> one_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="main">∈</span> carrier_direct_lim"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> add_rel_0<span class="main">:</span> <span class="quoted"><span class="quoted">"add_rel <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="skolem">X</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="skolem">X</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="skolem">X</span> <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> carrier_direct_lim"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">x</span><span class="main">∈</span><span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X_alt<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">X</span><span class="main">=</span> <span class="main">⌊</span>fst <span class="skolem">x</span><span class="main">,</span> snd <span class="skolem">x</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rel_carrier_Eps_in<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem"><span class="skolem">X</span></span></span> <span class="main"><span class="main"><span class="main">∈</span></span></span> carrier_direct_lim›</span></span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w0</span></span> <span class="keyword2"><span class="keyword">where</span></span> w0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">w0</span><span class="main">∈</span><span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w0</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w0</span> <span class="main">⊆</span> fst <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> has_lower_bound<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">U</span><span class="main">∈</span><span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹fst <span class="skolem">x</span><span class="main">∈</span><span class="free">I</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">interpret</span></span> uw0<span class="main">:</span>ring_homomorphism <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="free">U</span> <span class="skolem">w0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="skolem">w0</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span>
                    <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> is_ring_morphism <span class="quoted"><span class="quoted">‹<span class="free">U</span><span class="main">∈</span><span class="free">I</span>›</span></span> w0 subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">interpret</span></span> xw0<span class="main">:</span>ring_homomorphism <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub>fst <span class="skolem">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub>fst <span class="skolem">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub>fst <span class="skolem">x</span></sub><span class="hidden">⇙</span>"</span></span>
                    <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub>fst <span class="skolem">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="skolem">w0</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> is_ring_morphism <span class="quoted"><span class="quoted">‹fst <span class="skolem">x</span><span class="main">∈</span><span class="free">I</span>›</span></span> w0 subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="skolem">X</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">w0</span><span class="main">,</span> +<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">U</span> <span class="skolem">w0</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> X_alt
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> add_rel_class_of<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> w0 x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">w0</span><span class="main">,</span> +<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> 𝟬<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>uw0.additive.commutes_with_unit <span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">w0</span><span class="main">,</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> uw0.target.additive.left_unit<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> carrier_direct_lim_def rel.block_closed that x<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> X_alt
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> class_of_eqI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> W<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">w0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> w0 x subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="skolem">X</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="skolem">X</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">w0</span><span class="main">,</span> ⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">U</span> <span class="skolem">w0</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> X_alt
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mult_rel_class_of<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> w0 x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">w0</span><span class="main">,</span> ⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> 𝟭<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uw0.multiplicative.commutes_with_unit<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">w0</span><span class="main">,</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> uw0.target.multiplicative.left_unit<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> carrier_direct_lim_def rel.block_closed that x<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> X_alt <span class="quoted"><span class="quoted">‹<span class="main">⌊</span><span class="skolem">w0</span><span class="main">,</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">⌋</span> <span class="main">=</span> <span class="skolem">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="skolem">X</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="skolem">X</span> <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">w0</span><span class="main">,</span> ⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="free">U</span> <span class="skolem">w0</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> X_alt
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mult_rel_class_of<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">U</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> w0 x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">w0</span><span class="main">,</span> ⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> 𝟭<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uw0.multiplicative.commutes_with_unit<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">w0</span><span class="main">,</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> uw0.target.multiplicative.right_unit<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> carrier_direct_lim_def rel.block_closed that x<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> X_alt <span class="quoted"><span class="quoted">‹<span class="main">⌊</span><span class="skolem">w0</span><span class="main">,</span> <span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">⌋</span> <span class="main">=</span> <span class="skolem">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="skolem">X</span> <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="main">=</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> add_rel_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"add_rel <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">=</span> add_rel <span class="skolem">Y</span> <span class="skolem">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> carrier_direct_lim"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> carrier_direct_lim"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span> <span class="skolem">Y</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rel_carrier_Eps_in<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem"><span class="skolem">X</span></span></span> <span class="main"><span class="main"><span class="main">∈</span></span></span> carrier_direct_lim›</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rel_carrier_Eps_in<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem"><span class="skolem">Y</span></span></span> <span class="main"><span class="main"><span class="main">∈</span></span></span> carrier_direct_lim›</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">=</span>get_lower_bound <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊆</span> fst <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊆</span> fst <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z_alt<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">=</span>get_lower_bound <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> "</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">x</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">y</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊆</span> fst <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">⊆</span> fst <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> get_lower_bound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"fst <span class="skolem"><span class="skolem"><span class="skolem">x</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"fst <span class="skolem"><span class="skolem"><span class="skolem">y</span></span></span>"</span></span></span></span><span class="main">,</span><span class="operator">folded</span> z_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">=</span>get_lower_bound <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> "</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Eps_cong get_lower_bound_def z_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">interpret</span></span> xz<span class="main">:</span>ring_homomorphism <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝔉</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub>fst <span class="skolem">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub>fst <span class="skolem">x</span></sub><span class="hidden">⇙</span>"</span></span>
                      <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub>fst <span class="skolem">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub>fst <span class="skolem">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝔉</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="skolem">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="skolem">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="skolem">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="skolem">z</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> is_ring_morphism z x subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">interpret</span></span> yz<span class="main">:</span>ring_homomorphism <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝔉</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub>fst <span class="skolem">y</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub>fst <span class="skolem">y</span></sub><span class="hidden">⇙</span>"</span></span>
                      <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub>fst <span class="skolem">y</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub>fst <span class="skolem">y</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">𝔉</span> <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="skolem">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="skolem">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="skolem">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="skolem">z</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> is_ring_morphism z y subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">z</span><span class="main">,</span> <span class="free">add_str</span> <span class="skolem">z</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> add_rel_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fold</span> x_def y_def z_def<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> add_rel <span class="skolem">Y</span> <span class="skolem">X</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> add_rel_def Let_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fold</span> x_def y_def z_alt<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>›</span></span> xz.target.additive.commutative <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">=</span> add_rel <span class="skolem">Y</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> add_assoc<span class="main">:</span><span class="quoted"><span class="quoted">"add_rel <span class="main">(</span>add_rel <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span> <span class="skolem">Z</span> <span class="main">=</span> add_rel <span class="skolem">X</span> <span class="main">(</span>add_rel <span class="skolem">Y</span> <span class="skolem">Z</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"mult_rel <span class="main">(</span>mult_rel <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span> <span class="skolem">Z</span> <span class="main">=</span> mult_rel <span class="skolem">X</span> <span class="main">(</span>mult_rel <span class="skolem">Y</span> <span class="skolem">Z</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"mult_rel <span class="skolem">X</span> <span class="main">(</span>add_rel <span class="skolem">Y</span> <span class="skolem">Z</span><span class="main">)</span> <span class="main">=</span> add_rel <span class="main">(</span>mult_rel <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">(</span>mult_rel <span class="skolem">X</span> <span class="skolem">Z</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"mult_rel <span class="main">(</span>add_rel <span class="skolem">Y</span> <span class="skolem">Z</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">=</span> add_rel <span class="main">(</span>mult_rel <span class="skolem">Y</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">(</span>mult_rel <span class="skolem">Z</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> carrier_direct_lim"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> carrier_direct_lim"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">∈</span> carrier_direct_lim"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">Z</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="skolem">Z</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_alt<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">⌊</span>fst <span class="skolem">x</span><span class="main">,</span>snd <span class="skolem">x</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rel_carrier_Eps_in<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem"><span class="skolem">X</span></span></span> <span class="main"><span class="main"><span class="main">∈</span></span></span> carrier_direct_lim›</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="skolem">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y_alt<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> <span class="main">⌊</span>fst <span class="skolem">y</span><span class="main">,</span>snd <span class="skolem">y</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rel_carrier_Eps_in<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem"><span class="skolem">Y</span></span></span> <span class="main"><span class="main"><span class="main">∈</span></span></span> carrier_direct_lim›</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">z</span><span class="main">∈</span><span class="skolem">Z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z_alt<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">Z</span> <span class="main">=</span> <span class="main">⌊</span>fst <span class="skolem">z</span><span class="main">,</span>snd <span class="skolem">z</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rel_carrier_Eps_in<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem"><span class="skolem">Z</span></span></span> <span class="main"><span class="main"><span class="main">∈</span></span></span> carrier_direct_lim›</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> z_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w0</span></span> <span class="keyword2"><span class="keyword">where</span></span> w0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">w0</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w0</span> <span class="main">⊆</span> fst <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w0</span> <span class="main">⊆</span> fst <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w0</span> <span class="main">⊆</span> fst <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> obtain_lower_bound_finite<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>fst <span class="skolem">x</span><span class="main">,</span>fst <span class="skolem">y</span><span class="main">,</span>fst <span class="skolem">z</span><span class="main">}</span>"</span></span><span class="main">]</span> x y z
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">interpret</span></span> xw0<span class="main">:</span>ring_homomorphism <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub>fst <span class="skolem">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub>fst <span class="skolem">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub>fst <span class="skolem">x</span></sub><span class="hidden">⇙</span>"</span></span>
                    <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub>fst <span class="skolem">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="skolem">w0</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> is_ring_morphism x w0 subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">interpret</span></span> yw0<span class="main">:</span>ring_homomorphism <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">w0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub>fst <span class="skolem">y</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub>fst <span class="skolem">y</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub>fst <span class="skolem">y</span></sub><span class="hidden">⇙</span>"</span></span>
                    <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub>fst <span class="skolem">y</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="skolem">w0</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> is_ring_morphism y w0 subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">interpret</span></span> zw0<span class="main">:</span>ring_homomorphism <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">z</span><span class="main">)</span> <span class="skolem">w0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="main">(</span>fst <span class="skolem">z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub>fst <span class="skolem">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub>fst <span class="skolem">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub>fst <span class="skolem">z</span></sub><span class="hidden">⇙</span>"</span></span>
                    <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub>fst <span class="skolem">z</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="skolem">w0</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> is_ring_morphism z w0 subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="main">(</span>add_rel <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span> <span class="skolem">Z</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">w0</span><span class="main">,</span> +<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">(</span>+<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>
                                <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">z</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> x_alt y_alt z_alt
      <span class="keyword1"><span class="command">using</span></span> x y z w0 subset_of_opens add_rel_class_of
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_rel_class_of<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">w0</span><span class="main">,</span> +<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>
                              <span class="main">(</span>+<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">z</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x<span class="main">(</span>2<span class="main">)</span> xw0.target.additive.associative y<span class="main">(</span>2<span class="main">)</span> z<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  add_rel <span class="skolem">X</span> <span class="main">(</span>add_rel <span class="skolem">Y</span> <span class="skolem">Z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> x_alt y_alt z_alt
      <span class="keyword1"><span class="command">using</span></span> x y z w0 add_rel_class_of subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="main">(</span>add_rel <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span> <span class="skolem">Z</span> <span class="main">=</span> add_rel <span class="skolem">X</span> <span class="main">(</span>add_rel <span class="skolem">Y</span> <span class="skolem">Z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="main">(</span>mult_rel <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span> <span class="skolem">Z</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">w0</span><span class="main">,</span> ⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="main">(</span>⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>
                                <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">z</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> x_alt y_alt z_alt
      <span class="keyword1"><span class="command">using</span></span> x y z w0 mult_rel_class_of subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">w0</span><span class="main">,</span> ⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>
                              <span class="main">(</span>⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">z</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> xw0.target.multiplicative.associative<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> w0 x y z <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  mult_rel <span class="skolem">X</span> <span class="main">(</span>mult_rel <span class="skolem">Y</span> <span class="skolem">Z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> x_alt y_alt z_alt
      <span class="keyword1"><span class="command">using</span></span> x y z w0 mult_rel_class_of subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="main">(</span>mult_rel <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span> <span class="skolem">Z</span> <span class="main">=</span> mult_rel <span class="skolem">X</span> <span class="main">(</span>mult_rel <span class="skolem">Y</span> <span class="skolem">Z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="skolem">X</span> <span class="main">(</span>add_rel <span class="skolem">Y</span> <span class="skolem">Z</span><span class="main">)</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">w0</span><span class="main">,</span> ⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>
                  <span class="main">(</span>+<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">z</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> x_alt y_alt z_alt
      <span class="keyword1"><span class="command">using</span></span> x y z w0 add_rel_class_of mult_rel_class_of subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">w0</span><span class="main">,</span> +<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span>⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">z</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> xw0.target.distributive<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> w0 x y z <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> add_rel <span class="main">(</span>mult_rel <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">(</span>mult_rel <span class="skolem">X</span> <span class="skolem">Z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> x_alt y_alt z_alt
      <span class="keyword1"><span class="command">using</span></span> x y z w0 add_rel_class_of mult_rel_class_of subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="skolem">X</span> <span class="main">(</span>add_rel <span class="skolem">Y</span> <span class="skolem">Z</span><span class="main">)</span> <span class="main">=</span> add_rel <span class="main">(</span>mult_rel <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">(</span>mult_rel <span class="skolem">X</span> <span class="skolem">Z</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="main">(</span>add_rel <span class="skolem">Y</span> <span class="skolem">Z</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">w0</span><span class="main">,</span> ⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span>+<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>
                                          <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">z</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> x_alt y_alt z_alt
      <span class="keyword1"><span class="command">using</span></span> x y z w0 add_rel_class_of mult_rel_class_of subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">⌊</span><span class="skolem">w0</span><span class="main">,</span> +<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span>⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">z</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">z</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> xw0.target.distributive<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> w0 x y z <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> add_rel <span class="main">(</span>mult_rel <span class="skolem">Y</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">(</span>mult_rel <span class="skolem">Z</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> x_alt y_alt z_alt
      <span class="keyword1"><span class="command">using</span></span> x y z w0 add_rel_class_of mult_rel_class_of subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_rel <span class="main">(</span>add_rel <span class="skolem">Y</span> <span class="skolem">Z</span><span class="main">)</span> <span class="skolem">X</span> <span class="main">=</span> add_rel <span class="main">(</span>mult_rel <span class="skolem">Y</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">(</span>mult_rel <span class="skolem">Z</span> <span class="skolem">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> add_rel_0'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> carrier_direct_lim <span class="main">⟹</span> add_rel <span class="bound">a</span> <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="main">=</span> <span class="bound">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_rel_0 add_rel_commute zero_rel <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">interpret</span></span> Group_Theory.monoid <span class="quoted">carrier_direct_lim</span> <span class="quoted">add_rel</span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_rel add_rel_carrier add_assoc add_rel_0 add_rel_0'<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid.invertible carrier_direct_lim add_rel <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="skolem">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> carrier_direct_lim"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">x</span><span class="main">∈</span><span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> X_alt<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">X</span><span class="main">=</span> <span class="main">⌊</span>fst <span class="skolem">x</span><span class="main">,</span> snd <span class="skolem">x</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rel_carrier_Eps_in<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem"><span class="skolem">X</span></span></span> <span class="main"><span class="main"><span class="main">∈</span></span></span> carrier_direct_lim›</span></span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w0</span></span> <span class="keyword2"><span class="keyword">where</span></span> w0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w0</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w0</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w0</span> <span class="main">⊆</span> fst <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> has_lower_bound<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">U</span><span class="main">∈</span><span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹fst <span class="skolem">x</span><span class="main">∈</span><span class="free">I</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">interpret</span></span> uw0<span class="main">:</span>ring_homomorphism <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="free">U</span> <span class="skolem">w0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="skolem">w0</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span>
                    <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> is_ring_morphism <span class="quoted"><span class="quoted">‹<span class="free">U</span><span class="main">∈</span><span class="free">I</span>›</span></span> w0 subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">interpret</span></span> xw0<span class="main">:</span>ring_homomorphism <span class="quoted"><span class="quoted">"<span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub>fst <span class="skolem">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub>fst <span class="skolem">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub>fst <span class="skolem">x</span></sub><span class="hidden">⇙</span>"</span></span>
                    <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub>fst <span class="skolem">x</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="skolem">w0</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> is_ring_morphism <span class="quoted"><span class="quoted">‹fst <span class="skolem">x</span><span class="main">∈</span><span class="free">I</span>›</span></span> w0 subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span><span class="main">=</span><span class="main">⌊</span>fst <span class="skolem">x</span><span class="main">,</span> xw0.source.additive.inverse <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">⌋</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="skolem">X</span> <span class="skolem">Y</span>  <span class="main">=</span> <span class="main">⌊</span><span class="skolem">w0</span><span class="main">,</span> +<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>
                                  <span class="main">(</span><span class="free">ρ</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w0</span> <span class="main">(</span>xw0.source.additive.inverse <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> X_alt Y_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> add_rel_class_of<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="skolem">x</span><span class="main">,</span> xw0.source.additive.inverse <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x<span class="main">(</span>2<span class="main">)</span> xw0.source.additive.invertible xw0.source.additive.invertible_inverse_closed
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> x w0 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">⌊</span><span class="skolem">w0</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="skolem">w0</span></sub><span class="hidden">⇙</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> xw0.additive.invertible_image_lemma<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> x<span class="main">(</span>2<span class="main">)</span> xw0.source.additive.invertible <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">using</span></span> x<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms class_of_0_eq w0<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> carrier_direct_lim"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Group_Theory.group_def Y_def carrier_direct_lim_def class_of_def
        monoid.invertible_inverse_closed x<span class="main">(</span>2<span class="main">)</span> xw0.source.additive.group_axioms
        xw0.source.additive.invertible <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_rel <span class="skolem">Y</span> <span class="skolem">X</span> <span class="main">=</span> <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Y</span> <span class="main">∈</span> carrier_direct_lim›</span></span> <span class="quoted"><span class="quoted">‹add_rel <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">U</span></sub><span class="hidden">⇙</span><span class="main">⌋</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_rel_commute that<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> invertible_def<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(* The canonical function from 𝔉 U into lim 𝔉 for U ∈ I:*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">canonical_fun</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">canonical_fun</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">⌊</span><span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⌋</span>"</span></span>


<span class="keyword1" id="Comm_Ring-rel_I1"><span class="command">lemma</span></span> rel_I1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> <span class="free">s</span><span class="main">⌋</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">∼</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> Us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">U</span><span class="main">,</span> <span class="free">s</span><span class="main">⌋</span> <span class="main">∈</span> carrier_direct_lim"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> carrier_direct_lim_def class_of_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equivalence.Class_in_Partition rel_is_equivalence<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_Class_iff assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> carrier_direct_lim_def class_of_def mem_Sigma_iff rel.Block_self rel.Class_self rel.block_closed<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-rel_I2"><span class="command">lemma</span></span> rel_I2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> <span class="free">s</span><span class="main">⌋</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">∼</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">⌊</span><span class="free">U</span><span class="main">,</span> <span class="free">s</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> carrier_direct_lim_def class_of_def rel_carrier_Eps_in<span class="main">(</span>2<span class="main">)</span> rel_carrier_Eps_in<span class="main">(</span>3<span class="main">)</span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Comm_Ring-carrier_direct_limE"><span class="command">lemma</span></span> carrier_direct_limE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∈</span> carrier_direct_lim"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">U</span> <span class="free">s</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> <span class="main">⌊</span><span class="free">U</span><span class="main">,</span><span class="free">s</span><span class="main">⌋</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms carrier_direct_lim_def class_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>



<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* direct_lim *)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">dlim</span> <span class="main">≡</span> direct_lim.carrier_direct_lim"</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Universal property of direct limits›</span></span>

<span class="keyword1"><span class="command">proposition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> direct_lim<span class="main">)</span> universal_property<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ψ</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">add</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'c</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">mult</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'c</span> <span class="main">⇒</span> <span class="tfree">'c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">zero</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">one</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ring <span class="free">A</span> <span class="free">add</span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">one</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> r_hom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> ring_homomorphism <span class="main">(</span><span class="free">ψ</span> <span class="bound">U</span><span class="main">)</span> <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>+<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span>⋅<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span><span class="main">)</span> 𝟬<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span> 𝟭<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span> <span class="free">A</span> <span class="free">add</span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">one</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span> <span class="bound">V</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">U</span> <span class="main">∈</span> <span class="free">I</span><span class="main">;</span> <span class="bound">V</span> <span class="main">∈</span> <span class="free">I</span><span class="main">;</span> <span class="bound">V</span> <span class="main">⊆</span> <span class="bound">U</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">ψ</span> <span class="bound">V</span> <span class="main">∘</span> <span class="free">ρ</span> <span class="bound">U</span> <span class="bound">V</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">ψ</span> <span class="bound">U</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">V</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">∃!</span><span class="bound">u</span><span class="main">.</span> ring_homomorphism <span class="bound">u</span> carrier_direct_lim add_rel mult_rel <span class="main">⌊</span><span class="bound">V</span><span class="main">,</span>𝟬<span class="hidden">⇘</span><sub><span class="bound">V</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="main">⌊</span><span class="bound">V</span><span class="main">,</span>𝟭<span class="hidden">⇘</span><sub><span class="bound">V</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="free">A</span> <span class="free">add</span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">one</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">U</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span> <span class="main">∘</span> canonical_fun <span class="bound">U</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">ψ</span> <span class="bound">U</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> ring_V<span class="main">:</span> ring <span class="quoted">carrier_direct_lim</span> <span class="quoted">add_rel</span> <span class="quoted">mult_rel</span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="skolem">V</span></sub><span class="hidden">⇙</span><span class="main">⌋</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span> 𝟭<span class="hidden">⇘</span><sub><span class="skolem">V</span></sub><span class="hidden">⇙</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> direct_lim_is_ring <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpret</span></span> ring_ψV<span class="main">:</span> ring_homomorphism <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="skolem">V</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="skolem">V</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="skolem">V</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="skolem">V</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">add</span></span> <span class="quoted"><span class="free">mult</span></span> <span class="quoted"><span class="free">zero</span></span> <span class="quoted"><span class="free">one</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> r_hom <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">X</span> <span class="main">∈</span> carrier_direct_lim<span class="main">.</span> <span class="keyword1">let</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">)</span> <span class="keyword1">in</span> <span class="free">ψ</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="comment1">―‹The proposition below proves that <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">u</span></span><span class="antiquote">}</span></span> is well defined.›</span>
  <span class="keyword1"><span class="command">have</span></span> ψ_eqI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="main">=</span> <span class="free">ψ</span> <span class="skolem">y1</span> <span class="skolem">y2</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">∼</span> <span class="main">(</span><span class="skolem">y1</span><span class="main">,</span><span class="skolem">y2</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">y1</span> <span class="skolem">y2</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Int_subset_iff assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> comp_apply fst_conv rel_def snd_conv that<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> u_eval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">⌊</span><span class="skolem">U</span><span class="main">,</span><span class="skolem">s</span><span class="main">⌋</span> <span class="main">=</span> <span class="free">ψ</span> <span class="skolem">U</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span> <span class="skolem">s</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> Us<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="skolem">U</span><span class="main">,</span> <span class="skolem">s</span><span class="main">⌋</span> <span class="main">∈</span> carrier_direct_lim"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> carrier_direct_lim_def class_of_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equivalence.Class_in_Partition rel_is_equivalence<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u_def Let_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ψ_eqI prod.exhaust_sel rel_I2 rel_carrier_Eps_in<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> u_PiE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> carrier_direct_lim <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> carrier_direct_lim"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="skolem">X</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> carrier_direct_limE map.map_closed r_hom ring_homomorphism_def u_eval<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> u_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> hom_u<span class="main">:</span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="skolem">u</span> carrier_direct_lim add_rel mult_rel <span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="skolem">V</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span> 𝟭<span class="hidden">⇘</span><sub><span class="skolem">V</span></sub><span class="hidden">⇙</span><span class="main">⌋</span>
                                     <span class="free">A</span> <span class="free">add</span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">one</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">(</span>add_rel <span class="main">⌊</span><span class="skolem">U</span><span class="main">,</span><span class="skolem">s</span><span class="main">⌋</span> <span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">t</span><span class="main">⌋</span><span class="main">)</span> <span class="main">=</span> <span class="free">add</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌊</span><span class="skolem">U</span><span class="main">,</span><span class="skolem">s</span><span class="main">⌋</span><span class="main">)</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">t</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="skolem">V</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span> <span class="skolem">V</span> <span class="skolem">s</span> <span class="skolem">t</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Wsub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">⊆</span> <span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms has_lower_bound <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V</span> <span class="main">∈</span> <span class="free">I</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">interpret</span></span> ring_ψW<span class="main">:</span> ring_homomorphism <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="skolem">W</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="skolem">W</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="skolem">W</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="skolem">W</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">add</span></span> <span class="quoted"><span class="free">mult</span></span> <span class="quoted"><span class="free">zero</span></span> <span class="quoted"><span class="free">one</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">W</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> r_hom <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">(</span>add_rel <span class="main">⌊</span><span class="skolem">U</span><span class="main">,</span><span class="skolem">s</span><span class="main">⌋</span> <span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">t</span><span class="main">⌋</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">(</span><span class="main">⌊</span><span class="skolem">W</span><span class="main">,</span> +<span class="hidden">⇘</span><sub><span class="skolem">W</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="skolem">U</span> <span class="skolem">W</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="skolem">V</span> <span class="skolem">W</span> <span class="skolem">t</span><span class="main">)</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Wsub <span class="quoted"><span class="quoted">‹<span class="skolem">W</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> add_rel_class_of that <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">ψ</span> <span class="skolem">W</span> <span class="main">(</span>+<span class="hidden">⇘</span><sub><span class="skolem">W</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="skolem">U</span> <span class="skolem">W</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="skolem">V</span> <span class="skolem">W</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Wsub <span class="quoted"><span class="quoted">‹<span class="skolem">W</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> direct_lim.subset_of_opens direct_lim_axioms is_map_from_is_homomorphism le_infE map.map_closed ring_ψW.source.additive.composition_closed that u_eval<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">add</span> <span class="main">(</span><span class="free">ψ</span> <span class="skolem">W</span> <span class="main">(</span><span class="main">(</span><span class="free">ρ</span> <span class="skolem">U</span> <span class="skolem">W</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ψ</span> <span class="skolem">W</span> <span class="main">(</span><span class="main">(</span><span class="free">ρ</span> <span class="skolem">V</span> <span class="skolem">W</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">W</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">W</span> <span class="main">⊆</span> <span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span>›</span></span> inf.bounded_iff is_ring_morphism map.map_closed ring_ψW.additive.commutes_with_composition ring_homomorphism_def subset_of_opens<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">add</span> <span class="main">(</span><span class="free">ψ</span> <span class="skolem">U</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="free">ψ</span> <span class="skolem">V</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">W</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">W</span> <span class="main">⊆</span> <span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span>›</span></span> eq that <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">add</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌊</span><span class="skolem">U</span><span class="main">,</span><span class="skolem">s</span><span class="main">⌋</span><span class="main">)</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">t</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> that u_eval<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">(</span>add_rel <span class="main">⌊</span><span class="skolem">U</span><span class="main">,</span><span class="skolem">s</span><span class="main">⌋</span> <span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">t</span><span class="main">⌋</span><span class="main">)</span> <span class="main">=</span> <span class="free">add</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌊</span><span class="skolem">U</span><span class="main">,</span><span class="skolem">s</span><span class="main">⌋</span><span class="main">)</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">t</span><span class="main">⌋</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">(</span>add_rel <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">=</span> <span class="free">add</span> <span class="main">(</span><span class="skolem">u</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">(</span><span class="skolem">u</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> carrier_direct_lim"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> carrier_direct_lim"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span> <span class="skolem">Y</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> carrier_direct_limE that<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="skolem">V</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="main">=</span> <span class="free">zero</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> ring_ψV.additive.commutes_with_unit ring_ψV.source.additive.unit_closed
        u_eval <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">(</span>mult_rel <span class="main">⌊</span><span class="skolem">U</span><span class="main">,</span><span class="skolem">s</span><span class="main">⌋</span> <span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">t</span><span class="main">⌋</span><span class="main">)</span> <span class="main">=</span> <span class="free">mult</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌊</span><span class="skolem">U</span><span class="main">,</span><span class="skolem">s</span><span class="main">⌋</span><span class="main">)</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">t</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="skolem">V</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span> <span class="skolem">V</span> <span class="skolem">s</span> <span class="skolem">t</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Wsub<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">⊆</span> <span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> has_lower_bound<span class="main">)</span>
      <span class="keyword1"><span class="command">interpret</span></span> ring_ψW<span class="main">:</span> ring_homomorphism <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉</span> <span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"+<span class="hidden">⇘</span><sub><span class="skolem">W</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"⋅<span class="hidden">⇘</span><sub><span class="skolem">W</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟬<span class="hidden">⇘</span><sub><span class="skolem">W</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"𝟭<span class="hidden">⇘</span><sub><span class="skolem">W</span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">add</span></span> <span class="quoted"><span class="free">mult</span></span> <span class="quoted"><span class="free">zero</span></span> <span class="quoted"><span class="free">one</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">W</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> r_hom <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">(</span>mult_rel <span class="main">⌊</span><span class="skolem">U</span><span class="main">,</span><span class="skolem">s</span><span class="main">⌋</span> <span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">t</span><span class="main">⌋</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">(</span><span class="main">⌊</span><span class="skolem">W</span><span class="main">,</span> ⋅<span class="hidden">⇘</span><sub><span class="skolem">W</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="skolem">U</span> <span class="skolem">W</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="skolem">V</span> <span class="skolem">W</span> <span class="skolem">t</span><span class="main">)</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Wsub <span class="quoted"><span class="quoted">‹<span class="skolem">W</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> mult_rel_class_of that <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">ψ</span> <span class="skolem">W</span> <span class="main">(</span>⋅<span class="hidden">⇘</span><sub><span class="skolem">W</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">ρ</span> <span class="skolem">U</span> <span class="skolem">W</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ</span> <span class="skolem">V</span> <span class="skolem">W</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Wsub <span class="quoted"><span class="quoted">‹<span class="skolem">W</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> direct_lim.subset_of_opens direct_lim_axioms is_map_from_is_homomorphism
            le_infE map.map_closed ring_ψW.source.multiplicative.composition_closed that u_eval<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">mult</span> <span class="main">(</span><span class="free">ψ</span> <span class="skolem">W</span> <span class="main">(</span><span class="main">(</span><span class="free">ρ</span> <span class="skolem">U</span> <span class="skolem">W</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ψ</span> <span class="skolem">W</span> <span class="main">(</span><span class="main">(</span><span class="free">ρ</span> <span class="skolem">V</span> <span class="skolem">W</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Wsub <span class="quoted"><span class="quoted">‹<span class="skolem">W</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> inf.boundedE is_ring_morphism map.map_closed ring_ψW.multiplicative.commutes_with_composition ring_homomorphism_def subset_of_opens that<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">mult</span> <span class="main">(</span><span class="free">ψ</span> <span class="skolem">U</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="free">ψ</span> <span class="skolem">V</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Wsub <span class="quoted"><span class="quoted">‹<span class="skolem">W</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> eq that <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">mult</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌊</span><span class="skolem">U</span><span class="main">,</span><span class="skolem">s</span><span class="main">⌋</span><span class="main">)</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">t</span><span class="main">⌋</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that u_eval <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">(</span>mult_rel <span class="main">⌊</span><span class="skolem">U</span><span class="main">,</span><span class="skolem">s</span><span class="main">⌋</span> <span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">t</span><span class="main">⌋</span><span class="main">)</span> <span class="main">=</span> <span class="free">mult</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌊</span><span class="skolem">U</span><span class="main">,</span><span class="skolem">s</span><span class="main">⌋</span><span class="main">)</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">t</span><span class="main">⌋</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">(</span>mult_rel <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">=</span> <span class="free">mult</span> <span class="main">(</span><span class="skolem">u</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">(</span><span class="skolem">u</span> <span class="skolem">Y</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> carrier_direct_lim"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∈</span> carrier_direct_lim"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span> <span class="skolem">Y</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> carrier_direct_limE that<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">(</span><span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span> 𝟭<span class="hidden">⇘</span><sub><span class="skolem">V</span></sub><span class="hidden">⇙</span><span class="main">⌋</span><span class="main">)</span> <span class="main">=</span> <span class="free">one</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">V</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> ring_ψV.multiplicative.commutes_with_unit u_eval<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> u_PiE<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span><span class="bound">u</span><span class="main">.</span> ring_homomorphism <span class="bound">u</span> carrier_direct_lim add_rel mult_rel <span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="skolem">V</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span> 𝟭<span class="hidden">⇘</span><sub><span class="skolem">V</span></sub><span class="hidden">⇙</span><span class="main">⌋</span>
                                      <span class="free">A</span> <span class="free">add</span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">one</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="main">∀</span><span class="bound">U</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span> <span class="main">∘</span> canonical_fun <span class="bound">U</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">ψ</span> <span class="bound">U</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="skolem">u</span> carrier_direct_lim add_rel mult_rel <span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="skolem">V</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span> 𝟭<span class="hidden">⇘</span><sub><span class="skolem">V</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="free">A</span> <span class="free">add</span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">one</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">U</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="skolem">u</span> <span class="main">∘</span> canonical_fun <span class="bound">U</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">ψ</span> <span class="bound">U</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> canonical_fun_def hom_u u_eval<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="skolem">v</span> carrier_direct_lim add_rel mult_rel <span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="skolem">V</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="main">⌊</span><span class="skolem">V</span><span class="main">,</span> 𝟭<span class="hidden">⇘</span><sub><span class="skolem">V</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="free">A</span> <span class="free">add</span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">one</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">U</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">∘</span> canonical_fun <span class="bound">U</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">ψ</span> <span class="bound">U</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="skolem">X</span> <span class="main">=</span> <span class="skolem">v</span> <span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∈</span> carrier_direct_lim"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> v canonical_fun_def carrier_direct_limE comp_apply that u_eval<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> carrier_direct_lim <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> v Set_Theory.map_def ring_homomorphism_def<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> PiE_ext u_PiE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Locally Ringed Spaces›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Stalks of a Presheaf›</span></span>

<span class="keyword1"><span class="command">locale</span></span> stalk <span class="main">=</span> direct_lim <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_elem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> index<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">{</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">U</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* definition 0.37 *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">carrier_stalk</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">carrier_stalk</span> <span class="main">≡</span> dlim <span class="free">𝔉</span> <span class="free">ρ</span> <span class="main">(</span>neighborhoods <span class="free">x</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Comm_Ring-neighborhoods_eq"><span class="command">lemma</span></span> neighborhoods_eq<span class="main">:</span><span class="quoted"><span class="quoted">"neighborhoods <span class="free">x</span> <span class="main">=</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> index neighborhoods_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">add_stalk</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">add_stalk</span> <span class="main">≡</span> add_rel"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mult_stalk</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">mult_stalk</span> <span class="main">≡</span> mult_rel"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">zero_stalk</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">zero_stalk</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> class_of <span class="free"><span class="bound"><span class="entity">V</span></span></span> 𝟬<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">V</span></span></span></sub><span class="hidden">⇙</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">one_stalk</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_stalk</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> class_of <span class="free"><span class="bound"><span class="entity">V</span></span></span> 𝟭<span class="hidden">⇘</span><sub><span class="free"><span class="bound"><span class="entity">V</span></span></span></sub><span class="hidden">⇙</span>"</span></span>

<span class="keyword1" id="Comm_Ring-class_of_in_stalk"><span class="command">lemma</span></span> class_of_in_stalk<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> <span class="main">(</span>neighborhoods <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"class_of <span class="free">A</span> <span class="free">z</span> <span class="main">∈</span> carrier_stalk"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> equivalence <span class="quoted"><span class="quoted">"Sigma <span class="free">I</span> <span class="free">𝔉</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∼</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> rel_is_equivalence <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> carrier_stalk_def neighborhoods_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> carrier_direct_lim_def class_of_def index mem_Sigma_iff natural.map_closed<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-stalk_is_ring"><span class="command">lemma</span></span> stalk_is_ring<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ring carrier_stalk add_stalk mult_stalk <span class="main">(</span>zero_stalk <span class="free">V</span><span class="main">)</span> <span class="main">(</span>one_stalk <span class="free">V</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> r<span class="main">:</span> ring <span class="quoted">carrier_direct_lim</span> <span class="quoted">add_rel</span> <span class="quoted">mult_rel</span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">V</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span><span class="main">⌋</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⌊</span><span class="free">V</span><span class="main">,</span> 𝟭<span class="hidden">⇘</span><sub><span class="free">V</span></sub><span class="hidden">⇙</span><span class="main">⌋</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms direct_lim_is_ring index <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> r.additive.monoid_axioms
    <span class="keyword1"><span class="command">unfolding</span></span> zero_stalk_def one_stalk_def add_stalk_def mult_stalk_def carrier_stalk_def
    <span class="keyword1"><span class="command">using</span></span> index neighborhoods_def r.ring_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Comm_Ring-in_zero_stalk"><span class="command">lemma</span></span> in_zero_stalk <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">V</span><span class="main">,</span> <span class="free">zero_str</span> <span class="free">V</span><span class="main">)</span> <span class="main">∈</span> zero_stalk <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms zero_stalk_def class_of_def class_of_0_in equivalence.Class_self rel_is_equivalence<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-in_one_stalk"><span class="command">lemma</span></span> in_one_stalk <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">V</span><span class="main">,</span> <span class="free">one_str</span> <span class="free">V</span><span class="main">)</span> <span class="main">∈</span> one_stalk <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms one_stalk_def class_of_def class_of_1_in equivalence.Class_self rel_is_equivalence<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-universal_property_for_stalk"><span class="command">lemma</span></span> universal_property_for_stalk<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">ψ</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'c</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ringA<span class="main">:</span> <span class="quoted"><span class="quoted">"ring <span class="free">A</span> <span class="free">add</span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">one</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span> <span class="main">∈</span> neighborhoods <span class="free">x</span> <span class="main">⟹</span> ring_homomorphism <span class="main">(</span><span class="free">ψ</span> <span class="bound">U</span><span class="main">)</span> <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>+<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span>⋅<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span><span class="main">)</span> 𝟬<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span> 𝟭<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span> <span class="free">A</span> <span class="free">add</span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">one</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span> <span class="bound">V</span> <span class="bound">s</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">U</span> <span class="main">∈</span> neighborhoods <span class="free">x</span><span class="main">;</span> <span class="bound">V</span> <span class="main">∈</span> neighborhoods <span class="free">x</span><span class="main">;</span> <span class="bound">V</span><span class="main">⊆</span><span class="bound">U</span><span class="main">;</span> <span class="bound">s</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="bound">U</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">ψ</span> <span class="bound">V</span> <span class="main">∘</span> <span class="free">ρ</span> <span class="bound">U</span> <span class="bound">V</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">ψ</span> <span class="bound">U</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">V</span><span class="main">∈</span><span class="main">(</span>neighborhoods <span class="free">x</span><span class="main">)</span><span class="main">.</span> <span class="main">∃!</span><span class="bound">u</span><span class="main">.</span> ring_homomorphism <span class="bound">u</span>
carrier_stalk add_stalk mult_stalk <span class="main">(</span>zero_stalk <span class="bound">V</span><span class="main">)</span> <span class="main">(</span>one_stalk <span class="bound">V</span><span class="main">)</span> <span class="free">A</span> <span class="free">add</span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">one</span>
<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">U</span><span class="main">∈</span><span class="main">(</span>neighborhoods <span class="free">x</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">s</span><span class="main">∈</span><span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span> <span class="main">∘</span> canonical_fun <span class="bound">U</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span> <span class="free">ψ</span> <span class="bound">U</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> neighborhoods_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">V</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">∃!</span><span class="bound">u</span><span class="main">.</span> ring_homomorphism <span class="bound">u</span> carrier_direct_lim add_rel mult_rel
                      <span class="main">⌊</span><span class="bound">V</span><span class="main">,</span> 𝟬<span class="hidden">⇘</span><sub><span class="bound">V</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="main">⌊</span><span class="bound">V</span><span class="main">,</span> 𝟭<span class="hidden">⇘</span><sub><span class="bound">V</span></sub><span class="hidden">⇙</span><span class="main">⌋</span> <span class="free">A</span> <span class="free">add</span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">one</span> <span class="main">∧</span>
                          <span class="main">(</span><span class="main">∀</span><span class="bound">U</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span> <span class="main">∘</span> canonical_fun <span class="bound">U</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">ψ</span> <span class="bound">U</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> universal_property<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ringA hom<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> carrier_stalk_def add_stalk_def mult_stalk_def zero_stalk_def one_stalk_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* stalk *)</span>

<span class="keyword1"><span class="command">sublocale</span></span> stalk <span class="main">⊆</span> direct_lim <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> direct_lim_axioms<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Maximal Ideals›</span></span>

<span class="comment1">(* definition 0.38 *)</span>
<span class="keyword1"><span class="command">locale</span></span> max_ideal <span class="main">=</span> comm_ring <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="main">+</span> ideal <span class="quoted"><span class="free">I</span></span>  <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭</span></span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">R</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">I</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">addition</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">multiplication</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">zero</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟬</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
<span class="free">unit</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭</span>"</span><span class="main">)</span> <span class="main">+</span>
<span class="keyword2"><span class="keyword">assumes</span></span> neq_ring<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> is_max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">𝔞</span><span class="main">.</span> ideal <span class="bound">𝔞</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">⟹</span> <span class="bound">𝔞</span> <span class="main">≠</span> <span class="free">R</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊆</span> <span class="bound">𝔞</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">=</span> <span class="bound">𝔞</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Comm_Ring-psubset_ring"><span class="command">lemma</span></span> psubset_ring<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊂</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> neq_ring <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">𝔞</span><span class="main">.</span> ideal <span class="bound">𝔞</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">∧</span> <span class="bound">𝔞</span> <span class="main">≠</span> <span class="free">R</span> <span class="main">∧</span> <span class="free">I</span> <span class="main">⊂</span> <span class="bound">𝔞</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A maximal ideal is prime›</span></span>
<span class="keyword1"><span class="command">proposition</span></span> is_pr_ideal<span class="main">:</span> <span class="quoted"><span class="quoted">"pr_ideal <span class="free">R</span> <span class="free">I</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="free">R</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> neq_ring <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∨</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">J</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="main">≡</span> <span class="main">{</span><span class="bound">i</span> <span class="main"><span class="free">+</span></span> <span class="bound">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">x</span> <span class="main">|</span><span class="bound">i</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">R</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> J_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">J</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> J_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> additive.left_unit additive.sub_unit_closed multiplicative.left_unit multiplicative.unit_closed<span class="main">)</span>
      <span class="keyword1"><span class="command">interpret</span></span> monJ<span class="main">:</span> monoid <span class="quoted"><span class="skolem">J</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬</span></span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">+</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬</span></span> <span class="main">∈</span> <span class="skolem">J</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> J_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">J</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ia</span></span> <span class="skolem"><span class="skolem">ra</span></span> <span class="skolem"><span class="skolem">ib</span></span> <span class="skolem"><span class="skolem">rb</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">ia</span> <span class="main"><span class="free">+</span></span> <span class="skolem">ra</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ra</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
                                  <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">ib</span> <span class="main"><span class="free">+</span></span> <span class="skolem">rb</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ib</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rb</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> J_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ia</span> <span class="main"><span class="free">+</span></span> <span class="skolem">ra</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">x</span> <span class="main"><span class="free">+</span></span> <span class="main">(</span><span class="skolem">ib</span> <span class="main"><span class="free">+</span></span> <span class="skolem">rb</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ia</span> <span class="main"><span class="free">+</span></span> <span class="skolem">ib</span> <span class="main"><span class="free">+</span></span> <span class="main">(</span><span class="skolem">ra</span> <span class="main"><span class="free">+</span></span> <span class="skolem">rb</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> additive.commutative additive.composition_closed additive.monoid_axioms additive.submonoid_axioms distributive<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> monoid.associative multiplicative.composition_closed submonoid.sub<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> a b <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">+</span></span> <span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">J</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> J_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="skolem">J</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">+</span></span> <span class="skolem">b</span> <span class="main"><span class="free">+</span></span> <span class="skolem">c</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main"><span class="free">+</span></span> <span class="main">(</span><span class="skolem">b</span> <span class="main"><span class="free">+</span></span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">⊆</span> <span class="free">R</span>›</span></span> additive.associative subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">J</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">+</span></span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">+</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">⊆</span> <span class="free">R</span>›</span></span> additive.left_unit additive.right_unit <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">interpret</span></span> idJ<span class="main">:</span> ideal <span class="quoted"><span class="skolem">J</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="skolem">J</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main"><span class="free">+</span></span> <span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> J_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">u</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">i</span> <span class="main"><span class="free">+</span></span> <span class="main">(</span><span class="main">-</span><span class="skolem">r</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> additive.commutative additive.inverse_composition_commute local.left_minus<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">u</span> <span class="main">∈</span> <span class="skolem">J</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> J_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="skolem">J</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid.invertible <span class="skolem">J</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">u</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span>  monoid.invertibleI <span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> v <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">u</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="skolem">J</span>›</span></span> monJ.monoid_axioms <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main"><span class="free">+</span></span> <span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">J</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> ir<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main"><span class="free">+</span></span> <span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> J_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">i</span> <span class="main"><span class="free">+</span></span> <span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">i</span> <span class="main"><span class="free">+</span></span> <span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> distributive<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> multiplicative.associative<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">J</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> ideal<span class="main">(</span>1<span class="main">)</span> ir <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> J_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">i</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">a</span> <span class="main"><span class="free">+</span></span> <span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> comm_mult distributive<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ir mult_left_assoc<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">J</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">⊆</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">J</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">J</span>›</span></span> comm_mult subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">⊆</span> <span class="free">R</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊂</span> <span class="skolem">J</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊆</span> <span class="skolem">J</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> J_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> additive.sub.right_unit additive.unit_closed left_zero<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="skolem">J</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">J</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="free">I</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="main">=</span> <span class="free">R</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> idJ.ideal_axioms is_max <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭</span></span> <span class="main">∈</span> <span class="skolem">J</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭</span></span> <span class="main">=</span> <span class="skolem">a</span> <span class="main"><span class="free">+</span></span> <span class="skolem">r</span><span class="main"><span class="free">⋅</span></span><span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> J_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span> <span class="main"><span class="free">+</span></span> <span class="skolem">r</span><span class="main"><span class="free">⋅</span></span><span class="skolem">x</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> multiplicative.left_unit <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">y</span> <span class="main"><span class="free">+</span></span> <span class="skolem">r</span><span class="main"><span class="free">⋅</span></span><span class="skolem">x</span><span class="main"><span class="free">⋅</span></span><span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> distributive<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> dot ideal multiplicative.associative<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* locale max_ideal *)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Maximal Left Ideals›</span></span>

<span class="keyword1"><span class="command">locale</span></span> lideal <span class="main">=</span> subgroup_of_additive_group_of_ring <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lideal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">r</span> <span class="main">∈</span> <span class="free">R</span><span class="main">;</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">r</span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Comm_Ring-subset"><span class="command">lemma</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊆</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Comm_Ring-has_one_imp_equal"><span class="command">lemma</span></span> has_one_imp_equal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭</span></span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms lideal subset multiplicative.right_unit subsetI subset_antisym<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_ring<span class="main">)</span> ideal_iff_lideal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"ideal <span class="free">I</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">⟷</span> lideal <span class="free">I</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> I<span class="main">:</span> ideal <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> I.ideal <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">presburger</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> I<span class="main">:</span> lideal <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">a</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">a</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> I.lideal <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> comm_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">locale</span></span> max_lideal <span class="main">=</span> lideal <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> neq_ring<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">≠</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> is_max<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">𝔞</span><span class="main">.</span> lideal <span class="bound">𝔞</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">⟹</span> <span class="bound">𝔞</span> <span class="main">≠</span> <span class="free">R</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">⊆</span> <span class="bound">𝔞</span> <span class="main">⟹</span> <span class="free">I</span> <span class="main">=</span> <span class="bound">𝔞</span>"</span></span>

<span class="comment1">(**WHY ARE THE ARGUMENT ORDERS OF max_ideal vs max_lideal INCONSISTENT?**)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_ring<span class="main">)</span> max_ideal_iff_max_lideal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"max_ideal <span class="free">R</span> <span class="free">I</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">⟷</span> max_lideal <span class="free">I</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> I<span class="main">:</span> max_ideal <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lideal_axioms <span class="free">I</span> <span class="free">R</span> <span class="main"><span class="free">(⋅)</span></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I.ideal<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> lideal_axioms.intro<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"max_lideal_axioms <span class="free">I</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I.is_max I.neq_ring ideal_iff_lideal max_lideal_axioms.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> I<span class="main">:</span> max_lideal <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ideal_axioms <span class="free">I</span> <span class="free">R</span> <span class="main"><span class="free">(⋅)</span></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> I.lideal_axioms ideal_def ideal_iff_lideal<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"max_ideal_axioms <span class="free">R</span> <span class="free">I</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> I.is_max I.neq_ring ideal_iff_lideal max_ideal_axioms.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Local Rings›</span></span>

<span class="comment1">(* definition 0.39 *)</span>
<span class="keyword1"><span class="command">locale</span></span> local_ring <span class="main">=</span> ring <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_unique<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">I</span> <span class="bound">J</span><span class="main">.</span> max_lideal <span class="bound">I</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">⟹</span> max_lideal <span class="bound">J</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">⟹</span> <span class="bound">I</span> <span class="main">=</span> <span class="bound">J</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> has_max_lideal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">𝔴</span><span class="main">.</span> max_lideal <span class="bound">𝔴</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>

<span class="comment1">(*Can this be proved from the analogous result for left, right ideals?*)</span>
<span class="keyword1" id="Comm_Ring-im_of_ideal_is_ideal"><span class="command">lemma</span></span> im_of_ideal_is_ideal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="free">I</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"ring_epimorphism <span class="free">f</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> IA<span class="main">:</span> ideal <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span>
    <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpret</span></span> fepi<span class="main">:</span> ring_epimorphism <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
    <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
    <span class="keyword3"><span class="command">show</span></span> sma<span class="main">:</span> <span class="quoted"><span class="quoted">"submonoid_axioms <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">zeroB</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">I</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">zeroA</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">zeroB</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> fepi.additive.commutes_with_unit <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b1</span> <span class="skolem">b2</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">addB</span> <span class="skolem">b1</span> <span class="skolem">b2</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> image_iff
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IA.additive.sub IA.additive.sub_composition_closed fepi.additive.commutes_with_composition<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">addB</span> <span class="free">zeroB</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">addB</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> sma submonoid_axioms_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">zeroB</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> fepi.additive.commutes_with_unit <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.group_axioms <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">addB</span> <span class="free">zeroB</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">addA</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">zeroA</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IA.additive.sub.invertible_right_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid.invertible <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">addB</span> <span class="free">zeroB</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IA.additive.commutative IA.additive.sub <span class="quoted"><span class="quoted">‹Group_Theory.monoid <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">addB</span> <span class="free">zeroB</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">i</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> fepi.additive.commutes_with_composition fepi.additive.commutes_with_unit image_eqI monoid.invertibleI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ideal_axioms <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">B</span> <span class="free">multB</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">fi</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fi</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">fi</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> fepi.surjective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">multB</span> <span class="skolem">b</span> <span class="skolem">fi</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IA.additive.submonoid_axioms IA.ideal<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">fi</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">i</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> fepi.multiplicative.commutes_with_composition image_iff submonoid.sub<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">multB</span> <span class="skolem">fi</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IA.additive.sub IA.ideal<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> a i fepi.multiplicative.commutes_with_composition imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-im_of_lideal_is_lideal"><span class="command">lemma</span></span> im_of_lideal_is_lideal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"lideal <span class="free">I</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"ring_epimorphism <span class="free">f</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lideal <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> IA<span class="main">:</span> lideal <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span>
    <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpret</span></span> fepi<span class="main">:</span> ring_epimorphism <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
    <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
    <span class="keyword3"><span class="command">show</span></span> sma<span class="main">:</span> <span class="quoted"><span class="quoted">"submonoid_axioms <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">zeroB</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">I</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">zeroA</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">zeroB</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> fepi.additive.commutes_with_unit <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b1</span> <span class="skolem">b2</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">addB</span> <span class="skolem">b1</span> <span class="skolem">b2</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> image_iff
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IA.additive.sub IA.additive.sub_composition_closed fepi.additive.commutes_with_composition<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">addB</span> <span class="free">zeroB</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">addB</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> sma submonoid_axioms_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">zeroB</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> fepi.additive.commutes_with_unit <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.group_axioms <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">addB</span> <span class="free">zeroB</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">addA</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">zeroA</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> IA.additive.sub.invertible_right_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid.invertible <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">addB</span> <span class="free">zeroB</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IA.additive.commutative IA.additive.sub <span class="quoted"><span class="quoted">‹Group_Theory.monoid <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">addB</span> <span class="free">zeroB</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">i</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> fepi.additive.commutes_with_composition fepi.additive.commutes_with_unit image_eqI monoid.invertibleI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lideal_axioms <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">B</span> <span class="free">multB</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">fi</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fi</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">fi</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">b</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> fepi.surjective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">multB</span> <span class="skolem">b</span> <span class="skolem">fi</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IA.additive.submonoid_axioms IA.lideal<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">fi</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">i</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> fepi.multiplicative.commutes_with_composition image_iff submonoid.sub<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Comm_Ring-im_of_max_lideal_is_max"><span class="command">lemma</span></span> im_of_max_lideal_is_max<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"max_lideal <span class="free">I</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"ring_isomorphism <span class="free">f</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"max_lideal <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> maxI<span class="main">:</span> max_lideal <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span>
    <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpret</span></span> fiso<span class="main">:</span> ring_isomorphism <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
    <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">interpret</span></span> fIB<span class="main">:</span> lideal <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"submonoid_axioms <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">zeroB</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">addB</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
        <span class="keyword1"><span class="command">using</span></span> that
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> fiso.additive.commutes_with_composition maxI.additive.sub maxI.additive.sub_composition_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> fiso.additive.commutes_with_unit <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">addB</span> <span class="free">zeroB</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> fiso.target.additive.monoid_axioms
      <span class="keyword1"><span class="command">unfolding</span></span> submonoid_axioms_def monoid_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subsetD<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.group_axioms <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">addB</span> <span class="free">zeroB</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  Group_Theory.group_axioms_def image_iff monoid.invertible_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fiso.additive.commutes_with_composition fiso.additive.commutes_with_unit maxI.additive.sub maxI.additive.sub.invertible maxI.additive.sub.invertible_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">r</span> <span class="main">∈</span> <span class="free">B</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">I</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">xa</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">multB</span> <span class="bound">r</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">xa</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> fiso.multiplicative.commutes_with_composition fiso.surjective image_iff maxI.additive.sub maxI.lideal<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lideal_axioms <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">B</span> <span class="free">multB</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> lideal_axioms.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">I</span> <span class="main">≠</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> maxI.neq_ring fiso.bijective maxI.additive.submonoid_axioms
      <span class="keyword1"><span class="command">unfolding</span></span> submonoid_axioms_def submonoid_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_imp_inj_on fiso.surjective inj_on_image_eq_iff subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">J</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lideal <span class="skolem">J</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="main">≠</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">I</span> <span class="main">⊆</span> <span class="skolem">J</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> JB<span class="main">:</span> lideal <span class="quoted"><span class="skolem">J</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"lideal <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span><span class="main">)</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
      <span class="keyword3"><span class="command">show</span></span> sma<span class="main">:</span> <span class="quoted"><span class="quoted">"submonoid_axioms <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span><span class="main">)</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">zeroA</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">addA</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
          <span class="keyword1"><span class="command">using</span></span> that
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
          <span class="keyword1"><span class="command">using</span></span> JB.additive.sub_composition_closed fiso.additive.commutes_with_composition <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span><span class="main">)</span> <span class="free">addA</span> <span class="free">zeroA</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_threshold<span class="main"><span class="main">)</span></span> Group_Theory.monoid.intro IntD2 sma maxI.additive.associative maxI.additive.left_unit maxI.additive.right_unit submonoid_axioms_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.group_axioms <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span><span class="main">)</span> <span class="free">addA</span> <span class="free">zeroA</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid.invertible <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span><span class="main">)</span> <span class="free">addA</span> <span class="free">zeroA</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> JB.additive.sub.invertible JB.additive.submonoid_inverse_closed IntI <span class="quoted"><span class="quoted">‹Group_Theory.monoid <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span><span class="main">)</span> <span class="free">addA</span> <span class="free">zeroA</span>›</span></span> fiso.additive.invertible_commutes_with_inverse maxI.additive.inverse_equality maxI.additive.invertible maxI.additive.invertibleE monoid.invertible_def vimageI<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lideal_axioms <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span><span class="main">)</span> <span class="free">A</span> <span class="free">multA</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">j</span>
        <span class="keyword3"><span class="command">assume</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">multA</span> <span class="skolem">a</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> JB.lideal<span class="main">(</span>1<span class="main">)</span> fiso.map_closed fiso.multiplicative.commutes_with_composition
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> maxI.is_max <span class="main"><span class="main">[</span></span><span class="operator">OF</span> §<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span> <span class="main">≠</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> JB.additive.sub <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">≠</span> <span class="free">B</span>›</span></span> fiso.surjective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊆</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> fim image_subset_iff_subset_vimage inf_greatest maxI.additive.sub subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="main">⊆</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> JB.additive.sub fiso.surjective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> fim <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">I</span> <span class="main">=</span> <span class="skolem">J</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-im_of_max_ideal_is_max"><span class="command">lemma</span></span> im_of_max_ideal_is_max<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"max_ideal <span class="free">A</span> <span class="free">I</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"ring_isomorphism <span class="free">f</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"max_ideal <span class="free">B</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> maxI<span class="main">:</span> max_ideal <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span>
    <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpret</span></span> fiso<span class="main">:</span> ring_isomorphism <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
    <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">interpret</span></span> fIB<span class="main">:</span> ideal <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
    <span class="keyword1"><span class="command">using</span></span> maxI.ideal_axioms fiso.ring_homomorphism_axioms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> fiso.ring_epimorphism_axioms im_of_ideal_is_ideal<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"comm_ring_axioms <span class="free">B</span> <span class="free">multB</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b1</span> <span class="skolem">b2</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b1</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b2</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a1</span> <span class="main">=</span> <span class="skolem">b1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a2</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">a2</span> <span class="main">=</span> <span class="skolem">b2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> fiso.surjective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">multA</span> <span class="skolem">a1</span> <span class="skolem">a2</span> <span class="main">=</span> <span class="free">multA</span> <span class="skolem">a2</span> <span class="skolem">a1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> maxI.comm_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">multB</span> <span class="skolem">b1</span> <span class="skolem">b2</span> <span class="main">=</span> <span class="free">multB</span> <span class="skolem">b2</span> <span class="skolem">b1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a1 a2 fiso.multiplicative.commutes_with_composition<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"max_ideal_axioms <span class="free">B</span> <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="free">I</span><span class="main">)</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∉</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> maxI.neq_ring <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">∉</span> <span class="free">f</span> <span class="main">`</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> image_iff
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fiso.injective inj_on_def maxI.additive.sub<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">I</span> <span class="main">≠</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> fiso.map_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">J</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ideal <span class="skolem">J</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">J</span> <span class="main">≠</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> fim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">I</span> <span class="main">⊆</span> <span class="skolem">J</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> JB<span class="main">:</span> ideal <span class="quoted"><span class="skolem">J</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span><span class="main">)</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
        <span class="keyword3"><span class="command">show</span></span> sma<span class="main">:</span> <span class="quoted"><span class="quoted">"submonoid_axioms <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span><span class="main">)</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">zeroA</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">addA</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
            <span class="keyword1"><span class="command">using</span></span> that
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
            <span class="keyword1"><span class="command">using</span></span> JB.additive.sub_composition_closed fiso.additive.commutes_with_composition <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span><span class="main">)</span> <span class="free">addA</span> <span class="free">zeroA</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_threshold<span class="main"><span class="main">)</span></span> Group_Theory.monoid.intro IntD2 sma maxI.additive.associative maxI.additive.left_unit maxI.additive.right_unit submonoid_axioms_def<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.group_axioms <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span><span class="main">)</span> <span class="free">addA</span> <span class="free">zeroA</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid.invertible <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span><span class="main">)</span> <span class="free">addA</span> <span class="free">zeroA</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> JB.additive.sub.invertible JB.additive.submonoid_inverse_closed IntI <span class="quoted"><span class="quoted">‹Group_Theory.monoid <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span><span class="main">)</span> <span class="free">addA</span> <span class="free">zeroA</span>›</span></span> fiso.additive.invertible_commutes_with_inverse maxI.additive.inverse_equality maxI.additive.invertible maxI.additive.invertibleE monoid.invertible_def vimageI<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ideal_axioms <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span><span class="main">)</span> <span class="free">A</span> <span class="free">multA</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">j</span>
          <span class="keyword3"><span class="command">assume</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">multA</span> <span class="skolem">a</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> JB.ideal<span class="main">(</span>1<span class="main">)</span> fiso.map_closed fiso.multiplicative.commutes_with_composition
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">multA</span> <span class="skolem">j</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_iff § maxI.comm_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"§"</span> JB.additive.sub <span class="quoted"><span class="quoted">‹<span class="skolem">J</span> <span class="main">≠</span> <span class="free">B</span>›</span></span> fim fiso.surjective image_subset_iff_subset_vimage
            le_inf_iff maxI.is_max maxI.psubset_ring psubsetE subsetI subset_antisym<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="free">I</span> <span class="main">=</span> <span class="skolem">J</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> JB.additive.sub fiso.surjective
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Comm_Ring-preim_of_ideal_is_ideal"><span class="command">lemma</span></span> preim_of_ideal_is_ideal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="free">J</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="free">f</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">J</span><span class="main">)</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> JB<span class="main">:</span> ideal <span class="quoted"><span class="free">J</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
    <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpret</span></span> f<span class="main">:</span> ring_homomorphism <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">interpret</span></span> preB<span class="main">:</span> ring <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span>
    <span class="keyword1"><span class="command">using</span></span> f.ring_preimage <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"submonoid_axioms <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">J</span><span class="main">)</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">zeroA</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> submonoid_axioms_def f.additive.commutes_with_composition f.additive.commutes_with_unit<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> grp_fAJ<span class="main">:</span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">J</span><span class="main">)</span> <span class="free">addA</span> <span class="free">zeroA</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> submonoid_axioms_def Group_Theory.monoid_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.group_axioms <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">J</span><span class="main">)</span> <span class="free">addA</span> <span class="free">zeroA</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> group_def
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">J</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">J</span> <span class="main">∧</span> <span class="skolem">v</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">addA</span> <span class="skolem">x</span> <span class="skolem">v</span> <span class="main">=</span> <span class="free">zeroA</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> JB.additive.sub.invertible JB.additive.submonoid_inverse_closed f.additive.invertible_commutes_with_inverse
              f.source.additive.invertible f.source.additive.invertible_inverse_closed f.source.additive.invertible_right_inverse<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid.invertible <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">J</span><span class="main">)</span> <span class="free">addA</span> <span class="free">zeroA</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_iff f.source.additive.commutative grp_fAJ monoid.invertibleI vimageI x<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ideal_axioms <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">J</span><span class="main">)</span> <span class="free">A</span> <span class="free">multA</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">j</span>
      <span class="keyword3"><span class="command">assume</span></span> §<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">J</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">multA</span> <span class="skolem">j</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">multA</span> <span class="skolem">a</span> <span class="skolem">j</span> <span class="main">∈</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">J</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> JB.ideal f.map_closed f.multiplicative.commutes_with_composition <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-preim_of_max_ideal_is_max"><span class="command">lemma</span></span> preim_of_max_ideal_is_max<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"max_ideal <span class="free">B</span> <span class="free">J</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"ring_isomorphism <span class="free">f</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"max_ideal <span class="free">A</span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">J</span><span class="main">)</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> maxJ<span class="main">:</span> max_ideal <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">J</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
    <span class="keyword1"><span class="command">using</span></span> J <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpret</span></span> fiso<span class="main">:</span> ring_isomorphism <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
    <span class="keyword1"><span class="command">using</span></span> f <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">interpret</span></span> fAJ<span class="main">:</span> ideal <span class="quoted"><span class="quoted">"<span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">J</span>"</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span>
    <span class="keyword1"><span class="command">using</span></span> maxJ.ideal_axioms fiso.ring_homomorphism_axioms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> preim_of_ideal_is_ideal<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"comm_ring_axioms <span class="free">A</span> <span class="free">multA</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">multB</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="free">multB</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> fiso.map_closed maxJ.comm_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">multA</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">=</span> <span class="free">multA</span> <span class="skolem">b</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_iff_bijections <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> fiso.bijective fiso.multiplicative.commutes_with_composition fiso.source.multiplicative.composition_closed<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"max_ideal_axioms <span class="free">A</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">J</span><span class="main">)</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">J</span> <span class="main">≠</span> <span class="free">A</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> fiso.surjective maxJ.additive.sub maxJ.neq_ring <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"ideal <span class="skolem">I</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">≠</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">J</span> <span class="main">⊆</span> <span class="skolem">I</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> IA<span class="main">:</span> ideal <span class="quoted"><span class="skolem">I</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> mon_fI<span class="main">:</span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span><span class="main">)</span> <span class="free">addB</span> <span class="free">zeroB</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">addB</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> image_iff
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IA.additive.sub IA.additive.sub_composition_closed fiso.additive.commutes_with_composition<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">zeroB</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> fiso.additive.commutes_with_unit <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">have</span></span> ideal_fI<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span><span class="main">)</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span> <span class="main">⊆</span> <span class="free">B</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">zeroB</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> fiso.additive.commutes_with_unit <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">addB</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> image_iff
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IA.additive.sub IA.additive.sub_composition_closed fiso.additive.commutes_with_composition<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">addA</span> <span class="skolem">i</span> <span class="skolem">j</span> <span class="main">=</span> <span class="free">zeroA</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="skolem">I</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> IA.additive.sub.invertible IA.additive.sub.invertibleE<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">addB</span> <span class="skolem">b</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">zeroB</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IA.additive.sub i fiso.additive.commutes_with_composition fiso.additive.commutes_with_unit<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid.invertible <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span><span class="main">)</span> <span class="free">addB</span> <span class="free">zeroB</span> <span class="skolem">b</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IA.additive.sub i <span class="quoted"><span class="quoted">‹<span class="skolem">j</span> <span class="main">∈</span> <span class="skolem">I</span>›</span></span> fiso.map_closed imageI maxJ.additive.commutative mon_fI monoid.invertibleI<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> IA.ideal <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">multB</span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">multB</span> <span class="skolem">b</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> IA.additive.sub fiso.multiplicative.commutes_with_composition fiso.surjective image_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> maxJ.is_max <span class="main"><span class="main">[</span></span><span class="operator">OF</span> ideal_fI<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span> <span class="main">≠</span> <span class="free">B</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IA.additive.sub <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">≠</span> <span class="free">A</span>›</span></span> fiso.injective fiso.surjective inj_on_image_eq_iff subsetI<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">J</span> <span class="main">⊆</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> image_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_threshold<span class="main"><span class="main">)</span></span> Int_iff <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">J</span> <span class="main">⊆</span> <span class="skolem">I</span>›</span></span> fiso.surjective imageE maxJ.additive.sub subset_eq vimageI<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">J</span> <span class="main">=</span> <span class="skolem">I</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">J</span> <span class="main">⊆</span> <span class="skolem">I</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-preim_of_lideal_is_lideal"><span class="command">lemma</span></span> preim_of_lideal_is_lideal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"lideal <span class="free">I</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="free">f</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"lideal <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">I</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> A<span class="main">:</span> ring <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms ring_homomorphism_def<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> B<span class="main">:</span> ring <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms ring_homomorphism_def<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> f<span class="main">:</span> ring_homomorphism <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpret</span></span> preB<span class="main">:</span> ring <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span>
    <span class="keyword1"><span class="command">using</span></span> f.ring_preimage <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpret</span></span> IB<span class="main">:</span> lideal <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"submonoid_axioms <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">I</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="free">addA</span> <span class="free">zeroA</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> submonoid_axioms_def f.additive.commutes_with_composition f.additive.commutes_with_unit<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>A.additive.inverse <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">u</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>A.additive.inverse <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> B.additive.inverse <span class="main">(</span><span class="free">f</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> A.additive.invertible f.additive.invertible_commutes_with_inverse that <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> A.additive.invertible_inverse_closed that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">addA</span> <span class="main">(</span>A.additive.inverse <span class="skolem">u</span><span class="main">)</span> <span class="skolem">u</span> <span class="main">=</span> <span class="free">zeroA</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">addA</span> <span class="skolem">u</span> <span class="main">(</span>A.additive.inverse <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="free">zeroA</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> that<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">I</span><span class="main">)</span> <span class="free">addA</span> <span class="free">zeroA</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monoid_def f.additive.commutes_with_composition f.additive.commutes_with_unit<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.group_axioms <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">I</span><span class="main">)</span> <span class="free">addA</span> <span class="free">zeroA</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> group_axioms_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntE monoid.invertibleI vimage_eq<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lideal_axioms <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">I</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="free">multA</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> lideal_axioms_def
      <span class="keyword1"><span class="command">using</span></span> IB.lideal f.map_closed f.multiplicative.commutes_with_composition <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-preim_of_max_lideal_is_max"><span class="command">lemma</span></span> preim_of_max_lideal_is_max<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"max_lideal <span class="free">I</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ring_isomorphism <span class="free">f</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"max_lideal <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">I</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> f<span class="main">:</span> ring_isomorphism <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpret</span></span> MI<span class="main">:</span> max_lideal <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> pre<span class="main">:</span> lideal <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> preim_of_lideal_is_lideal MI.lideal_axioms f.ring_homomorphism_axioms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"max_lideal_axioms <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">I</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">I</span> <span class="main">≠</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> MI.neq_ring MI.subset f.surjective <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">𝔞</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"lideal <span class="skolem">𝔞</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔞</span> <span class="main">≠</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">B</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">I</span> <span class="main">⊆</span> <span class="skolem">𝔞</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> lideal <span class="quoted"><span class="skolem">𝔞</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="skolem">𝔞</span> <span class="main">≠</span> <span class="free">B</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_absorb1 <span class="quoted"><span class="quoted">‹<span class="skolem">𝔞</span> <span class="main">≠</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">B</span>›</span></span> f.injective f.surjective image_subset_iff_subset_vimage inj_on_image_eq_iff subset subset_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊆</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">𝔞</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_threshold<span class="main"><span class="main">)</span></span> Int_iff MI.subset <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">I</span> <span class="main">⊆</span> <span class="skolem">𝔞</span>›</span></span> f.surjective image_iff subset_iff vimageI<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lideal <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">𝔞</span><span class="main">)</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f.multiplicative.image.subset f.ring_epimorphism_axioms im_of_lideal_is_lideal image_subset_iff_subset_vimage inf.orderE inf_sup_aci<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> lideal_axioms<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">I</span> <span class="main">=</span> <span class="skolem">𝔞</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MI.is_max <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">I</span> <span class="main">⊆</span> <span class="skolem">𝔞</span>›</span></span> image_subset_iff_subset_vimage le_inf_iff subset subset_antisym<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-isomorphic_to_local_is_local"><span class="command">lemma</span></span> isomorphic_to_local_is_local<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lring<span class="main">:</span> <span class="quoted"><span class="quoted">"local_ring <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> iso<span class="main">:</span> <span class="quoted"><span class="quoted">"ring_isomorphism <span class="free">f</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"local_ring <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
  <span class="keyword1"><span class="command">interpret</span></span> ring <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> iso ring_homomorphism.axioms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ring_isomorphism.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="free">A</span> <span class="free">addA</span> <span class="free">zeroA</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> additive.monoid_axioms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.group_axioms <span class="free">A</span> <span class="free">addA</span> <span class="free">zeroA</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Group_Theory.group_def additive.group_axioms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"commutative_monoid_axioms <span class="free">A</span> <span class="free">addA</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> additive.commutative commutative_monoid_axioms_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="free">A</span> <span class="free">multA</span> <span class="free">oneA</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> multiplicative.monoid_axioms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring_axioms <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> local.ring_axioms ring.axioms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> hom<span class="main">:</span> <span class="quoted"><span class="quoted">"monoid_homomorphism <span class="free">f</span> <span class="free">A</span> <span class="free">multA</span> <span class="free">oneA</span> <span class="free">B</span> <span class="free">multB</span> <span class="free">oneB</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> iso ring_homomorphism_def ring_isomorphism.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> iso map.graph
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bijective.bijective ring_isomorphism_def bijective_map_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"local_ring_axioms <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">J</span>
    <span class="keyword3"><span class="command">assume</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"max_lideal <span class="skolem">I</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"max_lideal <span class="skolem">J</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> <span class="skolem">J</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"max_lideal <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span><span class="main">)</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> I im_of_max_lideal_is_max iso<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"max_lideal <span class="main">(</span><span class="free">f</span> <span class="main">`</span> <span class="skolem">J</span><span class="main">)</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> J im_of_max_lideal_is_max iso<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">`</span> <span class="skolem">I</span> <span class="main">=</span> <span class="free">f</span> <span class="main">`</span> <span class="skolem">J</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> local_ring.is_unique lring<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> bij_betw_imp_inj_on <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹bij_betw <span class="free">f</span> <span class="free">A</span> <span class="free">B</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> I J inj_on_image_eq_iff lideal.subset max_lideal.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">𝔴</span><span class="main">.</span> max_lideal <span class="bound">𝔴</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> im_of_max_lideal_is_max iso local_ring.has_max_lideal lring ring_isomorphism.inverse_ring_isomorphism<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(* ex. 0.40 *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> pr_ideal<span class="main">)</span> local_ring_at_is_local<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"local_ring carrier_local_ring_at add_local_ring_at mult_local_ring_at zero_local_ring_at one_local_ring_at"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> cq<span class="main">:</span> quotient_ring <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">∖</span><span class="free">I</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Comm_Ring.quotient_ring_def comm.comm_ring_axioms submonoid_pr_ideal<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">𝔴</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔴</span> <span class="main">≡</span> <span class="main">{</span>quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="free">I</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="bound">r</span> <span class="bound">s</span><span class="main">|</span> <span class="bound">r</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">∖</span> <span class="free">I</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="comment1">―‹Now every proper ideal of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="free">R</span><span class="main">∖</span><span class="free">I</span>"</span><span class="antiquote">}</span></span> is included in <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">𝔴</span></span><span class="antiquote">}</span></span>, and the result follows trivially›</span>
  <span class="keyword1"><span class="command">have</span></span> maximal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔞</span> <span class="main">⊆</span> <span class="skolem">𝔴</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"lideal <span class="skolem">𝔞</span> carrier_local_ring_at add_local_ring_at mult_local_ring_at zero_local_ring_at one_local_ring_at"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔞</span> <span class="main">≠</span> carrier_local_ring_at"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔞</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">interpret</span></span> 𝔞<span class="main">:</span> lideal <span class="quoted"><span class="skolem">𝔞</span></span> <span class="quoted">carrier_local_ring_at</span> <span class="quoted">add_local_ring_at</span> <span class="quoted">mult_local_ring_at</span> <span class="quoted">zero_local_ring_at</span> <span class="quoted">one_local_ring_at</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">𝔞</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">𝔴</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∉</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∉</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> cq.frac <span class="skolem">r</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> frac_from_carrier_local <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">𝔞</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">𝔴</span>›</span></span> <span class="main">[</span><span class="operator">unfolded</span> 𝔴_def<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> 𝔞.additive.sub<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sr<span class="main">:</span> <span class="quoted"><span class="quoted">"cq.frac <span class="skolem">s</span> <span class="skolem">r</span> <span class="main">∈</span> carrier_local_ring_at"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> carrier_local_ring_at_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s</span> <span class="main">∉</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∉</span> <span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∉</span> <span class="free">I</span>›</span></span> absorbent <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_local_ring_at <span class="main">=</span> cq.frac <span class="main"><span class="free">𝟭</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_local_ring_at_def cq.one_rel_def<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cq.frac <span class="main">(</span><span class="skolem">s</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span><span class="skolem">r</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∉</span> <span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∉</span> <span class="free">I</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cq.frac_eqI <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="free"><span class="quoted"><span class="main"><span class="free"><span class="quoted"><span class="main"><span class="free">𝟭</span></span></span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> comm.comm_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cq.mult_rel <span class="main">(</span>cq.frac <span class="skolem">s</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>cq.frac <span class="skolem">r</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∉</span> <span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∉</span> <span class="free">I</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cq.mult_rel_frac<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> mult_local_ring_at <span class="main">(</span>cq.frac <span class="skolem">s</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>cq.frac <span class="skolem">r</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> mult_local_ring_at_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">∈</span> <span class="skolem">𝔞</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 𝔞.lideal <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> cq.frac <span class="skolem">r</span> <span class="skolem">s</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">𝔞</span>›</span></span> sr <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"one_local_ring_at <span class="main">∈</span> <span class="skolem">𝔞</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> ne 𝔞.has_one_imp_equal <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">𝔴</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> uminus_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"uminus_local_ring_at <span class="skolem">u</span> <span class="main">∈</span> <span class="skolem">𝔴</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="skolem">𝔴</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝔴_def cq.uminus_rel_frac uminus_local_ring_at_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> add_closed<span class="main">:</span> <span class="quoted"><span class="quoted">"add_local_ring_at <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">𝔴</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">𝔴</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">𝔴</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ra</span></span> <span class="skolem"><span class="skolem">sa</span></span> <span class="skolem"><span class="skolem">rb</span></span> <span class="skolem"><span class="skolem">sb</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> cq.frac <span class="skolem">ra</span> <span class="skolem">sa</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> cq.frac <span class="skolem">rb</span> <span class="skolem">sb</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ra</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rb</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sa</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sa</span> <span class="main">∉</span> <span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sb</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sb</span> <span class="main">∉</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">𝔴</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">𝔴</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 𝔴_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"add_local_ring_at <span class="main">(</span>cq.frac <span class="skolem">ra</span> <span class="skolem">sa</span><span class="main">)</span> <span class="main">(</span>cq.frac <span class="skolem">rb</span> <span class="skolem">sb</span><span class="main">)</span> <span class="main">=</span> cq.frac <span class="main">(</span><span class="skolem">ra</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">sb</span> <span class="main"><span class="free">+</span></span> <span class="skolem">rb</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">sa</span><span class="main">)</span> <span class="main">(</span><span class="skolem">sa</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">sb</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cq.add_rel_frac add_local_ring_at_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ra</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">sb</span> <span class="main"><span class="free">+</span></span> <span class="skolem">rb</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">sa</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ra</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">rb</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">sa</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">sb</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> ideal<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> 𝔴_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">sa</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">sa</span> <span class="main">∉</span> <span class="free">I</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">sb</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">sb</span> <span class="main">∉</span> <span class="free">I</span>›</span></span> ab absorbent <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> 𝔴<span class="main">:</span> lideal <span class="quoted"><span class="skolem">𝔴</span></span> <span class="quoted">carrier_local_ring_at</span> <span class="quoted">add_local_ring_at</span> <span class="quoted">mult_local_ring_at</span> <span class="quoted">zero_local_ring_at</span> <span class="quoted">one_local_ring_at</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
    <span class="keyword3"><span class="command">show</span></span> subm<span class="main">:</span> <span class="quoted"><span class="quoted">"submonoid_axioms <span class="skolem">𝔴</span> carrier_local_ring_at add_local_ring_at zero_local_ring_at"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔴</span> <span class="main">⊆</span> carrier_local_ring_at"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 𝔴_def comm.comm_ring_axioms comm.frac_in_carrier_local comm_ring.spectrum_def pr_ideal_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"zero_local_ring_at <span class="main">∈</span> <span class="skolem">𝔴</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 𝔴_def comm.spectrum_def comm.spectrum_imp_cxt_quotient_ring not_1 pr_ideal_axioms quotient_ring.zero_rel_def zero_local_ring_at_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_closed<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> mon<span class="main">:</span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="skolem">𝔴</span> add_local_ring_at zero_local_ring_at"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"zero_local_ring_at <span class="main">∈</span> <span class="skolem">𝔴</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subm submonoid_axioms_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">𝔴</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">𝔴</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="skolem">𝔴</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_local_ring_at <span class="main">(</span>add_local_ring_at <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">=</span> add_local_ring_at <span class="skolem">a</span> <span class="main">(</span>add_local_ring_at <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> additive.associative in_mono subm submonoid_axioms_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">𝔴</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_local_ring_at zero_local_ring_at <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">𝔴</span>›</span></span> subm additive.left_unit in_mono submonoid_axioms_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_local_ring_at <span class="skolem">a</span> zero_local_ring_at <span class="main">=</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">𝔴</span>›</span></span> additive.right_unit in_mono subm submonoid_axioms_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_closed<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.group_axioms <span class="skolem">𝔴</span> add_local_ring_at zero_local_ring_at"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">unfold_locales</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="skolem">𝔴</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid.invertible <span class="skolem">𝔴</span> add_local_ring_at zero_local_ring_at <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> monoid.invertibleI <span class="main"><span class="main">[</span></span><span class="operator">OF</span> mon<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_local_ring_at <span class="skolem">u</span> <span class="main">(</span>uminus_local_ring_at <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> zero_local_ring_at"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="skolem">𝔴</span>›</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> 𝔴_def add_local_ring_at_def zero_local_ring_at_def uminus_local_ring_at_def<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff  additive.submonoid_axioms cq.add_minus_zero_rel cq.valid_frac_def submonoid.sub<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"add_local_ring_at <span class="main">(</span>uminus_local_ring_at <span class="skolem">u</span><span class="main">)</span> <span class="skolem">u</span> <span class="main">=</span> zero_local_ring_at"</span></span>
          <span class="keyword1"><span class="command">using</span></span> subm <span class="keyword1"><span class="command">unfolding</span></span> submonoid_axioms_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="skolem">𝔴</span>›</span></span> additive.commutative subset_iff uminus_closed<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="skolem">𝔴</span>›</span></span> uminus_closed <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lideal_axioms <span class="skolem">𝔴</span> carrier_local_ring_at mult_local_ring_at"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> carrier_local_ring_at"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ra</span></span> <span class="skolem"><span class="skolem">sa</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> cq.frac <span class="skolem">ra</span> <span class="skolem">sa</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ra</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sa</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sa</span> <span class="main">∉</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> frac_from_carrier_local<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> carrier_local_ring_at"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comm.frac_in_carrier_local comm.spectrum_def pr_ideal_axioms<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">𝔴</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rb</span></span> <span class="skolem"><span class="skolem">sb</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> cq.frac <span class="skolem">rb</span> <span class="skolem">sb</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rb</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sb</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sb</span> <span class="main">∉</span> <span class="free">I</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 𝔴_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cq.mult_rel <span class="main">(</span>cq.frac <span class="skolem">ra</span> <span class="skolem">sa</span><span class="main">)</span> <span class="main">(</span>cq.frac <span class="skolem">rb</span> <span class="skolem">sb</span><span class="main">)</span> <span class="main">=</span> cq.frac <span class="main">(</span><span class="skolem">ra</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">rb</span><span class="main">)</span> <span class="main">(</span><span class="skolem">sa</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">sb</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ra</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> sa  <span class="quoted"><span class="quoted">‹<span class="skolem">rb</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> sb
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cq.mult_rel_frac<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"mult_local_ring_at <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">∈</span> <span class="skolem">𝔴</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_local_ring_at_def 𝔴_def a b<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff <span class="quoted"><span class="quoted">‹<span class="skolem">ra</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">rb</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> cq.sub_composition_closed ideal<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> sa sb<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> max<span class="main">:</span> <span class="quoted"><span class="quoted">"max_lideal <span class="skolem">𝔴</span> carrier_local_ring_at add_local_ring_at mult_local_ring_at zero_local_ring_at one_local_ring_at"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="free">R</span><span class="main">∖</span><span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"cq.frac <span class="main"><span class="free">𝟭</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">=</span> cq.frac <span class="skolem">r</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">r</span> <span class="skolem">s</span>
      <span class="keyword1"><span class="command">using</span></span> that eq_from_eq_frac <span class="main">[</span><span class="operator">OF</span> eq<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> <span class="free">I</span>›</span></span> comm.additive.abelian_group_axioms
      <span class="keyword1"><span class="command">unfolding</span></span> abelian_group_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff absorbent additive.sub comm.additive.cancel_imp_equal comm.inverse_distributive<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> comm.multiplicative.composition_closed cq.sub_unit_closed ideal<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cq.frac <span class="main"><span class="free">𝟭</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">∉</span> <span class="skolem">𝔴</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 𝔴_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cq.frac <span class="main"><span class="free">𝟭</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">∈</span> carrier_local_ring_at"</span></span>
      <span class="keyword1"><span class="command">using</span></span> carrier_local_ring_at_def cq.multiplicative.unit_closed cq.one_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔴</span> <span class="main">≠</span> carrier_local_ring_at"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> maximal <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">J</span><span class="main">.</span> max_lideal <span class="bound">J</span> carrier_local_ring_at add_local_ring_at mult_local_ring_at zero_local_ring_at one_local_ring_at
<span class="main">⟹</span> <span class="bound">J</span> <span class="main">=</span> <span class="skolem">𝔴</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> maximal max max_lideal.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> max_lideal.is_max max_lideal.neq_ring<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> max <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.ring_axioms local_ring_axioms_def local_ring_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> stalk<span class="main">)</span> <span class="entity">is_local</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">is_local</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">≡</span> local_ring carrier_stalk add_stalk mult_stalk <span class="main">(</span>zero_stalk <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> <span class="main">(</span>one_stalk <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span>"</span></span>

<span class="comment1">(* def. 0.41 *)</span>
<span class="keyword1"><span class="command">locale</span></span> local_ring_morphism <span class="main">=</span>
source<span class="main">:</span> local_ring <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="main">+</span> target<span class="main">:</span> local_ring <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬'</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span>
<span class="main">+</span> ring_homomorphism <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬'</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">f</span> <span class="keyword2"><span class="keyword">and</span></span>
<span class="free">A</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">addition</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">multiplication</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">zero</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟬</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
<span class="free">B</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">addition'</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">+''</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">multiplication'</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⋅''</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">zero'</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟬''</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">unit'</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">𝟭''</span>"</span><span class="main">)</span>
<span class="main">+</span> <span class="keyword2"><span class="keyword">assumes</span></span> preimage_of_max_lideal<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">𝔴<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">𝔴<span class="hidden">⇩</span><sub>B</sub></span><span class="main">.</span> max_lideal <span class="bound">𝔴<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">A</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">⟹</span> max_lideal <span class="bound">𝔴<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">B</span> <span class="main"><span class="free">(+')</span></span> <span class="main"><span class="free">(⋅')</span></span> <span class="main"><span class="free">𝟬'</span></span> <span class="main"><span class="free">𝟭'</span></span> <span class="main">⟹</span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="bound">𝔴<span class="hidden">⇩</span><sub>B</sub></span><span class="main">)</span> <span class="main">=</span> <span class="bound">𝔴<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>

<span class="keyword1" id="Comm_Ring-id_is_local_ring_morphism"><span class="command">lemma</span></span> id_is_local_ring_morphism<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"local_ring <span class="free">A</span> <span class="free">add</span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">one</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"local_ring_morphism <span class="main">(</span>identity <span class="free">A</span><span class="main">)</span> <span class="free">A</span> <span class="free">add</span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">one</span> <span class="free">A</span> <span class="free">add</span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">one</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> local_ring <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">add</span></span> <span class="quoted"><span class="free">mult</span></span> <span class="quoted"><span class="free">zero</span></span> <span class="quoted"><span class="free">one</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Set_Theory.map <span class="main">(</span>identity <span class="free">A</span><span class="main">)</span> <span class="free">A</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Set_Theory.map_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid_homomorphism_axioms <span class="main">(</span>identity <span class="free">A</span><span class="main">)</span> <span class="free">A</span> <span class="free">add</span> <span class="free">zero</span> <span class="free">add</span> <span class="free">zero</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monoid_homomorphism_axioms_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid_homomorphism_axioms <span class="main">(</span>identity <span class="free">A</span><span class="main">)</span> <span class="free">A</span> <span class="free">mult</span> <span class="free">one</span> <span class="free">mult</span> <span class="free">one</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monoid_homomorphism_axioms_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"local_ring_morphism_axioms <span class="main">(</span>identity <span class="free">A</span><span class="main">)</span> <span class="free">A</span> <span class="free">add</span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">one</span> <span class="free">A</span> <span class="free">add</span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">one</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>B</sub></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"max_lideal <span class="skolem">𝔴<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">A</span> <span class="free">add</span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">one</span>"</span></span> <span class="quoted"><span class="quoted">"max_lideal <span class="skolem">𝔴<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">A</span> <span class="free">add</span> <span class="free">mult</span> <span class="free">zero</span> <span class="free">one</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔴<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_absorb2 is_unique lideal.subset max_lideal.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"identity <span class="free">A</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> preimage_identity_self<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring_epimorphism<span class="main">)</span> preim_subset_imp_subset<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">R</span> <span class="free">I</span> <span class="main">⊆</span> <span class="free">η</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">R</span> <span class="free">J</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊆</span> <span class="free">R'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">⊆</span> <span class="free">J</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Int_absorb1 assms surjective
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1" id="Comm_Ring-iso_is_local_ring_morphism"><span class="command">lemma</span></span> iso_is_local_ring_morphism<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"local_ring <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ring_isomorphism <span class="free">f</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"local_ring_morphism <span class="free">f</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> A<span class="main">:</span> local_ring <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpret</span></span> B<span class="main">:</span> ring <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ring_homomorphism_def ring_isomorphism_def<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> f<span class="main">:</span> ring_isomorphism <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> preB<span class="main">:</span> ring <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> A.ring_axioms f.multiplicative.image.subset image_subset_iff_subset_vimage inf.absorb2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">I</span> <span class="skolem">J</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"max_lideal <span class="skolem">I</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> MI<span class="main">:</span> max_lideal <span class="quoted"><span class="skolem">I</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"max_lideal <span class="skolem">J</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> MJ<span class="main">:</span> max_lideal <span class="quoted"><span class="skolem">J</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">interpret</span></span> GI<span class="main">:</span> subgroup <span class="quoted"><span class="skolem">I</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">zeroB</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"max_lideal <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">I</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> MI.max_lideal_axioms f.ring_isomorphism_axioms preim_of_max_lideal_is_max<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"max_lideal <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> MJ.max_lideal_axioms f.ring_isomorphism_axioms preim_of_max_lideal_is_max<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">I</span> <span class="main">=</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">J</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A.is_unique Int_absorb1 f.multiplicative.image.subset image_subset_iff_subset_vimage<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> <span class="skolem">J</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> MI.lideal_axioms MI.neq_ring MJ.max_lideal_axioms MJ.subset f.preim_subset_imp_subset max_lideal.is_max subset_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">𝔴</span><span class="main">.</span> max_lideal <span class="bound">𝔴</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> A.has_max_lideal assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> im_of_max_lideal_is_max<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>B</sub></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"max_lideal <span class="skolem">𝔴<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"max_lideal <span class="skolem">𝔴<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>B</sub></span> <span class="main">=</span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A.is_unique f.multiplicative.image.subset f.ring_isomorphism_axioms image_subset_iff_subset_vimage inf.absorb2 preim_of_max_lideal_is_max<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*these epimorphism aren't actually used*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> monoid_homomorphism<span class="main">)</span> monoid_epimorphism_image<span class="main">:</span>
   <span class="quoted"><span class="quoted">"monoid_epimorphism <span class="free">η</span> <span class="free">M</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">(</span><span class="free">η</span> <span class="main">`</span> <span class="free">M</span><span class="main">)</span> <span class="main"><span class="free">(⋅')</span></span> <span class="main"><span class="free">𝟭'</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> monoid <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="main">`</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> image.sub.monoid_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def commutes_with_unit commutes_with_composition<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group_homomorphism<span class="main">)</span> group_epimorphism_image<span class="main">:</span>
   <span class="quoted"><span class="quoted">"group_epimorphism <span class="free">η</span> <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">(</span><span class="free">η</span> <span class="main">`</span> <span class="free">G</span><span class="main">)</span> <span class="main"><span class="free">(⋅')</span></span> <span class="main"><span class="free">𝟭'</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> group <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="main">`</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> image.sub.group_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bij_betw_def commutes_with_composition<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring_homomorphism<span class="main">)</span> ring_epimorphism_preimage<span class="main">:</span>
   <span class="quoted"><span class="quoted">"ring_epimorphism <span class="free">η</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main">(</span><span class="free">η</span> <span class="main">`</span> <span class="free">R</span><span class="main">)</span> <span class="main"><span class="free">(+')</span></span> <span class="main"><span class="free">(⋅')</span></span> <span class="main"><span class="free">𝟬'</span></span> <span class="main"><span class="free">𝟭'</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> ring <span class="quoted"><span class="quoted">"<span class="free">η</span> <span class="main">`</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅')</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟬'</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">𝟭'</span></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> target.distributive target.additive.commutative<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> additive.commutes_with_composition additive.commutes_with_unit
      multiplicative.commutes_with_composition multiplicative.commutes_with_unit<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-comp_of_local_ring_morphisms"><span class="command">lemma</span></span> comp_of_local_ring_morphisms<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"local_ring_morphism <span class="free">f</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"local_ring_morphism <span class="free">g</span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span> <span class="free">C</span> <span class="free">addC</span> <span class="free">multC</span> <span class="free">zeroC</span> <span class="free">oneC</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"local_ring_morphism <span class="main">(</span>compose <span class="free">A</span> <span class="free">g</span> <span class="free">f</span><span class="main">)</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span> <span class="free">C</span> <span class="free">addC</span> <span class="free">multC</span> <span class="free">zeroC</span> <span class="free">oneC</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> f<span class="main">:</span> local_ring_morphism <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> g<span class="main">:</span> local_ring_morphism <span class="quoted"><span class="free">g</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">addC</span></span> <span class="quoted"><span class="free">multC</span></span> <span class="quoted"><span class="free">zeroC</span></span> <span class="quoted"><span class="free">oneC</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> gf<span class="main">:</span> ring_homomorphism <span class="quoted"><span class="quoted">"compose <span class="free">A</span> <span class="free">g</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">addC</span></span> <span class="quoted"><span class="free">multC</span></span> <span class="quoted"><span class="free">zeroC</span></span> <span class="quoted"><span class="free">oneC</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_ring_morphisms f.ring_homomorphism_axioms g.ring_homomorphism_axioms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">𝔴<span class="hidden">⇩</span><sub>B</sub></span></span> <span class="keyword2"><span class="keyword">where</span></span> 𝔴<span class="hidden">⇩</span><sub>B</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"max_lideal <span class="skolem">𝔴<span class="hidden">⇩</span><sub>B</sub></span> <span class="free">B</span> <span class="free">addB</span> <span class="free">multB</span> <span class="free">zeroB</span> <span class="free">oneB</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f.target.has_max_lideal <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"local_ring_morphism_axioms <span class="main">(</span>compose <span class="free">A</span> <span class="free">g</span> <span class="free">f</span><span class="main">)</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span> <span class="free">C</span> <span class="free">addC</span> <span class="free">multC</span> <span class="free">zeroC</span> <span class="free">oneC</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>C</sub></span>
      <span class="keyword3"><span class="command">assume</span></span> max<span class="main">:</span> <span class="quoted"><span class="quoted">"max_lideal <span class="skolem">𝔴<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
                  <span class="quoted"><span class="quoted">"max_lideal <span class="skolem">𝔴<span class="hidden">⇩</span><sub>C</sub></span> <span class="free">C</span> <span class="free">addC</span> <span class="free">multC</span> <span class="free">zeroC</span> <span class="free">oneC</span>"</span></span>
      <span class="keyword1"><span class="command">interpret</span></span> maxA<span class="main">:</span> max_lideal <span class="quoted"><span class="skolem">𝔴<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">multA</span></span> <span class="quoted"><span class="free">zeroA</span></span> <span class="quoted"><span class="free">oneA</span></span>
        <span class="keyword1"><span class="command">using</span></span> max <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">interpret</span></span> maxC<span class="main">:</span> max_lideal <span class="quoted"><span class="skolem">𝔴<span class="hidden">⇩</span><sub>C</sub></span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">addC</span></span> <span class="quoted"><span class="free">multC</span></span> <span class="quoted"><span class="free">zeroC</span></span> <span class="quoted"><span class="free">oneC</span></span>
        <span class="keyword1"><span class="command">using</span></span> max <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">g</span> <span class="main">-`</span> <span class="free">C</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> max <span class="keyword1"><span class="command">interpret</span></span> maxg<span class="main">:</span> max_lideal <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">B</span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">B</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="free">addB</span></span> <span class="quoted"><span class="free">multB</span></span> <span class="quoted"><span class="free">zeroB</span></span> <span class="quoted"><span class="free">oneB</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_absorb1 𝔴<span class="hidden">⇩</span><sub>B</sub> g.preimage_of_max_lideal<span class="main">)</span>
      <span class="keyword1"><span class="command">interpret</span></span> maxgf<span class="main">:</span> Group_Theory.monoid <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">↓</span> <span class="free">A</span><span class="main">)</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>C</sub></span>"</span></span> <span class="quoted"><span class="free">addA</span></span> <span class="quoted"><span class="free">zeroA</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monoid_def vimage_def gf.additive.commutes_with_composition
                      gf.additive.commutes_with_unit f.source.additive.associative<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">↓</span> <span class="free">A</span><span class="main">)</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">=</span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>A</sub></span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> maxA.is_max <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lideal <span class="main">(</span><span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">↓</span> <span class="free">A</span><span class="main">)</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>C</sub></span><span class="main">)</span> <span class="free">A</span> <span class="free">addA</span> <span class="free">multA</span> <span class="free">zeroA</span> <span class="free">oneA</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
          <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">↓</span> <span class="free">A</span><span class="main">)</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"maxgf.invertible <span class="skolem">u</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> maxgf.invertibleI<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">addA</span> <span class="skolem">u</span> <span class="main">(</span>f.source.additive.inverse <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="free">zeroA</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> f.source.additive.invertible_right_inverse <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">↓</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span>f.source.additive.inverse <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> g.target.additive.inverse <span class="main">(</span><span class="free">g</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">u</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f.source.additive.invertible <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> compose_eq
                    gf.additive.invertible_commutes_with_inverse<span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>f.source.additive.inverse <span class="skolem">u</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">↓</span> <span class="free">A</span><span class="main">)</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f.source.additive.invertible f.source.additive.invertible_inverse_closed
                    g.target.additive.group_axioms Int_iff compose_eq
                    maxC.additive.subgroup_inverse_iff f.map_closed g.map_axioms group.invertible
                    map.map_closed u vimage_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> u <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="skolem">a</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">↓</span> <span class="free">A</span><span class="main">)</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">multA</span> <span class="skolem">r</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">↓</span> <span class="free">A</span><span class="main">)</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> maxC.lideal gf.multiplicative.commutes_with_composition<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> maxgf.unit_closed maxgf.composition_closed <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">↓</span> <span class="free">A</span><span class="main">)</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>C</sub></span> <span class="main">≠</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f.source.multiplicative.unit_closed f.target.multiplicative.unit_closed Int_iff
              compose_eq f.multiplicative.commutes_with_unit maxg.has_one_imp_equal maxg.neq_ring
              vimage_eq<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔴<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">⊆</span> <span class="main">(</span><span class="free">g</span> <span class="main">∘</span> <span class="free">f</span> <span class="main">↓</span> <span class="free">A</span><span class="main">)</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">A</span> <span class="skolem">𝔴<span class="hidden">⇩</span><sub>C</sub></span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarsimp</span>
          <span class="keyword1"><span class="command">using</span></span> f.preimage_of_max_lideal g.preimage_of_max_lideal 𝔴<span class="hidden">⇩</span><sub>B</sub>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntD1 maxA.additive.sub compose_eq max vimageD<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Locally Ringed Spaces›</span></span>

<span class="comment1">(* The key map from the stalk at a prime ideal 𝔭 to the local ring at 𝔭 *)</span>
<span class="keyword1"><span class="command">locale</span></span> key_map <span class="main">=</span> comm_ring <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">𝔭</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> is_prime<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="keyword1">Spec</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> pi<span class="main">:</span>pr_ideal <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="free">𝔭</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_prime spectrum_imp_pr<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> top<span class="main">:</span> topological_space <span class="quoted"><span class="keyword1">Spec</span></span> <span class="quoted">is_zariski_open</span>

  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">interpretation</span></span> pr<span class="main">:</span>presheaf_of_rings <span class="quoted"><span class="keyword1">Spec</span></span> <span class="quoted">is_zariski_open</span> <span class="quoted">sheaf_spec</span> <span class="quoted">sheaf_spec_morphisms</span>
            <span class="quoted">𝒪b</span> <span class="quoted">add_sheaf_spec</span> <span class="quoted">mult_sheaf_spec</span> <span class="quoted">zero_sheaf_spec</span> <span class="quoted">one_sheaf_spec</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> local.sheaf_spec_is_presheaf<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> local<span class="main">:</span>quotient_ring <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">R</span> <span class="main">∖</span> <span class="free">𝔭</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
  <span class="keyword1"><span class="command">using</span></span> is_prime spectrum_imp_cxt_quotient_ring <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">interpretation</span></span> st<span class="main">:</span> stalk <span class="quoted"><span class="quoted">"<span class="keyword1">Spec</span>"</span></span> <span class="quoted">is_zariski_open</span> <span class="quoted">sheaf_spec</span> <span class="quoted">sheaf_spec_morphisms</span>
<span class="quoted">𝒪b</span> <span class="quoted">add_sheaf_spec</span> <span class="quoted">mult_sheaf_spec</span> <span class="quoted">zero_sheaf_spec</span> <span class="quoted">one_sheaf_spec</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">U</span><span class="main">.</span> is_zariski_open <span class="bound">U</span> <span class="main">∧</span> <span class="free">𝔭</span><span class="main">∈</span><span class="bound">U</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">𝔭</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="skolem">I</span> <span class="skolem">V</span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"open_cover_of_open_subset <span class="keyword1">Spec</span> is_zariski_open <span class="skolem">U</span> <span class="skolem">I</span> <span class="skolem">V</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟹</span> <span class="skolem">V</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟹</span> sheaf_spec_morphisms <span class="skolem">U</span> <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> zero_sheaf_spec <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> zero_sheaf_spec <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sheaf_of_rings.locality sheaf_spec_is_sheaf<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="skolem">I</span> <span class="skolem">V</span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"open_cover_of_open_subset <span class="keyword1">Spec</span> is_zariski_open <span class="skolem">U</span> <span class="skolem">I</span> <span class="skolem">V</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟶</span> <span class="skolem">V</span> <span class="bound">i</span> <span class="main">⊆</span> <span class="skolem">U</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="bound">i</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">V</span> <span class="bound">i</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span> <span class="bound">j</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span><span class="main">;</span> <span class="bound">j</span> <span class="main">∈</span> <span class="skolem">I</span><span class="main">⟧</span> <span class="main">⟹</span> sheaf_spec_morphisms <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> sheaf_spec_morphisms <span class="main">(</span><span class="skolem">V</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="bound">j</span><span class="main">)</span> <span class="main">(</span><span class="skolem">s</span> <span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">U</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="skolem">I</span> <span class="main">⟶</span> sheaf_spec_morphisms <span class="skolem">U</span> <span class="main">(</span><span class="skolem">V</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">t</span> <span class="main">=</span> <span class="skolem">s</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_threshold<span class="main"><span class="main">)</span></span> sheaf_of_rings.glueing sheaf_spec_is_sheaf<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> is_prime <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">declare</span></span> st.subset_of_opens <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">,</span> <span class="operator">rule</span> <span class="quasi_keyword">del</span><span class="main">]</span> <span class="comment1">―‹because it loops!›</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">key_map</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">key_map</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">s</span><span class="main">∈</span><span class="main">(</span><span class="keyword1">𝒪</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="free">𝔭</span>"</span></span>

<span class="keyword1" id="Comm_Ring-key_map_is_map"><span class="command">lemma</span></span> key_map_is_map<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Set_Theory.map <span class="main">(</span>key_map <span class="free">U</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span><span class="free">R</span> <span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="free">𝔭</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sheaf_spec_def assms is_regular_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"key_map <span class="free">U</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> <span class="main">(</span><span class="free">R</span> <span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> key_map_def extensional_funcset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-key_map_is_ring_morphism"><span class="command">lemma</span></span> key_map_is_ring_morphism<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="main">(</span>key_map <span class="free">U</span><span class="main">)</span>
<span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>mult_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>one_sheaf_spec <span class="free">U</span><span class="main">)</span>
<span class="main">(</span><span class="free">R</span> <span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span>pi.add_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.mult_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.zero_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.one_local_ring_at<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ring_homomorphism.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Set_Theory.map <span class="main">(</span>key_map <span class="free">U</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span><span class="free">R</span> <span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> key_map_is_map assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>mult_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>one_sheaf_spec <span class="free">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_zariski_open <span class="free">U</span>›</span></span> pr.is_ring_from_is_homomorphism <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring <span class="main">(</span><span class="free">R</span> <span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span>pi.add_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.mult_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.zero_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.one_local_ring_at<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pi.ring_axioms<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"group_homomorphism <span class="main">(</span>key_map <span class="free">U</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span><span class="free">R</span> <span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span>pi.add_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.zero_local_ring_at<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Set_Theory.map <span class="main">(</span>local.key_map <span class="free">U</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> pi.carrier_local_ring_at"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> key_map_is_map<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"Group_Theory.group_axioms <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pr.is_ring_from_is_homomorphism <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹is_zariski_open <span class="free">U</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> ring_def Group_Theory.group_def abelian_group_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>key_map <span class="free">U</span><span class="main">)</span> <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">=</span> pi.zero_local_ring_at"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">unfolding</span></span> key_map_def pi.zero_local_ring_at_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> restrict_apply' zero_sheaf_spec_def zero_sheaf_spec_in_sheaf_spec<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">;</span> <span class="bound">y</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">⟧</span> <span class="main">⟹</span>
           <span class="main">(</span>key_map <span class="free">U</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> pi.add_local_ring_at <span class="main">(</span>key_map <span class="free">U</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>key_map <span class="free">U</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> add_sheaf_spec_in_sheaf_spec key_map_def assms pi.add_local_ring_at_def
        add_sheaf_spec_def spectrum_def zariski_open_is_subset
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid_homomorphism_axioms <span class="main">(</span>local.key_map <span class="free">U</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>zero_sheaf_spec <span class="free">U</span><span class="main">)</span> pi.add_local_ring_at pi.zero_local_ring_at"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> monoid_homomorphism_axioms_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> 1 2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>key_map <span class="free">U</span><span class="main">)</span> <span class="main">(</span>one_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">=</span> pi.one_local_ring_at"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_sheaf_spec_def key_map_def pi.one_local_ring_at_def assms one_sheaf_spec_in_sheaf_spec spectrum_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">;</span> <span class="bound">y</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">⟧</span> <span class="main">⟹</span>
           <span class="main">(</span>key_map <span class="free">U</span><span class="main">)</span> <span class="main">(</span>mult_sheaf_spec <span class="free">U</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> pi.mult_local_ring_at <span class="main">(</span>key_map <span class="free">U</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>key_map <span class="free">U</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_sheaf_spec_in_sheaf_spec key_map_def assms pi.mult_local_ring_at_def
      mult_sheaf_spec_def spectrum_def zariski_open_is_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid_homomorphism <span class="main">(</span>key_map <span class="free">U</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">𝒪</span> <span class="free">U</span><span class="main">)</span> <span class="main">(</span>mult_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span>one_sheaf_spec <span class="free">U</span><span class="main">)</span> <span class="main">(</span><span class="free">R</span> <span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span>pi.mult_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.one_local_ring_at<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pr.is_ring_from_is_homomorphism <span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹is_zariski_open <span class="free">U</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">𝔭</span> <span class="main">∈</span> <span class="free">U</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> monoid_homomorphism_def monoid_homomorphism_axioms_def ring_def
    <span class="keyword1"><span class="command">using</span></span> key_map_is_map pi.multiplicative.monoid_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-key_map_is_coherent"><span class="command">lemma</span></span> key_map_is_coherent<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>key_map <span class="free">V</span> <span class="main">∘</span> sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> key_map <span class="free">U</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span> <span class="free">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms sheaf_spec_morphisms_are_maps map.map_closed
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>key_map <span class="free">V</span> <span class="main">∘</span> sheaf_spec_morphisms <span class="free">U</span> <span class="free">V</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> key_map <span class="free">U</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>›</span></span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> key_map_def sheaf_spec_morphisms_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-key_ring_morphism"><span class="command">lemma</span></span> key_ring_morphism<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">φ</span><span class="main">.</span> ring_homomorphism <span class="bound">φ</span>
st.carrier_stalk st.add_stalk st.mult_stalk <span class="main">(</span>st.zero_stalk <span class="free">V</span><span class="main">)</span> <span class="main">(</span>st.one_stalk <span class="free">V</span><span class="main">)</span>
<span class="main">(</span><span class="free">R</span> <span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span>pi.add_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.mult_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.zero_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.one_local_ring_at<span class="main">)</span>
<span class="main">∧</span>
<span class="main">(</span><span class="main">∀</span><span class="bound">U</span><span class="main">∈</span><span class="main">(</span>top.neighborhoods <span class="free">𝔭</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">s</span><span class="main">∈</span><span class="keyword1">𝒪</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">φ</span> <span class="main">∘</span> st.canonical_fun <span class="bound">U</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span> key_map <span class="bound">U</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ring <span class="main">(</span><span class="free">R</span> <span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span>pi.add_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.mult_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.zero_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.one_local_ring_at<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pi.ring_axioms<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">∈</span> top.neighborhoods <span class="free">𝔭</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms top.neighborhoods_def sheaf_spec_is_presheaf <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span> <span class="main">∈</span> top.neighborhoods <span class="free">𝔭</span> <span class="main">⟹</span>
          ring_homomorphism <span class="main">(</span>key_map <span class="bound">U</span><span class="main">)</span>
<span class="main">(</span><span class="keyword1">𝒪</span> <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>mult_sheaf_spec <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>zero_sheaf_spec <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>one_sheaf_spec <span class="bound">U</span><span class="main">)</span>
<span class="main">(</span><span class="free">R</span> <span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span>pi.add_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.mult_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.zero_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.one_local_ring_at<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> key_map_is_ring_morphism top.neighborhoods_def sheaf_spec_is_presheaf <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span> <span class="bound">V</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">U</span> <span class="main">∈</span> top.neighborhoods <span class="free">𝔭</span><span class="main">;</span> <span class="bound">V</span> <span class="main">∈</span> top.neighborhoods <span class="free">𝔭</span><span class="main">;</span> <span class="bound">V</span> <span class="main">⊆</span> <span class="bound">U</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="bound">U</span><span class="main">⟧</span>
                          <span class="main">⟹</span> <span class="main">(</span>key_map <span class="bound">V</span> <span class="main">∘</span> sheaf_spec_morphisms <span class="bound">U</span> <span class="bound">V</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> key_map <span class="bound">U</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> key_map_is_coherent
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq top.neighborhoods_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms local.sheaf_spec_is_presheaf zariski_open_is_subset
      st.universal_property_for_stalk<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span>"</span></span> <span class="quoted"><span class="quoted">"pi.add_local_ring_at"</span></span> <span class="quoted"><span class="quoted">"pi.mult_local_ring_at"</span></span>
        <span class="quoted"><span class="quoted">"pi.zero_local_ring_at"</span></span> <span class="quoted"><span class="quoted">"pi.one_local_ring_at"</span></span> <span class="quoted"><span class="quoted">"key_map"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-class_from_belongs_stalk"><span class="command">lemma</span></span> class_from_belongs_stalk<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> st.carrier_stalk"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">U</span> <span class="free">s'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> st.class_of <span class="free">U</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> dl<span class="main">:</span> direct_lim <span class="quoted"><span class="keyword1">Spec</span></span> <span class="quoted">is_zariski_open</span> <span class="quoted">sheaf_spec</span> <span class="quoted">sheaf_spec_morphisms</span> <span class="quoted"><span class="quoted">"𝒪b"</span></span>
    <span class="quoted">add_sheaf_spec</span> <span class="quoted">mult_sheaf_spec</span> <span class="quoted">zero_sheaf_spec</span> <span class="quoted">one_sheaf_spec</span> <span class="quoted"><span class="quoted">"top.neighborhoods <span class="free">𝔭</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> st.direct_lim_axioms top.neighborhoods_def<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> eq<span class="main">:</span> equivalence <span class="quoted"><span class="quoted">"Sigma <span class="main">(</span>top.neighborhoods <span class="free">𝔭</span><span class="main">)</span> sheaf_spec"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> dl.rel <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> dl.rel_is_equivalence <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">note</span></span> dl.subset_of_opens <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> eq.Class <span class="main">(</span><span class="skolem">U</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">∈</span> top.neighborhoods <span class="free">𝔭</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> st.carrier_stalk_def dl.carrier_direct_lim_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SigmaD1 SigmaD2 eq.representant_exists old.prod.exhaust<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">U</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> U dl.subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> U top.neighborhoods_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">U</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> s' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> st.class_of <span class="skolem">U</span> <span class="skolem">s'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> seq st.class_of_def top.neighborhoods_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-same_class_from_restrict"><span class="command">lemma</span></span> same_class_from_restrict<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"st.class_of <span class="free">V</span> <span class="free">s</span> <span class="main">=</span> st.class_of <span class="free">U</span> <span class="main">(</span>sheaf_spec_morphisms <span class="free">V</span> <span class="free">U</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> eq<span class="main">:</span> equivalence <span class="quoted"><span class="quoted">"Sigma <span class="main">{</span><span class="bound">U</span><span class="main">.</span> is_zariski_open <span class="bound">U</span> <span class="main">∧</span> <span class="free">𝔭</span> <span class="main">∈</span> <span class="bound">U</span><span class="main">}</span> sheaf_spec"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> st.rel <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> st.rel_is_equivalence <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> st.class_of_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eq.Class_eq<span class="main">)</span>
     <span class="keyword1"><span class="command">have</span></span> §<span class="main">:</span><span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="free">V</span> <span class="free">U</span> <span class="free">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms map.map_closed pr.is_map_from_is_homomorphism <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">W</span><span class="main">.</span> is_zariski_open <span class="bound">W</span> <span class="main">∧</span> <span class="free">𝔭</span> <span class="main">∈</span> <span class="bound">W</span> <span class="main">∧</span> <span class="bound">W</span> <span class="main">⊆</span> <span class="free">V</span> <span class="main">∧</span> <span class="bound">W</span> <span class="main">⊆</span> <span class="free">U</span> <span class="main">∧</span> sheaf_spec_morphisms <span class="free">V</span> <span class="bound">W</span> <span class="free">s</span> <span class="main">=</span> sheaf_spec_morphisms <span class="free">U</span> <span class="bound">W</span> <span class="main">(</span>sheaf_spec_morphisms <span class="free">V</span> <span class="free">U</span> <span class="free">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">V</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span><span class="main">,</span> <span class="free">U</span><span class="main">,</span> sheaf_spec_morphisms <span class="free">V</span> <span class="free">U</span> <span class="free">s</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> st.rel <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> § assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> st.rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-shrinking_from_belong_stalk"><span class="command">lemma</span></span> shrinking_from_belong_stalk<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> st.carrier_stalk"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> st.carrier_stalk"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">U</span> <span class="free">s'</span> <span class="free">t'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s'</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> st.class_of <span class="free">U</span> <span class="free">s'</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">t'</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> st.class_of <span class="free">U</span> <span class="free">t'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> HU<span class="main">:</span><span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> st.class_of <span class="skolem">U</span> <span class="skolem">s'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> class_from_belongs_stalk <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> HV<span class="main">:</span><span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> st.class_of <span class="skolem">V</span> <span class="skolem">t'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> class_from_belongs_stalk <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="free">thesis</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span> <span class="main">⊆</span> <span class="keyword1">Spec</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> zariski_open_is_subset HU<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝔭</span> <span class="main">∈</span> <span class="skolem">V</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> UV<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> topological_space.open_inter
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹is_zariski_open <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹is_zariski_open <span class="skolem">V</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> st.class_of <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>sheaf_spec_morphisms <span class="skolem">U</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span><span class="main">)</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> HU UV <span class="quoted"><span class="quoted">‹<span class="free">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span>›</span></span> same_class_from_restrict <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> st.class_of <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>sheaf_spec_morphisms <span class="skolem">V</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span><span class="main">)</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> HV UV <span class="quoted"><span class="quoted">‹<span class="free">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span>›</span></span> same_class_from_restrict <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="skolem">U</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span><span class="main">)</span> <span class="skolem">s'</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> HU<span class="main">(</span>3<span class="main">)</span> UV map.map_closed sheaf_spec_morphisms_are_maps <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="skolem">V</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span><span class="main">)</span> <span class="skolem">t'</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> HV<span class="main">(</span>3<span class="main">)</span> UV map.map_closed sheaf_spec_morphisms_are_maps <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Comm_Ring-stalk_at_prime_is_iso_to_local_ring_at_prime_aux"><span class="command">lemma</span></span> stalk_at_prime_is_iso_to_local_ring_at_prime_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    φ<span class="main">:</span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="free">φ</span>
      st.carrier_stalk st.add_stalk st.mult_stalk <span class="main">(</span>st.zero_stalk <span class="free">V</span><span class="main">)</span> <span class="main">(</span>st.one_stalk <span class="free">V</span><span class="main">)</span>
<span class="main">(</span><span class="free">R</span> <span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span>pi.add_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.mult_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.zero_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.one_local_ring_at<span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> all_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">U</span><span class="main">∈</span><span class="main">(</span>top.neighborhoods <span class="free">𝔭</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">s</span><span class="main">∈</span><span class="keyword1">𝒪</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="free">φ</span> <span class="main">∘</span> st.canonical_fun <span class="bound">U</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span> key_map <span class="bound">U</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ring_isomorphism <span class="free">φ</span>
st.carrier_stalk st.add_stalk st.mult_stalk <span class="main">(</span>st.zero_stalk <span class="free">V</span><span class="main">)</span> <span class="main">(</span>st.one_stalk <span class="free">V</span><span class="main">)</span>
<span class="main">(</span><span class="free">R</span> <span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span>pi.add_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.mult_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.zero_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.one_local_ring_at<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> ring_isomorphism.intro bijective_map.intro bijective.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="free">φ</span>
st.carrier_stalk st.add_stalk st.mult_stalk <span class="main">(</span>st.zero_stalk <span class="free">V</span><span class="main">)</span> <span class="main">(</span>st.one_stalk <span class="free">V</span><span class="main">)</span>
<span class="main">(</span><span class="free">R</span> <span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span>pi.add_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.mult_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.zero_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.one_local_ring_at<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Set_Theory.map <span class="free">φ</span> st.carrier_stalk <span class="main">(</span><span class="free">R</span> <span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ring_homomorphism_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">φ</span> st.carrier_stalk <span class="main">(</span><span class="free">R</span> <span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="free">φ</span> st.carrier_stalk"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> st.carrier_stalk"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> st.carrier_stalk"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">φ</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> FU <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">U</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> st.class_of <span class="skolem">U</span> <span class="skolem">s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> st.class_of <span class="skolem">U</span> <span class="skolem">t'</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> s'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">𝔮</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">a</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> t'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">𝔮</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">b</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∉</span> <span class="free">𝔭</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∉</span> <span class="free">𝔭</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> HV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> st.class_of <span class="skolem">V</span> <span class="skolem">s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> st.class_of <span class="skolem">V</span> <span class="skolem">t'</span>"</span></span>
                            <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="skolem">V</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> shrinking_from_belong_stalk <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">∈</span> st.carrier_stalk›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">∈</span> st.carrier_stalk›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> HU<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">R</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∉</span> <span class="free">𝔭</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∉</span> <span class="free">𝔭</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">𝔮</span><span class="main">.</span> <span class="bound">𝔮</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="main">⟹</span> <span class="skolem">f</span> <span class="main">∉</span> <span class="bound">𝔮</span> <span class="main">∧</span> <span class="skolem">s'</span> <span class="bound">𝔮</span> <span class="main">=</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">a</span> <span class="skolem">f</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">𝔮</span><span class="main">.</span> <span class="bound">𝔮</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="main">⟹</span> <span class="skolem">g</span> <span class="main">∉</span> <span class="bound">𝔮</span> <span class="main">∧</span> <span class="skolem">t'</span> <span class="bound">𝔮</span> <span class="main">=</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">b</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> shrinking<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">V</span></span> <span class="quoted"><span class="free">𝔭</span></span> <span class="quoted"><span class="skolem">s'</span></span> <span class="quoted"><span class="skolem">t'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="skolem">V</span> <span class="skolem">U</span> <span class="skolem">s'</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">U</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> HU<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> HV<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> map.map_closed sheaf_spec_morphisms_are_maps<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="skolem">V</span> <span class="skolem">U</span> <span class="skolem">t'</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">U</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> HU<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span> HV<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> map.map_closed sheaf_spec_morphisms_are_maps<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> st.class_of <span class="skolem">U</span> <span class="main">(</span>sheaf_spec_morphisms <span class="skolem">V</span> <span class="skolem">U</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HU<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span> HV same_class_from_restrict<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> st.class_of <span class="skolem">U</span> <span class="main">(</span>sheaf_spec_morphisms <span class="skolem">V</span> <span class="skolem">U</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HU<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span> HV same_class_from_restrict<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="skolem">V</span> <span class="skolem">U</span> <span class="skolem">s'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">𝔮</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">a</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> HV<span class="main">(</span>3<span class="main">)</span>  sheaf_spec_morphisms_def HU<span class="main">(</span>10<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="skolem">V</span> <span class="skolem">U</span> <span class="skolem">t'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">𝔮</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">b</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> HV<span class="main">(</span>4<span class="main">)</span> HU<span class="main">(</span>11<span class="main">)</span> sheaf_spec_morphisms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> HU <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> fact<span class="main">:</span><span class="quoted"><span class="quoted">"local.frac <span class="skolem">a</span> <span class="skolem">f</span> <span class="main">=</span> local.frac <span class="skolem">b</span> <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"local.frac <span class="skolem">a</span> <span class="skolem">f</span> <span class="main">=</span> key_map <span class="skolem">U</span> <span class="skolem">s'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> key_map_def <span class="quoted"><span class="quoted">‹<span class="free">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">𝔮</span><span class="main">∈</span><span class="skolem">U</span><span class="main">.</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">a</span> <span class="skolem">f</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s'</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">U</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">(</span>st.canonical_fun <span class="skolem">U</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹is_zariski_open <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s'</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">U</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span> pr.presheaf_of_rings_axioms top.neighborhoods_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">(</span>st.class_of <span class="skolem">U</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> direct_lim.canonical_fun_def is_prime st.canonical_fun_def st.class_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">φ</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">s</span> <span class="main">=</span> st.class_of <span class="skolem">U</span> <span class="skolem">s'</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">φ</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">φ</span> <span class="skolem">s</span> <span class="main">=</span> <span class="free">φ</span> <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">(</span>st.class_of <span class="skolem">U</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t</span> <span class="main">=</span> st.class_of <span class="skolem">U</span> <span class="skolem">t'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">(</span>st.canonical_fun <span class="skolem">U</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> direct_lim.canonical_fun_def is_prime st.canonical_fun_def st.class_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> key_map <span class="skolem">U</span> <span class="skolem">t'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹is_zariski_open <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">t'</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="skolem">U</span>›</span></span> assms<span class="main">(</span>4<span class="main">)</span> top.neighborhoods_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> local.frac <span class="skolem">b</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> FU<span class="main">(</span>4<span class="main">)</span> local.key_map_def t' <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> Hh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∉</span> <span class="free">𝔭</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">g</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">f</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> pi.eq_from_eq_frac <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_iff <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∉</span> <span class="free">𝔭</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∉</span> <span class="free">𝔭</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> izo<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> local.standard_open_is_zariski_open
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Hh<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> standard_open_is_zariski_open<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> ssm_s'<span class="main">:</span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="skolem">U</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s'</span>
                <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> FU<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Int_assoc inf_le1 izo map.map_closed sheaf_spec_morphisms_are_maps<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> ssm_t'<span class="main">:</span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="skolem">U</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t'</span>
                <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> FU<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> Int_assoc inf_le1 izo map.map_closed sheaf_spec_morphisms_are_maps<span class="main">)</span>      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Hh <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∉</span> <span class="free">𝔭</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∉</span> <span class="free">𝔭</span>›</span></span> belongs_standard_open_iff st.is_elem <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="skolem">𝔮</span> <span class="main">=</span> <span class="skolem">t'</span> <span class="skolem">𝔮</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔮</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="keyword1">Spec</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> standard_open_def that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span>        <span class="keyword1"><span class="command">interpret</span></span> q<span class="main">:</span> quotient_ring <span class="quoted"><span class="quoted">"<span class="free">R</span><span class="main">∖</span><span class="skolem">𝔮</span>"</span></span> <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> spectrum_imp_cxt_quotient_ring <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">note</span></span> local.q.sub <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>  <span class="comment1">―‹Because it definitely loops›</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">RR</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">RR</span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="main">×</span> <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="skolem">𝔮</span><span class="main">)</span><span class="main">)</span> <span class="main">×</span> <span class="free">R</span> <span class="main">×</span> <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="skolem">𝔮</span><span class="main">)</span> <span class="main">∧</span> q.rel <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">interpret</span></span> eq<span class="main">:</span> equivalence <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="main">×</span> <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="skolem">𝔮</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">RR</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> RR_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> equivalence.intro q.rel_refl q.rel_sym q.rel_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> Fq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∉</span> <span class="skolem">𝔮</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∉</span> <span class="skolem">𝔮</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∉</span> <span class="skolem">𝔮</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> belongs_standard_open_iff that
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> Int_iff <span class="quoted"><span class="quoted">‹<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="keyword1">Spec</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">R</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> Int_iff <span class="quoted"><span class="quoted">‹<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="keyword1">Spec</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> belongs_standard_open_iff that<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Hh<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> IntD2 <span class="quoted"><span class="quoted">‹<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="keyword1">Spec</span>›</span></span> belongs_standard_open_iff that<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eq.Class <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> eq.Class <span class="main">(</span><span class="skolem">b</span><span class="main">,</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> eq.Class_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s1</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">∈</span> <span class="free">R</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">∉</span> <span class="skolem">𝔮</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="skolem">g</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">a</span> <span class="main">-</span> <span class="skolem">f</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">𝟬</span></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> Hh <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">∉</span> <span class="skolem">𝔮</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">f</span><span class="main">)</span><span class="main">,</span> <span class="skolem">b</span><span class="main">,</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">RR</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> RR_def q.rel_def  <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="free">R</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="free">R</span>›</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"q.frac <span class="skolem">a</span> <span class="skolem">f</span> <span class="main">=</span> q.frac <span class="skolem">b</span> <span class="skolem">g</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> RR_def q.frac_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s'</span> <span class="skolem">𝔮</span> <span class="main">=</span> <span class="skolem">t'</span> <span class="skolem">𝔮</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> s' t'<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> st.class_of <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sheaf_spec_morphisms <span class="skolem">U</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝔭</span> <span class="main">∈</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝔭</span> <span class="main">∈</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝔭</span> <span class="main">∈</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_threshold<span class="main"><span class="main">)</span></span> FU<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span> IntE IntI izo s<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> same_class_from_restrict subsetI<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> st.class_of <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sheaf_spec_morphisms <span class="skolem">U</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> local.st.class_of_eqI<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sheaf_spec_morphisms <span class="skolem">U</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span> sheaf_spec_morphisms <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sheaf_spec_morphisms <span class="skolem">U</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> local.pr.eq_ρ<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sheaf_spec_morphisms <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sheaf_spec_morphisms <span class="skolem">U</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">=</span>
                  sheaf_spec_morphisms <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>sheaf_spec_morphisms <span class="skolem">U</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span> <span class="main">∩</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> eq FU<span class="main">(</span>3<span class="main">)</span> FU<span class="main">(</span>4<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sheaf_spec_morphisms_def<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> eq restrict_ext<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> izo ssm_s' ssm_t' <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> izo ssm_s' ssm_t'<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝔭</span> <span class="main">∈</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝔭</span> <span class="main">∈</span> <span class="keyword1">𝒟(</span><span class="skolem">g</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">𝔭</span> <span class="main">∈</span> <span class="keyword1">𝒟(</span><span class="skolem">h</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_threshold<span class="main"><span class="main">)</span></span> FU<span class="main"><span class="main">(</span></span>1-4<span class="main"><span class="main">)</span></span> IntE IntI izo s<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> same_class_from_restrict subsetI<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">`</span> st.carrier_stalk <span class="main">=</span> <span class="main">(</span><span class="free">R</span> <span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">`</span> st.carrier_stalk <span class="main">⊆</span> pi.carrier_local_ring_at"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_subset_of_target ring_homomorphism_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pi.carrier_local_ring_at <span class="main">⊆</span> <span class="free">φ</span> <span class="main">`</span> st.carrier_stalk"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span> <span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> F<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="free">R</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∉</span> <span class="free">𝔭</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> local.frac <span class="skolem">a</span> <span class="skolem">f</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> pi.frac_from_carrier_local H <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">s</span></span> <span class="keyword2"><span class="keyword">where</span></span> sec_def<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">𝔮</span><span class="main">∈</span><span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span><span class="main">.</span> quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="bound">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">a</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> sec<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span><span class="main">(</span><span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="skolem">𝔮</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span><span class="hidden">⇘</span><sub><span class="skolem">𝔮</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔮</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∉</span> <span class="skolem">𝔮</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that belongs_standard_open_iff F<span class="main">(</span>2<span class="main">)</span> standard_open_is_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"quotient_ring.frac <span class="main">(</span><span class="free">R</span><span class="main">∖</span><span class="skolem">𝔮</span><span class="main">)</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="skolem">a</span> <span class="skolem">f</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span><span class="hidden">⇘</span><sub><span class="skolem">𝔮</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> F<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> frac_in_carrier_local <span class="quoted"><span class="quoted">‹<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span>›</span></span> standard_open_is_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="skolem">𝔮</span> <span class="main">∈</span> <span class="main">(</span><span class="free">R</span><span class="hidden">⇘</span><sub><span class="skolem">𝔮</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sec_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔮</span> <span class="main">∈</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span>  extensional <span class="main">(</span><span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> sec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_regular <span class="skolem">s</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> F<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> standard_open_is_subset  belongs_standard_open_iff is_regular_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span>"</span></span><span class="main">]</span> standard_open_is_zariski_open
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> is_locally_frac_def restrict_apply sec_def subsetD subsetI<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sheaf_spec_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span>"</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>PiE_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> im<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span>st.class_of <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> local.frac <span class="skolem">a</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="main">(</span>st.class_of <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">φ</span> <span class="main">(</span>st.canonical_fun <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> st.canonical_fun_def direct_lim.canonical_fun_def st.class_of_def is_prime <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> key_map <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> all_eq st.is_elem F<span class="main">(</span>2<span class="main">)</span> F<span class="main">(</span>3<span class="main">)</span> sec
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top.neighborhoods_def<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> belongs_standard_open_iff standard_open_is_zariski_open<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> local.frac <span class="skolem">a</span> <span class="skolem">f</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> F<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> belongs_standard_open_iff is_prime key_map_def restrict_apply sec sec_def<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">φ</span> <span class="main">`</span> st.carrier_stalk"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"st.class_of <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">∈</span> st.carrier_stalk"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="keyword1">Spec</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_prime <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>top.neighborhoods <span class="free">𝔭</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> top.neighborhoods_def belongs_standard_open_iff F<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> is_prime standard_open_is_zariski_open standard_open_is_subset
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq<span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="keyword1">𝒟(</span><span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sec <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> st.class_of_in_stalk <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> F<span class="main">(</span>4<span class="main">)</span> im <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-stalk_at_prime_is_iso_to_local_ring_at_prime"><span class="command">lemma</span></span> stalk_at_prime_is_iso_to_local_ring_at_prime<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔭</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">φ</span><span class="main">.</span> ring_isomorphism <span class="bound">φ</span>
st.carrier_stalk st.add_stalk st.mult_stalk <span class="main">(</span>st.zero_stalk <span class="free">V</span><span class="main">)</span> <span class="main">(</span>st.one_stalk <span class="free">V</span><span class="main">)</span>
<span class="main">(</span><span class="free">R</span> <span class="hidden">⇘</span><sub><span class="free">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span>pi.add_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.mult_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.zero_local_ring_at<span class="main">)</span> <span class="main">(</span>pi.one_local_ring_at<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> key_ring_morphism stalk_at_prime_is_iso_to_local_ring_at_prime_aux assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* key_map *)</span>

<span class="comment1">(* def. 0.42 *)</span>
<span class="keyword1"><span class="command">locale</span></span> locally_ringed_space <span class="main">=</span> ringed_space <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> stalks_are_local<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">U</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">U</span> <span class="main">⟹</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">⟹</span>
stalk.is_local <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> <span class="main">(</span>neighborhoods <span class="bound">x</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">U</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> comm_ring
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> pr<span class="main">:</span> presheaf_of_rings <span class="quoted"><span class="quoted">"<span class="keyword1">Spec</span>"</span></span> <span class="quoted">is_zariski_open</span> <span class="quoted">sheaf_spec</span> <span class="quoted">sheaf_spec_morphisms</span>
            <span class="quoted">𝒪b</span> <span class="quoted">add_sheaf_spec</span> <span class="quoted">mult_sheaf_spec</span> <span class="quoted">zero_sheaf_spec</span> <span class="quoted">one_sheaf_spec</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> comm_ring.sheaf_spec_is_presheaf local.comm_ring_axioms<span class="main">)</span>

<span class="comment1">(* ex. 0.43 *)</span>
<span class="keyword1" id="Comm_Ring-spec_is_locally_ringed_space"><span class="command">lemma</span></span> spec_is_locally_ringed_space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"locally_ringed_space <span class="keyword1">Spec</span> is_zariski_open sheaf_spec sheaf_spec_morphisms 𝒪b
add_sheaf_spec mult_sheaf_spec zero_sheaf_spec one_sheaf_spec"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> locally_ringed_space.intro locally_ringed_space_axioms.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> sh<span class="main">:</span> sheaf_of_rings <span class="quoted"><span class="keyword1">Spec</span></span> <span class="quoted">is_zariski_open</span> <span class="quoted">sheaf_spec</span>
     <span class="quoted">sheaf_spec_morphisms</span> <span class="quoted">𝒪b</span> <span class="quoted">add_sheaf_spec</span> <span class="quoted">mult_sheaf_spec</span>
     <span class="quoted">zero_sheaf_spec</span> <span class="quoted">one_sheaf_spec</span>
    <span class="keyword1"><span class="command">using</span></span> sheaf_spec_is_sheaf <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ringed_space <span class="keyword1">Spec</span> is_zariski_open sheaf_spec sheaf_spec_morphisms 𝒪b add_sheaf_spec mult_sheaf_spec zero_sheaf_spec one_sheaf_spec"</span></span>
    <span class="keyword1"><span class="command">using</span></span> spec_is_ringed_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"stalk.is_local is_zariski_open sheaf_spec sheaf_spec_morphisms add_sheaf_spec mult_sheaf_spec
zero_sheaf_spec one_sheaf_spec <span class="main">(</span>pr.neighborhoods <span class="skolem">𝔭</span><span class="main">)</span> <span class="skolem">𝔭</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">𝔭</span> <span class="skolem">U</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">interpret</span></span> st<span class="main">:</span> stalk <span class="quoted"><span class="keyword1">Spec</span></span> <span class="quoted">is_zariski_open</span> <span class="quoted">sheaf_spec</span> <span class="quoted">sheaf_spec_morphisms</span> <span class="quoted">𝒪b</span> <span class="quoted">add_sheaf_spec</span>
      <span class="quoted">mult_sheaf_spec</span> <span class="quoted">zero_sheaf_spec</span> <span class="quoted">one_sheaf_spec</span> <span class="quoted"><span class="quoted">"pr.neighborhoods <span class="skolem">𝔭</span>"</span></span> <span class="quoted"><span class="skolem">𝔭</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="keyword1">Spec</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> in_mono that zariski_open_is_subset<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pr.neighborhoods_def<span class="main">)</span>
    <span class="keyword1"><span class="command">interpret</span></span> pri<span class="main">:</span> pr_ideal <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="skolem">𝔭</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spectrum_imp_pr st.is_elem<span class="main">)</span>
    <span class="keyword1"><span class="command">interpret</span></span> km<span class="main">:</span> key_map <span class="quoted"><span class="free">R</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(+)</span></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">(⋅)</span></span>"</span></span> <span class="quoted"><span class="main"><span class="free">𝟬</span></span></span> <span class="quoted"><span class="main"><span class="free">𝟭</span></span></span> <span class="quoted"><span class="skolem">𝔭</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> st.is_elem<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ring st.carrier_stalk st.add_stalk st.mult_stalk <span class="main">(</span>st.zero_stalk <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>st.one_stalk <span class="skolem">U</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> st.stalk_is_ring sheaf_spec_is_presheaf <span class="quoted"><span class="quoted">‹is_zariski_open <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"local_ring pri.carrier_local_ring_at pri.add_local_ring_at pri.mult_local_ring_at
                 pri.zero_local_ring_at pri.one_local_ring_at"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pr_ideal.local_ring_at_is_local
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pr_ideal.local_ring_at_is_local spectrum_imp_pr st.is_elem<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">note</span></span> st.subset_of_opens <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> ring_isomorphism <span class="bound">f</span>
st.carrier_stalk st.add_stalk st.mult_stalk <span class="main">(</span>st.zero_stalk <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>st.one_stalk <span class="skolem">U</span><span class="main">)</span>
<span class="main">(</span><span class="free">R</span> <span class="hidden">⇘</span><sub><span class="skolem">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span></sub><span class="hidden">⇙</span><span class="main">)</span> <span class="main">(</span>pr_ideal.add_local_ring_at <span class="free">R</span> <span class="skolem">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span><span class="main">)</span> <span class="main">(</span>pr_ideal.mult_local_ring_at <span class="free">R</span> <span class="skolem">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span><span class="main">)</span> <span class="main">(</span>pr_ideal.zero_local_ring_at <span class="free">R</span> <span class="skolem">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span><span class="main">)</span> <span class="main">(</span>pr_ideal.one_local_ring_at <span class="free">R</span> <span class="skolem">𝔭</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> km.stalk_at_prime_is_iso_to_local_ring_at_prime st.index that<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"stalk.is_local is_zariski_open sheaf_spec sheaf_spec_morphisms add_sheaf_spec mult_sheaf_spec
zero_sheaf_spec one_sheaf_spec <span class="main">(</span>pr.neighborhoods <span class="skolem">𝔭</span><span class="main">)</span> <span class="skolem">𝔭</span> <span class="skolem">U</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> isomorphic_to_local_is_local <span class="quoted"><span class="quoted">‹<span class="skolem">𝔭</span> <span class="main">∈</span> <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹is_zariski_open <span class="skolem">U</span>›</span></span> st.is_local_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* comm_ring *)</span>

<span class="comment1">(* Construction 0.44: induced morphism between direct limits *)</span>
<span class="keyword1"><span class="command">locale</span></span> ind_mor_btw_stalks <span class="main">=</span> morphism_ringed_spaces <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_elem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> stx<span class="main">:</span>stalk <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">ρ<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">mult_str<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">zero_str<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">one_str<span class="hidden">⇩</span><sub>X</sub></span></span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open<span class="hidden">⇩</span><sub>X</sub></span> <span class="bound">U</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">U</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_elem<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> stfx<span class="main">:</span> stalk <span class="quoted"><span class="free">Y</span></span> <span class="quoted"><span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">add_str<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">mult_str<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">zero_str<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">one_str<span class="hidden">⇩</span><sub>Y</sub></span></span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="bound">U</span> <span class="main">∧</span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">U</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_elem<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">induced_morphism</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'c</span> set <span class="main">×</span> <span class="tfree">'d</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">induced_morphism</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">C</span> <span class="main">∈</span> stfx.carrier_stalk<span class="main">.</span> <span class="keyword1">let</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="bound">C</span><span class="main">)</span> <span class="keyword1">in</span> stx.class_of <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span>fst <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>fst <span class="bound">r</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">r</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(* One should think of fst r as a V in index, and snd r as a d in 𝒪<span class="hidden">⇩</span><sub>Y</sub> V. *)</span>

<span class="keyword1" id="Comm_Ring-phi_in_O"><span class="command">lemma</span></span> phi_in_O<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">V</span> <span class="free">q</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="free">V</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_morphism_of_sheaves morphism_presheaves_of_rings.fam_morphisms_are_maps
  <span class="keyword1"><span class="command">unfolding</span></span> morphism_sheaves_of_rings_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms local.im_sheaf_def map.map_closed<span class="main">)</span>

<span class="keyword1" id="Comm_Ring-induced_morphism_is_well_defined"><span class="command">lemma</span></span> induced_morphism_is_well_defined<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"stfx.rel <span class="main">(</span><span class="free">V</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">(</span><span class="free">V'</span><span class="main">,</span><span class="free">q'</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"stx.class_of <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">V</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> stx.class_of <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V'</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">V'</span> <span class="free">q'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">W</span></span> <span class="keyword2"><span class="keyword">where</span></span> W<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> <span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">⊆</span> <span class="free">V'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">V</span> <span class="skolem">W</span> <span class="free">q</span> <span class="main">=</span> <span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">V'</span> <span class="skolem">W</span> <span class="free">q'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms stfx.rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> stx.class_of_eqI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V</span><span class="main">,</span> <span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">V</span> <span class="free">q</span><span class="main">)</span> <span class="main">∈</span> Sigma <span class="main">{</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open<span class="hidden">⇩</span><sub>X</sub></span> <span class="bound">U</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">U</span><span class="main">}</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> is_continuous phi_in_O assms stfx.rel_def stx.is_elem <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V'</span><span class="main">,</span> <span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">V'</span> <span class="free">q'</span><span class="main">)</span> <span class="main">∈</span> Sigma <span class="main">{</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open<span class="hidden">⇩</span><sub>X</sub></span> <span class="bound">U</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">U</span><span class="main">}</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> is_continuous phi_in_O assms stfx.rel_def stx.is_elem <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">W</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open<span class="hidden">⇩</span><sub>X</sub></span> <span class="bound">U</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">U</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> W is_continuous stx.is_elem <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">W</span> <span class="main">⊆</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V</span> <span class="main">∩</span> <span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> W <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpret</span></span> Y<span class="main">:</span> morphism_sheaves_of_rings <span class="quoted"><span class="free">Y</span></span> <span class="quoted"><span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span></span>
     <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">add_str<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">mult_str<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">zero_str<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">one_str<span class="hidden">⇩</span><sub>Y</sub></span></span>
     <span class="quoted">local.im_sheaf</span> <span class="quoted">im_sheaf_morphisms</span> <span class="quoted"><span class="free">b</span></span>
      <span class="quoted">add_im_sheaf</span> <span class="quoted">mult_im_sheaf</span> <span class="quoted">zero_im_sheaf</span> <span class="quoted">one_im_sheaf</span> <span class="quoted"><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_morphism_of_sheaves<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">V</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">W</span> <span class="main">(</span><span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">V</span> <span class="skolem">W</span> <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms Y.comm_diagrams W
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stfx.rel_def im_sheaf_morphisms_def o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">W</span> <span class="main">(</span><span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">V'</span> <span class="skolem">W</span> <span class="free">q'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">ρ<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V'</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">V'</span> <span class="free">q'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms Y.comm_diagrams W
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stfx.rel_def im_sheaf_morphisms_def o_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">V</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">ρ<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V'</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">W</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">V'</span> <span class="free">q'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Comm_Ring-induced_morphism_eq"><span class="command">lemma</span></span> induced_morphism_eq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">∈</span> stfx.carrier_stalk"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">V</span> <span class="free">q</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">V</span><span class="main">,</span><span class="free">q</span><span class="main">)</span> <span class="main">∈</span> <span class="free">C</span>"</span></span> <span class="quoted"><span class="quoted">"induced_morphism <span class="free">C</span> <span class="main">=</span> stx.class_of <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">V</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> assms induced_morphism_def prod.exhaust_sel restrict_apply
            stfx.carrier_stalk_def stfx.neighborhoods_eq stfx.rel_carrier_Eps_in<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Comm_Ring-induced_morphism_eval"><span class="command">lemma</span></span> induced_morphism_eval<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">∈</span> stfx.carrier_stalk"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"induced_morphism <span class="free">C</span> <span class="main">=</span> stx.class_of <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span>fst <span class="free">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>fst <span class="free">r</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> assms induced_morphism_eq induced_morphism_is_well_defined
          prod.exhaust_sel stfx.carrier_direct_limE stfx.carrier_stalk_def stfx.neighborhoods_eq stfx.rel_I1<span class="main">)</span>


<span class="keyword1"><span class="command">proposition</span></span> ring_homomorphism_induced_morphism<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism induced_morphism
stfx.carrier_stalk stfx.add_stalk stfx.mult_stalk <span class="main">(</span>stfx.zero_stalk <span class="free">V</span><span class="main">)</span> <span class="main">(</span>stfx.one_stalk <span class="free">V</span><span class="main">)</span>
stx.carrier_stalk stx.add_stalk stx.mult_stalk <span class="main">(</span>stx.zero_stalk <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>stx.one_stalk <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
  <span class="keyword1"><span class="command">interpret</span></span> phif<span class="main">:</span> ring_homomorphism <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">V</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">add_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">mult_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">zero_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">one_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"local.im_sheaf <span class="free">V</span>"</span></span>
    <span class="quoted"><span class="quoted">"add_im_sheaf <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"mult_im_sheaf <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"zero_im_sheaf <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"one_im_sheaf <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> is_morphism_of_sheaves morphism_presheaves_of_rings.is_ring_morphism morphism_sheaves_of_rings_def<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> V<span class="main">:</span> ring <span class="quoted">stfx.carrier_direct_lim</span> <span class="quoted">stfx.add_rel</span> <span class="quoted">stfx.mult_rel</span> <span class="quoted"><span class="quoted">"stfx.class_of <span class="free">V</span> <span class="main">(</span><span class="free">zero_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"stfx.class_of <span class="free">V</span> <span class="main">(</span><span class="free">one_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms stfx.direct_lim_is_ring <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">interpret</span></span> X<span class="main">:</span> ring <span class="quoted">stx.carrier_direct_lim</span> <span class="quoted">stx.add_rel</span> <span class="quoted">stx.mult_rel</span> <span class="quoted"><span class="quoted">"stx.class_of <span class="free">X</span> <span class="main">(</span><span class="free">zero_str<span class="hidden">⇩</span><sub>X</sub></span> <span class="free">X</span><span class="main">)</span>"</span></span>
     <span class="quoted"><span class="quoted">"stx.class_of <span class="free">X</span> <span class="main">(</span><span class="free">one_str<span class="hidden">⇩</span><sub>X</sub></span> <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stx.direct_lim_is_ring stx.is_elem <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">interpret</span></span> dlY<span class="main">:</span> direct_lim <span class="quoted"><span class="free">Y</span></span> <span class="quoted"><span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">add_str<span class="hidden">⇩</span><sub>Y</sub></span></span>
    <span class="quoted"><span class="free">mult_str<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">zero_str<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">one_str<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="quoted">"target.neighborhoods <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stfx.direct_lim_axioms stfx.neighborhoods_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">interpret</span></span> eqY<span class="main">:</span> equivalence <span class="quoted"><span class="quoted">"Sigma <span class="main">{</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="bound">U</span> <span class="main">∧</span> <span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">U</span><span class="main">}</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> stfx.rel <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stfx.rel_is_equivalence <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpret</span></span> morphY<span class="main">:</span> morphism_sheaves_of_rings <span class="quoted"><span class="free">Y</span></span> <span class="quoted"><span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span></span>
     <span class="quoted"><span class="free">d</span></span> <span class="quoted"><span class="free">add_str<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">mult_str<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">zero_str<span class="hidden">⇩</span><sub>Y</sub></span></span> <span class="quoted"><span class="free">one_str<span class="hidden">⇩</span><sub>Y</sub></span></span>
     <span class="quoted">local.im_sheaf</span> <span class="quoted">im_sheaf_morphisms</span> <span class="quoted"><span class="free">b</span></span>
      <span class="quoted">add_im_sheaf</span> <span class="quoted">mult_im_sheaf</span> <span class="quoted">zero_im_sheaf</span> <span class="quoted">one_im_sheaf</span> <span class="quoted"><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_morphism_of_sheaves<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> 0 <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"stfx.zero_stalk <span class="free">V</span> <span class="main">∈</span> stfx.carrier_stalk"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stfx.carrier_stalk_def stfx.neighborhoods_eq stfx.zero_stalk_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> 1 <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"stfx.one_stalk <span class="free">V</span> <span class="main">∈</span> stfx.carrier_stalk"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stfx.carrier_stalk_def stfx.neighborhoods_eq stfx.one_stalk_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Set_Theory.map induced_morphism stfx.carrier_stalk stx.carrier_stalk"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"induced_morphism <span class="main">∈</span> stfx.carrier_stalk <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> stx.carrier_stalk"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span>
      <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> stfx.carrier_stalk"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="skolem">C</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> stfx.carrier_stalk_def stfx.rel_carrier_Eps_in<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> target.neighborhoods_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span>fst <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> C SigmaD1 <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> <span class="skolem">C</span>›</span></span> eqY.block_closed is_continuous prod.exhaust_sel stfx.carrier_direct_lim_def stfx.carrier_stalk_def stfx.neighborhoods_eq stfx.subset_of_opens<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stx.class_of <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span>fst <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span>fst <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> stx.carrier_stalk"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> C IntI dlY.carrier_direct_limE mem_Collect_eq phi_in_O stfx.carrier_stalk_def stfx.neighborhoods_eq stfx.rel_I1 stfx.rel_def stx.class_of_in_stalk stx.is_elem stx.neighborhoods_eq vimage_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"induced_morphism <span class="skolem">C</span> <span class="main">∈</span> stx.carrier_stalk"</span></span>
        <span class="keyword1"><span class="command">using</span></span> C <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> <span class="skolem">C</span>›</span></span> induced_morphism_eval <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> induced_morphism_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid stfx.carrier_stalk stfx.add_stalk <span class="main">(</span>stfx.zero_stalk <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> V.additive.monoid_axioms stfx.add_stalk_def stfx.carrier_stalk_def stfx.neighborhoods_eq stfx.zero_stalk_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.group_axioms stfx.carrier_stalk stfx.add_stalk <span class="main">(</span>stfx.zero_stalk <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Group_Theory.group_def V.additive.group_axioms stfx.add_stalk_def stfx.carrier_stalk_def stfx.zero_stalk_def target.neighborhoods_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"commutative_monoid_axioms stfx.carrier_stalk stfx.add_stalk"</span></span>
    <span class="keyword1"><span class="command">using</span></span> V.additive.commutative_monoid_axioms commutative_monoid_def stfx.add_stalk_def stfx.carrier_stalk_def target.neighborhoods_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid stfx.carrier_stalk stfx.mult_stalk <span class="main">(</span>stfx.one_stalk <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> V.multiplicative.monoid_axioms stfx.carrier_stalk_def stfx.mult_stalk_def stfx.neighborhoods_eq stfx.one_stalk_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring_axioms stfx.carrier_stalk stfx.add_stalk stfx.mult_stalk"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> V.additive.unit_closed mem_Collect_eq ring_def stfx.carrier_direct_limE stfx.stalk_is_ring<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid stx.carrier_stalk stx.add_stalk <span class="main">(</span>stx.zero_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> abelian_group_def assms commutative_monoid_def is_continuous ring_def stx.is_elem stx.stalk_is_ring <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.group_axioms stx.carrier_stalk stx.add_stalk <span class="main">(</span>stx.zero_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Group_Theory.group_def abelian_group_def assms is_continuous ring_def stx.is_elem stx.stalk_is_ring <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"commutative_monoid_axioms stx.carrier_stalk stx.add_stalk"</span></span>
    <span class="keyword1"><span class="command">using</span></span> X.additive.commutative_monoid_axioms commutative_monoid_def neighborhoods_def stx.add_stalk_def stx.carrier_stalk_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid stx.carrier_stalk stx.mult_stalk <span class="main">(</span>stx.one_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms is_continuous ring_def stx.is_elem stx.stalk_is_ring <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring_axioms stx.carrier_stalk stx.add_stalk stx.mult_stalk"</span></span>
    <span class="keyword1"><span class="command">using</span></span> X.ring_axioms ring_def stx.add_stalk_def stx.carrier_stalk_def stx.mult_stalk_def stx.neighborhoods_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid_homomorphism_axioms induced_morphism stfx.carrier_stalk stfx.add_stalk <span class="main">(</span>stfx.zero_stalk <span class="free">V</span><span class="main">)</span> stx.add_stalk <span class="main">(</span>stx.zero_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="skolem">C'</span>
    <span class="keyword3"><span class="command">assume</span></span> CC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> stfx.carrier_stalk"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main">∈</span> stfx.carrier_stalk"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"induced_morphism <span class="main">(</span>stfx.add_stalk <span class="skolem">C</span> <span class="skolem">C'</span><span class="main">)</span> <span class="main">=</span> stx.add_stalk <span class="main">(</span>induced_morphism <span class="skolem">C</span><span class="main">)</span> <span class="main">(</span>induced_morphism <span class="skolem">C'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">U'</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> Uq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">U</span><span class="main">,</span><span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">U'</span><span class="main">,</span><span class="skolem">q'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">C'</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"induced_morphism <span class="skolem">C</span> <span class="main">=</span> stx.class_of <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">U</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"induced_morphism <span class="skolem">C'</span> <span class="main">=</span> stx.class_of <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">U'</span> <span class="skolem">q'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CC induced_morphism_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> cc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> <span class="skolem">U'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> CC eqY.block_closed stfx.carrier_direct_lim_def stfx.carrier_stalk_def stfx.neighborhoods_eq target.open_inter <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> cc_rh<span class="main">:</span> ring_homomorphism <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">add_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">mult_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">zero_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">one_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"local.im_sheaf <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"add_im_sheaf <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"mult_im_sheaf <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"zero_im_sheaf <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"one_im_sheaf <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_morphism_of_sheaves morphism_presheaves_of_rings.is_ring_morphism morphism_sheaves_of_rings_def<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> opeU <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CC SigmaD1 Uq dlY.subset_of_opens eqY.block_closed stfx.carrier_direct_lim_def stfx.carrier_stalk_def stfx.neighborhoods_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> CC Uq stfx.carrier_direct_lim_def stfx.carrier_stalk_def stfx.neighborhoods_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">add</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">add</span> <span class="main">≡</span> <span class="free">add_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U'</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="skolem">q'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> add_stalk_eq_class<span class="main">:</span> <span class="quoted"><span class="quoted">"stfx.add_stalk <span class="skolem">C</span> <span class="skolem">C'</span> <span class="main">=</span> stfx.class_of <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="skolem">add</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> CC
        <span class="keyword1"><span class="command">unfolding</span></span> add_def stfx.add_stalk_def stfx.carrier_stalk_def dlY.carrier_direct_lim_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> IntI Int_commute Uq cc eqY.Block_self eqY.block_closed inf.cobounded1 mem_Collect_eq stfx.add_rel_class_of stfx.class_of_def stfx.neighborhoods_eq<span class="main">)</span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>stfx.class_of <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="skolem">add</span><span class="main">)</span> <span class="main">∈</span> stfx.carrier_stalk"</span></span>
         <span class="keyword1"><span class="command">using</span></span> CC <span class="quoted"><span class="quoted">‹Group_Theory.monoid stfx.carrier_stalk stfx.add_stalk <span class="main">(</span>stfx.zero_stalk <span class="free">V</span><span class="main">)</span>›</span></span> monoid.composition_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> add_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">add</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_def<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> cc_rh.source.additive.composition_closed<span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q'</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U'</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_commute cc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> codom.is_map_from_is_homomorphism inf.cobounded1 map.map_closed opeU<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> Vr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="main">∈</span> stfx.add_stalk <span class="skolem">C</span> <span class="skolem">C'</span>"</span></span>
           <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"induced_morphism <span class="main">(</span>stfx.add_stalk <span class="skolem">C</span> <span class="skolem">C'</span><span class="main">)</span> <span class="main">=</span> stx.class_of <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">V</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> induced_morphism_eq add_stalk_eq_class C <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">V</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> C SigmaD1 Vr add_stalk_eq_class dlY.subset_of_opens eqY.block_closed stfx.carrier_direct_lim_def stfx.carrier_stalk_def stfx.neighborhoods_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">V</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> IntI Vr add_stalk_eq_class add_in cc fst_conv mem_Collect_eq snd_conv stfx.rel_I1 stfx.rel_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> fxV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> <span class="skolem">V</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> C Vr add_stalk_eq_class stfx.carrier_direct_lim_def stfx.carrier_stalk_def stfx.neighborhoods_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> fXUU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">is_open<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cc<span class="main">(</span>1<span class="main">)</span> is_continuous <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">,</span> <span class="skolem">add</span><span class="main">)</span> <span class="main">∈</span> stfx.class_of <span class="skolem">V</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> IntI Vr add_stalk_eq_class add_in cc mem_Collect_eq stfx.class_of_def stfx.rel_Class_iff stfx.rel_I1<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stfx.rel <span class="main">(</span><span class="skolem">V</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">,</span> <span class="skolem">add</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fxV <span class="quoted"><span class="quoted">‹<span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">V</span>›</span></span> stfx.rel_I1<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"induced_morphism <span class="main">(</span>stfx.add_stalk <span class="skolem">C</span> <span class="skolem">C'</span><span class="main">)</span> <span class="main">=</span> stx.class_of <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="skolem">add</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eq induced_morphism_is_well_defined <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stx.add_stalk <span class="main">(</span>induced_morphism <span class="skolem">C</span><span class="main">)</span> <span class="main">(</span>induced_morphism <span class="skolem">C'</span><span class="main">)</span> <span class="main">=</span>
                     stx.add_stalk <span class="main">(</span>stx.class_of <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">U</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>
                                   <span class="main">(</span>stx.class_of <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">U'</span> <span class="skolem">q'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> CC<span class="main">(</span>1<span class="main">)</span> Uq<span class="main">(</span>1<span class="main">)</span> eq' induced_morphism_eval <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> stx.class_of <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span>
                                       <span class="main">(</span><span class="free">add_str<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span>
                                                 <span class="main">(</span><span class="free">ρ<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                                 <span class="main">(</span><span class="free">ρ<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="skolem">U'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">q'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                        <span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> stx.add_stalk_def
        <span class="keyword1"><span class="command">using</span></span> is_continuous phi_in_O stx.is_elem fXUU
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> stx.add_rel_class_of<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="skolem">add</span> <span class="main">=</span> <span class="free">add_str<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span>
                                       <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                                       <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">q'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> add_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> cc_rh.additive.commutes_with_composition<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U</span>›</span></span> cc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> codom.is_map_from_is_homomorphism inf.cobounded1 map.map_closed opeU<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U'</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="skolem">q'</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q'</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U'</span>›</span></span> cc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> codom.is_map_from_is_homomorphism inf.commute inf_le1 map.map_closed opeU<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_im_sheaf_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">add_str<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span>
                            <span class="main">(</span><span class="free">ρ<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="skolem">q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                            <span class="main">(</span><span class="free">ρ<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="skolem">U'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">q'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stfx.rel_def morphY.comm_diagrams <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> o_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> im_sheaf_morphisms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"induced_morphism <span class="main">(</span>stfx.zero_stalk <span class="free">V</span><span class="main">)</span> <span class="main">=</span> stx.class_of <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">V</span> <span class="main">(</span><span class="free">zero_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">V</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> induced_morphism_eval <span class="main">[</span><span class="operator">OF</span> 0<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> r <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">V</span><span class="main">,</span> <span class="free">zero_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">V</span><span class="main">)</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> stx.zero_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> phif.additive.commutes_with_unit zero_im_sheaf_def stx.zero_stalk_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"induced_morphism <span class="main">(</span>stfx.zero_stalk <span class="free">V</span><span class="main">)</span> <span class="main">=</span> stx.zero_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid_homomorphism_axioms induced_morphism stfx.carrier_stalk stfx.mult_stalk <span class="main">(</span>stfx.one_stalk <span class="free">V</span><span class="main">)</span> stx.mult_stalk <span class="main">(</span>stx.one_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">C</span> <span class="skolem">C'</span>
    <span class="keyword3"><span class="command">assume</span></span> CC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">∈</span> stfx.carrier_stalk"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main">∈</span> stfx.carrier_stalk"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"induced_morphism <span class="main">(</span>stfx.mult_stalk <span class="skolem">C</span> <span class="skolem">C'</span><span class="main">)</span> <span class="main">=</span> stx.mult_stalk <span class="main">(</span>induced_morphism <span class="skolem">C</span><span class="main">)</span> <span class="main">(</span>induced_morphism <span class="skolem">C'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">U</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">U'</span></span> <span class="skolem"><span class="skolem">q'</span></span> <span class="keyword2"><span class="keyword">where</span></span> Uq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">U</span><span class="main">,</span><span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">U'</span><span class="main">,</span><span class="skolem">q'</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">C'</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"induced_morphism <span class="skolem">C</span> <span class="main">=</span> stx.class_of <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">U</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> eq'<span class="main">:</span> <span class="quoted"><span class="quoted">"induced_morphism <span class="skolem">C'</span> <span class="main">=</span> stx.class_of <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">U'</span> <span class="skolem">q'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CC induced_morphism_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> cc <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> <span class="skolem">U'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> CC eqY.block_closed stfx.carrier_direct_lim_def stfx.carrier_stalk_def stfx.neighborhoods_eq target.open_inter <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> cc_rh<span class="main">:</span> ring_homomorphism <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">add_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">mult_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">zero_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">one_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"local.im_sheaf <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"add_im_sheaf <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"mult_im_sheaf <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"zero_im_sheaf <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"one_im_sheaf <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_morphism_of_sheaves morphism_presheaves_of_rings.is_ring_morphism morphism_sheaves_of_rings_def<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> opeU <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> CC SigmaD1 Uq dlY.subset_of_opens eqY.block_closed stfx.carrier_direct_lim_def stfx.carrier_stalk_def stfx.neighborhoods_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q'</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> CC Uq stfx.carrier_direct_lim_def stfx.carrier_stalk_def stfx.neighborhoods_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">mult</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">mult</span> <span class="main">≡</span> <span class="free">mult_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U'</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="skolem">q'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> mult_stalk_eq_class<span class="main">:</span> <span class="quoted"><span class="quoted">"stfx.mult_stalk <span class="skolem">C</span> <span class="skolem">C'</span> <span class="main">=</span> stfx.class_of <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="skolem">mult</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> CC
        <span class="keyword1"><span class="command">unfolding</span></span> mult_def stfx.mult_stalk_def stfx.carrier_stalk_def dlY.carrier_direct_lim_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> IntI Int_commute Uq cc eqY.Block_self eqY.block_closed inf.cobounded1 mem_Collect_eq stfx.mult_rel_class_of stfx.class_of_def stfx.neighborhoods_eq<span class="main">)</span>
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>stfx.class_of <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="skolem">mult</span><span class="main">)</span> <span class="main">∈</span> stfx.carrier_stalk"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> CC V.multiplicative.monoid_axioms monoid.composition_closed stfx.carrier_stalk_def stfx.mult_stalk_def stfx.neighborhoods_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> mult_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">mult</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_def<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> cc_rh.source.additive.composition_closed<span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q'</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U'</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> cc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> cc_rh.source.multiplicative.composition_closed codom.is_map_from_is_homomorphism inf_le1 inf_le2 map.map_closed opeU<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> Vr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">V</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span> <span class="main">∈</span> stfx.mult_stalk <span class="skolem">C</span> <span class="skolem">C'</span>"</span></span>
           <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"induced_morphism <span class="main">(</span>stfx.mult_stalk <span class="skolem">C</span> <span class="skolem">C'</span><span class="main">)</span> <span class="main">=</span> stx.class_of <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">V</span> <span class="skolem">r</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> induced_morphism_eq mult_stalk_eq_class C <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">V</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> C SigmaD1 Vr mult_stalk_eq_class dlY.subset_of_opens eqY.block_closed stfx.carrier_direct_lim_def stfx.carrier_stalk_def stfx.neighborhoods_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">V</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> IntI Vr mult_stalk_eq_class mult_in cc fst_conv mem_Collect_eq snd_conv stfx.rel_I1 stfx.rel_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> fxV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">∈</span> <span class="skolem">V</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> C Vr mult_stalk_eq_class stfx.carrier_direct_lim_def stfx.carrier_stalk_def stfx.neighborhoods_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> fXUU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">is_open<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cc<span class="main">(</span>1<span class="main">)</span> is_continuous <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">,</span> <span class="skolem">mult</span><span class="main">)</span> <span class="main">∈</span> stfx.class_of <span class="skolem">V</span> <span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> IntI Vr mult_stalk_eq_class mult_in cc mem_Collect_eq stfx.class_of_def stfx.rel_Class_iff stfx.rel_I1<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stfx.rel <span class="main">(</span><span class="skolem">V</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">,</span> <span class="skolem">mult</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fxV <span class="quoted"><span class="quoted">‹<span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">V</span>›</span></span> stfx.rel_I1<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"induced_morphism <span class="main">(</span>stfx.mult_stalk <span class="skolem">C</span> <span class="skolem">C'</span><span class="main">)</span> <span class="main">=</span> stx.class_of <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="skolem">mult</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eq induced_morphism_is_well_defined <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stx.mult_stalk <span class="main">(</span>induced_morphism <span class="skolem">C</span><span class="main">)</span> <span class="main">(</span>induced_morphism <span class="skolem">C'</span><span class="main">)</span> <span class="main">=</span>
                     stx.mult_stalk <span class="main">(</span>stx.class_of <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">U</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>
                                   <span class="main">(</span>stx.class_of <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">U'</span> <span class="skolem">q'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> CC<span class="main">(</span>1<span class="main">)</span> Uq<span class="main">(</span>1<span class="main">)</span> eq' induced_morphism_eval <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> stx.class_of <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span>
                               <span class="main">(</span><span class="free">mult_str<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span>
                                         <span class="main">(</span><span class="free">ρ<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">U</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>
                                         <span class="main">(</span><span class="free">ρ<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">U'</span> <span class="skolem">q'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> stx.mult_stalk_def
        <span class="keyword1"><span class="command">using</span></span> is_continuous phi_in_O stx.is_elem fXUU
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> stx.mult_rel_class_of<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="skolem">mult</span> <span class="main">=</span> <span class="free">mult_str<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span>
                                           <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>
                                           <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U'</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="skolem">q'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> mult_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> cc_rh.multiplicative.commutes_with_composition<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="skolem">q</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U</span>›</span></span> cc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> codom.is_map_from_is_homomorphism inf.cobounded1 map.map_closed opeU<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U'</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span> <span class="skolem">q'</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q'</span> <span class="main">∈</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="skolem">U'</span>›</span></span> cc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> codom.is_map_from_is_homomorphism inf.commute inf_le1 map.map_closed opeU<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_im_sheaf_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">mult_str<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span>
                            <span class="main">(</span><span class="free">ρ<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">U</span> <span class="skolem">q</span><span class="main">)</span><span class="main">)</span>
                            <span class="main">(</span><span class="free">ρ<span class="hidden">⇩</span><sub>X</sub></span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U'</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="main">(</span><span class="skolem">U</span> <span class="main">∩</span> <span class="skolem">U'</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">U'</span> <span class="skolem">q'</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms im_sheaf_morphisms_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> stfx.rel_def morphY.comm_diagrams <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> o_def<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"induced_morphism <span class="main">(</span>stfx.one_stalk <span class="free">V</span><span class="main">)</span> <span class="main">=</span> stx.class_of <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V</span><span class="main">)</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="free">V</span> <span class="main">(</span><span class="free">one_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">V</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> induced_morphism_eval <span class="main">[</span><span class="operator">OF</span> 1<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> r <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">V</span><span class="main">,</span> <span class="free">one_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">V</span><span class="main">)</span>"</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> stx.one_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> phif.multiplicative.commutes_with_unit one_im_sheaf_def stx.one_stalk_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"induced_morphism <span class="main">(</span>stfx.one_stalk <span class="free">V</span><span class="main">)</span> <span class="main">=</span> stx.one_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free">V</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_local</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'c</span> set <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'c</span> set <span class="main">×</span> <span class="tfree">'d</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> set <span class="main">×</span> <span class="tfree">'b</span><span class="main">)</span> set<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_local</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="main">≡</span>
      local_ring_morphism <span class="free"><span class="bound"><span class="entity">φ</span></span></span>
      stfx.carrier_stalk stfx.add_stalk stfx.mult_stalk <span class="main">(</span>stfx.zero_stalk <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span> <span class="main">(</span>stfx.one_stalk <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span>
      stx.carrier_stalk stx.add_stalk stx.mult_stalk <span class="main">(</span>stx.zero_stalk <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>stx.one_stalk <span class="main">(</span><span class="free">f</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span> <span class="comment1">(* ind_mor_btw_stalks *)</span>

<span class="keyword1"><span class="command">notation</span></span> ind_mor_btw_stalks.induced_morphism <span class="main">(</span><span class="quoted">"<span class="keyword1">φ⇘</span><span class="keyword3">(3</span>_ _ _ _<span class="keyword3">/ </span>_ _ _<span class="keyword3">/ </span>_ _ _<span class="keyword3">)</span><span class="keyword1">⇙</span>"</span>
    <span class="main">[</span>1000<span class="main">,</span>1000<span class="main">,</span>1000<span class="main">,</span>1000<span class="main">,</span>1000<span class="main">,</span>1000<span class="main">,</span>1000<span class="main">,</span>1000<span class="main">,</span>1000<span class="main">,</span>1000<span class="main">]</span>1000<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> sheaf_of_rings<span class="main">)</span> induced_morphism_with_id_is_id<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"φ<span class="hidden">⇘</span><sub><span class="free">S</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span></sub><span class="hidden">⇙</span>
       <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">C</span><span class="main">∈</span><span class="main">(</span>stalk.carrier_stalk <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">C</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> im_sheaf <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝔉</span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="quoted">"identity <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> homeomorphism.axioms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> id_is_homeomorphism im_sheaf_def inverse_map_identity
        sheaf_of_rings_axioms<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> codom<span class="main">:</span> ringed_space <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝔉</span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> im_sheaf.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> im_sheaf_axioms ringed_space_def<span class="main">)</span>

  <span class="keyword1"><span class="command">interpret</span></span> ind_mor_btw_stalks <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝔉</span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span> <span class="quoted"><span class="free">S</span></span>
       <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝔉</span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span> <span class="quoted"><span class="quoted">"identity <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">x</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="main">(</span>identity <span class="main">(</span><span class="free">𝔉</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">𝔉</span> <span class="skolem">U</span><span class="main">)</span> +<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> ⋅<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> 𝟬<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> 𝟭<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> <span class="main">(</span>local.im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>add_im_sheaf <span class="skolem">U</span><span class="main">)</span>
          <span class="main">(</span>mult_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>zero_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>one_im_sheaf <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> id_is_mor_pr_rngs im_sheaf.add_im_sheaf_def im_sheaf.im_sheaf_def
            im_sheaf.mult_im_sheaf_def im_sheaf_axioms local.topological_space_axioms
            morphism_presheaves_of_rings.is_ring_morphism one_im_sheaf_def that
            topological_space.open_preimage_identity zero_im_sheaf_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">⟶</span>
           <span class="free">is_open</span> <span class="bound">V</span> <span class="main">⟶</span>
           <span class="bound">V</span> <span class="main">⊆</span> <span class="bound">U</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="bound">U</span> <span class="main">⟶</span> <span class="main">(</span>im_sheaf_morphisms <span class="bound">U</span> <span class="bound">V</span> <span class="main">∘</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span>identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">V</span><span class="main">)</span> <span class="main">∘</span> <span class="free">ρ</span> <span class="bound">U</span> <span class="bound">V</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> comp_apply im_sheaf_morphisms_def is_map_from_is_homomorphism
            local.im_sheaf_def map.map_closed open_preimage_identity restrict_apply'<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"morphism_presheaves_of_rings_axioms <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">add_str</span> <span class="free">mult_str</span>
          <span class="free">zero_str</span> <span class="free">one_str</span> local.im_sheaf im_sheaf_morphisms add_im_sheaf mult_im_sheaf
          zero_im_sheaf one_im_sheaf <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> morphism_presheaves_of_rings_axioms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> morphism_ringed_spaces_axioms_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_locales</span>

    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> assms ind_mor_btw_stalks_axioms.intro<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">let</span> <span class="bound">r</span> <span class="main">=</span> <span class="keyword1">SOME</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> <span class="skolem">C</span>
        <span class="keyword1">in</span> direct_lim.class_of <span class="free">𝔉</span> <span class="free">ρ</span> <span class="main">(</span>neighborhoods <span class="free">x</span><span class="main">)</span> <span class="main">(</span>identity <span class="free">S</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="main">(</span>fst <span class="bound">r</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>identity <span class="main">(</span><span class="free">𝔉</span> <span class="main">(</span>fst <span class="bound">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="bound">r</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">C</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span><span class="main">∈</span>stalk.carrier_stalk <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">C</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">interpret</span></span> stk<span class="main">:</span>stalk <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝔉</span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span>
                      <span class="quoted"><span class="quoted">"neighborhoods <span class="free">x</span>"</span></span> <span class="quoted"><span class="free">x</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
      <span class="keyword1"><span class="command">using</span></span> is_elem neighborhoods_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">C</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="skolem">C</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> Sigma <span class="main">(</span>neighborhoods <span class="free">x</span><span class="main">)</span> <span class="free">𝔉</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> stk.class_of <span class="main">(</span>fst <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> stk.rel_carrier_Eps_in<span class="main">[</span><span class="operator">OF</span> that<span class="main"><span class="main"><span class="main"><span class="main">[</span></span></span></span><span class="operator"><span class="operator"><span class="operator">unfolded</span></span></span> stk.carrier_stalk_def<span class="main"><span class="main"><span class="main"><span class="main">]</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> stk.class_of <span class="main">(</span>identity <span class="free">S</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="main">(</span>fst <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>identity <span class="main">(</span><span class="free">𝔉</span> <span class="main">(</span>fst <span class="skolem">r</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> r_def Let_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  stk.class_of <span class="main">(</span>fst <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">r</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> open_preimage_identity r<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> restrict_apply stk.carrier_direct_limE
          stk.carrier_stalk_def stk.rel_I1 stk.rel_def stk.subset_of_opens that<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">C</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">=</span> stk.class_of <span class="main">(</span>fst <span class="skolem">r</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">r</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> induced_morphism_def
    <span class="keyword1"><span class="command">using</span></span> is_elem neighborhoods_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> locally_ringed_space<span class="main">)</span> induced_morphism_with_id_is_local<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">V</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ind_mor_btw_stalks.is_local
<span class="free">S</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span>
<span class="main">(</span>identity <span class="free">S</span><span class="main">)</span> <span class="free">x</span> <span class="free">V</span> <span class="main">(</span>φ<span class="hidden">⇘</span><sub><span class="free">S</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span></sub><span class="hidden">⇙</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>identity <span class="free">S</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="free">V</span> <span class="main">=</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">interpret</span></span> stfx<span class="main">:</span> stalk <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝔉</span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span>
                    <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">∧</span> <span class="main">(</span>identity <span class="free">S</span> <span class="free">x</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">U</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"identity <span class="free">S</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> assms <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"local_ring stfx.carrier_stalk stfx.add_stalk stfx.mult_stalk <span class="main">(</span>stfx.zero_stalk <span class="free">V</span><span class="main">)</span> <span class="main">(</span>stfx.one_stalk <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> assms restrict_apply' stalks_are_local stfx.is_local_def stfx.neighborhoods_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> stx<span class="main">:</span> stalk <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝔉</span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">∈</span> <span class="bound">U</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">S</span>›</span></span> stfx.stalk_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">interpret</span></span> local_ring <span class="quoted">stx.carrier_stalk</span> <span class="quoted">stx.add_stalk</span> <span class="quoted">stx.mult_stalk</span>
              <span class="quoted"><span class="quoted">"stx.zero_stalk <span class="main">(</span><span class="main">(</span>identity <span class="free">S</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="free">V</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"stx.one_stalk <span class="main">(</span><span class="main">(</span>identity <span class="free">S</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="free">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> V stalks_are_local stx.is_local_def stx.neighborhoods_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">interpret</span></span> imS<span class="main">:</span> im_sheaf <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝔉</span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="quoted">"identity <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> homeomorphism.axioms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> id_is_homeomorphism im_sheaf_def inverse_map_identity
        sheaf_of_rings_axioms<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> rh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">⟹</span>
             ring_homomorphism <span class="main">(</span>identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span> +<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span> ⋅<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span> 𝟬<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span> 𝟭<span class="hidden">⇘</span><sub><span class="bound">U</span></sub><span class="hidden">⇙</span> <span class="main">(</span>imS.im_sheaf <span class="bound">U</span><span class="main">)</span>
              <span class="main">(</span>imS.add_im_sheaf <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>imS.mult_im_sheaf <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>imS.zero_im_sheaf <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>imS.one_im_sheaf <span class="bound">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> imS.add_im_sheaf_def imS.mult_im_sheaf_def imS.one_im_sheaf_def
              imS.zero_im_sheaf_def imS.im_sheaf_def
    <span class="keyword1"><span class="command">using</span></span> id_is_mor_pr_rngs morphism_presheaves_of_rings.is_ring_morphism <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">interpret</span></span> ind_mor_btw_stalks <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝔉</span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span> <span class="quoted"><span class="free">S</span></span>
    <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝔉</span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span> <span class="quoted"><span class="quoted">"identity <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">x</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"morphism_ringed_spaces_axioms <span class="free">S</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span>
              <span class="free">S</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> morphism_ringed_spaces_axioms_def morphism_sheaves_of_rings_def
        morphism_presheaves_of_rings_def morphism_presheaves_of_rings_axioms_def
      <span class="keyword1"><span class="command">using</span></span> rh
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> presheaf_of_rings_axioms imS.presheaf_of_rings_axioms
             map.map_closed <span class="main"><span class="main">[</span></span><span class="operator">OF</span> is_map_from_is_homomorphism<span class="main"><span class="main">]</span></span> imS.im_sheaf_morphisms_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ind_mor_btw_stalks_axioms <span class="free">S</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ind_mor_btw_stalks_axioms_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"φ<span class="hidden">⇘</span><sub><span class="free">S</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span></sub><span class="hidden">⇙</span> <span class="main">=</span> identity stx.carrier_stalk"</span></span>
    <span class="keyword1"><span class="command">using</span></span> induced_morphism_with_id_is_id stx.is_elem <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> id_is_local_ring_morphism is_local_def local_ring_axioms stx.is_elem <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* definition 0.45 *)</span>

<span class="keyword1"><span class="command">locale</span></span> morphism_locally_ringed_spaces <span class="main">=</span> morphism_ringed_spaces <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> are_local_morphisms<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">V</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span><span class="main">;</span> <span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="bound">V</span><span class="main">;</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">V</span><span class="main">⟧</span> <span class="main">⟹</span>
ind_mor_btw_stalks.is_local <span class="free">X</span> <span class="free">is_open<span class="hidden">⇩</span><sub>X</sub></span> <span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span> <span class="free">ρ<span class="hidden">⇩</span><sub>X</sub></span> <span class="free">add_str<span class="hidden">⇩</span><sub>X</sub></span> <span class="free">mult_str<span class="hidden">⇩</span><sub>X</sub></span> <span class="free">zero_str<span class="hidden">⇩</span><sub>X</sub></span> <span class="free">one_str<span class="hidden">⇩</span><sub>X</sub></span>
                            <span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">add_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">mult_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">zero_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">one_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">f</span>
                            <span class="bound">x</span> <span class="bound">V</span> φ<span class="hidden">⇘</span><sub><span class="free">X</span> <span class="free">is_open<span class="hidden">⇩</span><sub>X</sub></span> <span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span> <span class="free">ρ<span class="hidden">⇩</span><sub>X</sub></span> <span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">f</span> <span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="bound">x</span></sub><span class="hidden">⇙</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> locally_ringed_space<span class="main">)</span> id_to_mor_locally_ringed_spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"morphism_locally_ringed_spaces
            <span class="free">S</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span>
            <span class="free">S</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span>
            <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
  <span class="keyword1"><span class="command">interpret</span></span> idim<span class="main">:</span> im_sheaf <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝔉</span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span> <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="quoted">"identity <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="main">(</span>identity <span class="free">S</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">S</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> open_inter preimage_identity_self<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Set_Theory.map <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span> <span class="free">S</span> <span class="free">S</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Set_Theory.map_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_map_axioms <span class="free">S</span> <span class="free">is_open</span> <span class="free">is_open</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> continuous_map_axioms_def open_inter preimage_identity_self<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> gh<span class="main">:</span> <span class="quoted"><span class="quoted">"group_homomorphism <span class="main">(</span>identity <span class="main">(</span><span class="free">𝔉</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">𝔉</span> <span class="skolem">U</span><span class="main">)</span> +<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span>
          𝟬<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> <span class="main">(</span>idim.im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>idim.add_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>idim.zero_im_sheaf <span class="skolem">U</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span>
    <span class="keyword1"><span class="command">using</span></span> that id_is_mor_pr_rngs idim.add_im_sheaf_def idim.im_sheaf_def idim.zero_im_sheaf_def morphism_presheaves_of_rings.is_ring_morphism ring_homomorphism_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"morphism_presheaves_of_rings_axioms <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> idim.im_sheaf idim.im_sheaf_morphisms idim.add_im_sheaf idim.mult_im_sheaf idim.zero_im_sheaf idim.one_im_sheaf <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> morphism_presheaves_of_rings_axioms_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI strip<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="main">(</span>identity <span class="main">(</span><span class="free">𝔉</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">𝔉</span> <span class="skolem">U</span><span class="main">)</span> +<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> ⋅<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> 𝟬<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> 𝟭<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> <span class="main">(</span>idim.im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>idim.add_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>idim.mult_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>idim.zero_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>idim.one_im_sheaf <span class="skolem">U</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> id_is_mor_pr_rngs idim.add_im_sheaf_def idim.im_sheaf_def idim.mult_im_sheaf_def idim.one_im_sheaf_def idim.zero_im_sheaf_def morphism_presheaves_of_rings.is_ring_morphism <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="skolem">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="skolem">U</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>idim.im_sheaf_morphisms <span class="skolem">U</span> <span class="skolem">V</span> <span class="main">∘</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>identity <span class="main">(</span><span class="free">𝔉</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∘</span> <span class="free">ρ</span> <span class="skolem">U</span> <span class="skolem">V</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">is_open</span> <span class="skolem">U</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> idim.im_sheaf_morphisms_def map.map_closed <span class="main"><span class="main">[</span></span><span class="operator">OF</span> is_map_from_is_homomorphism<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> mrs<span class="main">:</span> <span class="quoted"><span class="quoted">"morphism_ringed_spaces_axioms <span class="free">S</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span>
                      <span class="free">S</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> idim.im_sheaf_is_presheaf morphism_presheaves_of_rings_def morphism_ringed_spaces_axioms.intro morphism_sheaves_of_rings.intro presheaf_of_rings_axioms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"morphism_locally_ringed_spaces_axioms <span class="free">S</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span>
                     <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> induced_morphism_with_id_is_local
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> morphism_locally_ringed_spaces_axioms_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">locale</span></span> iso_locally_ringed_spaces <span class="main">=</span> morphism_locally_ringed_spaces <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_homeomorphism<span class="main">:</span> <span class="quoted"><span class="quoted">"homeomorphism <span class="free">X</span> <span class="free">is_open<span class="hidden">⇩</span><sub>X</sub></span> <span class="free">Y</span> <span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
is_iso_of_sheaves<span class="main">:</span> <span class="quoted"><span class="quoted">"iso_sheaves_of_rings <span class="free">Y</span> <span class="free">is_open<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">𝒪<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">ρ<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">d</span> <span class="free">add_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">mult_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">zero_str<span class="hidden">⇩</span><sub>Y</sub></span> <span class="free">one_str<span class="hidden">⇩</span><sub>Y</sub></span>
im_sheaf im_sheaf_morphisms <span class="free">b</span> add_im_sheaf mult_im_sheaf zero_im_sheaf one_im_sheaf
<span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> locally_ringed_space<span class="main">)</span> id_to_iso_locally_ringed_spaces<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"iso_locally_ringed_spaces
            <span class="free">S</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span>
            <span class="free">S</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span>
            <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> morphism_ringed_spaces <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝔉</span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span>
    <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝔉</span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span> <span class="quoted"><span class="quoted">"identity <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> id_to_mor_locally_ringed_spaces morphism_locally_ringed_spaces_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"morphism_locally_ringed_spaces_axioms <span class="free">S</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> id_to_mor_locally_ringed_spaces morphism_locally_ringed_spaces_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"iso_locally_ringed_spaces_axioms <span class="free">S</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> <span class="free">S</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> iso_locally_ringed_spaces_axioms_def iso_sheaves_of_rings_def iso_presheaves_of_rings_def iso_presheaves_of_rings_axioms_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"homeomorphism <span class="free">S</span> <span class="free">is_open</span> <span class="free">S</span> <span class="free">is_open</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> id_is_homeomorphism <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> mor<span class="main">:</span><span class="quoted"><span class="quoted">"morphism_presheaves_of_rings <span class="free">S</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span>
            local.im_sheaf im_sheaf_morphisms <span class="free">b</span> add_im_sheaf mult_im_sheaf zero_im_sheaf one_im_sheaf
            <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_morphism_of_sheaves morphism_sheaves_of_rings.axioms<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"morphism_presheaves_of_rings <span class="free">S</span> <span class="free">is_open</span>
               local.im_sheaf im_sheaf_morphisms <span class="free">b</span> add_im_sheaf mult_im_sheaf zero_im_sheaf one_im_sheaf
               <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> morphism_presheaves_of_rings_def morphism_presheaves_of_rings_axioms_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI strip<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"presheaf_of_rings <span class="free">S</span> <span class="free">is_open</span> local.im_sheaf im_sheaf_morphisms <span class="free">b</span> add_im_sheaf mult_im_sheaf zero_im_sheaf one_im_sheaf"</span></span>
          <span class="keyword1"><span class="command">using</span></span> im_sheaf_is_presheaf <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"presheaf_of_rings <span class="free">S</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mor morphism_presheaves_of_rings_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="skolem">U</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="main">(</span>identity <span class="main">(</span><span class="free">𝔉</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">𝔉</span> <span class="skolem">U</span><span class="main">)</span> +<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> ⋅<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> 𝟬<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> 𝟭<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">𝔉</span> <span class="skolem">U</span><span class="main">)</span> +<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> ⋅<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> 𝟬<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> 𝟭<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> im_sheaf.add_im_sheaf_def im_sheaf.mult_im_sheaf_def im_sheaf_axioms
              local.im_sheaf_def mor morphism_presheaves_of_rings.is_ring_morphism one_im_sheaf_def
              open_preimage_identity zero_im_sheaf_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="main">(</span>identity <span class="main">(</span><span class="free">𝔉</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>local.im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>add_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>mult_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>zero_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>one_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">𝔉</span> <span class="skolem">U</span><span class="main">)</span> +<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> ⋅<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> 𝟬<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> 𝟭<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">is_open</span> <span class="skolem">U</span> ›</span></span> im_sheaf.add_im_sheaf_def im_sheaf_axioms local.im_sheaf_def mult_im_sheaf_def one_im_sheaf_def zero_im_sheaf_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="skolem">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> local.im_sheaf <span class="skolem">U</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ρ</span> <span class="skolem">U</span> <span class="skolem">V</span> <span class="main">∘</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>identity <span class="main">(</span><span class="free">𝔉</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">∘</span> im_sheaf_morphisms <span class="skolem">U</span> <span class="skolem">V</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> map.map_closed <span class="main">[</span><span class="operator">OF</span> is_map_from_is_homomorphism<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">is_open</span> <span class="skolem">U</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> im_sheaf_morphisms_def local.im_sheaf_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ψ</span><span class="main">.</span> morphism_presheaves_of_rings <span class="free">S</span> <span class="free">is_open</span> <span class="main">(</span>im_sheaf.im_sheaf <span class="free">S</span> <span class="free">𝔉</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>im_sheaf.im_sheaf_morphisms <span class="free">S</span> <span class="free">ρ</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="free">b</span>
              <span class="main">(</span>im_sheaf.add_im_sheaf <span class="free">S</span> <span class="free">add_str</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>im_sheaf.mult_im_sheaf <span class="free">S</span> <span class="free">mult_str</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>im_sheaf.zero_im_sheaf <span class="free">S</span> <span class="free">zero_str</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>im_sheaf.one_im_sheaf <span class="free">S</span> <span class="free">one_str</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> <span class="bound">ψ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>im_sheaf.im_sheaf <span class="free">S</span> <span class="free">𝔉</span> <span class="main">(</span>identity <span class="free">S</span><span class="main">)</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span>identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span> <span class="main">∘</span> <span class="bound">ψ</span> <span class="bound">U</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="bound">ψ</span> <span class="bound">U</span> <span class="main">∘</span> identity <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> local.im_sheaf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Scheme">
<div class="head">
<h1>Theory Scheme</h1>
</div>
<pre class="source">
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Authors: Anthony Bordg and Lawrence Paulson,
with some contributions from Wenda Li›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Scheme
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="#Comm_Ring">Comm_Ring</a>"</span>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Misc›</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> Set_Theory.map<span class="main">)</span> set_map_α_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> α_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">S</span> <span class="main">⟹</span> <span class="free">α'</span> <span class="bound">x</span>  <span class="main">=</span> <span class="free">α</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> α_ext<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">α'</span> <span class="main">∈</span> extensional <span class="free">S</span>"</span></span>       
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Set_Theory.map <span class="free">α'</span> <span class="free">S</span> <span class="free">T</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> map_axioms α_eq α_ext
<span class="keyword1"><span class="command">unfolding</span></span> Set_Theory.map_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>extensional_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> monoid_homomorphism<span class="main">)</span> monoid_homomorphism_η_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> η_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">M</span> <span class="main">⟹</span> <span class="free">η'</span> <span class="bound">x</span>  <span class="main">=</span> <span class="free">η</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> η_ext<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">η'</span> <span class="main">∈</span> extensional <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"monoid_homomorphism <span class="free">η'</span> <span class="free">M</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="free">M'</span> <span class="main"><span class="free">(⋅')</span></span> <span class="main"><span class="free">𝟭'</span></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Set_Theory.map <span class="free">η'</span> <span class="free">M</span> <span class="free">M'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> set_map_α_cong η_eq η_ext <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"monoid_homomorphism_axioms <span class="free">η'</span> <span class="free">M</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="main"><span class="free">(⋅')</span></span> <span class="main"><span class="free">𝟭'</span></span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> monoid_homomorphism_axioms_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> η_eq commutes_with_composition commutes_with_unit<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> monoid_homomorphism_def 
    <span class="keyword1"><span class="command">using</span></span> source.monoid_axioms target.monoid_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> group_homomorphism<span class="main">)</span> group_homomorphism_η_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> η_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">G</span> <span class="main">⟹</span> <span class="free">η'</span> <span class="bound">x</span>  <span class="main">=</span> <span class="free">η</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> η_ext<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">η'</span> <span class="main">∈</span> extensional <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"group_homomorphism <span class="free">η'</span> <span class="free">G</span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="free">G'</span> <span class="main"><span class="free">(⋅')</span></span> <span class="main"><span class="free">𝟭'</span></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> η_eq η_ext group_homomorphism_def monoid_homomorphism_η_cong source.group_axioms 
      target.group_axioms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> ring_homomorphism<span class="main">)</span> ring_homomorphism_η_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> η_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">R</span> <span class="main">⟹</span> <span class="free">η'</span> <span class="bound">x</span>  <span class="main">=</span> <span class="free">η</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> η_ext<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">η'</span> <span class="main">∈</span> extensional <span class="free">R</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="free">η'</span> <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="free">R'</span> <span class="main"><span class="free">(+')</span></span> <span class="main"><span class="free">(⋅')</span></span> <span class="main"><span class="free">𝟬'</span></span> <span class="main"><span class="free">𝟭'</span></span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ring_homomorphism_def
  <span class="keyword1"><span class="command">using</span></span> η_eq η_ext additive.group_homomorphism_η_cong multiplicative.monoid_homomorphism_η_cong 
    set_map_α_cong source.ring_axioms target.ring_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> morphism_presheaves_of_rings<span class="main">)</span> morphism_presheaves_of_rings_fam_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> fam_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span> <span class="free">is_open</span> <span class="bound">U</span><span class="main">;</span> <span class="bound">x</span><span class="main">∈</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">fam_morphisms'</span> <span class="bound">U</span> <span class="bound">x</span><span class="main">=</span> <span class="free">fam_morphisms</span> <span class="bound">U</span> <span class="bound">x</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> fam_ext<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">⟹</span> <span class="free">fam_morphisms'</span> <span class="bound">U</span> <span class="main">∈</span> extensional <span class="main">(</span><span class="free">𝔉</span> <span class="bound">U</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"morphism_presheaves_of_rings <span class="free">X</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> <span class="free">𝔉'</span> <span class="free">ρ'</span> <span class="free">b'</span> 
      <span class="free">add_str'</span> <span class="free">mult_str'</span>
      <span class="free">zero_str'</span> <span class="free">one_str'</span> <span class="free">fam_morphisms'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" presheaf_of_rings <span class="free">X</span> <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> source.presheaf_of_rings_axioms <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"presheaf_of_rings <span class="free">X</span> <span class="free">is_open</span> <span class="free">𝔉'</span> <span class="free">ρ'</span> <span class="free">b'</span> <span class="free">add_str'</span> <span class="free">mult_str'</span> <span class="free">zero_str'</span> <span class="free">one_str'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> target.presheaf_of_rings_axioms <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"
    morphism_presheaves_of_rings_axioms <span class="free">is_open</span> <span class="free">𝔉</span> <span class="free">ρ</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> <span class="free">𝔉'</span> <span class="free">ρ'</span> <span class="free">add_str'</span> <span class="free">mult_str'</span>
     <span class="free">zero_str'</span> <span class="free">one_str'</span> <span class="free">fam_morphisms'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="main">(</span><span class="free">fam_morphisms'</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="free">𝔉</span> <span class="skolem">U</span><span class="main">)</span> +<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> ⋅<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> 𝟬<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> 𝟭<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> <span class="main">(</span><span class="free">𝔉'</span> <span class="skolem">U</span><span class="main">)</span> +'<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> ⋅'<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> 𝟬'<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span> 𝟭'<span class="hidden">⇘</span><sub><span class="skolem">U</span></sub><span class="hidden">⇙</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> is_ring_morphism<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">,</span></span><span class="operator">THEN</span> ring_homomorphism.ring_homomorphism_η_cong<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> fam_eq fam_ext 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> that<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ρ'</span> <span class="skolem">U</span> <span class="skolem">V</span> <span class="main">∘</span> <span class="free">fam_morphisms'</span> <span class="skolem">U</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">fam_morphisms'</span> <span class="skolem">V</span> <span class="main">∘</span> <span class="free">ρ</span> <span class="skolem">U</span> <span class="skolem">V</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> 
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">𝔉</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span> <span class="skolem">V</span> <span class="skolem">x</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> calculation comm_diagrams fam_eq fam_morphisms_are_maps map_eq ring_homomorphism_def 
          that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> comm_diagrams is_ring_morphism 
      <span class="keyword1"><span class="command">unfolding</span></span> morphism_presheaves_of_rings_axioms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> morphism_presheaves_of_rings_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Affine Schemes›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Computational affine schemes take the isomorphism with Spec as part of their data,
while in the locale for affine schemes we merely assert the existence of such an isomorphism.›</span></span> 

<span class="keyword1"><span class="command">locale</span></span> affine_scheme <span class="main">=</span> comm_ring <span class="main">+</span>
locally_ringed_space <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span> <span class="main">+</span>
iso_locally_ringed_spaces <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span>
<span class="quoted"><span class="quoted">"<span class="keyword1">Spec</span>"</span></span> <span class="quoted">is_zariski_open</span> <span class="quoted">sheaf_spec</span> <span class="quoted">sheaf_spec_morphisms</span> <span class="quoted">𝒪b</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">U</span><span class="main">.</span> add_sheaf_spec <span class="bound">U</span>"</span></span>
<span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">U</span><span class="main">.</span> mult_sheaf_spec <span class="bound">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">U</span><span class="main">.</span> zero_sheaf_spec <span class="bound">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">U</span><span class="main">.</span> one_sheaf_spec <span class="bound">U</span>"</span></span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span></span>
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">X</span> <span class="free">is_open</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> <span class="free">f</span> <span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Schemes›</span></span>

<span class="comment1">(* def. 0.47 *)</span>
<span class="keyword1"><span class="command">locale</span></span> scheme <span class="main">=</span> comm_ring <span class="main">+</span> 
locally_ringed_space <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span> 
<span class="keyword2"><span class="keyword">for</span></span> <span class="free">X</span> <span class="free">is_open</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> are_affine_schemes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">U</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="bound">U</span> <span class="main">∧</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">∧</span> 
<span class="main">(</span><span class="main">∃</span><span class="bound">f</span> <span class="bound">φ<span class="hidden">⇩</span><sub>f</sub></span><span class="main">.</span> affine_scheme  <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="bound">U</span> <span class="main">(</span>ind_topology.ind_is_open <span class="free">X</span> <span class="free">is_open</span> <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>ind_sheaf.ind_sheaf <span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span> <span class="bound">U</span><span class="main">)</span> 
<span class="main">(</span>ind_sheaf.ind_ring_morphisms <span class="free">ρ</span> <span class="bound">U</span><span class="main">)</span> <span class="free">b</span> <span class="main">(</span>ind_sheaf.ind_add_str <span class="free">add_str</span> <span class="bound">U</span><span class="main">)</span>
<span class="main">(</span>ind_sheaf.ind_mult_str <span class="free">mult_str</span> <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>ind_sheaf.ind_zero_str <span class="free">zero_str</span> <span class="bound">U</span><span class="main">)</span>
<span class="main">(</span>ind_sheaf.ind_one_str <span class="free">one_str</span> <span class="bound">U</span><span class="main">)</span> <span class="bound">f</span> <span class="bound">φ<span class="hidden">⇩</span><sub>f</sub></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> iso_stalks <span class="main">=</span> 
  stk1<span class="main">:</span>stalk <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝔉1</span></span> <span class="quoted"><span class="free">ρ1</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str1</span></span> <span class="quoted"><span class="free">mult_str1</span></span> <span class="quoted"><span class="free">zero_str1</span></span> <span class="quoted"><span class="free">one_str1</span></span> <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">x</span></span> <span class="main">+</span>
  stk2<span class="main">:</span>stalk <span class="quoted"><span class="free">S</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝔉2</span></span> <span class="quoted"><span class="free">ρ2</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str2</span></span> <span class="quoted"><span class="free">mult_str2</span></span> <span class="quoted"><span class="free">zero_str2</span></span> <span class="quoted"><span class="free">one_str2</span></span> <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">x</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">S</span> <span class="free">is_open</span> <span class="free">𝔉1</span> <span class="free">ρ1</span> <span class="free">b</span> <span class="free">add_str1</span> <span class="free">mult_str1</span> <span class="free">zero_str1</span> <span class="free">one_str1</span> <span class="free">I</span> <span class="free">x</span> 
        <span class="free">𝔉2</span> <span class="free">ρ2</span> <span class="free">add_str2</span> <span class="free">mult_str2</span> <span class="free">zero_str2</span> <span class="free">one_str2</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> 
    stalk_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">U</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">𝔉1</span> <span class="bound">U</span> <span class="main">=</span> <span class="free">𝔉2</span> <span class="bound">U</span> <span class="main">∧</span> <span class="free">add_str1</span> <span class="bound">U</span> <span class="main">=</span> <span class="free">add_str2</span> <span class="bound">U</span> <span class="main">∧</span> <span class="free">mult_str1</span> <span class="bound">U</span> <span class="main">=</span> <span class="free">mult_str2</span> <span class="bound">U</span> 
            <span class="main">∧</span> <span class="free">zero_str1</span> <span class="bound">U</span> <span class="main">=</span> <span class="free">zero_str2</span> <span class="bound">U</span> <span class="main">∧</span> <span class="free">one_str1</span> <span class="bound">U</span> <span class="main">=</span> <span class="free">one_str2</span> <span class="bound">U</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> stalkρ_eq<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="bound">U</span><span class="main">∈</span><span class="free">I</span> <span class="main">∧</span> <span class="bound">V</span> <span class="main">∈</span><span class="free">I</span> <span class="main">⟶</span> <span class="free">ρ1</span> <span class="bound">U</span> <span class="bound">V</span> <span class="main">=</span> <span class="free">ρ2</span> <span class="bound">U</span> <span class="bound">V</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">∈</span> <span class="free">I</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> has_ring_isomorphism<span class="main">:</span><span class="quoted"><span class="quoted">"ring_isomorphism <span class="main">(</span>identity stk1.carrier_stalk<span class="main">)</span> stk1.carrier_stalk 
          stk1.add_stalk stk1.mult_stalk <span class="main">(</span>stk1.zero_stalk <span class="free">U</span><span class="main">)</span> <span class="main">(</span>stk1.one_stalk <span class="free">U</span><span class="main">)</span>
          stk2.carrier_stalk stk2.add_stalk stk2.mult_stalk <span class="main">(</span>stk2.zero_stalk <span class="free">U</span><span class="main">)</span> <span class="main">(</span>stk2.one_stalk <span class="free">U</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> carrier_stalk_eq<span class="main">:</span><span class="quoted"><span class="quoted">"stk1.carrier_stalk <span class="main">=</span> stk2.carrier_stalk"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> class_of_eq<span class="main">:</span><span class="quoted"><span class="quoted">"stk1.class_of <span class="main">=</span> stk2.class_of"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stk1.index assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">interpret</span></span> ring1<span class="main">:</span>ring <span class="quoted">stk1.carrier_stalk</span> <span class="quoted">stk1.add_stalk</span> <span class="quoted">stk1.mult_stalk</span> <span class="quoted"><span class="quoted">"stk1.zero_stalk <span class="free">U</span>"</span></span> 
                  <span class="quoted"><span class="quoted">"stk1.one_stalk <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stk1.stalk_is_ring<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">is_open</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">U</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> ring2<span class="main">:</span>ring <span class="quoted">stk2.carrier_stalk</span> <span class="quoted">stk2.add_stalk</span> <span class="quoted">stk2.mult_stalk</span> <span class="quoted"><span class="quoted">"stk2.zero_stalk <span class="free">U</span>"</span></span>
                  <span class="quoted"><span class="quoted">"stk2.one_stalk <span class="free">U</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stk2.stalk_is_ring<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">is_open</span> <span class="free">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> <span class="free">U</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">interpret</span></span> e1<span class="main">:</span>equivalence <span class="quoted"><span class="quoted">"Sigma <span class="free">I</span> <span class="free">𝔉1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> stk1.rel <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stk1.rel_is_equivalence <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">interpret</span></span> e2<span class="main">:</span>equivalence <span class="quoted"><span class="quoted">"Sigma <span class="free">I</span> <span class="free">𝔉2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> stk2.rel <span class="bound">x</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> stk2.rel_is_equivalence <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> Sigma_eq<span class="main">:</span><span class="quoted"><span class="quoted">"Sigma <span class="free">I</span> <span class="free">𝔉1</span>  <span class="main">=</span>  Sigma <span class="free">I</span> <span class="free">𝔉2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Sigma_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">I</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> stalk_eq<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> this<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔉1</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">𝔉2</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stk1.rel <span class="skolem">xx</span> <span class="skolem">yy</span> <span class="main">⟷</span> stk2.rel <span class="skolem">xx</span> <span class="skolem">yy</span>"</span></span> 
                  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xx</span><span class="main">∈</span>Sigma <span class="free">I</span> <span class="free">𝔉1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">yy</span><span class="main">∈</span>Sigma <span class="free">I</span> <span class="free">𝔉2</span>"</span></span>
                  <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">xx</span> <span class="skolem">yy</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> stk1.rel_def stk2.rel_def                
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> stalkρ_eq stalk_eq<span class="main">)</span>          
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> Class_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"e1.Class <span class="main">=</span> e2.Class"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> e1.Class_def e2.Class_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>ext<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> class_of_eq<span class="main">:</span><span class="quoted"><span class="quoted">"stk1.class_of <span class="main">=</span> stk2.class_of"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> stk1.class_of_def stk2.class_of_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"stk1.carrier_stalk <span class="main">=</span> stk2.carrier_stalk"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Class_eq Sigma_eq e1.natural.surjective e2.natural.surjective 
      stk1.carrier_direct_lim_def stk1.carrier_stalk_def stk2.carrier_direct_lim_def 
      stk2.carrier_stalk_def stk2.neighborhoods_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?id</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"identity stk1.carrier_stalk"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring_isomorphism <span class="main">(</span>identity stk1.carrier_stalk<span class="main">)</span> stk1.carrier_stalk 
          stk1.add_stalk stk1.mult_stalk <span class="main">(</span>stk1.zero_stalk <span class="free">U</span><span class="main">)</span> <span class="main">(</span>stk1.one_stalk <span class="free">U</span><span class="main">)</span>
          stk2.carrier_stalk stk2.add_stalk stk2.mult_stalk <span class="main">(</span>stk2.zero_stalk <span class="free">U</span><span class="main">)</span> <span class="main">(</span>stk2.one_stalk <span class="free">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?id</span> <span class="main">(</span>stk1.one_stalk <span class="free">U</span><span class="main">)</span> <span class="main">=</span> stk2.one_stalk <span class="free">U</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stk1.one_stalk <span class="free">U</span> <span class="main">∈</span> stk1.carrier_stalk"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?id</span> <span class="main">(</span>stk1.one_stalk <span class="free">U</span><span class="main">)</span> <span class="main">=</span> stk1.one_stalk <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> stk2.one_stalk <span class="free">U</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> stk1.one_stalk_def stk2.one_stalk_def class_of_eq
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms stalk_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?id</span> <span class="main">(</span>stk1.zero_stalk <span class="free">U</span><span class="main">)</span> <span class="main">=</span> stk2.zero_stalk <span class="free">U</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stk1.zero_stalk <span class="free">U</span> <span class="main">∈</span> stk1.carrier_stalk"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?id</span> <span class="main">(</span>stk1.zero_stalk <span class="free">U</span><span class="main">)</span> <span class="main">=</span> stk1.zero_stalk <span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> stk2.zero_stalk <span class="free">U</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> stk1.zero_stalk_def stk2.zero_stalk_def class_of_eq
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms stalk_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

   
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?id</span> <span class="main">(</span>stk1.add_stalk <span class="skolem">X'</span> <span class="skolem">Y'</span><span class="main">)</span> <span class="main">=</span> stk2.add_stalk <span class="main">(</span><span class="var">?id</span> <span class="skolem">X'</span><span class="main">)</span> <span class="main">(</span><span class="var">?id</span> <span class="skolem">Y'</span><span class="main">)</span>"</span></span> 
      <span class="quoted"><span class="quoted">"<span class="var">?id</span> <span class="main">(</span>stk1.mult_stalk <span class="skolem">X'</span> <span class="skolem">Y'</span><span class="main">)</span> <span class="main">=</span> stk2.mult_stalk <span class="main">(</span><span class="var">?id</span> <span class="skolem">X'</span><span class="main">)</span> <span class="main">(</span><span class="var">?id</span> <span class="skolem">Y'</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X'</span> <span class="main">∈</span> stk1.carrier_stalk"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y'</span> <span class="main">∈</span> stk1.carrier_stalk"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">X'</span> <span class="skolem">Y'</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="skolem">X'</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="skolem">Y'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span><span class="skolem">X'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>Sigma <span class="free">I</span> <span class="free">𝔉1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x_alt<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">X'</span> <span class="main">=</span> stk1.class_of <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> stk1.rel_carrier_Eps_in that<span class="main">(</span>1<span class="main">)</span> stk1.carrier_stalk_def stk2.neighborhoods_eq x_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="skolem">Y'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span>Sigma <span class="free">I</span> <span class="free">𝔉1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y_alt<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">Y'</span> <span class="main">=</span> stk1.class_of <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> stk1.rel_carrier_Eps_in that<span class="main">(</span>2<span class="main">)</span> stk1.carrier_stalk_def stk2.neighborhoods_eq y_def 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">x</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">y</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x<span class="main">(</span>2<span class="main">)</span> y<span class="main">(</span>2<span class="main">)</span> stk1.index 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mem_Sigma_iff prod.collapse stk1.open_imp_subset stk2.subset_of_opens<span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span><span class="main">∈</span><span class="free">I</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊆</span> fst <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊆</span> fst <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> stk1.has_lower_bound x<span class="main">(</span>2<span class="main">)</span> y<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">⊆</span> <span class="free">S</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stk1.open_imp_subset stk1.subset_of_opens w<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stk1.add_stalk <span class="skolem">X'</span> <span class="skolem">Y'</span> <span class="main">=</span> stk1.class_of <span class="skolem">w</span> <span class="main">(</span><span class="free">add_str1</span> <span class="skolem">w</span> <span class="main">(</span><span class="free">ρ1</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>
                                         <span class="main">(</span><span class="free">ρ1</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> x_alt y_alt stk1.add_stalk_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> stk1.add_rel_class_of<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> W<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">w</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> x y w <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> stk2.class_of <span class="skolem">w</span> <span class="main">(</span><span class="free">add_str2</span> <span class="skolem">w</span> <span class="main">(</span><span class="free">ρ2</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ2</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> class_of_eq stalkρ_eq stalk_eq w<span class="main">(</span>1<span class="main">)</span> x<span class="main">(</span>2<span class="main">)</span> y<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> stk2.add_stalk <span class="skolem">X'</span> <span class="skolem">Y'</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> stk2.add_stalk_def x_alt y_alt class_of_eq   
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> stk2.add_rel_class_of<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> W<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">w</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> x y w <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sigma_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stk1.add_stalk <span class="skolem">X'</span> <span class="skolem">Y'</span> <span class="main">=</span> stk2.add_stalk <span class="skolem">X'</span> <span class="skolem">Y'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stk1.add_stalk <span class="skolem">X'</span> <span class="skolem">Y'</span> <span class="main">∈</span> stk1.carrier_stalk"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?id</span> <span class="main">(</span>stk1.add_stalk <span class="skolem">X'</span> <span class="skolem">Y'</span><span class="main">)</span> <span class="main">=</span> stk2.add_stalk <span class="main">(</span><span class="var">?id</span> <span class="skolem">X'</span><span class="main">)</span> <span class="main">(</span><span class="var">?id</span> <span class="skolem">Y'</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stk1.mult_stalk <span class="skolem">X'</span> <span class="skolem">Y'</span> <span class="main">=</span> stk1.class_of <span class="skolem">w</span> <span class="main">(</span><span class="free">mult_str1</span> <span class="skolem">w</span> <span class="main">(</span><span class="free">ρ1</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>
                                         <span class="main">(</span><span class="free">ρ1</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> x_alt y_alt stk1.mult_stalk_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> stk1.mult_rel_class_of<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> W<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">w</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> x y w <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> stk2.class_of <span class="skolem">w</span> <span class="main">(</span><span class="free">mult_str2</span> <span class="skolem">w</span> <span class="main">(</span><span class="free">ρ2</span> <span class="main">(</span>fst <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ρ2</span> <span class="main">(</span>fst <span class="skolem">y</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">(</span>snd <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> class_of_eq stalkρ_eq stalk_eq w<span class="main">(</span>1<span class="main">)</span> x<span class="main">(</span>2<span class="main">)</span> y<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> stk2.mult_stalk <span class="skolem">X'</span> <span class="skolem">Y'</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> stk2.mult_stalk_def x_alt y_alt class_of_eq   
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> stk2.mult_rel_class_of<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> W<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">w</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> x y w <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sigma_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stk1.mult_stalk <span class="skolem">X'</span> <span class="skolem">Y'</span> <span class="main">=</span> stk2.mult_stalk <span class="skolem">X'</span> <span class="skolem">Y'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stk1.mult_stalk <span class="skolem">X'</span> <span class="skolem">Y'</span> <span class="main">∈</span> stk1.carrier_stalk"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> that<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?id</span> <span class="main">(</span>stk1.mult_stalk <span class="skolem">X'</span> <span class="skolem">Y'</span><span class="main">)</span> <span class="main">=</span> stk2.mult_stalk <span class="main">(</span><span class="var">?id</span> <span class="skolem">X'</span><span class="main">)</span> <span class="main">(</span><span class="var">?id</span> <span class="skolem">Y'</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹stk1.carrier_stalk <span class="main">=</span> stk2.carrier_stalk›</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?id</span> <span class="main">∈</span> stk1.carrier_stalk <span class="keyword1">→<span class="hidden">⇩</span><sub>E</sub></span> stk2.carrier_stalk"</span></span>
      <span class="quoted"><span class="quoted">"bij_betw <span class="var">?id</span> stk1.carrier_stalk stk2.carrier_stalk"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> id_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> affine_scheme<span class="main">)</span> affine_scheme_is_scheme<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"scheme <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="free">X</span> <span class="free">is_open</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span> <span class="free">ρ</span> <span class="free">b</span> <span class="free">add_str</span> <span class="free">mult_str</span> <span class="free">zero_str</span> <span class="free">one_str</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> ind_sheaf <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span> <span class="quoted"><span class="free">X</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ind_sheaf_axioms_def ind_sheaf_def open_space ringed_space_axioms ringed_space_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ind_is_open<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ind_topology.ind_is_open <span class="free">X</span> <span class="free">is_open</span> <span class="free">X</span> <span class="main">=</span> <span class="free">is_open</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> ind_is_open_iff_open open_imp_subset<span class="main">)</span>

  <span class="keyword1"><span class="command">interpret</span></span> sheaf_of_rings <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted">local.ind_sheaf</span> <span class="quoted">ind_ring_morphisms</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted">ind_add_str</span> 
    <span class="quoted">ind_mult_str</span> <span class="quoted">ind_zero_str</span> <span class="quoted">ind_one_str</span>
    <span class="keyword1"><span class="command">using</span></span> ind_sheaf_is_sheaf <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

  <span class="keyword1"><span class="command">have</span></span> eq_𝒪<span class="hidden">⇩</span><sub>X</sub><span class="main">:</span> <span class="quoted"><span class="quoted">"local.ind_sheaf <span class="skolem">U</span> <span class="main">=</span> <span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span>
    <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_absorb2 Int_commute local.ind_sheaf_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eq_ρ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">V</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">⟹</span> ind_ring_morphisms <span class="bound">U</span> <span class="bound">V</span> <span class="main">=</span> <span class="free">ρ</span> <span class="bound">U</span> <span class="bound">V</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ind_ring_morphisms_def inf.absorb_iff2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eq_add_str<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">⟹</span> ind_add_str <span class="bound">U</span> <span class="main">=</span> <span class="free">add_str</span> <span class="bound">U</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ind_add_str_def inf.absorb_iff2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eq_mult_str <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">⟹</span> ind_mult_str <span class="bound">U</span> <span class="main">=</span> <span class="free">mult_str</span> <span class="bound">U</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ind_mult_str_def inf.absorb_iff2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eq_zero_str <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">⟹</span> ind_zero_str <span class="bound">U</span> <span class="main">=</span> <span class="free">zero_str</span> <span class="bound">U</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_absorb2 Int_commute ind_zero_str_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> eq_one_str <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">⟹</span> ind_one_str <span class="bound">U</span> <span class="main">=</span> <span class="free">one_str</span> <span class="bound">U</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ind_one_str_def inf.absorb_iff2<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"affine_scheme <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="free">X</span> <span class="free">is_open</span> local.ind_sheaf ind_ring_morphisms <span class="free">b</span>
          ind_add_str ind_mult_str ind_zero_str ind_one_str <span class="free">f</span> <span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"locally_ringed_space <span class="free">X</span> <span class="free">is_open</span> local.ind_sheaf ind_ring_morphisms <span class="free">b</span> ind_add_str ind_mult_str ind_zero_str
     ind_one_str"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"stalk.is_local <span class="free">is_open</span> local.ind_sheaf ind_ring_morphisms ind_add_str
                ind_mult_str ind_zero_str ind_one_str
                <span class="main">(</span>neighborhoods <span class="skolem">u</span><span class="main">)</span> <span class="skolem">u</span> <span class="skolem">U</span>"</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> opeU<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span> <span class="skolem">U</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> UX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opeU open_imp_subset<span class="main">)</span>

        <span class="keyword1"><span class="command">interpret</span></span> stX<span class="main">:</span> stalk <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted">local.ind_sheaf</span> <span class="quoted">ind_ring_morphisms</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted">ind_add_str</span> 
          <span class="quoted">ind_mult_str</span> <span class="quoted">ind_zero_str</span> <span class="quoted">ind_one_str</span> <span class="quoted"><span class="quoted">"neighborhoods <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
          <span class="keyword1"><span class="command">unfolding</span></span> neighborhoods_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">U</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span><span class="main">∈</span><span class="skolem">U</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">interpret</span></span> stalk <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span> <span class="quoted"><span class="quoted">"neighborhoods <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> direct_lim_def ind_sheaf.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ind_sheaf_axioms stX.stalk_axioms stalk_def<span class="main">)</span>
       
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"local_ring carrier_stalk add_stalk mult_stalk <span class="main">(</span>zero_stalk <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>one_stalk <span class="skolem">U</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> is_local_def opeU stalks_are_local that<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ring_isomorphism <span class="main">(</span>identity stX.carrier_stalk<span class="main">)</span>
            stX.carrier_stalk stX.add_stalk stX.mult_stalk <span class="main">(</span>stX.zero_stalk <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>stX.one_stalk <span class="skolem">U</span><span class="main">)</span>
            carrier_stalk add_stalk mult_stalk <span class="main">(</span>zero_stalk <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>one_stalk <span class="skolem">U</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">interpret</span></span> iso_stalks <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted">local.ind_sheaf</span> <span class="quoted">ind_ring_morphisms</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted">ind_add_str</span> 
              <span class="quoted">ind_mult_str</span> <span class="quoted">ind_zero_str</span> <span class="quoted">ind_one_str</span> <span class="quoted"><span class="quoted">"neighborhoods <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">ρ</span></span>  <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> 
              <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_𝒪<span class="hidden">⇩</span><sub>X</sub> eq_add_str eq_mult_str eq_one_str eq_zero_str open_imp_subset 
                  subset_of_opens<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> eq_ρ open_imp_subset subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">U</span> <span class="main">∈</span> neighborhoods <span class="skolem">u</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> opeU stX.index that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> has_ring_isomorphism<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> 
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> stX.is_local_def
          <span class="keyword1"><span class="command">using</span></span> isomorphic_to_local_is_local <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> locally_ringed_space_axioms_def locally_ringed_space_def
            ringed_space_def sheaf_of_rings_axioms<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"iso_locally_ringed_spaces <span class="free">X</span> <span class="free">is_open</span> local.ind_sheaf ind_ring_morphisms <span class="free">b</span> 
        ind_add_str ind_mult_str ind_zero_str ind_one_str <span class="keyword1">Spec</span> is_zariski_open sheaf_spec 
        sheaf_spec_morphisms 𝒪b add_sheaf_spec mult_sheaf_spec zero_sheaf_spec one_sheaf_spec <span class="free">f</span> <span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
      <span class="keyword1"><span class="command">interpret</span></span> im_sheafXS<span class="main">:</span> Comm_Ring.im_sheaf <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted">local.ind_sheaf</span>
              <span class="quoted">ind_ring_morphisms</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted">ind_add_str</span> <span class="quoted">ind_mult_str</span> <span class="quoted">ind_zero_str</span> <span class="quoted">ind_one_str</span> <span class="quoted"><span class="keyword1">Spec</span></span> 
              <span class="quoted">is_zariski_open</span> <span class="quoted"><span class="free">f</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_locales</span>
      <span class="keyword1"><span class="command">interpret</span></span> iso_sheaves_of_rings <span class="quoted"><span class="keyword1">Spec</span></span> <span class="quoted">is_zariski_open</span> <span class="quoted">sheaf_spec</span> <span class="quoted">sheaf_spec_morphisms</span> <span class="quoted">𝒪b</span> 
          <span class="quoted">add_sheaf_spec</span> <span class="quoted">mult_sheaf_spec</span> <span class="quoted">zero_sheaf_spec</span> <span class="quoted">one_sheaf_spec</span> <span class="quoted">local.im_sheaf</span> 
          <span class="quoted">im_sheaf_morphisms</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted">add_im_sheaf</span> <span class="quoted">mult_im_sheaf</span> <span class="quoted">zero_im_sheaf</span> <span class="quoted">one_im_sheaf</span> <span class="quoted"><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span></span>
        <span class="keyword1"><span class="command">using</span></span> is_iso_of_sheaves <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">have</span></span> ring_homoU<span class="main">:</span><span class="quoted"><span class="quoted">"ring_homomorphism <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">𝒪</span> <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>mult_sheaf_spec <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>zero_sheaf_spec <span class="skolem">U</span><span class="main">)</span>
          <span class="main">(</span>one_sheaf_spec <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>im_sheafXS.im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>im_sheafXS.add_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>im_sheafXS.mult_im_sheaf <span class="skolem">U</span><span class="main">)</span>
          <span class="main">(</span>im_sheafXS.zero_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>im_sheafXS.one_im_sheaf <span class="skolem">U</span><span class="main">)</span>"</span></span> 
        <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">U</span> "</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span> 
        <span class="keyword1"><span class="command">using</span></span> mor.is_ring_morphism 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_commute Int_left_absorb add_im_sheaf_def im_sheafXS.add_im_sheaf_def 
            im_sheafXS.im_sheaf_def im_sheafXS.mult_im_sheaf_def im_sheafXS.one_im_sheaf_def 
            im_sheafXS.zero_im_sheaf_def ind_add_str_def ind_mult_str_def ind_one_str_def 
            ind_zero_str_def local.im_sheaf_def local.ind_sheaf_def 
            mult_im_sheaf_def one_im_sheaf_def that zero_im_sheaf_def<span class="main">)</span>

      <span class="keyword1"><span class="command">note</span></span> ring_homoU
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> is_zariski_open <span class="bound">U</span> <span class="main">⟶</span>
       is_zariski_open <span class="bound">V</span> <span class="main">⟶</span>
       <span class="bound">V</span> <span class="main">⊆</span> <span class="bound">U</span> <span class="main">⟶</span>
       <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="keyword1">𝒪</span> <span class="bound">U</span> <span class="main">⟶</span> <span class="main">(</span>im_sheafXS.im_sheaf_morphisms <span class="bound">U</span> <span class="bound">V</span> <span class="main">∘</span> <span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="bound">U</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="bound">V</span> <span class="main">∘</span> sheaf_spec_morphisms <span class="bound">U</span> <span class="bound">V</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eq_ρ im_sheafXS.im_sheaf_morphisms_def im_sheaf_morphisms_def mor.comm_diagrams <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">interpret</span></span> morphism_ringed_spaces <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted">local.ind_sheaf</span> <span class="quoted">ind_ring_morphisms</span> <span class="quoted"><span class="free">b</span></span> 
          <span class="quoted">ind_add_str</span> <span class="quoted">ind_mult_str</span> <span class="quoted">ind_zero_str</span> <span class="quoted">ind_one_str</span> <span class="quoted"><span class="keyword1">Spec</span></span> <span class="quoted">is_zariski_open</span> <span class="quoted">sheaf_spec</span>
          <span class="quoted">sheaf_spec_morphisms</span> <span class="quoted">𝒪b</span> <span class="quoted">add_sheaf_spec</span> <span class="quoted">mult_sheaf_spec</span>
          <span class="quoted">zero_sheaf_spec</span> <span class="quoted">one_sheaf_spec</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_locales</span>
        <span class="keyword1"><span class="command">unfolding</span></span> morphism_ringed_spaces_axioms_def morphism_ringed_spaces_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_locales</span>
        <span class="keyword1"><span class="command">unfolding</span></span> morphism_presheaves_of_rings_axioms_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"iso_locally_ringed_spaces <span class="free">X</span> <span class="free">is_open</span> local.ind_sheaf ind_ring_morphisms <span class="free">b</span> 
            ind_add_str ind_mult_str ind_zero_str ind_one_str 
            <span class="keyword1">Spec</span> is_zariski_open sheaf_spec sheaf_spec_morphisms
            𝒪b add_sheaf_spec mult_sheaf_spec zero_sheaf_spec one_sheaf_spec <span class="free">f</span> <span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_locales</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>  
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ind_mor_btw_stalks.is_local <span class="free">X</span> <span class="free">is_open</span> local.ind_sheaf ind_ring_morphisms ind_add_str 
                ind_mult_str ind_zero_str ind_one_str is_zariski_open sheaf_spec sheaf_spec_morphisms 
                add_sheaf_spec mult_sheaf_spec zero_sheaf_spec one_sheaf_spec <span class="free">f</span> <span class="skolem">x</span> <span class="skolem">U</span>
               φ<span class="hidden">⇘</span><sub><span class="free">X</span> <span class="free">is_open</span> local.ind_sheaf ind_ring_morphisms is_zariski_open sheaf_spec 
                        sheaf_spec_morphisms <span class="free">f</span> <span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">x</span></sub><span class="hidden">⇙</span>"</span></span>
            <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">U</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">interpret</span></span> ind_btw<span class="main">:</span>ind_mor_btw_stalks <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted">local.ind_sheaf</span> <span class="quoted">ind_ring_morphisms</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted">ind_add_str</span>
                <span class="quoted">ind_mult_str</span> <span class="quoted">ind_zero_str</span> <span class="quoted">ind_one_str</span> <span class="quoted"><span class="keyword1">Spec</span></span> <span class="quoted">is_zariski_open</span> <span class="quoted">sheaf_spec</span> 
                <span class="quoted">sheaf_spec_morphisms</span> <span class="quoted">𝒪b</span> <span class="quoted">add_sheaf_spec</span> <span class="quoted">mult_sheaf_spec</span>
                <span class="quoted">zero_sheaf_spec</span> <span class="quoted">one_sheaf_spec</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span></span> <span class="quoted"><span class="skolem">x</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_locales</span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ind_mor_btw_stalks_axioms.intro<span class="main">)</span>

            <span class="keyword1"><span class="command">interpret</span></span> ind_mor_btw_stalks <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span>
                <span class="quoted"><span class="keyword1">Spec</span></span> <span class="quoted">is_zariski_open</span> <span class="quoted">sheaf_spec</span> 
                <span class="quoted">sheaf_spec_morphisms</span> <span class="quoted">𝒪b</span> <span class="quoted">add_sheaf_spec</span> <span class="quoted">mult_sheaf_spec</span>
                <span class="quoted">zero_sheaf_spec</span> <span class="quoted">one_sheaf_spec</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span></span> <span class="quoted"><span class="skolem">x</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_locales</span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ind_mor_btw_stalks_axioms.intro<span class="main">)</span>

            <span class="keyword1"><span class="command">interpret</span></span> stk1<span class="main">:</span>stalk <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">ρ</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span> 
                              <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">U</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">interpret</span></span> stk2<span class="main">:</span>stalk <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted">local.ind_sheaf</span> <span class="quoted">ind_ring_morphisms</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted">ind_add_str</span>
                <span class="quoted">ind_mult_str</span> <span class="quoted">ind_zero_str</span> <span class="quoted">ind_one_str</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">U</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">interpret</span></span> stk3<span class="main">:</span>stalk <span class="quoted"><span class="keyword1">Spec</span></span> <span class="quoted">is_zariski_open</span> <span class="quoted">sheaf_spec</span> 
                <span class="quoted">sheaf_spec_morphisms</span> <span class="quoted">𝒪b</span> <span class="quoted">add_sheaf_spec</span> <span class="quoted">mult_sheaf_spec</span>
                <span class="quoted">zero_sheaf_spec</span> <span class="quoted">one_sheaf_spec</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">U</span><span class="main">.</span> is_zariski_open <span class="bound">U</span> <span class="main">∧</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">U</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stk2.is_elem<span class="main">)</span>
            <span class="keyword1"><span class="command">interpret</span></span> ring31<span class="main">:</span>ring_homomorphism <span class="quoted">induced_morphism</span> <span class="quoted">stk3.carrier_stalk</span> <span class="quoted">stk3.add_stalk</span> 
              <span class="quoted">stk3.mult_stalk</span> <span class="quoted"><span class="quoted">"stk3.zero_stalk <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"stk3.one_stalk <span class="skolem">U</span>"</span></span> <span class="quoted">stk1.carrier_stalk</span> 
              <span class="quoted">stk1.add_stalk</span> <span class="quoted">stk1.mult_stalk</span> <span class="quoted"><span class="quoted">"stk1.zero_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"stk1.one_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> ring_homomorphism_induced_morphism<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹is_zariski_open <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command">interpret</span></span> ring32<span class="main">:</span>ring_homomorphism <span class="quoted">ind_btw.induced_morphism</span> <span class="quoted">stk3.carrier_stalk</span> 
              <span class="quoted">stk3.add_stalk</span> 
              <span class="quoted">stk3.mult_stalk</span> <span class="quoted"><span class="quoted">"stk3.zero_stalk <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"stk3.one_stalk <span class="skolem">U</span>"</span></span> <span class="quoted">stk2.carrier_stalk</span> 
              <span class="quoted">stk2.add_stalk</span> <span class="quoted">stk2.mult_stalk</span> <span class="quoted"><span class="quoted">"stk2.zero_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"stk2.one_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> ind_btw.ring_homomorphism_induced_morphism<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹is_zariski_open <span class="skolem">U</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">U</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

            <span class="keyword1"><span class="command">interpret</span></span> iso<span class="main">:</span>iso_stalks <span class="quoted"><span class="free">X</span></span> <span class="quoted"><span class="free">is_open</span></span> <span class="quoted"><span class="free">𝒪<span class="hidden">⇩</span><sub>X</sub></span></span> <span class="quoted"><span class="free">ρ</span></span>  <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">add_str</span></span> <span class="quoted"><span class="free">mult_str</span></span> <span class="quoted"><span class="free">zero_str</span></span> <span class="quoted"><span class="free">one_str</span></span>   
                      <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">U</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted">local.ind_sheaf</span> <span class="quoted">ind_ring_morphisms</span>   
                      <span class="quoted">ind_add_str</span> 
                      <span class="quoted">ind_mult_str</span> <span class="quoted">ind_zero_str</span> <span class="quoted">ind_one_str</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_𝒪<span class="hidden">⇩</span><sub>X</sub> eq_add_str eq_mult_str eq_one_str eq_zero_str open_imp_subset 
                    stk2.subset_of_opens<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
                <span class="keyword1"><span class="command">using</span></span> eq_ρ open_imp_subset stk2.subset_of_opens <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">have</span></span> fU<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">U</span><span class="main">.</span> <span class="free">is_open</span> <span class="bound">U</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="bound">U</span><span class="main">}</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> is_continuous<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹is_zariski_open <span class="skolem">U</span>›</span></span><span class="main">]</span> 
              <span class="keyword1"><span class="command">using</span></span> stk2.is_elem that<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

            <span class="keyword1"><span class="command">have</span></span> is_local<span class="main">:</span><span class="quoted"><span class="quoted">"is_local <span class="skolem">U</span> induced_morphism"</span></span>
              <span class="keyword1"><span class="command">using</span></span> are_local_morphisms<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">U</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>           
            <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> is_local_def<span class="main">]</span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"local_ring_morphism <span class="main">(</span>identity stk2.carrier_stalk <span class="main">∘</span> induced_morphism <span class="main">↓</span> stk3.carrier_stalk<span class="main">)</span> 
                    stk3.carrier_stalk stk3.add_stalk stk3.mult_stalk <span class="main">(</span>stk3.zero_stalk <span class="skolem">U</span><span class="main">)</span> 
                    <span class="main">(</span>stk3.one_stalk <span class="skolem">U</span><span class="main">)</span> stk2.carrier_stalk stk2.add_stalk stk2.mult_stalk 
                     <span class="main">(</span>stk2.zero_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>stk2.one_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> comp_of_local_ring_morphisms<span class="main">)</span>
              <span class="keyword1"><span class="command">interpret</span></span> local_ring_morphism <span class="quoted">induced_morphism</span> <span class="quoted">stk3.carrier_stalk</span> <span class="quoted">stk3.add_stalk</span> 
                <span class="quoted">stk3.mult_stalk</span> <span class="quoted"><span class="quoted">"stk3.zero_stalk <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"stk3.one_stalk <span class="skolem">U</span>"</span></span> <span class="quoted">stk1.carrier_stalk</span> 
                <span class="quoted">stk1.add_stalk</span> <span class="quoted">stk1.mult_stalk</span> <span class="quoted"><span class="quoted">"stk1.zero_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
                <span class="quoted"><span class="quoted">"stk1.one_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> is_local<span class="main">[</span><span class="operator">unfolded</span> is_local_def<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>

              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"local_ring stk1.carrier_stalk stk1.add_stalk stk1.mult_stalk 
                      <span class="main">(</span>stk1.zero_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>stk1.one_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> target.local_ring_axioms <span class="keyword1"><span class="command">.</span></span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ring_isomorphism <span class="main">(</span>identity stk1.carrier_stalk<span class="main">)</span> stk1.carrier_stalk 
                    stk1.add_stalk stk1.mult_stalk <span class="main">(</span>stk1.zero_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">(</span>stk1.one_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> stk2.carrier_stalk stk2.add_stalk stk2.mult_stalk
                    <span class="main">(</span>stk2.zero_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>stk2.one_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> iso.has_ring_isomorphism<span class="main">[</span><span class="operator">OF</span> fU<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"local_ring_morphism <span class="main">(</span>identity stk1.carrier_stalk<span class="main">)</span> stk1.carrier_stalk 
                    stk1.add_stalk stk1.mult_stalk <span class="main">(</span>stk1.zero_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">(</span>stk1.one_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> stk2.carrier_stalk stk2.add_stalk stk2.mult_stalk
                    <span class="main">(</span>stk2.zero_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>stk2.one_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> iso_is_local_ring_morphism<span class="main">)</span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"local_ring_morphism <span class="main">(</span>identity stk2.carrier_stalk<span class="main">)</span> stk1.carrier_stalk 
                    stk1.add_stalk stk1.mult_stalk <span class="main">(</span>stk1.zero_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> 
                    <span class="main">(</span>stk1.one_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> stk2.carrier_stalk stk2.add_stalk stk2.mult_stalk
                    <span class="main">(</span>stk2.zero_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>stk2.one_stalk <span class="main">(</span><span class="free">f</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="free">X</span> <span class="skolem">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> iso.carrier_stalk_eq<span class="main">[</span><span class="operator">OF</span> fU<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"identity stk2.carrier_stalk <span class="main">∘</span> induced_morphism <span class="main">↓</span> stk3.carrier_stalk
                              <span class="main">=</span> ind_btw.induced_morphism"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>identity stk2.carrier_stalk <span class="main">∘</span> induced_morphism <span class="main">↓</span> stk3.carrier_stalk<span class="main">)</span> <span class="skolem">x</span> 
                        <span class="main">=</span> ind_btw.induced_morphism <span class="skolem">x</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span><span class="var">?R</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">∈</span>stk3.carrier_stalk"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> 
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> identity stk2.carrier_stalk <span class="main">(</span>induced_morphism <span class="skolem">x</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">unfolding</span></span> compose_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> induced_morphism <span class="skolem">x</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> that iso.carrier_stalk_eq<span class="main">[</span><span class="operator">OF</span> fU<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?R</span>"</span></span>
                  <span class="keyword1"><span class="command">unfolding</span></span> induced_morphism_def ind_btw.induced_morphism_def
                  <span class="keyword1"><span class="command">using</span></span> iso.class_of_eq<span class="main">[</span><span class="operator">OF</span> fU<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ind_btw.induced_morphism_def
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> compose_def restrict_apply' restrict_ext<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> is_local_def ind_btw.is_local_def
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> morphism_locally_ringed_spaces_axioms_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ψ</span></span> <span class="keyword2"><span class="keyword">where</span></span>  ψ_morph<span class="main">:</span><span class="quoted"><span class="quoted">"morphism_presheaves_of_rings <span class="keyword1">Spec</span> is_zariski_open local.im_sheaf 
            im_sheaf_morphisms <span class="free">b</span> add_im_sheaf mult_im_sheaf zero_im_sheaf one_im_sheaf sheaf_spec 
            sheaf_spec_morphisms 𝒪b add_sheaf_spec mult_sheaf_spec zero_sheaf_spec one_sheaf_spec <span class="skolem">ψ</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> ψ_comp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">U</span><span class="main">.</span> is_zariski_open <span class="bound">U</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>local.im_sheaf <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="bound">U</span> <span class="main">∘</span> <span class="skolem">ψ</span> <span class="bound">U</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span> 
                      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="keyword1">𝒪</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="skolem">ψ</span> <span class="bound">U</span> <span class="main">∘</span> <span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="bound">U</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> is_inv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

          <span class="keyword1"><span class="command">interpret</span></span> ψ_morph<span class="main">:</span>morphism_presheaves_of_rings <span class="quoted"><span class="keyword1">Spec</span></span> <span class="quoted">is_zariski_open</span> <span class="quoted">local.im_sheaf</span> 
            <span class="quoted">im_sheaf_morphisms</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted">add_im_sheaf</span> <span class="quoted">mult_im_sheaf</span> <span class="quoted">zero_im_sheaf</span> <span class="quoted">one_im_sheaf</span> <span class="quoted">sheaf_spec</span> 
            <span class="quoted">sheaf_spec_morphisms</span> <span class="quoted">𝒪b</span> <span class="quoted">add_sheaf_spec</span> <span class="quoted">mult_sheaf_spec</span> <span class="quoted">zero_sheaf_spec</span> <span class="quoted">one_sheaf_spec</span> <span class="quoted"><span class="skolem">ψ</span></span>
            <span class="keyword1"><span class="command">using</span></span> ψ_morph <span class="keyword1"><span class="command">.</span></span>

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"morphism_presheaves_of_rings <span class="keyword1">Spec</span> is_zariski_open 
                  im_sheafXS.im_sheaf im_sheafXS.im_sheaf_morphisms <span class="free">b</span> im_sheafXS.add_im_sheaf
                  im_sheafXS.mult_im_sheaf im_sheafXS.zero_im_sheaf im_sheafXS.one_im_sheaf
                  im_sheaf im_sheaf_morphisms <span class="free">b</span> add_im_sheaf
                  mult_im_sheaf zero_im_sheaf one_im_sheaf <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span>im_sheafXS.im_sheaf <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="main">(</span>identity <span class="main">(</span>im_sheafXS.im_sheaf <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>im_sheafXS.im_sheaf <span class="skolem">U</span><span class="main">)</span> 
                  <span class="main">(</span>im_sheafXS.add_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>im_sheafXS.mult_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>im_sheafXS.zero_im_sheaf <span class="skolem">U</span><span class="main">)</span> 
                  <span class="main">(</span>im_sheafXS.one_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>local.im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>add_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>mult_im_sheaf <span class="skolem">U</span><span class="main">)</span> 
                  <span class="main">(</span>zero_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>one_im_sheaf <span class="skolem">U</span><span class="main">)</span>"</span></span> 
              <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bijective_map <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">U</span> <span class="main">∘</span> <span class="skolem">ψ</span> <span class="skolem">U</span> <span class="main">↓</span> local.im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>local.im_sheaf <span class="skolem">U</span><span class="main">)</span> 
                                    <span class="main">(</span>im_sheafXS.im_sheaf <span class="skolem">U</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> ccfv_threshold<span class="main"><span class="main">)</span></span> Int_commute Int_left_absorb Pi_I ψ_comp 
                      compose_def im_sheafXS.im_sheaf_def local.im_sheaf_def local.ind_sheaf_def 
                      o_apply restrict_PiE that<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> ψ_comp bij_betw_iff_bijections comp_apply compose_eq eq_𝒪<span class="hidden">⇩</span><sub>X</sub> 
                      im_sheafXS.im_sheaf_def is_continuous local.im_sheaf_def open_imp_subset that<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
              <span class="keyword1"><span class="command">with</span></span> comp_ring_morphisms<span class="main">[</span><span class="operator">OF</span> ψ_morph.is_ring_morphism<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span> ring_homoU<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span><span class="main">]</span> 
              <span class="keyword1"><span class="command">interpret</span></span> ring_isomorphism <span class="quoted"><span class="quoted">"<span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">U</span> <span class="main">∘</span> <span class="skolem">ψ</span> <span class="skolem">U</span> <span class="main">↓</span> local.im_sheaf <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"local.im_sheaf <span class="skolem">U</span>"</span></span> 
                <span class="quoted"><span class="quoted">"add_im_sheaf <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"mult_im_sheaf <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"zero_im_sheaf <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"one_im_sheaf <span class="skolem">U</span>"</span></span> 
                <span class="quoted"><span class="quoted">"im_sheafXS.im_sheaf <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"im_sheafXS.add_im_sheaf <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"im_sheafXS.mult_im_sheaf <span class="skolem">U</span>"</span></span>  
                <span class="quoted"><span class="quoted">"im_sheafXS.zero_im_sheaf <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"im_sheafXS.one_im_sheaf <span class="skolem">U</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> ring_isomorphism.intro <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="main">(</span>restrict <span class="main">(</span>inv_into <span class="main">(</span>local.im_sheaf <span class="skolem">U</span><span class="main">)</span> 
                      <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">U</span> <span class="main">∘</span> <span class="skolem">ψ</span> <span class="skolem">U</span> <span class="main">↓</span> local.im_sheaf <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>im_sheafXS.im_sheaf <span class="skolem">U</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">(</span>im_sheafXS.im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>im_sheafXS.add_im_sheaf <span class="skolem">U</span><span class="main">)</span> 
                      <span class="main">(</span>im_sheafXS.mult_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>im_sheafXS.zero_im_sheaf <span class="skolem">U</span><span class="main">)</span>
                      <span class="main">(</span>im_sheafXS.one_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>local.im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>add_im_sheaf <span class="skolem">U</span><span class="main">)</span> 
                      <span class="main">(</span>mult_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>zero_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>one_im_sheaf <span class="skolem">U</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> inverse_ring_isomorphism<span class="main">[</span><span class="operator">unfolded</span> ring_isomorphism_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>restrict <span class="main">(</span>inv_into <span class="main">(</span>local.im_sheaf <span class="skolem">U</span><span class="main">)</span> 
                      <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="skolem">U</span> <span class="main">∘</span> <span class="skolem">ψ</span> <span class="skolem">U</span> <span class="main">↓</span> local.im_sheaf <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>im_sheafXS.im_sheaf <span class="skolem">U</span><span class="main">)</span><span class="main">)</span>
                       <span class="main">=</span> identity <span class="main">(</span>im_sheafXS.im_sheaf <span class="skolem">U</span><span class="main">)</span>"</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Int_commute Int_left_absorb ψ_comp compose_eq 
                    im_sheafXS.im_sheaf_def injective inv_into_f_f local.im_sheaf_def 
                    local.ind_sheaf_def o_apply restrict_ext that<span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>im_sheaf_morphisms <span class="skolem">U</span> <span class="skolem">V</span> <span class="main">∘</span> identity <span class="main">(</span>im_sheafXS.im_sheaf <span class="skolem">U</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span>
                <span class="main">(</span>identity <span class="main">(</span>im_sheafXS.im_sheaf <span class="skolem">V</span><span class="main">)</span> <span class="main">∘</span> im_sheafXS.im_sheaf_morphisms <span class="skolem">U</span> <span class="skolem">V</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
              <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span><span class="main">=</span><span class="var">?R</span>"</span></span><span class="main">)</span>
              <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> im_sheafXS.im_sheaf <span class="skolem">U</span>"</span></span>
              <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span> <span class="skolem">V</span> <span class="skolem">x</span> 
            <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> im_sheaf_morphisms <span class="skolem">U</span> <span class="skolem">V</span> <span class="skolem">x</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> that<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> im_sheafXS.im_sheaf_morphisms <span class="skolem">U</span> <span class="skolem">V</span> <span class="skolem">x</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eq_ρ im_sheafXS.im_sheaf_morphisms_def im_sheaf_morphisms_def<span class="main">)</span>
              <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?R</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> im_sheafXS.is_map_from_is_homomorphism<span class="main">[</span><span class="operator">OF</span> that<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> map.map_closed that<span class="main">(</span>4<span class="main">)</span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
              <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_locales</span> 
              <span class="keyword1"><span class="command">unfolding</span></span> morphism_presheaves_of_rings_axioms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">from</span></span> comp_of_presheaves<span class="main">[</span><span class="operator">OF</span> this ψ_morph<span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"morphism_presheaves_of_rings <span class="keyword1">Spec</span> is_zariski_open im_sheafXS.im_sheaf 
                  im_sheafXS.im_sheaf_morphisms <span class="free">b</span> im_sheafXS.add_im_sheaf im_sheafXS.mult_im_sheaf 
                im_sheafXS.zero_im_sheaf im_sheafXS.one_im_sheaf sheaf_spec
              sheaf_spec_morphisms 𝒪b add_sheaf_spec mult_sheaf_spec zero_sheaf_spec one_sheaf_spec
                <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="skolem">ψ</span> <span class="bound">U</span> <span class="main">∘</span> identity <span class="main">(</span>im_sheafXS.im_sheaf <span class="bound">U</span><span class="main">)</span> <span class="main">↓</span> im_sheafXS.im_sheaf <span class="bound">U</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"morphism_presheaves_of_rings <span class="keyword1">Spec</span> is_zariski_open im_sheafXS.im_sheaf 
            im_sheafXS.im_sheaf_morphisms <span class="free">b</span> im_sheafXS.add_im_sheaf im_sheafXS.mult_im_sheaf 
            im_sheafXS.zero_im_sheaf im_sheafXS.one_im_sheaf sheaf_spec sheaf_spec_morphisms 𝒪b 
            add_sheaf_spec mult_sheaf_spec zero_sheaf_spec one_sheaf_spec <span class="skolem">ψ</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> morphism_presheaves_of_rings.morphism_presheaves_of_rings_fam_cong<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> im_sheafXS.im_sheaf <span class="skolem">U</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">ψ</span> <span class="skolem">U</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ψ</span> <span class="skolem">U</span> <span class="main">∘</span> identity <span class="main">(</span>im_sheafXS.im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">↓</span> im_sheafXS.im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> compose_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span><span class="main">.</span> is_zariski_open <span class="bound">U</span> <span class="main">⟹</span> <span class="skolem">ψ</span> <span class="bound">U</span> <span class="main">∈</span> extensional <span class="main">(</span>im_sheafXS.im_sheaf <span class="bound">U</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> PiE_iff ψ_morph.fam_morphisms_are_maps eq_𝒪<span class="hidden">⇩</span><sub>X</sub> im_sheafXS.im_sheaf_def 
                  is_continuous local.im_sheaf_def map.graph open_imp_subset<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∀</span><span class="bound">U</span><span class="main">.</span> is_zariski_open <span class="bound">U</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>im_sheafXS.im_sheaf <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="bound">U</span> <span class="main">∘</span> <span class="skolem">ψ</span> <span class="bound">U</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span> 
                        <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="keyword1">𝒪</span> <span class="bound">U</span><span class="main">.</span> <span class="main">(</span><span class="skolem">ψ</span> <span class="bound">U</span> <span class="main">∘</span> <span class="free">φ<span class="hidden">⇩</span><sub>f</sub></span> <span class="bound">U</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ψ_comp
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_commute Int_left_absorb im_sheafXS.im_sheaf_def local.im_sheaf_def 
                local.ind_sheaf_def<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"homeomorphism <span class="free">X</span> <span class="free">is_open</span> <span class="keyword1">Spec</span> is_zariski_open <span class="free">f</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> is_homeomorphism <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> iso_locally_ringed_spaces_axioms_def
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> iso_presheaves_of_rings.intro iso_sheaves_of_rings.intro 
                        <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>iso_presheaves_of_rings_axioms_def<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> is_morphism_of_sheaves morphism_sheaves_of_rings.axioms<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iso_locally_ringed_spaces_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> affine_scheme_def <span class="keyword1"><span class="command">using</span></span> comm_ring_axioms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_open</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_ring<span class="main">)</span> spec_is_affine_scheme<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"affine_scheme <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="keyword1">Spec</span> is_zariski_open sheaf_spec sheaf_spec_morphisms 𝒪b
<span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> add_sheaf_spec <span class="bound">U</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> mult_sheaf_spec <span class="bound">U</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> zero_sheaf_spec <span class="bound">U</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> one_sheaf_spec <span class="bound">U</span><span class="main">)</span>
<span class="main">(</span>identity <span class="keyword1">Spec</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="keyword1">𝒪</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> affine_scheme.intro<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"comm_ring <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.comm_ring_axioms<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"locally_ringed_space <span class="keyword1">Spec</span> is_zariski_open sheaf_spec sheaf_spec_morphisms 𝒪b add_sheaf_spec mult_sheaf_spec
     zero_sheaf_spec one_sheaf_spec"</span></span> <span class="keyword1"><span class="command">using</span></span> spec_is_locally_ringed_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">A</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">⟹</span> inv_into <span class="bound">A</span> <span class="main">(</span>identity <span class="bound">A</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bij_betw_def bij_betw_restrict_eq inj_on_id2 inv_into_f_f restrict_apply'<span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> zar<span class="main">:</span> topological_space <span class="quoted"><span class="keyword1">Spec</span></span> <span class="quoted">is_zariski_open</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpret</span></span> im_sheaf <span class="quoted"><span class="keyword1">Spec</span></span> <span class="quoted">is_zariski_open</span> <span class="quoted">sheaf_spec</span>
    <span class="quoted">sheaf_spec_morphisms</span> <span class="quoted">𝒪b</span> <span class="quoted">add_sheaf_spec</span> <span class="quoted">mult_sheaf_spec</span> <span class="quoted">zero_sheaf_spec</span> <span class="quoted">one_sheaf_spec</span> <span class="quoted"><span class="keyword1">Spec</span></span>
    <span class="quoted">is_zariski_open</span> <span class="quoted"><span class="quoted">"identity <span class="keyword1">Spec</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> homeomorphism_def im_sheaf_def sheaf_spec_is_sheaf zar.id_is_homeomorphism<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> rh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> <span class="main">⟦</span>is_zariski_open <span class="bound">U</span><span class="main">;</span> is_zariski_open <span class="bound">V</span><span class="main">;</span> <span class="bound">V</span> <span class="main">⊆</span> <span class="bound">U</span><span class="main">⟧</span>
             <span class="main">⟹</span> ring_homomorphism
                  <span class="main">(</span>im_sheaf_morphisms <span class="bound">U</span> <span class="bound">V</span><span class="main">)</span>
                  <span class="main">(</span>local.im_sheaf <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>add_sheaf_spec <span class="bound">U</span><span class="main">)</span>
                  <span class="main">(</span>mult_sheaf_spec <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>zero_sheaf_spec <span class="bound">U</span><span class="main">)</span>
                  <span class="main">(</span>one_sheaf_spec <span class="bound">U</span><span class="main">)</span> <span class="main">(</span>local.im_sheaf <span class="bound">V</span><span class="main">)</span>
                  <span class="main">(</span>add_sheaf_spec <span class="bound">V</span><span class="main">)</span> <span class="main">(</span>mult_sheaf_spec <span class="bound">V</span><span class="main">)</span>
                  <span class="main">(</span>zero_sheaf_spec <span class="bound">V</span><span class="main">)</span> <span class="main">(</span>one_sheaf_spec <span class="bound">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> im_sheaf_morphisms_def local.im_sheaf_def sheaf_spec_morphisms_are_ring_morphisms zar.open_preimage_identity <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">interpret</span></span> F<span class="main">:</span> presheaf_of_rings <span class="quoted"><span class="keyword1">Spec</span></span> <span class="quoted">is_zariski_open</span> 
    <span class="quoted"><span class="quoted">"im_sheaf.im_sheaf <span class="keyword1">Spec</span> sheaf_spec <span class="main">(</span>identity <span class="keyword1">Spec</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"im_sheaf.im_sheaf_morphisms <span class="keyword1">Spec</span> sheaf_spec_morphisms <span class="main">(</span>identity <span class="keyword1">Spec</span><span class="main">)</span>"</span></span> <span class="quoted">𝒪b</span> 
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">V</span><span class="main">.</span> add_sheaf_spec <span class="main">(</span>identity <span class="keyword1">Spec</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="keyword1">Spec</span> <span class="bound">V</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">V</span><span class="main">.</span> mult_sheaf_spec <span class="main">(</span>identity <span class="keyword1">Spec</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="keyword1">Spec</span> <span class="bound">V</span><span class="main">)</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">V</span><span class="main">.</span> zero_sheaf_spec <span class="main">(</span>identity <span class="keyword1">Spec</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="keyword1">Spec</span> <span class="bound">V</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">V</span><span class="main">.</span> one_sheaf_spec <span class="main">(</span>identity <span class="keyword1">Spec</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="keyword1">Spec</span> <span class="bound">V</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> presheaf_of_rings_def presheaf_of_rings_axioms_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI strip<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"im_sheaf_morphisms <span class="skolem">U</span> <span class="skolem">W</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span>im_sheaf_morphisms <span class="skolem">V</span> <span class="skolem">W</span> <span class="main">∘</span> im_sheaf_morphisms <span class="skolem">U</span> <span class="skolem">V</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"is_zariski_open <span class="skolem">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">W</span> <span class="main">⊆</span> <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> local.im_sheaf <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span> <span class="skolem">V</span> <span class="skolem">W</span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> that assoc_comp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rh ring_of_empty<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"iso_locally_ringed_spaces <span class="keyword1">Spec</span> is_zariski_open sheaf_spec sheaf_spec_morphisms 𝒪b
     add_sheaf_spec mult_sheaf_spec zero_sheaf_spec one_sheaf_spec <span class="keyword1">Spec</span> is_zariski_open sheaf_spec
     sheaf_spec_morphisms 𝒪b add_sheaf_spec mult_sheaf_spec zero_sheaf_spec one_sheaf_spec
     <span class="main">(</span>identity <span class="keyword1">Spec</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="keyword1">𝒪</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"iso_sheaves_of_rings
            <span class="keyword1">Spec</span> is_zariski_open sheaf_spec sheaf_spec_morphisms 𝒪b add_sheaf_spec mult_sheaf_spec zero_sheaf_spec one_sheaf_spec
            <span class="main">(</span>im_sheaf.im_sheaf <span class="keyword1">Spec</span> sheaf_spec <span class="main">(</span>identity <span class="keyword1">Spec</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span>im_sheaf.im_sheaf_morphisms <span class="keyword1">Spec</span> sheaf_spec_morphisms <span class="main">(</span>identity <span class="keyword1">Spec</span><span class="main">)</span><span class="main">)</span>
            𝒪b
            <span class="main">(</span><span class="main">λ</span><span class="bound">V</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> add_sheaf_spec <span class="main">(</span><span class="main">(</span>identity <span class="keyword1">Spec</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="keyword1">Spec</span> <span class="bound">V</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> 
            <span class="main">(</span><span class="main">λ</span><span class="bound">V</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> mult_sheaf_spec <span class="main">(</span><span class="main">(</span>identity <span class="keyword1">Spec</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="keyword1">Spec</span> <span class="bound">V</span><span class="main">)</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span> 
            <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> zero_sheaf_spec <span class="main">(</span><span class="main">(</span>identity <span class="keyword1">Spec</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="keyword1">Spec</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span> 
            <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> one_sheaf_spec <span class="main">(</span><span class="main">(</span>identity <span class="keyword1">Spec</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="keyword1">Spec</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span>
            <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="keyword1">𝒪</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"morphism_presheaves_of_rings_axioms is_zariski_open sheaf_spec sheaf_spec_morphisms add_sheaf_spec mult_sheaf_spec zero_sheaf_spec one_sheaf_spec <span class="main">(</span>im_sheaf.im_sheaf <span class="keyword1">Spec</span> sheaf_spec <span class="main">(</span>identity <span class="keyword1">Spec</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>im_sheaf.im_sheaf_morphisms <span class="keyword1">Spec</span> sheaf_spec_morphisms <span class="main">(</span>identity <span class="keyword1">Spec</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> add_sheaf_spec <span class="main">(</span>identity <span class="keyword1">Spec</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="keyword1">Spec</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> mult_sheaf_spec <span class="main">(</span>identity <span class="keyword1">Spec</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="keyword1">Spec</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> zero_sheaf_spec <span class="main">(</span>identity <span class="keyword1">Spec</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="keyword1">Spec</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> one_sheaf_spec <span class="main">(</span>identity <span class="keyword1">Spec</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="keyword1">Spec</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="keyword1">𝒪</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> F.id_is_mor_pr_rngs
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.im_sheaf_def morphism_presheaves_of_rings_def morphism_presheaves_of_rings_axioms_def im_sheaf_morphisms_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"iso_presheaves_of_rings_axioms <span class="keyword1">Spec</span> is_zariski_open sheaf_spec sheaf_spec_morphisms 𝒪b add_sheaf_spec mult_sheaf_spec zero_sheaf_spec one_sheaf_spec <span class="main">(</span>im_sheaf.im_sheaf <span class="keyword1">Spec</span> sheaf_spec <span class="main">(</span>identity <span class="keyword1">Spec</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>im_sheaf.im_sheaf_morphisms <span class="keyword1">Spec</span> sheaf_spec_morphisms <span class="main">(</span>identity <span class="keyword1">Spec</span><span class="main">)</span><span class="main">)</span> 𝒪b <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> add_sheaf_spec <span class="main">(</span>identity <span class="keyword1">Spec</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="keyword1">Spec</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> mult_sheaf_spec <span class="main">(</span>identity <span class="keyword1">Spec</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="keyword1">Spec</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> zero_sheaf_spec <span class="main">(</span>identity <span class="keyword1">Spec</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="keyword1">Spec</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> one_sheaf_spec <span class="main">(</span>identity <span class="keyword1">Spec</span> <span class="main"><span class="hidden">⇧</span><sup>¯</sup></span> <span class="keyword1">Spec</span> <span class="bound">V</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="keyword1">𝒪</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> iso_presheaves_of_rings_axioms_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="keyword1">𝒪</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> F.presheaf_of_rings_axioms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> im_sheaf_morphisms_def local.im_sheaf_def morphism_presheaves_of_rings.intro morphism_presheaves_of_rings_axioms_def sheaf_spec_is_presheaf<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"morphism_locally_ringed_spaces
                    <span class="keyword1">Spec</span> is_zariski_open sheaf_spec sheaf_spec_morphisms 𝒪b add_sheaf_spec mult_sheaf_spec zero_sheaf_spec one_sheaf_spec
                    <span class="keyword1">Spec</span> is_zariski_open sheaf_spec sheaf_spec_morphisms 𝒪b add_sheaf_spec mult_sheaf_spec zero_sheaf_spec one_sheaf_spec
                    <span class="main">(</span>identity <span class="keyword1">Spec</span><span class="main">)</span>
                    <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> identity <span class="main">(</span><span class="keyword1">𝒪</span> <span class="bound">U</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> locally_ringed_space.id_to_mor_locally_ringed_spaces spec_is_locally_ringed_space<span class="main">)</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> locally_ringed_space.id_to_iso_locally_ringed_spaces spec_is_locally_ringed_space<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> comm_ring<span class="main">)</span> spec_is_scheme<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"scheme <span class="free">R</span> <span class="main"><span class="free">(+)</span></span> <span class="main"><span class="free">(⋅)</span></span> <span class="main"><span class="free">𝟬</span></span> <span class="main"><span class="free">𝟭</span></span> <span class="keyword1">Spec</span> is_zariski_open sheaf_spec sheaf_spec_morphisms 𝒪b
<span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> add_sheaf_spec <span class="bound">U</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> mult_sheaf_spec <span class="bound">U</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> zero_sheaf_spec <span class="bound">U</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> one_sheaf_spec <span class="bound">U</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> spec_is_affine_scheme affine_scheme.affine_scheme_is_scheme<span class="main">)</span>
 
<span class="keyword1" id="Scheme-empty_scheme_is_affine_scheme"><span class="command">lemma</span></span> empty_scheme_is_affine_scheme<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"affine_scheme <span class="main">{</span><span class="main">0</span><span class="main">::</span>nat<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">0</span> 
<span class="main">{}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>nat<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> identity<span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>
<span class="main">(</span><span class="main">λ</span><span class="bound">𝔭</span><span class="main">∈</span><span class="free">Spec</span><span class="main">.</span> undefined<span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">λ</span><span class="bound">s</span> <span class="main">∈</span> cring0.sheaf_spec <span class="bound">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> im0<span class="main">:</span> im_sheaf <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> identity <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">U</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">U</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">𝔭</span><span class="main">∈</span><span class="free">Spec</span><span class="main">.</span> undefined"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> invertible_0 <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> im0.target.open_space <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> im0.ring_of_empty <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> im0.open_space <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span> 
  <span class="keyword1"><span class="command">have</span></span> cring0_open <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">N</span><span class="main">.</span> cring0.is_zariski_open <span class="bound">N</span> <span class="main">⟷</span> <span class="bound">N</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comm_ring.cring0_is_zariski_open cring0.comm_ring_axioms<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ring_im<span class="main">:</span> <span class="quoted"><span class="quoted">"ring <span class="main">(</span>im0.im_sheaf <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>im0.add_im_sheaf <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>im0.mult_im_sheaf <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>im0.zero_im_sheaf <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>im0.one_im_sheaf <span class="skolem">V</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">V</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set set"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.monoid <span class="main">(</span>im0.im_sheaf <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>im0.add_im_sheaf <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>im0.zero_im_sheaf <span class="skolem">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> im0.add_im_sheaf_def im0.im_sheaf_def im0.zero_im_sheaf_def monoid_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Group_Theory.group_axioms <span class="main">(</span>im0.im_sheaf <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>im0.add_im_sheaf <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>im0.zero_im_sheaf <span class="skolem">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Group_Theory.group_axioms_def im0.im_sheaf_def im0.zero_im_sheaf_def im0.add_im_sheaf_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> invertible_0<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"commutative_monoid_axioms <span class="main">(</span>im0.im_sheaf <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>im0.add_im_sheaf <span class="skolem">V</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> im0.add_im_sheaf_def commutative_monoid_axioms.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> im0.im_sheaf_def im0.add_im_sheaf_def im0.mult_im_sheaf_def im0.one_im_sheaf_def monoid_def ring_axioms_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> rh0<span class="main">:</span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="main">(</span>cring0.sheaf_spec_morphisms <span class="main">{}</span> <span class="main">{}</span><span class="main">)</span> <span class="main">{</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> undefined<span class="main">}</span>
             <span class="main">(</span>cring0.add_sheaf_spec <span class="main">{}</span><span class="main">)</span> <span class="main">(</span>cring0.mult_sheaf_spec <span class="main">{}</span><span class="main">)</span> <span class="main">(</span>cring0.zero_sheaf_spec <span class="main">{}</span><span class="main">)</span> <span class="main">(</span>cring0.one_sheaf_spec <span class="main">{}</span><span class="main">)</span> <span class="main">{</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> undefined<span class="main">}</span>
             <span class="main">(</span>cring0.add_sheaf_spec <span class="main">{}</span><span class="main">)</span> <span class="main">(</span>cring0.mult_sheaf_spec <span class="main">{}</span><span class="main">)</span> <span class="main">(</span>cring0.zero_sheaf_spec <span class="main">{}</span><span class="main">)</span> <span class="main">(</span>cring0.one_sheaf_spec <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cring0.cring0_sheaf_spec_empty cring0.is_zariski_open_empty cring0.sheaf_spec_morphisms_are_ring_morphisms im0.target.open_imp_subset<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"locally_ringed_space_axioms <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">{</span><span class="main">0</span><span class="main">::</span>nat<span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> identity<span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> empty_iff locally_ringed_space_axioms_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"topological_space cring0.spectrum cring0.is_zariski_open"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Set_Theory.map <span class="main">(</span><span class="main">λ</span><span class="bound">𝔭</span><span class="main">∈</span><span class="free">Spec</span><span class="main">.</span> undefined<span class="main">)</span> <span class="main">{}</span> cring0.spectrum"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cring0.cring0_spectrum_eq im0.map_axioms<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_map_axioms <span class="main">{}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span> cring0.is_zariski_open <span class="main">(</span><span class="main">λ</span><span class="bound">𝔭</span><span class="main">∈</span><span class="free">Spec</span><span class="main">.</span> undefined<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> continuous_map_axioms_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"presheaf_of_rings_axioms cring0.is_zariski_open cring0.sheaf_spec
            cring0.sheaf_spec_morphisms cring0.𝒪b cring0.add_sheaf_spec cring0.mult_sheaf_spec cring0.zero_sheaf_spec cring0.one_sheaf_spec"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cring0.𝒪_on_emptyset cring0.sheaf_morphisms_sheaf_spec
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cring0.sheaf_spec_is_presheaf presheaf_of_rings_def<span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"sheaf_of_rings_axioms cring0.spectrum cring0.is_zariski_open cring0.sheaf_spec cring0.sheaf_spec_morphisms cring0.zero_sheaf_spec"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cring0.sheaf_spec_is_sheaf sheaf_of_rings_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">have</span></span> im_sheaf_0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"im_sheaf.im_sheaf <span class="main">{}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">𝔭</span><span class="main">∈</span><span class="free">Spec</span><span class="main">.</span> undefined<span class="main">)</span> <span class="skolem">U</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat set set"</span></span>
      <span class="keyword1"><span class="command">using</span></span> im0.im_sheaf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> rh<span class="main">:</span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="main">(</span>im0.im_sheaf_morphisms <span class="skolem">U</span> <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>im0.im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>im0.add_im_sheaf <span class="skolem">U</span><span class="main">)</span>
         <span class="main">(</span>im0.mult_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>im0.zero_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>im0.one_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>im0.im_sheaf <span class="skolem">V</span><span class="main">)</span>
         <span class="main">(</span>im0.add_im_sheaf <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>im0.mult_im_sheaf <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>im0.zero_im_sheaf <span class="skolem">V</span><span class="main">)</span> <span class="main">(</span>im0.one_im_sheaf <span class="skolem">V</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"cring0.is_zariski_open <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"cring0.is_zariski_open <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span> <span class="skolem">V</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cring0.cring0_is_zariski_open im0.is_ring_morphism<span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"morphism_ringed_spaces_axioms <span class="main">{}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>
         <span class="main">(</span><span class="main">λ</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> identity <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>
         <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> cring0.spectrum cring0.is_zariski_open cring0.sheaf_spec
         cring0.sheaf_spec_morphisms cring0.𝒪b cring0.add_sheaf_spec
         cring0.mult_sheaf_spec cring0.zero_sheaf_spec cring0.one_sheaf_spec
         <span class="main">(</span><span class="main">λ</span><span class="bound">𝔭</span><span class="main">∈</span><span class="free">Spec</span><span class="main">.</span> undefined<span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">λ</span><span class="bound">s</span><span class="main">∈</span>cring0.sheaf_spec <span class="bound">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> morphism_ringed_spaces_axioms_def morphism_sheaves_of_rings_def
        morphism_presheaves_of_rings_def 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"presheaf_of_rings cring0.spectrum cring0.is_zariski_open cring0.sheaf_spec
         cring0.sheaf_spec_morphisms cring0.𝒪b cring0.add_sheaf_spec
         cring0.mult_sheaf_spec cring0.zero_sheaf_spec cring0.one_sheaf_spec"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cring0.sheaf_spec_is_presheaf <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"presheaf_of_rings cring0.spectrum cring0.is_zariski_open im0.im_sheaf im0.im_sheaf_morphisms
 <span class="main">0</span> im0.add_im_sheaf im0.mult_im_sheaf im0.zero_im_sheaf im0.one_im_sheaf"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>z3<span class="main"><span class="main">)</span></span> comm_ring.cring0_is_zariski_open cring0.comm_ring_axioms cring0.cring0_spectrum_eq im0.presheaf_of_rings_axioms<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"morphism_presheaves_of_rings_axioms cring0.is_zariski_open cring0.sheaf_spec cring0.sheaf_spec_morphisms 
               cring0.add_sheaf_spec cring0.mult_sheaf_spec cring0.zero_sheaf_spec cring0.one_sheaf_spec 
               im0.im_sheaf im0.im_sheaf_morphisms im0.add_im_sheaf im0.mult_im_sheaf im0.zero_im_sheaf im0.one_im_sheaf <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">λ</span><span class="bound">s</span><span class="main">∈</span>cring0.sheaf_spec <span class="bound">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> morphism_presheaves_of_rings_axioms_def
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI strip<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">U</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"cring0.is_zariski_open <span class="skolem">U</span>"</span></span>
        <span class="keyword1"><span class="command">interpret</span></span> rU<span class="main">:</span> ring <span class="quoted"><span class="quoted">"cring0.sheaf_spec <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"cring0.add_sheaf_spec <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"cring0.mult_sheaf_spec <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"cring0.zero_sheaf_spec <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"cring0.one_sheaf_spec <span class="skolem">U</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹cring0.is_zariski_open <span class="skolem">U</span>›</span></span> comm_ring.axioms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> cring0.sheaf_spec_on_open_is_comm_ring<span class="main">)</span>
        <span class="keyword1"><span class="command">interpret</span></span> rU'<span class="main">:</span> ring <span class="quoted"><span class="quoted">"im0.im_sheaf <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"im0.add_im_sheaf <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"im0.mult_im_sheaf <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"im0.zero_im_sheaf <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"im0.one_im_sheaf <span class="skolem">U</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ring_im <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ring_homomorphism <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">∈</span>cring0.sheaf_spec <span class="skolem">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>cring0.sheaf_spec <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>cring0.add_sheaf_spec <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>cring0.mult_sheaf_spec <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>cring0.zero_sheaf_spec <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>cring0.one_sheaf_spec <span class="skolem">U</span><span class="main">)</span> 
                            <span class="main">(</span>im0.im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>im0.add_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>im0.mult_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>im0.zero_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>im0.one_im_sheaf <span class="skolem">U</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Set_Theory.map <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">∈</span>cring0.sheaf_spec <span class="skolem">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>cring0.sheaf_spec <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>im0.im_sheaf <span class="skolem">U</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span>  Set_Theory.map_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ext_funcset_to_sing_iff im0.im_sheaf_def singletonI<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid_homomorphism_axioms <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">∈</span>cring0.sheaf_spec <span class="skolem">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>cring0.sheaf_spec <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>cring0.add_sheaf_spec <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>cring0.zero_sheaf_spec <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>im0.add_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>im0.zero_im_sheaf <span class="skolem">U</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> monoid_homomorphism_axioms_def im0.zero_im_sheaf_def im0.add_im_sheaf_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rU.additive.unit_closed rU.additive.composition_closed restrict_apply<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"monoid_homomorphism_axioms <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">∈</span>cring0.sheaf_spec <span class="skolem">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>cring0.sheaf_spec <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>cring0.mult_sheaf_spec <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>cring0.one_sheaf_spec <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>im0.mult_im_sheaf <span class="skolem">U</span><span class="main">)</span> <span class="main">(</span>im0.one_im_sheaf <span class="skolem">U</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> monoid_homomorphism_axioms_def im0.mult_im_sheaf_def im0.one_im_sheaf_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rU.multiplicative.composition_closed rU.multiplicative.unit_closed restrict_apply<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>im0.im_sheaf_morphisms <span class="skolem">U</span> <span class="skolem">V</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">∈</span>cring0.sheaf_spec <span class="skolem">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">∈</span>cring0.sheaf_spec <span class="skolem">V</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">∘</span> cring0.sheaf_spec_morphisms <span class="skolem">U</span> <span class="skolem">V</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"cring0.is_zariski_open <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"cring0.is_zariski_open <span class="skolem">V</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">⊆</span> <span class="skolem">U</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> cring0.sheaf_spec <span class="skolem">U</span>"</span></span>
          <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">U</span> <span class="skolem">V</span> <span class="skolem">x</span>
          <span class="keyword1"><span class="command">using</span></span> that cring0.sheaf_morphisms_sheaf_spec 
          <span class="keyword1"><span class="command">unfolding</span></span> im0.im_sheaf_morphisms_def o_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cring0.cring0_is_zariski_open insertI1 restrict_apply'<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">interpret</span></span> monoid0<span class="main">:</span> Group_Theory.monoid <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> undefined<span class="main">}</span>"</span></span>
      <span class="quoted"><span class="quoted">"cring0.add_sheaf_spec <span class="main">{}</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">𝔭</span><span class="main">∈</span><span class="main">{}</span><span class="main">.</span> quotient_ring.zero_rel <span class="main">(</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">∖</span><span class="bound">𝔭</span><span class="main">)</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> ring0.subtraction ring0.subtraction <span class="main">0</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> Group_Theory.monoid.intro cring0.add_sheaf_spec_extensional extensional_empty restrict_extensional singletonD<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"iso_locally_ringed_spaces_axioms <span class="main">{}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>
     <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> identity <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>
     <span class="main">(</span><span class="main">λ</span><span class="bound">U</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> cring0.spectrum
     cring0.is_zariski_open cring0.sheaf_spec
     cring0.sheaf_spec_morphisms cring0.𝒪b
     cring0.add_sheaf_spec cring0.mult_sheaf_spec
     cring0.zero_sheaf_spec cring0.one_sheaf_spec
     <span class="main">(</span><span class="main">λ</span><span class="bound">𝔭</span><span class="main">∈</span><span class="free">Spec</span><span class="main">.</span> undefined<span class="main">)</span>
     <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">λ</span><span class="bound">s</span><span class="main">∈</span>cring0.sheaf_spec <span class="bound">U</span><span class="main">.</span> <span class="main">0</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> iso_locally_ringed_spaces_axioms_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"homeomorphism <span class="main">{}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> cring0.spectrum cring0.is_zariski_open <span class="main">(</span><span class="main">λ</span><span class="bound">𝔭</span><span class="main">∈</span><span class="free">Spec</span><span class="main">.</span> undefined<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bijective <span class="main">(</span><span class="main">λ</span><span class="bound">𝔭</span><span class="main">∈</span><span class="free">Spec</span><span class="main">.</span> undefined<span class="main">)</span> <span class="main">{}</span> cring0.spectrum"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> bijective_def bij_betw_def
          <span class="keyword1"><span class="command">using</span></span> cring0.cring0_spectrum_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Set_Theory.map <span class="main">(</span>inverse_map <span class="main">(</span><span class="main">λ</span><span class="bound">𝔭</span><span class="main">∈</span><span class="free">Spec</span><span class="main">.</span> undefined<span class="main">)</span> <span class="main">{}</span> cring0.spectrum<span class="main">)</span> cring0.spectrum <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> Set_Theory.map_def inverse_map_def restrict_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> PiE_I cring0.cring0_spectrum_eq empty_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">use</span> im0.map_axioms continuous_map_axioms_def <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted">‹<span class="operator">force</span><span class="keyword3">+</span>›</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"iso_sheaves_of_rings cring0.spectrum cring0.is_zariski_open cring0.sheaf_spec
                 cring0.sheaf_spec_morphisms cring0.𝒪b cring0.add_sheaf_spec cring0.mult_sheaf_spec cring0.zero_sheaf_spec cring0.one_sheaf_spec 
                 im0.im_sheaf im0.im_sheaf_morphisms <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> im0.add_im_sheaf im0.mult_im_sheaf im0.zero_im_sheaf im0.one_im_sheaf <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">λ</span><span class="bound">s</span><span class="main">∈</span>cring0.sheaf_spec <span class="bound">U</span><span class="main">.</span> <span class="main">0</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">intro_locales</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"topological_space cring0.spectrum cring0.is_zariski_open"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"presheaf_of_rings_axioms cring0.is_zariski_open cring0.sheaf_spec cring0.sheaf_spec_morphisms cring0.𝒪b cring0.add_sheaf_spec cring0.mult_sheaf_spec cring0.zero_sheaf_spec cring0.one_sheaf_spec"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹presheaf_of_rings_axioms cring0.is_zariski_open cring0.sheaf_spec cring0.sheaf_spec_morphisms cring0.𝒪b cring0.add_sheaf_spec cring0.mult_sheaf_spec cring0.zero_sheaf_spec cring0.one_sheaf_spec›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"presheaf_of_rings_axioms cring0.is_zariski_open im0.im_sheaf im0.im_sheaf_morphisms <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> im0.add_im_sheaf im0.mult_im_sheaf im0.zero_im_sheaf im0.one_im_sheaf"</span></span>
          <span class="keyword1"><span class="command">using</span></span> im0.presheaf_of_rings_axioms presheaf_of_rings_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"morphism_presheaves_of_rings_axioms cring0.is_zariski_open cring0.sheaf_spec cring0.sheaf_spec_morphisms cring0.add_sheaf_spec cring0.mult_sheaf_spec cring0.zero_sheaf_spec cring0.one_sheaf_spec im0.im_sheaf im0.im_sheaf_morphisms im0.add_im_sheaf im0.mult_im_sheaf im0.zero_im_sheaf im0.one_im_sheaf <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">λ</span><span class="bound">s</span><span class="main">∈</span>cring0.sheaf_spec <span class="bound">U</span><span class="main">.</span> <span class="main">0</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> cring0.zero_sheaf_spec_def cring0.one_sheaf_spec_def cring0.add_sheaf_spec_def cring0.mult_sheaf_spec_def 
            im0.zero_im_sheaf_def im0.one_im_sheaf_def im0.add_im_sheaf_def im0.mult_im_sheaf_def
            im0.im_sheaf_morphisms_def cring0.sheaf_morphisms_sheaf_spec monoid0.invertible_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> morph_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"morphism_presheaves_of_rings <span class="main">{}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>
             im0.im_sheaf im0.im_sheaf_morphisms <span class="main">0</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> ring0.subtraction<span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> ring0.subtraction<span class="main">)</span>
             <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">V</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> cring0.sheaf_spec cring0.sheaf_spec_morphisms cring0.𝒪b
             cring0.add_sheaf_spec cring0.mult_sheaf_spec cring0.zero_sheaf_spec cring0.one_sheaf_spec
             <span class="main">(</span><span class="main">λ</span><span class="bound">S</span><span class="main">.</span> <span class="main">λ</span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">.</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> undefined<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> im0.im_sheaf_morphisms_def cring0.sheaf_spec_morphisms_def 
            cring0.zero_sheaf_spec_def cring0.one_sheaf_spec_def cring0.add_sheaf_spec_def cring0.mult_sheaf_spec_def 
            cring0.𝒪b_def monoid0.invertible_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"iso_presheaves_of_rings_axioms cring0.spectrum cring0.is_zariski_open cring0.sheaf_spec 
                   cring0.sheaf_spec_morphisms cring0.𝒪b cring0.add_sheaf_spec cring0.mult_sheaf_spec cring0.zero_sheaf_spec cring0.one_sheaf_spec 
                   im0.im_sheaf im0.im_sheaf_morphisms <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span> im0.add_im_sheaf im0.mult_im_sheaf im0.zero_im_sheaf im0.one_im_sheaf <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">λ</span><span class="bound">s</span><span class="main">∈</span>cring0.sheaf_spec <span class="bound">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> im0.zero_im_sheaf_def im0.one_im_sheaf_def im0.add_im_sheaf_def im0.mult_im_sheaf_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"morphism_locally_ringed_spaces_axioms <span class="main">{}</span>
     <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> identity <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span>
     <span class="main">(</span><span class="main">λ</span><span class="bound">U</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>
     cring0.is_zariski_open cring0.sheaf_spec
     cring0.sheaf_spec_morphisms cring0.add_sheaf_spec
     cring0.mult_sheaf_spec cring0.zero_sheaf_spec
     cring0.one_sheaf_spec <span class="main">(</span><span class="main">λ</span><span class="bound">𝔭</span><span class="main">∈</span><span class="free">Spec</span><span class="main">.</span> undefined<span class="main">)</span>
     <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">λ</span><span class="bound">s</span><span class="main">∈</span>cring0.sheaf_spec <span class="bound">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> equals0D morphism_locally_ringed_spaces_axioms.intro<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Scheme-empty_scheme_is_scheme"><span class="command">lemma</span></span> empty_scheme_is_scheme<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"scheme <span class="main">{</span><span class="main">0</span><span class="main">::</span>nat<span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">0</span> <span class="main">0</span> <span class="main">{}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="bound">U</span><span class="main">=</span><span class="main">{}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span> <span class="bound">V</span><span class="main">.</span> identity<span class="main">{</span><span class="main">0</span><span class="main">::</span>nat<span class="main">}</span><span class="main">)</span> <span class="main">0</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> affine_scheme.affine_scheme_is_scheme empty_scheme_is_affine_scheme<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div>