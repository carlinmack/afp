<div id="HF">
<div class="head">
<h1>Theory HF</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹The Hereditarily Finite Sets›</span></span>

<span class="keyword1"><span class="command">theory</span></span> HF
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Library/Nat_Bijection.html">HOL-Library.Nat_Bijection</a>"</span>
<span class="keyword2"><span class="keyword">abbrevs</span></span> <span class="quoted">"&lt;:"</span> <span class="main">=</span> <span class="quoted">"<span class="hidden">❙</span><b>∈</b>"</span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted">"~&lt;:"</span> <span class="main">=</span> <span class="quoted">"<span class="hidden">❙</span><b>∉</b>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹From "Finite sets and Gödel's Incompleteness Theorems" by S. Swierczkowski.
      Thanks for Brian Huffman for this development, up to the cases and induct rules.›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Basic Definitions and Lemmas›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> hf <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV <span class="main">::</span> nat set"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hfset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hfset</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> Abs_hf <span class="main">`</span> set_decode <span class="main">(</span>Rep_hf <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">HF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf set <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">HF</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> Abs_hf <span class="main">(</span>set_encode <span class="main">(</span>Rep_hf <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hinsert</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hinsert</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> HF <span class="main">(</span>insert <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">(</span>hfset <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hmem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>∈</b></span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hmem</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> hfset <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>
  
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">not_hmem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="hidden">❙</span><b>∉</b></span>"</span> 50<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free"><span class="hidden">❙</span><b>∉</b></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
  hmem <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">&lt;:</span>"</span> 50<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> hf <span class="main">::</span> <span class="quoted">zero</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> Zero_hf_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> HF <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="HF-Abs_hf_0"><span class="command">lemma</span></span> Abs_hf_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Abs_hf <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HF_def Zero_hf_def<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹HF Set enumerations›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">inserthf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf <span class="main">⇒</span> hf"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">◃</span>"</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main"><span class="free">◃</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> hinsert <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
  <span class="quoted">"_HFinset"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"args <span class="main">⇒</span> hf"</span></span>      <span class="main">(</span><span class="quoted">"<span class="keyword1">{|</span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword1">|}</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_HFinset"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"args <span class="main">⇒</span> hf"</span></span>      <span class="main">(</span><span class="quoted">"<span class="keyword1">⦃</span>_<span class="keyword1">⦄</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">⦃</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">⦄</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="main">⦃</span><span class="free">y</span><span class="main">⦄</span> <span class="main">◃</span> <span class="free">x</span>"</span>
  <span class="quoted">"<span class="main">⦃</span><span class="free">x</span><span class="main">⦄</span>"</span>    <span class="main">⇌</span> <span class="quoted">"<span class="main">0</span> <span class="main">◃</span> <span class="free">x</span>"</span>

<span class="keyword1" id="HF-finite_hfset"><span class="command">lemma</span></span> finite_hfset <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>hfset <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> hfset_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="HF-HF_hfset"><span class="command">lemma</span></span> HF_hfset <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"HF <span class="main">(</span>hfset <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> HF_def hfset_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_image Abs_hf_inverse Rep_hf_inverse<span class="main">)</span>

<span class="keyword1" id="HF-hfset_HF"><span class="command">lemma</span></span> hfset_HF <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> hfset <span class="main">(</span>HF <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> HF_def hfset_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_image Abs_hf_inverse Rep_hf_inverse<span class="main">)</span>

<span class="keyword1" id="HF-inj_on_HF"><span class="command">lemma</span></span> inj_on_HF<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on HF <span class="main">(</span>Collect finite<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hfset_HF inj_onI mem_Collect_eq<span class="main">)</span>

<span class="keyword1" id="HF-hmem_hempty"><span class="command">lemma</span></span> hmem_hempty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> hmem_def Zero_hf_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemmas</span></span> hemptyE <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main">!</span></span><span class="main">]</span> <span class="main">=</span> hmem_hempty <span class="main">[</span><span class="operator">THEN</span> notE<span class="main">]</span>

<span class="keyword1" id="HF-hmem_hinsert"><span class="command">lemma</span></span> hmem_hinsert <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"hmem <span class="free">a</span> <span class="main">(</span><span class="free">c</span> <span class="main">◃</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> hmem_def hinsert_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="HF-hf_ext"><span class="command">lemma</span></span> hf_ext<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">a</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> hmem_def set_eq_iff <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HF_hfset<span class="main">)</span>

<span class="keyword1" id="HF-finite_cases"><span class="command">lemma</span></span> finite_cases <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> empty insert<span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>finite <span class="free">F</span><span class="main">;</span> <span class="free">F</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">A</span> <span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="free">F</span> <span class="main">=</span> insert <span class="bound">x</span> <span class="bound">A</span><span class="main">;</span> <span class="bound">x</span> <span class="main">∉</span> <span class="bound">A</span><span class="main">;</span> finite <span class="bound">A</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">F</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1" id="HF-hf_cases"><span class="command">lemma</span></span> hf_cases <span class="main">[</span><span class="operator">cases</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">type</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">:</span></span></span></span> hf<span class="main">,</span> <span class="operator">case_names</span> 0 hinsert<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="free">a</span> <span class="free">b</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">b</span> <span class="main">◃</span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>hfset <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_hfset<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="free">thesis</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Zero_hf_def finite_cases hf_ext hfset_HF hinsert_def hmem_def that<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HF-Rep_hf_hinsert"><span class="command">lemma</span></span> Rep_hf_hinsert<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="free">b</span> <span class="main">⟹</span> Rep_hf <span class="main">(</span>hinsert <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Rep_hf <span class="free">a</span><span class="main">)</span> <span class="main">+</span> Rep_hf <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> hinsert_def HF_def hfset_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_image Abs_hf_inverse Rep_hf_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> set_encode_insert<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hmem_def hfset_def image_def
    Rep_hf_inject <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> Abs_hf_inverse<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HF-less_two_power"><span class="command">lemma</span></span> less_two_power<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Verifying the Axioms of HF›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹HF1›</span></span>
<span class="keyword1" id="HF-hempty_iff"><span class="command">lemma</span></span> hempty_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span><span class="main">=</span><span class="main">0</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hf_ext<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹HF2›</span></span>
<span class="keyword1" id="HF-hinsert_iff"><span class="command">lemma</span></span> hinsert_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">◃</span> <span class="free">y</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">z</span> <span class="main">⟷</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">x</span> <span class="main">∨</span> <span class="bound">u</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hf_ext<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹HF induction›</span></span>
<span class="keyword1" id="HF-hf_induct"><span class="command">lemma</span></span> hf_induct <span class="main">[</span><span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">type</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">:</span></span></span></span> hf<span class="main">,</span> <span class="operator">case_names</span> 0 hinsert<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">0</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span><span class="free">P</span> <span class="bound">x</span><span class="main">;</span> <span class="free">P</span> <span class="bound">y</span><span class="main">;</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="bound">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">y</span> <span class="main">◃</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">z</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> wf_induct <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> r<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"measure Rep_hf"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> wf_measure<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hf_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>hinsert <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_hf_hinsert
                      less_le_trans <span class="main"><span class="main">[</span></span><span class="operator">OF</span> less_two_power le_add1<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹HF3›</span></span>
<span class="keyword1" id="HF-hf_induct_ax"><span class="command">lemma</span></span> hf_induct_ax<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">P</span> <span class="main">0</span><span class="main">;</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span> <span class="main">◃</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="HF-hf_equalityI"><span class="command">lemma</span></span> hf_equalityI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">a</span> <span class="main">⟷</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hf_ext<span class="main">)</span>

<span class="keyword1" id="HF-hinsert_nonempty"><span class="command">lemma</span></span> hinsert_nonempty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">◃</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hf_ext<span class="main">)</span>

<span class="keyword1" id="HF-hinsert_commute"><span class="command">lemma</span></span> hinsert_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span> <span class="main">◃</span> <span class="free">y</span><span class="main">)</span> <span class="main">◃</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">z</span> <span class="main">◃</span> <span class="free">x</span><span class="main">)</span> <span class="main">◃</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hf_ext<span class="main">)</span>

<span class="keyword1" id="HF-hmem_HF_iff"><span class="command">lemma</span></span> hmem_HF_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> HF <span class="free">A</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> finite <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hmem_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hmem_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> HF_def Rep_hf_inject Abs_hf_0 finite_imageD hempty_iff inj_onI set_encode_inf<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Ordered Pairs, from ZF/ZF.thy›</span></span>

<span class="keyword1" id="HF-singleton_eq_iff"><span class="command">lemma</span></span> singleton_eq_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">a</span><span class="main">⦄</span> <span class="main">=</span> <span class="main">⦃</span><span class="free">b</span><span class="main">⦄</span> <span class="main">⟷</span> <span class="free">a</span><span class="main">=</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hmem_hempty hmem_hinsert<span class="main">)</span>

<span class="keyword1" id="HF-doubleton_eq_iff"><span class="command">lemma</span></span> doubleton_eq_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⦄</span> <span class="main">=</span> <span class="main">⦃</span><span class="free">c</span><span class="main">,</span><span class="free">d</span><span class="main">⦄</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">a</span><span class="main">=</span><span class="free">c</span> <span class="main">∧</span> <span class="free">b</span><span class="main">=</span><span class="free">d</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">a</span><span class="main">=</span><span class="free">d</span> <span class="main">∧</span> <span class="free">b</span><span class="main">=</span><span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> hmem_hempty hmem_hinsert<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hpair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hpair</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">⦃</span><span class="main">⦃</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">⦄</span><span class="main">,</span><span class="main">⦃</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">⦄</span><span class="main">⦄</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hfst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hfst</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> hpair <span class="bound">x</span> <span class="bound">y</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hsnd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hsnd</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> <span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> hpair <span class="bound">x</span> <span class="bound">y</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hsplit</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">[</span>hf<span class="main">,</span> hf<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">,</span> hf<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">::</span><span class="main">{}</span>"</span></span>  <span class="comment1">― ‹for pattern-matching›</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hsplit</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">(</span>hfst <span class="bound">p</span><span class="main">)</span> <span class="main">(</span>hsnd <span class="bound">p</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Ordered Pairs, from ZF/ZF.thy›</span></span>

<span class="keyword1"><span class="command">nonterminal</span></span> hfs
<span class="keyword1"><span class="command">syntax</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
  <span class="quoted">"_Tuple"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>hf<span class="main">,</span> hfs<span class="main">]</span> <span class="main">⇒</span> hf"</span></span>              <span class="main">(</span><span class="quoted">"<span class="keyword1">&lt;</span><span class="keyword3">(</span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword3">)</span><span class="keyword1">&gt;</span>"</span><span class="main">)</span>
  <span class="quoted">"_hpattern"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span> patterns<span class="main">]</span> <span class="main">⇒</span> pttrn"</span></span>   <span class="main">(</span><span class="quoted">"<span class="keyword1">&lt;</span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword1">&gt;</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">""</span>          <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hfs"</span></span>                    <span class="main">(</span><span class="quoted">"_"</span><span class="main">)</span>
  <span class="quoted">"_Enum"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>hf<span class="main">,</span> hfs<span class="main">]</span> <span class="main">⇒</span> hfs"</span></span>             <span class="main">(</span><span class="quoted">"_<span class="keyword1">,</span><span class="keyword3">/ </span>_"</span><span class="main">)</span>
  <span class="quoted">"_Tuple"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>hf<span class="main">,</span> hfs<span class="main">]</span> <span class="main">⇒</span> hf"</span></span>              <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span><span class="keyword3">(</span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword3">)</span><span class="keyword1">⟩</span>"</span><span class="main">)</span>
  <span class="quoted">"_hpattern"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span> patterns<span class="main">]</span> <span class="main">⇒</span> pttrn"</span></span>   <span class="main">(</span><span class="quoted">"<span class="keyword1">⟨</span>_<span class="keyword1">,</span><span class="keyword3">/ </span>_<span class="keyword1">⟩</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">&lt;</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">&gt;</span>"</span>    <span class="main">⇌</span> <span class="quoted">"<span class="main">&lt;</span><span class="free">x</span><span class="main">,</span> <span class="main">&lt;</span><span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">&gt;</span><span class="main">&gt;</span>"</span>
  <span class="quoted">"<span class="main">&lt;</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">&gt;</span>"</span>       <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> hpair <span class="free">x</span> <span class="free">y</span>"</span>
  <span class="quoted">"<span class="main">&lt;</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">&gt;</span>"</span>    <span class="main">⇌</span> <span class="quoted">"<span class="main">&lt;</span><span class="free">x</span><span class="main">,</span> <span class="main">&lt;</span><span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">&gt;</span><span class="main">&gt;</span>"</span>
  <span class="quoted">"<span class="main">λ</span><span class="main">&lt;</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">,</span><span class="free">zs</span><span class="main">&gt;</span><span class="main">.</span> <span class="free">b</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> hsplit<span class="main">(</span><span class="main">λ</span><span class="free">x</span> <span class="main">&lt;</span><span class="free">y</span><span class="main">,</span><span class="free">zs</span><span class="main">&gt;</span><span class="main">.</span> <span class="free">b</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="main">λ</span><span class="main">&lt;</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">&gt;</span><span class="main">.</span> <span class="free">b</span>"</span>    <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> hsplit<span class="main">(</span><span class="main">λ</span><span class="free">x</span> <span class="free">y</span><span class="main">.</span> <span class="free">b</span><span class="main">)</span>"</span>


<span class="keyword1" id="HF-hpair_def'"><span class="command">lemma</span></span> hpair_def'<span class="main">:</span> <span class="quoted"><span class="quoted">"hpair <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> <span class="main">⦃</span><span class="main">⦃</span><span class="free">a</span><span class="main">,</span><span class="free">a</span><span class="main">⦄</span><span class="main">,</span><span class="main">⦃</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⦄</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hf_ext hpair_def<span class="main">)</span>

<span class="keyword1" id="HF-hpair_iff"><span class="command">lemma</span></span> hpair_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hpair <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> hpair <span class="free">a'</span> <span class="free">b'</span> <span class="main">⟷</span> <span class="free">a</span><span class="main">=</span><span class="free">a'</span> <span class="main">∧</span> <span class="free">b</span><span class="main">=</span><span class="free">b'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hpair_def' doubleton_eq_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> hpair_inject <span class="main">=</span> hpair_iff <span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">THEN</span> conjE<span class="main">,</span> <span class="operator">elim</span><span class="main"><span class="main">!</span></span><span class="main">]</span>

<span class="keyword1" id="HF-hfst_conv"><span class="command">lemma</span></span> hfst_conv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hfst <span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hfst_def<span class="main">)</span>

<span class="keyword1" id="HF-hsnd_conv"><span class="command">lemma</span></span> hsnd_conv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hsnd <span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hsnd_def<span class="main">)</span>

<span class="keyword1" id="HF-hsplit"><span class="command">lemma</span></span> hsplit <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hsplit <span class="free">c</span> <span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main">=</span> <span class="free">c</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hsplit_def<span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Unions, Comprehensions, Intersections›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Unions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 1.5 (Existence of the union of two sets).›</span></span>
<span class="keyword1" id="HF-binary_union"><span class="command">lemma</span></span> binary_union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">z</span> <span class="main">⟷</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">x</span> <span class="main">∨</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hf_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>hinsert <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hmem_hinsert<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 1.6 (Existence of the union of a set of sets).›</span></span>
<span class="keyword1" id="HF-union_of_set"><span class="command">lemma</span></span> union_of_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">z</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hf_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hmem_hempty<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>hinsert <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hmem_hinsert binary_union <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">a</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Set comprehensions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 1.7, comprehension scheme›</span></span>
<span class="keyword1" id="HF-comprehension"><span class="command">lemma</span></span> comprehension<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">z</span> <span class="main">⟷</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">x</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hf_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hmem_hempty<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>hinsert <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hmem_hinsert<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">HCollect</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hf <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> hf <span class="main">⇒</span> hf"</span></span> <span class="comment1">― ‹comprehension›</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">HCollect</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">u</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
  <span class="quoted">"_HCollect"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"idt <span class="main">⇒</span> hf <span class="main">⇒</span> bool <span class="main">⇒</span> hf"</span></span>    <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">⦃</span>_ <span class="keyword1">&lt;:</span><span class="keyword3">/ </span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword1">⦄</span><span class="keyword3">)</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_HCollect"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"idt <span class="main">⇒</span> hf <span class="main">⇒</span> bool <span class="main">⇒</span> hf"</span></span>    <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">⦃</span>_ <span class="keyword1"><span class="hidden">❙</span><b>∈</b></span><span class="keyword3">/ </span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword1">⦄</span><span class="keyword3">)</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">⦃</span><span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span><span class="main">⦄</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> HCollect <span class="main">(</span><span class="main">λ</span><span class="free">x</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="free">A</span>"</span>

<span class="keyword1" id="HF-HCollect_iff"><span class="command">lemma</span></span> HCollect_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hmem <span class="free">x</span> <span class="main">(</span>HCollect <span class="free">P</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">P</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> comprehension <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HCollect_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> theI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hf_ext<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HF-HCollectI"><span class="command">lemma</span></span> HCollectI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">a</span> <span class="main">⟹</span> hmem <span class="free">a</span> <span class="main">⦃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="HF-HCollectE"><span class="command">lemma</span></span> HCollectE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">⦃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">⦄</span>"</span></span> <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="HF-HCollect_hempty"><span class="command">lemma</span></span> HCollect_hempty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"HCollect <span class="free">P</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hf_ext<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Union operators›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> hf <span class="main">::</span> <span class="quoted">sup</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"sup <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">z</span> <span class="main">⟷</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∨</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">hunion</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf <span class="main">⇒</span> hf"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊔</span>"</span> 65<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">hunion</span> <span class="main">≡</span> sup"</span></span>

<span class="keyword1" id="HF-hunion_iff"><span class="command">lemma</span></span> hunion_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hmem <span class="free">x</span> <span class="main">(</span><span class="free">a</span> <span class="main">⊔</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">a</span> <span class="main">∨</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> binary_union <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">a</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">b</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sup_hf_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> theI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hf_ext<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">HUnion</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf"</span></span>        <span class="main">(</span><span class="quoted">"<span class="keyword1">⨆</span>_"</span> <span class="main">[</span>900<span class="main">]</span> 900<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">HUnion</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">z</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="HF-HUnion_iff"><span class="command">lemma</span></span> HUnion_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hmem <span class="free">x</span> <span class="main">(</span><span class="main">⨆</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span> <span class="main">∧</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> union_of_set <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HUnion_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> theI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hf_ext<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HF-HUnion_hempty"><span class="command">lemma</span></span> HUnion_hempty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hf_ext<span class="main">)</span>

<span class="keyword1" id="HF-HUnion_hinsert"><span class="command">lemma</span></span> HUnion_hinsert <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="main">(</span><span class="free">A</span> <span class="main">◃</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⊔</span> <span class="main">⨆</span><span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hf_ext<span class="main">)</span>

<span class="keyword1" id="HF-HUnion_hunion"><span class="command">lemma</span></span> HUnion_hunion <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="main">(</span><span class="free">A</span> <span class="main">⊔</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span>  <span class="main">⨆</span><span class="free">A</span> <span class="main">⊔</span> <span class="main">⨆</span><span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition 1.8, Intersections›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> hf <span class="main">::</span> <span class="quoted">inf</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"inf <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">⦃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">hinter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf <span class="main">⇒</span> hf"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 70<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">hinter</span> <span class="main">≡</span> inf"</span></span>

<span class="keyword1" id="HF-hinter_iff"><span class="command">lemma</span></span> hinter_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hmem <span class="free">u</span> <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">x</span> <span class="main">∧</span> <span class="free">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HCollect_iff inf_hf_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">HInter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf"</span></span>           <span class="main">(</span><span class="quoted">"<span class="keyword1">⨅</span>_"</span> <span class="main">[</span>900<span class="main">]</span> 900<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">HInter</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">⦃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> HUnion<span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">y</span><span class="main">⦄</span>"</span></span>

<span class="keyword1" id="HF-HInter_hempty"><span class="command">lemma</span></span> HInter_hempty <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HCollect_hempty HUnion_hempty HInter_def<span class="main">)</span>

<span class="keyword1" id="HF-HInter_iff"><span class="command">lemma</span></span> HInter_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">≠</span><span class="main">0</span> <span class="main">⟹</span> hmem <span class="free">x</span> <span class="main">(</span><span class="main">⨅</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> HInter_def<span class="main">)</span>

<span class="keyword1" id="HF-HInter_hinsert"><span class="command">lemma</span></span> HInter_hinsert <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">≠</span><span class="main">0</span> <span class="main">⟹</span> <span class="main">⨅</span><span class="main">(</span><span class="free">A</span> <span class="main">◃</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⊓</span> <span class="main">⨅</span><span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hf_ext HInter_iff <span class="main"><span class="main">[</span></span><span class="operator">OF</span> hinsert_nonempty<span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Set Difference›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> hf <span class="main">::</span> <span class="quoted">minus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">⦃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="HF-hdiff_iff"><span class="command">lemma</span></span> hdiff_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hmem <span class="free">u</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">x</span> <span class="main">∧</span> <span class="free">u</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> minus_hf_def<span class="main">)</span>

<span class="keyword1" id="HF-hdiff_zero"><span class="command">lemma</span></span> hdiff_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">hf</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-zero_hdiff"><span class="command">lemma</span></span> zero_hdiff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">hf</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-hdiff_insert"><span class="command">lemma</span></span> hdiff_insert<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">-</span> <span class="main">(</span><span class="free">B</span> <span class="main">◃</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="main">-</span> <span class="free">B</span> <span class="main">-</span> <span class="main">⦃</span><span class="free">a</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-hinsert_hdiff_if"><span class="command">lemma</span></span> hinsert_hdiff_if<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">◃</span> <span class="free">x</span><span class="main">)</span> <span class="main">-</span> <span class="free">B</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span> <span class="keyword1">then</span> <span class="free">A</span> <span class="main">-</span> <span class="free">B</span> <span class="keyword1">else</span> <span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span><span class="main">)</span> <span class="main">◃</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Replacement›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 1.9 (Replacement Scheme).›</span></span>
<span class="keyword1" id="HF-replacement"><span class="command">lemma</span></span> replacement<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">u</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">.</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">R</span> <span class="bound">u</span> <span class="bound">v</span> <span class="main">⟶</span> <span class="free">R</span> <span class="bound">u</span> <span class="bound">v'</span> <span class="main">⟶</span> <span class="bound">v'</span><span class="main">=</span><span class="bound">v</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">z</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">x</span> <span class="main">∧</span> <span class="free">R</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hf_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hmem_hempty<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>hinsert <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> hmem_hinsert<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HF-replacement_fun"><span class="command">lemma</span></span> replacement_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">z</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">x</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> replacement <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> R <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">u</span></span></span> <span class="bound"><span class="bound"><span class="bound">v</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="bound"><span class="bound"><span class="bound">v</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="free"><span class="free"><span class="free">f</span></span></span> <span class="bound"><span class="bound"><span class="bound">u</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">PrimReplace</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> <span class="main">(</span>hf <span class="main">⇒</span> hf <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">PrimReplace</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">z</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="bound">u</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Replace</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> <span class="main">(</span>hf <span class="main">⇒</span> hf <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Replace</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main">=</span> PrimReplace <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">∃!</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="bound">x</span> <span class="bound">z</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">RepFun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> <span class="main">(</span>hf <span class="main">⇒</span> hf<span class="main">)</span> <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">RepFun</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> Replace <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">syntax</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
  <span class="quoted">"_HReplace"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span> pttrn<span class="main">,</span> hf<span class="main">,</span> bool<span class="main">]</span> <span class="main">⇒</span> hf"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">{|</span>_ <span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword1">&lt;:</span> _<span class="keyword1">,</span> _<span class="keyword1">|}</span><span class="keyword3">)</span>"</span><span class="main">)</span>
  <span class="quoted">"_HRepFun"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>hf<span class="main">,</span> pttrn<span class="main">,</span> hf<span class="main">]</span> <span class="main">⇒</span> hf"</span></span>          <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">{|</span>_ <span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword1">&lt;:</span> _<span class="keyword1">|}</span><span class="keyword3">)</span>"</span> <span class="main">[</span>51<span class="main">,</span>0<span class="main">,</span>51<span class="main">]</span><span class="main">)</span>
  <span class="quoted">"_HINTER"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span> hf<span class="main">,</span> hf<span class="main">]</span> <span class="main">⇒</span> hf"</span></span>          <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">INT</span> _<span class="keyword1">&lt;:</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> 10<span class="main">)</span>
  <span class="quoted">"_HUNION"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span> hf<span class="main">,</span> hf<span class="main">]</span> <span class="main">⇒</span> hf"</span></span>          <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">UN</span> _<span class="keyword1">&lt;:</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> 10<span class="main">)</span>
<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_HReplace"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span> pttrn<span class="main">,</span> hf<span class="main">,</span> bool<span class="main">]</span> <span class="main">⇒</span> hf"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">⦃</span>_ <span class="keyword1">.</span><span class="keyword3">/ </span>_ <span class="keyword1"><span class="hidden">❙</span><b>∈</b></span> _<span class="keyword1">,</span> _<span class="keyword1">⦄</span><span class="keyword3">)</span>"</span><span class="main">)</span>
  <span class="quoted">"_HRepFun"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>hf<span class="main">,</span> pttrn<span class="main">,</span> hf<span class="main">]</span> <span class="main">⇒</span> hf"</span></span>          <span class="main">(</span><span class="quoted">"<span class="keyword3">(1</span><span class="keyword1">⦃</span>_ <span class="keyword1">.</span><span class="keyword3">/ </span>_ <span class="keyword1"><span class="hidden">❙</span><b>∈</b></span> _<span class="keyword1">⦄</span><span class="keyword3">)</span>"</span> <span class="main">[</span>51<span class="main">,</span>0<span class="main">,</span>51<span class="main">]</span><span class="main">)</span>
  <span class="quoted">"_HINTER"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span> hf<span class="main">,</span> hf<span class="main">]</span> <span class="main">⇒</span> hf"</span></span>          <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">⨅</span>_<span class="keyword1"><span class="hidden">❙</span><b>∈</b></span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> 10<span class="main">)</span>
  <span class="quoted">"_HUNION"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span> hf<span class="main">,</span> hf<span class="main">]</span> <span class="main">⇒</span> hf"</span></span>          <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">⨆</span>_<span class="keyword1"><span class="hidden">❙</span><b>∈</b></span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> 10<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">⦃</span><span class="free">y</span><span class="main">.</span> <span class="free">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">,</span> <span class="free">Q</span><span class="main">⦄</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> Replace <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="free">x</span> <span class="free">y</span><span class="main">.</span> <span class="free">Q</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="main">⦃</span><span class="free">b</span><span class="main">.</span> <span class="free">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">⦄</span>"</span>    <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> RepFun <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="free">x</span><span class="main">.</span> <span class="free">b</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="main">⨅</span><span class="free">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">B</span>"</span>    <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> HInter<span class="main">(</span><span class="keyword1">CONST</span> RepFun <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="free">x</span><span class="main">.</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="main">⨆</span><span class="free">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">B</span>"</span>    <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> HUnion<span class="main">(</span><span class="keyword1">CONST</span> RepFun <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="free">x</span><span class="main">.</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span>

<span class="keyword1" id="HF-PrimReplace_iff"><span class="command">lemma</span></span> PrimReplace_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span> <span class="bound">v</span> <span class="bound">v'</span><span class="main">.</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span> <span class="main">⟶</span> <span class="free">R</span> <span class="bound">u</span> <span class="bound">v</span> <span class="main">⟶</span> <span class="free">R</span> <span class="bound">u</span> <span class="bound">v'</span> <span class="main">⟶</span> <span class="bound">v'</span><span class="main">=</span><span class="bound">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">(</span>PrimReplace <span class="free">A</span> <span class="free">R</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span> <span class="main">∧</span> <span class="free">R</span> <span class="bound">u</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> replacement <span class="main"><span class="main">[</span></span><span class="operator">OF</span> sv<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PrimReplace_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> theI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hf_ext<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HF-Replace_iff"><span class="command">lemma</span></span> Replace_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> Replace <span class="free">A</span> <span class="free">R</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span> <span class="main">∧</span> <span class="free">R</span> <span class="bound">u</span> <span class="free">v</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">R</span> <span class="bound">u</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">y</span><span class="main">=</span><span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Replace_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> PrimReplace_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HF-Replace_0"><span class="command">lemma</span></span> Replace_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Replace <span class="main">0</span> <span class="free">R</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-Replace_hunion"><span class="command">lemma</span></span> Replace_hunion <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Replace <span class="main">(</span><span class="free">A</span> <span class="main">⊔</span> <span class="free">B</span><span class="main">)</span> <span class="free">R</span> <span class="main">=</span> Replace <span class="free">A</span> <span class="free">R</span>  <span class="main">⊔</span>  Replace <span class="free">B</span> <span class="free">R</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-Replace_cong"><span class="command">lemma</span></span> Replace_cong <span class="main">[</span><span class="operator">cong</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">A</span><span class="main">=</span><span class="free">B</span><span class="main">;</span>  <span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟷</span> <span class="free">Q</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">⟧</span>  <span class="main">⟹</span> Replace <span class="free">A</span> <span class="free">P</span> <span class="main">=</span> Replace <span class="free">B</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hf_ext <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> conj_cong<span class="main">)</span>

<span class="keyword1" id="HF-RepFun_iff"><span class="command">lemma</span></span> RepFun_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">(</span>RepFun <span class="free">A</span> <span class="free">f</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> RepFun_def<span class="main">)</span>

<span class="keyword1" id="HF-RepFun_cong"><span class="command">lemma</span></span> RepFun_cong <span class="main">[</span><span class="operator">cong</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">A</span><span class="main">=</span><span class="free">B</span><span class="main">;</span>  <span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">f</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">=</span><span class="free">g</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">⟧</span>  <span class="main">⟹</span> RepFun <span class="free">A</span> <span class="free">f</span> <span class="main">=</span> RepFun <span class="free">B</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> RepFun_def<span class="main">)</span>

<span class="keyword1" id="HF-triv_RepFun"><span class="command">lemma</span></span> triv_RepFun <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"RepFun <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-RepFun_0"><span class="command">lemma</span></span> RepFun_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"RepFun <span class="main">0</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-RepFun_hinsert"><span class="command">lemma</span></span> RepFun_hinsert <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"RepFun <span class="main">(</span>hinsert <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> hinsert <span class="main">(</span><span class="free">f</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span>RepFun <span class="free">b</span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-RepFun_hunion"><span class="command">lemma</span></span> RepFun_hunion <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"RepFun <span class="main">(</span><span class="free">A</span> <span class="main">⊔</span> <span class="free">B</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> RepFun <span class="free">A</span> <span class="free">f</span>  <span class="main">⊔</span>  RepFun <span class="free">B</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-HF_HUnion"><span class="command">lemma</span></span> HF_HUnion<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>finite <span class="free">A</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span> finite <span class="main">(</span><span class="free">B</span> <span class="bound">x</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> HF <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span>HF <span class="free">A</span><span class="main">.</span> HF <span class="main">(</span><span class="free">B</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hf_equalityI<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Subset relation and the Lattice Properties›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Definition 1.10 (Subset relation).›</span></span>
<span class="keyword1"><span class="command">instantiation</span></span> hf <span class="main">::</span> <span class="quoted">order</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">less_eq_hf</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">less_hf</span></span>    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≠</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">::</span>hf<span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_hf_def less_hf_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Rules for subsets›</span></span>

<span class="keyword1" id="HF-hsubsetI"><span class="command">lemma</span></span> hsubsetI <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span> <span class="main">⟹</span> <span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">B</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">≤</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_hf_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Classical elimination rule›</span></span>
<span class="keyword1" id="HF-hsubsetCE"><span class="command">lemma</span></span> hsubsetCE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">A</span> <span class="main">≤</span> <span class="free">B</span><span class="main">;</span>  <span class="free">c</span><span class="main"><span class="hidden">❙</span><b>∉</b></span><span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">;</span>  <span class="free">c</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">B</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">⟧</span>  <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_hf_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Rule in Modus Ponens style›</span></span>
<span class="keyword1" id="HF-hsubsetD"><span class="command">lemma</span></span> hsubsetD <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">A</span> <span class="main">≤</span> <span class="free">B</span><span class="main">;</span>  <span class="free">c</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">c</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_hf_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sometimes useful with premises in this order›</span></span>
<span class="keyword1" id="HF-rev_hsubsetD"><span class="command">lemma</span></span> rev_hsubsetD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">c</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">;</span> <span class="free">A</span><span class="main">≤</span><span class="free">B</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">c</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-contra_hsubsetD"><span class="command">lemma</span></span> contra_hsubsetD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">A</span> <span class="main">≤</span> <span class="free">B</span><span class="main">;</span> <span class="free">c</span> <span class="main">∉</span> <span class="free">B</span> <span class="main">⟧</span>  <span class="main">⟹</span> <span class="free">c</span> <span class="main">∉</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-rev_contra_hsubsetD"><span class="command">lemma</span></span> rev_contra_hsubsetD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">c</span> <span class="main">∉</span> <span class="free">B</span><span class="main">;</span>  <span class="free">A</span> <span class="main">≤</span> <span class="free">B</span> <span class="main">⟧</span>  <span class="main">⟹</span> <span class="free">c</span> <span class="main">∉</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-hf_equalityE"><span class="command">lemma</span></span> hf_equalityE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted">hf</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="free">B</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">A</span> <span class="main">≤</span> <span class="free">B</span> <span class="main">⟹</span> <span class="free">B</span> <span class="main">≤</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> order_refl<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Lattice properties›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> hf <span class="main">::</span> <span class="quoted">distrib_lattice</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_hf_def less_hf_def inf_hf_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> hf <span class="main">::</span> <span class="quoted">bounded_lattice_bot</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"bot <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>hf<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_hf_def bot_hf_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="HF-hinter_hempty_left"><span class="command">lemma</span></span> hinter_hempty_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊓</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_hf_def inf_bot_left<span class="main">)</span>

<span class="keyword1" id="HF-hinter_hempty_right"><span class="command">lemma</span></span> hinter_hempty_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊓</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_hf_def inf_bot_right<span class="main">)</span>

<span class="keyword1" id="HF-hunion_hempty_left"><span class="command">lemma</span></span> hunion_hempty_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">⊔</span> <span class="free">A</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_hf_def sup_bot_left<span class="main">)</span>

<span class="keyword1" id="HF-hunion_hempty_right"><span class="command">lemma</span></span> hunion_hempty_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊔</span> <span class="main">0</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot_hf_def sup_bot_right<span class="main">)</span>

<span class="keyword1" id="HF-less_eq_hempty"><span class="command">lemma</span></span> less_eq_hempty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">u</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>hf<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hempty_iff less_eq_hf_def<span class="main">)</span>

<span class="keyword1" id="HF-less_eq_insert1_iff"><span class="command">lemma</span></span> less_eq_insert1_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hinsert <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">z</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_hf_def<span class="main">)</span>

<span class="keyword1" id="HF-less_eq_insert2_iff"><span class="command">lemma</span></span> less_eq_insert2_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≤</span> <span class="main">(</span>hinsert <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> hinsert <span class="free">x</span> <span class="bound">u</span> <span class="main">=</span> <span class="free">z</span> <span class="main">∧</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="bound">u</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≤</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">z</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"hinsert <span class="free">x</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">⦃</span><span class="free">x</span><span class="main">⦄</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≤</span> <span class="main">(</span>hinsert <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> hinsert <span class="free">x</span> <span class="bound">u</span> <span class="main">=</span> <span class="free">z</span> <span class="main">∧</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="bound">u</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≤</span> <span class="free">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_hf_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> u hdiff_iff hmem_hinsert<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> hinsert <span class="free">x</span> <span class="bound">u</span> <span class="main">=</span> <span class="free">z</span> <span class="main">∧</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="bound">u</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">≤</span> <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≤</span> <span class="main">(</span>hinsert <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_hf_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hmem_hinsert less_eq_hf_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HF-zero_le"><span class="command">lemma</span></span> zero_le <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span><span class="main">::</span>hf<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-hinsert_eq_sup"><span class="command">lemma</span></span> hinsert_eq_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">◃</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">⊔</span> <span class="main">⦃</span><span class="free">a</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-hunion_hinsert_left"><span class="command">lemma</span></span> hunion_hinsert_left<span class="main">:</span> <span class="quoted"><span class="quoted">"hinsert <span class="free">x</span> <span class="free">A</span> <span class="main">⊔</span> <span class="free">B</span> <span class="main">=</span> hinsert <span class="free">x</span> <span class="main">(</span><span class="free">A</span> <span class="main">⊔</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-hunion_hinsert_right"><span class="command">lemma</span></span> hunion_hinsert_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊔</span> hinsert <span class="free">x</span> <span class="free">A</span> <span class="main">=</span> hinsert <span class="free">x</span> <span class="main">(</span><span class="free">B</span> <span class="main">⊔</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-hinter_hinsert_left"><span class="command">lemma</span></span> hinter_hinsert_left<span class="main">:</span> <span class="quoted"><span class="quoted">"hinsert <span class="free">x</span> <span class="free">A</span> <span class="main">⊓</span> <span class="free">B</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span> <span class="keyword1">then</span> hinsert <span class="free">x</span> <span class="main">(</span><span class="free">A</span> <span class="main">⊓</span> <span class="free">B</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">A</span> <span class="main">⊓</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="HF-hinter_hinsert_right"><span class="command">lemma</span></span> hinter_hinsert_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊓</span> hinsert <span class="free">x</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span> <span class="keyword1">then</span> hinsert <span class="free">x</span> <span class="main">(</span><span class="free">B</span> <span class="main">⊓</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">B</span> <span class="main">⊓</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Foundation, Cardinality, Powersets›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Foundation›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 1.13: Foundation (Regularity) Property.›</span></span>
<span class="keyword1" id="HF-foundation"><span class="command">lemma</span></span> foundation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">z</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">z</span> <span class="main">⟶</span> <span class="bound">w</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="free">z</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">⊓</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hf_induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hinter_hempty_left z<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>hinsert <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hinter_hinsert_left z<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> z
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> z hempty_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="HF-hmem_not_refl"><span class="command">lemma</span></span> hmem_not_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> foundation <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">x</span><span class="main">⦄</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hinter_iff hmem_hempty hmem_hinsert<span class="main">)</span>

<span class="keyword1" id="HF-hmem_not_sym"><span class="command">lemma</span></span> hmem_not_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> foundation <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⦄</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hinter_iff hmem_hempty hmem_hinsert<span class="main">)</span>

<span class="keyword1" id="HF-hmem_ne"><span class="command">lemma</span></span> hmem_ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hmem_not_refl<span class="main">)</span>

<span class="keyword1" id="HF-hmem_Sup_ne"><span class="command">lemma</span></span> hmem_Sup_ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">⨆</span><span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HUnion_iff hmem_not_sym<span class="main">)</span>

<span class="keyword1" id="HF-hpair_neq_fst"><span class="command">lemma</span></span> hpair_neq_fst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hpair_def hinsert_iff hmem_not_sym<span class="main">)</span>

<span class="keyword1" id="HF-hpair_neq_snd"><span class="command">lemma</span></span> hpair_neq_snd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hpair_def hinsert_iff hmem_not_sym<span class="main">)</span>

<span class="keyword1" id="HF-hpair_nonzero"><span class="command">lemma</span></span> hpair_nonzero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hpair_def<span class="main">)</span>

<span class="keyword1" id="HF-zero_notin_hpair"><span class="command">lemma</span></span> zero_notin_hpair<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hpair_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cardinality›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First we need to hack the underlying representation›</span></span>
<span class="keyword1" id="HF-hfset_0"><span class="command">lemma</span></span> hfset_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hfset <span class="main">0</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Zero_hf_def finite.emptyI hfset_HF<span class="main">)</span>

<span class="keyword1" id="HF-hfset_hinsert"><span class="command">lemma</span></span> hfset_hinsert<span class="main">:</span> <span class="quoted"><span class="quoted">"hfset <span class="main">(</span><span class="free">b</span> <span class="main">◃</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> insert <span class="free">a</span> <span class="main">(</span>hfset <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_insert hinsert_def HF.finite_hfset hfset_HF<span class="main">)</span>

<span class="keyword1" id="HF-hfset_hdiff"><span class="command">lemma</span></span> hfset_hdiff<span class="main">:</span> <span class="quoted"><span class="quoted">"hfset <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> hfset <span class="free">x</span> <span class="main">-</span> hfset <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hf_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>hinsert <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hfset_hinsert Set.insert_Diff_if hinsert_hdiff_if hmem_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hcard</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hcard</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> card <span class="main">(</span>hfset <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="HF-hcard_0"><span class="command">lemma</span></span> hcard_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hcard <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hcard_def<span class="main">)</span>

<span class="keyword1" id="HF-hcard_hinsert_if"><span class="command">lemma</span></span> hcard_hinsert_if<span class="main">:</span> <span class="quoted"><span class="quoted">"hcard <span class="main">(</span>hinsert <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">y</span> <span class="keyword1">then</span> hcard <span class="free">y</span> <span class="keyword1">else</span> Suc <span class="main">(</span>hcard <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hcard_def hfset_hinsert card_insert_if hmem_def<span class="main">)</span>

<span class="keyword1" id="HF-hcard_union_inter"><span class="command">lemma</span></span> hcard_union_inter<span class="main">:</span> <span class="quoted"><span class="quoted">"hcard <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span> <span class="main">+</span> hcard <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> hcard <span class="free">x</span> <span class="main">+</span> hcard <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hf_induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hcard_hinsert_if hunion_hinsert_left hinter_hinsert_left<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HF-hcard_hdiff1_less"><span class="command">lemma</span></span> hcard_hdiff1_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">z</span> <span class="main">⟹</span> hcard <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="main">⦃</span><span class="free">x</span><span class="main">⦄</span><span class="main">)</span> <span class="main">&lt;</span> hcard <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hcard_def hfset_hdiff hfset_hinsert<span class="main">)</span>
     <span class="main">(</span><span class="operator">metis</span> card_Diff1_less finite_hfset hmem_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Powerset Operator›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 1.11 (Existence of the power set).›</span></span>
<span class="keyword1" id="HF-powerset"><span class="command">lemma</span></span> powerset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">z</span> <span class="main">⟷</span> <span class="bound">u</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hf_induct<span class="main">)</span>
 <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hmem_hempty hmem_hinsert less_eq_hempty<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>hinsert <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Pb</span></span> <span class="keyword2"><span class="keyword">where</span></span> Pb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="skolem">Pb</span> <span class="main">⟷</span> <span class="bound">u</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">RPb</span></span> <span class="keyword2"><span class="keyword">where</span></span> RPb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="skolem">RPb</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="skolem">Pb</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">=</span> hinsert <span class="skolem">a</span> <span class="bound">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> replacement_fun <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Pb binary_union <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Pb</span></span> <span class="quoted"><span class="skolem">RPb</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_insert2_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">z</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> hinsert.hyps less_eq_hf_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">HPow</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">HPow</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">z</span><span class="main">.</span> <span class="main">∀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">z</span> <span class="main">⟷</span> <span class="bound">u</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="HF-HPow_iff"><span class="command">lemma</span></span> HPow_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> HPow <span class="free">x</span> <span class="main">⟷</span> <span class="free">u</span> <span class="main">≤</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> powerset <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HPow_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> theI2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hf_ext<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="HF-HPow_mono"><span class="command">lemma</span></span> HPow_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> HPow <span class="free">x</span> <span class="main">≤</span> HPow <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HPow_iff less_eq_hf_def order_trans<span class="main">)</span>

<span class="keyword1" id="HF-HPow_mono_strict"><span class="command">lemma</span></span> HPow_mono_strict<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span> <span class="main">⟹</span> HPow <span class="free">x</span> <span class="main">&lt;</span> HPow <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HPow_iff HPow_mono less_le_not_le order_eq_iff<span class="main">)</span>

<span class="keyword1" id="HF-HPow_mono_iff"><span class="command">lemma</span></span> HPow_mono_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"HPow <span class="free">x</span> <span class="main">≤</span> HPow <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HPow_iff HPow_mono hsubsetCE order_refl<span class="main">)</span>

<span class="keyword1" id="HF-HPow_mono_strict_iff"><span class="command">lemma</span></span> HPow_mono_strict_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"HPow <span class="free">x</span> <span class="main">&lt;</span> HPow <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HPow_mono_iff less_le_not_le<span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Bounded Quantifiers›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">HBall</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> <span class="main">(</span>hf <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">HBall</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>   <span class="comment1">― ‹bounded universal quantifiers›</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">HBex</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> <span class="main">(</span>hf <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">HBex</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>   <span class="comment1">― ‹bounded existential quantifiers›</span>

<span class="keyword1"><span class="command">syntax</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
  <span class="quoted">"_HBall"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> hf <span class="main">⇒</span> bool <span class="main">⇒</span> bool"</span></span>      <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">ALL</span> _<span class="keyword1">&lt;:</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_HBex"</span>        <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> hf <span class="main">⇒</span> bool <span class="main">⇒</span> bool"</span></span>      <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">EX</span> _<span class="keyword1">&lt;:</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span>  <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_HBex1"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> hf <span class="main">⇒</span> bool <span class="main">⇒</span> bool"</span></span>      <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">EX!</span> _<span class="keyword1">&lt;:</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_HBall"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> hf <span class="main">⇒</span> bool <span class="main">⇒</span> bool"</span></span>      <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">∀</span>_<span class="keyword1"><span class="hidden">❙</span><b>∈</b></span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span>  <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_HBex"</span>        <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> hf <span class="main">⇒</span> bool <span class="main">⇒</span> bool"</span></span>      <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">∃</span>_<span class="keyword1"><span class="hidden">❙</span><b>∈</b></span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span>  <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
  <span class="quoted">"_HBex1"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> hf <span class="main">⇒</span> bool <span class="main">⇒</span> bool"</span></span>      <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">∃!</span>_<span class="keyword1"><span class="hidden">❙</span><b>∈</b></span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">∀</span><span class="free">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">P</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> HBall <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="free">x</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="main">∃</span><span class="free">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">P</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> HBex <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="free">x</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="main">∃!</span><span class="free">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">P</span>"</span> <span class="main">⇀</span> <span class="quoted">"<span class="main">∃!</span><span class="free">x</span><span class="main">.</span> <span class="free">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">∧</span> <span class="free">P</span>"</span>

<span class="keyword1" id="HF-hball_cong"><span class="command">lemma</span></span> hball_cong <span class="main">[</span><span class="operator">cong</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">A</span><span class="main">=</span><span class="free">A'</span><span class="main">;</span>  <span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A'</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">P'</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">⟧</span>  <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A'</span><span class="main">.</span> <span class="free">P'</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HBall_def<span class="main">)</span>

<span class="keyword1" id="HF-hballI"><span class="command">lemma</span></span> hballI <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HBall_def<span class="main">)</span>

<span class="keyword1" id="HF-hbspec"><span class="command">lemma</span></span> hbspec <span class="main">[</span><span class="operator">dest</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HBall_def<span class="main">)</span>

<span class="keyword1" id="HF-hballE"><span class="command">lemma</span></span> hballE <span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> HBall_def<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="HF-hbex_cong"><span class="command">lemma</span></span> hbex_cong <span class="main">[</span><span class="operator">cong</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">A</span><span class="main">=</span><span class="free">A'</span><span class="main">;</span>  <span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A'</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">P'</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">⟧</span>  <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A'</span><span class="main">.</span> <span class="free">P'</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HBex_def <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> conj_cong<span class="main">)</span>

<span class="keyword1" id="HF-hbexI"><span class="command">lemma</span></span> hbexI <span class="main">[</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> HBex_def<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="HF-rev_hbexI"><span class="command">lemma</span></span> rev_hbexI <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">x</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> HBex_def<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="HF-bexCI"><span class="command">lemma</span></span> bexCI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">a</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">a</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> HBex_def<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="HF-hbexE"><span class="command">lemma</span></span> hbexE <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> HBex_def<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="HF-hball_triv"><span class="command">lemma</span></span> hball_triv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹trivial rewrite rule.›</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HBall_def<span class="main">)</span>

<span class="keyword1" id="HF-hbex_triv"><span class="command">lemma</span></span> hbex_triv <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="comment1">― ‹Dual form for existentials.›</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HBex_def<span class="main">)</span>

<span class="keyword1" id="HF-hbex_triv_one_point1"><span class="command">lemma</span></span> hbex_triv_one_point1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-hbex_triv_one_point2"><span class="command">lemma</span></span> hbex_triv_one_point2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-hbex_one_point1"><span class="command">lemma</span></span> hbex_one_point1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span> <span class="main">∧</span> <span class="free">P</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-hbex_one_point2"><span class="command">lemma</span></span> hbex_one_point2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span> <span class="main">∧</span> <span class="free">P</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-hball_one_point1"><span class="command">lemma</span></span> hball_one_point1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">a</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span> <span class="main">⟶</span> <span class="free">P</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-hball_one_point2"><span class="command">lemma</span></span> hball_one_point2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span> <span class="main">⟶</span> <span class="free">P</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-hball_conj_distrib"><span class="command">lemma</span></span> hball_conj_distrib<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-hbex_disj_distrib"><span class="command">lemma</span></span> hbex_disj_distrib<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">∨</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-hb_all_simps"><span class="command">lemma</span></span> hb_all_simps <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">no_atp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">P</span> <span class="bound">Q</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">A</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span> <span class="main">∨</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">A</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">P</span> <span class="bound">Q</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">A</span><span class="main">.</span> <span class="bound">P</span> <span class="main">∨</span> <span class="bound">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">P</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">A</span><span class="main">.</span> <span class="bound">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">P</span> <span class="bound">Q</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">A</span><span class="main">.</span> <span class="bound">P</span> <span class="main">⟶</span> <span class="bound">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">A</span><span class="main">.</span> <span class="bound">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">P</span> <span class="bound">Q</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">A</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">A</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">0</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> True"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">B</span> <span class="bound">P</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">B</span> <span class="main">◃</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">P</span> <span class="bound">a</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">B</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span> <span class="bound">Q</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> HCollect <span class="bound">Q</span> <span class="free">A</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span><span class="main">.</span> <span class="bound">Q</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">P</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">A</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">A</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="HF-hb_ex_simps"><span class="command">lemma</span></span> hb_ex_simps <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">no_atp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">P</span> <span class="bound">Q</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">A</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">Q</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">A</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">Q</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">P</span> <span class="bound">Q</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">A</span><span class="main">.</span> <span class="bound">P</span> <span class="main">∧</span> <span class="bound">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">A</span><span class="main">.</span> <span class="bound">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">0</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> False"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">B</span> <span class="bound">P</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">B</span> <span class="main">◃</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="bound">P</span> <span class="bound">a</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">B</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span> <span class="bound">Q</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> HCollect <span class="bound">Q</span> <span class="free">A</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span><span class="main">.</span> <span class="bound">Q</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">P</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">A</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">A</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="HF-le_HCollect_iff"><span class="command">lemma</span></span> le_HCollect_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≤</span> <span class="main">⦃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">⦄</span> <span class="main">⟷</span> <span class="free">A</span> <span class="main">≤</span> <span class="free">B</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Relations and Functions›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_hpair</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_hpair</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">⟩</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hconverse</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hconverse</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">⦃</span><span class="bound">z</span><span class="main">.</span> <span class="bound">w</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span> <span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">w</span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">⟩</span> <span class="main">∧</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">⟩</span><span class="main">⦄</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hdomain</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hdomain</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">⦃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">w</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span> <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="bound">w</span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">⟩</span><span class="main">⦄</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hrange</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hrange</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> hdomain<span class="main">(</span>hconverse<span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hrelation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hrelation</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">⟶</span> is_hpair <span class="bound">z</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hrestrict</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf <span class="main">⇒</span> hf"</span></span>
  <span class="comment1">― ‹Restrict the relation r to the domain A›</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hrestrict</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">⦃</span><span class="bound">z</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">⟩</span><span class="main">⦄</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nonrestrict</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">nonrestrict</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">⦃</span><span class="bound">z</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">z</span> <span class="main">≠</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">⟩</span><span class="main">⦄</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hfunction</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">hfunction</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y'</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="bound">y'</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">⟶</span> <span class="bound">y</span><span class="main">=</span><span class="bound">y'</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">app</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">app</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> <span class="bound">y</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="HF-hrestrict_iff"><span class="command">lemma</span></span> hrestrict_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> hrestrict <span class="free">r</span> <span class="free">A</span> <span class="main">⟷</span> <span class="free">z</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">r</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">z</span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">⟩</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hrestrict_def<span class="main">)</span>

<span class="keyword1" id="HF-hrelation_0"><span class="command">lemma</span></span> hrelation_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hrelation <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hrelation_def<span class="main">)</span>

<span class="keyword1" id="HF-hrelation_restr"><span class="command">lemma</span></span> hrelation_restr <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hrelation <span class="main">(</span>hrestrict <span class="free">r</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hrelation_def hrestrict_iff is_hpair_def<span class="main">)</span>

<span class="keyword1" id="HF-hrelation_hunion"><span class="command">lemma</span></span> hrelation_hunion <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hrelation <span class="main">(</span><span class="free">f</span> <span class="main">⊔</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟷</span> hrelation <span class="free">f</span> <span class="main">∧</span> hrelation <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hrelation_def<span class="main">)</span>

<span class="keyword1" id="HF-hfunction_restr"><span class="command">lemma</span></span> hfunction_restr<span class="main">:</span> <span class="quoted"><span class="quoted">"hfunction <span class="free">r</span> <span class="main">⟹</span> hfunction <span class="main">(</span>hrestrict <span class="free">r</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hfunction_def hrestrict_def<span class="main">)</span>

<span class="keyword1" id="HF-hdomain_restr"><span class="command">lemma</span></span> hdomain_restr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hdomain <span class="main">(</span>hrestrict <span class="free">r</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> hdomain <span class="free">r</span> <span class="main">⊓</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hdomain_def hrestrict_def<span class="main">)</span>

<span class="keyword1" id="HF-hdomain_0"><span class="command">lemma</span></span> hdomain_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hdomain <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hdomain_def<span class="main">)</span>

<span class="keyword1" id="HF-hdomain_ins"><span class="command">lemma</span></span> hdomain_ins <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hdomain <span class="main">(</span><span class="free">r</span> <span class="main">◃</span> <span class="main">⟨</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> hdomain <span class="free">r</span> <span class="main">◃</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hdomain_def<span class="main">)</span>

<span class="keyword1" id="HF-hdomain_hunion"><span class="command">lemma</span></span> hdomain_hunion <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hdomain <span class="main">(</span><span class="free">f</span> <span class="main">⊔</span> <span class="free">g</span><span class="main">)</span> <span class="main">=</span> hdomain <span class="free">f</span> <span class="main">⊔</span> hdomain <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hdomain_def<span class="main">)</span>

<span class="keyword1" id="HF-hdomain_not_mem"><span class="command">lemma</span></span> hdomain_not_mem <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span>hdomain <span class="free">r</span><span class="main">,</span> <span class="free">a</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hdomain_ins hinter_hinsert_right hmem_hinsert hmem_not_refl
            hunion_hinsert_right sup_inf_absorb<span class="main">)</span>

<span class="keyword1" id="HF-app_singleton"><span class="command">lemma</span></span> app_singleton <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"app <span class="main">⦃</span><span class="main">⟨</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">⟩</span><span class="main">⦄</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> app_def<span class="main">)</span>

<span class="keyword1" id="HF-app_equality"><span class="command">lemma</span></span> app_equality<span class="main">:</span> <span class="quoted"><span class="quoted">"hfunction <span class="free">f</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">f</span> <span class="main">⟹</span> app <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> app_def hfunction_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> the1I2<span class="main">)</span>

<span class="keyword1" id="HF-app_ins2"><span class="command">lemma</span></span> app_ins2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x'</span> <span class="main">≠</span> <span class="free">x</span> <span class="main">⟹</span> app <span class="main">(</span><span class="free">f</span> <span class="main">◃</span> <span class="main">⟨</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">⟩</span><span class="main">)</span> <span class="free">x'</span> <span class="main">=</span> app <span class="free">f</span> <span class="free">x'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> app_def<span class="main">)</span>

<span class="keyword1" id="HF-hfunction_0"><span class="command">lemma</span></span> hfunction_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hfunction <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hfunction_def<span class="main">)</span>

<span class="keyword1" id="HF-hfunction_ins"><span class="command">lemma</span></span> hfunction_ins<span class="main">:</span> <span class="quoted"><span class="quoted">"hfunction <span class="free">f</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> hdomain <span class="free">f</span> <span class="main">⟹</span> hfunction <span class="main">(</span><span class="free">f</span><span class="main">◃</span> <span class="main">⟨</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">⟩</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hfunction_def hdomain_def<span class="main">)</span>

<span class="keyword1" id="HF-hdomainI"><span class="command">lemma</span></span> hdomainI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">f</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> hdomain <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hdomain_def<span class="main">)</span>

<span class="keyword1" id="HF-hfunction_hunion"><span class="command">lemma</span></span> hfunction_hunion<span class="main">:</span> <span class="quoted"><span class="quoted">"hdomain <span class="free">f</span> <span class="main">⊓</span> hdomain <span class="free">g</span> <span class="main">=</span> <span class="main">0</span>
            <span class="main">⟹</span> hfunction <span class="main">(</span><span class="free">f</span> <span class="main">⊔</span> <span class="free">g</span><span class="main">)</span> <span class="main">⟷</span> hfunction <span class="free">f</span> <span class="main">∧</span> hfunction <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hfunction_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> hdomainI hinter_iff hmem_hempty<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="HF-app_hrestrict"><span class="command">lemma</span></span> app_hrestrict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span> <span class="main">⟹</span> app <span class="main">(</span>hrestrict <span class="free">f</span> <span class="free">A</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> app <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hrestrict_def app_def<span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Operations on families of sets›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">HLambda</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> <span class="main">(</span>hf <span class="main">⇒</span> hf<span class="main">)</span> <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">HLambda</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> RepFun <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">x</span><span class="main">⟩</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">HSigma</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> <span class="main">(</span>hf <span class="main">⇒</span> hf<span class="main">)</span> <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">HSigma</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">⨆</span><span class="bound">y</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">⦃</span><span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">⟩</span><span class="main">⦄</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">HPi</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> <span class="main">(</span>hf <span class="main">⇒</span> hf<span class="main">)</span> <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">HPi</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">⦃</span> <span class="bound">f</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> HPow<span class="main">(</span>HSigma <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≤</span> hdomain<span class="main">(</span><span class="bound">f</span><span class="main">)</span> <span class="main">∧</span> hfunction<span class="main">(</span><span class="bound">f</span><span class="main">)</span><span class="main">⦄</span>"</span></span>


<span class="keyword1"><span class="command">syntax</span></span> <span class="main">(</span>ASCII<span class="main">)</span>
  <span class="quoted">"_PROD"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span> hf<span class="main">,</span> hf<span class="main">]</span> <span class="main">⇒</span> hf"</span></span>        <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">PROD</span> _<span class="keyword1">&lt;:</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> 10<span class="main">)</span>
  <span class="quoted">"_SUM"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span> hf<span class="main">,</span> hf<span class="main">]</span> <span class="main">⇒</span> hf"</span></span>        <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">SUM</span> _<span class="keyword1">&lt;:</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> 10<span class="main">)</span>
  <span class="quoted">"_lam"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span> hf<span class="main">,</span> hf<span class="main">]</span> <span class="main">⇒</span> hf"</span></span>        <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">lam</span> _<span class="keyword1">&lt;:</span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> 10<span class="main">)</span>
<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_PROD"</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span> hf<span class="main">,</span> hf<span class="main">]</span> <span class="main">⇒</span> hf"</span></span>        <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">∏</span>_<span class="keyword1"><span class="hidden">❙</span><b>∈</b></span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> 10<span class="main">)</span>
  <span class="quoted">"_SUM"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span> hf<span class="main">,</span> hf<span class="main">]</span> <span class="main">⇒</span> hf"</span></span>        <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">∑</span>_<span class="keyword1"><span class="hidden">❙</span><b>∈</b></span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> 10<span class="main">)</span>
  <span class="quoted">"_lam"</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span> hf<span class="main">,</span> hf<span class="main">]</span> <span class="main">⇒</span> hf"</span></span>        <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">λ</span>_<span class="keyword1"><span class="hidden">❙</span><b>∈</b></span>_<span class="keyword1">.</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> 10<span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">∏</span><span class="free">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">B</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> HPi <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="free">x</span><span class="main">.</span> <span class="free">B</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="main">∑</span><span class="free">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">B</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> HSigma <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="free">x</span><span class="main">.</span> <span class="free">B</span><span class="main">)</span>"</span>
  <span class="quoted">"<span class="main">λ</span><span class="free">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">f</span>"</span>  <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> HLambda <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="free">x</span><span class="main">.</span> <span class="free">f</span><span class="main">)</span>"</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Rules for Unions and Intersections of families›</span></span>

<span class="keyword1" id="HF-HUN_iff"><span class="command">lemma</span></span> HUN_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">B</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">b</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(*The order of the premises presupposes that A is rigid; b may be flexible*)</span>
<span class="keyword1" id="HF-HUN_I"><span class="command">lemma</span></span> HUN_I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span><span class="main">;</span>  <span class="free">b</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span><span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">⟧</span>  <span class="main">⟹</span> <span class="free">b</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">B</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="HF-HUN_E"><span class="command">lemma</span></span> HUN_E <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">(</span><span class="main">⨆</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">B</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span><span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-HINT_iff"><span class="command">lemma</span></span> HINT_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">B</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">b</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">A</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HInter_def HBall_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> foundation hmem_hempty<span class="main">)</span>

<span class="keyword1" id="HF-HINT_I"><span class="command">lemma</span></span> HINT_I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">;</span>  <span class="free">A</span><span class="main">≠</span><span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">B</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HINT_iff<span class="main">)</span>

<span class="keyword1" id="HF-HINT_E"><span class="command">lemma</span></span> HINT_E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">b</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">(</span><span class="main">⨅</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span><span class="main">.</span> <span class="free">B</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>  <span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span><span class="main">(</span><span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> HINT_iff<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Generalized Cartesian product›</span></span>

<span class="keyword1" id="HF-HSigma_iff"><span class="command">lemma</span></span> HSigma_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> HSigma <span class="free">A</span> <span class="free">B</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span> <span class="main">∧</span> <span class="free">b</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span><span class="main">(</span><span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HSigma_def<span class="main">)</span>

<span class="keyword1" id="HF-HSigmaI"><span class="command">lemma</span></span> HSigmaI <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span><span class="main">;</span>  <span class="free">b</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span><span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">⟧</span>  <span class="main">⟹</span> <span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> HSigma <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemmas</span></span> HSigmaD1 <span class="main">=</span> HSigma_iff <span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">THEN</span> conjunct1<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> HSigmaD2 <span class="main">=</span> HSigma_iff <span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">THEN</span> conjunct2<span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The general elimination rule›</span></span>
<span class="keyword1" id="HF-HSigmaE"><span class="command">lemma</span></span> HSigmaE <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> HSigma <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="free">y</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span><span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">=</span><span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> HSigma_def<span class="main">)</span>

<span class="keyword1" id="HF-HSigmaE2"><span class="command">lemma</span></span> HSigmaE2 <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> HSigma <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span><span class="main">(</span><span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="HF-HSigma_empty1"><span class="command">lemma</span></span> HSigma_empty1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"HSigma <span class="main">0</span> <span class="free">B</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">instantiation</span></span> hf <span class="main">::</span> <span class="quoted">times</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> HSigma <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="HF-times_iff"><span class="command">lemma</span></span> times_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span> <span class="main">*</span> <span class="free">B</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span> <span class="main">∧</span> <span class="free">b</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> times_hf_def<span class="main">)</span>

<span class="keyword1" id="HF-timesI"><span class="command">lemma</span></span> timesI <span class="main">[</span><span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span><span class="main">;</span>  <span class="free">b</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span> <span class="main">⟧</span>  <span class="main">⟹</span> <span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span> <span class="main">*</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemmas</span></span> timesD1 <span class="main">=</span> times_iff <span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">THEN</span> conjunct1<span class="main">]</span>
<span class="keyword1"><span class="command">lemmas</span></span> timesD2 <span class="main">=</span> times_iff <span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">THEN</span> conjunct2<span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The general elimination rule›</span></span>
<span class="keyword1" id="HF-timesE"><span class="command">lemma</span></span> timesE <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span> <span class="main">*</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="free">y</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">=</span><span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> times_hf_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹...and a specific one›</span></span>
<span class="keyword1" id="HF-timesE2"><span class="command">lemma</span></span> timesE2 <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span> <span class="main">*</span> <span class="free">B</span>"</span></span> <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="HF-times_empty1"><span class="command">lemma</span></span> times_empty1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">*</span> <span class="free">B</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>hf<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="HF-times_empty2"><span class="command">lemma</span></span> times_empty2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">*</span><span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>hf<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-times_empty_iff"><span class="command">lemma</span></span> times_empty_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">*</span><span class="free">B</span><span class="main">=</span><span class="main">0</span> <span class="main">⟷</span> <span class="free">A</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="free">B</span><span class="main">=</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>hf<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> times_hf_def hf_ext<span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> hf <span class="main">::</span> <span class="quoted">mult_zero</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="operator">auto</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Disjoint Sum›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> hf <span class="main">::</span> <span class="quoted">zero_neq_one</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> One_hf_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="main">⦃</span><span class="main">0</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> One_hf_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> hf <span class="main">::</span> <span class="quoted">plus</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⦃</span><span class="main">0</span><span class="main">⦄</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">⊔</span> <span class="main">(</span><span class="main">⦃</span><span class="main">1</span><span class="main">⦄</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Inl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf<span class="main">⇒</span>hf"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     <span class="quoted"><span class="quoted">"<span class="free">Inl</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">⟩</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Inr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf<span class="main">⇒</span>hf"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
     <span class="quoted"><span class="quoted">"<span class="free">Inr</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">⟨</span><span class="main">1</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">⟩</span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> sum_defs <span class="main">=</span> plus_hf_def Inl_def Inr_def

<span class="keyword1" id="HF-Inl_nonzero"><span class="command">lemma</span></span> Inl_nonzero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"Inl <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inl_def hpair_nonzero<span class="main">)</span>

<span class="keyword1" id="HF-Inr_nonzero"><span class="command">lemma</span></span> Inr_nonzero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span><span class="quoted"><span class="quoted">"Inr <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Inr_def hpair_nonzero<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Introduction rules for the injections (as equivalences)›</span></span>

<span class="keyword1" id="HF-Inl_in_sum_iff"><span class="command">lemma</span></span> Inl_in_sum_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Inl<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span><span class="main">+</span><span class="free">B</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_defs<span class="main">)</span>

<span class="keyword1" id="HF-Inr_in_sum_iff"><span class="command">lemma</span></span> Inr_in_sum_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Inr<span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span><span class="main">+</span><span class="free">B</span> <span class="main">⟷</span> <span class="free">b</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_defs<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Elimination rule›</span></span>

<span class="keyword1" id="HF-sumE"><span class="command">lemma</span></span> sumE <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span><span class="main">+</span><span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">x</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">=</span>Inl<span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="free">y</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">=</span>Inr<span class="main">(</span><span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> u
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_defs<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Injection and freeness equivalences, for rewriting›</span></span>

<span class="keyword1" id="HF-Inl_iff"><span class="command">lemma</span></span> Inl_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Inl<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">=</span>Inl<span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">a</span><span class="main">=</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_defs<span class="main">)</span>

<span class="keyword1" id="HF-Inr_iff"><span class="command">lemma</span></span> Inr_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Inr<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">=</span>Inr<span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">a</span><span class="main">=</span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_defs<span class="main">)</span>

<span class="keyword1" id="HF-Inl_Inr_iff"><span class="command">lemma</span></span> Inl_Inr_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Inl<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">=</span>Inr<span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="main">⟷</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_defs<span class="main">)</span>

<span class="keyword1" id="HF-Inr_Inl_iff"><span class="command">lemma</span></span> Inr_Inl_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Inr<span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">=</span>Inl<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">⟷</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_defs<span class="main">)</span>

<span class="keyword1" id="HF-sum_empty"><span class="command">lemma</span></span> sum_empty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">+</span><span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>hf<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sum_defs<span class="main">)</span>

<span class="keyword1" id="HF-sum_iff"><span class="command">lemma</span></span> sum_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span><span class="main">+</span><span class="free">B</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span> <span class="main">∧</span> <span class="free">u</span><span class="main">=</span>Inl<span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">B</span> <span class="main">∧</span> <span class="free">u</span><span class="main">=</span>Inr<span class="main">(</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-sum_subset_iff"><span class="command">lemma</span></span> sum_subset_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted">hf</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">+</span><span class="free">B</span> <span class="main">≤</span> <span class="free">C</span><span class="main">+</span><span class="free">D</span> <span class="main">⟷</span> <span class="free">A</span><span class="main">≤</span><span class="free">C</span> <span class="main">∧</span> <span class="free">B</span><span class="main">≤</span><span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="HF-sum_equal_iff"><span class="command">lemma</span></span> sum_equal_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="main">::</span> <span class="quoted">hf</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">+</span><span class="free">B</span> <span class="main">=</span> <span class="free">C</span><span class="main">+</span><span class="free">D</span> <span class="main">⟷</span> <span class="free">A</span><span class="main">=</span><span class="free">C</span> <span class="main">∧</span> <span class="free">B</span><span class="main">=</span><span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hf_ext sum_subset_iff<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_hsum</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_hsum</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> Inl <span class="bound">x</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> Inr <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sum_case</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hf <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>hf <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> hf <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sum_case</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span>
    <span class="keyword1">THE</span> <span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> Inl <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">z</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> Inr <span class="bound">y</span> <span class="main">⟶</span> <span class="bound">z</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> is_hsum <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟶</span> <span class="bound">z</span> <span class="main">=</span> undefined<span class="main">)</span>"</span></span>

<span class="keyword1" id="HF-sum_case_Inl"><span class="command">lemma</span></span> sum_case_Inl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sum_case <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>Inl <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_case_def is_hsum_def<span class="main">)</span>

<span class="keyword1" id="HF-sum_case_Inr"><span class="command">lemma</span></span> sum_case_Inr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sum_case <span class="free">f</span> <span class="free">g</span> <span class="main">(</span>Inr <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_case_def is_hsum_def<span class="main">)</span>

<span class="keyword1" id="HF-sum_case_non"><span class="command">lemma</span></span> sum_case_non <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_hsum <span class="free">a</span> <span class="main">⟹</span> sum_case <span class="free">f</span> <span class="free">g</span> <span class="free">a</span> <span class="main">=</span> undefined"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_case_def is_hsum_def<span class="main">)</span>

<span class="keyword1" id="HF-is_hsum_cases"><span class="command">lemma</span></span> is_hsum_cases<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">z</span> <span class="main">=</span> Inl <span class="bound">x</span> <span class="main">∨</span> <span class="free">z</span> <span class="main">=</span> Inr <span class="bound">x</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> is_hsum <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_hsum_def<span class="main">)</span>

<span class="keyword1" id="HF-sum_case_split"><span class="command">lemma</span></span> sum_case_split<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>sum_case <span class="free">f</span> <span class="free">g</span> <span class="free">a</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> Inl <span class="bound">x</span> <span class="main">⟶</span> <span class="free">P</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> Inr <span class="bound">y</span> <span class="main">⟶</span> <span class="free">P</span><span class="main">(</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> is_hsum <span class="free">a</span> <span class="main">⟶</span> <span class="free">P</span> undefined<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_hsum <span class="free">a</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_hsum_def<span class="main">)</span>

<span class="keyword1" id="HF-sum_case_split_asm"><span class="command">lemma</span></span> sum_case_split_asm<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>sum_case <span class="free">f</span> <span class="free">g</span> <span class="free">a</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> Inl <span class="bound">x</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span><span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> Inr <span class="bound">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span><span class="main">(</span><span class="free">g</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">¬</span> is_hsum <span class="free">a</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span> undefined<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum_case_split<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Ordinal">
<div class="head">
<h1>Theory Ordinal</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Ordinals, Sequences and Ordinal Recursion›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Ordinal <span class="keyword2"><span class="keyword">imports</span></span> <a href="HF.html">HF</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Ordinals›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic Definitions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Definition 2.1. We say that x is transitive if every element of x is a subset of x.›</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Transset</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> bool"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Transset</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1" id="Ordinal-Transset_sup"><span class="command">lemma</span></span> Transset_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"Transset <span class="free">x</span> <span class="main">⟹</span> Transset <span class="free">y</span> <span class="main">⟹</span> Transset <span class="main">(</span><span class="free">x</span> <span class="main">⊔</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Transset_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-Transset_inf"><span class="command">lemma</span></span> Transset_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"Transset <span class="free">x</span> <span class="main">⟹</span> Transset <span class="free">y</span> <span class="main">⟹</span> Transset <span class="main">(</span><span class="free">x</span> <span class="main">⊓</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Transset_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-Transset_hinsert"><span class="command">lemma</span></span> Transset_hinsert<span class="main">:</span> <span class="quoted"><span class="quoted">"Transset <span class="free">x</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> Transset <span class="main">(</span><span class="free">x</span> <span class="main">◃</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Transset_def<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In HF, the ordinals are simply the natural numbers. But the definitions are the same
      as for transfinite ordinals.›</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">Ord</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> bool"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Ord</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>      <span class="main">≡</span> Transset<span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">.</span> Transset<span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition 2.2 (Successor).›</span></span>
<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">succ</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">succ</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>      <span class="main">≡</span> hinsert <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1" id="Ordinal-succ_iff"><span class="command">lemma</span></span> succ_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">=</span><span class="free">y</span> <span class="main">∨</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-succ_ne_self"><span class="command">lemma</span></span> succ_ne_self <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> succ <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hmem_ne succ_iff<span class="main">)</span>

<span class="keyword1" id="Ordinal-succ_notin_self"><span class="command">lemma</span></span> succ_notin_self<span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">i</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hmem_ne succ_iff<span class="main">)</span>

<span class="keyword1" id="Ordinal-succE"><span class="command">lemma</span></span> succE <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">?</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="free">y</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms succ_iff<span class="main">)</span>

<span class="keyword1" id="Ordinal-hmem_succ_ne"><span class="command">lemma</span></span> hmem_succ_ne<span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hmem_not_refl succ_iff<span class="main">)</span>

<span class="keyword1" id="Ordinal-hball_succ"><span class="command">lemma</span></span> hball_succ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">k</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">P</span> <span class="free">k</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> HBall_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-hbex_succ"><span class="command">lemma</span></span> hbex_succ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">k</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">P</span> <span class="free">k</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> HBex_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-One_hf_eq_succ"><span class="command">lemma</span></span> One_hf_eq_succ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> succ <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_hf_def succ_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-zero_hmem_one"><span class="command">lemma</span></span> zero_hmem_one <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_hf_eq_succ hmem_hempty succ_iff<span class="main">)</span>

<span class="keyword1" id="Ordinal-hball_One"><span class="command">lemma</span></span> hball_One <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="main">1</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> One_hf_eq_succ<span class="main">)</span>

<span class="keyword1" id="Ordinal-hbex_One"><span class="command">lemma</span></span> hbex_One <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="main">1</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> One_hf_eq_succ<span class="main">)</span>

<span class="keyword1" id="Ordinal-hpair_neq_succ"><span class="command">lemma</span></span> hpair_neq_succ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span> <span class="main">≠</span> succ <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> succ_def hpair_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> hemptyE hmem_hinsert hmem_ne<span class="main">)</span>

<span class="keyword1" id="Ordinal-succ_neq_hpair"><span class="command">lemma</span></span> succ_neq_hpair <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">k</span> <span class="main">≠</span> <span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span> "</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hpair_neq_succ<span class="main">)</span>

<span class="keyword1" id="Ordinal-hpair_neq_one"><span class="command">lemma</span></span> hpair_neq_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_hf_eq_succ hpair_neq_succ<span class="main">)</span>

<span class="keyword1" id="Ordinal-one_neq_hpair"><span class="command">lemma</span></span> one_neq_hpair <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≠</span> <span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hpair_neq_one<span class="main">)</span>

<span class="keyword1" id="Ordinal-hmem_succ_self"><span class="command">lemma</span></span> hmem_succ_self <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> succ_iff<span class="main">)</span>

<span class="keyword1" id="Ordinal-hmem_succ"><span class="command">lemma</span></span> hmem_succ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> succ_iff<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 2.3.›</span></span>
<span class="keyword1" id="Ordinal-Ord_0"><span class="command">lemma</span></span> Ord_0 <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ord_def Transset_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-Ord_succ"><span class="command">lemma</span></span> Ord_succ<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> Ord<span class="main">(</span>succ<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ord_def Transset_def succ_def less_eq_insert2_iff HBall_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-Ord_1"><span class="command">lemma</span></span> Ord_1 <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_hf_def Ord_0 Ord_succ succ_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-OrdmemD"><span class="command">lemma</span></span> OrdmemD<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">j</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ord_def Transset_def HBall_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-Ord_trans"><span class="command">lemma</span></span> Ord_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">i</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">j</span><span class="main">;</span>  <span class="free">j</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">k</span><span class="main">;</span>  Ord<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">⟧</span>  <span class="main">⟹</span> <span class="free">i</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> OrdmemD<span class="main">)</span>

<span class="keyword1" id="Ordinal-hmem_0_Ord"><span class="command">lemma</span></span> hmem_0_Ord<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> knz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> foundation <span class="main"><span class="main">[</span></span><span class="operator">OF</span> knz<span class="main"><span class="main">]</span></span> Ord_trans hempty_iff hinter_iff k<span class="main">)</span>

<span class="keyword1" id="Ordinal-Ord_in_Ord"><span class="command">lemma</span></span> Ord_in_Ord<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> Ord<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">;</span>  <span class="free">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span> <span class="main">⟧</span>  <span class="main">⟹</span> Ord<span class="main">(</span><span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ord_def Transset_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Induction, Linearity, etc.›</span></span>

<span class="keyword1" id="Ordinal-Ord_induct"><span class="command">lemma</span></span> Ord_induct <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> step<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">k</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span><span class="main">⟦</span> Ord<span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">;</span>  <span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">(</span><span class="bound">y</span><span class="main">)</span> <span class="main">⟧</span>  <span class="main">⟹</span> <span class="free">P</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span><span class="main">.</span> Ord<span class="main">(</span><span class="bound">m</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">P</span><span class="main">(</span><span class="bound">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hf_induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>hinsert <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Ord_in_Ord step<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> k
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Ord_in_Ord step<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 2.4 (Comparability of ordinals).›</span></span>
<span class="keyword1" id="Ordinal-Ord_linear"><span class="command">lemma</span></span> Ord_linear<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> Ord<span class="main">(</span><span class="free">l</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">k</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">l</span> <span class="main">∨</span> <span class="free">k</span><span class="main">=</span><span class="free">l</span> <span class="main">∨</span> <span class="free">l</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">k</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> step_k <span class="main">=</span> step
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord<span class="main">(</span><span class="skolem">l</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">l</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> step_k
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_trans hf_equalityI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The trichotomy law for ordinals›</span></span>
<span class="keyword1" id="Ordinal-Ord_linear_lt"><span class="command">lemma</span></span> Ord_linear_lt<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">k</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>lt<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">l</span>"</span></span> <span class="main">|</span> <span class="main">(</span>eq<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">=</span><span class="free">l</span>"</span></span> <span class="main">|</span> <span class="main">(</span>gt<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">l</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear o<span class="main">)</span>

<span class="keyword1" id="Ordinal-Ord_linear2"><span class="command">lemma</span></span> Ord_linear2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">k</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>lt<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">l</span>"</span></span> <span class="main">|</span> <span class="main">(</span>ge<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear OrdmemD order_eq_refl o<span class="main">)</span>

<span class="keyword1" id="Ordinal-Ord_linear_le"><span class="command">lemma</span></span> Ord_linear_le<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">k</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>le<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≤</span> <span class="free">l</span>"</span></span> <span class="main">|</span> <span class="main">(</span>ge<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear2 OrdmemD o<span class="main">)</span>

<span class="keyword1" id="Ordinal-hunion_less_iff"><span class="command">lemma</span></span> hunion_less_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord <span class="free">i</span><span class="main">;</span> Ord <span class="free">j</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">⊔</span> <span class="free">j</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟷</span> <span class="free">i</span><span class="main">&lt;</span><span class="free">k</span> <span class="main">∧</span> <span class="free">j</span><span class="main">&lt;</span><span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear_le le_iff_sup sup.order_iff sup.strict_boundedE<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 2.5›</span></span>
<span class="keyword1" id="Ordinal-Ord_mem_iff_lt"><span class="command">lemma</span></span> Ord_mem_iff_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> Ord<span class="main">(</span><span class="free">l</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">k</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">l</span> <span class="main">⟷</span> <span class="free">k</span> <span class="main">&lt;</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear OrdmemD hmem_not_refl less_hf_def less_le_not_le<span class="main">)</span>

<span class="keyword1" id="Ordinal-le_succE"><span class="command">lemma</span></span> le_succE<span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">i</span> <span class="main">≤</span> succ <span class="free">j</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_eq_hf_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> hmem_not_sym<span class="main">)</span>

<span class="keyword1" id="Ordinal-le_succ_iff"><span class="command">lemma</span></span> le_succ_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">i</span> <span class="main">⟹</span> Ord <span class="free">j</span> <span class="main">⟹</span> succ <span class="free">i</span> <span class="main">≤</span> succ <span class="free">j</span> <span class="main">⟷</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear_le Ord_succ le_succE order_antisym<span class="main">)</span>

<span class="keyword1" id="Ordinal-succ_inject_iff"><span class="command">lemma</span></span> succ_inject_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">i</span> <span class="main">=</span> succ <span class="free">j</span> <span class="main">⟷</span> <span class="free">i</span> <span class="main">=</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> succ_def hmem_hinsert hmem_not_sym<span class="main">)</span>

<span class="keyword1" id="Ordinal-mem_succ_iff"><span class="command">lemma</span></span> mem_succ_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">j</span> <span class="main">⟹</span> succ <span class="free">i</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">j</span> <span class="main">⟷</span> <span class="free">i</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_in_Ord Ord_mem_iff_lt Ord_succ succ_def less_eq_insert1_iff less_hf_def succ_iff<span class="main">)</span>

<span class="keyword1" id="Ordinal-Ord_mem_succ_cases"><span class="command">lemma</span></span> Ord_mem_succ_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">k</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">l</span> <span class="main">=</span> <span class="free">k</span> <span class="main">∨</span> succ <span class="free">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms mem_succ_iff succ_iff<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Supremum and Infimum›</span></span>

<span class="keyword1" id="Ordinal-Ord_Union"><span class="command">lemma</span></span> Ord_Union <span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span> <span class="main">⟹</span> Ord<span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">⟧</span>  <span class="main">⟹</span> Ord<span class="main">(</span><span class="main">⨆</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ord_def Transset_def<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1" id="Ordinal-Ord_Inter"><span class="command">lemma</span></span> Ord_Inter <span class="main">[</span><span class="operator">intro</span><span class="main">,</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span> <span class="main">⟹</span> Ord<span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">⟧</span>  <span class="main">⟹</span> Ord<span class="main">(</span><span class="main">⨅</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ord_def Transset_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hf_ext<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 2.7. Every set x of ordinals is ordered by the binary relation &lt;.
      Moreover if x = 0 then x has a smallest and a largest element.›</span></span>

<span class="keyword1" id="Ordinal-hmem_Sup_Ords"><span class="command">lemma</span></span> hmem_Sup_Ords<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">A</span><span class="main">≠</span><span class="main">0</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span> <span class="main">⟹</span> Ord<span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⨆</span><span class="free">A</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hf_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>hinsert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hf_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>hinsert <span class="skolem">y</span> <span class="skolem">A'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> UA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="skolem">A</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hinsert.IH<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hinsert.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hinsert_nonempty hmem_hinsert<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨆</span><span class="skolem">A</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">⨆</span><span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear2 OrdmemD hinsert.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hmem_hinsert<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HUnion_hinsert UA le_iff_sup less_eq_insert1_iff order_refl sup.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ordinal-hmem_Inf_Ords"><span class="command">lemma</span></span> hmem_Inf_Ords<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">A</span><span class="main">≠</span><span class="main">0</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">A</span> <span class="main">⟹</span> Ord<span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⨅</span><span class="free">A</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hf_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>hinsert <span class="skolem">x</span> <span class="skolem">A</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">A</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hf_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>hinsert <span class="skolem">y</span> <span class="skolem">A'</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> IA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span><span class="skolem">A</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hinsert.IH<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hinsert.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hinsert_nonempty hmem_hinsert<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⨅</span><span class="skolem">A</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="main">⨅</span><span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear2 OrdmemD hinsert.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hmem_hinsert<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HInter_hinsert IA hmem_hempty hmem_hinsert inf_absorb2 le_iff_inf<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ordinal-Ord_pred"><span class="command">lemma</span></span> Ord_pred<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">;</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> succ<span class="main">(</span><span class="main">⨆</span><span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> HUnion_iff Ord_in_Ord Ord_mem_succ_cases hmem_Sup_Ords hmem_ne succ_iff<span class="main">)</span>

<span class="keyword1" id="Ordinal-Ord_cases"><span class="command">lemma</span></span> Ord_cases <span class="main">[</span><span class="operator">cases</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">type</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">:</span></span></span></span> hf<span class="main">,</span> <span class="operator">case_names</span> 0 succ<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Ok<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="free">l</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">l</span>"</span></span> <span class="quoted"><span class="quoted">"succ <span class="free">l</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ok Ord_in_Ord Ord_pred succ_iff<span class="main">)</span>

<span class="keyword1" id="Ordinal-Ord_induct2"><span class="command">lemma</span></span> Ord_induct2 <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> 0 succ<span class="main">,</span> <span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">type</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">:</span></span></span></span> hf<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">k</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">k</span><span class="main">.</span> Ord <span class="bound">k</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">k</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>succ <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> k
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">k</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_cases P hmem_succ_self<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ordinal-Ord_succ_iff"><span class="command">lemma</span></span> Ord_succ_iff <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="main">=</span> Ord <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_in_Ord Ord_succ less_eq_insert1_iff order_refl succ_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hinsert_nonempty succ_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-Ord_Sup_succ_eq"><span class="command">lemma</span></span> Ord_Sup_succ_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span> <span class="main">⟹</span> <span class="main">⨆</span><span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_pred Ord_succ_iff succ_inject_iff hinsert_nonempty succ_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-Ord_lt_succ_iff_le"><span class="command">lemma</span></span> Ord_lt_succ_iff_le<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span> <span class="main">⟹</span> Ord <span class="free">l</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">&lt;</span> succ <span class="free">l</span> <span class="main">⟷</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_mem_iff_lt Ord_succ_iff less_le_not_le order_eq_iff succ_iff<span class="main">)</span>

<span class="keyword1" id="Ordinal-zero_in_Ord"><span class="command">lemma</span></span> zero_in_Ord<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span> <span class="main">⟹</span> <span class="free">k</span><span class="main">=</span><span class="main">0</span> <span class="main">∨</span> <span class="main">0</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Ordinal-hpair_neq_Ord"><span class="command">lemma</span></span> hpair_neq_Ord<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span> <span class="main">≠</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">k</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="Ordinal-hpair_neq_Ord'"><span class="command">lemma</span></span> hpair_neq_Ord'<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> k hpair_neq_Ord<span class="main">)</span>

<span class="keyword1" id="Ordinal-Not_Ord_hpair"><span class="command">lemma</span></span> Not_Ord_hpair <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Ord <span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hpair_neq_Ord<span class="main">)</span>

<span class="keyword1" id="Ordinal-is_hpair"><span class="command">lemma</span></span> is_hpair <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_hpair <span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_hpair_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-Ord_not_hpair"><span class="command">lemma</span></span> Ord_not_hpair<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">x</span> <span class="main">⟹</span> <span class="main">¬</span> is_hpair <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Not_Ord_hpair is_hpair_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-zero_in_succ"><span class="command">lemma</span></span> zero_in_succ <span class="main">[</span><span class="operator">simp</span><span class="main">,</span><span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">i</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">i</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> succ_iff zero_in_Ord<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Converting Between Ordinals and Natural Numbers›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ord_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">ord_of</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
 <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ord_of</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">=</span> succ <span class="main">(</span><span class="free">ord_of</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Ordinal-Ord_ord_of"><span class="command">lemma</span></span> Ord_ord_of <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>ord_of <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Ordinal-ord_of_inject"><span class="command">lemma</span></span> ord_of_inject <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ord_of <span class="free">i</span> <span class="main">=</span> ord_of <span class="free">j</span> <span class="main">⟷</span> <span class="free">i</span><span class="main">=</span><span class="free">j</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Zero_neq_Suc hempty_iff hmem_succ_self ord_of.elims<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">j</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Suc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ordinal-ord_of_minus_1"><span class="command">lemma</span></span> ord_of_minus_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> ord_of <span class="free">n</span> <span class="main">=</span> succ <span class="main">(</span>ord_of <span class="main">(</span><span class="free">n</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_1 ord_of.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">nat_of_ord</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">nat_of_ord</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> ord_of <span class="bound">n</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Ordinal-nat_of_ord_ord_of"><span class="command">lemma</span></span> nat_of_ord_ord_of <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nat_of_ord <span class="main">(</span>ord_of <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_of_ord_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-nat_of_ord_0"><span class="command">lemma</span></span> nat_of_ord_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nat_of_ord <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> nat_of_ord_ord_of ord_of.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="Ordinal-ord_of_nat_of_ord"><span class="command">lemma</span></span> ord_of_nat_of_ord <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">x</span> <span class="main">⟹</span> ord_of <span class="main">(</span>nat_of_ord <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> Ord_induct2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> nat_of_ord_ord_of ord_of.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Ordinal-nat_of_ord_inject"><span class="command">lemma</span></span> nat_of_ord_inject<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">x</span> <span class="main">⟹</span> Ord <span class="free">y</span> <span class="main">⟹</span> nat_of_ord <span class="free">x</span> <span class="main">=</span> nat_of_ord <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ord_of_nat_of_ord<span class="main">)</span>

<span class="keyword1" id="Ordinal-nat_of_ord_succ"><span class="command">lemma</span></span> nat_of_ord_succ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">x</span> <span class="main">⟹</span> nat_of_ord <span class="main">(</span>succ <span class="free">x</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>nat_of_ord <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> nat_of_ord_ord_of ord_of.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ord_of_nat_of_ord<span class="main">)</span>

<span class="keyword1" id="Ordinal-inj_ord_of"><span class="command">lemma</span></span> inj_ord_of<span class="main">:</span> <span class="quoted"><span class="quoted">"inj_on ord_of <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-hfset_ord_of"><span class="command">lemma</span></span> hfset_ord_of<span class="main">:</span> <span class="quoted"><span class="quoted">"hfset <span class="main">(</span>ord_of <span class="free">n</span><span class="main">)</span> <span class="main">=</span> ord_of <span class="main">`</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hfset_hinsert succ_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-bij_betw_ord_of"><span class="command">lemma</span></span> bij_betw_ord_of<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw ord_of <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">(</span>hfset <span class="main">(</span>ord_of <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bij_betw_def inj_ord_of hfset_ord_of<span class="main">)</span>

<span class="keyword1" id="Ordinal-bij_betw_ord_ofI"><span class="command">lemma</span></span> bij_betw_ord_ofI<span class="main">:</span> <span class="quoted"><span class="quoted">"bij_betw <span class="free">h</span> <span class="free">A</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="free">n</span><span class="main">}</span> <span class="main">⟹</span> bij_betw <span class="main">(</span>ord_of <span class="main">∘</span> <span class="free">h</span><span class="main">)</span> <span class="free">A</span> <span class="main">(</span>hfset <span class="main">(</span>ord_of <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> bij_betw_ord_of bij_betw_trans<span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Sequences and Ordinal Recursion›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Definition 3.2 (Sequence).›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Seq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Seq</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">⟷</span> hrelation <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> hfunction <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">≤</span> hdomain <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="keyword1" id="Ordinal-Seq_0"><span class="command">lemma</span></span> Seq_0 <span class="main">[</span><span class="operator">iff</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Seq <span class="main">0</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Seq_def hrelation_def hfunction_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-Seq_succ_D"><span class="command">lemma</span></span> Seq_succ_D<span class="main">:</span> <span class="quoted"><span class="quoted">"Seq <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> Seq <span class="free">s</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Seq_def succ_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-Seq_Ord_D"><span class="command">lemma</span></span> Seq_Ord_D<span class="main">:</span> <span class="quoted"><span class="quoted">"Seq <span class="free">s</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span> <span class="main">⟹</span> Ord <span class="free">k</span> <span class="main">⟹</span> Seq <span class="free">s</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Seq_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Ord_trans<span class="main">)</span>

<span class="keyword1" id="Ordinal-Seq_restr"><span class="command">lemma</span></span> Seq_restr<span class="main">:</span> <span class="quoted"><span class="quoted">"Seq <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> Seq <span class="main">(</span>hrestrict <span class="free">s</span> <span class="free">k</span><span class="main">)</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Seq_def hfunction_restr succ_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-Seq_Ord_restr"><span class="command">lemma</span></span> Seq_Ord_restr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Seq <span class="free">s</span> <span class="free">k</span><span class="main">;</span> <span class="free">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span><span class="main">;</span> Ord <span class="free">k</span><span class="main">⟧</span> <span class="main">⟹</span> Seq <span class="main">(</span>hrestrict <span class="free">s</span> <span class="free">l</span><span class="main">)</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Seq_def hfunction_restr <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Ord_trans<span class="main">)</span>

<span class="keyword1" id="Ordinal-Seq_ins"><span class="command">lemma</span></span> Seq_ins<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Seq <span class="free">s</span> <span class="free">k</span><span class="main">;</span> <span class="free">k</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> hdomain <span class="free">s</span><span class="main">⟧</span> <span class="main">⟹</span> Seq <span class="main">(</span><span class="free">s</span> <span class="main">◃</span> <span class="main">⟨</span><span class="free">k</span><span class="main">,</span> <span class="free">y</span><span class="main">⟩</span><span class="main">)</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Seq_def hrelation_def succ_def hfunction_def hdomainI<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">insf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf <span class="main">⇒</span> hf <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">insf</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> nonrestrict <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⦃</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">⦄</span> <span class="main">◃</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">⟩</span>"</span></span>

<span class="keyword1" id="Ordinal-hfunction_insf"><span class="command">lemma</span></span> hfunction_insf<span class="main">:</span> <span class="quoted"><span class="quoted">"hfunction <span class="free">s</span> <span class="main">⟹</span> hfunction <span class="main">(</span>insf <span class="free">s</span> <span class="free">k</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insf_def hfunction_def nonrestrict_def hmem_not_refl<span class="main">)</span>

<span class="keyword1" id="Ordinal-Seq_insf"><span class="command">lemma</span></span> Seq_insf<span class="main">:</span> <span class="quoted"><span class="quoted">"Seq <span class="free">s</span> <span class="free">k</span> <span class="main">⟹</span> Seq <span class="main">(</span>insf <span class="free">s</span> <span class="free">k</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Seq_def hrelation_def insf_def hfunction_def nonrestrict_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hdomain_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Ordinal-Seq_succ_iff"><span class="command">lemma</span></span> Seq_succ_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"Seq <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="main">⟷</span> Seq <span class="free">s</span> <span class="free">k</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">⟨</span><span class="free">k</span><span class="main">,</span> <span class="bound">y</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Seq_def hdomain_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> hfst_conv<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Ordinal-nonrestrictD"><span class="command">lemma</span></span> nonrestrictD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> nonrestrict <span class="free">s</span> <span class="free">X</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nonrestrict_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-hpair_in_nonrestrict_iff"><span class="command">lemma</span></span> hpair_in_nonrestrict_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> nonrestrict <span class="free">s</span> <span class="free">X</span> <span class="main">⟷</span> <span class="main">⟨</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">s</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nonrestrict_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-app_nonrestrict_Seq"><span class="command">lemma</span></span> app_nonrestrict_Seq<span class="main">:</span> <span class="quoted"><span class="quoted">"Seq <span class="free">s</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> <span class="free">X</span> <span class="main">⟹</span> app <span class="main">(</span>nonrestrict <span class="free">s</span> <span class="free">X</span><span class="main">)</span> <span class="free">z</span> <span class="main">=</span> app <span class="free">s</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Seq_def nonrestrict_def app_def HBall_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>

<span class="keyword1" id="Ordinal-app_insf_Seq"><span class="command">lemma</span></span> app_insf_Seq<span class="main">:</span> <span class="quoted"><span class="quoted">"Seq <span class="free">s</span> <span class="free">k</span> <span class="main">⟹</span> app <span class="main">(</span>insf <span class="free">s</span> <span class="free">k</span> <span class="free">y</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Seq_def hfunction_insf app_equality hmem_hinsert insf_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-app_insf2_Seq"><span class="command">lemma</span></span> app_insf2_Seq<span class="main">:</span> <span class="quoted"><span class="quoted">"Seq <span class="free">s</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">k'</span> <span class="main">≠</span> <span class="free">k</span> <span class="main">⟹</span> app <span class="main">(</span>insf <span class="free">s</span> <span class="free">k</span> <span class="free">y</span><span class="main">)</span> <span class="free">k'</span> <span class="main">=</span> app <span class="free">s</span> <span class="free">k'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> app_nonrestrict_Seq insf_def app_ins2<span class="main">)</span>

<span class="keyword1" id="Ordinal-app_insf_Seq_if"><span class="command">lemma</span></span> app_insf_Seq_if<span class="main">:</span> <span class="quoted"><span class="quoted">"Seq <span class="free">s</span> <span class="free">k</span> <span class="main">⟹</span> app <span class="main">(</span>insf <span class="free">s</span> <span class="free">k</span> <span class="free">y</span><span class="main">)</span> <span class="free">k'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">k'</span> <span class="main">=</span> <span class="free">k</span> <span class="keyword1">then</span> <span class="free">y</span> <span class="keyword1">else</span> app <span class="free">s</span> <span class="free">k'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> app_insf2_Seq app_insf_Seq<span class="main">)</span>

<span class="keyword1" id="Ordinal-Seq_imp_eq_app"><span class="command">lemma</span></span> Seq_imp_eq_app<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Seq <span class="free">s</span> <span class="free">d</span><span class="main">;</span> <span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">s</span><span class="main">⟧</span> <span class="main">⟹</span> app <span class="free">s</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Seq_def app_equality<span class="main">)</span>

<span class="keyword1" id="Ordinal-Seq_iff_app"><span class="command">lemma</span></span> Seq_iff_app<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Seq <span class="free">s</span> <span class="free">d</span><span class="main">;</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">d</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">s</span> <span class="main">⟷</span> app <span class="free">s</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Seq_def hdomain_def app_equality<span class="main">)</span>

<span class="keyword1" id="Ordinal-Exists_iff_app"><span class="command">lemma</span></span> Exists_iff_app<span class="main">:</span> <span class="quoted"><span class="quoted">"Seq <span class="free">s</span> <span class="free">d</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">d</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">⟨</span><span class="free">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">s</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span> <span class="main">(</span>app <span class="free">s</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Seq_iff_app<span class="main">)</span>

<span class="keyword1" id="Ordinal-Ord_trans2"><span class="command">lemma</span></span> Ord_trans2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">i2</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">i</span><span class="main">;</span> <span class="free">i</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">j</span><span class="main">;</span>  <span class="free">j</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span><span class="main">;</span>  Ord <span class="free">k</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">i2</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_trans<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ord_rec_Seq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> <span class="main">(</span>hf <span class="main">⇒</span> hf<span class="main">)</span> <span class="main">⇒</span> hf <span class="main">⇒</span> hf <span class="main">⇒</span> hf <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">ord_rec_Seq</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span>
        <span class="main">(</span>Seq <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>app <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span><span class="main">⨆</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> app <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="main">∧</span>
                   <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> succ <span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">⟶</span> app <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>succ <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>app <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Ordinal-Seq_succ_insf"><span class="command">lemma</span></span> Seq_succ_insf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"Seq <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">y</span><span class="main">.</span> <span class="free">s</span> <span class="main">=</span> insf <span class="free">s</span> <span class="free">k</span> <span class="bound">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">k</span><span class="main">,</span> <span class="skolem">y</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Seq_succ_iff s<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> yuniq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">y'</span><span class="main">.</span> <span class="main">⟨</span><span class="free">k</span><span class="main">,</span> <span class="bound">y'</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">s</span> <span class="main">⟶</span> <span class="bound">y'</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Seq_def hfunction_def<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">assume</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">⟨</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Seq_def hrelation_def is_hpair_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> insf <span class="free">s</span> <span class="free">k</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hemptyE hmem_hinsert hpair_in_nonrestrict_iff insf_def yuniq z<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> left2right <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> insf <span class="free">s</span> <span class="free">k</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> hf_equalityI<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> hmem_hinsert insf_def left2right nonrestrictD y<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ordinal-ord_rec_Seq_succ_iff"><span class="command">lemma</span></span> ord_rec_Seq_succ_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> knz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ord_rec_Seq <span class="free">T</span> <span class="free">G</span> <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">z</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">s'</span> <span class="bound">y</span><span class="main">.</span> ord_rec_Seq <span class="free">T</span> <span class="free">G</span> <span class="bound">s'</span> <span class="free">k</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">=</span> <span class="free">G</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">=</span> insf <span class="bound">s'</span> <span class="free">k</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> os<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_rec_Seq <span class="free">T</span> <span class="free">G</span> <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">z</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s'</span> <span class="bound">y</span><span class="main">.</span> ord_rec_Seq <span class="free">T</span> <span class="free">G</span> <span class="bound">s'</span> <span class="free">k</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">=</span> <span class="free">G</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">=</span> insf <span class="bound">s'</span> <span class="free">k</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>  <span class="keyword1"><span class="command">using</span></span> os k knz
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Seq_insf ord_rec_Seq_def app_insf_Seq app_insf2_Seq
                          hmem_succ_ne hmem_ne hmem_Sup_ne Seq_succ_iff hmem_0_Ord<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Ord_pred<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Ord_pred Seq_succ_iff Seq_succ_insf app_insf_Seq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> ok<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s'</span> <span class="bound">y</span><span class="main">.</span> ord_rec_Seq <span class="free">T</span> <span class="free">G</span> <span class="bound">s'</span> <span class="free">k</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">=</span> <span class="free">G</span> <span class="bound">y</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">=</span> insf <span class="bound">s'</span> <span class="free">k</span> <span class="bound">y</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ord_rec_Seq <span class="free">T</span> <span class="free">G</span> <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ok k knz
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ord_rec_Seq_def app_insf_Seq_if hmem_ne hmem_succ_ne Seq_insf<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ordinal-ord_rec_Seq_functional"><span class="command">lemma</span></span> ord_rec_Seq_functional<span class="main">:</span>
   <span class="quoted"><span class="quoted">"Ord <span class="free">k</span> <span class="main">⟹</span> <span class="free">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> ord_rec_Seq <span class="free">T</span> <span class="free">G</span> <span class="free">s</span> <span class="free">k</span> <span class="free">y</span> <span class="main">⟹</span> ord_rec_Seq <span class="free">T</span> <span class="free">G</span> <span class="free">s'</span> <span class="free">k</span> <span class="free">y'</span> <span class="main">⟹</span> <span class="free">y'</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">y'</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">s'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct2<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ord_rec_Seq_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">k</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> succ
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ord_rec_Seq_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> succ
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ord_rec_Seq_succ_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ord_recp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> <span class="main">(</span>hf <span class="main">⇒</span> hf<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>hf <span class="main">⇒</span> hf<span class="main">)</span> <span class="main">⇒</span> hf <span class="main">⇒</span> hf <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">ord_recp</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">=</span><span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span>
     <span class="keyword1">else</span>
       <span class="keyword1">if</span> Ord<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">∃</span> <span class="bound">s</span><span class="main">.</span> ord_rec_Seq <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">s</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>
       <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Ordinal-ord_recp_functional"><span class="command">lemma</span></span> ord_recp_functional<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_recp <span class="free">T</span> <span class="free">G</span> <span class="free">H</span> <span class="free">x</span> <span class="free">y</span> <span class="main">⟹</span> ord_recp <span class="free">T</span> <span class="free">G</span> <span class="free">H</span> <span class="free">x</span> <span class="free">y'</span> <span class="main">⟹</span> <span class="free">y'</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ord_recp_def ord_rec_Seq_functional <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>

<span class="keyword1" id="Ordinal-ord_recp_succ_iff"><span class="command">lemma</span></span> ord_recp_succ_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ord_recp <span class="free">T</span> <span class="free">G</span> <span class="free">H</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">z</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free">z</span> <span class="main">=</span> <span class="free">G</span> <span class="bound">y</span> <span class="main">∧</span> ord_recp <span class="free">T</span> <span class="free">G</span> <span class="free">H</span> <span class="free">k</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ord_recp_def ord_rec_Seq_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> Seq_0 Seq_insf app_insf_Seq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> k
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ord_recp_def ord_rec_Seq_succ_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ord_rec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> <span class="main">(</span>hf <span class="main">⇒</span> hf<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>hf <span class="main">⇒</span> hf<span class="main">)</span> <span class="main">⇒</span> hf <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">ord_rec</span> <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> ord_recp <span class="free"><span class="bound"><span class="entity">T</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Ordinal-ord_rec_0"><span class="command">lemma</span></span> ord_rec_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ord_rec <span class="free">T</span> <span class="free">G</span> <span class="free">H</span> <span class="main">0</span> <span class="main">=</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ord_recp_def ord_rec_def<span class="main">)</span>

<span class="keyword1" id="Ordinal-ord_recp_total"><span class="command">lemma</span></span> ord_recp_total<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> ord_recp <span class="free">T</span> <span class="free">G</span> <span class="free">H</span> <span class="free">x</span> <span class="bound">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Ord <span class="free">x</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct2<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ord_recp_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">x</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ord_recp_succ_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ord_recp_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ordinal-ord_rec_succ"><span class="command">lemma</span></span> ord_rec_succ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ord_rec <span class="free">T</span> <span class="free">G</span> <span class="free">H</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">G</span> <span class="main">(</span>ord_rec <span class="free">T</span> <span class="free">G</span> <span class="free">H</span> <span class="free">k</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> ord_recp_total <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">T</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">k</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"ord_recp <span class="free">T</span> <span class="free">G</span> <span class="free">H</span> <span class="free">k</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> k
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ord_rec_def ord_recp_succ_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> theI2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ord_recp_functional<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Ordinal-ord_rec_non"><span class="command">lemma</span></span> ord_rec_non <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Ord <span class="free">x</span> <span class="main">⟹</span> ord_rec <span class="free">T</span> <span class="free">G</span> <span class="free">H</span> <span class="free">x</span> <span class="main">=</span> <span class="free">H</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_0 ord_rec_def ord_recp_def the_equality<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Rank">
<div class="head">
<h1>Theory Rank</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹V-Sets, Epsilon Closure, Ranks›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Rank <span class="keyword2"><span class="keyword">imports</span></span> <a href="Ordinal.html">Ordinal</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹V-sets›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Definition 4.1›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Vset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Vset</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> ord_rec <span class="main">0</span> HPow <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1" id="Rank-Vset_0"><span class="command">lemma</span></span> Vset_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Vset <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vset_def<span class="main">)</span>

<span class="keyword1" id="Rank-Vset_succ"><span class="command">lemma</span></span> Vset_succ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span> <span class="main">⟹</span> Vset <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="main">=</span> HPow <span class="main">(</span>Vset <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vset_def<span class="main">)</span>

<span class="keyword1" id="Rank-Vset_non"><span class="command">lemma</span></span> Vset_non <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Ord <span class="free">x</span> <span class="main">⟹</span> Vset <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Vset_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 4.2(a)›</span></span>
<span class="keyword1" id="Rank-Vset_mono_strict"><span class="command">lemma</span></span> Vset_mono_strict<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Vset <span class="free">n</span> <span class="main">&lt;</span> Vset <span class="free">m</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_in_Ord assms<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">m</span> <span class="main">⟹</span> <span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">m</span> <span class="main">⟹</span> Vset <span class="free">n</span> <span class="main">&lt;</span> Vset <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">m</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct2<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HPow_iff Ord_cases Vset_0 Vset_succ hemptyE le_imp_less_or_eq zero_le<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Ord <span class="skolem">m</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_cases hemptyE HPow_mono_strict_iff Vset_succ mem_succ_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rank-Vset_mono"><span class="command">lemma</span></span> Vset_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord <span class="free">m</span><span class="main">;</span> <span class="free">n</span> <span class="main">≤</span> <span class="free">m</span><span class="main">⟧</span> <span class="main">⟹</span> Vset <span class="free">n</span> <span class="main">≤</span> Vset <span class="free">m</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear2 Vset_mono_strict Vset_non order.order_iff_strict
            order_class.order.antisym zero_le<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 4.2(b)›</span></span>
<span class="keyword1" id="Rank-Vset_Transset"><span class="command">lemma</span></span> Vset_Transset<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">m</span> <span class="main">⟹</span> Transset <span class="main">(</span>Vset <span class="free">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct2<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Transset_def<span class="main">)</span>

<span class="keyword1" id="Rank-Ord_sup"><span class="command">lemma</span></span> Ord_sup <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span> <span class="main">⟹</span> Ord <span class="free">l</span> <span class="main">⟹</span> Ord <span class="main">(</span><span class="free">k</span> <span class="main">⊔</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear_le le_iff_sup sup_absorb1<span class="main">)</span>

<span class="keyword1" id="Rank-Ord_inf"><span class="command">lemma</span></span> Ord_inf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span> <span class="main">⟹</span> Ord <span class="free">l</span> <span class="main">⟹</span> Ord <span class="main">(</span><span class="free">k</span> <span class="main">⊓</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear_le inf_absorb2 le_iff_inf<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 4.3›</span></span>
<span class="keyword1" id="Rank-Vset_universal"><span class="command">lemma</span></span> Vset_universal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> Ord <span class="bound">n</span> <span class="main">∧</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> Vset <span class="bound">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hf_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HPow_iff Ord_0 Ord_succ Vset_succ zero_le<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>hinsert <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">na</span></span> <span class="skolem"><span class="skolem">nb</span></span> <span class="keyword2"><span class="keyword">where</span></span> nab<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">na</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> Vset <span class="skolem">na</span>"</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">nb</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> Vset <span class="skolem">nb</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≤</span> Vset <span class="skolem">nb</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Vset_Transset <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">nb</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Transset_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> Vset <span class="main">(</span><span class="skolem">na</span> <span class="main">⊔</span> <span class="skolem">nb</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nab
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_sup Vset_mono sup_ge2<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">◃</span> <span class="skolem">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> Vset <span class="main">(</span>succ <span class="main">(</span><span class="skolem">na</span> <span class="main">⊔</span> <span class="skolem">nb</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nab
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> Ord_sup Vset_mono sup_ge1 rev_hsubsetD<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> nab
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_succ Ord_sup<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Least Ordinal Operator›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Definition 4.4. For every x, let rank(x) be the least ordinal n such that...›</span></span>

<span class="keyword1" id="Rank-Ord_minimal"><span class="command">lemma</span></span> Ord_minimal<span class="main">:</span>
   <span class="quoted"><span class="quoted">"Ord <span class="free">k</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> Ord <span class="bound">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">n</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m</span><span class="main">.</span> Ord <span class="bound">m</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">m</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">≤</span> <span class="bound">m</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> Ord_linear2<span class="main">)</span>

<span class="keyword1" id="Rank-OrdLeastI"><span class="command">lemma</span></span> OrdLeastI<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">P</span><span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Ord <span class="bound">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> Least_equality Ord_minimal<span class="main">)</span>

<span class="keyword1" id="Rank-OrdLeast_le"><span class="command">lemma</span></span> OrdLeast_le<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Ord <span class="bound">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> Least_equality Ord_minimal<span class="main">)</span>

<span class="keyword1" id="Rank-OrdLeast_Ord"><span class="command">lemma</span></span> OrdLeast_Ord<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">k</span>"</span></span><span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Ord <span class="bound">n</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> Ord <span class="bound">m</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">m</span> <span class="main">⟶</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="bound">m</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_minimal assms<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> Least_equality<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Rank Function›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rank</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rank</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> Ord <span class="bound">n</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> Vset <span class="main">(</span>succ <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rank_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> HPow_iff Least_equality Ord_0 Vset_succ zero_le<span class="main">)</span>

<span class="keyword1" id="Rank-in_Vset_rank"><span class="command">lemma</span></span> in_Vset_rank<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> Vset<span class="main">(</span>succ<span class="main">(</span>rank <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> Vset_universal <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">na</span></span> <span class="keyword2"><span class="keyword">where</span></span> na<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="skolem">na</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> Vset <span class="main">(</span>succ <span class="skolem">na</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_Union Ord_in_Ord Ord_pred Vset_0 hempty_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> rank_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> OrdLeastI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rank-Ord_rank"><span class="command">lemma</span></span> Ord_rank <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>rank <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_succ_iff Vset_non hemptyE in_Vset_rank<span class="main">)</span>

<span class="keyword1" id="Rank-le_Vset_rank"><span class="command">lemma</span></span> le_Vset_rank<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> Vset<span class="main">(</span>rank <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HPow_iff Ord_succ_iff Vset_non Vset_succ hemptyE in_Vset_rank<span class="main">)</span>

<span class="keyword1" id="Rank-VsetI"><span class="command">lemma</span></span> VsetI<span class="main">:</span> <span class="quoted"><span class="quoted">"succ<span class="main">(</span>rank <span class="free">a</span><span class="main">)</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">⟹</span> Ord <span class="free">k</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> Vset <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Vset_mono hsubsetCE in_Vset_rank<span class="main">)</span>

<span class="keyword1" id="Rank-Vset_succ_rank_le"><span class="command">lemma</span></span> Vset_succ_rank_le<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> Vset <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> rank <span class="free">a</span> <span class="main">≤</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> rank_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> OrdLeast_le<span class="main">)</span>

<span class="keyword1" id="Rank-Vset_rank_lt"><span class="command">lemma</span></span> Vset_rank_lt<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> Vset <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">a</span> <span class="main">&lt;</span> <span class="free">k</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>succ <span class="skolem">l</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_lt_succ_iff_le Ord_succ_iff Vset_non Vset_succ_rank_le hemptyE in_Vset_rank<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Vset_non hemptyE<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 4.5›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> rank_lt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">b</span> <span class="main">⟹</span> rank<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">&lt;</span> rank<span class="main">(</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Vset_rank_lt hsubsetD le_Vset_rank<span class="main">)</span>

<span class="keyword1" id="Rank-rank_mono"><span class="command">lemma</span></span> rank_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> rank <span class="free">x</span> <span class="main">≤</span> rank <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HPow_iff Ord_rank Vset_succ Vset_succ_rank_le dual_order.trans le_Vset_rank<span class="main">)</span>

<span class="keyword1" id="Rank-rank_sup"><span class="command">lemma</span></span> rank_sup <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span><span class="free">a</span> <span class="main">⊔</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> rank <span class="free">a</span> <span class="main">⊔</span> rank <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>rank <span class="free">a</span> <span class="main">⊔</span> rank <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span><span class="free">a</span> <span class="main">⊔</span> <span class="free">b</span><span class="main">)</span> <span class="main">≤</span> rank <span class="free">a</span> <span class="main">⊔</span> rank <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Vset_succ_rank_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> le_Vset_rank order_trans Vset_mono sup_ge1 sup_ge2 o<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rank <span class="free">a</span> <span class="main">⊔</span> rank <span class="free">b</span> <span class="main">≤</span> rank <span class="main">(</span><span class="free">a</span> <span class="main">⊔</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_supI le_supI1 le_supI2 order_eq_refl rank_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rank-rank_singleton"><span class="command">lemma</span></span> rank_singleton <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="main">⦃</span><span class="free">a</span><span class="main">⦄</span> <span class="main">=</span> succ<span class="main">(</span>rank <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> oba<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="main">(</span>succ <span class="main">(</span>rank <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"rank <span class="main">⦃</span><span class="free">a</span><span class="main">⦄</span> <span class="main">≤</span> succ <span class="main">(</span>rank <span class="free">a</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Vset_succ_rank_le HPow_iff Vset_succ in_Vset_rank less_eq_insert1_iff oba zero_le<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"succ <span class="main">(</span>rank <span class="free">a</span><span class="main">)</span> <span class="main">≤</span> rank<span class="main">⦃</span><span class="free">a</span><span class="main">⦄</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_linear_le Ord_lt_succ_iff_le rank_lt Ord_rank hmem_hinsert less_le_not_le oba<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rank-rank_hinsert"><span class="command">lemma</span></span> rank_hinsert <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span><span class="free">b</span> <span class="main">◃</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> rank <span class="free">b</span> <span class="main">⊔</span> succ<span class="main">(</span>rank <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hinsert_eq_sup rank_singleton rank_sup<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Definition 4.6. The transitive closure of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">x</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is
 the minimal transitive set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> such that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span><span class="quoted"><span class="quoted">"<span class="free"><span class="free">x</span></span><span class="main"><span class="main">≤</span></span><span class="free"><span class="free">y</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Epsilon Closure›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">eclose</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">eclose</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="main">⨅</span> <span class="main">⦃</span><span class="bound">Y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> HPow<span class="main">(</span>Vset <span class="main">(</span>rank <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">.</span> Transset <span class="bound">Y</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">≤</span><span class="bound">Y</span><span class="main">⦄</span>"</span></span>

<span class="keyword1" id="Rank-eclose_facts"><span class="command">lemma</span></span> eclose_facts<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> Transset_eclose<span class="main">:</span> <span class="quoted"><span class="quoted">"Transset <span class="main">(</span>eclose <span class="free">X</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span>  le_eclose<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≤</span> eclose <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="bound">Y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> HPow<span class="main">(</span>Vset <span class="main">(</span>rank <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> Transset <span class="bound">Y</span> <span class="main">∧</span> <span class="free">X</span><span class="main">≤</span><span class="bound">Y</span><span class="main">⦄</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eclose_def hempty_iff<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> Ord_rank Vset_Transset le_Vset_rank order_refl<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Transset <span class="main">(</span>eclose <span class="free">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≤</span> eclose <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> HInter_iff <span class="main">[</span><span class="operator">OF</span> nz<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eclose_def Transset_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rank-eclose_minimal"><span class="command">lemma</span></span> eclose_minimal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"Transset <span class="free">Y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">≤</span><span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eclose <span class="free">X</span> <span class="main">≤</span> <span class="free">Y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦃</span><span class="bound">Y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> HPow<span class="main">(</span>Vset <span class="main">(</span>rank <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> Transset <span class="bound">Y</span> <span class="main">∧</span> <span class="free">X</span><span class="main">≤</span><span class="bound">Y</span><span class="main">⦄</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eclose_def hempty_iff<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> Ord_rank Vset_Transset le_Vset_rank order_refl<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Transset <span class="main">(</span><span class="free">Y</span> <span class="main">⊓</span> Vset <span class="main">(</span>rank <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_rank Transset_inf Vset_Transset Y<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≤</span> <span class="free">Y</span> <span class="main">⊓</span> Vset <span class="main">(</span>rank <span class="free">X</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Y<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> le_Vset_rank le_inf_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eclose <span class="free">X</span> <span class="main">≤</span> <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eclose_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> hinter_iff le_inf_iff order_refl<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rank-eclose_0"><span class="command">lemma</span></span> eclose_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"eclose <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_0 Vset_0 Vset_Transset eclose_minimal less_eq_hempty<span class="main">)</span>

<span class="keyword1" id="Rank-eclose_sup"><span class="command">lemma</span></span> eclose_sup <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"eclose <span class="main">(</span><span class="free">a</span> <span class="main">⊔</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> eclose <span class="free">a</span> <span class="main">⊔</span> eclose <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order_antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eclose <span class="main">(</span><span class="free">a</span> <span class="main">⊔</span> <span class="free">b</span><span class="main">)</span> <span class="main">≤</span> eclose <span class="free">a</span> <span class="main">⊔</span> eclose <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Transset_eclose Transset_sup eclose_minimal le_eclose sup_mono<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eclose <span class="free">a</span> <span class="main">⊔</span> eclose <span class="free">b</span> <span class="main">≤</span> eclose <span class="main">(</span><span class="free">a</span> <span class="main">⊔</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Transset_eclose eclose_minimal le_eclose le_sup_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rank-eclose_singleton"><span class="command">lemma</span></span> eclose_singleton <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"eclose <span class="main">⦃</span><span class="free">a</span><span class="main">⦄</span> <span class="main">=</span> <span class="main">(</span>eclose <span class="free">a</span><span class="main">)</span> <span class="main">◃</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> order_antisym<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eclose <span class="main">⦃</span><span class="free">a</span><span class="main">⦄</span> <span class="main">≤</span> eclose <span class="free">a</span> <span class="main">◃</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eclose_minimal Transset_eclose Transset_hinsert
              le_eclose less_eq_insert1_iff order_refl zero_le<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eclose <span class="free">a</span> <span class="main">◃</span> <span class="free">a</span> <span class="main">≤</span> eclose <span class="main">⦃</span><span class="free">a</span><span class="main">⦄</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Transset_def Transset_eclose eclose_minimal le_eclose less_eq_insert1_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rank-eclose_hinsert"><span class="command">lemma</span></span> eclose_hinsert <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"eclose <span class="main">(</span><span class="free">b</span> <span class="main">◃</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> eclose <span class="free">b</span> <span class="main">⊔</span> <span class="main">(</span>eclose <span class="free">a</span> <span class="main">◃</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eclose_singleton eclose_sup hinsert_eq_sup<span class="main">)</span>

<span class="keyword1" id="Rank-eclose_succ"><span class="command">lemma</span></span> eclose_succ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"eclose <span class="main">(</span>succ <span class="free">a</span><span class="main">)</span> <span class="main">=</span> eclose <span class="free">a</span> <span class="main">◃</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> succ_def<span class="main">)</span>

<span class="keyword1" id="Rank-fst_in_eclose"><span class="command">lemma</span></span> fst_in_eclose <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> eclose <span class="main">⟨</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eclose_hinsert hmem_hinsert hpair_def hunion_iff<span class="main">)</span>

<span class="keyword1" id="Rank-snd_in_eclose"><span class="command">lemma</span></span> snd_in_eclose <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> eclose <span class="main">⟨</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eclose_hinsert hmem_hinsert hpair_def hunion_iff<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 4.7. rank(x) = rank(cl(x)).›</span></span>
<span class="keyword1" id="Rank-rank_eclose"><span class="command">lemma</span></span> rank_eclose <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"rank <span class="main">(</span>eclose <span class="free">x</span><span class="main">)</span> <span class="main">=</span> rank <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hf_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>hinsert <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> hinsert_eq_sup succ_def sup.left_idem<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Epsilon-Recursion›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Theorem 4.9.  Definition of a function by recursion on rank.›</span></span>

<span class="keyword1" id="Rank-hmem_induct"><span class="command">lemma</span></span> hmem_induct <span class="main">[</span><span class="operator">case_names</span> step<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ih<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hf_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>hinsert <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms hmem_hinsert<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ih<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">hmem_rel</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hf <span class="main">*</span> hf<span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">hmem_rel</span> <span class="main">=</span> trancl <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">y</span><span class="main">}</span>"</span></span>

<span class="keyword1" id="Rank-wf_hmem_rel"><span class="command">lemma</span></span> wf_hmem_rel<span class="main">:</span> <span class="quoted"><span class="quoted">"wf hmem_rel"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> hmem_induct wfPUNIVI wfP_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hmem_rel_def wf_trancl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rank-hmem_eclose_le"><span class="command">lemma</span></span> hmem_eclose_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">x</span> <span class="main">⟹</span> eclose <span class="free">y</span> <span class="main">≤</span> eclose <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Transset_def Transset_eclose eclose_minimal hsubsetD le_eclose<span class="main">)</span>

<span class="keyword1" id="Rank-hmem_rel_iff_hmem_eclose"><span class="command">lemma</span></span> hmem_rel_iff_hmem_eclose<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">)</span> <span class="main">∈</span> hmem_rel <span class="main">⟷</span> <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> eclose <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> hmem_rel_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iffI<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> trancl <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">y</span><span class="main">}</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> eclose <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> trancl_induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>base <span class="skolem">y</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hsubsetCE le_eclose mem_Collect_eq split_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hmem_eclose_le hsubsetD mem_Collect_eq split_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Transset <span class="main">⦃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> eclose <span class="free">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> hmem_rel<span class="main">⦄</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Transset_eclose
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Transset_def hmem_rel_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> trancl_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eclose <span class="free">y</span> <span class="main">≤</span> <span class="main">⦃</span><span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> eclose <span class="free">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> hmem_rel<span class="main">⦄</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eclose_minimal<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_HCollect_iff le_eclose hmem_rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> eclose <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> trancl <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HCollect_iff hmem_rel_def hsubsetD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hmemrec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>hf <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> hf <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> hf <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">hmemrec</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> wfrec hmem_rel <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ecut</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hf <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> hf <span class="main">⇒</span> hf <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ecut</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> eclose <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">y</span> <span class="keyword1">else</span> undefined<span class="main">)</span>"</span></span>

<span class="keyword1" id="Rank-hmemrec"><span class="command">lemma</span></span> hmemrec<span class="main">:</span> <span class="quoted"><span class="quoted">"hmemrec <span class="free">G</span> <span class="free">a</span> <span class="main">=</span> <span class="free">G</span> <span class="main">(</span>ecut <span class="main">(</span>hmemrec <span class="free">G</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cut_def ecut_def hmem_rel_iff_hmem_eclose def_wfrec <span class="main"><span class="main">[</span></span><span class="operator">OF</span> hmemrec_def wf_hmem_rel<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This form avoids giant explosions in proofs.›</span></span>
<span class="keyword1" id="Rank-def_hmemrec"><span class="command">lemma</span></span> def_hmemrec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">≡</span> hmemrec <span class="free">G</span> <span class="main">⟹</span> <span class="free">f</span> <span class="free">a</span> <span class="main">=</span> <span class="free">G</span> <span class="main">(</span>ecut <span class="main">(</span>hmemrec <span class="free">G</span><span class="main">)</span> <span class="free">a</span><span class="main">)</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hmemrec<span class="main">)</span>

<span class="keyword1" id="Rank-ecut_apply"><span class="command">lemma</span></span> ecut_apply<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> eclose <span class="free">x</span> <span class="main">⟹</span> ecut <span class="free">f</span> <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> <span class="free">f</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ecut_def<span class="main">)</span>

<span class="keyword1" id="Rank-RepFun_ecut"><span class="command">lemma</span></span> RepFun_ecut<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> RepFun <span class="free">y</span> <span class="main">(</span>ecut <span class="free">f</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> RepFun <span class="free">y</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hf_ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ecut_def hsubsetD le_eclose<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> ecut_apply le_eclose hsubsetD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Now, a stronger induction rule, for the transitive closure of membership›</span></span>
<span class="keyword1" id="Rank-hmem_rel_induct"><span class="command">lemma</span></span> hmem_rel_induct <span class="main">[</span><span class="operator">case_names</span> step<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> ih<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> hmem_rel <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">y</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">∈</span> hmem_rel <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hf_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eclose_0 hmem_hempty hmem_rel_iff_hmem_eclose<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>hinsert <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms eclose_hinsert hmem_hinsert hmem_rel_iff_hmem_eclose hunion_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Rank-rank_HUnion_less"><span class="command">lemma</span></span> rank_HUnion_less<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> rank <span class="main">(</span><span class="main">⨆</span><span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> rank <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hf_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> hmem_hinsert rank_hinsert rank_lt<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> HUnion_hempty Ord_lt_succ_iff_le Ord_rank hunion_hempty_right
               less_supI1 less_supI2 rank_sup sup.cobounded2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">corollary</span></span> Sup_ne<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">⨆</span><span class="free">x</span> <span class="main">≠</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_irrefl rank_HUnion_less<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Finite_Automata">
<div class="head">
<h1>Theory Finite_Automata</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹An Application: Finite Automata›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Finite_Automata <span class="keyword2"><span class="keyword">imports</span></span> <a href="Ordinal.html">Ordinal</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The point of this example is that the HF sets are closed under disjoint sums and Cartesian products,
 allowing the theory of finite state machines to be developed without issues of polymorphism
 or any tricky encodings of states.›</span></span>

<span class="keyword1"><span class="command">record</span></span> <span class="tfree">'a</span> fsm <span class="main">=</span> states <span class="main">::</span> <span class="quoted">hf</span>
                init <span class="main">::</span> <span class="quoted">hf</span>
                final <span class="main">::</span> <span class="quoted">hf</span>
                <span class="quoted">"next"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> hf <span class="main">⇒</span> bool"</span></span>

<span class="keyword1"><span class="command">inductive</span></span> <span class="entity">reaches</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> fsm<span class="main">,</span> hf<span class="main">,</span> <span class="tfree">'a</span> list<span class="main">,</span> hf<span class="main">]</span> <span class="main">⇒</span> bool"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
    Nil<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">st</span></span></span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> states <span class="free"><span class="bound"><span class="entity">fsm</span></span></span> <span class="main">⟹</span> <span class="free">reaches</span> <span class="free"><span class="bound"><span class="entity">fsm</span></span></span> <span class="free"><span class="bound"><span class="entity">st</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">st</span></span></span>"</span></span>
  <span class="main">|</span> Cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>next <span class="free"><span class="bound"><span class="entity">fsm</span></span></span> <span class="free"><span class="bound"><span class="entity">st</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">st''</span></span></span><span class="main">;</span> <span class="free">reaches</span> <span class="free"><span class="bound"><span class="entity">fsm</span></span></span> <span class="free"><span class="bound"><span class="entity">st''</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">st'</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">st</span></span></span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> states <span class="free"><span class="bound"><span class="entity">fsm</span></span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">reaches</span> <span class="free"><span class="bound"><span class="entity">fsm</span></span></span> <span class="free"><span class="bound"><span class="entity">st</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">st'</span></span></span>"</span></span>

<span class="keyword1"><span class="command">declare</span></span> reaches.intros <span class="main">[</span><span class="operator">intro</span><span class="main">]</span>
<span class="keyword1"><span class="command">inductive_simps</span></span> reaches_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"reaches <span class="free">fsm</span> <span class="free">st</span> <span class="main">[]</span> <span class="free">st'</span>"</span></span>
<span class="keyword1"><span class="command">inductive_simps</span></span> reaches_Cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"reaches <span class="free">fsm</span> <span class="free">st</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">)</span> <span class="free">st'</span>"</span></span>

<span class="keyword1" id="Finite_Automata-reaches_imp_states"><span class="command">lemma</span></span> reaches_imp_states<span class="main">:</span> <span class="quoted"><span class="quoted">"reaches <span class="free">fsm</span> <span class="free">st</span> <span class="free">xs</span> <span class="free">st'</span> <span class="main">⟹</span> <span class="free">st</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> states <span class="free">fsm</span> <span class="main">∧</span> <span class="free">st'</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> states <span class="free">fsm</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">st</span></span> <span class="quoted"><span class="free">st'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Finite_Automata-reaches_append_iff"><span class="command">lemma</span></span> reaches_append_iff<span class="main">:</span>
     <span class="quoted"><span class="quoted">"reaches <span class="free">fsm</span> <span class="free">st</span> <span class="main">(</span><span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">)</span> <span class="free">st'</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">st''</span><span class="main">.</span> reaches <span class="free">fsm</span> <span class="free">st</span> <span class="free">xs</span> <span class="bound">st''</span> <span class="main">∧</span> reaches <span class="free">fsm</span> <span class="bound">st''</span> <span class="free">ys</span> <span class="free">st'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quoted"><span class="free">st</span></span> <span class="quoted"><span class="free">st'</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> reaches_imp_states<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">accepts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> fsm <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> bool"</span></span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">accepts</span> <span class="free"><span class="bound"><span class="entity">fsm</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">st</span> <span class="bound">st'</span><span class="main">.</span> reaches <span class="free"><span class="bound"><span class="entity">fsm</span></span></span> <span class="bound">st</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="bound">st'</span> <span class="main">∧</span> <span class="bound">st</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> init <span class="free"><span class="bound"><span class="entity">fsm</span></span></span> <span class="main">∧</span> <span class="bound">st'</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> final <span class="free"><span class="bound"><span class="entity">fsm</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">regular</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">regular</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">fsm</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> accepts <span class="bound">fsm</span> <span class="bound">xs</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Null</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Null</span> <span class="main">=</span> <span class="main">⦇</span>states <span class="main">=</span> <span class="main">0</span><span class="main">,</span> init <span class="main">=</span> <span class="main">0</span><span class="main">,</span> final <span class="main">=</span> <span class="main">0</span><span class="main">,</span> next <span class="main">=</span> <span class="main">λ</span><span class="bound">st</span> <span class="bound">x</span> <span class="bound">st'</span><span class="main">.</span> False<span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> regular_empty<span class="main">:</span>  <span class="quoted"><span class="quoted">"regular <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> regular_def accepts_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> hempty_iff simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">NullStr</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">NullStr</span> <span class="main">≡</span> <span class="main">⦇</span>states <span class="main">=</span> <span class="main">1</span><span class="main">,</span> init <span class="main">=</span> <span class="main">1</span><span class="main">,</span> final <span class="main">=</span> <span class="main">1</span><span class="main">,</span> next <span class="main">=</span> <span class="main">λ</span><span class="bound">st</span> <span class="bound">x</span> <span class="bound">st'</span><span class="main">.</span> False<span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> regular_emptystr<span class="main">:</span>  <span class="quoted"><span class="quoted">"regular <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> regular_def accepts_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">NullStr</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">SingStr</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SingStr</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="main">⦇</span>states <span class="main">=</span> <span class="main">⦃</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">⦄</span><span class="main">,</span> init <span class="main">=</span> <span class="main">⦃</span><span class="main">0</span><span class="main">⦄</span><span class="main">,</span> final <span class="main">=</span> <span class="main">⦃</span><span class="main">1</span><span class="main">⦄</span><span class="main">,</span> next <span class="main">=</span> <span class="main">λ</span><span class="bound">st</span> <span class="bound">x</span> <span class="bound">st'</span><span class="main">.</span> <span class="bound">st</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="bound">st'</span><span class="main">=</span><span class="main">1</span><span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">theorem</span></span> regular_singstr<span class="main">:</span> <span class="quoted"><span class="quoted">"regular <span class="main">{</span><span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> regular_def accepts_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"SingStr <span class="free"><span class="free">a</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">list</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Reverse</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Reverse</span> <span class="free"><span class="bound"><span class="entity">fsm</span></span></span> <span class="main">=</span> <span class="main">⦇</span>states <span class="main">=</span> states <span class="free"><span class="bound"><span class="entity">fsm</span></span></span><span class="main">,</span> init <span class="main">=</span> final <span class="free"><span class="bound"><span class="entity">fsm</span></span></span><span class="main">,</span> final <span class="main">=</span> init <span class="free"><span class="bound"><span class="entity">fsm</span></span></span><span class="main">,</span>
                  next <span class="main">=</span> <span class="main">λ</span><span class="bound">st</span> <span class="bound">x</span> <span class="bound">st'</span><span class="main">.</span> next <span class="free"><span class="bound"><span class="entity">fsm</span></span></span> <span class="bound">st'</span> <span class="bound">x</span> <span class="bound">st</span><span class="main">⦈</span>"</span></span>

<span class="keyword1" id="Finite_Automata-Reverse_Reverse_ident"><span class="command">lemma</span></span> Reverse_Reverse_ident <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Reverse <span class="main">(</span>Reverse <span class="free">fsm</span><span class="main">)</span> <span class="main">=</span> <span class="free">fsm</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Reverse_def<span class="main">)</span>

<span class="keyword1" id="Finite_Automata-reaches_Reverse_iff"><span class="command">lemma</span></span> reaches_Reverse_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
     <span class="quoted"><span class="quoted">"reaches <span class="main">(</span>Reverse <span class="free">fsm</span><span class="main">)</span> <span class="free">st</span> <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span> <span class="free">st'</span> <span class="main">⟷</span> reaches <span class="free">fsm</span> <span class="free">st'</span> <span class="free">xs</span> <span class="free">st</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">st</span></span> <span class="quoted"><span class="free">st'</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Reverse_def reaches_append_iff reaches_imp_states<span class="main">)</span>

<span class="keyword1" id="Finite_Automata-reaches_Reverse_iff2"><span class="command">lemma</span></span> reaches_Reverse_iff2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
     <span class="quoted"><span class="quoted">"reaches <span class="main">(</span>Reverse <span class="free">fsm</span><span class="main">)</span> <span class="free">st'</span> <span class="free">xs</span> <span class="free">st</span> <span class="main">⟷</span> reaches <span class="free">fsm</span> <span class="free">st</span> <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span> <span class="free">st'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> reaches_Reverse_iff rev_rev_ident<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"init <span class="main">(</span>Reverse <span class="free">fsm</span><span class="main">)</span> <span class="main">=</span> final <span class="free">fsm</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Reverse_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"final <span class="main">(</span>Reverse <span class="free">fsm</span><span class="main">)</span> <span class="main">=</span> init <span class="free">fsm</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Reverse_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> regular_rev<span class="main">:</span> <span class="quoted"><span class="quoted">"regular <span class="free">S</span> <span class="main">⟹</span> regular <span class="main">(</span>rev <span class="main">`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> regular_def accepts_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Reverse <span class="improper">fsm</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Times</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Times</span> <span class="free"><span class="bound"><span class="entity">fsm1</span></span></span> <span class="free"><span class="bound"><span class="entity">fsm2</span></span></span> <span class="main">=</span> <span class="main">⦇</span>states <span class="main">=</span> states <span class="free"><span class="bound"><span class="entity">fsm1</span></span></span> <span class="main">*</span> states <span class="free"><span class="bound"><span class="entity">fsm2</span></span></span><span class="main">,</span>
                      init <span class="main">=</span> init <span class="free"><span class="bound"><span class="entity">fsm1</span></span></span> <span class="main">*</span> init <span class="free"><span class="bound"><span class="entity">fsm2</span></span></span><span class="main">,</span>
                      final <span class="main">=</span> final <span class="free"><span class="bound"><span class="entity">fsm1</span></span></span> <span class="main">*</span> final <span class="free"><span class="bound"><span class="entity">fsm2</span></span></span><span class="main">,</span>
                      next <span class="main">=</span> <span class="main">λ</span><span class="bound">st</span> <span class="bound">x</span> <span class="bound">st'</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">st1</span> <span class="bound">st2</span> <span class="bound">st1'</span> <span class="bound">st2'</span><span class="main">.</span> <span class="bound">st</span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">st1</span><span class="main">,</span><span class="bound">st2</span><span class="main">⟩</span> <span class="main">∧</span> <span class="bound">st'</span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">st1'</span><span class="main">,</span><span class="bound">st2'</span><span class="main">⟩</span> <span class="main">∧</span>
                                      next <span class="free"><span class="bound"><span class="entity">fsm1</span></span></span> <span class="bound">st1</span> <span class="bound">x</span> <span class="bound">st1'</span> <span class="main">∧</span> next <span class="free"><span class="bound"><span class="entity">fsm2</span></span></span> <span class="bound">st2</span> <span class="bound">x</span> <span class="bound">st2'</span><span class="main">)</span><span class="main">⦈</span>"</span></span>

<span class="keyword1" id="Finite_Automata-states_Times"><span class="command">lemma</span></span> states_Times <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"states <span class="main">(</span>Times <span class="free">fsm1</span> <span class="free">fsm2</span><span class="main">)</span> <span class="main">=</span> states <span class="free">fsm1</span> <span class="main">*</span> states <span class="free">fsm2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Times_def<span class="main">)</span>

<span class="keyword1" id="Finite_Automata-init_Times"><span class="command">lemma</span></span> init_Times <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"init <span class="main">(</span>Times <span class="free">fsm1</span> <span class="free">fsm2</span><span class="main">)</span> <span class="main">=</span> init <span class="free">fsm1</span> <span class="main">*</span> init <span class="free">fsm2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Times_def<span class="main">)</span>

<span class="keyword1" id="Finite_Automata-final_Times"><span class="command">lemma</span></span> final_Times <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"final <span class="main">(</span>Times <span class="free">fsm1</span> <span class="free">fsm2</span><span class="main">)</span> <span class="main">=</span> final <span class="free">fsm1</span> <span class="main">*</span> final <span class="free">fsm2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Times_def<span class="main">)</span>

<span class="keyword1" id="Finite_Automata-next_Times"><span class="command">lemma</span></span> next_Times<span class="main">:</span> <span class="quoted"><span class="quoted">"next <span class="main">(</span>Times <span class="free">fsm1</span> <span class="free">fsm2</span><span class="main">)</span> <span class="main">⟨</span><span class="free">st1</span><span class="main">,</span><span class="free">st2</span><span class="main">⟩</span> <span class="free">x</span> <span class="free">st'</span> <span class="main">⟷</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">st1'</span> <span class="bound">st2'</span><span class="main">.</span> <span class="free">st'</span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">st1'</span><span class="main">,</span><span class="bound">st2'</span><span class="main">⟩</span> <span class="main">∧</span> next <span class="free">fsm1</span> <span class="free">st1</span> <span class="free">x</span> <span class="bound">st1'</span> <span class="main">∧</span> next <span class="free">fsm2</span> <span class="free">st2</span> <span class="free">x</span> <span class="bound">st2'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Times_def<span class="main">)</span>

<span class="keyword1" id="Finite_Automata-reaches_Times_iff"><span class="command">lemma</span></span> reaches_Times_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
     <span class="quoted"><span class="quoted">"reaches <span class="main">(</span>Times <span class="free">fsm1</span> <span class="free">fsm2</span><span class="main">)</span> <span class="main">⟨</span><span class="free">st1</span><span class="main">,</span><span class="free">st2</span><span class="main">⟩</span> <span class="free">xs</span> <span class="main">⟨</span><span class="free">st1'</span><span class="main">,</span><span class="free">st2'</span><span class="main">⟩</span> <span class="main">⟷</span>
      reaches <span class="free">fsm1</span> <span class="free">st1</span> <span class="free">xs</span> <span class="free">st1'</span> <span class="main">∧</span> reaches <span class="free">fsm2</span> <span class="free">st2</span> <span class="free">xs</span> <span class="free">st2'</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">st1</span></span> <span class="quoted"><span class="free">st2</span></span> <span class="quoted"><span class="free">st1'</span></span> <span class="quoted"><span class="free">st2'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> next_Times Times_def reaches.Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Finite_Automata-accepts_Times_iff"><span class="command">lemma</span></span> accepts_Times_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
     <span class="quoted"><span class="quoted">"accepts <span class="main">(</span>Times <span class="free">fsm1</span> <span class="free">fsm2</span><span class="main">)</span> <span class="free">xs</span> <span class="main">⟷</span>
      accepts <span class="free">fsm1</span> <span class="free">xs</span> <span class="main">∧</span> accepts <span class="free">fsm2</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> accepts_def<span class="main">)</span>

<span class="keyword1"><span class="command">theorem</span></span> regular_Int<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"regular <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"regular <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"regular <span class="main">(</span><span class="free">S</span> <span class="main">∩</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fsmS</span></span> <span class="skolem"><span class="skolem">fsmT</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> accepts <span class="skolem">fsmS</span> <span class="bound">xs</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> accepts <span class="skolem">fsmT</span> <span class="bound">xs</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S T
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> regular_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∩</span> <span class="free">T</span> <span class="main">=</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> accepts <span class="main">(</span>Times <span class="skolem">fsmS</span> <span class="skolem">fsmT</span><span class="main">)</span> <span class="bound">xs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> accepts_Times_iff <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">fsmS</span></span> <span class="quoted"><span class="skolem">fsmT</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> regular_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Plus</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Plus</span> <span class="free"><span class="bound"><span class="entity">fsm1</span></span></span> <span class="free"><span class="bound"><span class="entity">fsm2</span></span></span> <span class="main">=</span> <span class="main">⦇</span>states <span class="main">=</span> states <span class="free"><span class="bound"><span class="entity">fsm1</span></span></span> <span class="main">+</span> states <span class="free"><span class="bound"><span class="entity">fsm2</span></span></span><span class="main">,</span>
                      init <span class="main">=</span> init <span class="free"><span class="bound"><span class="entity">fsm1</span></span></span> <span class="main">+</span> init <span class="free"><span class="bound"><span class="entity">fsm2</span></span></span><span class="main">,</span>
                      final <span class="main">=</span> final <span class="free"><span class="bound"><span class="entity">fsm1</span></span></span> <span class="main">+</span> final <span class="free"><span class="bound"><span class="entity">fsm2</span></span></span><span class="main">,</span>
                      next <span class="main">=</span> <span class="main">λ</span><span class="bound">st</span> <span class="bound">x</span> <span class="bound">st'</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">st1</span> <span class="bound">st1'</span><span class="main">.</span> <span class="bound">st</span> <span class="main">=</span> Inl <span class="bound">st1</span> <span class="main">∧</span> <span class="bound">st'</span> <span class="main">=</span> Inl <span class="bound">st1'</span> <span class="main">∧</span> next <span class="free"><span class="bound"><span class="entity">fsm1</span></span></span> <span class="bound">st1</span> <span class="bound">x</span> <span class="bound">st1'</span><span class="main">)</span> <span class="main">∨</span>
                                       <span class="main">(</span><span class="main">∃</span><span class="bound">st2</span> <span class="bound">st2'</span><span class="main">.</span> <span class="bound">st</span> <span class="main">=</span> Inr <span class="bound">st2</span> <span class="main">∧</span> <span class="bound">st'</span> <span class="main">=</span> Inr <span class="bound">st2'</span> <span class="main">∧</span> next <span class="free"><span class="bound"><span class="entity">fsm2</span></span></span> <span class="bound">st2</span> <span class="bound">x</span> <span class="bound">st2'</span><span class="main">)</span><span class="main">⦈</span>"</span></span>

<span class="keyword1" id="Finite_Automata-states_Plus"><span class="command">lemma</span></span> states_Plus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"states <span class="main">(</span>Plus <span class="free">fsm1</span> <span class="free">fsm2</span><span class="main">)</span> <span class="main">=</span> states <span class="free">fsm1</span> <span class="main">+</span> states <span class="free">fsm2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Plus_def<span class="main">)</span>

<span class="keyword1" id="Finite_Automata-init_Plus"><span class="command">lemma</span></span> init_Plus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"init <span class="main">(</span>Plus <span class="free">fsm1</span> <span class="free">fsm2</span><span class="main">)</span> <span class="main">=</span> init <span class="free">fsm1</span> <span class="main">+</span> init <span class="free">fsm2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Plus_def<span class="main">)</span>

<span class="keyword1" id="Finite_Automata-final_Plus"><span class="command">lemma</span></span> final_Plus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"final <span class="main">(</span>Plus <span class="free">fsm1</span> <span class="free">fsm2</span><span class="main">)</span> <span class="main">=</span> final <span class="free">fsm1</span> <span class="main">+</span> final <span class="free">fsm2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Plus_def<span class="main">)</span>

<span class="keyword1" id="Finite_Automata-next_Plus1"><span class="command">lemma</span></span> next_Plus1<span class="main">:</span> <span class="quoted"><span class="quoted">"next <span class="main">(</span>Plus <span class="free">fsm1</span> <span class="free">fsm2</span><span class="main">)</span> <span class="main">(</span>Inl <span class="free">st1</span><span class="main">)</span> <span class="free">x</span> <span class="free">st'</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">st1'</span><span class="main">.</span> <span class="free">st'</span> <span class="main">=</span> Inl <span class="bound">st1'</span> <span class="main">∧</span> next <span class="free">fsm1</span> <span class="free">st1</span> <span class="free">x</span> <span class="bound">st1'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Plus_def<span class="main">)</span>

<span class="keyword1" id="Finite_Automata-next_Plus2"><span class="command">lemma</span></span> next_Plus2<span class="main">:</span> <span class="quoted"><span class="quoted">"next <span class="main">(</span>Plus <span class="free">fsm1</span> <span class="free">fsm2</span><span class="main">)</span> <span class="main">(</span>Inr <span class="free">st2</span><span class="main">)</span> <span class="free">x</span> <span class="free">st'</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">st2'</span><span class="main">.</span> <span class="free">st'</span> <span class="main">=</span> Inr <span class="bound">st2'</span> <span class="main">∧</span> next <span class="free">fsm2</span> <span class="free">st2</span> <span class="free">x</span> <span class="bound">st2'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Plus_def<span class="main">)</span>

<span class="keyword1" id="Finite_Automata-reaches_Plus_iff1"><span class="command">lemma</span></span> reaches_Plus_iff1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
     <span class="quoted"><span class="quoted">"reaches <span class="main">(</span>Plus <span class="free">fsm1</span> <span class="free">fsm2</span><span class="main">)</span> <span class="main">(</span>Inl <span class="free">st1</span><span class="main">)</span> <span class="free">xs</span> <span class="free">st'</span> <span class="main">⟷</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">st1'</span><span class="main">.</span> <span class="free">st'</span> <span class="main">=</span> Inl <span class="bound">st1'</span> <span class="main">∧</span> reaches <span class="free">fsm1</span> <span class="free">st1</span> <span class="free">xs</span> <span class="bound">st1'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">st1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> next_Plus1 reaches.Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Finite_Automata-reaches_Plus_iff2"><span class="command">lemma</span></span> reaches_Plus_iff2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
     <span class="quoted"><span class="quoted">"reaches <span class="main">(</span>Plus <span class="free">fsm1</span> <span class="free">fsm2</span><span class="main">)</span> <span class="main">(</span>Inr <span class="free">st2</span><span class="main">)</span> <span class="free">xs</span> <span class="free">st'</span> <span class="main">⟷</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">st2'</span><span class="main">.</span> <span class="free">st'</span> <span class="main">=</span> Inr <span class="bound">st2'</span> <span class="main">∧</span> reaches <span class="free">fsm2</span> <span class="free">st2</span> <span class="free">xs</span> <span class="bound">st2'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">st2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> next_Plus2 reaches.Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Finite_Automata-reaches_Plus_iff"><span class="command">lemma</span></span> reaches_Plus_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
     <span class="quoted"><span class="quoted">"reaches <span class="main">(</span>Plus <span class="free">fsm1</span> <span class="free">fsm2</span><span class="main">)</span> <span class="free">st</span> <span class="free">xs</span> <span class="free">st'</span> <span class="main">⟷</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">st1</span> <span class="bound">st1'</span><span class="main">.</span> <span class="free">st</span> <span class="main">=</span> Inl <span class="bound">st1</span> <span class="main">∧</span> <span class="free">st'</span> <span class="main">=</span> Inl <span class="bound">st1'</span> <span class="main">∧</span> reaches <span class="free">fsm1</span> <span class="bound">st1</span> <span class="free">xs</span> <span class="bound">st1'</span><span class="main">)</span> <span class="main">∨</span>
      <span class="main">(</span><span class="main">∃</span><span class="bound">st2</span> <span class="bound">st2'</span><span class="main">.</span> <span class="free">st</span> <span class="main">=</span> Inr <span class="bound">st2</span> <span class="main">∧</span> <span class="free">st'</span> <span class="main">=</span> Inr <span class="bound">st2'</span> <span class="main">∧</span> reaches <span class="free">fsm2</span> <span class="bound">st2</span> <span class="free">xs</span> <span class="bound">st2'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">st</span></span> <span class="quoted"><span class="free">st'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> next_Plus1 next_Plus2 Plus_def reaches.Cons<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Plus_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Finite_Automata-accepts_Plus_iff"><span class="command">lemma</span></span> accepts_Plus_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
     <span class="quoted"><span class="quoted">"accepts <span class="main">(</span>Plus <span class="free">fsm1</span> <span class="free">fsm2</span><span class="main">)</span> <span class="free">xs</span> <span class="main">⟷</span> accepts <span class="free">fsm1</span> <span class="free">xs</span> <span class="main">∨</span> accepts <span class="free">fsm2</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> accepts_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> sum_iff<span class="main">)</span>

<span class="keyword1" id="Finite_Automata-regular_Un"><span class="command">lemma</span></span> regular_Un<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"regular <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"regular <span class="free">T</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"regular <span class="main">(</span><span class="free">S</span> <span class="main">∪</span> <span class="free">T</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fsmS</span></span> <span class="skolem"><span class="skolem">fsmT</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> accepts <span class="skolem">fsmS</span> <span class="bound">xs</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="main">=</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> accepts <span class="skolem">fsmT</span> <span class="bound">xs</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S T
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> regular_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">∪</span> <span class="free">T</span> <span class="main">=</span> <span class="main">{</span><span class="bound">xs</span><span class="main">.</span> accepts <span class="main">(</span>Plus <span class="skolem">fsmS</span> <span class="skolem">fsmT</span><span class="main">)</span> <span class="bound">xs</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> accepts_Plus_iff <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem">fsmS</span></span> <span class="quoted"><span class="skolem">fsmT</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> regular_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Finitary">
<div class="head">
<h1>Theory Finitary</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Finitary
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Ordinal.html">Ordinal</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">class</span></span> finitary <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">hf_of</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inj<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="free">hf_of</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="Finitary-hf_of_eq_iff"><span class="command">lemma</span></span> hf_of_eq_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hf_of <span class="free">x</span> <span class="main">=</span> hf_of <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span><span class="main">=</span><span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inj <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> unit <span class="main">::</span> <span class="quoted">finitary</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> hf_of_unit_def<span class="main">:</span> <span class="quoted"><span class="quoted">"hf_of <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">::</span>unit<span class="main">)</span> <span class="main">≡</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def hf_of_unit_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> bool <span class="main">::</span> <span class="quoted">finitary</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> hf_of_bool_def<span class="main">:</span> <span class="quoted"><span class="quoted">"hf_of <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def hf_of_bool_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> nat <span class="main">::</span> <span class="quoted">finitary</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> hf_of_nat_def<span class="main">:</span> <span class="quoted"><span class="quoted">"hf_of <span class="main">≡</span> ord_of"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def hf_of_nat_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> int <span class="main">::</span> <span class="quoted">finitary</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> hf_of_int_def<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"hf_of <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">≥</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>int<span class="main">)</span> <span class="keyword1">then</span> <span class="main">⟨</span><span class="main">0</span><span class="main">,</span> hf_of <span class="main">(</span>nat <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">⟩</span> <span class="keyword1">else</span> <span class="main">⟨</span><span class="main">1</span><span class="main">,</span> hf_of <span class="main">(</span>nat <span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def hf_of_int_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Strings are char lists, and are not considered separately.›</span></span>
<span class="keyword1"><span class="command">instantiation</span></span> char <span class="main">::</span> <span class="quoted">finitary</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> hf_of_char_def<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"hf_of <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> hf_of <span class="main">(</span>of_char <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::</span> nat<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def hf_of_char_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> prod <span class="main">::</span> <span class="main">(</span><span class="quoted">finitary</span><span class="main">,</span><span class="quoted">finitary</span><span class="main">)</span> <span class="quoted">finitary</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> hf_of_prod_def<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"hf_of <span class="main">≡</span> <span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">⟨</span>hf_of <span class="bound">x</span><span class="main">,</span> hf_of <span class="bound">y</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def hf_of_prod_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> sum <span class="main">::</span> <span class="main">(</span><span class="quoted">finitary</span><span class="main">,</span><span class="quoted">finitary</span><span class="main">)</span> <span class="quoted">finitary</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> hf_of_sum_def<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"hf_of <span class="main">≡</span> case_sum <span class="main">(</span>HF.Inl <span class="keyword1">o</span> hf_of<span class="main">)</span> <span class="main">(</span>HF.Inr <span class="keyword1">o</span> hf_of<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def hf_of_sum_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> sum.split_asm<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> option <span class="main">::</span> <span class="main">(</span><span class="quoted">finitary</span><span class="main">)</span> <span class="quoted">finitary</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> hf_of_option_def<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"hf_of <span class="main">≡</span> case_option <span class="main">0</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">⦃</span>hf_of <span class="bound">x</span><span class="main">⦄</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">instance</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def hf_of_option_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split_asm<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> list <span class="main">::</span> <span class="main">(</span><span class="quoted">finitary</span><span class="main">)</span> <span class="quoted">finitary</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">primrec</span></span> <span class="entity"><span class="class_parameter">hf_of_list</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">hf_of_list</span> Nil <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">hf_of_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">⟨</span>hf_of <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> <span class="free">hf_of_list</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hf_of <span class="free">x</span> <span class="main">=</span> hf_of <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> hf_of_list.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hpair_nonzero neq_Nil_conv<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rename_tac</span> y<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">instance</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="OrdArith">
<div class="head">
<h1>Theory OrdArith</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">chapter</span></span> <span class="quoted"><span class="plain_text">‹Addition, Sequences and their Concatenation›</span></span>

<span class="keyword1"><span class="command">theory</span></span> OrdArith <span class="keyword2"><span class="keyword">imports</span></span> <a href="Rank.html">Rank</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Generalised Addition --- Also for Ordinals›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Source: Laurence Kirby, Addition and multiplication of sets
      Math. Log. Quart. 53, No. 1, 52-65 (2007) / DOI 10.1002/malq.200610026
      <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">url</span></span> "http://faculty.baruch.cuny.edu/lkirby/mlqarticlejan2007.pdf"<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">hadd</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf <span class="main">⇒</span> hf"</span></span>           <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">@+</span>"</span> 65<span class="main">)</span>  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">hadd</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> hmemrec <span class="main">(</span><span class="main">λ</span><span class="bound">f</span> <span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⊔</span> RepFun <span class="bound">z</span> <span class="bound">f</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="OrdArith-hadd"><span class="command">lemma</span></span> hadd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">@+</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⊔</span> RepFun <span class="free">y</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">@+</span> <span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> def_hmemrec RepFun_ecut hadd_def order_refl<span class="main">)</span>

<span class="keyword1" id="OrdArith-hmem_hadd_E"><span class="command">lemma</span></span> hmem_hadd_E<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">x</span> <span class="main">@+</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">x</span>"</span></span> <span class="main">|</span> <span class="free">z</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> <span class="free">x</span> <span class="main">@+</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> l
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hadd <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="OrdArith-hadd_0_right"><span class="command">lemma</span></span> hadd_0_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">@+</span> <span class="main">0</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> hadd<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1" id="OrdArith-hadd_hinsert_right"><span class="command">lemma</span></span> hadd_hinsert_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">@+</span> hinsert <span class="free">y</span> <span class="free">z</span> <span class="main">=</span> hinsert <span class="main">(</span><span class="free">x</span> <span class="main">@+</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">@+</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hadd hunion_hinsert_right RepFun_hinsert<span class="main">)</span>

<span class="keyword1" id="OrdArith-hadd_succ_right"><span class="command">lemma</span></span> hadd_succ_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">@+</span> succ <span class="free">y</span> <span class="main">=</span> succ <span class="main">(</span><span class="free">x</span> <span class="main">@+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hadd_hinsert_right succ_def<span class="main">)</span>

<span class="keyword1" id="OrdArith-not_add_less_right"><span class="command">lemma</span></span> not_add_less_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">x</span> <span class="main">@+</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> less_supI1 hadd order_less_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="OrdArith-not_add_mem_right"><span class="command">lemma</span></span> not_add_mem_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">x</span> <span class="main">@+</span> <span class="free">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hadd hmem_not_refl hunion_iff<span class="main">)</span>

<span class="keyword1" id="OrdArith-hadd_0_left"><span class="command">lemma</span></span> hadd_0_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">@+</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hadd_hinsert_right<span class="main">)</span>

<span class="keyword1" id="OrdArith-hadd_succ_left"><span class="command">lemma</span></span> hadd_succ_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">y</span> <span class="main">⟹</span> succ <span class="free">x</span> <span class="main">@+</span> <span class="free">y</span> <span class="main">=</span> succ <span class="main">(</span><span class="free">x</span> <span class="main">@+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct2<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="OrdArith-hadd_assoc"><span class="command">lemma</span></span> hadd_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">@+</span> <span class="free">y</span><span class="main">)</span> <span class="main">@+</span> <span class="free">z</span> <span class="main">=</span> <span class="free">x</span> <span class="main">@+</span> <span class="main">(</span><span class="free">y</span> <span class="main">@+</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">z</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hadd_hinsert_right<span class="main">)</span>

<span class="keyword1" id="OrdArith-RepFun_hadd_disjoint"><span class="command">lemma</span></span> RepFun_hadd_disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊓</span> RepFun <span class="free">y</span> <span class="main">(</span><span class="main">(@+)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hf_equalityI RepFun_iff hinter_iff not_add_mem_right hmem_hempty<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Cancellation laws for addition›</span></span>

<span class="keyword1" id="OrdArith-Rep_le_Cancel"><span class="command">lemma</span></span> Rep_le_Cancel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">⊔</span> RepFun <span class="free">y</span> <span class="main">(</span><span class="main">(@+)</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⊔</span> RepFun <span class="free">z</span> <span class="main">(</span><span class="main">(@+)</span> <span class="free">x</span><span class="main">)</span>
                      <span class="main">⟹</span> RepFun <span class="free">y</span> <span class="main">(</span><span class="main">(@+)</span> <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> RepFun <span class="free">z</span> <span class="main">(</span><span class="main">(@+)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_add_mem_right<span class="main">)</span>

<span class="keyword1" id="OrdArith-hadd_cancel_right"><span class="command">lemma</span></span> hadd_cancel_right <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">@+</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">@+</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span><span class="main">=</span><span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">z</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hmem_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>step <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">@+</span> <span class="skolem">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">@+</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"RepFun <span class="skolem">y</span> <span class="main">(</span><span class="main">(@+)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> RepFun <span class="skolem">z</span> <span class="main">(</span><span class="main">(@+)</span> <span class="free">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hadd Rep_le_Cancel order_antisym order_refl<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hf_equalityI RepFun_iff step<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OrdArith-RepFun_hadd_cancel"><span class="command">lemma</span></span> RepFun_hadd_cancel<span class="main">:</span> <span class="quoted"><span class="quoted">"RepFun <span class="free">y</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">@+</span> <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> RepFun <span class="free">z</span> <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">@+</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">y</span><span class="main">=</span><span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hadd hadd_cancel_right<span class="main">)</span>

<span class="keyword1" id="OrdArith-hadd_hmem_cancel"><span class="command">lemma</span></span> hadd_hmem_cancel <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">@+</span> <span class="free">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">x</span> <span class="main">@+</span> <span class="free">z</span> <span class="main">⟷</span> <span class="free">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hadd <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span> hadd <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">z</span></span><span class="main"><span class="main">]</span></span> not_add_mem_right<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> hmem_not_refl hunion_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> hadd hadd_cancel_right<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="OrdArith-ord_of_add"><span class="command">lemma</span></span> ord_of_add<span class="main">:</span> <span class="quoted"><span class="quoted">"ord_of <span class="main">(</span><span class="free">i</span><span class="main">+</span><span class="free">j</span><span class="main">)</span> <span class="main">=</span> ord_of <span class="free">i</span> <span class="main">@+</span> ord_of <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">j</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="OrdArith-Ord_hadd"><span class="command">lemma</span></span> Ord_hadd<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">x</span> <span class="main">⟹</span> Ord <span class="free">y</span> <span class="main">⟹</span> Ord <span class="main">(</span><span class="free">x</span> <span class="main">@+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct2<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="OrdArith-hmem_self_hadd"><span class="command">lemma</span></span> hmem_self_hadd <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k1</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k1</span> <span class="main">@+</span> <span class="free">k2</span> <span class="main">⟷</span> <span class="main">0</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hadd_0_right hadd_hmem_cancel<span class="main">)</span>

<span class="keyword1" id="OrdArith-hadd_commute"><span class="command">lemma</span></span> hadd_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">x</span> <span class="main">⟹</span> Ord <span class="free">y</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">@+</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y</span> <span class="main">@+</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct2<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="OrdArith-hadd_cancel_left"><span class="command">lemma</span></span> hadd_cancel_left <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">x</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">@+</span> <span class="free">x</span> <span class="main">=</span> <span class="free">z</span> <span class="main">@+</span> <span class="free">x</span> <span class="main">⟷</span> <span class="free">y</span><span class="main">=</span><span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct2<span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The predecessor function›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">pred</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">y</span><span class="main">.</span> succ <span class="bound">y</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="bound">y</span><span class="main">=</span><span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="OrdArith-pred_succ"><span class="command">lemma</span></span> pred_succ <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pred <span class="main">(</span>succ <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pred_def<span class="main">)</span>

<span class="keyword1" id="OrdArith-pred_0"><span class="command">lemma</span></span> pred_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"pred <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pred_def<span class="main">)</span>

<span class="keyword1" id="OrdArith-succ_pred"><span class="command">lemma</span></span> succ_pred <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> succ <span class="main">(</span>pred <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_cases pred_succ<span class="main">)</span>

<span class="keyword1" id="OrdArith-pred_mem"><span class="command">lemma</span></span> pred_mem <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> pred <span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> succ_iff succ_pred<span class="main">)</span>

<span class="keyword1" id="OrdArith-Ord_pred"><span class="command">lemma</span></span> Ord_pred <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">x</span> <span class="main">⟹</span> Ord <span class="main">(</span>pred <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ord_in_Ord pred_0 pred_mem<span class="main">)</span>

<span class="keyword1" id="OrdArith-hadd_pred_right"><span class="command">lemma</span></span> hadd_pred_right<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">@+</span> pred <span class="free">y</span> <span class="main">=</span> pred <span class="main">(</span><span class="free">x</span> <span class="main">@+</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hadd_succ_right pred_succ succ_pred<span class="main">)</span>

<span class="keyword1" id="OrdArith-Ord_pred_HUnion"><span class="command">lemma</span></span> Ord_pred_HUnion<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">⟹</span> pred <span class="free">k</span> <span class="main">=</span> <span class="main">⨆</span><span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> HUnion_hempty Ordinal.Ord_pred pred_0 pred_succ<span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹A Concatentation Operation for Sequences›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">shift</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">shift</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">delta</span></span></span> <span class="main">=</span> <span class="main">⦃</span><span class="bound">v</span> <span class="main">.</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span> <span class="main">∃</span><span class="bound">n</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">n</span><span class="main">,</span> <span class="bound">y</span><span class="main">⟩</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">delta</span></span></span> <span class="main">@+</span> <span class="bound">n</span><span class="main">,</span> <span class="bound">y</span><span class="main">⟩</span><span class="main">⦄</span>"</span></span>

<span class="keyword1" id="OrdArith-shiftD"><span class="command">lemma</span></span> shiftD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> shift <span class="free">f</span> <span class="free">delta</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">f</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">delta</span> <span class="main">@+</span> hfst <span class="bound">u</span><span class="main">,</span> hsnd <span class="bound">u</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> shift_def hsplit_def<span class="main">)</span>

<span class="keyword1" id="OrdArith-hmem_shift_iff"><span class="command">lemma</span></span> hmem_shift_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">m</span><span class="main">,</span> <span class="free">y</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> shift <span class="free">f</span> <span class="free">delta</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="free">m</span> <span class="main">=</span> <span class="free">delta</span> <span class="main">@+</span> <span class="bound">n</span> <span class="main">∧</span> <span class="main">⟨</span><span class="bound">n</span><span class="main">,</span> <span class="free">y</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> shift_def hrelation_def is_hpair_def<span class="main">)</span>

<span class="keyword1" id="OrdArith-hmem_shift_add_iff"><span class="command">lemma</span></span> hmem_shift_add_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">delta</span> <span class="main">@+</span> <span class="free">n</span><span class="main">,</span> <span class="free">y</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> shift <span class="free">f</span> <span class="free">delta</span> <span class="main">⟷</span> <span class="main">⟨</span><span class="free">n</span><span class="main">,</span> <span class="free">y</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hadd_cancel_right hmem_shift_iff<span class="main">)</span>

<span class="keyword1" id="OrdArith-hrelation_shift"><span class="command">lemma</span></span> hrelation_shift <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hrelation <span class="main">(</span>shift <span class="free">f</span> <span class="free">delta</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> shift_def hrelation_def hsplit_def<span class="main">)</span>

<span class="keyword1" id="OrdArith-app_shift"><span class="command">lemma</span></span> app_shift <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"app <span class="main">(</span>shift <span class="free">f</span> <span class="free">k</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">@+</span> <span class="free">j</span><span class="main">)</span> <span class="main">=</span> app <span class="free">f</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> app_def<span class="main">)</span>

<span class="keyword1" id="OrdArith-hfunction_shift_iff"><span class="command">lemma</span></span> hfunction_shift_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hfunction <span class="main">(</span>shift <span class="free">f</span> <span class="free">delta</span><span class="main">)</span> <span class="main">=</span> hfunction <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hfunction_def hmem_shift_iff<span class="main">)</span>

<span class="keyword1" id="OrdArith-hdomain_shift_add"><span class="command">lemma</span></span> hdomain_shift_add<span class="main">:</span> <span class="quoted"><span class="quoted">"hdomain <span class="main">(</span>shift <span class="free">f</span> <span class="free">delta</span><span class="main">)</span> <span class="main">=</span> <span class="main">⦃</span><span class="free">delta</span> <span class="main">@+</span> <span class="bound">n</span> <span class="main">.</span> <span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> hdomain <span class="free">f</span><span class="main">⦄</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span>  <span class="main">(</span><span class="operator">rule</span> hf_equalityI<span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hdomain_def hmem_shift_iff<span class="main">)</span>

<span class="keyword1" id="OrdArith-hdomain_shift_disjoint"><span class="command">lemma</span></span> hdomain_shift_disjoint<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">delta</span> <span class="main">⊓</span> hdomain <span class="main">(</span>shift <span class="free">f</span> <span class="free">delta</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hdomain_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> hf_equalityI<span class="main">)</span>
     <span class="main">(</span><span class="operator">metis</span> shiftD hpair_inject not_add_mem_right<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">seq_append</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf <span class="main">⇒</span> hf <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">seq_append</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">≡</span> hrestrict <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">⊔</span> shift <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span>"</span></span>

<span class="keyword1" id="OrdArith-hrelation_seq_append"><span class="command">lemma</span></span> hrelation_seq_append <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"hrelation <span class="main">(</span>seq_append <span class="free">k</span> <span class="free">f</span> <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> seq_append_def<span class="main">)</span>

<span class="keyword1" id="OrdArith-Seq_append"><span class="command">lemma</span></span> Seq_append<span class="main">:</span> <span class="quoted"><span class="quoted">"Seq <span class="free">s1</span> <span class="free">k1</span> <span class="main">⟹</span> Seq <span class="free">s2</span> <span class="free">k2</span> <span class="main">⟹</span> Seq <span class="main">(</span>seq_append <span class="free">k1</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="main">(</span><span class="free">k1</span> <span class="main">@+</span> <span class="free">k2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Seq_def seq_append_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> hdomain_restr hdomain_shift_disjoint hfunction_hunion hfunction_restr hfunction_shift_iff inf_absorb2 seq_append_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hdomain_shift_add<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> hmem_hadd_E rev_hsubsetD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> hmem_hadd_E<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Seq_def Seq_iff_app hdomainI hmem_shift_add_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="OrdArith-app_hunion1"><span class="command">lemma</span></span> app_hunion1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> hdomain <span class="free">g</span> <span class="main">⟹</span> app <span class="main">(</span><span class="free">f</span> <span class="main">⊔</span> <span class="free">g</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> app <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> app_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> hdomainI<span class="main">)</span>

<span class="keyword1" id="OrdArith-app_hunion2"><span class="command">lemma</span></span> app_hunion2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∉</b></span> hdomain <span class="free">f</span> <span class="main">⟹</span> app <span class="main">(</span><span class="free">f</span> <span class="main">⊔</span> <span class="free">g</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> app <span class="free">g</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> app_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> hdomainI<span class="main">)</span>

<span class="keyword1" id="OrdArith-Seq_append_app1"><span class="command">lemma</span></span> Seq_append_app1<span class="main">:</span> <span class="quoted"><span class="quoted">"Seq <span class="free">s</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span> <span class="main">⟹</span> app <span class="main">(</span>seq_append <span class="free">k</span> <span class="free">s</span> <span class="free">s'</span><span class="main">)</span> <span class="free">l</span> <span class="main">=</span> app <span class="free">s</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Seq_def seq_append_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> app_hunion1 hdomain_shift_disjoint hemptyE hinter_iff app_hrestrict<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="OrdArith-Seq_append_app2"><span class="command">lemma</span></span> Seq_append_app2<span class="main">:</span> <span class="quoted"><span class="quoted">"Seq <span class="free">s1</span> <span class="free">k1</span> <span class="main">⟹</span> Seq <span class="free">s2</span> <span class="free">k2</span> <span class="main">⟹</span> <span class="free">l</span> <span class="main">=</span> <span class="free">k1</span> <span class="main">@+</span> <span class="free">j</span> <span class="main">⟹</span> app <span class="main">(</span>seq_append <span class="free">k1</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="free">l</span> <span class="main">=</span> app <span class="free">s2</span> <span class="free">j</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> seq_append_def app_hunion2 app_shift hdomain_restr hinter_iff not_add_mem_right<span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Nonempty sequences indexed by ordinals›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">OrdDom</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">OrdDom</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">⟶</span> Ord <span class="bound">x</span>"</span></span>

<span class="keyword1" id="OrdArith-OrdDom_insf"><span class="command">lemma</span></span> OrdDom_insf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>OrdDom <span class="free">s</span><span class="main">;</span> Ord <span class="free">k</span><span class="main">⟧</span> <span class="main">⟹</span> OrdDom <span class="main">(</span>insf <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> insf_def OrdDom_def<span class="main">)</span>

<span class="keyword1" id="OrdArith-OrdDom_hunion"><span class="command">lemma</span></span> OrdDom_hunion <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"OrdDom <span class="main">(</span><span class="free">s1</span> <span class="main">⊔</span> <span class="free">s2</span><span class="main">)</span> <span class="main">⟷</span> OrdDom <span class="free">s1</span> <span class="main">∧</span> OrdDom <span class="free">s2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> OrdDom_def<span class="main">)</span>

<span class="keyword1" id="OrdArith-OrdDom_hrestrict"><span class="command">lemma</span></span> OrdDom_hrestrict<span class="main">:</span> <span class="quoted"><span class="quoted">"OrdDom <span class="free">s</span> <span class="main">⟹</span> OrdDom <span class="main">(</span>hrestrict <span class="free">s</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> OrdDom_def<span class="main">)</span>

<span class="keyword1" id="OrdArith-OrdDom_shift"><span class="command">lemma</span></span> OrdDom_shift<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>OrdDom <span class="free">s</span><span class="main">;</span> Ord <span class="free">k</span><span class="main">⟧</span> <span class="main">⟹</span> OrdDom <span class="main">(</span>shift <span class="free">s</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> OrdDom_def shift_def Ord_hadd<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A sequence of positive length ending with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">y</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">LstSeq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf <span class="main">⇒</span> hf <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">LstSeq</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> Seq <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>succ <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">∧</span> Ord <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">∧</span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> OrdDom <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>

<span class="keyword1" id="OrdArith-LstSeq_imp_Seq_succ"><span class="command">lemma</span></span> LstSeq_imp_Seq_succ<span class="main">:</span> <span class="quoted"><span class="quoted">"LstSeq <span class="free">s</span> <span class="free">k</span> <span class="free">y</span> <span class="main">⟹</span> Seq <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LstSeq_def<span class="main">)</span>

<span class="keyword1" id="OrdArith-LstSeq_imp_Seq_same"><span class="command">lemma</span></span> LstSeq_imp_Seq_same<span class="main">:</span> <span class="quoted"><span class="quoted">"LstSeq <span class="free">s</span> <span class="free">k</span> <span class="free">y</span> <span class="main">⟹</span> Seq <span class="free">s</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LstSeq_imp_Seq_succ Seq_succ_D<span class="main">)</span>

<span class="keyword1" id="OrdArith-LstSeq_imp_Ord"><span class="command">lemma</span></span> LstSeq_imp_Ord<span class="main">:</span> <span class="quoted"><span class="quoted">"LstSeq <span class="free">s</span> <span class="free">k</span> <span class="free">y</span> <span class="main">⟹</span> Ord <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LstSeq_def<span class="main">)</span>

<span class="keyword1" id="OrdArith-LstSeq_trunc"><span class="command">lemma</span></span> LstSeq_trunc<span class="main">:</span> <span class="quoted"><span class="quoted">"LstSeq <span class="free">s</span> <span class="free">k</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span> <span class="main">⟹</span> LstSeq <span class="free">s</span> <span class="free">l</span> <span class="main">(</span>app <span class="free">s</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> LstSeq_def Seq_iff_app<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Ord_succ Seq_Ord_D mem_succ_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Ord_in_Ord<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="OrdArith-LstSeq_insf"><span class="command">lemma</span></span> LstSeq_insf<span class="main">:</span> <span class="quoted"><span class="quoted">"LstSeq <span class="free">s</span> <span class="free">k</span> <span class="free">z</span> <span class="main">⟹</span> LstSeq <span class="main">(</span>insf <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> OrdDom_insf LstSeq_def Ord_succ_iff Seq_imp_eq_app Seq_insf Seq_succ_iff app_insf_Seq<span class="main">)</span>

<span class="keyword1" id="OrdArith-app_insf_LstSeq"><span class="command">lemma</span></span> app_insf_LstSeq<span class="main">:</span> <span class="quoted"><span class="quoted">"LstSeq <span class="free">s</span> <span class="free">k</span> <span class="free">z</span> <span class="main">⟹</span> app <span class="main">(</span>insf <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LstSeq_imp_Seq_succ app_insf_Seq<span class="main">)</span>

<span class="keyword1" id="OrdArith-app_insf2_LstSeq"><span class="command">lemma</span></span> app_insf2_LstSeq<span class="main">:</span> <span class="quoted"><span class="quoted">"LstSeq <span class="free">s</span> <span class="free">k</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">k'</span> <span class="main">≠</span> succ <span class="free">k</span> <span class="main">⟹</span> app <span class="main">(</span>insf <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="free">k'</span> <span class="main">=</span> app <span class="free">s</span> <span class="free">k'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LstSeq_imp_Seq_succ app_insf2_Seq<span class="main">)</span>

<span class="keyword1" id="OrdArith-app_insf_LstSeq_if"><span class="command">lemma</span></span> app_insf_LstSeq_if<span class="main">:</span> <span class="quoted"><span class="quoted">"LstSeq <span class="free">s</span> <span class="free">k</span> <span class="free">z</span> <span class="main">⟹</span> app <span class="main">(</span>insf <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="free">k'</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">k'</span> <span class="main">=</span> succ <span class="free">k</span> <span class="keyword1">then</span> <span class="free">y</span> <span class="keyword1">else</span> app <span class="free">s</span> <span class="free">k'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> app_insf2_LstSeq app_insf_LstSeq<span class="main">)</span>

<span class="keyword1" id="OrdArith-LstSeq_append_app1"><span class="command">lemma</span></span> LstSeq_append_app1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"LstSeq <span class="free">s</span> <span class="free">k</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">k</span> <span class="main">⟹</span> app <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">s</span> <span class="free">s'</span><span class="main">)</span> <span class="free">l</span> <span class="main">=</span> app <span class="free">s</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LstSeq_imp_Seq_succ Seq_append_app1<span class="main">)</span>

<span class="keyword1" id="OrdArith-LstSeq_append_app2"><span class="command">lemma</span></span> LstSeq_append_app2<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>LstSeq <span class="free">s1</span> <span class="free">k1</span> <span class="free">y1</span><span class="main">;</span> LstSeq <span class="free">s2</span> <span class="free">k2</span> <span class="free">y2</span><span class="main">;</span> <span class="free">l</span> <span class="main">=</span> succ <span class="free">k1</span> <span class="main">@+</span> <span class="free">j</span><span class="main">⟧</span>
   <span class="main">⟹</span> app <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k1</span><span class="main">)</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="free">l</span> <span class="main">=</span> app <span class="free">s2</span> <span class="free">j</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LstSeq_imp_Seq_succ Seq_append_app2<span class="main">)</span>

<span class="keyword1" id="OrdArith-Seq_append_pair"><span class="command">lemma</span></span> Seq_append_pair<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Seq <span class="free">s1</span> <span class="free">k1</span><span class="main">;</span> Seq <span class="free">s2</span> <span class="main">(</span>succ <span class="free">n</span><span class="main">)</span><span class="main">;</span>  <span class="main">⟨</span><span class="free">n</span><span class="main">,</span> <span class="free">y</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">s2</span><span class="main">;</span> Ord <span class="free">n</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⟨</span><span class="free">k1</span> <span class="main">@+</span> <span class="free">n</span><span class="main">,</span> <span class="free">y</span><span class="main">⟩</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="main">(</span>seq_append <span class="free">k1</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hmem_shift_add_iff hunion_iff seq_append_def<span class="main">)</span>

<span class="keyword1" id="OrdArith-Seq_append_OrdDom"><span class="command">lemma</span></span> Seq_append_OrdDom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>Ord <span class="free">k</span><span class="main">;</span> OrdDom <span class="free">s1</span><span class="main">;</span> OrdDom <span class="free">s2</span><span class="main">⟧</span> <span class="main">⟹</span> OrdDom <span class="main">(</span>seq_append <span class="free">k</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> seq_append_def OrdDom_hrestrict OrdDom_shift<span class="main">)</span>

<span class="keyword1" id="OrdArith-LstSeq_append"><span class="command">lemma</span></span> LstSeq_append<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>LstSeq <span class="free">s1</span> <span class="free">k1</span> <span class="free">y1</span><span class="main">;</span> LstSeq <span class="free">s2</span> <span class="free">k2</span> <span class="free">y2</span><span class="main">⟧</span> <span class="main">⟹</span> LstSeq <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k1</span><span class="main">)</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="main">(</span>succ <span class="main">(</span><span class="free">k1</span> <span class="main">@+</span> <span class="free">k2</span><span class="main">)</span><span class="main">)</span> <span class="free">y2</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> LstSeq_def Seq_append Ord_hadd Seq_append_pair<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Seq_append hadd_succ_left hadd_succ_right<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Seq_append_pair hadd_succ_left<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Ord_succ Seq_append_OrdDom<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="OrdArith-LstSeq_app"><span class="command">lemma</span></span> LstSeq_app <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"LstSeq <span class="free">s</span> <span class="free">k</span> <span class="free">y</span> <span class="main">⟹</span> app <span class="free">s</span> <span class="free">k</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LstSeq_def Seq_imp_eq_app<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Sequence-building operators›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Builds</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hf <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>hf <span class="main">⇒</span> hf <span class="main">⇒</span> hf <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> hf <span class="main">⇒</span> hf <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Builds</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">(</span>app <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">(</span>app <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span><span class="main">)</span> <span class="main">(</span>app <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span>app <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">BuildSeq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hf <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>hf <span class="main">⇒</span> hf <span class="main">⇒</span> hf <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> hf <span class="main">⇒</span> hf <span class="main">⇒</span> hf <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">BuildSeq</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≡</span> LstSeq <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">.</span> Builds <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">l</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="OrdArith-BuildSeqI"><span class="command">lemma</span></span> BuildSeqI<span class="main">:</span> <span class="quoted"><span class="quoted">"LstSeq <span class="free">s</span> <span class="free">k</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">l</span><span class="main">.</span> <span class="bound">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">k</span> <span class="main">⟹</span> Builds <span class="free">B</span> <span class="free">C</span> <span class="free">s</span> <span class="bound">l</span><span class="main">)</span> <span class="main">⟹</span> BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="free">s</span> <span class="free">k</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BuildSeq_def<span class="main">)</span>

<span class="keyword1" id="OrdArith-BuildSeq_imp_LstSeq"><span class="command">lemma</span></span> BuildSeq_imp_LstSeq<span class="main">:</span> <span class="quoted"><span class="quoted">"BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="free">s</span> <span class="free">k</span> <span class="free">y</span> <span class="main">⟹</span> LstSeq <span class="free">s</span> <span class="free">k</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BuildSeq_def<span class="main">)</span>

<span class="keyword1" id="OrdArith-BuildSeq_imp_Seq"><span class="command">lemma</span></span> BuildSeq_imp_Seq<span class="main">:</span> <span class="quoted"><span class="quoted">"BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="free">s</span> <span class="free">k</span> <span class="free">y</span> <span class="main">⟹</span> Seq <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LstSeq_imp_Seq_succ BuildSeq_imp_LstSeq<span class="main">)</span>

<span class="keyword1" id="OrdArith-BuildSeq_conj_distrib"><span class="command">lemma</span></span> BuildSeq_conj_distrib<span class="main">:</span>
 <span class="quoted"><span class="quoted">"BuildSeq <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="free">C</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="free">s</span> <span class="free">k</span> <span class="free">y</span> <span class="main">⟷</span>
  BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="free">s</span> <span class="free">k</span> <span class="free">y</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">k</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>app <span class="free">s</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> BuildSeq_def Builds_def<span class="main">)</span>

<span class="keyword1" id="OrdArith-BuildSeq_mono"><span class="command">lemma</span></span> BuildSeq_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="free">s</span> <span class="free">k</span> <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">B'</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="free">C</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="free">C'</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"BuildSeq <span class="free">B'</span> <span class="free">C'</span> <span class="free">s</span> <span class="free">k</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> y
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> BuildSeq_def Builds_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> B C<span class="main">)</span>

<span class="keyword1" id="OrdArith-BuildSeq_trunc"><span class="command">lemma</span></span> BuildSeq_trunc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="free">s</span> <span class="free">k</span> <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="free">s</span> <span class="free">l</span> <span class="main">(</span>app <span class="free">s</span> <span class="free">l</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> j<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BuildSeq_imp_LstSeq LstSeq_def b<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Builds <span class="free">B</span> <span class="free">C</span> <span class="free">s</span> <span class="skolem">j</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BuildSeq_def OrdmemD b hballE hsubsetD j l succ_iff<span class="main">)</span>
 <span class="keyword1"><span class="command">}</span></span>
 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> b l
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> BuildSeq_def LstSeq_trunc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Showing that Sequences can be Constructed›</span></span>

<span class="keyword1" id="OrdArith-Builds_insf"><span class="command">lemma</span></span> Builds_insf<span class="main">:</span> <span class="quoted"><span class="quoted">"Builds <span class="free">B</span> <span class="free">C</span> <span class="free">s</span> <span class="free">l</span> <span class="main">⟹</span> LstSeq <span class="free">s</span> <span class="free">k</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">k</span> <span class="main">⟹</span> Builds <span class="free">B</span> <span class="free">C</span> <span class="main">(</span>insf <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> HBall_def hmem_not_refl Builds_def app_insf_LstSeq_if <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> succ_iff<span class="main">)</span>
   <span class="main">(</span><span class="operator">metis</span> hmem_not_sym<span class="main">)</span>

<span class="keyword1" id="OrdArith-BuildSeq_insf"><span class="command">lemma</span></span> BuildSeq_insf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="free">s</span> <span class="free">k</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">k</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">k</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">y</span> <span class="main">∨</span> <span class="free">C</span> <span class="free">y</span> <span class="main">(</span>app <span class="free">s</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span>app <span class="free">s</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="main">(</span>insf <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> BuildSeqI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"LstSeq <span class="main">(</span>insf <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BuildSeq_imp_LstSeq LstSeq_insf b<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
  <span class="keyword3"><span class="command">assume</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Builds <span class="free">B</span> <span class="free">C</span> <span class="main">(</span>insf <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="skolem">l</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> succ <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">(</span>app <span class="main">(</span>insf <span class="free">s</span> <span class="skolem">l</span> <span class="free">y</span><span class="main">)</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">∨</span> <span class="free">C</span> <span class="main">(</span>app <span class="main">(</span>insf <span class="free">s</span> <span class="skolem">l</span> <span class="free">y</span><span class="main">)</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">(</span>app <span class="main">(</span>insf <span class="free">s</span> <span class="skolem">l</span> <span class="free">y</span><span class="main">)</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span>app <span class="main">(</span>insf <span class="free">s</span> <span class="skolem">l</span> <span class="free">y</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BuildSeq_imp_Seq app_insf_Seq_if b hmem_not_refl l m n y<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Builds <span class="free">B</span> <span class="free">C</span> <span class="main">(</span>insf <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m n
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Builds_def l<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"LstSeq <span class="free">s</span> <span class="free">k</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BuildSeq_imp_LstSeq b<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Builds <span class="free">B</span> <span class="free">C</span> <span class="main">(</span>insf <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b l
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hballE Builds_insf BuildSeq_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OrdArith-BuildSeq_insf1"><span class="command">lemma</span></span> BuildSeq_insf1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="free">s</span> <span class="free">k</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="main">(</span>insf <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BuildSeq_insf b succ_iff y<span class="main">)</span>

<span class="keyword1" id="OrdArith-BuildSeq_insf2"><span class="command">lemma</span></span> BuildSeq_insf2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="free">s</span> <span class="free">k</span> <span class="free">z</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="free">y</span> <span class="main">(</span>app <span class="free">s</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span>app <span class="free">s</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="main">(</span>insf <span class="free">s</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>succ <span class="free">k</span><span class="main">)</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BuildSeq_insf b m n succ_iff y<span class="main">)</span>

<span class="keyword1" id="OrdArith-BuildSeq_append"><span class="command">lemma</span></span> BuildSeq_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="free">s1</span> <span class="free">k1</span> <span class="free">y1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s2<span class="main">:</span> <span class="quoted"><span class="quoted">"BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="free">s2</span> <span class="free">k2</span> <span class="free">y2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k1</span><span class="main">)</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="main">(</span>succ <span class="main">(</span><span class="free">k1</span> <span class="main">@+</span> <span class="free">k2</span><span class="main">)</span><span class="main">)</span> <span class="free">y2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> BuildSeqI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"LstSeq <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k1</span><span class="main">)</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="main">(</span>succ <span class="main">(</span><span class="free">k1</span> <span class="main">@+</span> <span class="free">k2</span><span class="main">)</span><span class="main">)</span> <span class="free">y2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BuildSeq_imp_LstSeq LstSeq_append<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
  <span class="keyword1"><span class="command">have</span></span> s1L<span class="main">:</span> <span class="quoted"><span class="quoted">"LstSeq <span class="free">s1</span> <span class="free">k1</span> <span class="free">y1</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> s1BC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span><span class="main">.</span> <span class="bound">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">k1</span> <span class="main">⟹</span> Builds <span class="free">B</span> <span class="free">C</span> <span class="free">s1</span> <span class="bound">l</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> s2L<span class="main">:</span> <span class="quoted"><span class="quoted">"LstSeq <span class="free">s2</span> <span class="free">k2</span> <span class="free">y2</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> s2BC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span><span class="main">.</span> <span class="bound">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">k2</span> <span class="main">⟹</span> Builds <span class="free">B</span> <span class="free">C</span> <span class="free">s2</span> <span class="bound">l</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> s1 s2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> BuildSeq_def<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="main">(</span>succ <span class="main">(</span><span class="free">k1</span> <span class="main">@+</span> <span class="free">k2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">k1</span> <span class="main">@+</span> succ <span class="free">k2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LstSeq_imp_Ord hadd_succ_left hadd_succ_right s2L<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Builds <span class="free">B</span> <span class="free">C</span> <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k1</span><span class="main">)</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="skolem">l</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> hmem_hadd_E<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> l1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">k1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">(</span>app <span class="free">s1</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">m</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="skolem">l</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="skolem">l</span><span class="main">.</span> <span class="free">C</span> <span class="main">(</span>app <span class="free">s1</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">(</span>app <span class="free">s1</span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span>app <span class="free">s1</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s1BC
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Builds_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">(</span>app <span class="free">s1</span> <span class="skolem">l</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Builds_def LstSeq_append_app1 l1 s1L<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="skolem">l</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="skolem">l</span><span class="main">.</span> <span class="free">C</span> <span class="main">(</span>app <span class="free">s1</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">(</span>app <span class="free">s1</span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span>app <span class="free">s1</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> mn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="skolem">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">(</span>app <span class="free">s1</span> <span class="skolem">l</span><span class="main">)</span> <span class="main">(</span>app <span class="free">s1</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>app <span class="free">s1</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">k1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">k1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LstSeq_def Ord_trans l1 mn s1L succ_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">(</span>app <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k1</span><span class="main">)</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="skolem">l</span><span class="main">)</span>
                         <span class="main">(</span>app <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k1</span><span class="main">)</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="skolem">m</span><span class="main">)</span>
                         <span class="main">(</span>app <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k1</span><span class="main">)</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> s1L l1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LstSeq_append_app1<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Builds <span class="free">B</span> <span class="free">C</span> <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k1</span><span class="main">)</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mn
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Builds_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">assume</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">k2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> l2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> succ <span class="free">k1</span> <span class="main">@+</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">(</span>app <span class="free">s2</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">m</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="skolem">z</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="skolem">z</span><span class="main">.</span> <span class="free">C</span> <span class="main">(</span>app <span class="free">s2</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span>app <span class="free">s2</span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span>app <span class="free">s2</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s2BC
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Builds_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">(</span>app <span class="free">s2</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Builds_def LstSeq_append_app2 l2 s1L s2L<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="skolem">z</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main"><span class="hidden">❙</span><b>∈</b></span><span class="skolem">z</span><span class="main">.</span> <span class="free">C</span> <span class="main">(</span>app <span class="free">s2</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span>app <span class="free">s2</span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span>app <span class="free">s2</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> mn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">(</span>app <span class="free">s2</span> <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span>app <span class="free">s2</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>app <span class="free">s2</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">k2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="free">k2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mn
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> LstSeq_def Ord_trans z s2L succ_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">(</span>app <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k1</span><span class="main">)</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="skolem">l</span><span class="main">)</span>
                         <span class="main">(</span>app <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k1</span><span class="main">)</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="main">(</span>succ <span class="free">k1</span> <span class="main">@+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">(</span>app <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k1</span><span class="main">)</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="main">(</span>succ <span class="free">k1</span> <span class="main">@+</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> s1L s2L l2 z
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LstSeq_append_app2<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Builds <span class="free">B</span> <span class="free">C</span> <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k1</span><span class="main">)</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mn l2
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Builds_def HBall_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OrdArith-BuildSeq_combine"><span class="command">lemma</span></span> BuildSeq_combine<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="free">s1</span> <span class="free">k1</span> <span class="free">y1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="free">s2</span> <span class="free">k2</span> <span class="free">y2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="free">y</span> <span class="free">y1</span> <span class="free">y2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="main">(</span>insf <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k1</span><span class="main">)</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="main">(</span>succ <span class="main">(</span>succ <span class="main">(</span><span class="free">k1</span> <span class="main">@+</span> <span class="free">k2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">y</span><span class="main">)</span> <span class="main">(</span>succ <span class="main">(</span>succ <span class="main">(</span><span class="free">k1</span> <span class="main">@+</span> <span class="free">k2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> k2<span class="main">:</span> <span class="quoted"><span class="quoted">"Ord <span class="free">k2</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> b2
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> BuildSeq_def LstSeq_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> BuildSeq_insf <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> m<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">k1</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> n<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"succ<span class="main"><span class="main">(</span></span><span class="free"><span class="free">k1</span></span><span class="main"><span class="main">@+</span></span><span class="free"><span class="free">k2</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k1</span><span class="main">)</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="main">(</span>succ <span class="main">(</span><span class="free">k1</span> <span class="main">@+</span> <span class="free">k2</span><span class="main">)</span><span class="main">)</span> <span class="free">y2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> BuildSeq_append <span class="main"><span class="main">[</span></span><span class="operator">OF</span> b1 b2<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">k1</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="main">(</span>succ <span class="main">(</span><span class="free">k1</span> <span class="main">@+</span> <span class="free">k2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hadd_0_right hmem_0_Ord hmem_self_hadd succ_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"succ <span class="main">(</span><span class="free">k1</span> <span class="main">@+</span> <span class="free">k2</span><span class="main">)</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> succ <span class="main">(</span>succ <span class="main">(</span><span class="free">k1</span> <span class="main">@+</span> <span class="free">k2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> succ_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"app <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k1</span><span class="main">)</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="free">k1</span> <span class="main">=</span> <span class="free">y1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> b1 BuildSeq_imp_LstSeq LstSeq_app LstSeq_append_app1 succ_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"app <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k1</span><span class="main">)</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="main">(</span>succ <span class="main">(</span><span class="free">k1</span> <span class="main">@+</span> <span class="free">k2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">y2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> b1 b2 k2 BuildSeq_imp_LstSeq LstSeq_app LstSeq_append_app2 hadd_succ_left<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">y</span> <span class="main">∨</span>
          <span class="free">C</span> <span class="free">y</span> <span class="main">(</span>app <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k1</span><span class="main">)</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="free">k1</span><span class="main">)</span>
              <span class="main">(</span>app <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k1</span><span class="main">)</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="main">(</span>succ <span class="main">(</span><span class="free">k1</span> <span class="main">@+</span> <span class="free">k2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OrdArith-LstSeq_1"><span class="command">lemma</span></span> LstSeq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"LstSeq <span class="main">⦃</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span> <span class="free">y</span><span class="main">⟩</span><span class="main">⦄</span> <span class="main">0</span> <span class="free">y</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> LstSeq_def One_hf_eq_succ Seq_ins OrdDom_def<span class="main">)</span>

<span class="keyword1" id="OrdArith-BuildSeq_1"><span class="command">lemma</span></span> BuildSeq_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">y</span> <span class="main">⟹</span> BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="main">⦃</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span> <span class="free">y</span><span class="main">⟩</span><span class="main">⦄</span> <span class="main">0</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> BuildSeq_def Builds_def LstSeq_1<span class="main">)</span>

<span class="keyword1" id="OrdArith-BuildSeq_exI"><span class="command">lemma</span></span> BuildSeq_exI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">t</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">s</span> <span class="bound">k</span><span class="main">.</span> BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="bound">s</span> <span class="bound">k</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BuildSeq_1<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Proving Properties of Given Sequences›</span></span>

<span class="keyword1" id="OrdArith-BuildSeq_succ_E"><span class="command">lemma</span></span> BuildSeq_succ_E<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="free">s</span> <span class="free">k</span> <span class="free">y</span>"</span></span>
      <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">y</span>"</span></span> <span class="main">|</span>  <span class="free">m</span> <span class="free">n</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="free">y</span> <span class="main">(</span>app <span class="free">s</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span>app <span class="free">s</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> Bs<span class="main">:</span> <span class="quoted"><span class="quoted">"Builds <span class="free">B</span> <span class="free">C</span> <span class="free">s</span> <span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> apps<span class="main">:</span> <span class="quoted"><span class="quoted">"app <span class="free">s</span> <span class="free">k</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> s
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> BuildSeq_def<span class="main">)</span>
 <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">y</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">m</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">k</span><span class="main">.</span> <span class="free">C</span> <span class="free">y</span> <span class="main">(</span>app <span class="free">s</span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span>app <span class="free">s</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Builds_def apps Bs<span class="main">)</span>
 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that
   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OrdArith-BuildSeq_induct"><span class="command">lemma</span></span> BuildSeq_induct <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> B C<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> major<span class="main">:</span> <span class="quoted"><span class="quoted">"BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="free">s</span> <span class="free">k</span> <span class="free">a</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="free">C</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">z</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Ord <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> BuildSeq_def LstSeq_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">s</span><span class="main">.</span> BuildSeq <span class="free">B</span> <span class="free">C</span> <span class="bound">s</span> <span class="free">k</span> <span class="bound">a</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">k</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ord_induct<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> BuildSeq_trunc BuildSeq_succ_E B C<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> major<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">BuildSeq2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">[</span>hf<span class="main">,</span>hf<span class="main">]</span> <span class="main">⇒</span> bool<span class="main">,</span> <span class="main">[</span>hf<span class="main">,</span>hf<span class="main">,</span>hf<span class="main">,</span>hf<span class="main">,</span>hf<span class="main">,</span>hf<span class="main">]</span> <span class="main">⇒</span> bool<span class="main">,</span> hf<span class="main">,</span> hf<span class="main">,</span> hf<span class="main">,</span> hf<span class="main">]</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">BuildSeq2</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">y'</span></span></span> <span class="main">≡</span>
         BuildSeq <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span> <span class="bound">x'</span><span class="main">.</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="bound">x'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="bound">x</span> <span class="bound">x'</span><span class="main">)</span>
                  <span class="main">(</span><span class="main">λ</span><span class="bound">p</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span> <span class="bound">x'</span> <span class="bound">y</span> <span class="bound">y'</span> <span class="bound">z</span> <span class="bound">z'</span><span class="main">.</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="bound">x'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">y</span><span class="main">,</span><span class="bound">y'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">z</span><span class="main">,</span><span class="bound">z'</span><span class="main">⟩</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">x</span> <span class="bound">x'</span> <span class="bound">y</span> <span class="bound">y'</span> <span class="bound">z</span> <span class="bound">z'</span><span class="main">)</span>
                  <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y'</span></span></span><span class="main">⟩</span>"</span></span>

<span class="keyword1" id="OrdArith-BuildSeq2_combine"><span class="command">lemma</span></span> BuildSeq2_combine<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"BuildSeq2 <span class="free">B</span> <span class="free">C</span> <span class="free">s1</span> <span class="free">k1</span> <span class="free">y1</span> <span class="free">y1'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"BuildSeq2 <span class="free">B</span> <span class="free">C</span> <span class="free">s2</span> <span class="free">k2</span> <span class="free">y2</span> <span class="free">y2'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="free">y</span> <span class="free">y'</span> <span class="free">y1</span> <span class="free">y1'</span> <span class="free">y2</span> <span class="free">y2'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"BuildSeq2 <span class="free">B</span> <span class="free">C</span> <span class="main">(</span>insf <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k1</span><span class="main">)</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="main">(</span>succ <span class="main">(</span>succ <span class="main">(</span><span class="free">k1</span> <span class="main">@+</span> <span class="free">k2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟨</span><span class="free">y</span><span class="main">,</span> <span class="free">y'</span><span class="main">⟩</span><span class="main">)</span>
                       <span class="main">(</span>succ <span class="main">(</span>succ <span class="main">(</span><span class="free">k1</span> <span class="main">@+</span> <span class="free">k2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">y</span> <span class="free">y'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> BuildSeq2_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> BuildSeq_combine<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="OrdArith-BuildSeq2_1"><span class="command">lemma</span></span> BuildSeq2_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">y</span> <span class="free">y'</span> <span class="main">⟹</span> BuildSeq2 <span class="free">B</span> <span class="free">C</span> <span class="main">⦃</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">y'</span><span class="main">⟩</span><span class="main">⦄</span> <span class="main">0</span> <span class="free">y</span> <span class="free">y'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> BuildSeq2_def BuildSeq_1<span class="main">)</span>

<span class="keyword1" id="OrdArith-BuildSeq2_exI"><span class="command">lemma</span></span> BuildSeq2_exI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">t</span> <span class="free">t'</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">s</span> <span class="bound">k</span><span class="main">.</span> BuildSeq2 <span class="free">B</span> <span class="free">C</span> <span class="bound">s</span> <span class="bound">k</span> <span class="free">t</span> <span class="free">t'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BuildSeq2_1<span class="main">)</span>

<span class="keyword1" id="OrdArith-BuildSeq2_induct"><span class="command">lemma</span></span> BuildSeq2_induct <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> B C<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"BuildSeq2 <span class="free">B</span> <span class="free">C</span> <span class="free">s</span> <span class="free">k</span> <span class="free">a</span> <span class="free">a'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">x'</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span> <span class="bound">x'</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">x'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">x'</span> <span class="bound">y</span> <span class="bound">y'</span> <span class="bound">z</span> <span class="bound">z'</span><span class="main">.</span> <span class="free">C</span> <span class="bound">x</span> <span class="bound">x'</span> <span class="bound">y</span> <span class="bound">y'</span> <span class="bound">z</span> <span class="bound">z'</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span> <span class="bound">y'</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">z</span> <span class="bound">z'</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">x'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">a</span> <span class="free">a'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BuildSeq2_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> BuildSeq_induct <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="main"><span class="main">⟨</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span><span class="bound"><span class="bound">x'</span></span><span class="main"><span class="main">⟩</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">P</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">x'</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> B C<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">BuildSeq3</span>
   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">[</span>hf<span class="main">,</span>hf<span class="main">,</span>hf<span class="main">]</span> <span class="main">⇒</span> bool<span class="main">,</span> <span class="main">[</span>hf<span class="main">,</span>hf<span class="main">,</span>hf<span class="main">,</span>hf<span class="main">,</span>hf<span class="main">,</span>hf<span class="main">,</span>hf<span class="main">,</span>hf<span class="main">,</span>hf<span class="main">]</span> <span class="main">⇒</span> bool<span class="main">,</span> hf<span class="main">,</span> hf<span class="main">,</span> hf<span class="main">,</span> hf<span class="main">,</span> hf<span class="main">]</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">BuildSeq3</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">y'</span></span></span> <span class="free"><span class="bound"><span class="entity">y''</span></span></span> <span class="main">≡</span>
         BuildSeq <span class="main">(</span><span class="main">λ</span><span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span> <span class="bound">x'</span> <span class="bound">x''</span><span class="main">.</span> <span class="bound">p</span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="bound">x'</span><span class="main">,</span><span class="bound">x''</span><span class="main">⟩</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="bound">x</span> <span class="bound">x'</span> <span class="bound">x''</span><span class="main">)</span>
                  <span class="main">(</span><span class="main">λ</span><span class="bound">p</span> <span class="bound">q</span> <span class="bound">r</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span> <span class="bound">x'</span> <span class="bound">x''</span> <span class="bound">y</span> <span class="bound">y'</span> <span class="bound">y''</span> <span class="bound">z</span> <span class="bound">z'</span> <span class="bound">z''</span><span class="main">.</span>
                           <span class="bound">p</span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="bound">x'</span><span class="main">,</span><span class="bound">x''</span><span class="main">⟩</span> <span class="main">∧</span> <span class="bound">q</span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">y</span><span class="main">,</span><span class="bound">y'</span><span class="main">,</span><span class="bound">y''</span><span class="main">⟩</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">=</span> <span class="main">⟨</span><span class="bound">z</span><span class="main">,</span><span class="bound">z'</span><span class="main">,</span><span class="bound">z''</span><span class="main">⟩</span> <span class="main">∧</span>
                           <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">x</span> <span class="bound">x'</span> <span class="bound">x''</span> <span class="bound">y</span> <span class="bound">y'</span> <span class="bound">y''</span> <span class="bound">z</span> <span class="bound">z'</span> <span class="bound">z''</span><span class="main">)</span>
                  <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">y''</span></span></span><span class="main">⟩</span>"</span></span>

<span class="keyword1" id="OrdArith-BuildSeq3_combine"><span class="command">lemma</span></span> BuildSeq3_combine<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b1<span class="main">:</span> <span class="quoted"><span class="quoted">"BuildSeq3 <span class="free">B</span> <span class="free">C</span> <span class="free">s1</span> <span class="free">k1</span> <span class="free">y1</span> <span class="free">y1'</span> <span class="free">y1''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b2<span class="main">:</span> <span class="quoted"><span class="quoted">"BuildSeq3 <span class="free">B</span> <span class="free">C</span> <span class="free">s2</span> <span class="free">k2</span> <span class="free">y2</span> <span class="free">y2'</span> <span class="free">y2''</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="free">y</span> <span class="free">y'</span> <span class="free">y''</span> <span class="free">y1</span> <span class="free">y1'</span> <span class="free">y1''</span> <span class="free">y2</span> <span class="free">y2'</span> <span class="free">y2''</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"BuildSeq3 <span class="free">B</span> <span class="free">C</span> <span class="main">(</span>insf <span class="main">(</span>seq_append <span class="main">(</span>succ <span class="free">k1</span><span class="main">)</span> <span class="free">s1</span> <span class="free">s2</span><span class="main">)</span> <span class="main">(</span>succ <span class="main">(</span>succ <span class="main">(</span><span class="free">k1</span> <span class="main">@+</span> <span class="free">k2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟨</span><span class="free">y</span><span class="main">,</span> <span class="free">y'</span><span class="main">,</span> <span class="free">y''</span><span class="main">⟩</span><span class="main">)</span>
                       <span class="main">(</span>succ <span class="main">(</span>succ <span class="main">(</span><span class="free">k1</span> <span class="main">@+</span> <span class="free">k2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">y</span> <span class="free">y'</span> <span class="free">y''</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> BuildSeq3_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> BuildSeq_combine<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="OrdArith-BuildSeq3_1"><span class="command">lemma</span></span> BuildSeq3_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">y</span> <span class="free">y'</span> <span class="free">y''</span> <span class="main">⟹</span> BuildSeq3 <span class="free">B</span> <span class="free">C</span> <span class="main">⦃</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">y'</span><span class="main">,</span> <span class="free">y''</span><span class="main">⟩</span><span class="main">⦄</span> <span class="main">0</span> <span class="free">y</span> <span class="free">y'</span> <span class="free">y''</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> BuildSeq3_def BuildSeq_1<span class="main">)</span>

<span class="keyword1" id="OrdArith-BuildSeq3_exI"><span class="command">lemma</span></span> BuildSeq3_exI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="free">t</span> <span class="free">t'</span> <span class="free">t''</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">s</span> <span class="bound">k</span><span class="main">.</span> BuildSeq3 <span class="free">B</span> <span class="free">C</span> <span class="bound">s</span> <span class="bound">k</span> <span class="free">t</span> <span class="free">t'</span> <span class="free">t''</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> BuildSeq3_1<span class="main">)</span>

<span class="keyword1" id="OrdArith-BuildSeq3_induct"><span class="command">lemma</span></span> BuildSeq3_induct <span class="main">[</span><span class="operator">consumes</span> 1<span class="main">,</span> <span class="operator">case_names</span> B C<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"BuildSeq3 <span class="free">B</span> <span class="free">C</span> <span class="free">s</span> <span class="free">k</span> <span class="free">a</span> <span class="free">a'</span> <span class="free">a''</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">x'</span> <span class="bound">x''</span><span class="main">.</span> <span class="free">B</span> <span class="bound">x</span> <span class="bound">x'</span> <span class="bound">x''</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">x'</span> <span class="bound">x''</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">x'</span> <span class="bound">x''</span> <span class="bound">y</span> <span class="bound">y'</span> <span class="bound">y''</span> <span class="bound">z</span> <span class="bound">z'</span> <span class="bound">z''</span><span class="main">.</span> <span class="free">C</span> <span class="bound">x</span> <span class="bound">x'</span> <span class="bound">x''</span> <span class="bound">y</span> <span class="bound">y'</span> <span class="bound">y''</span> <span class="bound">z</span> <span class="bound">z'</span> <span class="bound">z''</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">y</span> <span class="bound">y'</span> <span class="bound">y''</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">z</span> <span class="bound">z'</span> <span class="bound">z''</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="bound">x'</span> <span class="bound">x''</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">a</span> <span class="free">a'</span> <span class="free">a''</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BuildSeq3_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> BuildSeq_induct <span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="main"><span class="main">⟨</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">,</span></span><span class="bound"><span class="bound">x'</span></span><span class="main"><span class="main">,</span></span><span class="bound"><span class="bound">x''</span></span><span class="main"><span class="main">⟩</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">P</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">x'</span></span> <span class="bound"><span class="bound">x''</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> B C<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹A Unique Predecessor for every non-empty set›</span></span>

<span class="keyword1" id="OrdArith-Rep_hf_0"><span class="command">lemma</span></span> Rep_hf_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_hf <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Abs_hf_inverse HF.HF_def UNIV_I Zero_hf_def image_empty set_encode_empty<span class="main">)</span>

<span class="keyword1" id="OrdArith-hmem_imp_less"><span class="command">lemma</span></span> hmem_imp_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">y</span> <span class="main">⟹</span> Rep_hf <span class="free">x</span> <span class="main">&lt;</span> Rep_hf <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hmem_def hfset_def set_decode_def Abs_hf_inverse<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> div_less even_zero le_less_trans less_two_power not_less<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="OrdArith-hsubset_imp_le"><span class="command">lemma</span></span> hsubset_imp_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> Rep_hf <span class="free">x</span> <span class="main">≤</span> Rep_hf <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_eq_hf_def hmem_def hfset_def Abs_hf_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Abs_hf_cases<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Abs_hf_cases<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subset_decode_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Abs_hf_inverse <span class="main"><span class="main">[</span></span><span class="operator">OF</span> UNIV_I<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Abs_hf_inverse UNIV_I imageE imageI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="OrdArith-diff_hmem_imp_less"><span class="command">lemma</span></span> diff_hmem_imp_less<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Rep_hf <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="main">⦃</span><span class="free">x</span><span class="main">⦄</span><span class="main">)</span> <span class="main">&lt;</span> Rep_hf <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"Rep_hf <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="main">⦃</span><span class="free">x</span><span class="main">⦄</span><span class="main">)</span> <span class="main">≤</span> Rep_hf <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hdiff_iff hsubsetI hsubset_imp_le<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Rep_hf <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="main">⦃</span><span class="free">x</span><span class="main">⦄</span><span class="main">)</span> <span class="main">≠</span> Rep_hf <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Rep_hf_inject hdiff_iff hinsert_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_neq_implies_less<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">least</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"hf <span class="main">⇒</span> hf"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">least</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟶</span> Rep_hf <span class="bound">x</span> <span class="main">≤</span> Rep_hf <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="OrdArith-least_equality"><span class="command">lemma</span></span> least_equality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">a</span> <span class="main">⟹</span> Rep_hf <span class="free">x</span> <span class="main">≤</span> Rep_hf <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"least <span class="free">a</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> least_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Rep_hf_inverse assms eq_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="OrdArith-leastI2_order"><span class="command">lemma</span></span> leastI2_order<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">a</span> <span class="main">⟹</span> Rep_hf <span class="free">x</span> <span class="main">≤</span> Rep_hf <span class="bound">y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">a</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">a</span> <span class="main">⟶</span> Rep_hf <span class="bound">z</span> <span class="main">≤</span> Rep_hf <span class="bound">y</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span>least <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms least_equality<span class="main">)</span>

<span class="keyword1" id="OrdArith-nonempty_imp_ex_least"><span class="command">lemma</span></span> nonempty_imp_ex_least<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">a</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">a</span> <span class="main">⟶</span> Rep_hf <span class="bound">x</span> <span class="main">≤</span> Rep_hf <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hf_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>hinsert <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
     <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dual_order.trans eq_iff hinsert.IH<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hmem_hinsert
                  less_eq_insert1_iff linear<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="OrdArith-least_hmem"><span class="command">lemma</span></span> least_hmem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> least <span class="free">a</span> <span class="main"><span class="hidden">❙</span><b>∈</b></span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> nonempty_imp_ex_least<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> leastI2_order<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>