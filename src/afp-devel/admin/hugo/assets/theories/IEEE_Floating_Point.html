<div id="IEEE">
<div class="head">
<h1>Theory IEEE</h1>
</div>
<pre class="source"><span class="comment1">(* Formalization of IEEE-754 Standard for binary floating-point arithmetic *)</span>
<span class="comment1">(* Author: Lei Yu, University of Cambridge *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Specification of the IEEE standard›</span></span>

<span class="keyword1"><span class="command">theory</span></span> IEEE
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="../../HOL/HOL-Library/Float.html">HOL-Library.Float</a>"</span>
    <a href="../Word_Lib/Word_Lemmas.html">Word_Lib.Word_Lemmas</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">::</span><span class="quoted">len</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">::</span><span class="quoted">len</span><span class="main">)</span> float <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV<span class="main">::</span><span class="main">(</span><span class="main">1</span> word <span class="main">×</span> <span class="tfree">'e</span> word <span class="main">×</span> <span class="tfree">'f</span> word<span class="main">)</span> set"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_float

<span class="keyword1"><span class="command">syntax</span></span> <span class="quoted">"_float"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"type <span class="main">⇒</span> type <span class="main">⇒</span> type"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">'(</span>_<span class="keyword1">,</span> _<span class="keyword1">')</span> <span class="keyword1">float</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹parse <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>('a, 'b) float›</span></span></span></span> as ('a::len, 'b::len) float.›</span></span>

<span class="keyword1"><span class="command">parse_translation</span></span> <span class="quoted">‹
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">float</span> <span class="entity">t</span> <span class="entity">u</span> <span class="main">=</span> Syntax.const <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_syntax</span> float<span class="antiquote">}</span></span> $ <span class="entity">t</span> $ <span class="entity">u</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">len_tr</span> <span class="entity">u</span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">case</span></span> Term_Position.strip_positions <span class="entity">u</span> <span class="keyword2"><span class="keyword">of</span></span>
        <span class="entity">v</span> <span class="keyword1"><span class="keyword">as</span></span> Free <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> <span class="main">=&gt;</span>
          <span class="keyword2"><span class="keyword">if</span></span> Lexicon.is_tid <span class="entity">x</span> <span class="keyword2"><span class="keyword">then</span></span>
            <span class="main">(</span>Syntax.const <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">syntax_const</span> "_ofsort"<span class="antiquote">}</span></span> $ <span class="entity">v</span> $
              Syntax.const <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">class_syntax</span> len<span class="antiquote">}</span></span><span class="main">)</span>
          <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">u</span>
      <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">u</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">len_float_tr</span> <span class="main">[</span><span class="entity">t</span><span class="main">,</span> <span class="entity">u</span><span class="main">]</span> <span class="main">=</span>
      <span class="entity">float</span> <span class="main">(</span><span class="entity">len_tr</span> <span class="entity">t</span><span class="main">)</span> <span class="main">(</span><span class="entity">len_tr</span> <span class="entity">u</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="main">[</span><span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">syntax_const</span> "_float"<span class="antiquote">}</span></span><span class="main">,</span> K <span class="entity">len_float_tr</span><span class="main">)</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">end</span></span>
›</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Derived parameters for floating point formats›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wordlength</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> itself <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">wordlength</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bias</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> itself <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bias</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emax</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> itself <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emax</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> unat<span class="main">(</span>max_word<span class="main">::</span><span class="tfree">'e</span> word<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">fracwidth</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> itself <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fracwidth</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">≡</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Predicates for the four IEEE formats›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_single</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> itself <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_single</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">8</span> <span class="main">∧</span> wordlength <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="numeral">32</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_double</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> itself <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_double</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">11</span> <span class="main">∧</span> wordlength <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="numeral">64</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_single_extended</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> itself <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_single_extended</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">11</span> <span class="main">∧</span> wordlength <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≥</span> <span class="numeral">43</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_double_extended</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> itself <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_double_extended</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">⟷</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">≥</span> <span class="numeral">15</span> <span class="main">∧</span> wordlength <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≥</span> <span class="numeral">79</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Extractors for fields›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> sign<span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">::</span><span class="main">1</span> word<span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">::</span><span class="tfree">'e</span> word<span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">::</span><span class="tfree">'f</span> word<span class="main">)</span><span class="main">.</span> unat <span class="bound">s</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> exponent<span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="bound">e</span><span class="main">::</span><span class="tfree">'e</span> word<span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">.</span> unat <span class="bound">e</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> fraction<span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">,</span> <span class="bound">f</span><span class="main">::</span><span class="tfree">'f</span> word<span class="main">)</span><span class="main">.</span> unat <span class="bound">f</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">real_of_word</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≡</span> real <span class="main">(</span>unat <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> valof <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> real"</span></span>
<span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">e</span><span class="main">,</span> <span class="bound">f</span><span class="main">)</span><span class="main">.</span>
    <span class="keyword1">let</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">in</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="bound">e</span> <span class="main">=</span> <span class="main">0</span>
     <span class="keyword1">then</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span><span class="main">^</span><span class="main">(</span>unat <span class="bound">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span>bias <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>real_of_word <span class="bound">f</span><span class="main">/</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
     <span class="keyword1">else</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span><span class="main">^</span><span class="main">(</span>unat <span class="bound">s</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>unat <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span>bias <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> real_of_word <span class="bound">f</span><span class="main">/</span><span class="numeral">2</span><span class="main">^</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Partition of numbers into disjoint classes›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_nan</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_nan</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟷</span> exponent <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> emax <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">∧</span> fraction <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≠</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_infinity</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_infinity</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟷</span> exponent <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> emax <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">∧</span> fraction <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_normal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_normal</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟷</span> <span class="main">0</span> <span class="main">&lt;</span> exponent <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> exponent <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">&lt;</span> emax <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_denormal</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_denormal</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟷</span> exponent <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> fraction <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≠</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_zero</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_zero</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟷</span> exponent <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> fraction <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_finite</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_finite</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟷</span> <span class="main">(</span>is_normal <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∨</span> is_denormal <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∨</span> is_zero <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Special values›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> plus_infinity <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">∞</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span> max_word<span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> topfloat <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span> max_word <span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">^</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> float<span class="main">::</span><span class="main">(</span><span class="quoted">len</span><span class="main">,</span> <span class="quoted">len</span><span class="main">)</span> <span class="quoted">zero</span> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">zero_float</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Negation operation on floating point values›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> float<span class="main">::</span><span class="main">(</span><span class="quoted">len</span><span class="main">,</span> <span class="quoted">len</span><span class="main">)</span> <span class="quoted">uminus</span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">uminus_float</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span>  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">e</span><span class="main">,</span> <span class="bound">f</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">s</span><span class="main">,</span> <span class="bound">e</span><span class="main">,</span> <span class="bound">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">minus_zero</span> <span class="main">≡</span> <span class="main">-</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">minus_infinity</span> <span class="main">≡</span> <span class="main">-</span> <span class="main">∞</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="main">(</span>input<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">bottomfloat</span> <span class="main">≡</span> <span class="main">-</span> topfloat"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Real number valuations›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The largest value that can be represented in floating point format.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">largest</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> itself <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">largest</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>emax <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">^</span>bias <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span>fracwidth <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Threshold, used for checking overflow.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">threshold</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> itself <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">threshold</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>emax <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">^</span>bias <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="main">(</span>Suc<span class="main">(</span>fracwidth <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Unit of least precision.›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> one_lp<span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">e</span><span class="main">,</span> <span class="bound">f</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">e</span><span class="main">::</span><span class="tfree">'e</span> word<span class="main">,</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> zero_lp<span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">e</span><span class="main">,</span> <span class="bound">f</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="bound">e</span><span class="main">::</span><span class="tfree">'e</span> word<span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ulp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ulp</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> valof <span class="main">(</span>one_lp <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">-</span> valof <span class="main">(</span>zero_lp <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Enumerated type for rounding modes.›</span></span>
<span class="keyword1"><span class="command">datatype</span></span> roundmode <span class="main">=</span> To_nearest <span class="main">|</span> float_To_zero <span class="main">|</span> To_pinfinity <span class="main">|</span> To_ninfinity

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Characterization of best approximation from a set of abstract values.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_closest</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟶</span> <span class="main">¦</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="bound">b</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">¦</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Best approximation with a deciding preference for multiple possibilities.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">closest</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">a</span><span class="main">.</span> is_closest <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">a</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> is_closest <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">b</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Rounding›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">round</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"roundmode <span class="main">⇒</span> real <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">round</span> To_nearest <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span>
   <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="main">-</span> threshold <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span><span class="main">)</span> <span class="keyword1">then</span> minus_infinity
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≥</span> threshold <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span><span class="main">)</span> <span class="keyword1">then</span> plus_infinity
    <span class="keyword1">else</span> closest <span class="main">(</span>valof<span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> even <span class="main">(</span>fraction <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> is_finite <span class="bound">a</span><span class="main">}</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">round</span> float_To_zero <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span>
   <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">&lt;</span> <span class="main">-</span> largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span><span class="main">)</span> <span class="keyword1">then</span> bottomfloat
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">&gt;</span> largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span><span class="main">)</span> <span class="keyword1">then</span> topfloat
    <span class="keyword1">else</span> closest <span class="main">(</span>valof<span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> True<span class="main">)</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> is_finite <span class="bound">a</span> <span class="main">∧</span> <span class="main">¦</span>valof <span class="bound">a</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">¦</span><span class="main">}</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">round</span> To_pinfinity <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span>
   <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">&lt;</span> <span class="main">-</span> largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span><span class="main">)</span> <span class="keyword1">then</span> bottomfloat
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">&gt;</span> largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span><span class="main">)</span> <span class="keyword1">then</span> plus_infinity
    <span class="keyword1">else</span> closest <span class="main">(</span>valof<span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> True<span class="main">)</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> is_finite <span class="bound">a</span> <span class="main">∧</span> valof <span class="bound">a</span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">}</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">round</span> To_ninfinity <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span>
   <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">&lt;</span> <span class="main">-</span> largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span><span class="main">)</span> <span class="keyword1">then</span> minus_infinity
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">&gt;</span> largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span><span class="main">)</span> <span class="keyword1">then</span> topfloat
    <span class="keyword1">else</span> closest <span class="main">(</span>valof<span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> True<span class="main">)</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> is_finite <span class="bound">a</span> <span class="main">∧</span> valof <span class="bound">a</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">}</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Rounding to integer values in floating point format.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_integral</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">is_integral</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⟷</span> is_finite <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">¦</span>valof <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">¦</span> <span class="main">=</span> real <span class="bound">n</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">intround</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"roundmode <span class="main">⇒</span> real <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">intround</span> To_nearest <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≤</span> <span class="main">-</span> threshold <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span><span class="main">)</span> <span class="keyword1">then</span> minus_infinity
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">≥</span> threshold <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span><span class="main">)</span> <span class="keyword1">then</span> plus_infinity
     <span class="keyword1">else</span> closest <span class="main">(</span>valof<span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> even <span class="bound">n</span> <span class="main">∧</span> <span class="main">¦</span>valof <span class="bound">a</span><span class="main">¦</span> <span class="main">=</span> real <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> is_integral <span class="bound">a</span><span class="main">}</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">intround</span> float_To_zero <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">&lt;</span> <span class="main">-</span> largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span><span class="main">)</span> <span class="keyword1">then</span> bottomfloat
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">&gt;</span> largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span><span class="main">)</span> <span class="keyword1">then</span> topfloat
     <span class="keyword1">else</span> closest <span class="main">(</span>valof<span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> True<span class="main">)</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> is_integral <span class="bound">a</span> <span class="main">∧</span> <span class="main">¦</span>valof <span class="bound">a</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">¦</span><span class="main">}</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">intround</span> To_pinfinity <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">&lt;</span> <span class="main">-</span> largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span><span class="main">)</span> <span class="keyword1">then</span> bottomfloat
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">&gt;</span> largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span><span class="main">)</span> <span class="keyword1">then</span> plus_infinity
     <span class="keyword1">else</span> closest <span class="main">(</span>valof<span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> True<span class="main">)</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> is_integral <span class="bound">a</span> <span class="main">∧</span> valof <span class="bound">a</span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">}</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span><span class="quoted"><span class="quoted">"<span class="free">intround</span> To_ninfinity <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">&lt;</span> <span class="main">-</span> largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span><span class="main">)</span> <span class="keyword1">then</span> minus_infinity
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">&gt;</span> largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span><span class="main">)</span> <span class="keyword1">then</span> topfloat
     <span class="keyword1">else</span> closest <span class="main">(</span>valof<span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> True<span class="main">)</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> is_integral <span class="bound">a</span> <span class="main">∧</span> valof <span class="bound">a</span> <span class="main">≥</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">}</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Round, choosing between -0.0 or +0.0›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">float_round</span><span class="main">::</span><span class="quoted"><span class="quoted">"roundmode <span class="main">⇒</span> bool <span class="main">⇒</span> real <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">float_round</span> <span class="free"><span class="bound"><span class="entity">mode</span></span></span> <span class="free"><span class="bound"><span class="entity">toneg</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">let</span> <span class="bound">x</span> <span class="main">=</span> round <span class="free"><span class="bound"><span class="entity">mode</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="keyword1">in</span>
         <span class="keyword1">if</span> is_zero <span class="bound">x</span>
            <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">toneg</span></span></span>
                    <span class="keyword1">then</span> minus_zero
                 <span class="keyword1">else</span> <span class="main">0</span>
         <span class="keyword1">else</span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Non-standard of NaN.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">some_nan</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">some_nan</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">a</span><span class="main">.</span> is_nan <span class="bound">a</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Coercion for signs of zero results.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">zerosign</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">zerosign</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> is_zero <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">-</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Remainder operation.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">rem</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">n</span> <span class="main">=</span> closest id <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> even <span class="bound">n</span> <span class="main">∧</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="main">=</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span> <span class="main">::</span> nat<span class="main">.</span> <span class="main">¦</span><span class="bound">x</span><span class="main">¦</span> <span class="main">=</span> real <span class="bound">n</span><span class="main">}</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">/</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>
     <span class="keyword1">in</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">-</span> <span class="bound">n</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">frem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"roundmode <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">frem</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> is_nan <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∨</span> is_nan <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∨</span> is_infinity <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∨</span> is_zero <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> some_nan
     <span class="keyword1">else</span> zerosign <span class="main">(</span>sign <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span>round <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>rem <span class="main">(</span>valof <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span>valof <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definitions of the arithmetic operations›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fintrnd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"roundmode <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fintrnd</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> is_nan <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="main">(</span>some_nan<span class="main">)</span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> is_infinity <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>
     <span class="keyword1">else</span> zerosign <span class="main">(</span>sign <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span>intround <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>valof <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fadd</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"roundmode <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fadd</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> is_nan <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∨</span> is_nan <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∨</span> <span class="main">(</span>is_infinity <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> is_infinity <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> sign <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≠</span> sign <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>
     <span class="keyword1">then</span> some_nan
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span>is_infinity <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span>is_infinity <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>
     <span class="keyword1">else</span>
      zerosign
        <span class="main">(</span><span class="keyword1">if</span> is_zero <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> is_zero <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> sign <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> sign <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> sign <span class="free"><span class="bound"><span class="entity">a</span></span></span>
         <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> To_ninfinity <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>
        <span class="main">(</span>round <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>valof <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">+</span> valof <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fsub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"roundmode <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fsub</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> is_nan <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∨</span> is_nan <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∨</span> <span class="main">(</span>is_infinity <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> is_infinity <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> sign <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> sign <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>
     <span class="keyword1">then</span> some_nan
     <span class="keyword1">else</span> <span class="keyword1">if</span> is_infinity <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> is_infinity <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>
     <span class="keyword1">else</span>
      zerosign
        <span class="main">(</span><span class="keyword1">if</span> is_zero <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> is_zero <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> sign <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≠</span> sign <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> sign <span class="free"><span class="bound"><span class="entity">a</span></span></span>
         <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">=</span> To_ninfinity <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>
        <span class="main">(</span>round <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>valof <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">-</span> valof <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fmul</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"roundmode <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fmul</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> is_nan <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∨</span> is_nan <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∨</span> <span class="main">(</span>is_zero <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> is_infinity <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>is_infinity <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> is_zero <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>
     <span class="keyword1">then</span> some_nan
     <span class="keyword1">else</span> <span class="keyword1">if</span> is_infinity <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∨</span> is_infinity <span class="free"><span class="bound"><span class="entity">b</span></span></span>
     <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> sign <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> sign <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> plus_infinity <span class="keyword1">else</span> minus_infinity<span class="main">)</span>
     <span class="keyword1">else</span> zerosign <span class="main">(</span><span class="keyword1">if</span> sign <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> sign <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">)</span> <span class="main">(</span>round <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>valof <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> valof <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fdiv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"roundmode <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fdiv</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> is_nan <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∨</span> is_nan <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∨</span> <span class="main">(</span>is_zero <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> is_zero <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>is_infinity <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> is_infinity <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>
     <span class="keyword1">then</span> some_nan
     <span class="keyword1">else</span> <span class="keyword1">if</span> is_infinity <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∨</span> is_zero <span class="free"><span class="bound"><span class="entity">b</span></span></span>
     <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> sign <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> sign <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> plus_infinity <span class="keyword1">else</span> minus_infinity<span class="main">)</span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> is_infinity <span class="free"><span class="bound"><span class="entity">b</span></span></span>
     <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> sign <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> sign <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">-</span> <span class="main">0</span><span class="main">)</span>
     <span class="keyword1">else</span> zerosign <span class="main">(</span><span class="keyword1">if</span> sign <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> sign <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>round <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>valof <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">/</span> valof <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fsqrt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"roundmode <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fsqrt</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> is_nan <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> some_nan
     <span class="keyword1">else</span> <span class="keyword1">if</span> is_zero <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∨</span> is_infinity <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> sign <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> sign <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> some_nan
     <span class="keyword1">else</span> zerosign <span class="main">(</span>sign <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span>round <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>sqrt <span class="main">(</span>valof <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fmul_add</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"roundmode <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'t</span> <span class="main">,</span><span class="tfree">'w</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fmul_add</span> <span class="free"><span class="bound"><span class="entity">mode</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">let</span> <span class="bound">signP</span> <span class="main">=</span> <span class="keyword1">if</span> sign <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> sign <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="keyword1">in</span>
      <span class="keyword1">let</span> <span class="bound">infP</span> <span class="main">=</span> is_infinity <span class="free"><span class="bound"><span class="entity">x</span></span></span>  <span class="main">∨</span> is_infinity <span class="free"><span class="bound"><span class="entity">y</span></span></span>
      <span class="keyword1">in</span>
         <span class="keyword1">if</span> is_nan <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∨</span> is_nan <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∨</span> is_nan <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="keyword1">then</span> some_nan
         <span class="keyword1">else</span> <span class="keyword1">if</span> is_infinity <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> is_zero <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∨</span>
                 is_zero <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∧</span> is_infinity <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∨</span>
                 is_infinity <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">∧</span> <span class="bound">infP</span> <span class="main">∧</span> <span class="bound">signP</span> <span class="main">≠</span> sign <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="keyword1">then</span>
            some_nan
         <span class="keyword1">else</span> <span class="keyword1">if</span> is_infinity <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">∧</span> <span class="main">(</span>sign <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">infP</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">signP</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>
            <span class="keyword1">then</span> plus_infinity
         <span class="keyword1">else</span> <span class="keyword1">if</span> is_infinity <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">∧</span> <span class="main">(</span>sign <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">infP</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">signP</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>
            <span class="keyword1">then</span> minus_infinity
         <span class="keyword1">else</span>
            <span class="keyword1">let</span> <span class="bound">r1</span> <span class="main">=</span> valof <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> valof <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">;</span>
                <span class="bound">r2</span> <span class="main">=</span> valof <span class="free"><span class="bound"><span class="entity">z</span></span></span>
            <span class="keyword1">in</span>
              float_round <span class="free"><span class="bound"><span class="entity">mode</span></span></span>
                <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="bound">r1</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">r2</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">signP</span> <span class="main">=</span> sign <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">)</span> <span class="keyword1">then</span>
                   <span class="bound">signP</span> <span class="main">=</span> <span class="main">1</span>
                 <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">mode</span></span></span> <span class="main">=</span> To_ninfinity<span class="main">)</span> <span class="main">(</span><span class="bound">r1</span> <span class="main">+</span> <span class="bound">r2</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Comparison operations›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> ccode <span class="main">=</span> Gt <span class="main">|</span> Lt <span class="main">|</span> Eq <span class="main">|</span> Und

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fcompare</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> ccode"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fcompare</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> is_nan <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∨</span> is_nan <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> Und
     <span class="keyword1">else</span> <span class="keyword1">if</span> is_infinity <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> sign <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">1</span>
     <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> is_infinity <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> sign <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> Eq <span class="keyword1">else</span> Lt<span class="main">)</span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> is_infinity <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> sign <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">0</span>
     <span class="keyword1">then</span> <span class="main">(</span><span class="keyword1">if</span> is_infinity <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> sign <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> Eq <span class="keyword1">else</span> Gt<span class="main">)</span>
     <span class="keyword1">else</span> <span class="keyword1">if</span> is_infinity <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> sign <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="keyword1">then</span> Gt
     <span class="keyword1">else</span> <span class="keyword1">if</span> is_infinity <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> sign <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> Lt
     <span class="keyword1">else</span> <span class="keyword1">if</span> valof <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">&lt;</span> valof <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> Lt
     <span class="keyword1">else</span> <span class="keyword1">if</span> valof <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> valof <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> Eq
     <span class="keyword1">else</span> Gt<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">flt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">flt</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟷</span> fcompare <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> Lt"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fle</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fle</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟷</span> fcompare <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> Lt <span class="main">∨</span> fcompare <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> Eq"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fgt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fgt</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟷</span> fcompare <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> Gt"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">fge</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">fge</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟷</span> fcompare <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> Gt <span class="main">∨</span> fcompare <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> Eq"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">feq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span> <span class="main">,</span><span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">feq</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟷</span> fcompare <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> Eq"</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Specify float to be double  precision and round to even›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> float <span class="main">::</span> <span class="main">(</span><span class="quoted">len</span><span class="main">,</span> <span class="quoted">len</span><span class="main">)</span> <span class="quoted">plus</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">plus_float</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> fadd To_nearest <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> float <span class="main">::</span> <span class="main">(</span><span class="quoted">len</span><span class="main">,</span> <span class="quoted">len</span><span class="main">)</span> <span class="quoted">minus</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">minus_float</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> fsub To_nearest <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> float <span class="main">::</span> <span class="main">(</span><span class="quoted">len</span><span class="main">,</span> <span class="quoted">len</span><span class="main">)</span> <span class="quoted">times</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">times_float</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> fmul To_nearest <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> float <span class="main">::</span> <span class="main">(</span><span class="quoted">len</span><span class="main">,</span> <span class="quoted">len</span><span class="main">)</span> <span class="quoted">one</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">one_float</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> float <span class="main">::</span> <span class="main">(</span><span class="quoted">len</span><span class="main">,</span> <span class="quoted">len</span><span class="main">)</span> <span class="quoted">inverse</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">divide_float</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> fdiv To_nearest <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">inverse_float</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">inverse_float</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> fdiv To_nearest <span class="main">1</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">float_rem</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">float_rem</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> frem To_nearest <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">float_sqrt</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">float_sqrt</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> fsqrt To_nearest <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ROUNDFLOAT</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ROUNDFLOAT</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> fintrnd To_nearest <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span>


<span class="keyword1"><span class="command">instantiation</span></span> float <span class="main">::</span> <span class="main">(</span><span class="quoted">len</span><span class="main">,</span> <span class="quoted">len</span><span class="main">)</span> <span class="quoted">ord</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">less_float</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟷</span> flt <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">less_eq_float</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟷</span> fle <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">float_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">≐</span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">float_eq</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> feq <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> float <span class="main">::</span> <span class="main">(</span><span class="quoted">len</span><span class="main">,</span> <span class="quoted">len</span><span class="main">)</span> <span class="quoted">abs</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">abs_float</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">abs_float</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sign <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">else</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>1 + ε›</span></span></span></span> property.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">normalizes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> itself <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">normalizes</span> <span class="free"><span class="bound"><span class="entity">float_format</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="main">1</span><span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>real<span class="main">)</span><span class="main">^</span><span class="main">(</span>bias <span class="free"><span class="bound"><span class="entity">float_format</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">¦</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">¦</span> <span class="main">∧</span> <span class="main">¦</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">¦</span> <span class="main">&lt;</span> threshold <span class="free"><span class="bound"><span class="entity">float_format</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="IEEE_Properties">
<div class="head">
<h1>Theory IEEE_Properties</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Lei Yu, University of Cambridge
   Author: Fabian Hellauer
           Fabian Immler
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Proofs of Properties about Floating Point Arithmetic›</span></span>

<span class="keyword1"><span class="command">theory</span></span> IEEE_Properties
<span class="keyword2"><span class="keyword">imports</span></span> <a href="IEEE.html">IEEE</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Theorems derived from definitions›</span></span>


<span class="keyword1" id="IEEE_Properties-valof_eq"><span class="command">lemma</span></span> valof_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"valof <span class="free">x</span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> exponent <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>
       <span class="keyword1">then</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> sign <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> bias <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
            <span class="main">(</span>real <span class="main">(</span>fraction <span class="free">x</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span><span class="main">)</span>
       <span class="keyword1">else</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> sign <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> exponent <span class="free">x</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> bias <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
            <span class="main">(</span><span class="main">1</span> <span class="main">+</span> real <span class="main">(</span>fraction <span class="free">x</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bias_def <span class="dynamic"><span class="dynamic">divide_simps</span></span> unat_eq_0<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-exponent_le"><span class="command">lemma</span></span> exponent_le<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"exponent <span class="free">a</span> <span class="main">≤</span> unat <span class="main">(</span>max_word<span class="main">::</span><span class="tfree">'a</span> word<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> unat_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> word_le_nat_alt<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-max_word_le_exponent_iff"><span class="command">lemma</span></span>
  max_word_le_exponent_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"unat <span class="main">(</span>max_word<span class="main">::</span><span class="tfree">'a</span> word<span class="main">)</span> <span class="main">≤</span> exponent <span class="free">a</span> <span class="main">⟷</span> unat <span class="main">(</span>max_word<span class="main">::</span><span class="tfree">'a</span> word<span class="main">)</span> <span class="main">=</span> exponent <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> le_antisym <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="IEEE_Properties-infinity_simps"><span class="command">lemma</span></span> infinity_simps<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sign <span class="main">(</span>plus_infinity<span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"sign <span class="main">(</span>minus_infinity<span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="quoted"><span class="quoted">"exponent <span class="main">(</span>plus_infinity<span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> emax <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"exponent <span class="main">(</span>minus_infinity<span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> emax <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"fraction <span class="main">(</span>plus_infinity<span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"fraction <span class="main">(</span>minus_infinity<span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> emax_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> emax_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="IEEE_Properties-zero_simps"><span class="command">lemma</span></span> zero_simps<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sign <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"sign <span class="main">(</span><span class="main">-</span> <span class="main">0</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="quoted"><span class="quoted">"exponent <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"exponent <span class="main">(</span><span class="main">-</span> <span class="main">0</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"fraction <span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"fraction <span class="main">(</span><span class="main">-</span> <span class="main">0</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="IEEE_Properties-emax_eq"><span class="command">lemma</span></span> emax_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"emax <span class="free">x</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span> itself"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emax_def unat_minus_one_word<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-topfloat_simps"><span class="command">lemma</span></span> topfloat_simps<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sign <span class="main">(</span>topfloat<span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="quoted"><span class="quoted">"exponent <span class="main">(</span>topfloat<span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> emax <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="quoted"><span class="quoted">"fraction <span class="main">(</span>topfloat<span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span>fracwidth <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> bottomfloat_simps<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sign <span class="main">(</span>bottomfloat<span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="quoted"><span class="quoted">"exponent <span class="main">(</span>bottomfloat<span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> emax <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="quoted"><span class="quoted">"fraction <span class="main">(</span>bottomfloat<span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">^</span>fracwidth <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emax_eq take_bit_minus_small_eq
    nat_diff_distrib nat_power_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unat_minus_one_word<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emax_eq take_bit_minus_small_eq
    unat_minus_one_word nat_diff_distrib nat_power_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unat_minus_one_word<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> float_defs <span class="main">=</span>
  is_finite_def is_infinity_def is_zero_def is_nan_def
  is_normal_def is_denormal_def valof_eq
  less_eq_float_def less_float_def
  flt_def fgt_def fle_def fge_def feq_def
  fcompare_def
  infinity_simps
  zero_simps
  topfloat_simps
  bottomfloat_simps
  float_eq_def

<span class="keyword1" id="IEEE_Properties-float_cases"><span class="command">lemma</span></span> float_cases<span class="main">:</span> <span class="quoted"><span class="quoted">"is_nan <span class="free">a</span> <span class="main">∨</span> is_infinity <span class="free">a</span> <span class="main">∨</span> is_normal <span class="free">a</span> <span class="main">∨</span> is_denormal <span class="free">a</span> <span class="main">∨</span> is_zero <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> emax_def float_defs not_less<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-float_cases_finite"><span class="command">lemma</span></span> float_cases_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"is_nan <span class="free">a</span> <span class="main">∨</span> is_infinity <span class="free">a</span> <span class="main">∨</span> is_finite <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> float_cases is_finite_def<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-float_zero1"><span class="command">lemma</span></span> float_zero1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> float_defs
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="IEEE_Properties-float_zero2"><span class="command">lemma</span></span> float_zero2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero <span class="main">(</span><span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟷</span> is_zero <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> float_defs
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="IEEE_Properties-emax_pos"><span class="command">lemma</span></span> emax_pos<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> emax <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"emax <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> emax_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The types of floating-point numbers are mutually distinct.›</span></span>
<span class="keyword1" id="IEEE_Properties-float_distinct"><span class="command">lemma</span></span> float_distinct<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>is_nan <span class="free">a</span> <span class="main">∧</span> is_infinity <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>is_nan <span class="free">a</span> <span class="main">∧</span> is_normal <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>is_nan <span class="free">a</span> <span class="main">∧</span> is_denormal <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>is_nan <span class="free">a</span> <span class="main">∧</span> is_zero <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>is_infinity <span class="free">a</span> <span class="main">∧</span> is_normal <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>is_infinity <span class="free">a</span> <span class="main">∧</span> is_denormal <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>is_infinity <span class="free">a</span> <span class="main">∧</span> is_zero <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>is_normal <span class="free">a</span> <span class="main">∧</span> is_denormal <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>is_denormal <span class="free">a</span> <span class="main">∧</span> is_zero <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> float_defs<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-denormal_imp_not_zero"><span class="command">lemma</span></span> denormal_imp_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"is_denormal <span class="free">f</span> <span class="main">⟹</span> <span class="main">¬</span>is_zero <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_denormal_def is_zero_def<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-normal_imp_not_zero"><span class="command">lemma</span></span> normal_imp_not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"is_normal <span class="free">f</span> <span class="main">⟹</span> <span class="main">¬</span>is_zero <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_normal_def is_zero_def<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-normal_imp_not_denormal"><span class="command">lemma</span></span> normal_imp_not_denormal<span class="main">:</span> <span class="quoted"><span class="quoted">"is_normal <span class="free">f</span> <span class="main">⟹</span> <span class="main">¬</span>is_denormal <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_normal_def is_denormal_def<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-denormal_zero"><span class="command">lemma</span></span> denormal_zero<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_denormal <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_denormal minus_zero"</span></span>
  <span class="keyword1"><span class="command">using</span></span> denormal_imp_not_zero float_zero1 float_zero2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="IEEE_Properties-normal_zero"><span class="command">lemma</span></span> normal_zero<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_normal <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>is_normal minus_zero"</span></span>
  <span class="keyword1"><span class="command">using</span></span> normal_imp_not_zero float_zero1 float_zero2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="IEEE_Properties-float_distinct_finite"><span class="command">lemma</span></span> float_distinct_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>is_nan <span class="free">a</span> <span class="main">∧</span> is_finite <span class="free">a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>is_infinity <span class="free">a</span> <span class="main">∧</span> is_finite <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> float_defs<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-finite_infinity"><span class="command">lemma</span></span> finite_infinity<span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span> <span class="main">⟹</span> <span class="main">¬</span> is_infinity <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> float_defs<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-finite_nan"><span class="command">lemma</span></span> finite_nan<span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span> <span class="main">⟹</span> <span class="main">¬</span> is_nan <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> float_defs<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For every real number, the floating-point numbers closest to it always exist.›</span></span>
<span class="keyword1" id="IEEE_Properties-is_closest_exists"><span class="command">lemma</span></span> is_closest_exists<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span> <span class="main">⇒</span> real"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> non_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> is_closest <span class="free">v</span> <span class="free">s</span> <span class="free">x</span> <span class="bound">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finite non_empty
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> finite_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> empty
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">z</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_closest <span class="free">v</span> <span class="main">(</span>insert <span class="skolem">z</span> <span class="skolem">s</span><span class="main">)</span> <span class="free">x</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_closest_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"is_closest <span class="free">v</span> <span class="skolem">s</span> <span class="free">x</span> <span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> insert <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">v</span> <span class="skolem">a</span> <span class="main">-</span> <span class="free">x</span><span class="main">¦</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">v</span> <span class="skolem">z</span> <span class="main">-</span> <span class="free">x</span><span class="main">¦</span>"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> le_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> le
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_iff a is_closest_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> ge
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> <span class="skolem">s</span> <span class="main">⟶</span> <span class="main">¦</span><span class="free">v</span> <span class="skolem">a</span> <span class="main">-</span> <span class="free">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="free">v</span> <span class="bound">b</span> <span class="main">-</span> <span class="free">x</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a is_closest_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∈</span> insert <span class="skolem">z</span> <span class="skolem">s</span> <span class="main">⟶</span> <span class="main">¦</span><span class="free">v</span> <span class="skolem">z</span> <span class="main">-</span> <span class="free">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="free">v</span> <span class="bound">b</span> <span class="main">-</span> <span class="free">x</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eq_iff ge insert_iff order.trans<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> is_closest_def a
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insertI1<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-closest_is_everything"><span class="command">lemma</span></span> closest_is_everything<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span> <span class="main">⇒</span> real"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> non_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_closest <span class="free">v</span> <span class="free">s</span> <span class="free">x</span> <span class="main">(</span>closest <span class="free">v</span> <span class="free">p</span> <span class="free">s</span> <span class="free">x</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">b</span><span class="main">.</span> is_closest <span class="free">v</span> <span class="free">s</span> <span class="free">x</span> <span class="bound">b</span> <span class="main">∧</span> <span class="free">p</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">p</span> <span class="main">(</span>closest <span class="free">v</span> <span class="free">p</span> <span class="free">s</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> closest_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> assms is_closest_exists <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-closest_in_set"><span class="command">lemma</span></span> closest_in_set<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"closest <span class="free">v</span> <span class="free">p</span> <span class="free">s</span> <span class="free">x</span> <span class="main">∈</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms closest_is_everything is_closest_def<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-closest_is_closest_finite"><span class="command">lemma</span></span> closest_is_closest_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_closest <span class="free">v</span> <span class="free">s</span> <span class="free">x</span> <span class="main">(</span>closest <span class="free">v</span> <span class="free">p</span> <span class="free">s</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> closest_is_everything assms<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> float<span class="main">::</span><span class="main">(</span><span class="quoted">len</span><span class="main">,</span> <span class="quoted">len</span><span class="main">)</span> <span class="quoted">finite</span> <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-is_finite_nonempty"><span class="command">lemma</span></span> is_finite_nonempty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">a</span><span class="main">.</span> is_finite <span class="bound">a</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> is_finite <span class="bound">a</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> float_defs
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-closest_is_closest"><span class="command">lemma</span></span> closest_is_closest<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_closest <span class="free">v</span> <span class="free">s</span> <span class="free">x</span> <span class="main">(</span>closest <span class="free">v</span> <span class="free">p</span> <span class="free">s</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> closest_is_closest_finite<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties about ordering and bounding›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Lifting of non-exceptional comparisons.›</span></span>
<span class="keyword1" id="IEEE_Properties-float_lt"><span class="command">lemma</span></span> float_lt <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟷</span> valof <span class="free">a</span> <span class="main">&lt;</span> valof <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"valof <span class="free">a</span> <span class="main">&lt;</span> valof <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_nan <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_nan <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_infinity <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_infinity <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_nan finite_infinity<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fcompare <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> Lt"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_infinity_def is_nan_def valof_def fcompare_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> float_defs<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lt<span class="main">:</span> <span class="quoted"><span class="quoted">"fcompare <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> Lt"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> float_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_nan <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_nan <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_infinity <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_infinity <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_nan finite_infinity<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valof <span class="free">a</span> <span class="main">&lt;</span> valof <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lt assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fcompare_def is_nan_def is_infinity_def valof_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-float_eq"><span class="command">lemma</span></span> float_eq <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≐</span> <span class="free">b</span> <span class="main">⟷</span> valof <span class="free">a</span> <span class="main">=</span> valof <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"valof <span class="free">a</span> <span class="main">=</span> valof <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_nan <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_nan <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_infinity <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_infinity <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms float_distinct_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fcompare <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> Eq"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_infinity_def is_nan_def valof_def fcompare_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≐</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> float_defs<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≐</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"fcompare <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> Eq"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> float_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_nan <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_nan <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_infinity <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_infinity <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms float_distinct_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valof <span class="free">a</span> <span class="main">=</span> valof <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fcompare_def is_nan_def is_infinity_def valof_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-float_le"><span class="command">lemma</span></span> float_le <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟷</span> valof <span class="free">a</span> <span class="main">≤</span> valof <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟷</span>  <span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">a</span> <span class="main">≐</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> float_defs<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Reflexivity of equality for non-NaNs.›</span></span>
<span class="keyword1" id="IEEE_Properties-float_eq_refl"><span class="command">lemma</span></span> float_eq_refl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≐</span> <span class="free">a</span> <span class="main">⟷</span> <span class="main">¬</span> is_nan <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> float_defs<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Properties about Ordering.›</span></span>
<span class="keyword1" id="IEEE_Properties-float_lt_trans"><span class="command">lemma</span></span> float_lt_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span> <span class="main">⟹</span> is_finite <span class="free">b</span> <span class="main">⟹</span> is_finite <span class="free">c</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_trans<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-float_le_less_trans"><span class="command">lemma</span></span> float_le_less_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span> <span class="main">⟹</span> is_finite <span class="free">b</span> <span class="main">⟹</span> is_finite <span class="free">c</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_trans<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-float_le_trans"><span class="command">lemma</span></span> float_le_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span> <span class="main">⟹</span> is_finite <span class="free">b</span> <span class="main">⟹</span> is_finite <span class="free">c</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">b</span> <span class="main">≤</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">c</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_trans<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-float_le_neg"><span class="command">lemma</span></span> float_le_neg<span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span> <span class="main">⟹</span> is_finite <span class="free">b</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">a</span> <span class="main">&lt;</span> <span class="free">b</span> <span class="main">⟷</span> <span class="free">b</span> <span class="main">≤</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Properties about bounding.›</span></span>

<span class="keyword1" id="IEEE_Properties-float_le_infinity"><span class="command">lemma</span></span> float_le_infinity <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_nan <span class="free">a</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> plus_infinity"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> float_defs
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="IEEE_Properties-zero_le_topfloat"><span class="command">lemma</span></span> zero_le_topfloat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> topfloat"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">0</span> <span class="main">≤</span> topfloat"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> float_defs <span class="dynamic"><span class="dynamic">field_simps</span></span> power_gt1_lemma of_nat_diff<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-LENGTH_contr"><span class="command">lemma</span></span> LENGTH_contr<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">&lt;</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">⟹</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">::</span>len<span class="main">)</span> <span class="main">≤</span> Suc <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_antisym len_gt_0 n_less_equal_power_2 not_less_eq numeral_2_eq_2 one_le_numeral
      self_le_power<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-valof_topfloat"><span class="command">lemma</span></span> valof_topfloat<span class="main">:</span> <span class="quoted"><span class="quoted">"valof <span class="main">(</span>topfloat<span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that LENGTH_contr
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emax_eq largest_def <span class="dynamic"><span class="dynamic">divide_simps</span></span> float_defs of_nat_diff<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-float_frac_le"><span class="command">lemma</span></span> float_frac_le<span class="main">:</span> <span class="quoted"><span class="quoted">"fraction <span class="free">a</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">^</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> float_defs
  <span class="keyword1"><span class="command">using</span></span> less_Suc_eq_le
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">fastforce</span>

<span class="keyword1" id="IEEE_Properties-float_exp_le"><span class="command">lemma</span></span> float_exp_le<span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span> <span class="main">⟹</span> exponent <span class="free">a</span> <span class="main">≤</span> emax <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> float_defs
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="IEEE_Properties-float_sign_le"><span class="command">lemma</span></span> float_sign_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span><span class="main">^</span><span class="main">(</span>sign <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span><span class="main">^</span><span class="main">(</span>sign <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> neg_one_even_power neg_one_odd_power<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-exp_less"><span class="command">lemma</span></span> exp_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>real<span class="main">)</span><span class="main">^</span><span class="free">a</span> <span class="main">≤</span> <span class="numeral">2</span><span class="main">^</span><span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted">nat</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="IEEE_Properties-div_less"><span class="command">lemma</span></span> div_less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∧</span> <span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">a</span><span class="main">/</span><span class="free">c</span> <span class="main">≤</span> <span class="free">b</span><span class="main">/</span><span class="free">c</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>linordered_field"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> divide_le_cancel less_asym<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-finite_topfloat"><span class="command">lemma</span></span> finite_topfloat<span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite topfloat"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> float_defs
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemmas</span></span> float_leI <span class="main">=</span> float_le<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">]</span>

<span class="keyword1" id="IEEE_Properties-factor_minus"><span class="command">lemma</span></span> factor_minus<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">a</span> <span class="main">-</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>comm_semiring_1_cancel"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-real_le_power_numeral_diff"><span class="command">lemma</span></span> real_le_power_numeral_diff<span class="main">:</span> <span class="quoted"><span class="quoted">"real <span class="free">a</span> <span class="main">≤</span> numeral <span class="free">b</span> <span class="main">^</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">≤</span> numeral <span class="free">b</span> <span class="main">^</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> of_nat_1 of_nat_diff of_nat_le_iff of_nat_numeral
      one_le_numeral one_le_power semiring_1_class.of_nat_power<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">denormal_exponent</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span> itself <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">denormal_exponent</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span>int <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span>bias <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">normal_exponent</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span> <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">normal_exponent</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> int <span class="main">(</span>exponent <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">-</span> int <span class="main">(</span>bias <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> int <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">denormal_mantissa</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span> <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">denormal_mantissa</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span>sign <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> int <span class="main">(</span>fraction <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">normal_mantissa</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span> <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">normal_mantissa</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">^</span>sign <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">+</span> int <span class="main">(</span>fraction <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="IEEE_Properties-unat_one_word_le"><span class="command">lemma</span></span> unat_one_word_le<span class="main">:</span> <span class="quoted"><span class="quoted">"unat <span class="free">a</span> <span class="main">≤</span> Suc <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">1</span> word"</span></span>
  <span class="keyword1"><span class="command">using</span></span> unat_lt2p<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="IEEE_Properties-one_word_le"><span class="command">lemma</span></span> one_word_le<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">1</span> word"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> word_le_nat_alt unat_one_word_le<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-sign_cases"><span class="command">lemma</span></span> sign_cases<span class="main">[</span><span class="operator">case_names</span> pos neg<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"sign <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"sign <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sign <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sign <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign <span class="free">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unat_one_word_le<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sign <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sign <span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-is_infinity_cases"><span class="command">lemma</span></span> is_infinity_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_infinity <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> plus_infinity"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> minus_infinity"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sign_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sign <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> plus_infinity"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> float_defs
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> emax_def unat_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sign <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> minus_infinity"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> float_defs
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> emax_def unat_eq_of_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-is_zero_cases"><span class="command">lemma</span></span> is_zero_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_zero <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">-</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sign_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sign <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> float_defs
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> emax_def unat_eq_0<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sign <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> minus_zero"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> float_defs
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> emax_def unat_eq_of_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-minus_minus_float"><span class="command">lemma</span></span> minus_minus_float<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="IEEE_Properties-sign_minus_float"><span class="command">lemma</span></span> sign_minus_float<span class="main">:</span> <span class="quoted"><span class="quoted">"sign <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> sign <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> unat_eq_1 one_word_le unat_sub<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-exponent_uminus"><span class="command">lemma</span></span> exponent_uminus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"exponent <span class="main">(</span><span class="main">-</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> exponent <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
<span class="keyword1" id="IEEE_Properties-fraction_uminus"><span class="command">lemma</span></span> fraction_uminus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fraction <span class="main">(</span><span class="main">-</span> <span class="free">f</span><span class="main">)</span> <span class="main">=</span> fraction <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="IEEE_Properties-is_normal_minus_float"><span class="command">lemma</span></span> is_normal_minus_float<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_normal <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> is_normal <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_normal_def<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-is_denormal_minus_float"><span class="command">lemma</span></span> is_denormal_minus_float<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_denormal <span class="main">(</span><span class="main">-</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> is_denormal <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_denormal_def<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-bitlen_normal_mantissa"><span class="command">lemma</span></span> bitlen_normal_mantissa<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bitlen <span class="main">(</span>abs <span class="main">(</span>normal_mantissa <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fraction <span class="free">x</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> float_frac_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_pred le_imp_less_Suc pos2 zero_less_power<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> int <span class="main">(</span>fraction <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> negative_zle_0 order_trans zero_le_numeral zero_le_power <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sign_cases<span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bitlen_le_iff_power bitlen_ge_iff_power nat_add_distrib
        normal_mantissa_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> antisym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-less_int_natI"><span class="command">lemma</span></span> less_int_natI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"nat <span class="free">x</span> <span class="main">&lt;</span> nat <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>

<span class="keyword1" id="IEEE_Properties-normal_exponent_bounds_int"><span class="command">lemma</span></span> normal_exponent_bounds_int<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> int <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">≤</span> normal_exponent <span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"normal_exponent <span class="free">x</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> int <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_normal <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">unfolding</span></span> normal_exponent_def is_normal_def emax_eq bias_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> zless_nat_conj <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> less_int_natI
      <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_nat_diff nat_add_distrib nat_mult_distrib nat_power_eq
      power_Suc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> of_int_leI <span class="main">=</span> of_int_le_iff<span class="main">[</span><span class="operator">THEN</span> iffD2<span class="main">]</span>

<span class="keyword1" id="IEEE_Properties-normal_exponent_bounds_real"><span class="command">lemma</span></span> normal_exponent_bounds_real<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> real <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">≤</span> normal_exponent <span class="free">x</span>"</span></span>
  <span class="quoted"><span class="quoted">"normal_exponent <span class="free">x</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> real <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_normal <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ of_int_leI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> normal_exponent_bounds_int<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> of_int_leI<span class="main"><span class="main">[</span></span><span class="operator">OF</span> normal_exponent_bounds_int<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="IEEE_Properties-float_eqI"><span class="command">lemma</span></span> float_eqI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"sign <span class="free">x</span> <span class="main">=</span> sign <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"fraction <span class="free">x</span> <span class="main">=</span> fraction <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"exponent <span class="free">x</span> <span class="main">=</span> exponent <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="IEEE_Properties-float_induct"><span class="command">lemma</span></span> float_induct<span class="main">[</span><span class="operator">induct</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">type</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">:</span></span></span></span>float<span class="main">,</span> <span class="operator">case_names</span> normal denormal neg zero infinity nan<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> normal<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> is_normal <span class="bound">x</span> <span class="main">⟹</span> valof <span class="bound">x</span> <span class="main">=</span> normal_mantissa <span class="bound">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="keyword1">powr</span> normal_exponent <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> denormal<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> is_denormal <span class="bound">x</span> <span class="main">⟹</span>
      valof <span class="bound">x</span> <span class="main">=</span> denormal_mantissa <span class="bound">x</span> <span class="main">*</span> <span class="numeral">2</span> <span class="keyword1">powr</span> denormal_exponent <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> minus_zero"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> infty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> plus_infinity"</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> minus_infinity"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> nan<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> is_nan <span class="bound">x</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> float_cases<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"is_nan <span class="free">a</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"is_infinity <span class="free">a</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"is_normal <span class="free">a</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"is_denormal <span class="free">a</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"is_zero <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nan<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> plus_infinity"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> minus_infinity"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_infinity_cases<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">cases</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> infty<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> hyps<span class="main">:</span> 3
    <span class="keyword1"><span class="command">from</span></span> hyps <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valof <span class="free">a</span> <span class="main">=</span> normal_mantissa <span class="free">a</span> <span class="main">*</span> <span class="numeral">2</span> <span class="keyword1">powr</span> normal_exponent <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sign_cases<span class="main">)</span>
        <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valof_eq normal_mantissa_def normal_exponent_def is_normal_def
          powr_realpow<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> powr_diff powr_add <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> hyps this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> normal<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> hyps<span class="main">:</span> 4
    <span class="keyword1"><span class="command">from</span></span> hyps <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valof <span class="free">a</span> <span class="main">=</span> denormal_mantissa <span class="free">a</span> <span class="main">*</span> <span class="numeral">2</span> <span class="keyword1">powr</span> denormal_exponent <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sign_cases<span class="main">)</span>
        <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valof_eq denormal_mantissa_def denormal_exponent_def is_denormal_def
          powr_realpow<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> powr_diff powr_add <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> hyps this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> denormal<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 5
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> minus_zero"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> is_zero_cases<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">cases</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> zero<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-infinite_infinity"><span class="command">lemma</span></span> infinite_infinity<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_finite plus_infinity"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_finite minus_infinity"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_finite_def is_normal_def infinity_simps is_denormal_def is_zero_def<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-nan_not_finite"><span class="command">lemma</span></span> nan_not_finite<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_nan <span class="free">x</span> <span class="main">⟹</span> <span class="main">¬</span> is_finite <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> float_distinct_finite<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="IEEE_Properties-valof_nonneg"><span class="command">lemma</span></span> valof_nonneg<span class="main">:</span>
  <span class="quoted"><span class="quoted">"valof <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"sign <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valof_eq that<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-valof_nonpos"><span class="command">lemma</span></span> valof_nonpos<span class="main">:</span>
  <span class="quoted"><span class="quoted">"valof <span class="free">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"sign <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valof_eq is_finite_def<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-real_le_intI"><span class="command">lemma</span></span> real_le_intI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"floor <span class="free">x</span> <span class="main">≤</span> floor <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">ℤ</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span> <span class="free">y</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">,</span>1<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Ints_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> Ints_induct <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_floor_iff<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-real_of_int_le_2_powr_bitlenI"><span class="command">lemma</span></span> real_of_int_le_2_powr_bitlenI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"real_of_int <span class="free">x</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"bitlen <span class="main">(</span>abs <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">≤</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="free">x</span> <span class="main">≤</span> abs <span class="main">(</span>real_of_int <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span>bitlen <span class="main">(</span>abs <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> abs_real_le_2_powr_bitlen<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="free">x</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span>bitlen <span class="main">(</span>abs <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_real_of_int bitlen_nonneg <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> real_le_intI<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="free">m</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> that<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> that<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-largest_eq"><span class="command">lemma</span></span> largest_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="keyword1">powr</span> real_of_int <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> int <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span>
    <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span>real <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> real <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> largest_def emax_eq bias_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> largest_def powr_realpow<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
        powr_minus <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> powr_diff powr_add of_nat_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> self_le_power<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>real <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">-</span> real <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span>real <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_nat_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> real <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span>
    real_of_int <span class="main">(</span><span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> int <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> power_Suc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-bitlen_denormal_mantissa"><span class="command">lemma</span></span> bitlen_denormal_mantissa<span class="main">:</span>
  <span class="quoted"><span class="quoted">"bitlen <span class="main">(</span>abs <span class="main">(</span>denormal_mantissa <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fraction <span class="free">x</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> float_frac_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_pred le_imp_less_Suc pos2 zero_less_power<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> int <span class="main">(</span>fraction <span class="free">x</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> negative_zle_0 order_trans zero_le_numeral zero_le_power <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sign_cases<span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bitlen_le_iff_power denormal_mantissa_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> antisym<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-float_le_topfloat"><span class="command">lemma</span></span> float_le_topfloat<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> topfloat"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> float_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>normal <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> normal<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span>normal_mantissa <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="keyword1">powr</span> real_of_int <span class="main">(</span>normal_exponent <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span>
    <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> int <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> normal_exponent_bounds_real<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹is_normal <span class="skolem">x</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mult_mono real_of_int_le_2_powr_bitlenI
        <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bitlen_normal_mantissa powr_realpow<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> ge_one_powr_ge_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> IEEE.float<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> largest_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_realpow powr_add<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> valof <span class="main">(</span>topfloat<span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valof_topfloat<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> float_leI normal finite_topfloat<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>denormal <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> denormal<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> real <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> real <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_le_cancel_iff<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"real_of_int <span class="main">(</span>denormal_mantissa <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="keyword1">powr</span> real_of_int <span class="main">(</span>denormal_exponent <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span>
    <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> int <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bitlen_denormal_mantissa<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mult_mono real_of_int_le_2_powr_bitlenI
        <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bitlen_normal_mantissa powr_realpow<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> ge_one_powr_ge_zero
        denormal_exponent_def bias_def powr_mult_base of_nat_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> IEEE.float<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> largest_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_mono<span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_realpow powr_add power_Suc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> power_Suc<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> valof <span class="main">(</span>topfloat<span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valof_topfloat<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> float_leI denormal finite_topfloat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword1" id="IEEE_Properties-float_val_le_largest"><span class="command">lemma</span></span> float_val_le_largest<span class="main">:</span>
  <span class="quoted"><span class="quoted">"valof <span class="free">a</span> <span class="main">≤</span> largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> that finite_topfloat float_le float_le_topfloat valof_topfloat<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-float_val_lt_threshold"><span class="command">lemma</span></span> float_val_lt_threshold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"valof <span class="free">a</span> <span class="main">&lt;</span> threshold <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valof <span class="free">a</span> <span class="main">≤</span> largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> float_val_le_largest <span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">&lt;</span> threshold <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> largest_def threshold_def <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Algebraic properties about basic arithmetic›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Commutativity of addition.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> float_plus_comm_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">=</span> <span class="free">b</span> <span class="main">+</span> <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> float_plus_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">≐</span> <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_nan <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_nan <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_infinity <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_infinity <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_nan finite_infinity<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">=</span> <span class="free">b</span> <span class="main">+</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> float_defs fadd_def plus_float_def add.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">≐</span> <span class="main">(</span><span class="free">b</span> <span class="main">+</span> <span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> float_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The floating-point number a falls into the same category as the negation of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>a›</span></span></span></span>.›</span></span>
<span class="keyword1" id="IEEE_Properties-is_zero_uminus"><span class="command">lemma</span></span> is_zero_uminus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">⟷</span> is_zero <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_zero_def<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-is_infinity_uminus"><span class="command">lemma</span></span> is_infinity_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_infinity <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> is_infinity <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_infinity_def<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-is_finite_uminus"><span class="command">lemma</span></span> is_finite_uminus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">⟷</span> is_finite <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_finite_def<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-is_nan_uminus"><span class="command">lemma</span></span> is_nan_uminus<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_nan <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">⟷</span> is_nan <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_nan_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The sign of a and the sign of a's negation is different.›</span></span>
<span class="keyword1" id="IEEE_Properties-float_neg_sign"><span class="command">lemma</span></span> float_neg_sign<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sign <span class="free">a</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span>sign <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sign_cases<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sign_minus_float<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-float_neg_sign1"><span class="command">lemma</span></span> float_neg_sign1<span class="main">:</span> <span class="quoted"><span class="quoted">"sign <span class="free">a</span> <span class="main">=</span> sign <span class="main">(</span><span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟷</span> sign <span class="free">a</span> <span class="main">≠</span> sign <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> float_neg_sign sign_cases<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-valof_uminus"><span class="command">lemma</span></span> valof_uminus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valof <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> valof <span class="free">a</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?L</span> <span class="main">=</span> <span class="var">?R</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sign_cases<span class="main">)</span>  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valof_eq sign_minus_float<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Showing <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>a + (- b) = a - b›</span></span></span></span>.›</span></span>
<span class="keyword1" id="IEEE_Properties-float_neg_add"><span class="command">lemma</span></span> float_neg_add<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span> <span class="main">⟹</span> is_finite <span class="free">b</span> <span class="main">⟹</span> is_finite <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> valof <span class="free">a</span> <span class="main">+</span> valof <span class="main">(</span><span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> valof <span class="free">a</span> <span class="main">-</span> valof <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valof_uminus<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-float_plus_minus"><span class="command">lemma</span></span> float_plus_minus<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">≐</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> nab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_nan <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_nan <span class="main">(</span><span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_infinity <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_infinity <span class="main">(</span><span class="main">-</span>  <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_nan finite_infinity<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span>zerosign
        <span class="main">(</span><span class="keyword1">if</span> is_zero <span class="free">a</span> <span class="main">∧</span> is_zero <span class="free">b</span> <span class="main">∧</span> sign <span class="free">a</span> <span class="main">≠</span> sign <span class="free">b</span> <span class="keyword1">then</span> <span class="main">(</span>sign <span class="free">a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>
        <span class="main">(</span>round To_nearest <span class="main">(</span>valof <span class="free">a</span> <span class="main">-</span> valof <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nab
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> minus_float_def fsub_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>
    <span class="main">(</span>zerosign
        <span class="main">(</span><span class="keyword1">if</span> is_zero <span class="free">a</span> <span class="main">∧</span> is_zero <span class="main">(</span><span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">∧</span> sign <span class="free">a</span> <span class="main">=</span> sign <span class="main">(</span><span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="keyword1">then</span> sign <span class="free">a</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>
        <span class="main">(</span>round To_nearest <span class="main">(</span>valof <span class="free">a</span> <span class="main">+</span> valof <span class="main">(</span><span class="main">-</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> float_neg_sign1 float_neg_add<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span> <span class="main">+</span> <span class="main">-</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nab <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> float_defs fadd_def plus_float_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> float_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-finite_bottomfloat"><span class="command">lemma</span></span> finite_bottomfloat<span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite bottomfloat"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_topfloat<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-bottomfloat_eq_m_largest"><span class="command">lemma</span></span> bottomfloat_eq_m_largest<span class="main">:</span> <span class="quoted"><span class="quoted">"valof <span class="main">(</span>bottomfloat<span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valof_topfloat valof_uminus finite_topfloat<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-float_val_ge_bottomfloat"><span class="command">lemma</span></span> float_val_ge_bottomfloat<span class="main">:</span> <span class="quoted"><span class="quoted">"valof <span class="free">a</span> <span class="main">≥</span> valof <span class="main">(</span>bottomfloat<span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="free">a</span> <span class="main">≤</span> topfloat"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> float_le_topfloat<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valof_uminus finite_topfloat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-float_ge_bottomfloat"><span class="command">lemma</span></span> float_ge_bottomfloat<span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≥</span> bottomfloat"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">for</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_bottomfloat float_le float_val_ge_bottomfloat that<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-float_val_ge_largest"><span class="command">lemma</span></span> float_val_ge_largest<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valof <span class="free">a</span> <span class="main">≥</span> <span class="main">-</span> largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> valof <span class="main">(</span>bottomfloat<span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bottomfloat_eq_m_largest<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> valof <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> float_val_ge_bottomfloat<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-float_val_gt_threshold"><span class="command">lemma</span></span> float_val_gt_threshold<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"valof <span class="free">a</span> <span class="main">&gt;</span> <span class="main">-</span> threshold <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> largest<span class="main">:</span> <span class="quoted"><span class="quoted">"valof <span class="free">a</span> <span class="main">≥</span> <span class="main">-</span>largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> float_val_ge_largest<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>largest <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">-</span> threshold <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bias_def threshold_def largest_def <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> largest less_le_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Showing <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>abs (- a) = abs a›</span></span></span></span>.›</span></span>
<span class="keyword1" id="IEEE_Properties-float_abs"><span class="command">lemma</span></span> float_abs <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_nan <span class="free">a</span> <span class="main">⟹</span> abs <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> abs <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IEEE.abs_float_def float_neg_sign1 minus_minus_float zero_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-neg_zerosign"><span class="command">lemma</span></span> neg_zerosign<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span>zerosign <span class="free">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> zerosign <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="main">-</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zerosign_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Properties about Rounding Errors›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">error</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span> itself <span class="main">⇒</span> real <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">error</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> valof <span class="main">(</span>round To_nearest <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1" id="IEEE_Properties-bound_at_worst_lemma"><span class="command">lemma</span></span> bound_at_worst_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> threshold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">&lt;</span> threshold <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>valof <span class="main">(</span>round To_nearest <span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">-</span> <span class="free">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span>valof <span class="free">a</span> <span class="main">-</span> <span class="free">x</span><span class="main">¦</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>round To_nearest <span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span>
      closest valof <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> even <span class="main">(</span>fraction <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> is_finite <span class="bound">a</span><span class="main">}</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> threshold finite
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_closest <span class="main">(</span>valof<span class="main">)</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> is_finite <span class="bound">a</span><span class="main">}</span> <span class="free">x</span> <span class="main">(</span>round To_nearest <span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span><span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_finite_nonempty
    <span class="keyword1"><span class="command">unfolding</span></span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> closest_is_closest<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> finite is_closest_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mem_Collect_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-error_at_worst_lemma"><span class="command">lemma</span></span> error_at_worst_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> threshold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">&lt;</span> threshold <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>error <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="free">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span>valof <span class="free">a</span> <span class="main">-</span> <span class="free">x</span><span class="main">¦</span> "</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> error_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bound_at_worst_lemma<span class="main"><span class="keyword3">;</span></span> <span class="operator">fact</span><span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-error_is_zero"><span class="command">lemma</span></span> error_is_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">&lt;</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"error <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">(</span>valof <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>valof <span class="free">a</span><span class="main">¦</span> <span class="main">&lt;</span> threshold <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abs_less_iff minus_less_iff float_val_gt_threshold float_val_lt_threshold assms<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abs_le_zero_iff abs_zero diff_self error_at_worst_lemma assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-is_finite_zerosign"><span class="command">lemma</span></span> is_finite_zerosign<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite <span class="main">(</span>zerosign <span class="free">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">⟷</span> is_finite <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zerosign_def is_finite_def<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-is_finite_closest"><span class="command">lemma</span></span> is_finite_closest<span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite <span class="main">(</span>closest <span class="main">(</span><span class="free">v</span><span class="main">::</span><span class="main">_</span><span class="main">⇒</span>real<span class="main">)</span> <span class="free">p</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> is_finite <span class="bound">a</span><span class="main">}</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> closest_is_closest<span class="main">[</span><span class="operator">OF</span> is_finite_nonempty<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_closest_def<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-defloat_float_zerosign_round_finite"><span class="command">lemma</span></span> defloat_float_zerosign_round_finite<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> threshold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">x</span><span class="main">¦</span> <span class="main">&lt;</span> threshold <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="main">(</span>zerosign <span class="free">s</span> <span class="main">(</span>round To_nearest <span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>round To_nearest <span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span>closest valof <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> even <span class="main">(</span>fraction <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> is_finite <span class="bound">a</span><span class="main">}</span> <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> threshold <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> abs_less_iff leD le_minus_iff round.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="main">(</span>round To_nearest <span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_finite_closest<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> is_finite_zerosign <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-valof_zero"><span class="command">lemma</span></span> valof_zero<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"valof <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"valof minus_zero <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zerosign_def valof_eq zero_simps<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-signzero_zero"><span class="command">lemma</span></span> signzero_zero<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_zero <span class="free">a</span> <span class="main">⟹</span> valof <span class="main">(</span>zerosign <span class="free">s</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zerosign_def<span class="main">)</span>

<span class="keyword1" id="IEEE_Properties-val_zero"><span class="command">lemma</span></span> val_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"is_zero <span class="free">a</span> <span class="main">⟹</span> valof <span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> is_zero_cases<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1" id="IEEE_Properties-float_add"><span class="command">lemma</span></span> float_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> threshold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>valof <span class="free">a</span> <span class="main">+</span> valof <span class="free">b</span><span class="main">¦</span> <span class="main">&lt;</span> threshold <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> finite_float_add<span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> error_float_add<span class="main">:</span>  <span class="quoted"><span class="quoted">"valof <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> valof <span class="free">a</span> <span class="main">+</span> valof <span class="free">b</span> <span class="main">+</span> error <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">(</span>valof <span class="free">a</span> <span class="main">+</span> valof <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_nan <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_nan <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_infinity <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_infinity <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms float_distinct_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span>zerosign
      <span class="main">(</span><span class="keyword1">if</span> is_zero <span class="free">a</span> <span class="main">∧</span> is_zero <span class="free">b</span> <span class="main">∧</span> sign <span class="free">a</span> <span class="main">=</span> sign <span class="free">b</span> <span class="keyword1">then</span> <span class="main">(</span>sign <span class="free">a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>
      <span class="main">(</span>round To_nearest <span class="main">(</span>valof <span class="free">a</span> <span class="main">+</span> valof <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> float_defs fadd_def plus_float_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> threshold defloat_float_zerosign_round_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> val_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"valof <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span>
    valof <span class="main">(</span>zerosign
      <span class="main">(</span><span class="keyword1">if</span> is_zero <span class="free">a</span> <span class="main">∧</span> is_zero <span class="free">b</span> <span class="main">∧</span> sign <span class="free">a</span> <span class="main">=</span> sign <span class="free">b</span> <span class="keyword1">then</span> <span class="main">(</span>sign <span class="free">a</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>
      <span class="main">(</span>round To_nearest <span class="main">(</span>valof <span class="free">a</span> <span class="main">+</span> valof <span class="free">b</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ab is_infinity_def is_nan_def valof_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valof <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> valof <span class="free">a</span> <span class="main">+</span> valof <span class="free">b</span> <span class="main">+</span> error <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">(</span>valof <span class="free">a</span> <span class="main">+</span> valof <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_zero <span class="main">(</span>round To_nearest <span class="main">(</span>valof <span class="free">a</span> <span class="main">+</span> valof <span class="free">b</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valof <span class="free">a</span> <span class="main">+</span> valof <span class="free">b</span> <span class="main">+</span> error <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">(</span>valof <span class="free">a</span> <span class="main">+</span> valof <span class="free">b</span><span class="main">)</span> <span class="main">=</span>
        valof <span class="main">(</span>round To_nearest <span class="main">(</span>valof <span class="free">a</span> <span class="main">+</span> valof <span class="free">b</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> error_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True signzero_zero val_zero val_ab<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ab add.commute eq_diff_eq' error_def zerosign_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-float_sub"><span class="command">lemma</span></span> float_sub<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> threshold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>valof <span class="free">a</span> <span class="main">-</span> valof <span class="free">b</span><span class="main">¦</span> <span class="main">&lt;</span> threshold <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> finite_float_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> error_float_sub<span class="main">:</span> <span class="quoted"><span class="quoted">"valof <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> valof <span class="free">a</span> <span class="main">-</span> valof <span class="free">b</span> <span class="main">+</span> error <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">(</span>valof <span class="free">a</span> <span class="main">-</span> valof <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_nan <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_nan <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_infinity <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_infinity <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> finite_nan finite_infinity<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">-</span> <span class="free">b</span> <span class="main">=</span>
    <span class="main">(</span>zerosign
      <span class="main">(</span><span class="keyword1">if</span> is_zero <span class="free">a</span> <span class="main">∧</span> is_zero <span class="free">b</span> <span class="main">∧</span> sign <span class="free">a</span> <span class="main">≠</span> sign <span class="free">b</span> <span class="keyword1">then</span> sign <span class="free">a</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>
      <span class="main">(</span>round To_nearest <span class="main">(</span>valof <span class="free">a</span> <span class="main">-</span> valof <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> float_defs fsub_def minus_float_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> threshold defloat_float_zerosign_round_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> val_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"valof <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span>
    valof <span class="main">(</span>zerosign
      <span class="main">(</span><span class="keyword1">if</span> is_zero <span class="free">a</span> <span class="main">∧</span> is_zero <span class="free">b</span> <span class="main">∧</span> sign <span class="free">a</span> <span class="main">≠</span> sign <span class="free">b</span> <span class="keyword1">then</span> sign <span class="free">a</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>
      <span class="main">(</span>round To_nearest <span class="main">(</span>valof <span class="free">a</span> <span class="main">-</span> valof <span class="free">b</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ab is_infinity_def is_nan_def valof_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valof <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> valof <span class="free">a</span> <span class="main">-</span> valof <span class="free">b</span> <span class="main">+</span> error <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">(</span>valof <span class="free">a</span> <span class="main">-</span> valof <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_zero <span class="main">(</span>round To_nearest <span class="main">(</span>valof <span class="free">a</span> <span class="main">-</span> valof <span class="free">b</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valof <span class="free">a</span> <span class="main">-</span> valof <span class="free">b</span> <span class="main">+</span> error <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">(</span>valof <span class="free">a</span> <span class="main">-</span> valof <span class="free">b</span><span class="main">)</span> <span class="main">=</span>
        valof <span class="main">(</span>round To_nearest <span class="main">(</span>valof <span class="free">a</span> <span class="main">-</span> valof <span class="free">b</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> error_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True signzero_zero val_zero val_ab<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ab add.commute eq_diff_eq' error_def zerosign_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-float_mul"><span class="command">lemma</span></span> float_mul<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> threshold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>valof <span class="free">a</span> <span class="main">*</span> valof <span class="free">b</span><span class="main">¦</span> <span class="main">&lt;</span> threshold <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> finite_float_mul<span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> error_float_mul<span class="main">:</span> <span class="quoted"><span class="quoted">"valof <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> valof <span class="free">a</span> <span class="main">*</span> valof <span class="free">b</span> <span class="main">+</span> error <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">(</span>valof <span class="free">a</span> <span class="main">*</span> valof <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> non<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_nan <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_nan <span class="free">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_infinity <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_infinity <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms float_distinct_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">*</span> <span class="free">b</span> <span class="main">=</span>
    <span class="main">(</span>zerosign <span class="main">(</span>of_bool <span class="main">(</span>sign <span class="free">a</span> <span class="main">≠</span> sign <span class="free">b</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>round To_nearest <span class="main">(</span>valof <span class="free">a</span> <span class="main">*</span> valof <span class="free">b</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> float_defs fmul_def times_float_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> threshold defloat_float_zerosign_round_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> val_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"valof <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span>
      valof <span class="main">(</span>zerosign <span class="main">(</span>of_bool <span class="main">(</span>sign <span class="free">a</span> <span class="main">≠</span> sign <span class="free">b</span><span class="main">)</span><span class="main">)</span>
        <span class="main">(</span>round To_nearest <span class="main">(</span>valof <span class="free">a</span> <span class="main">*</span> valof <span class="free">b</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ab float_defs of_bool_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valof <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> valof <span class="free">a</span> <span class="main">*</span> valof <span class="free">b</span> <span class="main">+</span> error <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">(</span>valof <span class="free">a</span> <span class="main">*</span> valof <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_zero <span class="main">(</span>round To_nearest <span class="main">(</span>valof <span class="free">a</span> <span class="main">*</span> valof <span class="free">b</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valof <span class="free">a</span> <span class="main">*</span> valof <span class="free">b</span> <span class="main">+</span> error <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>  <span class="main">(</span>valof <span class="free">a</span> <span class="main">*</span> valof <span class="free">b</span><span class="main">)</span> <span class="main">=</span>
        valof <span class="main">(</span>round To_nearest <span class="main">(</span>valof <span class="free">a</span> <span class="main">*</span> valof <span class="free">b</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> error_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True signzero_zero val_zero val_ab<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ab add.commute eq_diff_eq' error_def zerosign_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-float_div"><span class="command">lemma</span></span> float_div<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">a</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> not_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_zero <span class="free">b</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> threshold<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>valof <span class="free">a</span> <span class="main">/</span> valof <span class="free">b</span><span class="main">¦</span> <span class="main">&lt;</span> threshold <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> finite_float_div<span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite <span class="main">(</span><span class="free">a</span> <span class="main">/</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> error_float_div<span class="main">:</span> <span class="quoted"><span class="quoted">"valof <span class="main">(</span><span class="free">a</span> <span class="main">/</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> valof <span class="free">a</span> <span class="main">/</span> valof <span class="free">b</span> <span class="main">+</span> error <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">(</span>valof <span class="free">a</span> <span class="main">/</span> valof <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">/</span> <span class="free">b</span> <span class="main">=</span>
    <span class="main">(</span>zerosign <span class="main">(</span>of_bool <span class="main">(</span>sign <span class="free">a</span> <span class="main">≠</span> sign <span class="free">b</span><span class="main">)</span><span class="main">)</span>
      <span class="main">(</span>round To_nearest <span class="main">(</span>valof <span class="free">a</span> <span class="main">/</span> valof <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> assms
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_float_def fdiv_def finite_infinity finite_nan not_zero float_defs <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="main">(</span><span class="free">a</span> <span class="main">/</span> <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> threshold defloat_float_zerosign_round_finite<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> val_ab<span class="main">:</span> <span class="quoted"><span class="quoted">"valof <span class="main">(</span><span class="free">a</span> <span class="main">/</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span>
      valof <span class="main">(</span>zerosign <span class="main">(</span>of_bool <span class="main">(</span>sign <span class="free">a</span> <span class="main">≠</span> sign <span class="free">b</span><span class="main">)</span><span class="main">)</span>
        <span class="main">(</span>round To_nearest <span class="main">(</span>valof <span class="free">a</span> <span class="main">/</span> valof <span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ab float_defs of_bool_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valof <span class="main">(</span><span class="free">a</span> <span class="main">/</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> valof <span class="free">a</span> <span class="main">/</span> valof <span class="free">b</span> <span class="main">+</span> error <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>  <span class="main">(</span>valof <span class="free">a</span> <span class="main">/</span> valof <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_zero <span class="main">(</span>round To_nearest <span class="main">(</span>valof <span class="free">a</span> <span class="main">/</span> valof <span class="free">b</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valof <span class="free">a</span> <span class="main">/</span> valof <span class="free">b</span> <span class="main">+</span> error <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">(</span>valof <span class="free">a</span> <span class="main">/</span> valof <span class="free">b</span><span class="main">)</span> <span class="main">=</span>
        valof <span class="main">(</span>round To_nearest <span class="main">(</span>valof <span class="free">a</span> <span class="main">/</span> valof <span class="free">b</span><span class="main">)</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> error_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> True signzero_zero val_zero val_ab<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ab add.commute eq_diff_eq' error_def zerosign_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="IEEE_Properties-valof_one"><span class="command">lemma</span></span> valof_one<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"valof <span class="main">(</span><span class="main">1</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bias_def unat_sub word_1_le_power p2_eq_1<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="FP64">
<div class="head">
<h1>Theory FP64</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> FP64
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="IEEE.html">IEEE</a>
  <a href="../Word_Lib/Word_64.html">Word_Lib.Word_64</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Concrete encodings›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Floating point operations defined as operations on words.
  Called ''fixed precision'' (fp) word in HOL4.›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> float64 <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">52</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> fp64 <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="numeral">64</span> word"</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> fp64_of_float <span class="main">::</span> <span class="quoted"><span class="quoted">"float64 <span class="main">⇒</span> fp64"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">::</span><span class="main">1</span> word<span class="main">,</span> <span class="bound">e</span><span class="main">::</span><span class="numeral">11</span> word<span class="main">,</span> <span class="bound">f</span><span class="main">::</span><span class="numeral">52</span> word<span class="main">)</span><span class="main">.</span> word_cat <span class="bound">s</span> <span class="main">(</span>word_cat <span class="bound">e</span> <span class="bound">f</span><span class="main">::</span><span class="numeral">63</span> word<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> float_of_fp64 <span class="main">::</span> <span class="quoted"><span class="quoted">"fp64 <span class="main">⇒</span> float64"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> apsnd word_split <span class="main">(</span>word_split <span class="bound">x</span><span class="main">::</span><span class="main">1</span> word <span class="main">*</span> <span class="numeral">63</span> word<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rel_fp64</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="main">(</span><span class="bound">y</span><span class="main">::</span>word64<span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> float_of_fp64 <span class="bound">y</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">eq_fp64</span><span class="main">::</span><span class="quoted"><span class="quoted">"float64 <span class="main">⇒</span> float64 <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">eq_fp64</span> <span class="main">≡</span> <span class="main">(=)</span>"</span></span>

<span class="keyword1" id="FP64-float_of_fp64_inverse"><span class="command">lemma</span></span> float_of_fp64_inverse<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fp64_of_float <span class="main">(</span>float_of_fp64 <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span>
      <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fp64_of_float_def float_of_fp64_def Abs_float_inverse apsnd_def map_prod_def word_size
      <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> word_cat_split_alt<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span>
      <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>

<span class="keyword1" id="FP64-float_of_fp64_inj_iff"><span class="command">lemma</span></span> float_of_fp64_inj_iff<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fp64_of_float <span class="free">r</span> <span class="main">=</span> fp64_of_float <span class="free">s</span> <span class="main">⟷</span> <span class="free">r</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Rep_float_inject
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fp64_of_float_def word_cat_inj word_size <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.splits<span class="main">)</span>

<span class="keyword1" id="FP64-fp64_of_float_inverse"><span class="command">lemma</span></span> fp64_of_float_inverse<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"float_of_fp64 <span class="main">(</span>fp64_of_float <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> float_of_fp64_inj_iff float_of_fp64_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="FP64-Quotientfp"><span class="command">lemma</span></span> Quotientfp<span class="main">:</span> <span class="quoted"><span class="quoted">"Quotient eq_fp64 fp64_of_float float_of_fp64 rel_fp64"</span></span>
  <span class="comment1">―‹<span class="antiquoted"><span class="operator"><span class="hidden">\&lt;^</span><span class="control">term</span><span class="hidden">&gt;</span></span><span class="quoted">‹eq_fp64›</span></span> is a workaround to prevent a (failing -- TODO: why?)
      code setup in <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>setup_lifting›</span></span>.›</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> QuotientI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> rel_fp64_def<span class="main">)</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> Quotientfp

<span class="keyword1"><span class="command">lift_definition</span></span> fp64_lessThan<span class="main">::</span><span class="quoted"><span class="quoted">"fp64 <span class="main">⇒</span> fp64 <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"flt<span class="main">::</span>float64<span class="main">⇒</span>float64<span class="main">⇒</span>bool"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> fp64_lessEqual<span class="main">::</span><span class="quoted"><span class="quoted">"fp64 <span class="main">⇒</span> fp64 <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"fle<span class="main">::</span>float64<span class="main">⇒</span>float64<span class="main">⇒</span>bool"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> fp64_greaterThan<span class="main">::</span><span class="quoted"><span class="quoted">"fp64 <span class="main">⇒</span> fp64 <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"fgt<span class="main">::</span>float64<span class="main">⇒</span>float64<span class="main">⇒</span>bool"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> fp64_greaterEqual<span class="main">::</span><span class="quoted"><span class="quoted">"fp64 <span class="main">⇒</span> fp64 <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"fge<span class="main">::</span>float64<span class="main">⇒</span>float64<span class="main">⇒</span>bool"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> fp64_equal<span class="main">::</span><span class="quoted"><span class="quoted">"fp64 <span class="main">⇒</span> fp64 <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"feq<span class="main">::</span>float64<span class="main">⇒</span>float64<span class="main">⇒</span>bool"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> fp64_abs<span class="main">::</span><span class="quoted"><span class="quoted">"fp64 <span class="main">⇒</span> fp64"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"abs<span class="main">::</span>float64<span class="main">⇒</span>float64"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> fp64_negate<span class="main">::</span><span class="quoted"><span class="quoted">"fp64 <span class="main">⇒</span> fp64"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"uminus<span class="main">::</span>float64<span class="main">⇒</span>float64"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> fp64_sqrt<span class="main">::</span><span class="quoted"><span class="quoted">"roundmode <span class="main">⇒</span> fp64 <span class="main">⇒</span> fp64"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"fsqrt<span class="main">::</span>roundmode<span class="main">⇒</span>float64<span class="main">⇒</span>float64"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> fp64_add<span class="main">::</span><span class="quoted"><span class="quoted">"roundmode <span class="main">⇒</span> fp64 <span class="main">⇒</span> fp64 <span class="main">⇒</span> fp64"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"fadd<span class="main">::</span>roundmode<span class="main">⇒</span>float64<span class="main">⇒</span>float64<span class="main">⇒</span>float64"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> fp64_sub<span class="main">::</span><span class="quoted"><span class="quoted">"roundmode <span class="main">⇒</span> fp64 <span class="main">⇒</span> fp64 <span class="main">⇒</span> fp64"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"fsub<span class="main">::</span>roundmode<span class="main">⇒</span>float64<span class="main">⇒</span>float64<span class="main">⇒</span>float64"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> fp64_mul<span class="main">::</span><span class="quoted"><span class="quoted">"roundmode <span class="main">⇒</span> fp64 <span class="main">⇒</span> fp64 <span class="main">⇒</span> fp64"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"fmul<span class="main">::</span>roundmode<span class="main">⇒</span>float64<span class="main">⇒</span>float64<span class="main">⇒</span>float64"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> fp64_div<span class="main">::</span><span class="quoted"><span class="quoted">"roundmode <span class="main">⇒</span> fp64 <span class="main">⇒</span> fp64 <span class="main">⇒</span> fp64"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"fdiv<span class="main">::</span>roundmode<span class="main">⇒</span>float64<span class="main">⇒</span>float64<span class="main">⇒</span>float64"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> fp64_mul_add<span class="main">::</span><span class="quoted"><span class="quoted">"roundmode <span class="main">⇒</span> fp64 <span class="main">⇒</span> fp64 <span class="main">⇒</span> fp64 <span class="main">⇒</span> fp64"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"fmul_add<span class="main">::</span>roundmode<span class="main">⇒</span>float64<span class="main">⇒</span>float64<span class="main">⇒</span>float64<span class="main">⇒</span>float64"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Conversion_IEEE_Float">
<div class="head">
<h1>Theory Conversion_IEEE_Float</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Fabian Hellauer
           Fabian Immler
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Conversion_IEEE_Float
  <span class="keyword2"><span class="keyword">imports</span></span>
    <span class="quoted">"<a href="../../HOL/HOL-Library/Float.html">HOL-Library.Float</a>"</span>
    <a href="IEEE_Properties.html">IEEE_Properties</a>
    <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Target_Numeral.html">HOL-Library.Code_Target_Numeral</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">of_finite</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> is_normal <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> <span class="main">(</span>Float <span class="main">(</span>normal_mantissa <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>normal_exponent <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> is_denormal <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> <span class="main">(</span>Float <span class="main">(</span>denormal_mantissa <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">(</span>denormal_exponent <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Conversion_IEEE_Float-float_val_of_finite"><span class="command">lemma</span></span> float_val_of_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite <span class="free">x</span> <span class="main">⟹</span> of_finite <span class="free">x</span> <span class="main">=</span> valof <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> normal_imp_not_denormal of_finite_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_normal_Float</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span> itself <span class="main">⇒</span> Float.float <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_normal_Float</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⟷</span>
    mantissa <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span>
    bitlen <span class="main">¦</span>mantissa <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">¦</span> <span class="main">≤</span> fracwidth <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">+</span> <span class="main">1</span> <span class="main">∧</span>
    <span class="main">-</span> int <span class="main">(</span>bias <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">-</span> bitlen <span class="main">¦</span>mantissa <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> Float.exponent <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span>
    Float.exponent <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">&lt;</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> bitlen <span class="main">¦</span>mantissa <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">¦</span> <span class="main">-</span> bias <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_denormal_Float</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span> itself <span class="main">⇒</span> Float.float <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_denormal_Float</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⟷</span>
    mantissa <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span>
    bitlen <span class="main">¦</span>mantissa <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">-</span> Float.exponent <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">-</span> int <span class="main">(</span>bias <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">^</span><span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> int <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">&lt;</span> Float.exponent <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> is_denormal_FloatD <span class="main">=</span>
  is_denormal_Float_def<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">THEN</span> conjunct1<span class="main">]</span>
  is_denormal_Float_def<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">THEN</span> conjunct2<span class="main">]</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_finite_Float</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span> itself <span class="main">⇒</span> Float.float <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_finite_Float</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⟷</span> is_normal_Float <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∨</span> is_denormal_Float <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">0</span>"</span></span>

<span class="keyword1" id="Conversion_IEEE_Float-is_finite_Float_eq"><span class="command">lemma</span></span> is_finite_Float_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_finite_Float <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="free">f</span> <span class="main">⟷</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">e</span> <span class="main">=</span> Float.exponent <span class="free">f</span><span class="main">;</span> <span class="bound">bm</span> <span class="main">=</span> bitlen <span class="main">(</span>abs <span class="main">(</span>mantissa <span class="free">f</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">in</span> <span class="bound">bm</span> <span class="main">≤</span> Suc <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">∧</span>
     <span class="bound">bm</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="bound">e</span> <span class="main">∧</span>
     <span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> int <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_1 diff_le_self lessI linorder_not_less one_less_numeral_iff
        power_strict_increasing_iff zle_diff1_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> int <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> len_gt_0 of_nat_0_less_iff zero_less_power<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span>
    <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> int <span class="main">(</span>bias <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> IEEE.float<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bias_def power_Suc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> of_nat_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> rewr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">e</span> <span class="main">⟷</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">e</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">n</span> <span class="skolem">e</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> *** rewr
    <span class="keyword1"><span class="command">using</span></span> * **
    <span class="keyword1"><span class="command">unfolding</span></span> is_finite_Float_def is_normal_Float_def is_denormal_Float_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def bias_def mantissa_eq_zero_iff of_nat_diff
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> add_right_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> normal_of_Float <span class="main">::</span> <span class="quoted"><span class="quoted">"Float.float <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">let</span> <span class="bound">m</span> <span class="main">=</span> mantissa <span class="bound">x</span><span class="main">;</span> <span class="bound">e</span> <span class="main">=</span> Float.exponent <span class="bound">x</span> <span class="keyword1">in</span>
    <span class="main">(</span><span class="keyword1">if</span> <span class="bound">m</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">,</span>
      word_of_int <span class="main">(</span><span class="bound">e</span> <span class="main">+</span> int <span class="main">(</span>bias <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> bitlen <span class="main">¦</span><span class="bound">m</span><span class="main">¦</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span>
      word_of_int <span class="main">(</span><span class="main">¦</span><span class="bound">m</span><span class="main">¦</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span>bitlen <span class="main">¦</span><span class="bound">m</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Conversion_IEEE_Float-sign_normal_of_Float"><span class="command">lemma</span></span> sign_normal_of_Float<span class="main">:</span><span class="quoted"><span class="quoted">"sign <span class="main">(</span>normal_of_Float <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def mantissa_pos_iff<span class="main">)</span>

<span class="keyword1" id="Conversion_IEEE_Float-uints_bitlen_eq"><span class="command">lemma</span></span> uints_bitlen_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"uints <span class="free">n</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">i</span> <span class="main">∧</span> bitlen <span class="bound">i</span> <span class="main">≤</span> <span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> uints_num bitlen_le_iff_power<span class="main">)</span>

<span class="keyword1" id="Conversion_IEEE_Float-uint_word_of_int_bitlen_eq"><span class="command">lemma</span></span> uint_word_of_int_bitlen_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"uint <span class="main">(</span>word_of_int <span class="free">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>len word<span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"bitlen <span class="free">x</span> <span class="main">≤</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> word_uint.Abs_inverse<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uints_bitlen_eq that<span class="main">)</span>

<span class="keyword1" id="Conversion_IEEE_Float-fraction_normal_of_Float"><span class="command">lemma</span></span> fraction_normal_of_Float<span class="main">:</span><span class="quoted"><span class="quoted">"fraction <span class="main">(</span>normal_of_Float <span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span>nat <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span>bitlen <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_normal_Float <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> bmp<span class="main">:</span> <span class="quoted"><span class="quoted">"bitlen <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abs_of_nonneg bitlen_bounds bitlen_def is_normal_Float_def nat_code<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> of_nat_0_le_iff
        power.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zabs_less_one_iff zero_less_abs_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> mless<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>bitlen <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bitlen_bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> lem<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>bitlen <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bitlen_bounds is_normal_Float_def that zero_less_abs_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> nble<span class="main">:</span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span>bitlen <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">≤</span> Suc <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bitlen_bounds <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_normal_Float_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> nn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span>bitlen <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> add_le_imp_le_diff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_right_mono<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> lem<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> power_add<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> nble bmp
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span>bitlen <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> less_le_trans<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_strict_right_mono<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mless<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">unfolding</span></span> power_add<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> power_Suc<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> power_increasing<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> nble
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bitlen <span class="main">(</span><span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span>bitlen <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span><span class="main">)</span>
    <span class="main">≤</span> int <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bitlen_le_iff_power
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> Let_def split_beta' fst_conv snd_conv uint_nat <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> nat_uint_eq <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> nn
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> uint_word_of_int_bitlen_eq<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_mult_distrib nat_diff_distrib nat_power_eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Conversion_IEEE_Float-exponent_normal_of_Float"><span class="command">lemma</span></span> exponent_normal_of_Float<span class="main">:</span><span class="quoted"><span class="quoted">"exponent <span class="main">(</span>normal_of_Float <span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span>
  nat <span class="main">(</span>Float.exponent <span class="free">x</span> <span class="main">+</span> <span class="main">(</span>bias <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> bitlen <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_normal_Float <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">flip</span><span class="main"><span class="main">:</span></span> uint_nat nat_uint_eq <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_normal_Float_def bitlen_le_iff_power uint_word_of_int_bitlen_eq Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_take_bit_eq take_bit_int_eq_self<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> denormal_of_Float <span class="main">::</span> <span class="quoted"><span class="quoted">"Float.float <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">let</span> <span class="bound">m</span> <span class="main">=</span> mantissa <span class="bound">x</span><span class="main">;</span> <span class="bound">e</span> <span class="main">=</span> Float.exponent <span class="bound">x</span> <span class="keyword1">in</span>
  <span class="main">(</span><span class="keyword1">if</span> <span class="bound">m</span> <span class="main">≥</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">,</span>
    word_of_int <span class="main">(</span><span class="main">¦</span><span class="bound">m</span><span class="main">¦</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span><span class="bound">e</span> <span class="main">+</span> bias <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">+</span> fracwidth <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Conversion_IEEE_Float-sign_denormal_of_Float"><span class="command">lemma</span></span> sign_denormal_of_Float<span class="main">:</span><span class="quoted"><span class="quoted">"sign <span class="main">(</span>denormal_of_Float <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def mantissa_nonneg_iff<span class="main">)</span>

<span class="keyword1" id="Conversion_IEEE_Float-exponent_denormal_of_Float"><span class="command">lemma</span></span> exponent_denormal_of_Float<span class="main">:</span><span class="quoted"><span class="quoted">"exponent <span class="main">(</span>denormal_of_Float <span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>

<span class="keyword1" id="Conversion_IEEE_Float-fraction_denormal_of_Float"><span class="command">lemma</span></span> fraction_denormal_of_Float<span class="main">:</span><span class="quoted"><span class="quoted">"fraction <span class="main">(</span>denormal_of_Float <span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span>nat <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>Float.exponent <span class="free">x</span> <span class="main">+</span> bias <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">+</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_denormal_Float <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> mless<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>bitlen <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bitlen_bounds <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span>bitlen <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">+</span>
    nat <span class="main">(</span>Float.exponent <span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">+</span> int <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">)</span>
    <span class="main">≤</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_denormal_Float_def nat_diff_distrib' le_diff_conv
        bitlen_nonneg nat_le_iff bias_def nat_add_distrib<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> of_nat_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span> <span class="main">*</span>  <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>Float.exponent <span class="free">x</span> <span class="main">+</span> int <span class="main">(</span>bias <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
    <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> less_le_trans<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_strict_right_mono<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mless<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> power_add<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> power_Suc<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> power_increasing<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bias_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> that *
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_denormal_Float_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> of_nat_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def nat_eq_iff take_bit_eq_mod<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">of_finite_Float</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Float.float <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> <span class="keyword1">float</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">of_finite_Float</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> is_normal_Float <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> normal_of_Float <span class="free"><span class="bound"><span class="entity">x</span></span></span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> is_denormal_Float <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="keyword1">then</span> denormal_of_Float <span class="free"><span class="bound"><span class="entity">x</span></span></span>
    <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Conversion_IEEE_Float-valof_normal_of_Float"><span class="command">lemma</span></span> valof_normal_of_Float<span class="main">:</span> <span class="quoted"><span class="quoted">"valof <span class="main">(</span>normal_of_Float <span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_normal_Float <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valof <span class="main">(</span>normal_of_Float <span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> sign <span class="main">(</span>normal_of_Float <span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">*</span>
    <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> real <span class="main">(</span>nat <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span>bitlen <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
      <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span>bitlen <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>
    <span class="numeral">2</span> <span class="keyword1">powr</span> Float.exponent <span class="free">x</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?s</span> <span class="main">*</span> <span class="var">?m</span> <span class="main">*</span> <span class="var">?e</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_normal_Float_def valof_eq fraction_normal_of_Float
        powr_realpow<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> exponent_normal_of_Float powr_diff powr_add<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_normal_Float_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">≤</span> nat <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span>bitlen <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">^</span> nat <span class="main">(</span>bitlen <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span>bitlen <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> nat <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span>Suc <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span>bitlen <span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bitlen_bounds<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>mantissa <span class="free">x</span><span class="main">¦</span>"</span></span><span class="main">]</span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_normal_Float_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">=</span> abs <span class="main">(</span>mantissa <span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> of_nat_diff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> bound <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_realpow<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> powr_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
          is_normal_Float_def bitlen_nonneg of_nat_diff <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mantissa_exponent sign_normal_of_Float abs_real_def zero_less_mult_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Conversion_IEEE_Float-valof_denormal_of_Float"><span class="command">lemma</span></span> valof_denormal_of_Float<span class="main">:</span> <span class="quoted"><span class="quoted">"valof <span class="main">(</span>denormal_of_Float <span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_denormal_Float <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> less<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Float.exponent <span class="free">x</span> <span class="main">+</span> <span class="main">(</span>int <span class="main">(</span>bias <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> IEEE.float<span class="main">)</span><span class="main">)</span> <span class="main">+</span> int <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_denormal_Float_def bias_def of_nat_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valof <span class="main">(</span>denormal_of_Float <span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">^</span> sign <span class="main">(</span>denormal_of_Float <span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">*</span> <span class="main">¦</span>real_of_int <span class="main">(</span>mantissa <span class="free">x</span><span class="main">)</span><span class="main">¦</span><span class="main">)</span> <span class="main">*</span>
    <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">powr</span> real <span class="main">(</span>nat <span class="main">(</span>Float.exponent <span class="free">x</span> <span class="main">+</span> int <span class="main">(</span>bias <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> IEEE.float<span class="main">)</span><span class="main">)</span> <span class="main">+</span> int <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span>
      <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">powr</span> real <span class="main">(</span>bias <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> IEEE.float<span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?m</span> <span class="main">*</span> <span class="var">?e</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valof_eq exponent_denormal_of_Float fraction_denormal_of_Float that
        mantissa_exponent powr_realpow<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?m</span> <span class="main">=</span> mantissa <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sign_denormal_of_Float abs_real_def mantissa_neg_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">powr</span> Float.exponent <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> powr_mult_base less <span class="dynamic"><span class="dynamic">ac_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mantissa_exponent<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Conversion_IEEE_Float-valof_of_finite_Float"><span class="command">lemma</span></span> valof_of_finite_Float<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_finite_Float <span class="main">(</span><span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> IEEE.float<span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">⟹</span> valof <span class="main">(</span>of_finite_Float <span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> of_finite_Float_def is_finite_Float_def valof_denormal_of_Float valof_normal_of_Float<span class="main">)</span>

<span class="keyword1" id="Conversion_IEEE_Float-is_normal_normal_of_Float"><span class="command">lemma</span></span> is_normal_normal_of_Float<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_normal <span class="main">(</span>normal_of_Float <span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_normal_Float <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_normal_def exponent_normal_of_Float that is_normal_Float_def
      emax_eq nat_less_iff of_nat_diff<span class="main">)</span>

<span class="keyword1" id="Conversion_IEEE_Float-is_denormal_denormal_of_Float"><span class="command">lemma</span></span> is_denormal_denormal_of_Float<span class="main">:</span> <span class="quoted"><span class="quoted">"is_denormal <span class="main">(</span>denormal_of_Float <span class="free">x</span><span class="main">::</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_denormal_Float <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> that
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_denormal_def exponent_denormal_of_Float that is_denormal_Float_def
      emax_eq fraction_denormal_of_Float le_nat_iff bias_def<span class="main">)</span>

<span class="keyword1" id="Conversion_IEEE_Float-is_finite_of_finite_Float"><span class="command">lemma</span></span> is_finite_of_finite_Float<span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite <span class="main">(</span>of_finite_Float <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_finite_def of_finite_Float_def is_normal_normal_of_Float
      is_denormal_denormal_of_Float<span class="main">)</span>

<span class="keyword1" id="Conversion_IEEE_Float-Float_eq_zero_iff"><span class="command">lemma</span></span> Float_eq_zero_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"Float <span class="free">m</span> <span class="free">e</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Float.compute_is_float_zero Float_0_eq_0<span class="main">)</span>

<span class="keyword1" id="Conversion_IEEE_Float-bitlen_mantissa_Float"><span class="command">lemma</span></span> bitlen_mantissa_Float<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bitlen <span class="main">¦</span>mantissa <span class="main">(</span>Float <span class="free">m</span> <span class="free">e</span><span class="main">)</span><span class="main">¦</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> bitlen <span class="main">¦</span><span class="free">m</span><span class="main">¦</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">-</span> Float.exponent <span class="main">(</span>Float <span class="free">m</span> <span class="free">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bitlen_Float<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">e</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Conversion_IEEE_Float-exponent_Float"><span class="command">lemma</span></span> exponent_Float<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Float.exponent <span class="main">(</span>Float <span class="free">m</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">m</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> bitlen <span class="main">¦</span><span class="free">m</span><span class="main">¦</span> <span class="main">+</span> <span class="free">e</span><span class="main">)</span> <span class="main">-</span> bitlen <span class="main">¦</span>mantissa <span class="main">(</span>Float <span class="free">m</span> <span class="free">e</span><span class="main">)</span><span class="main">¦</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span> bitlen_Float<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">m</span></span> <span class="quoted"><span class="free">e</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Conversion_IEEE_Float-is_normal_Float_normal"><span class="command">lemma</span></span> is_normal_Float_normal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_normal_Float <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">(</span>Float <span class="main">(</span>normal_mantissa <span class="free">x</span><span class="main">)</span> <span class="main">(</span>normal_exponent <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_normal <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> Float <span class="main">(</span>normal_mantissa <span class="free">x</span><span class="main">)</span> <span class="main">(</span>normal_exponent <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def is_normal_def zero_float_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
        Float_eq_zero_iff normal_mantissa_def add_nonneg_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> denormalize_shift<span class="main">[</span><span class="operator">OF</span> f_def this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    i<span class="main">:</span> <span class="quoted"><span class="quoted">"normal_mantissa <span class="free">x</span> <span class="main">=</span> mantissa <span class="skolem">f</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"normal_exponent <span class="free">x</span> <span class="main">=</span> Float.exponent <span class="skolem">f</span> <span class="main">-</span> int <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mantissa <span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> i mantissa_eq_zero_iff Float_eq_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"normal_exponent <span class="free">x</span> <span class="main">≤</span> Float.exponent <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" bitlen <span class="main">¦</span>mantissa <span class="skolem">f</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> int <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bitlen_mantissa_Float bitlen_normal_mantissa f_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> int <span class="main">(</span>bias <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> bitlen <span class="main">¦</span>mantissa <span class="skolem">f</span><span class="main">¦</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> Float.exponent <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> bitlen_mantissa_Float bitlen_normal_mantissa f_def
    <span class="keyword1"><span class="command">using</span></span> that
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mantissa_eq_zero_iff abs_mult bias_def normal_mantissa_def normal_exponent_def
        is_normal_def emax_eq less_diff_conv add_nonneg_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">+</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">arith</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Float.exponent <span class="skolem">f</span> <span class="main">&lt;</span>
      <span class="numeral">2</span> <span class="main">^</span> <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> bitlen <span class="main">¦</span>mantissa <span class="skolem">f</span><span class="main">¦</span> <span class="main">-</span> int <span class="main">(</span>bias <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> normal_exponent_bounds_int<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> bitlen_mantissa_Float bitlen_normal_mantissa f_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bias_def <span class="dynamic"><span class="dynamic">algebra_simps</span></span> power_Suc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> of_nat_diff
        <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> le_less_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> add_right_mono<span class="main"><span class="main">]</span></span> normal_exponent_bounds_int<span class="main"><span class="main">[</span></span><span class="operator">OF</span> that<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_normal_Float_def f_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Conversion_IEEE_Float-is_denormal_Float_denormal"><span class="command">lemma</span></span> is_denormal_Float_denormal<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_denormal_Float <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span>
    <span class="main">(</span>Float <span class="main">(</span>denormal_mantissa <span class="free">x</span><span class="main">)</span> <span class="main">(</span>denormal_exponent <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"is_denormal <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> Float <span class="main">(</span>denormal_mantissa <span class="free">x</span><span class="main">)</span> <span class="main">(</span>denormal_exponent <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> that <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_def is_denormal_def zero_float_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
        Float_eq_zero_iff denormal_mantissa_def add_nonneg_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> denormalize_shift<span class="main">[</span><span class="operator">OF</span> f_def this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    i<span class="main">:</span> <span class="quoted"><span class="quoted">"denormal_mantissa <span class="free">x</span> <span class="main">=</span> mantissa <span class="skolem">f</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="quoted">"denormal_exponent <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">=</span> Float.exponent <span class="skolem">f</span> <span class="main">-</span> int <span class="skolem">i</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mantissa <span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> i mantissa_eq_zero_iff Float_eq_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"bitlen <span class="main">¦</span>mantissa <span class="skolem">f</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">-</span> Float.exponent <span class="skolem">f</span> <span class="main">-</span> int <span class="main">(</span>bias <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span> IEEE.float<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹mantissa <span class="skolem">f</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> f_def bitlen_mantissa_Float
    <span class="keyword1"><span class="command">using</span></span> bitlen_denormal_mantissa<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> denormal_exponent_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">^</span> <span class="main">(</span><span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'e</span><span class="main">)</span> <span class="main">-</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">-</span> int <span class="keyword1">LENGTH</span><span class="main">(</span><span class="tfree">'f</span><span class="main">)</span> <span class="main">≤</span> Float.exponent <span class="skolem">f</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≤</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">≤</span> denormal_exponent <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">i</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> that
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_denormal_def bias_def denormal_exponent_def of_nat_diff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Float.exponent <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_denormal_Float_def exponent_Float f_def<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Conversion_IEEE_Float-is_finite_Float_of_finite"><span class="command">lemma</span></span> is_finite_Float_of_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"is_finite_Float <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="main">(</span>of_finite <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'e</span><span class="main">,</span> <span class="tfree">'f</span><span class="main">)</span><span class="keyword1">float</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_finite_Float_def of_finite_def is_normal_Float_normal
      is_denormal_Float_denormal<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Double">
<div class="head">
<h1>Theory Double</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Lei Yu, University of Cambridge *)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Code Generation Setup for Floats›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Double
  <span class="keyword2"><span class="keyword">imports</span></span>
    <a href="Conversion_IEEE_Float.html">Conversion_IEEE_Float</a>
    <span class="quoted">"<a href="../../HOL/HOL-Library/Monad_Syntax.html">HOL-Library.Monad_Syntax</a>"</span>
    <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Target_Numeral.html">HOL-Library.Code_Target_Numeral</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A type for code generation to SML/OCaml›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> double <span class="main">=</span> <span class="quoted"><span class="quoted">"UNIV<span class="main">::</span><span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">52</span><span class="main">)</span> <span class="keyword1">float</span> set"</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_double

<span class="keyword1"><span class="command">instantiation</span></span> double <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>uminus<span class="main">,</span>plus<span class="main">,</span>times<span class="main">,</span>minus<span class="main">,</span>zero<span class="main">,</span>one<span class="main">,</span>abs<span class="main">,</span>ord<span class="main">,</span>inverse<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">uminus_double</span><span class="main">::</span><span class="quoted"><span class="quoted">"double <span class="main">⇒</span> double"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">uminus</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">plus_double</span><span class="main">::</span><span class="quoted"><span class="quoted">"double <span class="main">⇒</span> double <span class="main">⇒</span> double"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">plus</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">times_double</span><span class="main">::</span><span class="quoted"><span class="quoted">"double <span class="main">⇒</span> double <span class="main">⇒</span> double"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">times</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">divide_double</span><span class="main">::</span><span class="quoted"><span class="quoted">"double <span class="main">⇒</span> double <span class="main">⇒</span> double"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">divide</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">inverse_double</span><span class="main">::</span><span class="quoted"><span class="quoted">"double <span class="main">⇒</span> double"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">inverse</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">minus_double</span><span class="main">::</span><span class="quoted"><span class="quoted">"double <span class="main">⇒</span> double <span class="main">⇒</span> double"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">minus</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">zero_double</span><span class="main">::</span><span class="quoted"><span class="quoted">"double"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">one_double</span><span class="main">::</span><span class="quoted"><span class="quoted">"double"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_eq_double</span><span class="main">::</span><span class="quoted"><span class="quoted">"double <span class="main">⇒</span> double <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(≤)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> <span class="class_parameter">less_double</span><span class="main">::</span><span class="quoted"><span class="quoted">"double <span class="main">⇒</span> double <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">(&lt;)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> eq_double<span class="main">::</span><span class="quoted"><span class="quoted">"double<span class="main">⇒</span>double<span class="main">⇒</span>bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">float_eq</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> sqrt_double<span class="main">::</span><span class="quoted"><span class="quoted">"double<span class="main">⇒</span>double"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">float_sqrt</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">no_notation</span></span> plus_infinity <span class="main">(</span><span class="quoted">"<span class="keyword1">∞</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> infinity_double<span class="main">::</span><span class="quoted"><span class="quoted">"double"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">∞</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">plus_infinity</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> is_normal<span class="main">::</span><span class="quoted"><span class="quoted">"double <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">IEEE.is_normal</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> is_zero<span class="main">::</span><span class="quoted"><span class="quoted">"double <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">IEEE.is_zero</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> is_finite<span class="main">::</span><span class="quoted"><span class="quoted">"double <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">IEEE.is_finite</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> is_nan<span class="main">::</span><span class="quoted"><span class="quoted">"double <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">IEEE.is_nan</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">code_printing</span></span> <span class="keyword2"><span class="keyword">type_constructor</span></span> double <span class="main">⇀</span>
  <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"real"</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"float"</span>

<span class="keyword1"><span class="command">code_printing</span></span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">::</span> double"</span></span> <span class="main">⇀</span>
  <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"0.0"</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"0.0"</span>
<span class="keyword1"><span class="command">declare</span></span> zero_double.abs_eq<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">code_printing</span></span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">::</span> double"</span></span> <span class="main">⇀</span>
  <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"1.0"</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"1.0"</span>
<span class="keyword1"><span class="command">declare</span></span> one_double.abs_eq<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">code_printing</span></span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"eq_double <span class="main">::</span> double <span class="main">⇒</span> double <span class="main">⇒</span> bool"</span></span> <span class="main">⇀</span>
  <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"Real.== ((_:real), (_))"</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"Pervasives.(=)"</span>
<span class="keyword1"><span class="command">declare</span></span> eq_double.abs_eq<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">code_printing</span></span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"Orderings.less_eq <span class="main">::</span> double <span class="main">⇒</span> double <span class="main">⇒</span> bool"</span></span> <span class="main">⇀</span>
  <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"Real.&lt;= ((_), (_))"</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"Pervasives.(&lt;=)"</span>
<span class="keyword1"><span class="command">declare</span></span> less_double_def <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">code_printing</span></span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"Orderings.less <span class="main">::</span> double <span class="main">⇒</span> double <span class="main">⇒</span> bool"</span></span> <span class="main">⇀</span>
  <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"Real.&lt; ((_), (_))"</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"Pervasives.(&lt;)"</span>
<span class="keyword1"><span class="command">declare</span></span> less_eq_double_def<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">code_printing</span></span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">(+)</span> <span class="main">::</span> double <span class="main">⇒</span> double <span class="main">⇒</span> double"</span></span> <span class="main">⇀</span>
  <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"Real.+ ((_), (_))"</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"Pervasives.( +. )"</span>
<span class="keyword1"><span class="command">declare</span></span> plus_double_def<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">code_printing</span></span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">(*)</span> <span class="main">::</span> double <span class="main">⇒</span> double <span class="main">⇒</span> double"</span></span> <span class="main">⇀</span>
  <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"Real.* ((_), (_))"</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"Pervasives.( *. )"</span>
<span class="keyword1"><span class="command">declare</span></span> times_double_def <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">code_printing</span></span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">(-)</span> <span class="main">::</span> double <span class="main">⇒</span> double <span class="main">⇒</span> double"</span></span> <span class="main">⇀</span>
  <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"Real.- ((_), (_))"</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"Pervasives.( -. )"</span>
<span class="keyword1"><span class="command">declare</span></span> minus_double_def <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">code_printing</span></span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"uminus <span class="main">::</span> double <span class="main">⇒</span> double"</span></span> <span class="main">⇀</span>
  <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"Real.~"</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"Pervasives.( ~-. )"</span>

<span class="keyword1"><span class="command">code_printing</span></span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"<span class="main">(/)</span> <span class="main">::</span> double <span class="main">⇒</span> double <span class="main">⇒</span> double"</span></span> <span class="main">⇀</span>
  <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"Real.'/ ((_), (_))"</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"Pervasives.( '/. )"</span>
<span class="keyword1"><span class="command">declare</span></span> divide_double_def <span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">code_printing</span></span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"sqrt_double <span class="main">::</span> double <span class="main">⇒</span> double"</span></span> <span class="main">⇀</span>
  <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"Math.sqrt"</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">(</span>OCaml<span class="main">)</span> <span class="quoted">"Pervasives.sqrt"</span>
<span class="keyword1"><span class="command">declare</span></span> sqrt_def<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">code_printing</span></span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"infinity_double <span class="main">::</span> double"</span></span> <span class="main">⇀</span>
  <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"Real.posInf"</span>
<span class="keyword1"><span class="command">declare</span></span> infinity_double.abs_eq<span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">del</span><span class="main">]</span>

<span class="keyword1"><span class="command">code_printing</span></span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"is_normal <span class="main">::</span> double <span class="main">⇒</span> bool"</span></span> <span class="main">⇀</span>
  <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"Real.isNormal"</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">drop</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">"is_normal"</span></span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">code_printing</span></span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"is_finite <span class="main">::</span> double <span class="main">⇒</span> bool"</span></span> <span class="main">⇀</span>
  <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"Real.isFinite"</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">drop</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">"is_finite"</span></span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">code_printing</span></span> <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"is_nan <span class="main">::</span> double <span class="main">⇒</span> bool"</span></span> <span class="main">⇀</span>
  <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"Real.isNan"</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">drop</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">"is_nan"</span></span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Mapping natural numbers to doubles.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">float_of</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> double"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">float_of</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">float_of</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">float_of</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">+</span> <span class="main">1</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"float_of <span class="numeral">2</span> <span class="main">&lt;</span> float_of <span class="numeral">3</span> <span class="main">+</span> float_of <span class="numeral">4</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">float_of</span></span> <span class="keyword2"><span class="keyword">in</span></span> SML

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Conversion from int›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> double_of_int<span class="main">::</span><span class="quoted"><span class="quoted">"int <span class="main">⇒</span> double"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> round To_nearest <span class="main">(</span>real_of_int <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">includes</span></span> integer.lifting <span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> double_of_integer<span class="main">::</span><span class="quoted"><span class="quoted">"integer <span class="main">⇒</span> double"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">double_of_int</span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Double-float_of_int"><span class="command">lemma</span></span> float_of_int<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"double_of_int <span class="free">i</span> <span class="main">=</span> double_of_integer <span class="main">(</span>integer_of_int <span class="free">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> double_of_integer_def<span class="main">)</span>

<span class="keyword1"><span class="command">code_printing</span></span>
  <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"double_of_integer <span class="main">::</span> integer <span class="main">⇒</span> double"</span></span> <span class="main">⇀</span> <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"Real.fromLargeInt"</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">drop</span><span class="main"><span class="main">:</span></span> <span class="quoted">double_of_integer</span><span class="main">]</span><span class="main">]</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Conversion to and from software floats, extracting information›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Need to trust a lot of code here...›</span></span>

<span class="keyword1" id="Double-is_finite_double_eq"><span class="command">lemma</span></span> is_finite_double_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"is_finite_Float <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">52</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="free">f</span> <span class="main">⟷</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">e</span> <span class="main">=</span> Float.exponent <span class="free">f</span><span class="main">;</span> <span class="bound">bm</span> <span class="main">=</span> bitlen <span class="main">(</span>abs <span class="main">(</span>mantissa <span class="free">f</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">in</span> <span class="main">(</span><span class="bound">bm</span> <span class="main">≤</span> <span class="numeral">53</span> <span class="main">∧</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">bm</span> <span class="main">&lt;</span> <span class="numeral">1025</span> <span class="main">∧</span> <span class="main">-</span> <span class="numeral">1075</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_finite_Float_eq
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>

<span class="keyword1"><span class="command">code_printing</span></span>
  <span class="keyword2"><span class="keyword">code_module</span></span> <span class="quoted">"IEEE_Mantissa_Exponent"</span> <span class="main">⇀</span> <span class="main">(</span>SML<span class="main">)</span>
<span class="quoted">‹
structure IEEE_Mantissa_Exponent =
struct
fun to_man_exp_double x =
  if Real.isFinite x
  then case Real.toManExp x of {man = m, exp = e} =&gt;
    SOME (Real.floor (Real.* (m, Math.pow (2.0, 53.0))), IntInf.- (e, 53))
  else NONE
fun normfloat (m, e) =
(if m mod 2 = 0 andalso m &lt;&gt; 0 then normfloat (m div 2, e + 1)
 else if m = 0 then (0, 0) else (m, e))
fun bitlen x = (if 0 &lt; x then bitlen (x div 2) + 1 else 0)
fun is_finite_double_eq m e =
  let
    val (m, e) = normfloat (m, e)
    val bm = bitlen (abs m)
  in bm &lt;= 53 andalso e + bm &lt; 1025 andalso e &gt; ~1075 end
fun from_man_exp_double m e =
  if is_finite_double_eq m e
  then SOME (Real.fromManExp {man = Real.fromLargeInt m, exp = e})
  else NONE
end
›</span>

<span class="keyword1"><span class="command">lift_definition</span></span> of_finite<span class="main">::</span><span class="quoted"><span class="quoted">"double <span class="main">⇒</span> Float.float"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">Conversion_IEEE_Float.of_finite</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">man_exp_of_double</span><span class="main">::</span><span class="quoted"><span class="quoted">"double <span class="main">⇒</span> <span class="main">(</span>integer <span class="main">*</span> integer<span class="main">)</span>option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">man_exp_of_double</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> is_finite <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="keyword1">then</span> <span class="keyword1">let</span> <span class="bound">f</span> <span class="main">=</span> of_finite <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="keyword1">in</span>
    Some <span class="main">(</span>integer_of_int <span class="main">(</span>mantissa <span class="bound">f</span><span class="main">)</span><span class="main">,</span> integer_of_int <span class="main">(</span>Float.exponent <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> of_finite_Float<span class="main">::</span><span class="quoted"><span class="quoted">"Float.float <span class="main">⇒</span> double"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">Conversion_IEEE_Float.of_finite_Float</span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">double_of_man_exp</span><span class="main">::</span><span class="quoted"><span class="quoted">"integer <span class="main">⇒</span> integer <span class="main">⇒</span> double option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">double_of_man_exp</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">f</span> <span class="main">=</span> Float <span class="main">(</span>int_of_integer <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span>int_of_integer <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="keyword1">in</span>
    <span class="keyword1">if</span> is_finite_Float <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">52</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="bound">f</span>
    <span class="keyword1">then</span> Some <span class="main">(</span>of_finite_Float <span class="bound">f</span><span class="main">)</span>
    <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">code_printing</span></span>
  <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"man_exp_of_double <span class="main">::</span> double <span class="main">⇒</span> <span class="main">(</span>integer <span class="main">*</span> integer<span class="main">)</span> option"</span></span> <span class="main">⇀</span>
    <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"IEEE'_Mantissa'_Exponent.to'_man'_exp'_double"</span> <span class="main">|</span>
  <span class="keyword2"><span class="keyword">constant</span></span> <span class="quoted"><span class="quoted">"double_of_man_exp <span class="main">::</span> integer <span class="main">⇒</span> integer <span class="main">⇒</span> double option"</span></span> <span class="main">⇀</span>
    <span class="main">(</span>SML<span class="main">)</span> <span class="quoted">"IEEE'_Mantissa'_Exponent.from'_man'_exp'_double"</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">drop</span><span class="main"><span class="main">:</span></span> <span class="quoted">man_exp_of_double</span><span class="main">]</span><span class="main">]</span>
<span class="keyword1"><span class="command">declare</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">code</span> <span class="quasi_keyword">drop</span><span class="main"><span class="main">:</span></span> <span class="quoted">double_of_man_exp</span><span class="main">]</span><span class="main">]</span>

<span class="keyword1"><span class="command">lift_definition</span></span> Float_of_double<span class="main">::</span><span class="quoted"><span class="quoted">"double <span class="main">⇒</span> Float.float option"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> is_finite <span class="bound">x</span> <span class="keyword1">then</span> Some <span class="main">(</span>of_finite <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> None"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> double_of_Float<span class="main">::</span><span class="quoted"><span class="quoted">"Float.float <span class="main">⇒</span> double option"</span></span> <span class="keyword2"><span class="keyword">is</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> is_finite_Float <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">52</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">then</span> Some <span class="main">(</span>of_finite_Float <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> None"</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1" id="Double-compute_Float_of_double"><span class="command">lemma</span></span> compute_Float_of_double<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Float_of_double <span class="free">x</span> <span class="main">=</span>
    map_option <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">m</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">.</span> Float <span class="main">(</span>int_of_integer <span class="bound">m</span><span class="main">)</span> <span class="main">(</span>int_of_integer <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>man_exp_of_double <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> man_exp_of_double_def Let_def mantissa_exponent<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
      Float_mantissa_exponent<span class="main">)</span>

<span class="keyword1" id="Double-compute_double_of_Float"><span class="command">lemma</span></span> compute_double_of_Float<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"double_of_Float <span class="free">f</span> <span class="main">=</span> double_of_man_exp <span class="main">(</span>integer_of_int <span class="main">(</span>mantissa <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>integer_of_int <span class="main">(</span>Float.exponent <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> double_of_man_exp_def Let_def Float_mantissa_exponent int_of_integer_integer_of_int
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">check_conversion</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">let</span> <span class="bound">f</span> <span class="main">=</span> Float <span class="main">(</span>int_of_integer <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span>int_of_integer <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="keyword1">in</span>
    <span class="keyword1">do</span> <span class="main">{</span>
      <span class="bound">d</span> <span class="main">←</span> double_of_Float <span class="bound">f</span><span class="main">;</span>
      Float_of_double <span class="bound">d</span>
    <span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> is_finite_Float <span class="keyword1">TYPE</span><span class="main">(</span><span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">52</span><span class="main">)</span><span class="keyword1">float</span><span class="main">)</span> <span class="bound">f</span> <span class="keyword1">then</span> Some <span class="bound">f</span> <span class="keyword1">else</span> None<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">check_all</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">check_all</span> <span class="main">0</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟷</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">check_all</span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">∧</span> <span class="free">check_all</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">check_conversions</span> <span class="free"><span class="bound"><span class="entity">dm</span></span></span> <span class="free"><span class="bound"><span class="entity">de</span></span></span> <span class="main">=</span>
  check_all <span class="main">(</span>nat <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">de</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> check_all <span class="main">(</span>nat <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">dm</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span>
    check_conversion <span class="main">(</span>integer_of_int <span class="main">(</span>int <span class="bound">m</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">dm</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>integer_of_int <span class="main">(</span>int <span class="bound">e</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">de</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"check_conversions <span class="numeral">100</span> <span class="numeral">100</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>